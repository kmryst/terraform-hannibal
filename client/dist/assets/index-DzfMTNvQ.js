var VS=(x,m)=>()=>(m||x((m={exports:{}}).exports,m),m.exports);var cD=VS((pD,q0)=>{function US(x,m){for(var w=0;w<m.length;w++){const M=m[w];if(typeof M!="string"&&!Array.isArray(M)){for(const L in M)if(L!=="default"&&!(L in x)){const j=Object.getOwnPropertyDescriptor(M,L);j&&Object.defineProperty(x,L,j.get?j:{enumerable:!0,get:()=>M[L]})}}}return Object.freeze(Object.defineProperty(x,Symbol.toStringTag,{value:"Module"}))}(function(){const m=document.createElement("link").relList;if(m&&m.supports&&m.supports("modulepreload"))return;for(const L of document.querySelectorAll('link[rel="modulepreload"]'))M(L);new MutationObserver(L=>{for(const j of L)if(j.type==="childList")for(const W of j.addedNodes)W.tagName==="LINK"&&W.rel==="modulepreload"&&M(W)}).observe(document,{childList:!0,subtree:!0});function w(L){const j={};return L.integrity&&(j.integrity=L.integrity),L.referrerPolicy&&(j.referrerPolicy=L.referrerPolicy),L.crossOrigin==="use-credentials"?j.credentials="include":L.crossOrigin==="anonymous"?j.credentials="omit":j.credentials="same-origin",j}function M(L){if(L.ep)return;L.ep=!0;const j=w(L);fetch(L.href,j)}})();function Ay(x){return x&&x.__esModule&&Object.prototype.hasOwnProperty.call(x,"default")?x.default:x}var Wv={exports:{}},F_={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var d1;function jS(){if(d1)return F_;d1=1;var x=Symbol.for("react.transitional.element"),m=Symbol.for("react.fragment");function w(M,L,j){var W=null;if(j!==void 0&&(W=""+j),L.key!==void 0&&(W=""+L.key),"key"in L){j={};for(var n in L)n!=="key"&&(j[n]=L[n])}else j=L;return L=j.ref,{$$typeof:x,type:M,key:W,ref:L!==void 0?L:null,props:j}}return F_.Fragment=m,F_.jsx=w,F_.jsxs=w,F_}var p1;function qS(){return p1||(p1=1,Wv.exports=jS()),Wv.exports}var Ko=qS(),$v={exports:{}},br={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var m1;function GS(){if(m1)return br;m1=1;var x=Symbol.for("react.transitional.element"),m=Symbol.for("react.portal"),w=Symbol.for("react.fragment"),M=Symbol.for("react.strict_mode"),L=Symbol.for("react.profiler"),j=Symbol.for("react.consumer"),W=Symbol.for("react.context"),n=Symbol.for("react.forward_ref"),ae=Symbol.for("react.suspense"),ne=Symbol.for("react.memo"),ge=Symbol.for("react.lazy"),Ie=Symbol.iterator;function Re(et){return et===null||typeof et!="object"?null:(et=Ie&&et[Ie]||et["@@iterator"],typeof et=="function"?et:null)}var je={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Qe=Object.assign,tt={};function pt(et,Kt,Di){this.props=et,this.context=Kt,this.refs=tt,this.updater=Di||je}pt.prototype.isReactComponent={},pt.prototype.setState=function(et,Kt){if(typeof et!="object"&&typeof et!="function"&&et!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,et,Kt,"setState")},pt.prototype.forceUpdate=function(et){this.updater.enqueueForceUpdate(this,et,"forceUpdate")};function $e(){}$e.prototype=pt.prototype;function Et(et,Kt,Di){this.props=et,this.context=Kt,this.refs=tt,this.updater=Di||je}var Tt=Et.prototype=new $e;Tt.constructor=Et,Qe(Tt,pt.prototype),Tt.isPureReactComponent=!0;var Mt=Array.isArray,Ft={H:null,A:null,T:null,S:null},ni=Object.prototype.hasOwnProperty;function qt(et,Kt,Di,Nt,wi,_r){return Di=_r.ref,{$$typeof:x,type:et,key:Kt,ref:Di!==void 0?Di:null,props:_r}}function Fi(et,Kt){return qt(et.type,Kt,void 0,void 0,void 0,et.props)}function ai(et){return typeof et=="object"&&et!==null&&et.$$typeof===x}function kt(et){var Kt={"=":"=0",":":"=2"};return"$"+et.replace(/[=:]/g,function(Di){return Kt[Di]})}var li=/\/+/g;function bn(et,Kt){return typeof et=="object"&&et!==null&&et.key!=null?kt(""+et.key):Kt.toString(36)}function Dr(){}function wn(et){switch(et.status){case"fulfilled":return et.value;case"rejected":throw et.reason;default:switch(typeof et.status=="string"?et.then(Dr,Dr):(et.status="pending",et.then(function(Kt){et.status==="pending"&&(et.status="fulfilled",et.value=Kt)},function(Kt){et.status==="pending"&&(et.status="rejected",et.reason=Kt)})),et.status){case"fulfilled":return et.value;case"rejected":throw et.reason}}throw et}function gi(et,Kt,Di,Nt,wi){var _r=typeof et;(_r==="undefined"||_r==="boolean")&&(et=null);var lr=!1;if(et===null)lr=!0;else switch(_r){case"bigint":case"string":case"number":lr=!0;break;case"object":switch(et.$$typeof){case x:case m:lr=!0;break;case ge:return lr=et._init,gi(lr(et._payload),Kt,Di,Nt,wi)}}if(lr)return wi=wi(et),lr=Nt===""?"."+bn(et,0):Nt,Mt(wi)?(Di="",lr!=null&&(Di=lr.replace(li,"$&/")+"/"),gi(wi,Kt,Di,"",function(nn){return nn})):wi!=null&&(ai(wi)&&(wi=Fi(wi,Di+(wi.key==null||et&&et.key===wi.key?"":(""+wi.key).replace(li,"$&/")+"/")+lr)),Kt.push(wi)),1;lr=0;var Cn=Nt===""?".":Nt+":";if(Mt(et))for(var gr=0;gr<et.length;gr++)Nt=et[gr],_r=Cn+bn(Nt,gr),lr+=gi(Nt,Kt,Di,_r,wi);else if(gr=Re(et),typeof gr=="function")for(et=gr.call(et),gr=0;!(Nt=et.next()).done;)Nt=Nt.value,_r=Cn+bn(Nt,gr++),lr+=gi(Nt,Kt,Di,_r,wi);else if(_r==="object"){if(typeof et.then=="function")return gi(wn(et),Kt,Di,Nt,wi);throw Kt=String(et),Error("Objects are not valid as a React child (found: "+(Kt==="[object Object]"?"object with keys {"+Object.keys(et).join(", ")+"}":Kt)+"). If you meant to render a collection of children, use an array instead.")}return lr}function ii(et,Kt,Di){if(et==null)return et;var Nt=[],wi=0;return gi(et,Nt,"","",function(_r){return Kt.call(Di,_r,wi++)}),Nt}function Xi(et){if(et._status===-1){var Kt=et._result;Kt=Kt(),Kt.then(function(Di){(et._status===0||et._status===-1)&&(et._status=1,et._result=Di)},function(Di){(et._status===0||et._status===-1)&&(et._status=2,et._result=Di)}),et._status===-1&&(et._status=0,et._result=Kt)}if(et._status===1)return et._result.default;throw et._result}var Bi=typeof reportError=="function"?reportError:function(et){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Kt=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof et=="object"&&et!==null&&typeof et.message=="string"?String(et.message):String(et),error:et});if(!window.dispatchEvent(Kt))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",et);return}console.error(et)};function ti(){}return br.Children={map:ii,forEach:function(et,Kt,Di){ii(et,function(){Kt.apply(this,arguments)},Di)},count:function(et){var Kt=0;return ii(et,function(){Kt++}),Kt},toArray:function(et){return ii(et,function(Kt){return Kt})||[]},only:function(et){if(!ai(et))throw Error("React.Children.only expected to receive a single React element child.");return et}},br.Component=pt,br.Fragment=w,br.Profiler=L,br.PureComponent=Et,br.StrictMode=M,br.Suspense=ae,br.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Ft,br.act=function(){throw Error("act(...) is not supported in production builds of React.")},br.cache=function(et){return function(){return et.apply(null,arguments)}},br.cloneElement=function(et,Kt,Di){if(et==null)throw Error("The argument must be a React element, but you passed "+et+".");var Nt=Qe({},et.props),wi=et.key,_r=void 0;if(Kt!=null)for(lr in Kt.ref!==void 0&&(_r=void 0),Kt.key!==void 0&&(wi=""+Kt.key),Kt)!ni.call(Kt,lr)||lr==="key"||lr==="__self"||lr==="__source"||lr==="ref"&&Kt.ref===void 0||(Nt[lr]=Kt[lr]);var lr=arguments.length-2;if(lr===1)Nt.children=Di;else if(1<lr){for(var Cn=Array(lr),gr=0;gr<lr;gr++)Cn[gr]=arguments[gr+2];Nt.children=Cn}return qt(et.type,wi,void 0,void 0,_r,Nt)},br.createContext=function(et){return et={$$typeof:W,_currentValue:et,_currentValue2:et,_threadCount:0,Provider:null,Consumer:null},et.Provider=et,et.Consumer={$$typeof:j,_context:et},et},br.createElement=function(et,Kt,Di){var Nt,wi={},_r=null;if(Kt!=null)for(Nt in Kt.key!==void 0&&(_r=""+Kt.key),Kt)ni.call(Kt,Nt)&&Nt!=="key"&&Nt!=="__self"&&Nt!=="__source"&&(wi[Nt]=Kt[Nt]);var lr=arguments.length-2;if(lr===1)wi.children=Di;else if(1<lr){for(var Cn=Array(lr),gr=0;gr<lr;gr++)Cn[gr]=arguments[gr+2];wi.children=Cn}if(et&&et.defaultProps)for(Nt in lr=et.defaultProps,lr)wi[Nt]===void 0&&(wi[Nt]=lr[Nt]);return qt(et,_r,void 0,void 0,null,wi)},br.createRef=function(){return{current:null}},br.forwardRef=function(et){return{$$typeof:n,render:et}},br.isValidElement=ai,br.lazy=function(et){return{$$typeof:ge,_payload:{_status:-1,_result:et},_init:Xi}},br.memo=function(et,Kt){return{$$typeof:ne,type:et,compare:Kt===void 0?null:Kt}},br.startTransition=function(et){var Kt=Ft.T,Di={};Ft.T=Di;try{var Nt=et(),wi=Ft.S;wi!==null&&wi(Di,Nt),typeof Nt=="object"&&Nt!==null&&typeof Nt.then=="function"&&Nt.then(ti,Bi)}catch(_r){Bi(_r)}finally{Ft.T=Kt}},br.unstable_useCacheRefresh=function(){return Ft.H.useCacheRefresh()},br.use=function(et){return Ft.H.use(et)},br.useActionState=function(et,Kt,Di){return Ft.H.useActionState(et,Kt,Di)},br.useCallback=function(et,Kt){return Ft.H.useCallback(et,Kt)},br.useContext=function(et){return Ft.H.useContext(et)},br.useDebugValue=function(){},br.useDeferredValue=function(et,Kt){return Ft.H.useDeferredValue(et,Kt)},br.useEffect=function(et,Kt){return Ft.H.useEffect(et,Kt)},br.useId=function(){return Ft.H.useId()},br.useImperativeHandle=function(et,Kt,Di){return Ft.H.useImperativeHandle(et,Kt,Di)},br.useInsertionEffect=function(et,Kt){return Ft.H.useInsertionEffect(et,Kt)},br.useLayoutEffect=function(et,Kt){return Ft.H.useLayoutEffect(et,Kt)},br.useMemo=function(et,Kt){return Ft.H.useMemo(et,Kt)},br.useOptimistic=function(et,Kt){return Ft.H.useOptimistic(et,Kt)},br.useReducer=function(et,Kt,Di){return Ft.H.useReducer(et,Kt,Di)},br.useRef=function(et){return Ft.H.useRef(et)},br.useState=function(et){return Ft.H.useState(et)},br.useSyncExternalStore=function(et,Kt,Di){return Ft.H.useSyncExternalStore(et,Kt,Di)},br.useTransition=function(){return Ft.H.useTransition()},br.version="19.0.0",br}var _1;function Cy(){return _1||(_1=1,$v.exports=GS()),$v.exports}var ip=Cy();const HS=Ay(ip);var Qv={exports:{}},B_={},Kv={exports:{}},Jv={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var g1;function ZS(){return g1||(g1=1,function(x){function m(ii,Xi){var Bi=ii.length;ii.push(Xi);e:for(;0<Bi;){var ti=Bi-1>>>1,et=ii[ti];if(0<L(et,Xi))ii[ti]=Xi,ii[Bi]=et,Bi=ti;else break e}}function w(ii){return ii.length===0?null:ii[0]}function M(ii){if(ii.length===0)return null;var Xi=ii[0],Bi=ii.pop();if(Bi!==Xi){ii[0]=Bi;e:for(var ti=0,et=ii.length,Kt=et>>>1;ti<Kt;){var Di=2*(ti+1)-1,Nt=ii[Di],wi=Di+1,_r=ii[wi];if(0>L(Nt,Bi))wi<et&&0>L(_r,Nt)?(ii[ti]=_r,ii[wi]=Bi,ti=wi):(ii[ti]=Nt,ii[Di]=Bi,ti=Di);else if(wi<et&&0>L(_r,Bi))ii[ti]=_r,ii[wi]=Bi,ti=wi;else break e}}return Xi}function L(ii,Xi){var Bi=ii.sortIndex-Xi.sortIndex;return Bi!==0?Bi:ii.id-Xi.id}if(x.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var j=performance;x.unstable_now=function(){return j.now()}}else{var W=Date,n=W.now();x.unstable_now=function(){return W.now()-n}}var ae=[],ne=[],ge=1,Ie=null,Re=3,je=!1,Qe=!1,tt=!1,pt=typeof setTimeout=="function"?setTimeout:null,$e=typeof clearTimeout=="function"?clearTimeout:null,Et=typeof setImmediate<"u"?setImmediate:null;function Tt(ii){for(var Xi=w(ne);Xi!==null;){if(Xi.callback===null)M(ne);else if(Xi.startTime<=ii)M(ne),Xi.sortIndex=Xi.expirationTime,m(ae,Xi);else break;Xi=w(ne)}}function Mt(ii){if(tt=!1,Tt(ii),!Qe)if(w(ae)!==null)Qe=!0,wn();else{var Xi=w(ne);Xi!==null&&gi(Mt,Xi.startTime-ii)}}var Ft=!1,ni=-1,qt=5,Fi=-1;function ai(){return!(x.unstable_now()-Fi<qt)}function kt(){if(Ft){var ii=x.unstable_now();Fi=ii;var Xi=!0;try{e:{Qe=!1,tt&&(tt=!1,$e(ni),ni=-1),je=!0;var Bi=Re;try{t:{for(Tt(ii),Ie=w(ae);Ie!==null&&!(Ie.expirationTime>ii&&ai());){var ti=Ie.callback;if(typeof ti=="function"){Ie.callback=null,Re=Ie.priorityLevel;var et=ti(Ie.expirationTime<=ii);if(ii=x.unstable_now(),typeof et=="function"){Ie.callback=et,Tt(ii),Xi=!0;break t}Ie===w(ae)&&M(ae),Tt(ii)}else M(ae);Ie=w(ae)}if(Ie!==null)Xi=!0;else{var Kt=w(ne);Kt!==null&&gi(Mt,Kt.startTime-ii),Xi=!1}}break e}finally{Ie=null,Re=Bi,je=!1}Xi=void 0}}finally{Xi?li():Ft=!1}}}var li;if(typeof Et=="function")li=function(){Et(kt)};else if(typeof MessageChannel<"u"){var bn=new MessageChannel,Dr=bn.port2;bn.port1.onmessage=kt,li=function(){Dr.postMessage(null)}}else li=function(){pt(kt,0)};function wn(){Ft||(Ft=!0,li())}function gi(ii,Xi){ni=pt(function(){ii(x.unstable_now())},Xi)}x.unstable_IdlePriority=5,x.unstable_ImmediatePriority=1,x.unstable_LowPriority=4,x.unstable_NormalPriority=3,x.unstable_Profiling=null,x.unstable_UserBlockingPriority=2,x.unstable_cancelCallback=function(ii){ii.callback=null},x.unstable_continueExecution=function(){Qe||je||(Qe=!0,wn())},x.unstable_forceFrameRate=function(ii){0>ii||125<ii?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):qt=0<ii?Math.floor(1e3/ii):5},x.unstable_getCurrentPriorityLevel=function(){return Re},x.unstable_getFirstCallbackNode=function(){return w(ae)},x.unstable_next=function(ii){switch(Re){case 1:case 2:case 3:var Xi=3;break;default:Xi=Re}var Bi=Re;Re=Xi;try{return ii()}finally{Re=Bi}},x.unstable_pauseExecution=function(){},x.unstable_requestPaint=function(){},x.unstable_runWithPriority=function(ii,Xi){switch(ii){case 1:case 2:case 3:case 4:case 5:break;default:ii=3}var Bi=Re;Re=ii;try{return Xi()}finally{Re=Bi}},x.unstable_scheduleCallback=function(ii,Xi,Bi){var ti=x.unstable_now();switch(typeof Bi=="object"&&Bi!==null?(Bi=Bi.delay,Bi=typeof Bi=="number"&&0<Bi?ti+Bi:ti):Bi=ti,ii){case 1:var et=-1;break;case 2:et=250;break;case 5:et=1073741823;break;case 4:et=1e4;break;default:et=5e3}return et=Bi+et,ii={id:ge++,callback:Xi,priorityLevel:ii,startTime:Bi,expirationTime:et,sortIndex:-1},Bi>ti?(ii.sortIndex=Bi,m(ne,ii),w(ae)===null&&ii===w(ne)&&(tt?($e(ni),ni=-1):tt=!0,gi(Mt,Bi-ti))):(ii.sortIndex=et,m(ae,ii),Qe||je||(Qe=!0,wn())),ii},x.unstable_shouldYield=ai,x.unstable_wrapCallback=function(ii){var Xi=Re;return function(){var Bi=Re;Re=Xi;try{return ii.apply(this,arguments)}finally{Re=Bi}}}}(Jv)),Jv}var y1;function XS(){return y1||(y1=1,Kv.exports=ZS()),Kv.exports}var e0={exports:{}},zs={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var v1;function YS(){if(v1)return zs;v1=1;var x=Cy();function m(ae){var ne="https://react.dev/errors/"+ae;if(1<arguments.length){ne+="?args[]="+encodeURIComponent(arguments[1]);for(var ge=2;ge<arguments.length;ge++)ne+="&args[]="+encodeURIComponent(arguments[ge])}return"Minified React error #"+ae+"; visit "+ne+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function w(){}var M={d:{f:w,r:function(){throw Error(m(522))},D:w,C:w,L:w,m:w,X:w,S:w,M:w},p:0,findDOMNode:null},L=Symbol.for("react.portal");function j(ae,ne,ge){var Ie=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:L,key:Ie==null?null:""+Ie,children:ae,containerInfo:ne,implementation:ge}}var W=x.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function n(ae,ne){if(ae==="font")return"";if(typeof ne=="string")return ne==="use-credentials"?ne:""}return zs.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=M,zs.createPortal=function(ae,ne){var ge=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!ne||ne.nodeType!==1&&ne.nodeType!==9&&ne.nodeType!==11)throw Error(m(299));return j(ae,ne,null,ge)},zs.flushSync=function(ae){var ne=W.T,ge=M.p;try{if(W.T=null,M.p=2,ae)return ae()}finally{W.T=ne,M.p=ge,M.d.f()}},zs.preconnect=function(ae,ne){typeof ae=="string"&&(ne?(ne=ne.crossOrigin,ne=typeof ne=="string"?ne==="use-credentials"?ne:"":void 0):ne=null,M.d.C(ae,ne))},zs.prefetchDNS=function(ae){typeof ae=="string"&&M.d.D(ae)},zs.preinit=function(ae,ne){if(typeof ae=="string"&&ne&&typeof ne.as=="string"){var ge=ne.as,Ie=n(ge,ne.crossOrigin),Re=typeof ne.integrity=="string"?ne.integrity:void 0,je=typeof ne.fetchPriority=="string"?ne.fetchPriority:void 0;ge==="style"?M.d.S(ae,typeof ne.precedence=="string"?ne.precedence:void 0,{crossOrigin:Ie,integrity:Re,fetchPriority:je}):ge==="script"&&M.d.X(ae,{crossOrigin:Ie,integrity:Re,fetchPriority:je,nonce:typeof ne.nonce=="string"?ne.nonce:void 0})}},zs.preinitModule=function(ae,ne){if(typeof ae=="string")if(typeof ne=="object"&&ne!==null){if(ne.as==null||ne.as==="script"){var ge=n(ne.as,ne.crossOrigin);M.d.M(ae,{crossOrigin:ge,integrity:typeof ne.integrity=="string"?ne.integrity:void 0,nonce:typeof ne.nonce=="string"?ne.nonce:void 0})}}else ne==null&&M.d.M(ae)},zs.preload=function(ae,ne){if(typeof ae=="string"&&typeof ne=="object"&&ne!==null&&typeof ne.as=="string"){var ge=ne.as,Ie=n(ge,ne.crossOrigin);M.d.L(ae,ge,{crossOrigin:Ie,integrity:typeof ne.integrity=="string"?ne.integrity:void 0,nonce:typeof ne.nonce=="string"?ne.nonce:void 0,type:typeof ne.type=="string"?ne.type:void 0,fetchPriority:typeof ne.fetchPriority=="string"?ne.fetchPriority:void 0,referrerPolicy:typeof ne.referrerPolicy=="string"?ne.referrerPolicy:void 0,imageSrcSet:typeof ne.imageSrcSet=="string"?ne.imageSrcSet:void 0,imageSizes:typeof ne.imageSizes=="string"?ne.imageSizes:void 0,media:typeof ne.media=="string"?ne.media:void 0})}},zs.preloadModule=function(ae,ne){if(typeof ae=="string")if(ne){var ge=n(ne.as,ne.crossOrigin);M.d.m(ae,{as:typeof ne.as=="string"&&ne.as!=="script"?ne.as:void 0,crossOrigin:ge,integrity:typeof ne.integrity=="string"?ne.integrity:void 0})}else M.d.m(ae)},zs.requestFormReset=function(ae){M.d.r(ae)},zs.unstable_batchedUpdates=function(ae,ne){return ae(ne)},zs.useFormState=function(ae,ne,ge){return W.H.useFormState(ae,ne,ge)},zs.useFormStatus=function(){return W.H.useHostTransitionStatus()},zs.version="19.0.0",zs}var x1;function WS(){if(x1)return e0.exports;x1=1;function x(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(x)}catch(m){console.error(m)}}return x(),e0.exports=YS(),e0.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var b1;function $S(){if(b1)return B_;b1=1;var x=XS(),m=Cy(),w=WS();function M(o){var f="https://react.dev/errors/"+o;if(1<arguments.length){f+="?args[]="+encodeURIComponent(arguments[1]);for(var y=2;y<arguments.length;y++)f+="&args[]="+encodeURIComponent(arguments[y])}return"Minified React error #"+o+"; visit "+f+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function L(o){return!(!o||o.nodeType!==1&&o.nodeType!==9&&o.nodeType!==11)}var j=Symbol.for("react.element"),W=Symbol.for("react.transitional.element"),n=Symbol.for("react.portal"),ae=Symbol.for("react.fragment"),ne=Symbol.for("react.strict_mode"),ge=Symbol.for("react.profiler"),Ie=Symbol.for("react.provider"),Re=Symbol.for("react.consumer"),je=Symbol.for("react.context"),Qe=Symbol.for("react.forward_ref"),tt=Symbol.for("react.suspense"),pt=Symbol.for("react.suspense_list"),$e=Symbol.for("react.memo"),Et=Symbol.for("react.lazy"),Tt=Symbol.for("react.offscreen"),Mt=Symbol.for("react.memo_cache_sentinel"),Ft=Symbol.iterator;function ni(o){return o===null||typeof o!="object"?null:(o=Ft&&o[Ft]||o["@@iterator"],typeof o=="function"?o:null)}var qt=Symbol.for("react.client.reference");function Fi(o){if(o==null)return null;if(typeof o=="function")return o.$$typeof===qt?null:o.displayName||o.name||null;if(typeof o=="string")return o;switch(o){case ae:return"Fragment";case n:return"Portal";case ge:return"Profiler";case ne:return"StrictMode";case tt:return"Suspense";case pt:return"SuspenseList"}if(typeof o=="object")switch(o.$$typeof){case je:return(o.displayName||"Context")+".Provider";case Re:return(o._context.displayName||"Context")+".Consumer";case Qe:var f=o.render;return o=o.displayName,o||(o=f.displayName||f.name||"",o=o!==""?"ForwardRef("+o+")":"ForwardRef"),o;case $e:return f=o.displayName||null,f!==null?f:Fi(o.type)||"Memo";case Et:f=o._payload,o=o._init;try{return Fi(o(f))}catch{}}return null}var ai=m.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,kt=Object.assign,li,bn;function Dr(o){if(li===void 0)try{throw Error()}catch(y){var f=y.stack.trim().match(/\n( *(at )?)/);li=f&&f[1]||"",bn=-1<y.stack.indexOf(`
    at`)?" (<anonymous>)":-1<y.stack.indexOf("@")?"@unknown:0:0":""}return`
`+li+o+bn}var wn=!1;function gi(o,f){if(!o||wn)return"";wn=!0;var y=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var I={DetermineComponentFrameRoot:function(){try{if(f){var $t=function(){throw Error()};if(Object.defineProperty($t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct($t,[])}catch(Lt){var xt=Lt}Reflect.construct(o,[],$t)}else{try{$t.call()}catch(Lt){xt=Lt}o.call($t.prototype)}}else{try{throw Error()}catch(Lt){xt=Lt}($t=o())&&typeof $t.catch=="function"&&$t.catch(function(){})}}catch(Lt){if(Lt&&xt&&typeof Lt.stack=="string")return[Lt.stack,xt.stack]}return[null,null]}};I.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var k=Object.getOwnPropertyDescriptor(I.DetermineComponentFrameRoot,"name");k&&k.configurable&&Object.defineProperty(I.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var G=I.DetermineComponentFrameRoot(),se=G[0],xe=G[1];if(se&&xe){var Ne=se.split(`
`),ot=xe.split(`
`);for(k=I=0;I<Ne.length&&!Ne[I].includes("DetermineComponentFrameRoot");)I++;for(;k<ot.length&&!ot[k].includes("DetermineComponentFrameRoot");)k++;if(I===Ne.length||k===ot.length)for(I=Ne.length-1,k=ot.length-1;1<=I&&0<=k&&Ne[I]!==ot[k];)k--;for(;1<=I&&0<=k;I--,k--)if(Ne[I]!==ot[k]){if(I!==1||k!==1)do if(I--,k--,0>k||Ne[I]!==ot[k]){var Pt=`
`+Ne[I].replace(" at new "," at ");return o.displayName&&Pt.includes("<anonymous>")&&(Pt=Pt.replace("<anonymous>",o.displayName)),Pt}while(1<=I&&0<=k);break}}}finally{wn=!1,Error.prepareStackTrace=y}return(y=o?o.displayName||o.name:"")?Dr(y):""}function ii(o){switch(o.tag){case 26:case 27:case 5:return Dr(o.type);case 16:return Dr("Lazy");case 13:return Dr("Suspense");case 19:return Dr("SuspenseList");case 0:case 15:return o=gi(o.type,!1),o;case 11:return o=gi(o.type.render,!1),o;case 1:return o=gi(o.type,!0),o;default:return""}}function Xi(o){try{var f="";do f+=ii(o),o=o.return;while(o);return f}catch(y){return`
Error generating stack: `+y.message+`
`+y.stack}}function Bi(o){var f=o,y=o;if(o.alternate)for(;f.return;)f=f.return;else{o=f;do f=o,(f.flags&4098)!==0&&(y=f.return),o=f.return;while(o)}return f.tag===3?y:null}function ti(o){if(o.tag===13){var f=o.memoizedState;if(f===null&&(o=o.alternate,o!==null&&(f=o.memoizedState)),f!==null)return f.dehydrated}return null}function et(o){if(Bi(o)!==o)throw Error(M(188))}function Kt(o){var f=o.alternate;if(!f){if(f=Bi(o),f===null)throw Error(M(188));return f!==o?null:o}for(var y=o,I=f;;){var k=y.return;if(k===null)break;var G=k.alternate;if(G===null){if(I=k.return,I!==null){y=I;continue}break}if(k.child===G.child){for(G=k.child;G;){if(G===y)return et(k),o;if(G===I)return et(k),f;G=G.sibling}throw Error(M(188))}if(y.return!==I.return)y=k,I=G;else{for(var se=!1,xe=k.child;xe;){if(xe===y){se=!0,y=k,I=G;break}if(xe===I){se=!0,I=k,y=G;break}xe=xe.sibling}if(!se){for(xe=G.child;xe;){if(xe===y){se=!0,y=G,I=k;break}if(xe===I){se=!0,I=G,y=k;break}xe=xe.sibling}if(!se)throw Error(M(189))}}if(y.alternate!==I)throw Error(M(190))}if(y.tag!==3)throw Error(M(188));return y.stateNode.current===y?o:f}function Di(o){var f=o.tag;if(f===5||f===26||f===27||f===6)return o;for(o=o.child;o!==null;){if(f=Di(o),f!==null)return f;o=o.sibling}return null}var Nt=Array.isArray,wi=w.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,_r={pending:!1,data:null,method:null,action:null},lr=[],Cn=-1;function gr(o){return{current:o}}function nn(o){0>Cn||(o.current=lr[Cn],lr[Cn]=null,Cn--)}function Ae(o,f){Cn++,lr[Cn]=o.current,o.current=f}var Ea=gr(null),to=gr(null),Pa=gr(null),Rt=gr(null);function kn(o,f){switch(Ae(Pa,f),Ae(to,o),Ae(Ea,null),o=f.nodeType,o){case 9:case 11:f=(f=f.documentElement)&&(f=f.namespaceURI)?Xm(f):0;break;default:if(o=o===8?f.parentNode:f,f=o.tagName,o=o.namespaceURI)o=Xm(o),f=Gp(o,f);else switch(f){case"svg":f=1;break;case"math":f=2;break;default:f=0}}nn(Ea),Ae(Ea,f)}function Dn(){nn(Ea),nn(to),nn(Pa)}function Jo(o){o.memoizedState!==null&&Ae(Rt,o);var f=Ea.current,y=Gp(f,o.type);f!==y&&(Ae(to,o),Ae(Ea,y))}function Yi(o){to.current===o&&(nn(Ea),nn(to)),Rt.current===o&&(nn(Rt),zh._currentValue=_r)}var Tn=Object.prototype.hasOwnProperty,ka=x.unstable_scheduleCallback,io=x.unstable_cancelCallback,Gl=x.unstable_shouldYield,Hl=x.unstable_requestPaint,Mi=x.unstable_now,ro=x.unstable_getCurrentPriorityLevel,us=x.unstable_ImmediatePriority,wo=x.unstable_UserBlockingPriority,Fn=x.unstable_NormalPriority,To=x.unstable_LowPriority,el=x.unstable_IdlePriority,zc=x.log,Oc=x.unstable_setDisableYieldValue,Bn=null,Kn=null;function Lc(o){if(Kn&&typeof Kn.onCommitFiberRoot=="function")try{Kn.onCommitFiberRoot(Bn,o,void 0,(o.current.flags&128)===128)}catch{}}function In(o){if(typeof zc=="function"&&Oc(o),Kn&&typeof Kn.setStrictMode=="function")try{Kn.setStrictMode(Bn,o)}catch{}}var Nn=Math.clz32?Math.clz32:Nh,Ri=Math.log,no=Math.LN2;function Nh(o){return o>>>=0,o===0?32:31-(Ri(o)/no|0)|0}var ha=128,hs=4194304;function fs(o){var f=o&42;if(f!==0)return f;switch(o&-o){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o&4194176;case 4194304:case 8388608:case 16777216:case 33554432:return o&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return o}}function So(o,f){var y=o.pendingLanes;if(y===0)return 0;var I=0,k=o.suspendedLanes,G=o.pingedLanes,se=o.warmLanes;o=o.finishedLanes!==0;var xe=y&134217727;return xe!==0?(y=xe&~k,y!==0?I=fs(y):(G&=xe,G!==0?I=fs(G):o||(se=xe&~se,se!==0&&(I=fs(se))))):(xe=y&~k,xe!==0?I=fs(xe):G!==0?I=fs(G):o||(se=y&~se,se!==0&&(I=fs(se)))),I===0?0:f!==0&&f!==I&&(f&k)===0&&(k=I&-I,se=f&-f,k>=se||k===32&&(se&4194176)!==0)?f:I}function ao(o,f){return(o.pendingLanes&~(o.suspendedLanes&~o.pingedLanes)&f)===0}function Vh(o,f){switch(o){case 1:case 2:case 4:case 8:return f+250;case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return f+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Zl(){var o=ha;return ha<<=1,(ha&4194176)===0&&(ha=128),o}function zu(){var o=hs;return hs<<=1,(hs&62914560)===0&&(hs=4194304),o}function Pc(o){for(var f=[],y=0;31>y;y++)f.push(o);return f}function Jr(o,f){o.pendingLanes|=f,f!==268435456&&(o.suspendedLanes=0,o.pingedLanes=0,o.warmLanes=0)}function Ou(o,f,y,I,k,G){var se=o.pendingLanes;o.pendingLanes=y,o.suspendedLanes=0,o.pingedLanes=0,o.warmLanes=0,o.expiredLanes&=y,o.entangledLanes&=y,o.errorRecoveryDisabledLanes&=y,o.shellSuspendCounter=0;var xe=o.entanglements,Ne=o.expirationTimes,ot=o.hiddenUpdates;for(y=se&~y;0<y;){var Pt=31-Nn(y),$t=1<<Pt;xe[Pt]=0,Ne[Pt]=-1;var xt=ot[Pt];if(xt!==null)for(ot[Pt]=null,Pt=0;Pt<xt.length;Pt++){var Lt=xt[Pt];Lt!==null&&(Lt.lane&=-536870913)}y&=~$t}I!==0&&Lu(o,I,0),G!==0&&k===0&&o.tag!==0&&(o.suspendedLanes|=G&~(se&~f))}function Lu(o,f,y){o.pendingLanes|=f,o.suspendedLanes&=~f;var I=31-Nn(f);o.entangledLanes|=f,o.entanglements[I]=o.entanglements[I]|1073741824|y&4194218}function kc(o,f){var y=o.entangledLanes|=f;for(o=o.entanglements;y;){var I=31-Nn(y),k=1<<I;k&f|o[I]&f&&(o[I]|=f),y&=~k}}function Vn(o){return o&=-o,2<o?8<o?(o&134217727)!==0?32:268435456:8:2}function Ls(){var o=wi.p;return o!==0?o:(o=window.event,o===void 0?32:Ig(o.type))}function We(o,f){var y=wi.p;try{return wi.p=o,f()}finally{wi.p=y}}var Q=Math.random().toString(36).slice(2),ie="__reactFiber$"+Q,oe="__reactProps$"+Q,ye="__reactContainer$"+Q,we="__reactEvents$"+Q,De="__reactListeners$"+Q,Ve="__reactHandles$"+Q,Oe="__reactResources$"+Q,Ze="__reactMarker$"+Q;function He(o){delete o[ie],delete o[oe],delete o[we],delete o[De],delete o[Ve]}function Xe(o){var f=o[ie];if(f)return f;for(var y=o.parentNode;y;){if(f=y[ye]||y[ie]){if(y=f.alternate,f.child!==null||y!==null&&y.child!==null)for(o=xg(o);o!==null;){if(y=o[ie])return y;o=xg(o)}return f}o=y,y=o.parentNode}return null}function ht(o){if(o=o[ie]||o[ye]){var f=o.tag;if(f===5||f===6||f===13||f===26||f===27||f===3)return o}return null}function At(o){var f=o.tag;if(f===5||f===26||f===27||f===6)return o.stateNode;throw Error(M(33))}function Dt(o){var f=o[Oe];return f||(f=o[Oe]={hoistableStyles:new Map,hoistableScripts:new Map}),f}function Jt(o){o[Ze]=!0}var fi=new Set,pi={};function si(o,f){ji(o,f),ji(o+"Capture",f)}function ji(o,f){for(pi[o]=f,o=0;o<f.length;o++)fi.add(f[o])}var qi=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ni=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),tr={},sr={};function un(o){return Tn.call(sr,o)?!0:Tn.call(tr,o)?!1:Ni.test(o)?sr[o]=!0:(tr[o]=!0,!1)}function Wa(o,f,y){if(un(f))if(y===null)o.removeAttribute(f);else{switch(typeof y){case"undefined":case"function":case"symbol":o.removeAttribute(f);return;case"boolean":var I=f.toLowerCase().slice(0,5);if(I!=="data-"&&I!=="aria-"){o.removeAttribute(f);return}}o.setAttribute(f,""+y)}}function an(o,f,y){if(y===null)o.removeAttribute(f);else{switch(typeof y){case"undefined":case"function":case"symbol":case"boolean":o.removeAttribute(f);return}o.setAttribute(f,""+y)}}function Gr(o,f,y,I){if(I===null)o.removeAttribute(y);else{switch(typeof I){case"undefined":case"function":case"symbol":case"boolean":o.removeAttribute(y);return}o.setAttributeNS(f,y,""+I)}}function $r(o){switch(typeof o){case"bigint":case"boolean":case"number":case"string":case"undefined":return o;case"object":return o;default:return""}}function Fc(o){var f=o.type;return(o=o.nodeName)&&o.toLowerCase()==="input"&&(f==="checkbox"||f==="radio")}function Eo(o){var f=Fc(o)?"checked":"value",y=Object.getOwnPropertyDescriptor(o.constructor.prototype,f),I=""+o[f];if(!o.hasOwnProperty(f)&&typeof y<"u"&&typeof y.get=="function"&&typeof y.set=="function"){var k=y.get,G=y.set;return Object.defineProperty(o,f,{configurable:!0,get:function(){return k.call(this)},set:function(se){I=""+se,G.call(this,se)}}),Object.defineProperty(o,f,{enumerable:y.enumerable}),{getValue:function(){return I},setValue:function(se){I=""+se},stopTracking:function(){o._valueTracker=null,delete o[f]}}}}function tl(o){o._valueTracker||(o._valueTracker=Eo(o))}function Uh(o){if(!o)return!1;var f=o._valueTracker;if(!f)return!0;var y=f.getValue(),I="";return o&&(I=Fc(o)?o.checked?"true":"false":o.value),o=I,o!==y?(f.setValue(o),!0):!1}function Pu(o){if(o=o||(typeof document<"u"?document:void 0),typeof o>"u")return null;try{return o.activeElement||o.body}catch{return o.body}}var $f=/[\n"\\]/g;function Fa(o){return o.replace($f,function(f){return"\\"+f.charCodeAt(0).toString(16)+" "})}function Jn(o,f,y,I,k,G,se,xe){o.name="",se!=null&&typeof se!="function"&&typeof se!="symbol"&&typeof se!="boolean"?o.type=se:o.removeAttribute("type"),f!=null?se==="number"?(f===0&&o.value===""||o.value!=f)&&(o.value=""+$r(f)):o.value!==""+$r(f)&&(o.value=""+$r(f)):se!=="submit"&&se!=="reset"||o.removeAttribute("value"),f!=null?Ps(o,se,$r(f)):y!=null?Ps(o,se,$r(y)):I!=null&&o.removeAttribute("value"),k==null&&G!=null&&(o.defaultChecked=!!G),k!=null&&(o.checked=k&&typeof k!="function"&&typeof k!="symbol"),xe!=null&&typeof xe!="function"&&typeof xe!="symbol"&&typeof xe!="boolean"?o.name=""+$r(xe):o.removeAttribute("name")}function ds(o,f,y,I,k,G,se,xe){if(G!=null&&typeof G!="function"&&typeof G!="symbol"&&typeof G!="boolean"&&(o.type=G),f!=null||y!=null){if(!(G!=="submit"&&G!=="reset"||f!=null))return;y=y!=null?""+$r(y):"",f=f!=null?""+$r(f):y,xe||f===o.value||(o.value=f),o.defaultValue=f}I=I??k,I=typeof I!="function"&&typeof I!="symbol"&&!!I,o.checked=xe?o.checked:!!I,o.defaultChecked=!!I,se!=null&&typeof se!="function"&&typeof se!="symbol"&&typeof se!="boolean"&&(o.name=se)}function Ps(o,f,y){f==="number"&&Pu(o.ownerDocument)===o||o.defaultValue===""+y||(o.defaultValue=""+y)}function Ma(o,f,y,I){if(o=o.options,f){f={};for(var k=0;k<y.length;k++)f["$"+y[k]]=!0;for(y=0;y<o.length;y++)k=f.hasOwnProperty("$"+o[y].value),o[y].selected!==k&&(o[y].selected=k),k&&I&&(o[y].defaultSelected=!0)}else{for(y=""+$r(y),f=null,k=0;k<o.length;k++){if(o[k].value===y){o[k].selected=!0,I&&(o[k].defaultSelected=!0);return}f!==null||o[k].disabled||(f=o[k])}f!==null&&(f.selected=!0)}}function ps(o,f,y){if(f!=null&&(f=""+$r(f),f!==o.value&&(o.value=f),y==null)){o.defaultValue!==f&&(o.defaultValue=f);return}o.defaultValue=y!=null?""+$r(y):""}function ks(o,f,y,I){if(f==null){if(I!=null){if(y!=null)throw Error(M(92));if(Nt(I)){if(1<I.length)throw Error(M(93));I=I[0]}y=I}y==null&&(y=""),f=y}y=$r(f),o.defaultValue=y,I=o.textContent,I===y&&I!==""&&I!==null&&(o.value=I)}function Mo(o,f){if(f){var y=o.firstChild;if(y&&y===o.lastChild&&y.nodeType===3){y.nodeValue=f;return}}o.textContent=f}var Qf=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Ao(o,f,y){var I=f.indexOf("--")===0;y==null||typeof y=="boolean"||y===""?I?o.setProperty(f,""):f==="float"?o.cssFloat="":o[f]="":I?o.setProperty(f,y):typeof y!="number"||y===0||Qf.has(f)?f==="float"?o.cssFloat=y:o[f]=(""+y).trim():o[f]=y+"px"}function Co(o,f,y){if(f!=null&&typeof f!="object")throw Error(M(62));if(o=o.style,y!=null){for(var I in y)!y.hasOwnProperty(I)||f!=null&&f.hasOwnProperty(I)||(I.indexOf("--")===0?o.setProperty(I,""):I==="float"?o.cssFloat="":o[I]="");for(var k in f)I=f[k],f.hasOwnProperty(k)&&y[k]!==I&&Ao(o,k,I)}else for(var G in f)f.hasOwnProperty(G)&&Ao(o,G,f[G])}function jh(o){if(o.indexOf("-")===-1)return!1;switch(o){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Kf=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),ms=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function nr(o){return ms.test(""+o)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":o}var ku=null;function di(o){return o=o.target||o.srcElement||window,o.correspondingUseElement&&(o=o.correspondingUseElement),o.nodeType===3?o.parentNode:o}var Xl=null,Do=null;function Fu(o){var f=ht(o);if(f&&(o=f.stateNode)){var y=o[oe]||null;e:switch(o=f.stateNode,f.type){case"input":if(Jn(o,y.value,y.defaultValue,y.defaultValue,y.checked,y.defaultChecked,y.type,y.name),f=y.name,y.type==="radio"&&f!=null){for(y=o;y.parentNode;)y=y.parentNode;for(y=y.querySelectorAll('input[name="'+Fa(""+f)+'"][type="radio"]'),f=0;f<y.length;f++){var I=y[f];if(I!==o&&I.form===o.form){var k=I[oe]||null;if(!k)throw Error(M(90));Jn(I,k.value,k.defaultValue,k.defaultValue,k.checked,k.defaultChecked,k.type,k.name)}}for(f=0;f<y.length;f++)I=y[f],I.form===o.form&&Uh(I)}break e;case"textarea":ps(o,y.value,y.defaultValue);break e;case"select":f=y.value,f!=null&&Ma(o,!!y.multiple,f,!1)}}}var Vi=!1;function Bu(o,f,y){if(Vi)return o(f,y);Vi=!0;try{var I=o(f);return I}finally{if(Vi=!1,(Xl!==null||Do!==null)&&(Cd(),Xl&&(f=Xl,o=Do,Do=Xl=null,Fu(f),o)))for(f=0;f<o.length;f++)Fu(o[f])}}function Fs(o,f){var y=o.stateNode;if(y===null)return null;var I=y[oe]||null;if(I===null)return null;y=I[f];e:switch(f){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(I=!I.disabled)||(o=o.type,I=!(o==="button"||o==="input"||o==="select"||o==="textarea")),o=!I;break e;default:o=!1}if(o)return null;if(y&&typeof y!="function")throw Error(M(231,f,typeof y));return y}var Qt=!1;if(qi)try{var or={};Object.defineProperty(or,"passive",{get:function(){Qt=!0}}),window.addEventListener("test",or,or),window.removeEventListener("test",or,or)}catch{Qt=!1}var Hi=null,Un=null,_s=null;function ar(){if(_s)return _s;var o,f=Un,y=f.length,I,k="value"in Hi?Hi.value:Hi.textContent,G=k.length;for(o=0;o<y&&f[o]===k[o];o++);var se=y-o;for(I=1;I<=se&&f[y-I]===k[G-I];I++);return _s=k.slice(o,1<I?1-I:void 0)}function il(o){var f=o.keyCode;return"charCode"in o?(o=o.charCode,o===0&&f===13&&(o=13)):o=f,o===10&&(o=13),32<=o||o===13?o:0}function $a(){return!0}function Bc(){return!1}function Or(o){function f(y,I,k,G,se){this._reactName=y,this._targetInst=k,this.type=I,this.nativeEvent=G,this.target=se,this.currentTarget=null;for(var xe in o)o.hasOwnProperty(xe)&&(y=o[xe],this[xe]=y?y(G):G[xe]);return this.isDefaultPrevented=(G.defaultPrevented!=null?G.defaultPrevented:G.returnValue===!1)?$a:Bc,this.isPropagationStopped=Bc,this}return kt(f.prototype,{preventDefault:function(){this.defaultPrevented=!0;var y=this.nativeEvent;y&&(y.preventDefault?y.preventDefault():typeof y.returnValue!="unknown"&&(y.returnValue=!1),this.isDefaultPrevented=$a)},stopPropagation:function(){var y=this.nativeEvent;y&&(y.stopPropagation?y.stopPropagation():typeof y.cancelBubble!="unknown"&&(y.cancelBubble=!0),this.isPropagationStopped=$a)},persist:function(){},isPersistent:$a}),f}var Lr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(o){return o.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Nc=Or(Lr),jn=kt({},Lr,{view:0,detail:0}),qh=Or(jn),Yl,Vc,Io,Rn=kt({},jn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:td,button:0,buttons:0,relatedTarget:function(o){return o.relatedTarget===void 0?o.fromElement===o.srcElement?o.toElement:o.fromElement:o.relatedTarget},movementX:function(o){return"movementX"in o?o.movementX:(o!==Io&&(Io&&o.type==="mousemove"?(Yl=o.screenX-Io.screenX,Vc=o.screenY-Io.screenY):Vc=Yl=0,Io=o),Yl)},movementY:function(o){return"movementY"in o?o.movementY:Vc}}),Bs=Or(Rn),ea=kt({},Rn,{dataTransfer:0}),Jf=Or(ea),Ro=kt({},jn,{relatedTarget:0}),Hr=Or(Ro),gs=kt({},Lr,{animationName:0,elapsedTime:0,pseudoElement:0}),qn=Or(gs),hn=kt({},Lr,{clipboardData:function(o){return"clipboardData"in o?o.clipboardData:window.clipboardData}}),Nu=Or(hn),Ns=kt({},Lr,{data:0}),rl=Or(Ns),Vu={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Vs={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ed={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function zo(o){var f=this.nativeEvent;return f.getModifierState?f.getModifierState(o):(o=ed[o])?!!f[o]:!1}function td(){return zo}var id=kt({},jn,{key:function(o){if(o.key){var f=Vu[o.key]||o.key;if(f!=="Unidentified")return f}return o.type==="keypress"?(o=il(o),o===13?"Enter":String.fromCharCode(o)):o.type==="keydown"||o.type==="keyup"?Vs[o.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:td,charCode:function(o){return o.type==="keypress"?il(o):0},keyCode:function(o){return o.type==="keydown"||o.type==="keyup"?o.keyCode:0},which:function(o){return o.type==="keypress"?il(o):o.type==="keydown"||o.type==="keyup"?o.keyCode:0}}),Aa=Or(id),rd=kt({},Rn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Uu=Or(rd),ju=kt({},jn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:td}),qu=Or(ju),Lm=kt({},Lr,{propertyName:0,elapsedTime:0,pseudoElement:0}),Pm=Or(Lm),Gu=kt({},Rn,{deltaX:function(o){return"deltaX"in o?o.deltaX:"wheelDeltaX"in o?-o.wheelDeltaX:0},deltaY:function(o){return"deltaY"in o?o.deltaY:"wheelDeltaY"in o?-o.wheelDeltaY:"wheelDelta"in o?-o.wheelDelta:0},deltaZ:0,deltaMode:0}),Hu=Or(Gu),km=kt({},Lr,{newState:0,oldState:0}),Uc=Or(km),nd=[9,13,27,32],Us=qi&&"CompositionEvent"in window,ys=null;qi&&"documentMode"in document&&(ys=document.documentMode);var Fm=qi&&"TextEvent"in window&&!ys,Gh=qi&&(!Us||ys&&8<ys&&11>=ys),up=" ",ad=!1;function hp(o,f){switch(o){case"keyup":return nd.indexOf(f.keyCode)!==-1;case"keydown":return f.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Hh(o){return o=o.detail,typeof o=="object"&&"data"in o?o.data:null}var vs=!1;function Ui(o,f){switch(o){case"compositionend":return Hh(f);case"keypress":return f.which!==32?null:(ad=!0,up);case"textInput":return o=f.data,o===up&&ad?null:o;default:return null}}function ci(o,f){if(vs)return o==="compositionend"||!Us&&hp(o,f)?(o=ar(),_s=Un=Hi=null,vs=!1,o):null;switch(o){case"paste":return null;case"keypress":if(!(f.ctrlKey||f.altKey||f.metaKey)||f.ctrlKey&&f.altKey){if(f.char&&1<f.char.length)return f.char;if(f.which)return String.fromCharCode(f.which)}return null;case"compositionend":return Gh&&f.locale!=="ko"?null:f.data;default:return null}}var Zh={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function vi(o){var f=o&&o.nodeName&&o.nodeName.toLowerCase();return f==="input"?!!Zh[o.type]:f==="textarea"}function Wl(o,f,y,I){Xl?Do?Do.push(I):Do=[I]:Xl=I,f=Od(f,"onChange"),0<f.length&&(y=new Nc("onChange","change",null,y,I),o.push({event:y,listeners:f}))}var nl=null,yi=null;function jc(o){pg(o,0)}function so(o){var f=At(o);if(Uh(f))return o}function Xh(o,f){if(o==="change")return f}var Zu=!1;if(qi){var fa;if(qi){var zn="oninput"in document;if(!zn){var zt=document.createElement("div");zt.setAttribute("oninput","return;"),zn=typeof zt.oninput=="function"}fa=zn}else fa=!1;Zu=fa&&(!document.documentMode||9<document.documentMode)}function Yh(){nl&&(nl.detachEvent("onpropertychange",Xu),yi=nl=null)}function Xu(o){if(o.propertyName==="value"&&so(yi)){var f=[];Wl(f,yi,o,di(o)),Bu(jc,f)}}function Yu(o,f,y){o==="focusin"?(Yh(),nl=f,yi=y,nl.attachEvent("onpropertychange",Xu)):o==="focusout"&&Yh()}function al(o){if(o==="selectionchange"||o==="keyup"||o==="keydown")return so(yi)}function Gn(o,f){if(o==="click")return so(f)}function Oo(o,f){if(o==="input"||o==="change")return so(f)}function sd(o,f){return o===f&&(o!==0||1/o===1/f)||o!==o&&f!==f}var Hn=typeof Object.is=="function"?Object.is:sd;function js(o,f){if(Hn(o,f))return!0;if(typeof o!="object"||o===null||typeof f!="object"||f===null)return!1;var y=Object.keys(o),I=Object.keys(f);if(y.length!==I.length)return!1;for(I=0;I<y.length;I++){var k=y[I];if(!Tn.call(f,k)||!Hn(o[k],f[k]))return!1}return!0}function sl(o){for(;o&&o.firstChild;)o=o.firstChild;return o}function Wh(o,f){var y=sl(o);o=0;for(var I;y;){if(y.nodeType===3){if(I=o+y.textContent.length,o<=f&&I>=f)return{node:y,offset:f-o};o=I}e:{for(;y;){if(y.nextSibling){y=y.nextSibling;break e}y=y.parentNode}y=void 0}y=sl(y)}}function fp(o,f){return o&&f?o===f?!0:o&&o.nodeType===3?!1:f&&f.nodeType===3?fp(o,f.parentNode):"contains"in o?o.contains(f):o.compareDocumentPosition?!!(o.compareDocumentPosition(f)&16):!1:!1}function $h(o){o=o!=null&&o.ownerDocument!=null&&o.ownerDocument.defaultView!=null?o.ownerDocument.defaultView:window;for(var f=Pu(o.document);f instanceof o.HTMLIFrameElement;){try{var y=typeof f.contentWindow.location.href=="string"}catch{y=!1}if(y)o=f.contentWindow;else break;f=Pu(o.document)}return f}function od(o){var f=o&&o.nodeName&&o.nodeName.toLowerCase();return f&&(f==="input"&&(o.type==="text"||o.type==="search"||o.type==="tel"||o.type==="url"||o.type==="password")||f==="textarea"||o.contentEditable==="true")}function dp(o,f){var y=$h(f);f=o.focusedElem;var I=o.selectionRange;if(y!==f&&f&&f.ownerDocument&&fp(f.ownerDocument.documentElement,f)){if(I!==null&&od(f)){if(o=I.start,y=I.end,y===void 0&&(y=o),"selectionStart"in f)f.selectionStart=o,f.selectionEnd=Math.min(y,f.value.length);else if(y=(o=f.ownerDocument||document)&&o.defaultView||window,y.getSelection){y=y.getSelection();var k=f.textContent.length,G=Math.min(I.start,k);I=I.end===void 0?G:Math.min(I.end,k),!y.extend&&G>I&&(k=I,I=G,G=k),k=Wh(f,G);var se=Wh(f,I);k&&se&&(y.rangeCount!==1||y.anchorNode!==k.node||y.anchorOffset!==k.offset||y.focusNode!==se.node||y.focusOffset!==se.offset)&&(o=o.createRange(),o.setStart(k.node,k.offset),y.removeAllRanges(),G>I?(y.addRange(o),y.extend(se.node,se.offset)):(o.setEnd(se.node,se.offset),y.addRange(o)))}}for(o=[],y=f;y=y.parentNode;)y.nodeType===1&&o.push({element:y,left:y.scrollLeft,top:y.scrollTop});for(typeof f.focus=="function"&&f.focus(),f=0;f<o.length;f++)y=o[f],y.element.scrollLeft=y.left,y.element.scrollTop=y.top}}var ld=qi&&"documentMode"in document&&11>=document.documentMode,ol=null,cd=null,qc=null,Lo=!1;function pp(o,f,y){var I=y.window===y?y.document:y.nodeType===9?y:y.ownerDocument;Lo||ol==null||ol!==Pu(I)||(I=ol,"selectionStart"in I&&od(I)?I={start:I.selectionStart,end:I.selectionEnd}:(I=(I.ownerDocument&&I.ownerDocument.defaultView||window).getSelection(),I={anchorNode:I.anchorNode,anchorOffset:I.anchorOffset,focusNode:I.focusNode,focusOffset:I.focusOffset}),qc&&js(qc,I)||(qc=I,I=Od(cd,"onSelect"),0<I.length&&(f=new Nc("onSelect","select",null,f,y),o.push({event:f,listeners:I}),f.target=ol)))}function ll(o,f){var y={};return y[o.toLowerCase()]=f.toLowerCase(),y["Webkit"+o]="webkit"+f,y["Moz"+o]="moz"+f,y}var cl={animationend:ll("Animation","AnimationEnd"),animationiteration:ll("Animation","AnimationIteration"),animationstart:ll("Animation","AnimationStart"),transitionrun:ll("Transition","TransitionRun"),transitionstart:ll("Transition","TransitionStart"),transitioncancel:ll("Transition","TransitionCancel"),transitionend:ll("Transition","TransitionEnd")},$l={},ud={};qi&&(ud=document.createElement("div").style,"AnimationEvent"in window||(delete cl.animationend.animation,delete cl.animationiteration.animation,delete cl.animationstart.animation),"TransitionEvent"in window||delete cl.transitionend.transition);function ta(o){if($l[o])return $l[o];if(!cl[o])return o;var f=cl[o],y;for(y in f)if(f.hasOwnProperty(y)&&y in ud)return $l[o]=f[y];return o}var Wu=ta("animationend"),Gc=ta("animationiteration"),$u=ta("animationstart"),ul=ta("transitionrun"),Qh=ta("transitionstart"),hd=ta("transitioncancel"),hl=ta("transitionend"),Ql=new Map,Hc="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll scrollEnd toggle touchMove waiting wheel".split(" ");function Ca(o,f){Ql.set(o,f),si(f,[o])}var ia=[],xs=0,fl=0;function dl(){for(var o=xs,f=fl=xs=0;f<o;){var y=ia[f];ia[f++]=null;var I=ia[f];ia[f++]=null;var k=ia[f];ia[f++]=null;var G=ia[f];if(ia[f++]=null,I!==null&&k!==null){var se=I.pending;se===null?k.next=k:(k.next=se.next,se.next=k),I.pending=k}G!==0&&pl(y,k,G)}}function Kl(o,f,y,I){ia[xs++]=o,ia[xs++]=f,ia[xs++]=y,ia[xs++]=I,fl|=I,o.lanes|=I,o=o.alternate,o!==null&&(o.lanes|=I)}function Jl(o,f,y,I){return Kl(o,f,y,I),Wi(o)}function Qa(o,f){return Kl(o,null,null,f),Wi(o)}function pl(o,f,y){o.lanes|=y;var I=o.alternate;I!==null&&(I.lanes|=y);for(var k=!1,G=o.return;G!==null;)G.childLanes|=y,I=G.alternate,I!==null&&(I.childLanes|=y),G.tag===22&&(o=G.stateNode,o===null||o._visibility&1||(k=!0)),o=G,G=G.return;k&&f!==null&&o.tag===3&&(G=o.stateNode,k=31-Nn(y),G=G.hiddenUpdates,o=G[k],o===null?G[k]=[f]:o.push(f),f.lane=y|536870912)}function Wi(o){if(50<kl)throw kl=0,bh=null,Error(M(185));for(var f=o.return;f!==null;)o=f,f=o.return;return o.tag===3?o.stateNode:null}var ec={},tc=new WeakMap;function Ka(o,f){if(typeof o=="object"&&o!==null){var y=tc.get(o);return y!==void 0?y:(f={value:o,source:f,stack:Xi(f)},tc.set(o,f),f)}return{value:o,source:f,stack:Xi(f)}}var ic=[],Zc=0,Er=null,Xc=0,Ba=[],Na=0,Po=null,oo=1,lo="";function rc(o,f){ic[Zc++]=Xc,ic[Zc++]=Er,Er=o,Xc=f}function Yc(o,f,y){Ba[Na++]=oo,Ba[Na++]=lo,Ba[Na++]=Po,Po=o;var I=oo;o=lo;var k=32-Nn(I)-1;I&=~(1<<k),y+=1;var G=32-Nn(f)+k;if(30<G){var se=k-k%5;G=(I&(1<<se)-1).toString(32),I>>=se,k-=se,oo=1<<32-Nn(f)+k|y<<k|I,lo=G+o}else oo=1<<G|y<<k|I,lo=o}function nc(o){o.return!==null&&(rc(o,1),Yc(o,1,0))}function Kh(o){for(;o===Er;)Er=ic[--Zc],ic[Zc]=null,Xc=ic[--Zc],ic[Zc]=null;for(;o===Po;)Po=Ba[--Na],Ba[Na]=null,lo=Ba[--Na],Ba[Na]=null,oo=Ba[--Na],Ba[Na]=null}var Zr=null,Zn=null,Mr=!1,Va=null,bs=!1,Qu=Error(M(519));function co(o){var f=Error(M(418,""));throw $c(Ka(f,o)),Qu}function Jh(o){var f=o.stateNode,y=o.type,I=o.memoizedProps;switch(f[ie]=o,f[oe]=I,y){case"dialog":Rr("cancel",f),Rr("close",f);break;case"iframe":case"object":case"embed":Rr("load",f);break;case"video":case"audio":for(y=0;y<zd.length;y++)Rr(zd[y],f);break;case"source":Rr("error",f);break;case"img":case"image":case"link":Rr("error",f),Rr("load",f);break;case"details":Rr("toggle",f);break;case"input":Rr("invalid",f),ds(f,I.value,I.defaultValue,I.checked,I.defaultChecked,I.type,I.name,!0),tl(f);break;case"select":Rr("invalid",f);break;case"textarea":Rr("invalid",f),ks(f,I.value,I.defaultValue,I.children),tl(f)}y=I.children,typeof y!="string"&&typeof y!="number"&&typeof y!="bigint"||f.textContent===""+y||I.suppressHydrationWarning===!0||Ah(f.textContent,y)?(I.popover!=null&&(Rr("beforetoggle",f),Rr("toggle",f)),I.onScroll!=null&&Rr("scroll",f),I.onScrollEnd!=null&&Rr("scrollend",f),I.onClick!=null&&(f.onclick=Nl),f=!0):f=!1,f||co(o)}function ef(o){for(Zr=o.return;Zr;)switch(Zr.tag){case 3:case 27:bs=!0;return;case 5:case 13:bs=!1;return;default:Zr=Zr.return}}function ml(o){if(o!==Zr)return!1;if(!Mr)return ef(o),Mr=!0,!1;var f=!1,y;if((y=o.tag!==3&&o.tag!==27)&&((y=o.tag===5)&&(y=o.type,y=!(y!=="form"&&y!=="button")||Pd(o.type,o.memoizedProps)),y=!y),y&&(f=!0),f&&Zn&&co(o),ef(o),o.tag===13){if(o=o.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(M(317));e:{for(o=o.nextSibling,f=0;o;){if(o.nodeType===8)if(y=o.data,y==="/$"){if(f===0){Zn=Wo(o.nextSibling);break e}f--}else y!=="$"&&y!=="$!"&&y!=="$?"||f++;o=o.nextSibling}Zn=null}}else Zn=Zr?Wo(o.stateNode.nextSibling):null;return!0}function Wc(){Zn=Zr=null,Mr=!1}function $c(o){Va===null?Va=[o]:Va.push(o)}var uo=Error(M(460)),mp=Error(M(474)),fd={then:function(){}};function _p(o){return o=o.status,o==="fulfilled"||o==="rejected"}function tf(){}function gp(o,f,y){switch(y=o[y],y===void 0?o.push(f):y!==f&&(f.then(tf,tf),f=y),f.status){case"fulfilled":return f.value;case"rejected":throw o=f.reason,o===uo?Error(M(483)):o;default:if(typeof f.status=="string")f.then(tf,tf);else{if(o=mi,o!==null&&100<o.shellSuspendCounter)throw Error(M(482));o=f,o.status="pending",o.then(function(I){if(f.status==="pending"){var k=f;k.status="fulfilled",k.value=I}},function(I){if(f.status==="pending"){var k=f;k.status="rejected",k.reason=I}})}switch(f.status){case"fulfilled":return f.value;case"rejected":throw o=f.reason,o===uo?Error(M(483)):o}throw Ku=f,uo}}var Ku=null;function rf(){if(Ku===null)throw Error(M(459));var o=Ku;return Ku=null,o}var _l=null,gl=0;function ko(o){var f=gl;return gl+=1,_l===null&&(_l=[]),gp(_l,o,f)}function ac(o,f){f=f.props.ref,o.ref=f!==void 0?f:null}function Ju(o,f){throw f.$$typeof===j?Error(M(525)):(o=Object.prototype.toString.call(f),Error(M(31,o==="[object Object]"?"object with keys {"+Object.keys(f).join(", ")+"}":o)))}function dd(o){var f=o._init;return f(o._payload)}function nf(o){function f(ft,rt){if(o){var _t=ft.deletions;_t===null?(ft.deletions=[rt],ft.flags|=16):_t.push(rt)}}function y(ft,rt){if(!o)return null;for(;rt!==null;)f(ft,rt),rt=rt.sibling;return null}function I(ft){for(var rt=new Map;ft!==null;)ft.key!==null?rt.set(ft.key,ft):rt.set(ft.index,ft),ft=ft.sibling;return rt}function k(ft,rt){return ft=St(ft,rt),ft.index=0,ft.sibling=null,ft}function G(ft,rt,_t){return ft.index=_t,o?(_t=ft.alternate,_t!==null?(_t=_t.index,_t<rt?(ft.flags|=33554434,rt):_t):(ft.flags|=33554434,rt)):(ft.flags|=1048576,rt)}function se(ft){return o&&ft.alternate===null&&(ft.flags|=33554434),ft}function xe(ft,rt,_t,Ht){return rt===null||rt.tag!==6?(rt=Vt(_t,ft.mode,Ht),rt.return=ft,rt):(rt=k(rt,_t),rt.return=ft,rt)}function Ne(ft,rt,_t,Ht){var Ii=_t.type;return Ii===ae?Pt(ft,rt,_t.props.children,Ht,_t.key):rt!==null&&(rt.elementType===Ii||typeof Ii=="object"&&Ii!==null&&Ii.$$typeof===Et&&dd(Ii)===rt.type)?(rt=k(rt,_t.props),ac(rt,_t),rt.return=ft,rt):(rt=ct(_t.type,_t.key,_t.props,null,ft.mode,Ht),ac(rt,_t),rt.return=ft,rt)}function ot(ft,rt,_t,Ht){return rt===null||rt.tag!==4||rt.stateNode.containerInfo!==_t.containerInfo||rt.stateNode.implementation!==_t.implementation?(rt=Yt(_t,ft.mode,Ht),rt.return=ft,rt):(rt=k(rt,_t.children||[]),rt.return=ft,rt)}function Pt(ft,rt,_t,Ht,Ii){return rt===null||rt.tag!==7?(rt=vt(_t,ft.mode,Ht,Ii),rt.return=ft,rt):(rt=k(rt,_t),rt.return=ft,rt)}function $t(ft,rt,_t){if(typeof rt=="string"&&rt!==""||typeof rt=="number"||typeof rt=="bigint")return rt=Vt(""+rt,ft.mode,_t),rt.return=ft,rt;if(typeof rt=="object"&&rt!==null){switch(rt.$$typeof){case W:return _t=ct(rt.type,rt.key,rt.props,null,ft.mode,_t),ac(_t,rt),_t.return=ft,_t;case n:return rt=Yt(rt,ft.mode,_t),rt.return=ft,rt;case Et:var Ht=rt._init;return rt=Ht(rt._payload),$t(ft,rt,_t)}if(Nt(rt)||ni(rt))return rt=vt(rt,ft.mode,_t,null),rt.return=ft,rt;if(typeof rt.then=="function")return $t(ft,ko(rt),_t);if(rt.$$typeof===je)return $t(ft,Tf(ft,rt),_t);Ju(ft,rt)}return null}function xt(ft,rt,_t,Ht){var Ii=rt!==null?rt.key:null;if(typeof _t=="string"&&_t!==""||typeof _t=="number"||typeof _t=="bigint")return Ii!==null?null:xe(ft,rt,""+_t,Ht);if(typeof _t=="object"&&_t!==null){switch(_t.$$typeof){case W:return _t.key===Ii?Ne(ft,rt,_t,Ht):null;case n:return _t.key===Ii?ot(ft,rt,_t,Ht):null;case Et:return Ii=_t._init,_t=Ii(_t._payload),xt(ft,rt,_t,Ht)}if(Nt(_t)||ni(_t))return Ii!==null?null:Pt(ft,rt,_t,Ht,null);if(typeof _t.then=="function")return xt(ft,rt,ko(_t),Ht);if(_t.$$typeof===je)return xt(ft,rt,Tf(ft,_t),Ht);Ju(ft,_t)}return null}function Lt(ft,rt,_t,Ht,Ii){if(typeof Ht=="string"&&Ht!==""||typeof Ht=="number"||typeof Ht=="bigint")return ft=ft.get(_t)||null,xe(rt,ft,""+Ht,Ii);if(typeof Ht=="object"&&Ht!==null){switch(Ht.$$typeof){case W:return ft=ft.get(Ht.key===null?_t:Ht.key)||null,Ne(rt,ft,Ht,Ii);case n:return ft=ft.get(Ht.key===null?_t:Ht.key)||null,ot(rt,ft,Ht,Ii);case Et:var ur=Ht._init;return Ht=ur(Ht._payload),Lt(ft,rt,_t,Ht,Ii)}if(Nt(Ht)||ni(Ht))return ft=ft.get(_t)||null,Pt(rt,ft,Ht,Ii,null);if(typeof Ht.then=="function")return Lt(ft,rt,_t,ko(Ht),Ii);if(Ht.$$typeof===je)return Lt(ft,rt,_t,Tf(rt,Ht),Ii);Ju(rt,Ht)}return null}function Li(ft,rt,_t,Ht){for(var Ii=null,ur=null,Gi=rt,er=rt=0,_a=null;Gi!==null&&er<_t.length;er++){Gi.index>er?(_a=Gi,Gi=null):_a=Gi.sibling;var Br=xt(ft,Gi,_t[er],Ht);if(Br===null){Gi===null&&(Gi=_a);break}o&&Gi&&Br.alternate===null&&f(ft,Gi),rt=G(Br,rt,er),ur===null?Ii=Br:ur.sibling=Br,ur=Br,Gi=_a}if(er===_t.length)return y(ft,Gi),Mr&&rc(ft,er),Ii;if(Gi===null){for(;er<_t.length;er++)Gi=$t(ft,_t[er],Ht),Gi!==null&&(rt=G(Gi,rt,er),ur===null?Ii=Gi:ur.sibling=Gi,ur=Gi);return Mr&&rc(ft,er),Ii}for(Gi=I(Gi);er<_t.length;er++)_a=Lt(Gi,ft,er,_t[er],Ht),_a!==null&&(o&&_a.alternate!==null&&Gi.delete(_a.key===null?er:_a.key),rt=G(_a,rt,er),ur===null?Ii=_a:ur.sibling=_a,ur=_a);return o&&Gi.forEach(function(Cu){return f(ft,Cu)}),Mr&&rc(ft,er),Ii}function dr(ft,rt,_t,Ht){if(_t==null)throw Error(M(151));for(var Ii=null,ur=null,Gi=rt,er=rt=0,_a=null,Br=_t.next();Gi!==null&&!Br.done;er++,Br=_t.next()){Gi.index>er?(_a=Gi,Gi=null):_a=Gi.sibling;var Cu=xt(ft,Gi,Br.value,Ht);if(Cu===null){Gi===null&&(Gi=_a);break}o&&Gi&&Cu.alternate===null&&f(ft,Gi),rt=G(Cu,rt,er),ur===null?Ii=Cu:ur.sibling=Cu,ur=Cu,Gi=_a}if(Br.done)return y(ft,Gi),Mr&&rc(ft,er),Ii;if(Gi===null){for(;!Br.done;er++,Br=_t.next())Br=$t(ft,Br.value,Ht),Br!==null&&(rt=G(Br,rt,er),ur===null?Ii=Br:ur.sibling=Br,ur=Br);return Mr&&rc(ft,er),Ii}for(Gi=I(Gi);!Br.done;er++,Br=_t.next())Br=Lt(Gi,ft,er,Br.value,Ht),Br!==null&&(o&&Br.alternate!==null&&Gi.delete(Br.key===null?er:Br.key),rt=G(Br,rt,er),ur===null?Ii=Br:ur.sibling=Br,ur=Br);return o&&Gi.forEach(function(nv){return f(ft,nv)}),Mr&&rc(ft,er),Ii}function En(ft,rt,_t,Ht){if(typeof _t=="object"&&_t!==null&&_t.type===ae&&_t.key===null&&(_t=_t.props.children),typeof _t=="object"&&_t!==null){switch(_t.$$typeof){case W:e:{for(var Ii=_t.key;rt!==null;){if(rt.key===Ii){if(Ii=_t.type,Ii===ae){if(rt.tag===7){y(ft,rt.sibling),Ht=k(rt,_t.props.children),Ht.return=ft,ft=Ht;break e}}else if(rt.elementType===Ii||typeof Ii=="object"&&Ii!==null&&Ii.$$typeof===Et&&dd(Ii)===rt.type){y(ft,rt.sibling),Ht=k(rt,_t.props),ac(Ht,_t),Ht.return=ft,ft=Ht;break e}y(ft,rt);break}else f(ft,rt);rt=rt.sibling}_t.type===ae?(Ht=vt(_t.props.children,ft.mode,Ht,_t.key),Ht.return=ft,ft=Ht):(Ht=ct(_t.type,_t.key,_t.props,null,ft.mode,Ht),ac(Ht,_t),Ht.return=ft,ft=Ht)}return se(ft);case n:e:{for(Ii=_t.key;rt!==null;){if(rt.key===Ii)if(rt.tag===4&&rt.stateNode.containerInfo===_t.containerInfo&&rt.stateNode.implementation===_t.implementation){y(ft,rt.sibling),Ht=k(rt,_t.children||[]),Ht.return=ft,ft=Ht;break e}else{y(ft,rt);break}else f(ft,rt);rt=rt.sibling}Ht=Yt(_t,ft.mode,Ht),Ht.return=ft,ft=Ht}return se(ft);case Et:return Ii=_t._init,_t=Ii(_t._payload),En(ft,rt,_t,Ht)}if(Nt(_t))return Li(ft,rt,_t,Ht);if(ni(_t)){if(Ii=ni(_t),typeof Ii!="function")throw Error(M(150));return _t=Ii.call(_t),dr(ft,rt,_t,Ht)}if(typeof _t.then=="function")return En(ft,rt,ko(_t),Ht);if(_t.$$typeof===je)return En(ft,rt,Tf(ft,_t),Ht);Ju(ft,_t)}return typeof _t=="string"&&_t!==""||typeof _t=="number"||typeof _t=="bigint"?(_t=""+_t,rt!==null&&rt.tag===6?(y(ft,rt.sibling),Ht=k(rt,_t),Ht.return=ft,ft=Ht):(y(ft,rt),Ht=Vt(_t,ft.mode,Ht),Ht.return=ft,ft=Ht),se(ft)):y(ft,rt)}return function(ft,rt,_t,Ht){try{gl=0;var Ii=En(ft,rt,_t,Ht);return _l=null,Ii}catch(Gi){if(Gi===uo)throw Gi;var ur=st(29,Gi,null,ft.mode);return ur.lanes=Ht,ur.return=ft,ur}finally{}}}var Ua=nf(!0),af=nf(!1),ra=gr(null),sc=gr(0);function Qc(o,f){o=sn,Ae(sc,o),Ae(ra,f),sn=o|f.baseLanes}function sf(){Ae(sc,sn),Ae(ra,ra.current)}function Kc(){sn=sc.current,nn(ra),nn(sc)}var ga=gr(null),ws=null;function yl(o){var f=o.alternate;Ae(Xn,Xn.current&1),Ae(ga,o),ws===null&&(f===null||ra.current!==null||f.memoizedState!==null)&&(ws=o)}function of(o){if(o.tag===22){if(Ae(Xn,Xn.current),Ae(ga,o),ws===null){var f=o.alternate;f!==null&&f.memoizedState!==null&&(ws=o)}}else Ja()}function Ja(){Ae(Xn,Xn.current),Ae(ga,ga.current)}function Fo(o){nn(ga),ws===o&&(ws=null),nn(Xn)}var Xn=gr(0);function eh(o){for(var f=o;f!==null;){if(f.tag===13){var y=f.memoizedState;if(y!==null&&(y=y.dehydrated,y===null||y.data==="$?"||y.data==="$!"))return f}else if(f.tag===19&&f.memoizedProps.revealOrder!==void 0){if((f.flags&128)!==0)return f}else if(f.child!==null){f.child.return=f,f=f.child;continue}if(f===o)break;for(;f.sibling===null;){if(f.return===null||f.return===o)return null;f=f.return}f.sibling.return=f.return,f=f.sibling}return null}var yp=typeof AbortController<"u"?AbortController:function(){var o=[],f=this.signal={aborted:!1,addEventListener:function(y,I){o.push(I)}};this.abort=function(){f.aborted=!0,o.forEach(function(y){return y()})}},lf=x.unstable_scheduleCallback,Jc=x.unstable_NormalPriority,fn={$$typeof:je,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function eu(){return{controller:new yp,data:new Map,refCount:0}}function Bo(o){o.refCount--,o.refCount===0&&lf(Jc,function(){o.controller.abort()})}var tu=null,oc=0,ho=0,vl=null;function vp(o,f){if(tu===null){var y=tu=[];oc=0,ho=Bp(),vl={status:"pending",value:void 0,then:function(I){y.push(I)}}}return oc++,f.then(xp,xp),f}function xp(){if(--oc===0&&tu!==null){vl!==null&&(vl.status="fulfilled");var o=tu;tu=null,ho=0,vl=null;for(var f=0;f<o.length;f++)(0,o[f])()}}function lc(o,f){var y=[],I={status:"pending",value:null,reason:null,then:function(k){y.push(k)}};return o.then(function(){I.status="fulfilled",I.value=f;for(var k=0;k<y.length;k++)(0,y[k])(f)},function(k){for(I.status="rejected",I.reason=k,k=0;k<y.length;k++)(0,y[k])(void 0)}),I}var th=ai.S;ai.S=function(o,f){typeof f=="object"&&f!==null&&typeof f.then=="function"&&vp(o,f),th!==null&&th(o,f)};var Zt=gr(null);function ih(){var o=Zt.current;return o!==null?o:mi.pooledCache}function iu(o,f){f===null?Ae(Zt,Zt.current):Ae(Zt,f.pool)}function No(){var o=ih();return o===null?null:{parent:fn._currentValue,pool:o}}var ja=0,It=null,Ur=null,On=null,cf=!1,Vo=!1,Uo=!1,ru=0,nu=0,xl=null,rh=0;function dn(){throw Error(M(321))}function nh(o,f){if(f===null)return!1;for(var y=0;y<f.length&&y<o.length;y++)if(!Hn(o[y],f[y]))return!1;return!0}function Ts(o,f,y,I,k,G){return ja=G,It=f,f.memoizedState=null,f.updateQueue=null,f.lanes=0,ai.H=o===null||o.memoizedState===null?Hs:Ia,Uo=!1,G=y(I,k),Uo=!1,Vo&&(G=jo(f,y,I,k)),Da(o),G}function Da(o){ai.H=Ms;var f=Ur!==null&&Ur.next!==null;if(ja=0,On=Ur=It=null,cf=!1,nu=0,xl=null,f)throw Error(M(300));o===null||Wn||(o=o.dependencies,o!==null&&go(o)&&(Wn=!0))}function jo(o,f,y,I){It=o;var k=0;do{if(Vo&&(xl=null),nu=0,Vo=!1,25<=k)throw Error(M(301));if(k+=1,On=Ur=null,o.updateQueue!=null){var G=o.updateQueue;G.lastEffect=null,G.events=null,G.stores=null,G.memoCache!=null&&(G.memoCache.index=0)}ai.H=mo,G=f(y,I)}while(Vo);return G}function pd(){var o=ai.H,f=o.useState()[0];return f=typeof f.then=="function"?wl(f):f,o=o.useState()[0],(Ur!==null?Ur.memoizedState:null)!==o&&(It.flags|=1024),f}function ah(){var o=ru!==0;return ru=0,o}function bl(o,f,y){f.updateQueue=o.updateQueue,f.flags&=-2053,o.lanes&=~y}function au(o){if(cf){for(o=o.memoizedState;o!==null;){var f=o.queue;f!==null&&(f.pending=null),o=o.next}cf=!1}ja=0,On=Ur=It=null,Vo=!1,nu=ru=0,xl=null}function na(){var o={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return On===null?It.memoizedState=On=o:On=On.next=o,On}function Pr(){if(Ur===null){var o=It.alternate;o=o!==null?o.memoizedState:null}else o=Ur.next;var f=On===null?It.memoizedState:On.next;if(f!==null)On=f,Ur=o;else{if(o===null)throw It.alternate===null?Error(M(467)):Error(M(310));Ur=o,o={memoizedState:Ur.memoizedState,baseState:Ur.baseState,baseQueue:Ur.baseQueue,queue:Ur.queue,next:null},On===null?It.memoizedState=On=o:On=On.next=o}return On}var wr;wr=function(){return{lastEffect:null,events:null,stores:null,memoCache:null}};function wl(o){var f=nu;return nu+=1,xl===null&&(xl=[]),o=gp(xl,o,f),f=It,(On===null?f.memoizedState:On.next)===null&&(f=f.alternate,ai.H=f===null||f.memoizedState===null?Hs:Ia),o}function Tl(o){if(o!==null&&typeof o=="object"){if(typeof o.then=="function")return wl(o);if(o.$$typeof===je)return ya(o)}throw Error(M(438,String(o)))}function su(o){var f=null,y=It.updateQueue;if(y!==null&&(f=y.memoCache),f==null){var I=It.alternate;I!==null&&(I=I.updateQueue,I!==null&&(I=I.memoCache,I!=null&&(f={data:I.data.map(function(k){return k.slice()}),index:0})))}if(f==null&&(f={data:[],index:0}),y===null&&(y=wr(),It.updateQueue=y),y.memoCache=f,y=f.data[f.index],y===void 0)for(y=f.data[f.index]=Array(o),I=0;I<o;I++)y[I]=Mt;return f.index++,y}function qs(o,f){return typeof f=="function"?f(o):f}function Sl(o){var f=Pr();return El(f,Ur,o)}function El(o,f,y){var I=o.queue;if(I===null)throw Error(M(311));I.lastRenderedReducer=y;var k=o.baseQueue,G=I.pending;if(G!==null){if(k!==null){var se=k.next;k.next=G.next,G.next=se}f.baseQueue=k=G,I.pending=null}if(G=o.baseState,k===null)o.memoizedState=G;else{f=k.next;var xe=se=null,Ne=null,ot=f,Pt=!1;do{var $t=ot.lane&-536870913;if($t!==ot.lane?(_i&$t)===$t:(ja&$t)===$t){var xt=ot.revertLane;if(xt===0)Ne!==null&&(Ne=Ne.next={lane:0,revertLane:0,action:ot.action,hasEagerState:ot.hasEagerState,eagerState:ot.eagerState,next:null}),$t===ho&&(Pt=!0);else if((ja&xt)===xt){ot=ot.next,xt===ho&&(Pt=!0);continue}else $t={lane:0,revertLane:ot.revertLane,action:ot.action,hasEagerState:ot.hasEagerState,eagerState:ot.eagerState,next:null},Ne===null?(xe=Ne=$t,se=G):Ne=Ne.next=$t,It.lanes|=xt,fr|=xt;$t=ot.action,Uo&&y(G,$t),G=ot.hasEagerState?ot.eagerState:y(G,$t)}else xt={lane:$t,revertLane:ot.revertLane,action:ot.action,hasEagerState:ot.hasEagerState,eagerState:ot.eagerState,next:null},Ne===null?(xe=Ne=xt,se=G):Ne=Ne.next=xt,It.lanes|=$t,fr|=$t;ot=ot.next}while(ot!==null&&ot!==f);if(Ne===null?se=G:Ne.next=xe,!Hn(G,o.memoizedState)&&(Wn=!0,Pt&&(y=vl,y!==null)))throw y;o.memoizedState=G,o.baseState=se,o.baseQueue=Ne,I.lastRenderedState=G}return k===null&&(I.lanes=0),[o.memoizedState,I.dispatch]}function Ml(o){var f=Pr(),y=f.queue;if(y===null)throw Error(M(311));y.lastRenderedReducer=o;var I=y.dispatch,k=y.pending,G=f.memoizedState;if(k!==null){y.pending=null;var se=k=k.next;do G=o(G,se.action),se=se.next;while(se!==k);Hn(G,f.memoizedState)||(Wn=!0),f.memoizedState=G,f.baseQueue===null&&(f.baseState=G),y.lastRenderedState=G}return[G,I]}function cc(o,f,y){var I=It,k=Pr(),G=Mr;if(G){if(y===void 0)throw Error(M(407));y=y()}else y=f();var se=!Hn((Ur||k).memoizedState,y);if(se&&(k.memoizedState=y,Wn=!0),k=k.queue,_n(uc.bind(null,I,k,o),[o]),k.getSnapshot!==f||se||On!==null&&On.memoizedState.tag&1){if(I.flags|=2048,Ss(9,Gt.bind(null,I,k,y,f),{destroy:void 0},null),mi===null)throw Error(M(349));G||(ja&60)!==0||wt(I,f,y)}return y}function wt(o,f,y){o.flags|=16384,o={getSnapshot:f,value:y},f=It.updateQueue,f===null?(f=wr(),It.updateQueue=f,f.stores=[o]):(y=f.stores,y===null?f.stores=[o]:y.push(o))}function Gt(o,f,y,I){f.value=y,f.getSnapshot=I,jr(f)&&Ge(o)}function uc(o,f,y){return y(function(){jr(f)&&Ge(o)})}function jr(o){var f=o.getSnapshot;o=o.value;try{var y=f();return!Hn(o,y)}catch{return!0}}function Ge(o){var f=Qa(o,2);f!==null&&os(f,o,2)}function uf(o){var f=na();if(typeof o=="function"){var y=o;if(o=y(),Uo){In(!0);try{y()}finally{In(!1)}}}return f.memoizedState=f.baseState=o,f.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:qs,lastRenderedState:o},f}function sh(o,f,y,I){return o.baseState=y,El(o,Ur,typeof I=="function"?I:qs)}function md(o,f,y,I,k){if(uu(o))throw Error(M(485));if(o=f.action,o!==null){var G={payload:k,action:o,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(se){G.listeners.push(se)}};ai.T!==null?y(!0):G.isTransition=!1,I(G),y=f.pending,y===null?(G.next=f.pending=G,_d(f,G)):(G.next=y.next,f.pending=y.next=G)}}function _d(o,f){var y=f.action,I=f.payload,k=o.state;if(f.isTransition){var G=ai.T,se={};ai.T=se;try{var xe=y(k,I),Ne=ai.S;Ne!==null&&Ne(se,xe),gd(o,f,xe)}catch(ot){Al(o,f,ot)}finally{ai.T=G}}else try{G=y(k,I),gd(o,f,G)}catch(ot){Al(o,f,ot)}}function gd(o,f,y){y!==null&&typeof y=="object"&&typeof y.then=="function"?y.then(function(I){yd(o,f,I)},function(I){return Al(o,f,I)}):yd(o,f,y)}function yd(o,f,y){f.status="fulfilled",f.value=y,bp(f),o.state=y,f=o.pending,f!==null&&(y=f.next,y===f?o.pending=null:(y=y.next,f.next=y,_d(o,y)))}function Al(o,f,y){var I=o.pending;if(o.pending=null,I!==null){I=I.next;do f.status="rejected",f.reason=y,bp(f),f=f.next;while(f!==I)}o.action=null}function bp(o){o=o.listeners;for(var f=0;f<o.length;f++)(0,o[f])()}function wp(o,f){return f}function vd(o,f){if(Mr){var y=mi.formState;if(y!==null){e:{var I=It;if(Mr){if(Zn){t:{for(var k=Zn,G=bs;k.nodeType!==8;){if(!G){k=null;break t}if(k=Wo(k.nextSibling),k===null){k=null;break t}}G=k.data,k=G==="F!"||G==="F"?k:null}if(k){Zn=Wo(k.nextSibling),I=k.data==="F!";break e}}co(I)}I=!1}I&&(f=y[0])}}return y=na(),y.memoizedState=y.baseState=f,I={pending:null,lanes:0,dispatch:null,lastRenderedReducer:wp,lastRenderedState:f},y.queue=I,y=pf.bind(null,It,I),I.dispatch=y,I=uf(!1),G=fh.bind(null,It,!1,I.queue),I=na(),k={state:f,dispatch:null,action:o,pending:null},I.queue=k,y=md.bind(null,It,k,G,y),k.dispatch=y,I.memoizedState=o,[f,y,!1]}function oh(o){var f=Pr();return qo(f,Ur,o)}function qo(o,f,y){f=El(o,f,wp)[0],o=Sl(qs)[0],f=typeof f=="object"&&f!==null&&typeof f.then=="function"?wl(f):f;var I=Pr(),k=I.queue,G=k.dispatch;return y!==I.memoizedState&&(It.flags|=2048,Ss(9,xd.bind(null,k,y),{destroy:void 0},null)),[f,G,o]}function xd(o,f){o.action=f}function hf(o){var f=Pr(),y=Ur;if(y!==null)return qo(f,y,o);Pr(),f=f.memoizedState,y=Pr();var I=y.queue.dispatch;return y.memoizedState=o,[f,I,!1]}function Ss(o,f,y,I){return o={tag:o,create:f,inst:y,deps:I,next:null},f=It.updateQueue,f===null&&(f=wr(),It.updateQueue=f),y=f.lastEffect,y===null?f.lastEffect=o.next=o:(I=y.next,y.next=o,o.next=I,f.lastEffect=o),o}function lh(){return Pr().memoizedState}function es(o,f,y,I){var k=na();It.flags|=o,k.memoizedState=Ss(1|f,y,{destroy:void 0},I===void 0?null:I)}function Es(o,f,y,I){var k=Pr();I=I===void 0?null:I;var G=k.memoizedState.inst;Ur!==null&&I!==null&&nh(I,Ur.memoizedState.deps)?k.memoizedState=Ss(f,y,G,I):(It.flags|=o,k.memoizedState=Ss(1|f,y,G,I))}function bd(o,f){es(8390656,8,o,f)}function _n(o,f){Es(2048,8,o,f)}function Tp(o,f){return Es(4,2,o,f)}function ou(o,f){return Es(4,4,o,f)}function Ar(o,f){if(typeof f=="function"){o=o();var y=f(o);return function(){typeof y=="function"?y():f(null)}}if(f!=null)return o=o(),f.current=o,function(){f.current=null}}function cr(o,f,y){y=y!=null?y.concat([o]):null,Es(4,4,Ar.bind(null,f,o),y)}function ff(){}function fo(o,f){var y=Pr();f=f===void 0?null:f;var I=y.memoizedState;return f!==null&&nh(f,I[1])?I[0]:(y.memoizedState=[o,f],o)}function hc(o,f){var y=Pr();f=f===void 0?null:f;var I=y.memoizedState;if(f!==null&&nh(f,I[1]))return I[0];if(I=o(),Uo){In(!0);try{o()}finally{In(!1)}}return y.memoizedState=[I,f],I}function Gs(o,f,y){return y===void 0||(ja&1073741824)!==0?o.memoizedState=f:(o.memoizedState=y,o=ag(),It.lanes|=o,fr|=o,y)}function ch(o,f,y,I){return Hn(y,f)?y:ra.current!==null?(o=Gs(o,y,I),Hn(o,f)||(Wn=!0),o):(ja&42)===0?(Wn=!0,o.memoizedState=y):(o=ag(),It.lanes|=o,fr|=o,f)}function lu(o,f,y,I,k){var G=wi.p;wi.p=G!==0&&8>G?G:8;var se=ai.T,xe={};ai.T=xe,fh(o,!1,f,y);try{var Ne=k(),ot=ai.S;if(ot!==null&&ot(xe,Ne),Ne!==null&&typeof Ne=="object"&&typeof Ne.then=="function"){var Pt=lc(Ne,I);Il(o,f,Pt,Rs(o))}else Il(o,f,I,Rs(o))}catch($t){Il(o,f,{then:function(){},status:"rejected",reason:$t},Rs())}finally{wi.p=G,ai.T=se}}function po(){}function Yn(o,f,y,I){if(o.tag!==5)throw Error(M(476));var k=uh(o).queue;lu(o,k,f,_r,y===null?po:function(){return cu(o),y(I)})}function uh(o){var f=o.memoizedState;if(f!==null)return f;f={memoizedState:_r,baseState:_r,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:qs,lastRenderedState:_r},next:null};var y={};return f.next={memoizedState:y,baseState:y,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:qs,lastRenderedState:y},next:null},o.memoizedState=f,o=o.alternate,o!==null&&(o.memoizedState=f),f}function cu(o){var f=uh(o).next.queue;Il(o,f,{},Rs())}function hh(){return ya(zh)}function df(){return Pr().memoizedState}function Cl(){return Pr().memoizedState}function wd(o){for(var f=o.return;f!==null;){switch(f.tag){case 24:case 3:var y=Rs();o=rs(y);var I=Zo(f,o,y);I!==null&&(os(I,f,y),_u(I,f,y)),f={cache:eu()},o.payload=f;return}f=f.return}}function Dl(o,f,y){var I=Rs();y={lane:I,revertLane:0,action:y,hasEagerState:!1,eagerState:null,next:null},uu(o)?Ln(f,y):(y=Jl(o,f,y,I),y!==null&&(os(y,o,I),mf(y,f,I)))}function pf(o,f,y){var I=Rs();Il(o,f,y,I)}function Il(o,f,y,I){var k={lane:I,revertLane:0,action:y,hasEagerState:!1,eagerState:null,next:null};if(uu(o))Ln(f,k);else{var G=o.alternate;if(o.lanes===0&&(G===null||G.lanes===0)&&(G=f.lastRenderedReducer,G!==null))try{var se=f.lastRenderedState,xe=G(se,y);if(k.hasEagerState=!0,k.eagerState=xe,Hn(xe,se))return Kl(o,f,k,0),mi===null&&dl(),!1}catch{}finally{}if(y=Jl(o,f,k,I),y!==null)return os(y,o,I),mf(y,f,I),!0}return!1}function fh(o,f,y,I){if(I={lane:2,revertLane:Bp(),action:I,hasEagerState:!1,eagerState:null,next:null},uu(o)){if(f)throw Error(M(479))}else f=Jl(o,y,I,2),f!==null&&os(f,o,2)}function uu(o){var f=o.alternate;return o===It||f!==null&&f===It}function Ln(o,f){Vo=cf=!0;var y=o.pending;y===null?f.next=f:(f.next=y.next,y.next=f),o.pending=f}function mf(o,f,y){if((y&4194176)!==0){var I=f.lanes;I&=o.pendingLanes,y|=I,f.lanes=y,kc(o,y)}}var Ms={readContext:ya,use:Tl,useCallback:dn,useContext:dn,useEffect:dn,useImperativeHandle:dn,useLayoutEffect:dn,useInsertionEffect:dn,useMemo:dn,useReducer:dn,useRef:dn,useState:dn,useDebugValue:dn,useDeferredValue:dn,useTransition:dn,useSyncExternalStore:dn,useId:dn};Ms.useCacheRefresh=dn,Ms.useMemoCache=dn,Ms.useHostTransitionStatus=dn,Ms.useFormState=dn,Ms.useActionState=dn,Ms.useOptimistic=dn;var Hs={readContext:ya,use:Tl,useCallback:function(o,f){return na().memoizedState=[o,f===void 0?null:f],o},useContext:ya,useEffect:bd,useImperativeHandle:function(o,f,y){y=y!=null?y.concat([o]):null,es(4194308,4,Ar.bind(null,f,o),y)},useLayoutEffect:function(o,f){return es(4194308,4,o,f)},useInsertionEffect:function(o,f){es(4,2,o,f)},useMemo:function(o,f){var y=na();f=f===void 0?null:f;var I=o();if(Uo){In(!0);try{o()}finally{In(!1)}}return y.memoizedState=[I,f],I},useReducer:function(o,f,y){var I=na();if(y!==void 0){var k=y(f);if(Uo){In(!0);try{y(f)}finally{In(!1)}}}else k=f;return I.memoizedState=I.baseState=k,o={pending:null,lanes:0,dispatch:null,lastRenderedReducer:o,lastRenderedState:k},I.queue=o,o=o.dispatch=Dl.bind(null,It,o),[I.memoizedState,o]},useRef:function(o){var f=na();return o={current:o},f.memoizedState=o},useState:function(o){o=uf(o);var f=o.queue,y=pf.bind(null,It,f);return f.dispatch=y,[o.memoizedState,y]},useDebugValue:ff,useDeferredValue:function(o,f){var y=na();return Gs(y,o,f)},useTransition:function(){var o=uf(!1);return o=lu.bind(null,It,o.queue,!0,!1),na().memoizedState=o,[!1,o]},useSyncExternalStore:function(o,f,y){var I=It,k=na();if(Mr){if(y===void 0)throw Error(M(407));y=y()}else{if(y=f(),mi===null)throw Error(M(349));(_i&60)!==0||wt(I,f,y)}k.memoizedState=y;var G={value:y,getSnapshot:f};return k.queue=G,bd(uc.bind(null,I,G,o),[o]),I.flags|=2048,Ss(9,Gt.bind(null,I,G,y,f),{destroy:void 0},null),y},useId:function(){var o=na(),f=mi.identifierPrefix;if(Mr){var y=lo,I=oo;y=(I&~(1<<32-Nn(I)-1)).toString(32)+y,f=":"+f+"R"+y,y=ru++,0<y&&(f+="H"+y.toString(32)),f+=":"}else y=rh++,f=":"+f+"r"+y.toString(32)+":";return o.memoizedState=f},useCacheRefresh:function(){return na().memoizedState=wd.bind(null,It)}};Hs.useMemoCache=su,Hs.useHostTransitionStatus=hh,Hs.useFormState=vd,Hs.useActionState=vd,Hs.useOptimistic=function(o){var f=na();f.memoizedState=f.baseState=o;var y={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return f.queue=y,f=fh.bind(null,It,!0,y),y.dispatch=f,[o,f]};var Ia={readContext:ya,use:Tl,useCallback:fo,useContext:ya,useEffect:_n,useImperativeHandle:cr,useInsertionEffect:Tp,useLayoutEffect:ou,useMemo:hc,useReducer:Sl,useRef:lh,useState:function(){return Sl(qs)},useDebugValue:ff,useDeferredValue:function(o,f){var y=Pr();return ch(y,Ur.memoizedState,o,f)},useTransition:function(){var o=Sl(qs)[0],f=Pr().memoizedState;return[typeof o=="boolean"?o:wl(o),f]},useSyncExternalStore:cc,useId:df};Ia.useCacheRefresh=Cl,Ia.useMemoCache=su,Ia.useHostTransitionStatus=hh,Ia.useFormState=oh,Ia.useActionState=oh,Ia.useOptimistic=function(o,f){var y=Pr();return sh(y,Ur,o,f)};var mo={readContext:ya,use:Tl,useCallback:fo,useContext:ya,useEffect:_n,useImperativeHandle:cr,useInsertionEffect:Tp,useLayoutEffect:ou,useMemo:hc,useReducer:Ml,useRef:lh,useState:function(){return Ml(qs)},useDebugValue:ff,useDeferredValue:function(o,f){var y=Pr();return Ur===null?Gs(y,o,f):ch(y,Ur.memoizedState,o,f)},useTransition:function(){var o=Ml(qs)[0],f=Pr().memoizedState;return[typeof o=="boolean"?o:wl(o),f]},useSyncExternalStore:cc,useId:df};mo.useCacheRefresh=Cl,mo.useMemoCache=su,mo.useHostTransitionStatus=hh,mo.useFormState=hf,mo.useActionState=hf,mo.useOptimistic=function(o,f){var y=Pr();return Ur!==null?sh(y,Ur,o,f):(y.baseState=o,[o,y.queue.dispatch])};function As(o,f,y,I){f=o.memoizedState,y=y(I,f),y=y==null?f:kt({},f,y),o.memoizedState=y,o.lanes===0&&(o.updateQueue.baseState=y)}var hu={isMounted:function(o){return(o=o._reactInternals)?Bi(o)===o:!1},enqueueSetState:function(o,f,y){o=o._reactInternals;var I=Rs(),k=rs(I);k.payload=f,y!=null&&(k.callback=y),f=Zo(o,k,I),f!==null&&(os(f,o,I),_u(f,o,I))},enqueueReplaceState:function(o,f,y){o=o._reactInternals;var I=Rs(),k=rs(I);k.tag=1,k.payload=f,y!=null&&(k.callback=y),f=Zo(o,k,I),f!==null&&(os(f,o,I),_u(f,o,I))},enqueueForceUpdate:function(o,f){o=o._reactInternals;var y=Rs(),I=rs(y);I.tag=2,f!=null&&(I.callback=f),f=Zo(o,I,y),f!==null&&(os(f,o,y),_u(f,o,y))}};function fc(o,f,y,I,k,G,se){return o=o.stateNode,typeof o.shouldComponentUpdate=="function"?o.shouldComponentUpdate(I,G,se):f.prototype&&f.prototype.isPureReactComponent?!js(y,I)||!js(k,G):!0}function _f(o,f,y,I){o=f.state,typeof f.componentWillReceiveProps=="function"&&f.componentWillReceiveProps(y,I),typeof f.UNSAFE_componentWillReceiveProps=="function"&&f.UNSAFE_componentWillReceiveProps(y,I),f.state!==o&&hu.enqueueReplaceState(f,f.state,null)}function Go(o,f){var y=f;if("ref"in f){y={};for(var I in f)I!=="ref"&&(y[I]=f[I])}if(o=o.defaultProps){y===f&&(y=kt({},y));for(var k in o)y[k]===void 0&&(y[k]=o[k])}return y}var Rl=typeof reportError=="function"?reportError:function(o){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var f=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof o=="object"&&o!==null&&typeof o.message=="string"?String(o.message):String(o),error:o});if(!window.dispatchEvent(f))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",o);return}console.error(o)};function fu(o){Rl(o)}function gf(o){console.error(o)}function dh(o){Rl(o)}function ph(o,f){try{var y=o.onUncaughtError;y(f.value,{componentStack:f.stack})}catch(I){setTimeout(function(){throw I})}}function yf(o,f,y){try{var I=o.onCaughtError;I(y.value,{componentStack:y.stack,errorBoundary:f.tag===1?f.stateNode:null})}catch(k){setTimeout(function(){throw k})}}function dc(o,f,y){return y=rs(y),y.tag=3,y.payload={element:null},y.callback=function(){ph(o,f)},y}function Td(o){return o=rs(o),o.tag=3,o}function Sd(o,f,y,I){var k=y.type.getDerivedStateFromError;if(typeof k=="function"){var G=I.value;o.payload=function(){return k(G)},o.callback=function(){yf(f,y,I)}}var se=y.stateNode;se!==null&&typeof se.componentDidCatch=="function"&&(o.callback=function(){yf(f,y,I),typeof k!="function"&&($n===null?$n=new Set([this]):$n.add(this));var xe=I.stack;this.componentDidCatch(I.value,{componentStack:xe!==null?xe:""})})}function Sp(o,f,y,I,k){if(y.flags|=32768,I!==null&&typeof I=="object"&&typeof I.then=="function"){if(f=y.alternate,f!==null&&Ds(f,y,k,!0),y=ga.current,y!==null){switch(y.tag){case 13:return ws===null?wh():y.alternate===null&&Ji===0&&(Ji=3),y.flags&=-257,y.flags|=65536,y.lanes=k,I===fd?y.flags|=16384:(f=y.updateQueue,f===null?y.updateQueue=new Set([I]):f.add(I),xu(o,I,k)),!1;case 22:return y.flags|=65536,I===fd?y.flags|=16384:(f=y.updateQueue,f===null?(f={transitions:null,markerInstances:null,retryQueue:new Set([I])},y.updateQueue=f):(y=f.retryQueue,y===null?f.retryQueue=new Set([I]):y.add(I)),xu(o,I,k)),!1}throw Error(M(435,y.tag))}return xu(o,I,k),wh(),!1}if(Mr)return f=ga.current,f!==null?((f.flags&65536)===0&&(f.flags|=256),f.flags|=65536,f.lanes=k,I!==Qu&&(o=Error(M(422),{cause:I}),$c(Ka(o,y)))):(I!==Qu&&(f=Error(M(423),{cause:I}),$c(Ka(f,y))),o=o.current.alternate,o.flags|=65536,k&=-k,o.lanes|=k,I=Ka(I,y),k=dc(o.stateNode,I,k),Ol(o,k),Ji!==4&&(Ji=2)),!1;var G=Error(M(520),{cause:I});if(G=Ka(G,y),mr===null?mr=[G]:mr.push(G),Ji!==4&&(Ji=2),f===null)return!0;I=Ka(I,y),y=f;do{switch(y.tag){case 3:return y.flags|=65536,o=k&-k,y.lanes|=o,o=dc(y.stateNode,I,o),Ol(y,o),!1;case 1:if(f=y.type,G=y.stateNode,(y.flags&128)===0&&(typeof f.getDerivedStateFromError=="function"||G!==null&&typeof G.componentDidCatch=="function"&&($n===null||!$n.has(G))))return y.flags|=65536,k&=-k,y.lanes|=k,k=Td(k),Sd(k,o,y,I),Ol(y,k),!1}y=y.return}while(y!==null);return!1}var Ed=Error(M(461)),Wn=!1;function Sn(o,f,y,I){f.child=o===null?af(f,null,y,I):Ua(f,o.child,y,I)}function du(o,f,y,I,k){y=y.render;var G=f.ref;if("ref"in I){var se={};for(var xe in I)xe!=="ref"&&(se[xe]=I[xe])}else se=I;return Ga(f),I=Ts(o,f,y,se,G,k),xe=ah(),o!==null&&!Wn?(bl(o,f,k),_o(o,f,k)):(Mr&&xe&&nc(f),f.flags|=1,Sn(o,f,I,k),f.child)}function Ra(o,f,y,I,k){if(o===null){var G=y.type;return typeof G=="function"&&!Je(G)&&G.defaultProps===void 0&&y.compare===null?(f.tag=15,f.type=G,pu(o,f,G,I,k)):(o=ct(y.type,null,I,f,f.mode,k),o.ref=f.ref,o.return=f,f.child=o)}if(G=o.child,!bf(o,k)){var se=G.memoizedProps;if(y=y.compare,y=y!==null?y:js,y(se,I)&&o.ref===f.ref)return _o(o,f,k)}return f.flags|=1,o=St(G,I),o.ref=f.ref,o.return=f,f.child=o}function pu(o,f,y,I,k){if(o!==null){var G=o.memoizedProps;if(js(G,I)&&o.ref===f.ref)if(Wn=!1,f.pendingProps=I=G,bf(o,k))(o.flags&131072)!==0&&(Wn=!0);else return f.lanes=o.lanes,_o(o,f,k)}return Xr(o,f,y,I,k)}function Md(o,f,y){var I=f.pendingProps,k=I.children,G=(f.stateNode._pendingVisibility&2)!==0,se=o!==null?o.memoizedState:null;if(mh(o,f),I.mode==="hidden"||G){if((f.flags&128)!==0){if(I=se!==null?se.baseLanes|y:y,o!==null){for(k=f.child=o.child,G=0;k!==null;)G=G|k.lanes|k.childLanes,k=k.sibling;f.childLanes=G&~I}else f.childLanes=0,f.child=null;return Ep(o,f,I,y)}if((y&536870912)!==0)f.memoizedState={baseLanes:0,cachePool:null},o!==null&&iu(f,se!==null?se.cachePool:null),se!==null?Qc(f,se):sf(),of(f);else return f.lanes=f.childLanes=536870912,Ep(o,f,se!==null?se.baseLanes|y:y,y)}else se!==null?(iu(f,se.cachePool),Qc(f,se),Ja(),f.memoizedState=null):(o!==null&&iu(f,null),sf(),Ja());return Sn(o,f,k,y),f.child}function Ep(o,f,y,I){var k=ih();return k=k===null?null:{parent:fn._currentValue,pool:k},f.memoizedState={baseLanes:y,cachePool:k},o!==null&&iu(f,null),sf(),of(f),o!==null&&Ds(o,f,I,!0),null}function mh(o,f){var y=f.ref;if(y===null)o!==null&&o.ref!==null&&(f.flags|=2097664);else{if(typeof y!="function"&&typeof y!="object")throw Error(M(284));(o===null||o.ref!==y)&&(f.flags|=2097664)}}function Xr(o,f,y,I,k){return Ga(f),y=Ts(o,f,y,I,void 0,k),I=ah(),o!==null&&!Wn?(bl(o,f,k),_o(o,f,k)):(Mr&&I&&nc(f),f.flags|=1,Sn(o,f,y,k),f.child)}function _h(o,f,y,I,k,G){return Ga(f),f.updateQueue=null,y=jo(f,I,y,k),Da(o),I=ah(),o!==null&&!Wn?(bl(o,f,G),_o(o,f,G)):(Mr&&I&&nc(f),f.flags|=1,Sn(o,f,y,G),f.child)}function Mp(o,f,y,I,k){if(Ga(f),f.stateNode===null){var G=ec,se=y.contextType;typeof se=="object"&&se!==null&&(G=ya(se)),G=new y(I,G),f.memoizedState=G.state!==null&&G.state!==void 0?G.state:null,G.updater=hu,f.stateNode=G,G._reactInternals=f,G=f.stateNode,G.props=I,G.state=f.memoizedState,G.refs={},Sf(f),se=y.contextType,G.context=typeof se=="object"&&se!==null?ya(se):ec,G.state=f.memoizedState,se=y.getDerivedStateFromProps,typeof se=="function"&&(As(f,y,se,I),G.state=f.memoizedState),typeof y.getDerivedStateFromProps=="function"||typeof G.getSnapshotBeforeUpdate=="function"||typeof G.UNSAFE_componentWillMount!="function"&&typeof G.componentWillMount!="function"||(se=G.state,typeof G.componentWillMount=="function"&&G.componentWillMount(),typeof G.UNSAFE_componentWillMount=="function"&&G.UNSAFE_componentWillMount(),se!==G.state&&hu.enqueueReplaceState(G,G.state,null),pa(f,I,G,k),da(),G.state=f.memoizedState),typeof G.componentDidMount=="function"&&(f.flags|=4194308),I=!0}else if(o===null){G=f.stateNode;var xe=f.memoizedProps,Ne=Go(y,xe);G.props=Ne;var ot=G.context,Pt=y.contextType;se=ec,typeof Pt=="object"&&Pt!==null&&(se=ya(Pt));var $t=y.getDerivedStateFromProps;Pt=typeof $t=="function"||typeof G.getSnapshotBeforeUpdate=="function",xe=f.pendingProps!==xe,Pt||typeof G.UNSAFE_componentWillReceiveProps!="function"&&typeof G.componentWillReceiveProps!="function"||(xe||ot!==se)&&_f(f,G,I,se),Ys=!1;var xt=f.memoizedState;G.state=xt,pa(f,I,G,k),da(),ot=f.memoizedState,xe||xt!==ot||Ys?(typeof $t=="function"&&(As(f,y,$t,I),ot=f.memoizedState),(Ne=Ys||fc(f,y,Ne,I,xt,ot,se))?(Pt||typeof G.UNSAFE_componentWillMount!="function"&&typeof G.componentWillMount!="function"||(typeof G.componentWillMount=="function"&&G.componentWillMount(),typeof G.UNSAFE_componentWillMount=="function"&&G.UNSAFE_componentWillMount()),typeof G.componentDidMount=="function"&&(f.flags|=4194308)):(typeof G.componentDidMount=="function"&&(f.flags|=4194308),f.memoizedProps=I,f.memoizedState=ot),G.props=I,G.state=ot,G.context=se,I=Ne):(typeof G.componentDidMount=="function"&&(f.flags|=4194308),I=!1)}else{G=f.stateNode,aa(o,f),se=f.memoizedProps,Pt=Go(y,se),G.props=Pt,$t=f.pendingProps,xt=G.context,ot=y.contextType,Ne=ec,typeof ot=="object"&&ot!==null&&(Ne=ya(ot)),xe=y.getDerivedStateFromProps,(ot=typeof xe=="function"||typeof G.getSnapshotBeforeUpdate=="function")||typeof G.UNSAFE_componentWillReceiveProps!="function"&&typeof G.componentWillReceiveProps!="function"||(se!==$t||xt!==Ne)&&_f(f,G,I,Ne),Ys=!1,xt=f.memoizedState,G.state=xt,pa(f,I,G,k),da();var Lt=f.memoizedState;se!==$t||xt!==Lt||Ys||o!==null&&o.dependencies!==null&&go(o.dependencies)?(typeof xe=="function"&&(As(f,y,xe,I),Lt=f.memoizedState),(Pt=Ys||fc(f,y,Pt,I,xt,Lt,Ne)||o!==null&&o.dependencies!==null&&go(o.dependencies))?(ot||typeof G.UNSAFE_componentWillUpdate!="function"&&typeof G.componentWillUpdate!="function"||(typeof G.componentWillUpdate=="function"&&G.componentWillUpdate(I,Lt,Ne),typeof G.UNSAFE_componentWillUpdate=="function"&&G.UNSAFE_componentWillUpdate(I,Lt,Ne)),typeof G.componentDidUpdate=="function"&&(f.flags|=4),typeof G.getSnapshotBeforeUpdate=="function"&&(f.flags|=1024)):(typeof G.componentDidUpdate!="function"||se===o.memoizedProps&&xt===o.memoizedState||(f.flags|=4),typeof G.getSnapshotBeforeUpdate!="function"||se===o.memoizedProps&&xt===o.memoizedState||(f.flags|=1024),f.memoizedProps=I,f.memoizedState=Lt),G.props=I,G.state=Lt,G.context=Ne,I=Pt):(typeof G.componentDidUpdate!="function"||se===o.memoizedProps&&xt===o.memoizedState||(f.flags|=4),typeof G.getSnapshotBeforeUpdate!="function"||se===o.memoizedProps&&xt===o.memoizedState||(f.flags|=1024),I=!1)}return G=I,mh(o,f),I=(f.flags&128)!==0,G||I?(G=f.stateNode,y=I&&typeof y.getDerivedStateFromError!="function"?null:G.render(),f.flags|=1,o!==null&&I?(f.child=Ua(f,o.child,null,k),f.child=Ua(f,null,y,k)):Sn(o,f,y,k),f.memoizedState=G.state,o=f.child):o=_o(o,f,k),o}function vf(o,f,y,I){return Wc(),f.flags|=256,Sn(o,f,y,I),f.child}var pc={dehydrated:null,treeContext:null,retryLane:0};function xf(o){return{baseLanes:o,cachePool:No()}}function mc(o,f,y){return o=o!==null?o.childLanes&~y:0,f&&(o|=Sr),o}function gh(o,f,y){var I=f.pendingProps,k=!1,G=(f.flags&128)!==0,se;if((se=G)||(se=o!==null&&o.memoizedState===null?!1:(Xn.current&2)!==0),se&&(k=!0,f.flags&=-129),se=(f.flags&32)!==0,f.flags&=-33,o===null){if(Mr){if(k?yl(f):Ja(),Mr){var xe=Zn,Ne;if(Ne=xe){e:{for(Ne=xe,xe=bs;Ne.nodeType!==8;){if(!xe){xe=null;break e}if(Ne=Wo(Ne.nextSibling),Ne===null){xe=null;break e}}xe=Ne}xe!==null?(f.memoizedState={dehydrated:xe,treeContext:Po!==null?{id:oo,overflow:lo}:null,retryLane:536870912},Ne=st(18,null,null,0),Ne.stateNode=xe,Ne.return=f,f.child=Ne,Zr=f,Zn=null,Ne=!0):Ne=!1}Ne||co(f)}if(xe=f.memoizedState,xe!==null&&(xe=xe.dehydrated,xe!==null))return xe.data==="$!"?f.lanes=16:f.lanes=536870912,null;Fo(f)}return xe=I.children,I=I.fallback,k?(Ja(),k=f.mode,xe=_c({mode:"hidden",children:xe},k),I=vt(I,k,y,null),xe.return=f,I.return=f,xe.sibling=I,f.child=xe,k=f.child,k.memoizedState=xf(y),k.childLanes=mc(o,se,y),f.memoizedState=pc,I):(yl(f),Cs(f,xe))}if(Ne=o.memoizedState,Ne!==null&&(xe=Ne.dehydrated,xe!==null)){if(G)f.flags&256?(yl(f),f.flags&=-257,f=Qr(o,f,y)):f.memoizedState!==null?(Ja(),f.child=o.child,f.flags|=128,f=null):(Ja(),k=I.fallback,xe=f.mode,I=_c({mode:"visible",children:I.children},xe),k=vt(k,xe,y,null),k.flags|=2,I.return=f,k.return=f,I.sibling=k,f.child=I,Ua(f,o.child,null,y),I=f.child,I.memoizedState=xf(y),I.childLanes=mc(o,se,y),f.memoizedState=pc,f=k);else if(yl(f),xe.data==="$!"){if(se=xe.nextSibling&&xe.nextSibling.dataset,se)var ot=se.dgst;se=ot,I=Error(M(419)),I.stack="",I.digest=se,$c({value:I,source:null,stack:null}),f=Qr(o,f,y)}else if(Wn||Ds(o,f,y,!1),se=(y&o.childLanes)!==0,Wn||se){if(se=mi,se!==null){if(I=y&-y,(I&42)!==0)I=1;else switch(I){case 2:I=1;break;case 8:I=4;break;case 32:I=16;break;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:I=64;break;case 268435456:I=134217728;break;default:I=0}if(I=(I&(se.suspendedLanes|y))!==0?0:I,I!==0&&I!==Ne.retryLane)throw Ne.retryLane=I,Qa(o,I),os(se,o,I),Ed}xe.data==="$?"||wh(),f=Qr(o,f,y)}else xe.data==="$?"?(f.flags|=128,f.child=o.child,f=zp.bind(null,o),xe._reactRetry=f,f=null):(o=Ne.treeContext,Zn=Wo(xe.nextSibling),Zr=f,Mr=!0,Va=null,bs=!1,o!==null&&(Ba[Na++]=oo,Ba[Na++]=lo,Ba[Na++]=Po,oo=o.id,lo=o.overflow,Po=f),f=Cs(f,I.children),f.flags|=4096);return f}return k?(Ja(),k=I.fallback,xe=f.mode,Ne=o.child,ot=Ne.sibling,I=St(Ne,{mode:"hidden",children:I.children}),I.subtreeFlags=Ne.subtreeFlags&31457280,ot!==null?k=St(ot,k):(k=vt(k,xe,y,null),k.flags|=2),k.return=f,I.return=f,I.sibling=k,f.child=I,I=k,k=f.child,xe=o.child.memoizedState,xe===null?xe=xf(y):(Ne=xe.cachePool,Ne!==null?(ot=fn._currentValue,Ne=Ne.parent!==ot?{parent:ot,pool:ot}:Ne):Ne=No(),xe={baseLanes:xe.baseLanes|y,cachePool:Ne}),k.memoizedState=xe,k.childLanes=mc(o,se,y),f.memoizedState=pc,I):(yl(f),y=o.child,o=y.sibling,y=St(y,{mode:"visible",children:I.children}),y.return=f,y.sibling=null,o!==null&&(se=f.deletions,se===null?(f.deletions=[o],f.flags|=16):se.push(o)),f.child=y,f.memoizedState=null,y)}function Cs(o,f){return f=_c({mode:"visible",children:f},o.mode),f.return=o,o.child=f}function _c(o,f){return Ct(o,f,0,null)}function Qr(o,f,y){return Ua(f,o.child,null,y),o=Cs(f,f.pendingProps.children),o.flags|=2,f.memoizedState=null,o}function ts(o,f,y){o.lanes|=f;var I=o.alternate;I!==null&&(I.lanes|=f),Xs(o.return,f,y)}function zl(o,f,y,I,k){var G=o.memoizedState;G===null?o.memoizedState={isBackwards:f,rendering:null,renderingStartTime:0,last:I,tail:y,tailMode:k}:(G.isBackwards=f,G.rendering=null,G.renderingStartTime=0,G.last=I,G.tail=y,G.tailMode=k)}function mu(o,f,y){var I=f.pendingProps,k=I.revealOrder,G=I.tail;if(Sn(o,f,I.children,y),I=Xn.current,(I&2)!==0)I=I&1|2,f.flags|=128;else{if(o!==null&&(o.flags&128)!==0)e:for(o=f.child;o!==null;){if(o.tag===13)o.memoizedState!==null&&ts(o,y,f);else if(o.tag===19)ts(o,y,f);else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===f)break e;for(;o.sibling===null;){if(o.return===null||o.return===f)break e;o=o.return}o.sibling.return=o.return,o=o.sibling}I&=1}switch(Ae(Xn,I),k){case"forwards":for(y=f.child,k=null;y!==null;)o=y.alternate,o!==null&&eh(o)===null&&(k=y),y=y.sibling;y=k,y===null?(k=f.child,f.child=null):(k=y.sibling,y.sibling=null),zl(f,!1,k,y,G);break;case"backwards":for(y=null,k=f.child,f.child=null;k!==null;){if(o=k.alternate,o!==null&&eh(o)===null){f.child=k;break}o=k.sibling,k.sibling=y,y=k,k=o}zl(f,!0,y,null,G);break;case"together":zl(f,!1,null,null,void 0);break;default:f.memoizedState=null}return f.child}function _o(o,f,y){if(o!==null&&(f.dependencies=o.dependencies),fr|=f.lanes,(y&f.childLanes)===0)if(o!==null){if(Ds(o,f,y,!1),(y&f.childLanes)===0)return null}else return null;if(o!==null&&f.child!==o.child)throw Error(M(153));if(f.child!==null){for(o=f.child,y=St(o,o.pendingProps),f.child=y,y.return=f;o.sibling!==null;)o=o.sibling,y=y.sibling=St(o,o.pendingProps),y.return=f;y.sibling=null}return f.child}function bf(o,f){return(o.lanes&f)!==0?!0:(o=o.dependencies,!!(o!==null&&go(o)))}function yh(o,f,y){switch(f.tag){case 3:kn(f,f.stateNode.containerInfo),qa(f,fn,o.memoizedState.cache),Wc();break;case 27:case 5:Jo(f);break;case 4:kn(f,f.stateNode.containerInfo);break;case 10:qa(f,f.type,f.memoizedProps.value);break;case 13:var I=f.memoizedState;if(I!==null)return I.dehydrated!==null?(yl(f),f.flags|=128,null):(y&f.child.childLanes)!==0?gh(o,f,y):(yl(f),o=_o(o,f,y),o!==null?o.sibling:null);yl(f);break;case 19:var k=(o.flags&128)!==0;if(I=(y&f.childLanes)!==0,I||(Ds(o,f,y,!1),I=(y&f.childLanes)!==0),k){if(I)return mu(o,f,y);f.flags|=128}if(k=f.memoizedState,k!==null&&(k.rendering=null,k.tail=null,k.lastEffect=null),Ae(Xn,Xn.current),I)break;return null;case 22:case 23:return f.lanes=0,Md(o,f,y);case 24:qa(f,fn,o.memoizedState.cache)}return _o(o,f,y)}function wf(o,f,y){if(o!==null)if(o.memoizedProps!==f.pendingProps)Wn=!0;else{if(!bf(o,y)&&(f.flags&128)===0)return Wn=!1,yh(o,f,y);Wn=(o.flags&131072)!==0}else Wn=!1,Mr&&(f.flags&1048576)!==0&&Yc(f,Xc,f.index);switch(f.lanes=0,f.tag){case 16:e:{o=f.pendingProps;var I=f.elementType,k=I._init;if(I=k(I._payload),f.type=I,typeof I=="function")Je(I)?(o=Go(I,o),f.tag=1,f=Mp(null,f,I,o,y)):(f.tag=0,f=Xr(null,f,I,o,y));else{if(I!=null){if(k=I.$$typeof,k===Qe){f.tag=11,f=du(null,f,I,o,y);break e}else if(k===$e){f.tag=14,f=Ra(null,f,I,o,y);break e}}throw f=Fi(I)||I,Error(M(306,f,""))}}return f;case 0:return Xr(o,f,f.type,f.pendingProps,y);case 1:return I=f.type,k=Go(I,f.pendingProps),Mp(o,f,I,k,y);case 3:e:{if(kn(f,f.stateNode.containerInfo),o===null)throw Error(M(387));var G=f.pendingProps;k=f.memoizedState,I=k.element,aa(o,f),pa(f,G,null,y);var se=f.memoizedState;if(G=se.cache,qa(f,fn,G),G!==k.cache&&is(f,[fn],y,!0),da(),G=se.element,k.isDehydrated)if(k={element:G,isDehydrated:!1,cache:se.cache},f.updateQueue.baseState=k,f.memoizedState=k,f.flags&256){f=vf(o,f,G,y);break e}else if(G!==I){I=Ka(Error(M(424)),f),$c(I),f=vf(o,f,G,y);break e}else for(Zn=Wo(f.stateNode.containerInfo.firstChild),Zr=f,Mr=!0,Va=null,bs=!0,y=af(f,null,G,y),f.child=y;y;)y.flags=y.flags&-3|4096,y=y.sibling;else{if(Wc(),G===I){f=_o(o,f,y);break e}Sn(o,f,G,y)}f=f.child}return f;case 26:return mh(o,f),o===null?(y=Jm(f.type,null,f.pendingProps,null))?f.memoizedState=y:Mr||(y=f.type,o=f.pendingProps,I=Ch(Pa.current).createElement(y),I[ie]=f,I[oe]=o,wa(I,y,o),Jt(I),f.stateNode=I):f.memoizedState=Jm(f.type,o.memoizedProps,f.pendingProps,o.memoizedState),null;case 27:return Jo(f),o===null&&Mr&&(I=f.stateNode=Qm(f.type,f.pendingProps,Pa.current),Zr=f,bs=!0,Zn=Wo(I.firstChild)),I=f.pendingProps.children,o!==null||Mr?Sn(o,f,I,y):f.child=Ua(f,null,I,y),mh(o,f),f.child;case 5:return o===null&&Mr&&((k=I=Zn)&&(I=Zy(I,f.type,f.pendingProps,bs),I!==null?(f.stateNode=I,Zr=f,Zn=Wo(I.firstChild),bs=!1,k=!0):k=!1),k||co(f)),Jo(f),k=f.type,G=f.pendingProps,se=o!==null?o.memoizedProps:null,I=G.children,Pd(k,G)?I=null:se!==null&&Pd(k,se)&&(f.flags|=32),f.memoizedState!==null&&(k=Ts(o,f,pd,null,null,y),zh._currentValue=k),mh(o,f),Sn(o,f,I,y),f.child;case 6:return o===null&&Mr&&((o=y=Zn)&&(y=Xy(y,f.pendingProps,bs),y!==null?(f.stateNode=y,Zr=f,Zn=null,o=!0):o=!1),o||co(f)),null;case 13:return gh(o,f,y);case 4:return kn(f,f.stateNode.containerInfo),I=f.pendingProps,o===null?f.child=Ua(f,null,I,y):Sn(o,f,I,y),f.child;case 11:return du(o,f,f.type,f.pendingProps,y);case 7:return Sn(o,f,f.pendingProps,y),f.child;case 8:return Sn(o,f,f.pendingProps.children,y),f.child;case 12:return Sn(o,f,f.pendingProps.children,y),f.child;case 10:return I=f.pendingProps,qa(f,f.type,I.value),Sn(o,f,I.children,y),f.child;case 9:return k=f.type._context,I=f.pendingProps.children,Ga(f),k=ya(k),I=I(k),f.flags|=1,Sn(o,f,I,y),f.child;case 14:return Ra(o,f,f.type,f.pendingProps,y);case 15:return pu(o,f,f.type,f.pendingProps,y);case 19:return mu(o,f,y);case 22:return Md(o,f,y);case 24:return Ga(f),I=ya(fn),o===null?(k=ih(),k===null&&(k=mi,G=eu(),k.pooledCache=G,G.refCount++,G!==null&&(k.pooledCacheLanes|=y),k=G),f.memoizedState={parent:I,cache:k},Sf(f),qa(f,fn,k)):((o.lanes&y)!==0&&(aa(o,f),pa(f,null,null,y),da()),k=o.memoizedState,G=f.memoizedState,k.parent!==I?(k={parent:I,cache:I},f.memoizedState=k,f.lanes===0&&(f.memoizedState=f.updateQueue.baseState=k),qa(f,fn,I)):(I=G.cache,qa(f,fn,I),I!==k.cache&&is(f,[fn],y,!0))),Sn(o,f,f.pendingProps.children,y),f.child;case 29:throw f.pendingProps}throw Error(M(156,f.tag))}var Ad=gr(null),Ho=null,Zs=null;function qa(o,f,y){Ae(Ad,f._currentValue),f._currentValue=y}function za(o){o._currentValue=Ad.current,nn(Ad)}function Xs(o,f,y){for(;o!==null;){var I=o.alternate;if((o.childLanes&f)!==f?(o.childLanes|=f,I!==null&&(I.childLanes|=f)):I!==null&&(I.childLanes&f)!==f&&(I.childLanes|=f),o===y)break;o=o.return}}function is(o,f,y,I){var k=o.child;for(k!==null&&(k.return=o);k!==null;){var G=k.dependencies;if(G!==null){var se=k.child;G=G.firstContext;e:for(;G!==null;){var xe=G;G=k;for(var Ne=0;Ne<f.length;Ne++)if(xe.context===f[Ne]){G.lanes|=y,xe=G.alternate,xe!==null&&(xe.lanes|=y),Xs(G.return,y,o),I||(se=null);break e}G=xe.next}}else if(k.tag===18){if(se=k.return,se===null)throw Error(M(341));se.lanes|=y,G=se.alternate,G!==null&&(G.lanes|=y),Xs(se,y,o),se=null}else se=k.child;if(se!==null)se.return=k;else for(se=k;se!==null;){if(se===o){se=null;break}if(k=se.sibling,k!==null){k.return=se.return,se=k;break}se=se.return}k=se}}function Ds(o,f,y,I){o=null;for(var k=f,G=!1;k!==null;){if(!G){if((k.flags&524288)!==0)G=!0;else if((k.flags&262144)!==0)break}if(k.tag===10){var se=k.alternate;if(se===null)throw Error(M(387));if(se=se.memoizedProps,se!==null){var xe=k.type;Hn(k.pendingProps.value,se.value)||(o!==null?o.push(xe):o=[xe])}}else if(k===Rt.current){if(se=k.alternate,se===null)throw Error(M(387));se.memoizedState.memoizedState!==k.memoizedState.memoizedState&&(o!==null?o.push(zh):o=[zh])}k=k.return}o!==null&&is(f,o,y,I),f.flags|=262144}function go(o){for(o=o.firstContext;o!==null;){if(!Hn(o.context._currentValue,o.memoizedValue))return!0;o=o.next}return!1}function Ga(o){Ho=o,Zs=null,o=o.dependencies,o!==null&&(o.firstContext=null)}function ya(o){return Ap(Ho,o)}function Tf(o,f){return Ho===null&&Ga(o),Ap(o,f)}function Ap(o,f){var y=f._currentValue;if(f={context:f,memoizedValue:y,next:null},Zs===null){if(o===null)throw Error(M(308));Zs=f,o.dependencies={lanes:0,firstContext:f},o.flags|=524288}else Zs=Zs.next=f;return y}var Ys=!1;function Sf(o){o.updateQueue={baseState:o.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function aa(o,f){o=o.updateQueue,f.updateQueue===o&&(f.updateQueue={baseState:o.baseState,firstBaseUpdate:o.firstBaseUpdate,lastBaseUpdate:o.lastBaseUpdate,shared:o.shared,callbacks:null})}function rs(o){return{lane:o,tag:0,payload:null,callback:null,next:null}}function Zo(o,f,y){var I=o.updateQueue;if(I===null)return null;if(I=I.shared,(Ut&2)!==0){var k=I.pending;return k===null?f.next=f:(f.next=k.next,k.next=f),I.pending=f,f=Wi(o),pl(o,null,y),f}return Kl(o,I,f,y),Wi(o)}function _u(o,f,y){if(f=f.updateQueue,f!==null&&(f=f.shared,(y&4194176)!==0)){var I=f.lanes;I&=o.pendingLanes,y|=I,f.lanes=y,kc(o,y)}}function Ol(o,f){var y=o.updateQueue,I=o.alternate;if(I!==null&&(I=I.updateQueue,y===I)){var k=null,G=null;if(y=y.firstBaseUpdate,y!==null){do{var se={lane:y.lane,tag:y.tag,payload:y.payload,callback:null,next:null};G===null?k=G=se:G=G.next=se,y=y.next}while(y!==null);G===null?k=G=f:G=G.next=f}else k=G=f;y={baseState:I.baseState,firstBaseUpdate:k,lastBaseUpdate:G,shared:I.shared,callbacks:I.callbacks},o.updateQueue=y;return}o=y.lastBaseUpdate,o===null?y.firstBaseUpdate=f:o.next=f,y.lastBaseUpdate=f}var gu=!1;function da(){if(gu){var o=vl;if(o!==null)throw o}}function pa(o,f,y,I){gu=!1;var k=o.updateQueue;Ys=!1;var G=k.firstBaseUpdate,se=k.lastBaseUpdate,xe=k.shared.pending;if(xe!==null){k.shared.pending=null;var Ne=xe,ot=Ne.next;Ne.next=null,se===null?G=ot:se.next=ot,se=Ne;var Pt=o.alternate;Pt!==null&&(Pt=Pt.updateQueue,xe=Pt.lastBaseUpdate,xe!==se&&(xe===null?Pt.firstBaseUpdate=ot:xe.next=ot,Pt.lastBaseUpdate=Ne))}if(G!==null){var $t=k.baseState;se=0,Pt=ot=Ne=null,xe=G;do{var xt=xe.lane&-536870913,Lt=xt!==xe.lane;if(Lt?(_i&xt)===xt:(I&xt)===xt){xt!==0&&xt===ho&&(gu=!0),Pt!==null&&(Pt=Pt.next={lane:0,tag:xe.tag,payload:xe.payload,callback:null,next:null});e:{var Li=o,dr=xe;xt=f;var En=y;switch(dr.tag){case 1:if(Li=dr.payload,typeof Li=="function"){$t=Li.call(En,$t,xt);break e}$t=Li;break e;case 3:Li.flags=Li.flags&-65537|128;case 0:if(Li=dr.payload,xt=typeof Li=="function"?Li.call(En,$t,xt):Li,xt==null)break e;$t=kt({},$t,xt);break e;case 2:Ys=!0}}xt=xe.callback,xt!==null&&(o.flags|=64,Lt&&(o.flags|=8192),Lt=k.callbacks,Lt===null?k.callbacks=[xt]:Lt.push(xt))}else Lt={lane:xt,tag:xe.tag,payload:xe.payload,callback:xe.callback,next:null},Pt===null?(ot=Pt=Lt,Ne=$t):Pt=Pt.next=Lt,se|=xt;if(xe=xe.next,xe===null){if(xe=k.shared.pending,xe===null)break;Lt=xe,xe=Lt.next,Lt.next=null,k.lastBaseUpdate=Lt,k.shared.pending=null}}while(!0);Pt===null&&(Ne=$t),k.baseState=Ne,k.firstBaseUpdate=ot,k.lastBaseUpdate=Pt,G===null&&(k.shared.lanes=0),fr|=se,o.lanes=se,o.memoizedState=$t}}function gc(o,f){if(typeof o!="function")throw Error(M(191,o));o.call(f)}function Ll(o,f){var y=o.callbacks;if(y!==null)for(o.callbacks=null,o=0;o<y.length;o++)gc(y[o],f)}function Ws(o,f){try{var y=f.updateQueue,I=y!==null?y.lastEffect:null;if(I!==null){var k=I.next;y=k;do{if((y.tag&o)===o){I=void 0;var G=y.create,se=y.inst;I=G(),se.destroy=I}y=y.next}while(y!==k)}}catch(xe){on(f,f.return,xe)}}function yo(o,f,y){try{var I=f.updateQueue,k=I!==null?I.lastEffect:null;if(k!==null){var G=k.next;I=G;do{if((I.tag&o)===o){var se=I.inst,xe=se.destroy;if(xe!==void 0){se.destroy=void 0,k=f;var Ne=y;try{xe()}catch(ot){on(k,Ne,ot)}}}I=I.next}while(I!==G)}}catch(ot){on(f,f.return,ot)}}function ir(o){var f=o.updateQueue;if(f!==null){var y=o.stateNode;try{Ll(f,y)}catch(I){on(o,o.return,I)}}}function Xo(o,f,y){y.props=Go(o.type,o.memoizedProps),y.state=o.memoizedState;try{y.componentWillUnmount()}catch(I){on(o,f,I)}}function yc(o,f){try{var y=o.ref;if(y!==null){var I=o.stateNode;switch(o.tag){case 26:case 27:case 5:var k=I;break;default:k=I}typeof y=="function"?o.refCleanup=y(k):y.current=k}}catch(G){on(o,f,G)}}function ns(o,f){var y=o.ref,I=o.refCleanup;if(y!==null)if(typeof I=="function")try{I()}catch(k){on(o,f,k)}finally{o.refCleanup=null,o=o.alternate,o!=null&&(o.refCleanup=null)}else if(typeof y=="function")try{y(null)}catch(k){on(o,f,k)}else y.current=null}function vh(o){var f=o.type,y=o.memoizedProps,I=o.stateNode;try{e:switch(f){case"button":case"input":case"select":case"textarea":y.autoFocus&&I.focus();break e;case"img":y.src?I.src=y.src:y.srcSet&&(I.srcset=y.srcSet)}}catch(k){on(o,o.return,k)}}function $s(o,f,y){try{var I=o.stateNode;gg(I,o.type,y,f),I[oe]=f}catch(k){on(o,o.return,k)}}function Is(o){return o.tag===5||o.tag===3||o.tag===26||o.tag===27||o.tag===4}function sa(o){e:for(;;){for(;o.sibling===null;){if(o.return===null||Is(o.return))return null;o=o.return}for(o.sibling.return=o.return,o=o.sibling;o.tag!==5&&o.tag!==6&&o.tag!==27&&o.tag!==18;){if(o.flags&2||o.child===null||o.tag===4)continue e;o.child.return=o,o=o.child}if(!(o.flags&2))return o.stateNode}}function va(o,f,y){var I=o.tag;if(I===5||I===6)o=o.stateNode,f?y.nodeType===8?y.parentNode.insertBefore(o,f):y.insertBefore(o,f):(y.nodeType===8?(f=y.parentNode,f.insertBefore(o,y)):(f=y,f.appendChild(o)),y=y._reactRootContainer,y!=null||f.onclick!==null||(f.onclick=Nl));else if(I!==4&&I!==27&&(o=o.child,o!==null))for(va(o,f,y),o=o.sibling;o!==null;)va(o,f,y),o=o.sibling}function gn(o,f,y){var I=o.tag;if(I===5||I===6)o=o.stateNode,f?y.insertBefore(o,f):y.appendChild(o);else if(I!==4&&I!==27&&(o=o.child,o!==null))for(gn(o,f,y),o=o.sibling;o!==null;)gn(o,f,y),o=o.sibling}var vo=!1,Tr=!1,xh=!1,vc=typeof WeakSet=="function"?WeakSet:Set,c=null,t=!1;function r(o,f){if(o=o.containerInfo,If=jd,o=$h(o),od(o)){if("selectionStart"in o)var y={start:o.selectionStart,end:o.selectionEnd};else e:{y=(y=o.ownerDocument)&&y.defaultView||window;var I=y.getSelection&&y.getSelection();if(I&&I.rangeCount!==0){y=I.anchorNode;var k=I.anchorOffset,G=I.focusNode;I=I.focusOffset;try{y.nodeType,G.nodeType}catch{y=null;break e}var se=0,xe=-1,Ne=-1,ot=0,Pt=0,$t=o,xt=null;t:for(;;){for(var Lt;$t!==y||k!==0&&$t.nodeType!==3||(xe=se+k),$t!==G||I!==0&&$t.nodeType!==3||(Ne=se+I),$t.nodeType===3&&(se+=$t.nodeValue.length),(Lt=$t.firstChild)!==null;)xt=$t,$t=Lt;for(;;){if($t===o)break t;if(xt===y&&++ot===k&&(xe=se),xt===G&&++Pt===I&&(Ne=se),(Lt=$t.nextSibling)!==null)break;$t=xt,xt=$t.parentNode}$t=Lt}y=xe===-1||Ne===-1?null:{start:xe,end:Ne}}else y=null}y=y||{start:0,end:0}}else y=null;for(qp={focusedElem:o,selectionRange:y},jd=!1,c=f;c!==null;)if(f=c,o=f.child,(f.subtreeFlags&1028)!==0&&o!==null)o.return=f,c=o;else for(;c!==null;){switch(f=c,G=f.alternate,o=f.flags,f.tag){case 0:break;case 11:case 15:break;case 1:if((o&1024)!==0&&G!==null){o=void 0,y=f,k=G.memoizedProps,G=G.memoizedState,I=y.stateNode;try{var Li=Go(y.type,k,y.elementType===y.type);o=I.getSnapshotBeforeUpdate(Li,G),I.__reactInternalSnapshotBeforeUpdate=o}catch(dr){on(y,y.return,dr)}}break;case 3:if((o&1024)!==0){if(o=f.stateNode.containerInfo,y=o.nodeType,y===9)kd(o);else if(y===1)switch(o.nodeName){case"HEAD":case"HTML":case"BODY":kd(o);break;default:o.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((o&1024)!==0)throw Error(M(163))}if(o=f.sibling,o!==null){o.return=f.return,c=o;break}c=f.return}return Li=t,t=!1,Li}function u(o,f,y){var I=y.flags;switch(y.tag){case 0:case 11:case 15:ee(o,y),I&4&&Ws(5,y);break;case 1:if(ee(o,y),I&4)if(o=y.stateNode,f===null)try{o.componentDidMount()}catch(xe){on(y,y.return,xe)}else{var k=Go(y.type,f.memoizedProps);f=f.memoizedState;try{o.componentDidUpdate(k,f,o.__reactInternalSnapshotBeforeUpdate)}catch(xe){on(y,y.return,xe)}}I&64&&ir(y),I&512&&yc(y,y.return);break;case 3:if(ee(o,y),I&64&&(I=y.updateQueue,I!==null)){if(o=null,y.child!==null)switch(y.child.tag){case 27:case 5:o=y.child.stateNode;break;case 1:o=y.child.stateNode}try{Ll(I,o)}catch(xe){on(y,y.return,xe)}}break;case 26:ee(o,y),I&512&&yc(y,y.return);break;case 27:case 5:ee(o,y),f===null&&I&4&&vh(y),I&512&&yc(y,y.return);break;case 12:ee(o,y);break;case 13:ee(o,y),I&4&&P(o,y);break;case 22:if(k=y.memoizedState!==null||vo,!k){f=f!==null&&f.memoizedState!==null||Tr;var G=vo,se=Tr;vo=k,(Tr=f)&&!se?pe(o,y,(y.subtreeFlags&8772)!==0):ee(o,y),vo=G,Tr=se}I&512&&(y.memoizedProps.mode==="manual"?yc(y,y.return):ns(y,y.return));break;default:ee(o,y)}}function p(o){var f=o.alternate;f!==null&&(o.alternate=null,p(f)),o.child=null,o.deletions=null,o.sibling=null,o.tag===5&&(f=o.stateNode,f!==null&&He(f)),o.stateNode=null,o.return=null,o.dependencies=null,o.memoizedProps=null,o.memoizedState=null,o.pendingProps=null,o.stateNode=null,o.updateQueue=null}var _=null,b=!1;function C(o,f,y){for(y=y.child;y!==null;)O(o,f,y),y=y.sibling}function O(o,f,y){if(Kn&&typeof Kn.onCommitFiberUnmount=="function")try{Kn.onCommitFiberUnmount(Bn,y)}catch{}switch(y.tag){case 26:Tr||ns(y,f),C(o,f,y),y.memoizedState?y.memoizedState.count--:y.stateNode&&(y=y.stateNode,y.parentNode.removeChild(y));break;case 27:Tr||ns(y,f);var I=_,k=b;for(_=y.stateNode,C(o,f,y),y=y.stateNode,f=y.attributes;f.length;)y.removeAttributeNode(f[0]);He(y),_=I,b=k;break;case 5:Tr||ns(y,f);case 6:k=_;var G=b;if(_=null,C(o,f,y),_=k,b=G,_!==null)if(b)try{o=_,I=y.stateNode,o.nodeType===8?o.parentNode.removeChild(I):o.removeChild(I)}catch(se){on(y,f,se)}else try{_.removeChild(y.stateNode)}catch(se){on(y,f,se)}break;case 18:_!==null&&(b?(f=_,y=y.stateNode,f.nodeType===8?Zp(f.parentNode,y):f.nodeType===1&&Zp(f,y),Hd(f)):Zp(_,y.stateNode));break;case 4:I=_,k=b,_=y.stateNode.containerInfo,b=!0,C(o,f,y),_=I,b=k;break;case 0:case 11:case 14:case 15:Tr||yo(2,y,f),Tr||yo(4,y,f),C(o,f,y);break;case 1:Tr||(ns(y,f),I=y.stateNode,typeof I.componentWillUnmount=="function"&&Xo(y,f,I)),C(o,f,y);break;case 21:C(o,f,y);break;case 22:Tr||ns(y,f),Tr=(I=Tr)||y.memoizedState!==null,C(o,f,y),Tr=I;break;default:C(o,f,y)}}function P(o,f){if(f.memoizedState===null&&(o=f.alternate,o!==null&&(o=o.memoizedState,o!==null&&(o=o.dehydrated,o!==null))))try{Hd(o)}catch(y){on(f,f.return,y)}}function F(o){switch(o.tag){case 13:case 19:var f=o.stateNode;return f===null&&(f=o.stateNode=new vc),f;case 22:return o=o.stateNode,f=o._retryCache,f===null&&(f=o._retryCache=new vc),f;default:throw Error(M(435,o.tag))}}function V(o,f){var y=F(o);f.forEach(function(I){var k=hg.bind(null,o,I);y.has(I)||(y.add(I),I.then(k,k))})}function U(o,f){var y=f.deletions;if(y!==null)for(var I=0;I<y.length;I++){var k=y[I],G=o,se=f,xe=se;e:for(;xe!==null;){switch(xe.tag){case 27:case 5:_=xe.stateNode,b=!1;break e;case 3:_=xe.stateNode.containerInfo,b=!0;break e;case 4:_=xe.stateNode.containerInfo,b=!0;break e}xe=xe.return}if(_===null)throw Error(M(160));O(G,se,k),_=null,b=!1,G=k.alternate,G!==null&&(G.return=null),k.return=null}if(f.subtreeFlags&13878)for(f=f.child;f!==null;)J(f,o),f=f.sibling}var H=null;function J(o,f){var y=o.alternate,I=o.flags;switch(o.tag){case 0:case 11:case 14:case 15:U(f,o),$(o),I&4&&(yo(3,o,o.return),Ws(3,o),yo(5,o,o.return));break;case 1:U(f,o),$(o),I&512&&(Tr||y===null||ns(y,y.return)),I&64&&vo&&(o=o.updateQueue,o!==null&&(I=o.callbacks,I!==null&&(y=o.shared.hiddenCallbacks,o.shared.hiddenCallbacks=y===null?I:y.concat(I))));break;case 26:var k=H;if(U(f,o),$(o),I&512&&(Tr||y===null||ns(y,y.return)),I&4){var G=y!==null?y.memoizedState:null;if(I=o.memoizedState,y===null)if(I===null)if(o.stateNode===null){e:{I=o.type,y=o.memoizedProps,k=k.ownerDocument||k;t:switch(I){case"title":G=k.getElementsByTagName("title")[0],(!G||G[Ze]||G[ie]||G.namespaceURI==="http://www.w3.org/2000/svg"||G.hasAttribute("itemprop"))&&(G=k.createElement(I),k.head.insertBefore(G,k.querySelector("head > title"))),wa(G,I,y),G[ie]=o,Jt(G),I=G;break e;case"link":var se=t_("link","href",k).get(I+(y.href||""));if(se){for(var xe=0;xe<se.length;xe++)if(G=se[xe],G.getAttribute("href")===(y.href==null?null:y.href)&&G.getAttribute("rel")===(y.rel==null?null:y.rel)&&G.getAttribute("title")===(y.title==null?null:y.title)&&G.getAttribute("crossorigin")===(y.crossOrigin==null?null:y.crossOrigin)){se.splice(xe,1);break t}}G=k.createElement(I),wa(G,I,y),k.head.appendChild(G);break;case"meta":if(se=t_("meta","content",k).get(I+(y.content||""))){for(xe=0;xe<se.length;xe++)if(G=se[xe],G.getAttribute("content")===(y.content==null?null:""+y.content)&&G.getAttribute("name")===(y.name==null?null:y.name)&&G.getAttribute("property")===(y.property==null?null:y.property)&&G.getAttribute("http-equiv")===(y.httpEquiv==null?null:y.httpEquiv)&&G.getAttribute("charset")===(y.charSet==null?null:y.charSet)){se.splice(xe,1);break t}}G=k.createElement(I),wa(G,I,y),k.head.appendChild(G);break;default:throw Error(M(468,I))}G[ie]=o,Jt(G),I=G}o.stateNode=I}else Ag(k,o.type,o.stateNode);else o.stateNode=Mg(k,I,o.memoizedProps);else G!==I?(G===null?y.stateNode!==null&&(y=y.stateNode,y.parentNode.removeChild(y)):G.count--,I===null?Ag(k,o.type,o.stateNode):Mg(k,I,o.memoizedProps)):I===null&&o.stateNode!==null&&$s(o,o.memoizedProps,y.memoizedProps)}break;case 27:if(I&4&&o.alternate===null){k=o.stateNode,G=o.memoizedProps;try{for(var Ne=k.firstChild;Ne;){var ot=Ne.nextSibling,Pt=Ne.nodeName;Ne[Ze]||Pt==="HEAD"||Pt==="BODY"||Pt==="SCRIPT"||Pt==="STYLE"||Pt==="LINK"&&Ne.rel.toLowerCase()==="stylesheet"||k.removeChild(Ne),Ne=ot}for(var $t=o.type,xt=k.attributes;xt.length;)k.removeAttributeNode(xt[0]);wa(k,$t,G),k[ie]=o,k[oe]=G}catch(Li){on(o,o.return,Li)}}case 5:if(U(f,o),$(o),I&512&&(Tr||y===null||ns(y,y.return)),o.flags&32){k=o.stateNode;try{Mo(k,"")}catch(Li){on(o,o.return,Li)}}I&4&&o.stateNode!=null&&(k=o.memoizedProps,$s(o,k,y!==null?y.memoizedProps:k)),I&1024&&(xh=!0);break;case 6:if(U(f,o),$(o),I&4){if(o.stateNode===null)throw Error(M(162));I=o.memoizedProps,y=o.stateNode;try{y.nodeValue=I}catch(Li){on(o,o.return,Li)}}break;case 3:if(Nd=null,k=H,H=bu(f.containerInfo),U(f,o),H=k,$(o),I&4&&y!==null&&y.memoizedState.isDehydrated)try{Hd(f.containerInfo)}catch(Li){on(o,o.return,Li)}xh&&(xh=!1,te(o));break;case 4:I=H,H=bu(o.stateNode.containerInfo),U(f,o),$(o),H=I;break;case 12:U(f,o),$(o);break;case 13:U(f,o),$(o),o.child.flags&8192&&o.memoizedState!==null!=(y!==null&&y.memoizedState!==null)&&(xa=Mi()),I&4&&(I=o.updateQueue,I!==null&&(o.updateQueue=null,V(o,I)));break;case 22:if(I&512&&(Tr||y===null||ns(y,y.return)),Ne=o.memoizedState!==null,ot=y!==null&&y.memoizedState!==null,Pt=vo,$t=Tr,vo=Pt||Ne,Tr=$t||ot,U(f,o),Tr=$t,vo=Pt,$(o),f=o.stateNode,f._current=o,f._visibility&=-3,f._visibility|=f._pendingVisibility&2,I&8192&&(f._visibility=Ne?f._visibility&-2:f._visibility|1,Ne&&(f=vo||Tr,y===null||ot||f||le(o)),o.memoizedProps===null||o.memoizedProps.mode!=="manual"))e:for(y=null,f=o;;){if(f.tag===5||f.tag===26||f.tag===27){if(y===null){ot=y=f;try{if(k=ot.stateNode,Ne)G=k.style,typeof G.setProperty=="function"?G.setProperty("display","none","important"):G.display="none";else{se=ot.stateNode,xe=ot.memoizedProps.style;var Lt=xe!=null&&xe.hasOwnProperty("display")?xe.display:null;se.style.display=Lt==null||typeof Lt=="boolean"?"":(""+Lt).trim()}}catch(Li){on(ot,ot.return,Li)}}}else if(f.tag===6){if(y===null){ot=f;try{ot.stateNode.nodeValue=Ne?"":ot.memoizedProps}catch(Li){on(ot,ot.return,Li)}}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===o)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===o)break e;for(;f.sibling===null;){if(f.return===null||f.return===o)break e;y===f&&(y=null),f=f.return}y===f&&(y=null),f.sibling.return=f.return,f=f.sibling}I&4&&(I=o.updateQueue,I!==null&&(y=I.retryQueue,y!==null&&(I.retryQueue=null,V(o,y))));break;case 19:U(f,o),$(o),I&4&&(I=o.updateQueue,I!==null&&(o.updateQueue=null,V(o,I)));break;case 21:break;default:U(f,o),$(o)}}function $(o){var f=o.flags;if(f&2){try{if(o.tag!==27){e:{for(var y=o.return;y!==null;){if(Is(y)){var I=y;break e}y=y.return}throw Error(M(160))}switch(I.tag){case 27:var k=I.stateNode,G=sa(o);gn(o,G,k);break;case 5:var se=I.stateNode;I.flags&32&&(Mo(se,""),I.flags&=-33);var xe=sa(o);gn(o,xe,se);break;case 3:case 4:var Ne=I.stateNode.containerInfo,ot=sa(o);va(o,ot,Ne);break;default:throw Error(M(161))}}}catch(Pt){on(o,o.return,Pt)}o.flags&=-3}f&4096&&(o.flags&=-4097)}function te(o){if(o.subtreeFlags&1024)for(o=o.child;o!==null;){var f=o;te(f),f.tag===5&&f.flags&1024&&f.stateNode.reset(),o=o.sibling}}function ee(o,f){if(f.subtreeFlags&8772)for(f=f.child;f!==null;)u(o,f.alternate,f),f=f.sibling}function le(o){for(o=o.child;o!==null;){var f=o;switch(f.tag){case 0:case 11:case 14:case 15:yo(4,f,f.return),le(f);break;case 1:ns(f,f.return);var y=f.stateNode;typeof y.componentWillUnmount=="function"&&Xo(f,f.return,y),le(f);break;case 26:case 27:case 5:ns(f,f.return),le(f);break;case 22:ns(f,f.return),f.memoizedState===null&&le(f);break;default:le(f)}o=o.sibling}}function pe(o,f,y){for(y=y&&(f.subtreeFlags&8772)!==0,f=f.child;f!==null;){var I=f.alternate,k=o,G=f,se=G.flags;switch(G.tag){case 0:case 11:case 15:pe(k,G,y),Ws(4,G);break;case 1:if(pe(k,G,y),I=G,k=I.stateNode,typeof k.componentDidMount=="function")try{k.componentDidMount()}catch(ot){on(I,I.return,ot)}if(I=G,k=I.updateQueue,k!==null){var xe=I.stateNode;try{var Ne=k.shared.hiddenCallbacks;if(Ne!==null)for(k.shared.hiddenCallbacks=null,k=0;k<Ne.length;k++)gc(Ne[k],xe)}catch(ot){on(I,I.return,ot)}}y&&se&64&&ir(G),yc(G,G.return);break;case 26:case 27:case 5:pe(k,G,y),y&&I===null&&se&4&&vh(G),yc(G,G.return);break;case 12:pe(k,G,y);break;case 13:pe(k,G,y),y&&se&4&&P(k,G);break;case 22:G.memoizedState===null&&pe(k,G,y),yc(G,G.return);break;default:pe(k,G,y)}f=f.sibling}}function fe(o,f){var y=null;o!==null&&o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(y=o.memoizedState.cachePool.pool),o=null,f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(o=f.memoizedState.cachePool.pool),o!==y&&(o!=null&&o.refCount++,y!=null&&Bo(y))}function be(o,f){o=null,f.alternate!==null&&(o=f.alternate.memoizedState.cache),f=f.memoizedState.cache,f!==o&&(f.refCount++,o!=null&&Bo(o))}function me(o,f,y,I){if(f.subtreeFlags&10256)for(f=f.child;f!==null;)ve(o,f,y,I),f=f.sibling}function ve(o,f,y,I){var k=f.flags;switch(f.tag){case 0:case 11:case 15:me(o,f,y,I),k&2048&&Ws(9,f);break;case 3:me(o,f,y,I),k&2048&&(o=null,f.alternate!==null&&(o=f.alternate.memoizedState.cache),f=f.memoizedState.cache,f!==o&&(f.refCount++,o!=null&&Bo(o)));break;case 12:if(k&2048){me(o,f,y,I),o=f.stateNode;try{var G=f.memoizedProps,se=G.id,xe=G.onPostCommit;typeof xe=="function"&&xe(se,f.alternate===null?"mount":"update",o.passiveEffectDuration,-0)}catch(Ne){on(f,f.return,Ne)}}else me(o,f,y,I);break;case 23:break;case 22:G=f.stateNode,f.memoizedState!==null?G._visibility&4?me(o,f,y,I):Ee(o,f):G._visibility&4?me(o,f,y,I):(G._visibility|=4,_e(o,f,y,I,(f.subtreeFlags&10256)!==0)),k&2048&&fe(f.alternate,f);break;case 24:me(o,f,y,I),k&2048&&be(f.alternate,f);break;default:me(o,f,y,I)}}function _e(o,f,y,I,k){for(k=k&&(f.subtreeFlags&10256)!==0,f=f.child;f!==null;){var G=o,se=f,xe=y,Ne=I,ot=se.flags;switch(se.tag){case 0:case 11:case 15:_e(G,se,xe,Ne,k),Ws(8,se);break;case 23:break;case 22:var Pt=se.stateNode;se.memoizedState!==null?Pt._visibility&4?_e(G,se,xe,Ne,k):Ee(G,se):(Pt._visibility|=4,_e(G,se,xe,Ne,k)),k&&ot&2048&&fe(se.alternate,se);break;case 24:_e(G,se,xe,Ne,k),k&&ot&2048&&be(se.alternate,se);break;default:_e(G,se,xe,Ne,k)}f=f.sibling}}function Ee(o,f){if(f.subtreeFlags&10256)for(f=f.child;f!==null;){var y=o,I=f,k=I.flags;switch(I.tag){case 22:Ee(y,I),k&2048&&fe(I.alternate,I);break;case 24:Ee(y,I),k&2048&&be(I.alternate,I);break;default:Ee(y,I)}f=f.sibling}}var ze=8192;function Ye(o){if(o.subtreeFlags&ze)for(o=o.child;o!==null;)qe(o),o=o.sibling}function qe(o){switch(o.tag){case 26:Ye(o),o.flags&ze&&o.memoizedState!==null&&Jy(H,o.memoizedState,o.memoizedProps);break;case 5:Ye(o);break;case 3:case 4:var f=H;H=bu(o.stateNode.containerInfo),Ye(o),H=f;break;case 22:o.memoizedState===null&&(f=o.alternate,f!==null&&f.memoizedState!==null?(f=ze,ze=16777216,Ye(o),ze=f):Ye(o));break;default:Ye(o)}}function lt(o){var f=o.alternate;if(f!==null&&(o=f.child,o!==null)){f.child=null;do f=o.sibling,o.sibling=null,o=f;while(o!==null)}}function it(o){var f=o.deletions;if((o.flags&16)!==0){if(f!==null)for(var y=0;y<f.length;y++){var I=f[y];c=I,gt(I,o)}lt(o)}if(o.subtreeFlags&10256)for(o=o.child;o!==null;)Be(o),o=o.sibling}function Be(o){switch(o.tag){case 0:case 11:case 15:it(o),o.flags&2048&&yo(9,o,o.return);break;case 3:it(o);break;case 12:it(o);break;case 22:var f=o.stateNode;o.memoizedState!==null&&f._visibility&4&&(o.return===null||o.return.tag!==13)?(f._visibility&=-5,Ke(o)):it(o);break;default:it(o)}}function Ke(o){var f=o.deletions;if((o.flags&16)!==0){if(f!==null)for(var y=0;y<f.length;y++){var I=f[y];c=I,gt(I,o)}lt(o)}for(o=o.child;o!==null;){switch(f=o,f.tag){case 0:case 11:case 15:yo(8,f,f.return),Ke(f);break;case 22:y=f.stateNode,y._visibility&4&&(y._visibility&=-5,Ke(f));break;default:Ke(f)}o=o.sibling}}function gt(o,f){for(;c!==null;){var y=c;switch(y.tag){case 0:case 11:case 15:yo(8,y,f);break;case 23:case 22:if(y.memoizedState!==null&&y.memoizedState.cachePool!==null){var I=y.memoizedState.cachePool.pool;I!=null&&I.refCount++}break;case 24:Bo(y.memoizedState.cache)}if(I=y.child,I!==null)I.return=y,c=I;else e:for(y=o;c!==null;){I=c;var k=I.sibling,G=I.return;if(p(I),I===y){c=null;break e}if(k!==null){k.return=G,c=k;break e}c=G}}}function Fe(o,f,y,I){this.tag=o,this.key=y,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=f,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=I,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function st(o,f,y,I){return new Fe(o,f,y,I)}function Je(o){return o=o.prototype,!(!o||!o.isReactComponent)}function St(o,f){var y=o.alternate;return y===null?(y=st(o.tag,f,o.key,o.mode),y.elementType=o.elementType,y.type=o.type,y.stateNode=o.stateNode,y.alternate=o,o.alternate=y):(y.pendingProps=f,y.type=o.type,y.flags=0,y.subtreeFlags=0,y.deletions=null),y.flags=o.flags&31457280,y.childLanes=o.childLanes,y.lanes=o.lanes,y.child=o.child,y.memoizedProps=o.memoizedProps,y.memoizedState=o.memoizedState,y.updateQueue=o.updateQueue,f=o.dependencies,y.dependencies=f===null?null:{lanes:f.lanes,firstContext:f.firstContext},y.sibling=o.sibling,y.index=o.index,y.ref=o.ref,y.refCleanup=o.refCleanup,y}function dt(o,f){o.flags&=31457282;var y=o.alternate;return y===null?(o.childLanes=0,o.lanes=f,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=y.childLanes,o.lanes=y.lanes,o.child=y.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=y.memoizedProps,o.memoizedState=y.memoizedState,o.updateQueue=y.updateQueue,o.type=y.type,f=y.dependencies,o.dependencies=f===null?null:{lanes:f.lanes,firstContext:f.firstContext}),o}function ct(o,f,y,I,k,G){var se=0;if(I=o,typeof o=="function")Je(o)&&(se=1);else if(typeof o=="string")se=Qy(o,y,Ea.current)?26:o==="html"||o==="head"||o==="body"?27:5;else e:switch(o){case ae:return vt(y.children,k,G,f);case ne:se=8,k|=24;break;case ge:return o=st(12,y,f,k|2),o.elementType=ge,o.lanes=G,o;case tt:return o=st(13,y,f,k),o.elementType=tt,o.lanes=G,o;case pt:return o=st(19,y,f,k),o.elementType=pt,o.lanes=G,o;case Tt:return Ct(y,k,G,f);default:if(typeof o=="object"&&o!==null)switch(o.$$typeof){case Ie:case je:se=10;break e;case Re:se=9;break e;case Qe:se=11;break e;case $e:se=14;break e;case Et:se=16,I=null;break e}se=29,y=Error(M(130,o===null?"null":typeof o,"")),I=null}return f=st(se,y,f,k),f.elementType=o,f.type=I,f.lanes=G,f}function vt(o,f,y,I){return o=st(7,o,I,f),o.lanes=y,o}function Ct(o,f,y,I){o=st(22,o,I,f),o.elementType=Tt,o.lanes=y;var k={_visibility:1,_pendingVisibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null,_current:null,detach:function(){var G=k._current;if(G===null)throw Error(M(456));if((k._pendingVisibility&2)===0){var se=Qa(G,2);se!==null&&(k._pendingVisibility|=2,os(se,G,2))}},attach:function(){var G=k._current;if(G===null)throw Error(M(456));if((k._pendingVisibility&2)!==0){var se=Qa(G,2);se!==null&&(k._pendingVisibility&=-3,os(se,G,2))}}};return o.stateNode=k,o}function Vt(o,f,y){return o=st(6,o,null,f),o.lanes=y,o}function Yt(o,f,y){return f=st(4,o.children!==null?o.children:[],o.key,f),f.lanes=y,f.stateNode={containerInfo:o.containerInfo,pendingChildren:null,implementation:o.implementation},f}function ui(o){o.flags|=4}function oi(o,f){if(f.type!=="stylesheet"||(f.state.loading&4)!==0)o.flags&=-16777217;else if(o.flags|=16777216,!Cg(f)){if(f=ga.current,f!==null&&((_i&4194176)===_i?ws!==null:(_i&62914560)!==_i&&(_i&536870912)===0||f!==ws))throw Ku=fd,mp;o.flags|=8192}}function ri(o,f){f!==null&&(o.flags|=4),o.flags&16384&&(f=o.tag!==22?zu():536870912,o.lanes|=f,en|=f)}function xi(o,f){if(!Mr)switch(o.tailMode){case"hidden":f=o.tail;for(var y=null;f!==null;)f.alternate!==null&&(y=f),f=f.sibling;y===null?o.tail=null:y.sibling=null;break;case"collapsed":y=o.tail;for(var I=null;y!==null;)y.alternate!==null&&(I=y),y=y.sibling;I===null?f||o.tail===null?o.tail=null:o.tail.sibling=null:I.sibling=null}}function bi(o){var f=o.alternate!==null&&o.alternate.child===o.child,y=0,I=0;if(f)for(var k=o.child;k!==null;)y|=k.lanes|k.childLanes,I|=k.subtreeFlags&31457280,I|=k.flags&31457280,k.return=o,k=k.sibling;else for(k=o.child;k!==null;)y|=k.lanes|k.childLanes,I|=k.subtreeFlags,I|=k.flags,k.return=o,k=k.sibling;return o.subtreeFlags|=I,o.childLanes=y,f}function pr(o,f,y){var I=f.pendingProps;switch(Kh(f),f.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return bi(f),null;case 1:return bi(f),null;case 3:return y=f.stateNode,I=null,o!==null&&(I=o.memoizedState.cache),f.memoizedState.cache!==I&&(f.flags|=2048),za(fn),Dn(),y.pendingContext&&(y.context=y.pendingContext,y.pendingContext=null),(o===null||o.child===null)&&(ml(f)?ui(f):o===null||o.memoizedState.isDehydrated&&(f.flags&256)===0||(f.flags|=1024,Va!==null&&(Cp(Va),Va=null))),bi(f),null;case 26:return y=f.memoizedState,o===null?(ui(f),y!==null?(bi(f),oi(f,y)):(bi(f),f.flags&=-16777217)):y?y!==o.memoizedState?(ui(f),bi(f),oi(f,y)):(bi(f),f.flags&=-16777217):(o.memoizedProps!==I&&ui(f),bi(f),f.flags&=-16777217),null;case 27:Yi(f),y=Pa.current;var k=f.type;if(o!==null&&f.stateNode!=null)o.memoizedProps!==I&&ui(f);else{if(!I){if(f.stateNode===null)throw Error(M(166));return bi(f),null}o=Ea.current,ml(f)?Jh(f):(o=Qm(k,I,y),f.stateNode=o,ui(f))}return bi(f),null;case 5:if(Yi(f),y=f.type,o!==null&&f.stateNode!=null)o.memoizedProps!==I&&ui(f);else{if(!I){if(f.stateNode===null)throw Error(M(166));return bi(f),null}if(o=Ea.current,ml(f))Jh(f);else{switch(k=Ch(Pa.current),o){case 1:o=k.createElementNS("http://www.w3.org/2000/svg",y);break;case 2:o=k.createElementNS("http://www.w3.org/1998/Math/MathML",y);break;default:switch(y){case"svg":o=k.createElementNS("http://www.w3.org/2000/svg",y);break;case"math":o=k.createElementNS("http://www.w3.org/1998/Math/MathML",y);break;case"script":o=k.createElement("div"),o.innerHTML="<script><\/script>",o=o.removeChild(o.firstChild);break;case"select":o=typeof I.is=="string"?k.createElement("select",{is:I.is}):k.createElement("select"),I.multiple?o.multiple=!0:I.size&&(o.size=I.size);break;default:o=typeof I.is=="string"?k.createElement(y,{is:I.is}):k.createElement(y)}}o[ie]=f,o[oe]=I;e:for(k=f.child;k!==null;){if(k.tag===5||k.tag===6)o.appendChild(k.stateNode);else if(k.tag!==4&&k.tag!==27&&k.child!==null){k.child.return=k,k=k.child;continue}if(k===f)break e;for(;k.sibling===null;){if(k.return===null||k.return===f)break e;k=k.return}k.sibling.return=k.return,k=k.sibling}f.stateNode=o;e:switch(wa(o,y,I),y){case"button":case"input":case"select":case"textarea":o=!!I.autoFocus;break e;case"img":o=!0;break e;default:o=!1}o&&ui(f)}}return bi(f),f.flags&=-16777217,null;case 6:if(o&&f.stateNode!=null)o.memoizedProps!==I&&ui(f);else{if(typeof I!="string"&&f.stateNode===null)throw Error(M(166));if(o=Pa.current,ml(f)){if(o=f.stateNode,y=f.memoizedProps,I=null,k=Zr,k!==null)switch(k.tag){case 27:case 5:I=k.memoizedProps}o[ie]=f,o=!!(o.nodeValue===y||I!==null&&I.suppressHydrationWarning===!0||Ah(o.nodeValue,y)),o||co(f)}else o=Ch(o).createTextNode(I),o[ie]=f,f.stateNode=o}return bi(f),null;case 13:if(I=f.memoizedState,o===null||o.memoizedState!==null&&o.memoizedState.dehydrated!==null){if(k=ml(f),I!==null&&I.dehydrated!==null){if(o===null){if(!k)throw Error(M(318));if(k=f.memoizedState,k=k!==null?k.dehydrated:null,!k)throw Error(M(317));k[ie]=f}else Wc(),(f.flags&128)===0&&(f.memoizedState=null),f.flags|=4;bi(f),k=!1}else Va!==null&&(Cp(Va),Va=null),k=!0;if(!k)return f.flags&256?(Fo(f),f):(Fo(f),null)}if(Fo(f),(f.flags&128)!==0)return f.lanes=y,f;if(y=I!==null,o=o!==null&&o.memoizedState!==null,y){I=f.child,k=null,I.alternate!==null&&I.alternate.memoizedState!==null&&I.alternate.memoizedState.cachePool!==null&&(k=I.alternate.memoizedState.cachePool.pool);var G=null;I.memoizedState!==null&&I.memoizedState.cachePool!==null&&(G=I.memoizedState.cachePool.pool),G!==k&&(I.flags|=2048)}return y!==o&&y&&(f.child.flags|=8192),ri(f,f.updateQueue),bi(f),null;case 4:return Dn(),o===null&&Vp(f.stateNode.containerInfo),bi(f),null;case 10:return za(f.type),bi(f),null;case 19:if(nn(Xn),k=f.memoizedState,k===null)return bi(f),null;if(I=(f.flags&128)!==0,G=k.rendering,G===null)if(I)xi(k,!1);else{if(Ji!==0||o!==null&&(o.flags&128)!==0)for(o=f.child;o!==null;){if(G=eh(o),G!==null){for(f.flags|=128,xi(k,!1),o=G.updateQueue,f.updateQueue=o,ri(f,o),f.subtreeFlags=0,o=y,y=f.child;y!==null;)dt(y,o),y=y.sibling;return Ae(Xn,Xn.current&1|2),f.child}o=o.sibling}k.tail!==null&&Mi()>oa&&(f.flags|=128,I=!0,xi(k,!1),f.lanes=4194304)}else{if(!I)if(o=eh(G),o!==null){if(f.flags|=128,I=!0,o=o.updateQueue,f.updateQueue=o,ri(f,o),xi(k,!0),k.tail===null&&k.tailMode==="hidden"&&!G.alternate&&!Mr)return bi(f),null}else 2*Mi()-k.renderingStartTime>oa&&y!==536870912&&(f.flags|=128,I=!0,xi(k,!1),f.lanes=4194304);k.isBackwards?(G.sibling=f.child,f.child=G):(o=k.last,o!==null?o.sibling=G:f.child=G,k.last=G)}return k.tail!==null?(f=k.tail,k.rendering=f,k.tail=f.sibling,k.renderingStartTime=Mi(),f.sibling=null,o=Xn.current,Ae(Xn,I?o&1|2:o&1),f):(bi(f),null);case 22:case 23:return Fo(f),Kc(),I=f.memoizedState!==null,o!==null?o.memoizedState!==null!==I&&(f.flags|=8192):I&&(f.flags|=8192),I?(y&536870912)!==0&&(f.flags&128)===0&&(bi(f),f.subtreeFlags&6&&(f.flags|=8192)):bi(f),y=f.updateQueue,y!==null&&ri(f,y.retryQueue),y=null,o!==null&&o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(y=o.memoizedState.cachePool.pool),I=null,f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(I=f.memoizedState.cachePool.pool),I!==y&&(f.flags|=2048),o!==null&&nn(Zt),null;case 24:return y=null,o!==null&&(y=o.memoizedState.cache),f.memoizedState.cache!==y&&(f.flags|=2048),za(fn),bi(f),null;case 25:return null}throw Error(M(156,f.tag))}function Yr(o,f){switch(Kh(f),f.tag){case 1:return o=f.flags,o&65536?(f.flags=o&-65537|128,f):null;case 3:return za(fn),Dn(),o=f.flags,(o&65536)!==0&&(o&128)===0?(f.flags=o&-65537|128,f):null;case 26:case 27:case 5:return Yi(f),null;case 13:if(Fo(f),o=f.memoizedState,o!==null&&o.dehydrated!==null){if(f.alternate===null)throw Error(M(340));Wc()}return o=f.flags,o&65536?(f.flags=o&-65537|128,f):null;case 19:return nn(Xn),null;case 4:return Dn(),null;case 10:return za(f.type),null;case 22:case 23:return Fo(f),Kc(),o!==null&&nn(Zt),o=f.flags,o&65536?(f.flags=o&-65537|128,f):null;case 24:return za(fn),null;case 25:return null;default:return null}}function Cr(o,f){switch(Kh(f),f.tag){case 3:za(fn),Dn();break;case 26:case 27:case 5:Yi(f);break;case 4:Dn();break;case 13:Fo(f);break;case 19:nn(Xn);break;case 10:za(f.type);break;case 22:case 23:Fo(f),Kc(),o!==null&&nn(Zt);break;case 24:za(fn)}}var Ai={getCacheForType:function(o){var f=ya(fn),y=f.data.get(o);return y===void 0&&(y=o(),f.data.set(o,y)),y}},rr=typeof WeakMap=="function"?WeakMap:Map,Ut=0,mi=null,hi=null,_i=0,Zi=0,Ir=null,Fr=!1,Wr=!1,Oa=!1,sn=0,Ji=0,fr=0,hr=0,Qi=0,Sr=0,en=0,mr=null,tn=null,Ha=!1,xa=0,oa=1/0,as=null,$n=null,ba=!1,ss=null,Za=0,Yo=0,Pl=null,kl=0,bh=null;function Rs(){if((Ut&2)!==0&&_i!==0)return _i&-_i;if(ai.T!==null){var o=ho;return o!==0?o:Bp()}return Ls()}function ag(){Sr===0&&(Sr=(_i&536870912)===0||Mr?Zl():536870912);var o=ga.current;return o!==null&&(o.flags|=32),Sr}function os(o,f,y){(o===mi&&Zi===2||o.cancelPendingCommit!==null)&&(yu(o,0),Fl(o,_i,Sr,!1)),Jr(o,y),((Ut&2)===0||o!==mi)&&(o===mi&&((Ut&2)===0&&(hr|=y),Ji===4&&Fl(o,_i,Sr,!1)),Qs(o))}function Bm(o,f,y){if((Ut&6)!==0)throw Error(M(327));var I=!y&&(f&60)===0&&(f&o.expiredLanes)===0||ao(o,f),k=I?Dd(o,f):Um(o,f,!0),G=I;do{if(k===0){Wr&&!I&&Fl(o,f,0,!1);break}else if(k===6)Fl(o,f,0,!Fr);else{if(y=o.current.alternate,G&&!sg(y)){k=Um(o,f,!1),G=!1;continue}if(k===2){if(G=f,o.errorRecoveryDisabledLanes&G)var se=0;else se=o.pendingLanes&-536870913,se=se!==0?se:se&536870912?536870912:0;if(se!==0){f=se;e:{var xe=o;k=mr;var Ne=xe.current.memoizedState.isDehydrated;if(Ne&&(yu(xe,se).flags|=256),se=Um(xe,se,!1),se!==2){if(Oa&&!Ne){xe.errorRecoveryDisabledLanes|=G,hr|=G,k=4;break e}G=tn,tn=k,G!==null&&Cp(G)}k=se}if(G=!1,k!==2)continue}}if(k===1){yu(o,0),Fl(o,f,0,!0);break}e:{switch(I=o,k){case 0:case 1:throw Error(M(345));case 4:if((f&4194176)===f){Fl(I,f,Sr,!Fr);break e}break;case 2:tn=null;break;case 3:case 5:break;default:throw Error(M(329))}if(I.finishedWork=y,I.finishedLanes=f,(f&62914560)===f&&(G=xa+300-Mi(),10<G)){if(Fl(I,f,Sr,!Fr),So(I,0)!==0)break e;I.timeoutHandle=Ym(Nm.bind(null,I,y,tn,as,Ha,f,Sr,hr,en,Fr,2,-0,0),G);break e}Nm(I,y,tn,as,Ha,f,Sr,hr,en,Fr,0,-0,0)}}break}while(!0);Qs(o)}function Cp(o){tn===null?tn=o:tn.push.apply(tn,o)}function Nm(o,f,y,I,k,G,se,xe,Ne,ot,Pt,$t,xt){var Lt=f.subtreeFlags;if((Lt&8192||(Lt&16785408)===16785408)&&(Vd={stylesheets:null,count:0,unsuspend:Ky},qe(f),f=ev(),f!==null)){o.cancelPendingCommit=f(cg.bind(null,o,y,I,k,se,xe,Ne,1,$t,xt)),Fl(o,G,se,!ot);return}cg(o,y,I,k,se,xe,Ne,Pt,$t,xt)}function sg(o){for(var f=o;;){var y=f.tag;if((y===0||y===11||y===15)&&f.flags&16384&&(y=f.updateQueue,y!==null&&(y=y.stores,y!==null)))for(var I=0;I<y.length;I++){var k=y[I],G=k.getSnapshot;k=k.value;try{if(!Hn(G(),k))return!1}catch{return!1}}if(y=f.child,f.subtreeFlags&16384&&y!==null)y.return=f,f=y;else{if(f===o)break;for(;f.sibling===null;){if(f.return===null||f.return===o)return!0;f=f.return}f.sibling.return=f.return,f=f.sibling}}return!0}function Fl(o,f,y,I){f&=~Qi,f&=~hr,o.suspendedLanes|=f,o.pingedLanes&=~f,I&&(o.warmLanes|=f),I=o.expirationTimes;for(var k=f;0<k;){var G=31-Nn(k),se=1<<G;I[G]=-1,k&=~se}y!==0&&Lu(o,y,f)}function Cd(){return(Ut&6)===0?(Rd(0),!1):!0}function Dp(){if(hi!==null){if(Zi===0)var o=hi.return;else o=hi,Zs=Ho=null,au(o),_l=null,gl=0,o=hi;for(;o!==null;)Cr(o.alternate,o),o=o.return;hi=null}}function yu(o,f){o.finishedWork=null,o.finishedLanes=0;var y=o.timeoutHandle;y!==-1&&(o.timeoutHandle=-1,yg(y)),y=o.cancelPendingCommit,y!==null&&(o.cancelPendingCommit=null,y()),Dp(),mi=o,hi=y=St(o.current,null),_i=f,Zi=0,Ir=null,Fr=!1,Wr=ao(o,f),Oa=!1,en=Sr=Qi=hr=fr=Ji=0,tn=mr=null,Ha=!1,(f&8)!==0&&(f|=f&32);var I=o.entangledLanes;if(I!==0)for(o=o.entanglements,I&=f;0<I;){var k=31-Nn(I),G=1<<k;f|=o[k],I&=~G}return sn=f,dl(),y}function xc(o,f){It=null,ai.H=Ms,f===uo?(f=rf(),Zi=3):f===mp?(f=rf(),Zi=4):Zi=f===Ed?8:f!==null&&typeof f=="object"&&typeof f.then=="function"?6:1,Ir=f,hi===null&&(Ji=1,ph(o,Ka(f,o.current)))}function Qn(){var o=ai.H;return ai.H=Ms,o===null?Ms:o}function Vm(){var o=ai.A;return ai.A=Ai,o}function wh(){Ji=4,Fr||(_i&4194176)!==_i&&ga.current!==null||(Wr=!0),(fr&134217727)===0&&(hr&134217727)===0||mi===null||Fl(mi,_i,Sr,!1)}function Um(o,f,y){var I=Ut;Ut|=2;var k=Qn(),G=Vm();(mi!==o||_i!==f)&&(as=null,yu(o,f)),f=!1;var se=Ji;e:do try{if(Zi!==0&&hi!==null){var xe=hi,Ne=Ir;switch(Zi){case 8:Dp(),se=6;break e;case 3:case 2:case 6:ga.current===null&&(f=!0);var ot=Zi;if(Zi=0,Ir=null,Mf(o,xe,Ne,ot),y&&Wr){se=0;break e}break;default:ot=Zi,Zi=0,Ir=null,Mf(o,xe,Ne,ot)}}Ny(),se=Ji;break}catch(Pt){xc(o,Pt)}while(!0);return f&&o.shellSuspendCounter++,Zs=Ho=null,Ut=I,ai.H=k,ai.A=G,hi===null&&(mi=null,_i=0,dl()),se}function Ny(){for(;hi!==null;)vu(hi)}function Dd(o,f){var y=Ut;Ut|=2;var I=Qn(),k=Vm();mi!==o||_i!==f?(as=null,oa=Mi()+500,yu(o,f)):Wr=ao(o,f);e:do try{if(Zi!==0&&hi!==null){f=hi;var G=Ir;t:switch(Zi){case 1:Zi=0,Ir=null,Mf(o,f,G,1);break;case 2:if(_p(G)){Zi=0,Ir=null,Ef(f);break}f=function(){Zi===2&&mi===o&&(Zi=7),Qs(o)},G.then(f,f);break e;case 3:Zi=7;break e;case 4:Zi=5;break e;case 7:_p(G)?(Zi=0,Ir=null,Ef(f)):(Zi=0,Ir=null,Mf(o,f,G,7));break;case 5:var se=null;switch(hi.tag){case 26:se=hi.memoizedState;case 5:case 27:var xe=hi;if(!se||Cg(se)){Zi=0,Ir=null;var Ne=xe.sibling;if(Ne!==null)hi=Ne;else{var ot=xe.return;ot!==null?(hi=ot,Ip(ot)):hi=null}break t}}Zi=0,Ir=null,Mf(o,f,G,5);break;case 6:Zi=0,Ir=null,Mf(o,f,G,6);break;case 8:Dp(),Ji=6;break e;default:throw Error(M(462))}}og();break}catch(Pt){xc(o,Pt)}while(!0);return Zs=Ho=null,ai.H=I,ai.A=k,Ut=y,hi!==null?0:(mi=null,_i=0,dl(),Ji)}function og(){for(;hi!==null&&!Gl();)vu(hi)}function vu(o){var f=wf(o.alternate,o,sn);o.memoizedProps=o.pendingProps,f===null?Ip(o):hi=f}function Ef(o){var f=o,y=f.alternate;switch(f.tag){case 15:case 0:f=_h(y,f,f.pendingProps,f.type,void 0,_i);break;case 11:f=_h(y,f,f.pendingProps,f.type.render,f.ref,_i);break;case 5:au(f);default:Cr(y,f),f=hi=dt(f,sn),f=wf(y,f,sn)}o.memoizedProps=o.pendingProps,f===null?Ip(o):hi=f}function Mf(o,f,y,I){Zs=Ho=null,au(f),_l=null,gl=0;var k=f.return;try{if(Sp(o,k,f,y,_i)){Ji=1,ph(o,Ka(y,o.current)),hi=null;return}}catch(G){if(k!==null)throw hi=k,G;Ji=1,ph(o,Ka(y,o.current)),hi=null;return}f.flags&32768?(Mr||I===1?o=!0:Wr||(_i&536870912)!==0?o=!1:(Fr=o=!0,(I===2||I===3||I===6)&&(I=ga.current,I!==null&&I.tag===13&&(I.flags|=16384))),lg(f,o)):Ip(f)}function Ip(o){var f=o;do{if((f.flags&32768)!==0){lg(f,Fr);return}o=f.return;var y=pr(f.alternate,f,sn);if(y!==null){hi=y;return}if(f=f.sibling,f!==null){hi=f;return}hi=f=o}while(f!==null);Ji===0&&(Ji=5)}function lg(o,f){do{var y=Yr(o.alternate,o);if(y!==null){y.flags&=32767,hi=y;return}if(y=o.return,y!==null&&(y.flags|=32768,y.subtreeFlags=0,y.deletions=null),!f&&(o=o.sibling,o!==null)){hi=o;return}hi=o=y}while(o!==null);Ji=6,hi=null}function cg(o,f,y,I,k,G,se,xe,Ne,ot){var Pt=ai.T,$t=wi.p;try{wi.p=2,ai.T=null,Vy(o,f,y,I,$t,k,G,se,xe,Ne,ot)}finally{ai.T=Pt,wi.p=$t}}function Vy(o,f,y,I,k,G,se,xe){do Af();while(ss!==null);if((Ut&6)!==0)throw Error(M(327));var Ne=o.finishedWork;if(I=o.finishedLanes,Ne===null)return null;if(o.finishedWork=null,o.finishedLanes=0,Ne===o.current)throw Error(M(177));o.callbackNode=null,o.callbackPriority=0,o.cancelPendingCommit=null;var ot=Ne.lanes|Ne.childLanes;if(ot|=fl,Ou(o,I,ot,G,se,xe),o===mi&&(hi=mi=null,_i=0),(Ne.subtreeFlags&10256)===0&&(Ne.flags&10256)===0||ba||(ba=!0,Yo=ot,Pl=y,Op(Fn,function(){return Af(),null})),y=(Ne.flags&15990)!==0,(Ne.subtreeFlags&15990)!==0||y?(y=ai.T,ai.T=null,G=wi.p,wi.p=2,se=Ut,Ut|=4,r(o,Ne),J(Ne,o),dp(qp,o.containerInfo),jd=!!If,qp=If=null,o.current=Ne,u(o,Ne.alternate,Ne),Hl(),Ut=se,wi.p=G,ai.T=y):o.current=Ne,ba?(ba=!1,ss=o,Za=I):ug(o,ot),ot=o.pendingLanes,ot===0&&($n=null),Lc(Ne.stateNode),Qs(o),f!==null)for(k=o.onRecoverableError,Ne=0;Ne<f.length;Ne++)ot=f[Ne],k(ot.value,{componentStack:ot.stack});return(Za&3)!==0&&Af(),ot=o.pendingLanes,(I&4194218)!==0&&(ot&42)!==0?o===bh?kl++:(kl=0,bh=o):kl=0,Rd(0),null}function ug(o,f){(o.pooledCacheLanes&=f)===0&&(f=o.pooledCache,f!=null&&(o.pooledCache=null,Bo(f)))}function Af(){if(ss!==null){var o=ss,f=Yo;Yo=0;var y=Vn(Za),I=ai.T,k=wi.p;try{if(wi.p=32>y?32:y,ai.T=null,ss===null)var G=!1;else{y=Pl,Pl=null;var se=ss,xe=Za;if(ss=null,Za=0,(Ut&6)!==0)throw Error(M(331));var Ne=Ut;if(Ut|=4,Be(se.current),ve(se,se.current,xe,y),Ut=Ne,Rd(0,!1),Kn&&typeof Kn.onPostCommitFiberRoot=="function")try{Kn.onPostCommitFiberRoot(Bn,se)}catch{}G=!0}return G}finally{wi.p=k,ai.T=I,ug(o,f)}}return!1}function Rp(o,f,y){f=Ka(y,f),f=dc(o.stateNode,f,2),o=Zo(o,f,2),o!==null&&(Jr(o,2),Qs(o))}function on(o,f,y){if(o.tag===3)Rp(o,o,y);else for(;f!==null;){if(f.tag===3){Rp(f,o,y);break}else if(f.tag===1){var I=f.stateNode;if(typeof f.type.getDerivedStateFromError=="function"||typeof I.componentDidCatch=="function"&&($n===null||!$n.has(I))){o=Ka(y,o),y=Td(2),I=Zo(f,y,2),I!==null&&(Sd(y,I,f,o),Jr(I,2),Qs(I));break}}f=f.return}}function xu(o,f,y){var I=o.pingCache;if(I===null){I=o.pingCache=new rr;var k=new Set;I.set(f,k)}else k=I.get(f),k===void 0&&(k=new Set,I.set(f,k));k.has(y)||(Oa=!0,k.add(y),o=Uy.bind(null,o,f,y),f.then(o,o))}function Uy(o,f,y){var I=o.pingCache;I!==null&&I.delete(f),o.pingedLanes|=o.suspendedLanes&y,o.warmLanes&=~y,mi===o&&(_i&y)===y&&(Ji===4||Ji===3&&(_i&62914560)===_i&&300>Mi()-xa?(Ut&2)===0&&yu(o,0):Qi|=y,en===_i&&(en=0)),Qs(o)}function yn(o,f){f===0&&(f=zu()),o=Qa(o,f),o!==null&&(Jr(o,f),Qs(o))}function zp(o){var f=o.memoizedState,y=0;f!==null&&(y=f.retryLane),yn(o,y)}function hg(o,f){var y=0;switch(o.tag){case 13:var I=o.stateNode,k=o.memoizedState;k!==null&&(y=k.retryLane);break;case 19:I=o.stateNode;break;case 22:I=o.stateNode._retryCache;break;default:throw Error(M(314))}I!==null&&I.delete(f),yn(o,y)}function Op(o,f){return ka(o,f)}var Th=null,Bl=null,Lp=!1,Id=!1,Sh=!1,bc=0;function Qs(o){o!==Bl&&o.next===null&&(Bl===null?Th=Bl=o:Bl=Bl.next=o),Id=!0,Lp||(Lp=!0,dg(fg))}function Rd(o,f){if(!Sh&&Id){Sh=!0;do for(var y=!1,I=Th;I!==null;){if(o!==0){var k=I.pendingLanes;if(k===0)var G=0;else{var se=I.suspendedLanes,xe=I.pingedLanes;G=(1<<31-Nn(42|o)+1)-1,G&=k&~(se&~xe),G=G&201326677?G&201326677|1:G?G|2:0}G!==0&&(y=!0,Fp(I,G))}else G=_i,G=So(I,I===mi?G:0),(G&3)===0||ao(I,G)||(y=!0,Fp(I,G));I=I.next}while(y);Sh=!1}}function fg(){Id=Lp=!1;var o=0;bc!==0&&(Hy()&&(o=bc),bc=0);for(var f=Mi(),y=null,I=Th;I!==null;){var k=I.next,G=Pp(I,f);G===0?(I.next=null,y===null?Th=k:y.next=k,k===null&&(Bl=y)):(y=I,(o!==0||(G&3)!==0)&&(Id=!0)),I=k}Rd(o)}function Pp(o,f){for(var y=o.suspendedLanes,I=o.pingedLanes,k=o.expirationTimes,G=o.pendingLanes&-62914561;0<G;){var se=31-Nn(G),xe=1<<se,Ne=k[se];Ne===-1?((xe&y)===0||(xe&I)!==0)&&(k[se]=Vh(xe,f)):Ne<=f&&(o.expiredLanes|=xe),G&=~xe}if(f=mi,y=_i,y=So(o,o===f?y:0),I=o.callbackNode,y===0||o===f&&Zi===2||o.cancelPendingCommit!==null)return I!==null&&I!==null&&io(I),o.callbackNode=null,o.callbackPriority=0;if((y&3)===0||ao(o,y)){if(f=y&-y,f===o.callbackPriority)return f;switch(I!==null&&io(I),Vn(y)){case 2:case 8:y=wo;break;case 32:y=Fn;break;case 268435456:y=el;break;default:y=Fn}return I=kp.bind(null,o),y=ka(y,I),o.callbackPriority=f,o.callbackNode=y,f}return I!==null&&I!==null&&io(I),o.callbackPriority=2,o.callbackNode=null,2}function kp(o,f){var y=o.callbackNode;if(Af()&&o.callbackNode!==y)return null;var I=_i;return I=So(o,o===mi?I:0),I===0?null:(Bm(o,I,f),Pp(o,Mi()),o.callbackNode!=null&&o.callbackNode===y?kp.bind(null,o):null)}function Fp(o,f){if(Af())return null;Bm(o,f,!0)}function dg(o){vg(function(){(Ut&6)!==0?ka(us,o):o()})}function Bp(){return bc===0&&(bc=Zl()),bc}function jm(o){return o==null||typeof o=="symbol"||typeof o=="boolean"?null:typeof o=="function"?o:nr(""+o)}function qm(o,f){var y=f.ownerDocument.createElement("input");return y.name=f.name,y.value=f.value,o.id&&y.setAttribute("form",o.id),f.parentNode.insertBefore(y,f),o=new FormData(o),y.parentNode.removeChild(y),o}function Gm(o,f,y,I,k){if(f==="submit"&&y&&y.stateNode===k){var G=jm((k[oe]||null).action),se=I.submitter;se&&(f=(f=se[oe]||null)?jm(f.formAction):se.getAttribute("formAction"),f!==null&&(G=f,se=null));var xe=new Nc("action","action",null,I,k);o.push({event:xe,listeners:[{instance:null,listener:function(){if(I.defaultPrevented){if(bc!==0){var Ne=se?qm(k,se):new FormData(k);Yn(y,{pending:!0,data:Ne,method:k.method,action:G},null,Ne)}}else typeof G=="function"&&(xe.preventDefault(),Ne=se?qm(k,se):new FormData(k),Yn(y,{pending:!0,data:Ne,method:k.method,action:G},G,Ne))},currentTarget:k}]})}}for(var xo=0;xo<Hc.length;xo++){var Np=Hc[xo],jy=Np.toLowerCase(),qy=Np[0].toUpperCase()+Np.slice(1);Ca(jy,"on"+qy)}Ca(Wu,"onAnimationEnd"),Ca(Gc,"onAnimationIteration"),Ca($u,"onAnimationStart"),Ca("dblclick","onDoubleClick"),Ca("focusin","onFocus"),Ca("focusout","onBlur"),Ca(ul,"onTransitionRun"),Ca(Qh,"onTransitionStart"),Ca(hd,"onTransitionCancel"),Ca(hl,"onTransitionEnd"),ji("onMouseEnter",["mouseout","mouseover"]),ji("onMouseLeave",["mouseout","mouseover"]),ji("onPointerEnter",["pointerout","pointerover"]),ji("onPointerLeave",["pointerout","pointerover"]),si("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),si("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),si("onBeforeInput",["compositionend","keypress","textInput","paste"]),si("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),si("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),si("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var zd="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Gy=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(zd));function pg(o,f){f=(f&4)!==0;for(var y=0;y<o.length;y++){var I=o[y],k=I.event;I=I.listeners;e:{var G=void 0;if(f)for(var se=I.length-1;0<=se;se--){var xe=I[se],Ne=xe.instance,ot=xe.currentTarget;if(xe=xe.listener,Ne!==G&&k.isPropagationStopped())break e;G=xe,k.currentTarget=ot;try{G(k)}catch(Pt){Rl(Pt)}k.currentTarget=null,G=Ne}else for(se=0;se<I.length;se++){if(xe=I[se],Ne=xe.instance,ot=xe.currentTarget,xe=xe.listener,Ne!==G&&k.isPropagationStopped())break e;G=xe,k.currentTarget=ot;try{G(k)}catch(Pt){Rl(Pt)}k.currentTarget=null,G=Ne}}}}function Rr(o,f){var y=f[we];y===void 0&&(y=f[we]=new Set);var I=o+"__bubble";y.has(I)||(Up(f,o,2,!1),y.add(I))}function Hm(o,f,y){var I=0;f&&(I|=4),Up(y,o,I,f)}var Cf="_reactListening"+Math.random().toString(36).slice(2);function Vp(o){if(!o[Cf]){o[Cf]=!0,fi.forEach(function(y){y!=="selectionchange"&&(Gy.has(y)||Hm(y,!1,o),Hm(y,!0,o))});var f=o.nodeType===9?o:o.ownerDocument;f===null||f[Cf]||(f[Cf]=!0,Hm("selectionchange",!1,f))}}function Up(o,f,y,I){switch(Ig(f)){case 2:var k=Dg;break;case 8:k=c_;break;default:k=Qp}y=k.bind(null,f,y,o),k=void 0,!Qt||f!=="touchstart"&&f!=="touchmove"&&f!=="wheel"||(k=!0),I?k!==void 0?o.addEventListener(f,y,{capture:!0,passive:k}):o.addEventListener(f,y,!0):k!==void 0?o.addEventListener(f,y,{passive:k}):o.addEventListener(f,y,!1)}function jp(o,f,y,I,k){var G=I;if((f&1)===0&&(f&2)===0&&I!==null)e:for(;;){if(I===null)return;var se=I.tag;if(se===3||se===4){var xe=I.stateNode.containerInfo;if(xe===k||xe.nodeType===8&&xe.parentNode===k)break;if(se===4)for(se=I.return;se!==null;){var Ne=se.tag;if((Ne===3||Ne===4)&&(Ne=se.stateNode.containerInfo,Ne===k||Ne.nodeType===8&&Ne.parentNode===k))return;se=se.return}for(;xe!==null;){if(se=Xe(xe),se===null)return;if(Ne=se.tag,Ne===5||Ne===6||Ne===26||Ne===27){I=G=se;continue e}xe=xe.parentNode}}I=I.return}Bu(function(){var ot=G,Pt=di(y),$t=[];e:{var xt=Ql.get(o);if(xt!==void 0){var Lt=Nc,Li=o;switch(o){case"keypress":if(il(y)===0)break e;case"keydown":case"keyup":Lt=Aa;break;case"focusin":Li="focus",Lt=Hr;break;case"focusout":Li="blur",Lt=Hr;break;case"beforeblur":case"afterblur":Lt=Hr;break;case"click":if(y.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Lt=Bs;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Lt=Jf;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Lt=qu;break;case Wu:case Gc:case $u:Lt=qn;break;case hl:Lt=Pm;break;case"scroll":case"scrollend":Lt=qh;break;case"wheel":Lt=Hu;break;case"copy":case"cut":case"paste":Lt=Nu;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Lt=Uu;break;case"toggle":case"beforetoggle":Lt=Uc}var dr=(f&4)!==0,En=!dr&&(o==="scroll"||o==="scrollend"),ft=dr?xt!==null?xt+"Capture":null:xt;dr=[];for(var rt=ot,_t;rt!==null;){var Ht=rt;if(_t=Ht.stateNode,Ht=Ht.tag,Ht!==5&&Ht!==26&&Ht!==27||_t===null||ft===null||(Ht=Fs(rt,ft),Ht!=null&&dr.push(Eh(rt,Ht,_t))),En)break;rt=rt.return}0<dr.length&&(xt=new Lt(xt,Li,null,y,Pt),$t.push({event:xt,listeners:dr}))}}if((f&7)===0){e:{if(xt=o==="mouseover"||o==="pointerover",Lt=o==="mouseout"||o==="pointerout",xt&&y!==ku&&(Li=y.relatedTarget||y.fromElement)&&(Xe(Li)||Li[ye]))break e;if((Lt||xt)&&(xt=Pt.window===Pt?Pt:(xt=Pt.ownerDocument)?xt.defaultView||xt.parentWindow:window,Lt?(Li=y.relatedTarget||y.toElement,Lt=ot,Li=Li?Xe(Li):null,Li!==null&&(En=Bi(Li),dr=Li.tag,Li!==En||dr!==5&&dr!==27&&dr!==6)&&(Li=null)):(Lt=null,Li=ot),Lt!==Li)){if(dr=Bs,Ht="onMouseLeave",ft="onMouseEnter",rt="mouse",(o==="pointerout"||o==="pointerover")&&(dr=Uu,Ht="onPointerLeave",ft="onPointerEnter",rt="pointer"),En=Lt==null?xt:At(Lt),_t=Li==null?xt:At(Li),xt=new dr(Ht,rt+"leave",Lt,y,Pt),xt.target=En,xt.relatedTarget=_t,Ht=null,Xe(Pt)===ot&&(dr=new dr(ft,rt+"enter",Li,y,Pt),dr.target=_t,dr.relatedTarget=En,Ht=dr),En=Ht,Lt&&Li)t:{for(dr=Lt,ft=Li,rt=0,_t=dr;_t;_t=Mh(_t))rt++;for(_t=0,Ht=ft;Ht;Ht=Mh(Ht))_t++;for(;0<rt-_t;)dr=Mh(dr),rt--;for(;0<_t-rt;)ft=Mh(ft),_t--;for(;rt--;){if(dr===ft||ft!==null&&dr===ft.alternate)break t;dr=Mh(dr),ft=Mh(ft)}dr=null}else dr=null;Lt!==null&&Ld($t,xt,Lt,dr,!1),Li!==null&&En!==null&&Ld($t,En,Li,dr,!0)}}e:{if(xt=ot?At(ot):window,Lt=xt.nodeName&&xt.nodeName.toLowerCase(),Lt==="select"||Lt==="input"&&xt.type==="file")var Ii=Xh;else if(vi(xt))if(Zu)Ii=Oo;else{Ii=al;var ur=Yu}else Lt=xt.nodeName,!Lt||Lt.toLowerCase()!=="input"||xt.type!=="checkbox"&&xt.type!=="radio"?ot&&jh(ot.elementType)&&(Ii=Xh):Ii=Gn;if(Ii&&(Ii=Ii(o,ot))){Wl($t,Ii,y,Pt);break e}ur&&ur(o,xt,ot),o==="focusout"&&ot&&xt.type==="number"&&ot.memoizedProps.value!=null&&Ps(xt,"number",xt.value)}switch(ur=ot?At(ot):window,o){case"focusin":(vi(ur)||ur.contentEditable==="true")&&(ol=ur,cd=ot,qc=null);break;case"focusout":qc=cd=ol=null;break;case"mousedown":Lo=!0;break;case"contextmenu":case"mouseup":case"dragend":Lo=!1,pp($t,y,Pt);break;case"selectionchange":if(ld)break;case"keydown":case"keyup":pp($t,y,Pt)}var Gi;if(Us)e:{switch(o){case"compositionstart":var er="onCompositionStart";break e;case"compositionend":er="onCompositionEnd";break e;case"compositionupdate":er="onCompositionUpdate";break e}er=void 0}else vs?hp(o,y)&&(er="onCompositionEnd"):o==="keydown"&&y.keyCode===229&&(er="onCompositionStart");er&&(Gh&&y.locale!=="ko"&&(vs||er!=="onCompositionStart"?er==="onCompositionEnd"&&vs&&(Gi=ar()):(Hi=Pt,Un="value"in Hi?Hi.value:Hi.textContent,vs=!0)),ur=Od(ot,er),0<ur.length&&(er=new rl(er,o,null,y,Pt),$t.push({event:er,listeners:ur}),Gi?er.data=Gi:(Gi=Hh(y),Gi!==null&&(er.data=Gi)))),(Gi=Fm?Ui(o,y):ci(o,y))&&(er=Od(ot,"onBeforeInput"),0<er.length&&(ur=new rl("onBeforeInput","beforeinput",null,y,Pt),$t.push({event:ur,listeners:er}),ur.data=Gi)),Gm($t,o,ot,y,Pt)}pg($t,f)})}function Eh(o,f,y){return{instance:o,listener:f,currentTarget:y}}function Od(o,f){for(var y=f+"Capture",I=[];o!==null;){var k=o,G=k.stateNode;k=k.tag,k!==5&&k!==26&&k!==27||G===null||(k=Fs(o,y),k!=null&&I.unshift(Eh(o,k,G)),k=Fs(o,f),k!=null&&I.push(Eh(o,k,G))),o=o.return}return I}function Mh(o){if(o===null)return null;do o=o.return;while(o&&o.tag!==5&&o.tag!==27);return o||null}function Ld(o,f,y,I,k){for(var G=f._reactName,se=[];y!==null&&y!==I;){var xe=y,Ne=xe.alternate,ot=xe.stateNode;if(xe=xe.tag,Ne!==null&&Ne===I)break;xe!==5&&xe!==26&&xe!==27||ot===null||(Ne=ot,k?(ot=Fs(y,G),ot!=null&&se.unshift(Eh(y,ot,Ne))):k||(ot=Fs(y,G),ot!=null&&se.push(Eh(y,ot,Ne)))),y=y.return}se.length!==0&&o.push({event:f,listeners:se})}var mg=/\r\n?/g,_g=/\u0000|\uFFFD/g;function Zm(o){return(typeof o=="string"?o:""+o).replace(mg,`
`).replace(_g,"")}function Ah(o,f){return f=Zm(f),Zm(o)===f}function Nl(){}function Kr(o,f,y,I,k,G){switch(y){case"children":typeof I=="string"?f==="body"||f==="textarea"&&I===""||Mo(o,I):(typeof I=="number"||typeof I=="bigint")&&f!=="body"&&Mo(o,""+I);break;case"className":an(o,"class",I);break;case"tabIndex":an(o,"tabindex",I);break;case"dir":case"role":case"viewBox":case"width":case"height":an(o,y,I);break;case"style":Co(o,I,G);break;case"data":if(f!=="object"){an(o,"data",I);break}case"src":case"href":if(I===""&&(f!=="a"||y!=="href")){o.removeAttribute(y);break}if(I==null||typeof I=="function"||typeof I=="symbol"||typeof I=="boolean"){o.removeAttribute(y);break}I=nr(""+I),o.setAttribute(y,I);break;case"action":case"formAction":if(typeof I=="function"){o.setAttribute(y,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof G=="function"&&(y==="formAction"?(f!=="input"&&Kr(o,f,"name",k.name,k,null),Kr(o,f,"formEncType",k.formEncType,k,null),Kr(o,f,"formMethod",k.formMethod,k,null),Kr(o,f,"formTarget",k.formTarget,k,null)):(Kr(o,f,"encType",k.encType,k,null),Kr(o,f,"method",k.method,k,null),Kr(o,f,"target",k.target,k,null)));if(I==null||typeof I=="symbol"||typeof I=="boolean"){o.removeAttribute(y);break}I=nr(""+I),o.setAttribute(y,I);break;case"onClick":I!=null&&(o.onclick=Nl);break;case"onScroll":I!=null&&Rr("scroll",o);break;case"onScrollEnd":I!=null&&Rr("scrollend",o);break;case"dangerouslySetInnerHTML":if(I!=null){if(typeof I!="object"||!("__html"in I))throw Error(M(61));if(y=I.__html,y!=null){if(k.children!=null)throw Error(M(60));o.innerHTML=y}}break;case"multiple":o.multiple=I&&typeof I!="function"&&typeof I!="symbol";break;case"muted":o.muted=I&&typeof I!="function"&&typeof I!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(I==null||typeof I=="function"||typeof I=="boolean"||typeof I=="symbol"){o.removeAttribute("xlink:href");break}y=nr(""+I),o.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",y);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":I!=null&&typeof I!="function"&&typeof I!="symbol"?o.setAttribute(y,""+I):o.removeAttribute(y);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":I&&typeof I!="function"&&typeof I!="symbol"?o.setAttribute(y,""):o.removeAttribute(y);break;case"capture":case"download":I===!0?o.setAttribute(y,""):I!==!1&&I!=null&&typeof I!="function"&&typeof I!="symbol"?o.setAttribute(y,I):o.removeAttribute(y);break;case"cols":case"rows":case"size":case"span":I!=null&&typeof I!="function"&&typeof I!="symbol"&&!isNaN(I)&&1<=I?o.setAttribute(y,I):o.removeAttribute(y);break;case"rowSpan":case"start":I==null||typeof I=="function"||typeof I=="symbol"||isNaN(I)?o.removeAttribute(y):o.setAttribute(y,I);break;case"popover":Rr("beforetoggle",o),Rr("toggle",o),Wa(o,"popover",I);break;case"xlinkActuate":Gr(o,"http://www.w3.org/1999/xlink","xlink:actuate",I);break;case"xlinkArcrole":Gr(o,"http://www.w3.org/1999/xlink","xlink:arcrole",I);break;case"xlinkRole":Gr(o,"http://www.w3.org/1999/xlink","xlink:role",I);break;case"xlinkShow":Gr(o,"http://www.w3.org/1999/xlink","xlink:show",I);break;case"xlinkTitle":Gr(o,"http://www.w3.org/1999/xlink","xlink:title",I);break;case"xlinkType":Gr(o,"http://www.w3.org/1999/xlink","xlink:type",I);break;case"xmlBase":Gr(o,"http://www.w3.org/XML/1998/namespace","xml:base",I);break;case"xmlLang":Gr(o,"http://www.w3.org/XML/1998/namespace","xml:lang",I);break;case"xmlSpace":Gr(o,"http://www.w3.org/XML/1998/namespace","xml:space",I);break;case"is":Wa(o,"is",I);break;case"innerText":case"textContent":break;default:(!(2<y.length)||y[0]!=="o"&&y[0]!=="O"||y[1]!=="n"&&y[1]!=="N")&&(y=Kf.get(y)||y,Wa(o,y,I))}}function Df(o,f,y,I,k,G){switch(y){case"style":Co(o,I,G);break;case"dangerouslySetInnerHTML":if(I!=null){if(typeof I!="object"||!("__html"in I))throw Error(M(61));if(y=I.__html,y!=null){if(k.children!=null)throw Error(M(60));o.innerHTML=y}}break;case"children":typeof I=="string"?Mo(o,I):(typeof I=="number"||typeof I=="bigint")&&Mo(o,""+I);break;case"onScroll":I!=null&&Rr("scroll",o);break;case"onScrollEnd":I!=null&&Rr("scrollend",o);break;case"onClick":I!=null&&(o.onclick=Nl);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!pi.hasOwnProperty(y))e:{if(y[0]==="o"&&y[1]==="n"&&(k=y.endsWith("Capture"),f=y.slice(2,k?y.length-7:void 0),G=o[oe]||null,G=G!=null?G[y]:null,typeof G=="function"&&o.removeEventListener(f,G,k),typeof I=="function")){typeof G!="function"&&G!==null&&(y in o?o[y]=null:o.hasAttribute(y)&&o.removeAttribute(y)),o.addEventListener(f,I,k);break e}y in o?o[y]=I:I===!0?o.setAttribute(y,""):Wa(o,y,I)}}}function wa(o,f,y){switch(f){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Rr("error",o),Rr("load",o);var I=!1,k=!1,G;for(G in y)if(y.hasOwnProperty(G)){var se=y[G];if(se!=null)switch(G){case"src":I=!0;break;case"srcSet":k=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(M(137,f));default:Kr(o,f,G,se,y,null)}}k&&Kr(o,f,"srcSet",y.srcSet,y,null),I&&Kr(o,f,"src",y.src,y,null);return;case"input":Rr("invalid",o);var xe=G=se=k=null,Ne=null,ot=null;for(I in y)if(y.hasOwnProperty(I)){var Pt=y[I];if(Pt!=null)switch(I){case"name":k=Pt;break;case"type":se=Pt;break;case"checked":Ne=Pt;break;case"defaultChecked":ot=Pt;break;case"value":G=Pt;break;case"defaultValue":xe=Pt;break;case"children":case"dangerouslySetInnerHTML":if(Pt!=null)throw Error(M(137,f));break;default:Kr(o,f,I,Pt,y,null)}}ds(o,G,xe,Ne,ot,se,k,!1),tl(o);return;case"select":Rr("invalid",o),I=se=G=null;for(k in y)if(y.hasOwnProperty(k)&&(xe=y[k],xe!=null))switch(k){case"value":G=xe;break;case"defaultValue":se=xe;break;case"multiple":I=xe;default:Kr(o,f,k,xe,y,null)}f=G,y=se,o.multiple=!!I,f!=null?Ma(o,!!I,f,!1):y!=null&&Ma(o,!!I,y,!0);return;case"textarea":Rr("invalid",o),G=k=I=null;for(se in y)if(y.hasOwnProperty(se)&&(xe=y[se],xe!=null))switch(se){case"value":I=xe;break;case"defaultValue":k=xe;break;case"children":G=xe;break;case"dangerouslySetInnerHTML":if(xe!=null)throw Error(M(91));break;default:Kr(o,f,se,xe,y,null)}ks(o,I,k,G),tl(o);return;case"option":for(Ne in y)if(y.hasOwnProperty(Ne)&&(I=y[Ne],I!=null))switch(Ne){case"selected":o.selected=I&&typeof I!="function"&&typeof I!="symbol";break;default:Kr(o,f,Ne,I,y,null)}return;case"dialog":Rr("cancel",o),Rr("close",o);break;case"iframe":case"object":Rr("load",o);break;case"video":case"audio":for(I=0;I<zd.length;I++)Rr(zd[I],o);break;case"image":Rr("error",o),Rr("load",o);break;case"details":Rr("toggle",o);break;case"embed":case"source":case"link":Rr("error",o),Rr("load",o);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ot in y)if(y.hasOwnProperty(ot)&&(I=y[ot],I!=null))switch(ot){case"children":case"dangerouslySetInnerHTML":throw Error(M(137,f));default:Kr(o,f,ot,I,y,null)}return;default:if(jh(f)){for(Pt in y)y.hasOwnProperty(Pt)&&(I=y[Pt],I!==void 0&&Df(o,f,Pt,I,y,void 0));return}}for(xe in y)y.hasOwnProperty(xe)&&(I=y[xe],I!=null&&Kr(o,f,xe,I,y,null))}function gg(o,f,y,I){switch(f){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var k=null,G=null,se=null,xe=null,Ne=null,ot=null,Pt=null;for(Lt in y){var $t=y[Lt];if(y.hasOwnProperty(Lt)&&$t!=null)switch(Lt){case"checked":break;case"value":break;case"defaultValue":Ne=$t;default:I.hasOwnProperty(Lt)||Kr(o,f,Lt,null,I,$t)}}for(var xt in I){var Lt=I[xt];if($t=y[xt],I.hasOwnProperty(xt)&&(Lt!=null||$t!=null))switch(xt){case"type":G=Lt;break;case"name":k=Lt;break;case"checked":ot=Lt;break;case"defaultChecked":Pt=Lt;break;case"value":se=Lt;break;case"defaultValue":xe=Lt;break;case"children":case"dangerouslySetInnerHTML":if(Lt!=null)throw Error(M(137,f));break;default:Lt!==$t&&Kr(o,f,xt,Lt,I,$t)}}Jn(o,se,xe,Ne,ot,Pt,G,k);return;case"select":Lt=se=xe=xt=null;for(G in y)if(Ne=y[G],y.hasOwnProperty(G)&&Ne!=null)switch(G){case"value":break;case"multiple":Lt=Ne;default:I.hasOwnProperty(G)||Kr(o,f,G,null,I,Ne)}for(k in I)if(G=I[k],Ne=y[k],I.hasOwnProperty(k)&&(G!=null||Ne!=null))switch(k){case"value":xt=G;break;case"defaultValue":xe=G;break;case"multiple":se=G;default:G!==Ne&&Kr(o,f,k,G,I,Ne)}f=xe,y=se,I=Lt,xt!=null?Ma(o,!!y,xt,!1):!!I!=!!y&&(f!=null?Ma(o,!!y,f,!0):Ma(o,!!y,y?[]:"",!1));return;case"textarea":Lt=xt=null;for(xe in y)if(k=y[xe],y.hasOwnProperty(xe)&&k!=null&&!I.hasOwnProperty(xe))switch(xe){case"value":break;case"children":break;default:Kr(o,f,xe,null,I,k)}for(se in I)if(k=I[se],G=y[se],I.hasOwnProperty(se)&&(k!=null||G!=null))switch(se){case"value":xt=k;break;case"defaultValue":Lt=k;break;case"children":break;case"dangerouslySetInnerHTML":if(k!=null)throw Error(M(91));break;default:k!==G&&Kr(o,f,se,k,I,G)}ps(o,xt,Lt);return;case"option":for(var Li in y)if(xt=y[Li],y.hasOwnProperty(Li)&&xt!=null&&!I.hasOwnProperty(Li))switch(Li){case"selected":o.selected=!1;break;default:Kr(o,f,Li,null,I,xt)}for(Ne in I)if(xt=I[Ne],Lt=y[Ne],I.hasOwnProperty(Ne)&&xt!==Lt&&(xt!=null||Lt!=null))switch(Ne){case"selected":o.selected=xt&&typeof xt!="function"&&typeof xt!="symbol";break;default:Kr(o,f,Ne,xt,I,Lt)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var dr in y)xt=y[dr],y.hasOwnProperty(dr)&&xt!=null&&!I.hasOwnProperty(dr)&&Kr(o,f,dr,null,I,xt);for(ot in I)if(xt=I[ot],Lt=y[ot],I.hasOwnProperty(ot)&&xt!==Lt&&(xt!=null||Lt!=null))switch(ot){case"children":case"dangerouslySetInnerHTML":if(xt!=null)throw Error(M(137,f));break;default:Kr(o,f,ot,xt,I,Lt)}return;default:if(jh(f)){for(var En in y)xt=y[En],y.hasOwnProperty(En)&&xt!==void 0&&!I.hasOwnProperty(En)&&Df(o,f,En,void 0,I,xt);for(Pt in I)xt=I[Pt],Lt=y[Pt],!I.hasOwnProperty(Pt)||xt===Lt||xt===void 0&&Lt===void 0||Df(o,f,Pt,xt,I,Lt);return}}for(var ft in y)xt=y[ft],y.hasOwnProperty(ft)&&xt!=null&&!I.hasOwnProperty(ft)&&Kr(o,f,ft,null,I,xt);for($t in I)xt=I[$t],Lt=y[$t],!I.hasOwnProperty($t)||xt===Lt||xt==null&&Lt==null||Kr(o,f,$t,xt,I,Lt)}var If=null,qp=null;function Ch(o){return o.nodeType===9?o:o.ownerDocument}function Xm(o){switch(o){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Gp(o,f){if(o===0)switch(f){case"svg":return 1;case"math":return 2;default:return 0}return o===1&&f==="foreignObject"?0:o}function Pd(o,f){return o==="textarea"||o==="noscript"||typeof f.children=="string"||typeof f.children=="number"||typeof f.children=="bigint"||typeof f.dangerouslySetInnerHTML=="object"&&f.dangerouslySetInnerHTML!==null&&f.dangerouslySetInnerHTML.__html!=null}var Hp=null;function Hy(){var o=window.event;return o&&o.type==="popstate"?o===Hp?!1:(Hp=o,!0):(Hp=null,!1)}var Ym=typeof setTimeout=="function"?setTimeout:void 0,yg=typeof clearTimeout=="function"?clearTimeout:void 0,Wm=typeof Promise=="function"?Promise:void 0,vg=typeof queueMicrotask=="function"?queueMicrotask:typeof Wm<"u"?function(o){return Wm.resolve(null).then(o).catch($m)}:Ym;function $m(o){setTimeout(function(){throw o})}function Zp(o,f){var y=f,I=0;do{var k=y.nextSibling;if(o.removeChild(y),k&&k.nodeType===8)if(y=k.data,y==="/$"){if(I===0){o.removeChild(k),Hd(f);return}I--}else y!=="$"&&y!=="$?"&&y!=="$!"||I++;y=k}while(y);Hd(f)}function kd(o){var f=o.firstChild;for(f&&f.nodeType===10&&(f=f.nextSibling);f;){var y=f;switch(f=f.nextSibling,y.nodeName){case"HTML":case"HEAD":case"BODY":kd(y),He(y);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(y.rel.toLowerCase()==="stylesheet")continue}o.removeChild(y)}}function Zy(o,f,y,I){for(;o.nodeType===1;){var k=y;if(o.nodeName.toLowerCase()!==f.toLowerCase()){if(!I&&(o.nodeName!=="INPUT"||o.type!=="hidden"))break}else if(I){if(!o[Ze])switch(f){case"meta":if(!o.hasAttribute("itemprop"))break;return o;case"link":if(G=o.getAttribute("rel"),G==="stylesheet"&&o.hasAttribute("data-precedence"))break;if(G!==k.rel||o.getAttribute("href")!==(k.href==null?null:k.href)||o.getAttribute("crossorigin")!==(k.crossOrigin==null?null:k.crossOrigin)||o.getAttribute("title")!==(k.title==null?null:k.title))break;return o;case"style":if(o.hasAttribute("data-precedence"))break;return o;case"script":if(G=o.getAttribute("src"),(G!==(k.src==null?null:k.src)||o.getAttribute("type")!==(k.type==null?null:k.type)||o.getAttribute("crossorigin")!==(k.crossOrigin==null?null:k.crossOrigin))&&G&&o.hasAttribute("async")&&!o.hasAttribute("itemprop"))break;return o;default:return o}}else if(f==="input"&&o.type==="hidden"){var G=k.name==null?null:""+k.name;if(k.type==="hidden"&&o.getAttribute("name")===G)return o}else return o;if(o=Wo(o.nextSibling),o===null)break}return null}function Xy(o,f,y){if(f==="")return null;for(;o.nodeType!==3;)if((o.nodeType!==1||o.nodeName!=="INPUT"||o.type!=="hidden")&&!y||(o=Wo(o.nextSibling),o===null))return null;return o}function Wo(o){for(;o!=null;o=o.nextSibling){var f=o.nodeType;if(f===1||f===3)break;if(f===8){if(f=o.data,f==="$"||f==="$!"||f==="$?"||f==="F!"||f==="F")break;if(f==="/$")return null}}return o}function xg(o){o=o.previousSibling;for(var f=0;o;){if(o.nodeType===8){var y=o.data;if(y==="$"||y==="$!"||y==="$?"){if(f===0)return o;f--}else y==="/$"&&f++}o=o.previousSibling}return null}function Qm(o,f,y){switch(f=Ch(y),o){case"html":if(o=f.documentElement,!o)throw Error(M(452));return o;case"head":if(o=f.head,!o)throw Error(M(453));return o;case"body":if(o=f.body,!o)throw Error(M(454));return o;default:throw Error(M(451))}}var ma=new Map,Rf=new Set;function bu(o){return typeof o.getRootNode=="function"?o.getRootNode():o.ownerDocument}var bo=wi.d;wi.d={f:Fd,r:bg,D:wg,C:Yy,L:Wy,m:Tg,X:Sg,S:Xp,M:$y};function Fd(){var o=bo.f(),f=Cd();return o||f}function bg(o){var f=ht(o);f!==null&&f.tag===5&&f.type==="form"?cu(f):bo.r(o)}var Dh=typeof document>"u"?null:document;function Km(o,f,y){var I=Dh;if(I&&typeof f=="string"&&f){var k=Fa(f);k='link[rel="'+o+'"][href="'+k+'"]',typeof y=="string"&&(k+='[crossorigin="'+y+'"]'),Rf.has(k)||(Rf.add(k),o={rel:o,crossOrigin:y,href:f},I.querySelector(k)===null&&(f=I.createElement("link"),wa(f,"link",o),Jt(f),I.head.appendChild(f)))}}function wg(o){bo.D(o),Km("dns-prefetch",o,null)}function Yy(o,f){bo.C(o,f),Km("preconnect",o,f)}function Wy(o,f,y){bo.L(o,f,y);var I=Dh;if(I&&o&&f){var k='link[rel="preload"][as="'+Fa(f)+'"]';f==="image"&&y&&y.imageSrcSet?(k+='[imagesrcset="'+Fa(y.imageSrcSet)+'"]',typeof y.imageSizes=="string"&&(k+='[imagesizes="'+Fa(y.imageSizes)+'"]')):k+='[href="'+Fa(o)+'"]';var G=k;switch(f){case"style":G=wu(o);break;case"script":G=Ih(o)}ma.has(G)||(o=kt({rel:"preload",href:f==="image"&&y&&y.imageSrcSet?void 0:o,as:f},y),ma.set(G,o),I.querySelector(k)!==null||f==="style"&&I.querySelector(zf(G))||f==="script"&&I.querySelector(Of(G))||(f=I.createElement("link"),wa(f,"link",o),Jt(f),I.head.appendChild(f)))}}function Tg(o,f){bo.m(o,f);var y=Dh;if(y&&o){var I=f&&typeof f.as=="string"?f.as:"script",k='link[rel="modulepreload"][as="'+Fa(I)+'"][href="'+Fa(o)+'"]',G=k;switch(I){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":G=Ih(o)}if(!ma.has(G)&&(o=kt({rel:"modulepreload",href:o},f),ma.set(G,o),y.querySelector(k)===null)){switch(I){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(y.querySelector(Of(G)))return}I=y.createElement("link"),wa(I,"link",o),Jt(I),y.head.appendChild(I)}}}function Xp(o,f,y){bo.S(o,f,y);var I=Dh;if(I&&o){var k=Dt(I).hoistableStyles,G=wu(o);f=f||"default";var se=k.get(G);if(!se){var xe={loading:0,preload:null};if(se=I.querySelector(zf(G)))xe.loading=5;else{o=kt({rel:"stylesheet",href:o,"data-precedence":f},y),(y=ma.get(G))&&Yp(o,y);var Ne=se=I.createElement("link");Jt(Ne),wa(Ne,"link",o),Ne._p=new Promise(function(ot,Pt){Ne.onload=ot,Ne.onerror=Pt}),Ne.addEventListener("load",function(){xe.loading|=1}),Ne.addEventListener("error",function(){xe.loading|=2}),xe.loading|=4,Bd(se,f,I)}se={type:"stylesheet",instance:se,count:1,state:xe},k.set(G,se)}}}function Sg(o,f){bo.X(o,f);var y=Dh;if(y&&o){var I=Dt(y).hoistableScripts,k=Ih(o),G=I.get(k);G||(G=y.querySelector(Of(k)),G||(o=kt({src:o,async:!0},f),(f=ma.get(k))&&Rh(o,f),G=y.createElement("script"),Jt(G),wa(G,"link",o),y.head.appendChild(G)),G={type:"script",instance:G,count:1,state:null},I.set(k,G))}}function $y(o,f){bo.M(o,f);var y=Dh;if(y&&o){var I=Dt(y).hoistableScripts,k=Ih(o),G=I.get(k);G||(G=y.querySelector(Of(k)),G||(o=kt({src:o,async:!0,type:"module"},f),(f=ma.get(k))&&Rh(o,f),G=y.createElement("script"),Jt(G),wa(G,"link",o),y.head.appendChild(G)),G={type:"script",instance:G,count:1,state:null},I.set(k,G))}}function Jm(o,f,y,I){var k=(k=Pa.current)?bu(k):null;if(!k)throw Error(M(446));switch(o){case"meta":case"title":return null;case"style":return typeof y.precedence=="string"&&typeof y.href=="string"?(f=wu(y.href),y=Dt(k).hoistableStyles,I=y.get(f),I||(I={type:"style",instance:null,count:0,state:null},y.set(f,I)),I):{type:"void",instance:null,count:0,state:null};case"link":if(y.rel==="stylesheet"&&typeof y.href=="string"&&typeof y.precedence=="string"){o=wu(y.href);var G=Dt(k).hoistableStyles,se=G.get(o);if(se||(k=k.ownerDocument||k,se={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},G.set(o,se),(G=k.querySelector(zf(o)))&&!G._p&&(se.instance=G,se.state.loading=5),ma.has(o)||(y={rel:"preload",as:"style",href:y.href,crossOrigin:y.crossOrigin,integrity:y.integrity,media:y.media,hrefLang:y.hrefLang,referrerPolicy:y.referrerPolicy},ma.set(o,y),G||Eg(k,o,y,se.state))),f&&I===null)throw Error(M(528,""));return se}if(f&&I!==null)throw Error(M(529,""));return null;case"script":return f=y.async,y=y.src,typeof y=="string"&&f&&typeof f!="function"&&typeof f!="symbol"?(f=Ih(y),y=Dt(k).hoistableScripts,I=y.get(f),I||(I={type:"script",instance:null,count:0,state:null},y.set(f,I)),I):{type:"void",instance:null,count:0,state:null};default:throw Error(M(444,o))}}function wu(o){return'href="'+Fa(o)+'"'}function zf(o){return'link[rel="stylesheet"]['+o+"]"}function e_(o){return kt({},o,{"data-precedence":o.precedence,precedence:null})}function Eg(o,f,y,I){o.querySelector('link[rel="preload"][as="style"]['+f+"]")?I.loading=1:(f=o.createElement("link"),I.preload=f,f.addEventListener("load",function(){return I.loading|=1}),f.addEventListener("error",function(){return I.loading|=2}),wa(f,"link",y),Jt(f),o.head.appendChild(f))}function Ih(o){return'[src="'+Fa(o)+'"]'}function Of(o){return"script[async]"+o}function Mg(o,f,y){if(f.count++,f.instance===null)switch(f.type){case"style":var I=o.querySelector('style[data-href~="'+Fa(y.href)+'"]');if(I)return f.instance=I,Jt(I),I;var k=kt({},y,{"data-href":y.href,"data-precedence":y.precedence,href:null,precedence:null});return I=(o.ownerDocument||o).createElement("style"),Jt(I),wa(I,"style",k),Bd(I,y.precedence,o),f.instance=I;case"stylesheet":k=wu(y.href);var G=o.querySelector(zf(k));if(G)return f.state.loading|=4,f.instance=G,Jt(G),G;I=e_(y),(k=ma.get(k))&&Yp(I,k),G=(o.ownerDocument||o).createElement("link"),Jt(G);var se=G;return se._p=new Promise(function(xe,Ne){se.onload=xe,se.onerror=Ne}),wa(G,"link",I),f.state.loading|=4,Bd(G,y.precedence,o),f.instance=G;case"script":return G=Ih(y.src),(k=o.querySelector(Of(G)))?(f.instance=k,Jt(k),k):(I=y,(k=ma.get(G))&&(I=kt({},y),Rh(I,k)),o=o.ownerDocument||o,k=o.createElement("script"),Jt(k),wa(k,"link",I),o.head.appendChild(k),f.instance=k);case"void":return null;default:throw Error(M(443,f.type))}else f.type==="stylesheet"&&(f.state.loading&4)===0&&(I=f.instance,f.state.loading|=4,Bd(I,y.precedence,o));return f.instance}function Bd(o,f,y){for(var I=y.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),k=I.length?I[I.length-1]:null,G=k,se=0;se<I.length;se++){var xe=I[se];if(xe.dataset.precedence===f)G=xe;else if(G!==k)break}G?G.parentNode.insertBefore(o,G.nextSibling):(f=y.nodeType===9?y.head:y,f.insertBefore(o,f.firstChild))}function Yp(o,f){o.crossOrigin==null&&(o.crossOrigin=f.crossOrigin),o.referrerPolicy==null&&(o.referrerPolicy=f.referrerPolicy),o.title==null&&(o.title=f.title)}function Rh(o,f){o.crossOrigin==null&&(o.crossOrigin=f.crossOrigin),o.referrerPolicy==null&&(o.referrerPolicy=f.referrerPolicy),o.integrity==null&&(o.integrity=f.integrity)}var Nd=null;function t_(o,f,y){if(Nd===null){var I=new Map,k=Nd=new Map;k.set(y,I)}else k=Nd,I=k.get(y),I||(I=new Map,k.set(y,I));if(I.has(o))return I;for(I.set(o,null),y=y.getElementsByTagName(o),k=0;k<y.length;k++){var G=y[k];if(!(G[Ze]||G[ie]||o==="link"&&G.getAttribute("rel")==="stylesheet")&&G.namespaceURI!=="http://www.w3.org/2000/svg"){var se=G.getAttribute(f)||"";se=o+se;var xe=I.get(se);xe?xe.push(G):I.set(se,[G])}}return I}function Ag(o,f,y){o=o.ownerDocument||o,o.head.insertBefore(y,f==="title"?o.querySelector("head > title"):null)}function Qy(o,f,y){if(y===1||f.itemProp!=null)return!1;switch(o){case"meta":case"title":return!0;case"style":if(typeof f.precedence!="string"||typeof f.href!="string"||f.href==="")break;return!0;case"link":if(typeof f.rel!="string"||typeof f.href!="string"||f.href===""||f.onLoad||f.onError)break;switch(f.rel){case"stylesheet":return o=f.disabled,typeof f.precedence=="string"&&o==null;default:return!0}case"script":if(f.async&&typeof f.async!="function"&&typeof f.async!="symbol"&&!f.onLoad&&!f.onError&&f.src&&typeof f.src=="string")return!0}return!1}function Cg(o){return!(o.type==="stylesheet"&&(o.state.loading&3)===0)}var Vd=null;function Ky(){}function Jy(o,f,y){if(Vd===null)throw Error(M(475));var I=Vd;if(f.type==="stylesheet"&&(typeof y.media!="string"||matchMedia(y.media).matches!==!1)&&(f.state.loading&4)===0){if(f.instance===null){var k=wu(y.href),G=o.querySelector(zf(k));if(G){o=G._p,o!==null&&typeof o=="object"&&typeof o.then=="function"&&(I.count++,I=Ud.bind(I),o.then(I,I)),f.state.loading|=4,f.instance=G,Jt(G);return}G=o.ownerDocument||o,y=e_(y),(k=ma.get(k))&&Yp(y,k),G=G.createElement("link"),Jt(G);var se=G;se._p=new Promise(function(xe,Ne){se.onload=xe,se.onerror=Ne}),wa(G,"link",y),f.instance=G}I.stylesheets===null&&(I.stylesheets=new Map),I.stylesheets.set(f,o),(o=f.state.preload)&&(f.state.loading&3)===0&&(I.count++,f=Ud.bind(I),o.addEventListener("load",f),o.addEventListener("error",f))}}function ev(){if(Vd===null)throw Error(M(475));var o=Vd;return o.stylesheets&&o.count===0&&i_(o,o.stylesheets),0<o.count?function(f){var y=setTimeout(function(){if(o.stylesheets&&i_(o,o.stylesheets),o.unsuspend){var I=o.unsuspend;o.unsuspend=null,I()}},6e4);return o.unsuspend=f,function(){o.unsuspend=null,clearTimeout(y)}}:null}function Ud(){if(this.count--,this.count===0){if(this.stylesheets)i_(this,this.stylesheets);else if(this.unsuspend){var o=this.unsuspend;this.unsuspend=null,o()}}}var Wp=null;function i_(o,f){o.stylesheets=null,o.unsuspend!==null&&(o.count++,Wp=new Map,f.forEach(tv,o),Wp=null,Ud.call(o))}function tv(o,f){if(!(f.state.loading&4)){var y=Wp.get(o);if(y)var I=y.get(null);else{y=new Map,Wp.set(o,y);for(var k=o.querySelectorAll("link[data-precedence],style[data-precedence]"),G=0;G<k.length;G++){var se=k[G];(se.nodeName==="LINK"||se.getAttribute("media")!=="not all")&&(y.set(se.dataset.precedence,se),I=se)}I&&y.set(null,I)}k=f.instance,se=k.getAttribute("data-precedence"),G=y.get(se)||I,G===I&&y.set(null,k),y.set(se,k),this.count++,I=Ud.bind(this),k.addEventListener("load",I),k.addEventListener("error",I),G?G.parentNode.insertBefore(k,G.nextSibling):(o=o.nodeType===9?o.head:o,o.insertBefore(k,o.firstChild)),f.state.loading|=4}}var zh={$$typeof:je,Provider:null,Consumer:null,_currentValue:_r,_currentValue2:_r,_threadCount:0};function r_(o,f,y,I,k,G,se,xe){this.tag=1,this.containerInfo=o,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Pc(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.finishedLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Pc(0),this.hiddenUpdates=Pc(null),this.identifierPrefix=I,this.onUncaughtError=k,this.onCaughtError=G,this.onRecoverableError=se,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=xe,this.incompleteTransitions=new Map}function n_(o,f,y,I,k,G,se,xe,Ne,ot,Pt,$t){return o=new r_(o,f,y,se,xe,Ne,ot,$t),f=1,G===!0&&(f|=24),G=st(3,null,null,f),o.current=G,G.stateNode=o,f=eu(),f.refCount++,o.pooledCache=f,f.refCount++,G.memoizedState={element:I,isDehydrated:y,cache:f},Sf(G),o}function a_(o){return o?(o=ec,o):ec}function s_(o,f,y,I,k,G){k=a_(k),I.context===null?I.context=k:I.pendingContext=k,I=rs(f),I.payload={element:y},G=G===void 0?null:G,G!==null&&(I.callback=G),y=Zo(o,I,f),y!==null&&(os(y,o,f),_u(y,o,f))}function o_(o,f){if(o=o.memoizedState,o!==null&&o.dehydrated!==null){var y=o.retryLane;o.retryLane=y!==0&&y<f?y:f}}function $p(o,f){o_(o,f),(o=o.alternate)&&o_(o,f)}function l_(o){if(o.tag===13){var f=Qa(o,67108864);f!==null&&os(f,o,67108864),$p(o,67108864)}}var jd=!0;function Dg(o,f,y,I){var k=ai.T;ai.T=null;var G=wi.p;try{wi.p=2,Qp(o,f,y,I)}finally{wi.p=G,ai.T=k}}function c_(o,f,y,I){var k=ai.T;ai.T=null;var G=wi.p;try{wi.p=8,Qp(o,f,y,I)}finally{wi.p=G,ai.T=k}}function Qp(o,f,y,I){if(jd){var k=u_(I);if(k===null)jp(o,f,I,Tu,y),la(o,I);else if(f_(k,o,f,y,I))I.stopPropagation();else if(la(o,I),f&4&&-1<iv.indexOf(o)){for(;k!==null;){var G=ht(k);if(G!==null)switch(G.tag){case 3:if(G=G.stateNode,G.current.memoizedState.isDehydrated){var se=fs(G.pendingLanes);if(se!==0){var xe=G;for(xe.pendingLanes|=2,xe.entangledLanes|=2;se;){var Ne=1<<31-Nn(se);xe.entanglements[1]|=Ne,se&=~Ne}Qs(G),(Ut&6)===0&&(oa=Mi()+500,Rd(0))}}break;case 13:xe=Qa(G,2),xe!==null&&os(xe,G,2),Cd(),$p(G,2)}if(G=u_(I),G===null&&jp(o,f,I,Tu,y),G===k)break;k=G}k!==null&&I.stopPropagation()}else jp(o,f,I,null,y)}}function u_(o){return o=di(o),Kp(o)}var Tu=null;function Kp(o){if(Tu=null,o=Xe(o),o!==null){var f=Bi(o);if(f===null)o=null;else{var y=f.tag;if(y===13){if(o=ti(f),o!==null)return o;o=null}else if(y===3){if(f.stateNode.current.memoizedState.isDehydrated)return f.tag===3?f.stateNode.containerInfo:null;o=null}else f!==o&&(o=null)}}return Tu=o,null}function Ig(o){switch(o){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ro()){case us:return 2;case wo:return 8;case Fn:case To:return 32;case el:return 268435456;default:return 32}default:return 32}}var h_=!1,Su=null,Eu=null,Mu=null,qd=new Map,Gd=new Map,wc=[],iv="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function la(o,f){switch(o){case"focusin":case"focusout":Su=null;break;case"dragenter":case"dragleave":Eu=null;break;case"mouseover":case"mouseout":Mu=null;break;case"pointerover":case"pointerout":qd.delete(f.pointerId);break;case"gotpointercapture":case"lostpointercapture":Gd.delete(f.pointerId)}}function ls(o,f,y,I,k,G){return o===null||o.nativeEvent!==G?(o={blockedOn:f,domEventName:y,eventSystemFlags:I,nativeEvent:G,targetContainers:[k]},f!==null&&(f=ht(f),f!==null&&l_(f)),o):(o.eventSystemFlags|=I,f=o.targetContainers,k!==null&&f.indexOf(k)===-1&&f.push(k),o)}function f_(o,f,y,I,k){switch(f){case"focusin":return Su=ls(Su,o,f,y,I,k),!0;case"dragenter":return Eu=ls(Eu,o,f,y,I,k),!0;case"mouseover":return Mu=ls(Mu,o,f,y,I,k),!0;case"pointerover":var G=k.pointerId;return qd.set(G,ls(qd.get(G)||null,o,f,y,I,k)),!0;case"gotpointercapture":return G=k.pointerId,Gd.set(G,ls(Gd.get(G)||null,o,f,y,I,k)),!0}return!1}function Jp(o){var f=Xe(o.target);if(f!==null){var y=Bi(f);if(y!==null){if(f=y.tag,f===13){if(f=ti(y),f!==null){o.blockedOn=f,We(o.priority,function(){if(y.tag===13){var I=Rs(),k=Qa(y,I);k!==null&&os(k,y,I),$p(y,I)}});return}}else if(f===3&&y.stateNode.current.memoizedState.isDehydrated){o.blockedOn=y.tag===3?y.stateNode.containerInfo:null;return}}}o.blockedOn=null}function Oh(o){if(o.blockedOn!==null)return!1;for(var f=o.targetContainers;0<f.length;){var y=u_(o.nativeEvent);if(y===null){y=o.nativeEvent;var I=new y.constructor(y.type,y);ku=I,y.target.dispatchEvent(I),ku=null}else return f=ht(y),f!==null&&l_(f),o.blockedOn=y,!1;f.shift()}return!0}function Lh(o,f,y){Oh(o)&&y.delete(f)}function rv(){h_=!1,Su!==null&&Oh(Su)&&(Su=null),Eu!==null&&Oh(Eu)&&(Eu=null),Mu!==null&&Oh(Mu)&&(Mu=null),qd.forEach(Lh),Gd.forEach(Lh)}function em(o,f){o.blockedOn===f&&(o.blockedOn=null,h_||(h_=!0,x.unstable_scheduleCallback(x.unstable_NormalPriority,rv)))}var Au=null;function Rg(o){Au!==o&&(Au=o,x.unstable_scheduleCallback(x.unstable_NormalPriority,function(){Au===o&&(Au=null);for(var f=0;f<o.length;f+=3){var y=o[f],I=o[f+1],k=o[f+2];if(typeof I!="function"){if(Kp(I||y)===null)continue;break}var G=ht(y);G!==null&&(o.splice(f,3),f-=3,Yn(G,{pending:!0,data:k,method:y.method,action:I},I,k))}}))}function Hd(o){function f(Ne){return em(Ne,o)}Su!==null&&em(Su,o),Eu!==null&&em(Eu,o),Mu!==null&&em(Mu,o),qd.forEach(f),Gd.forEach(f);for(var y=0;y<wc.length;y++){var I=wc[y];I.blockedOn===o&&(I.blockedOn=null)}for(;0<wc.length&&(y=wc[0],y.blockedOn===null);)Jp(y),y.blockedOn===null&&wc.shift();if(y=(o.ownerDocument||o).$$reactFormReplay,y!=null)for(I=0;I<y.length;I+=3){var k=y[I],G=y[I+1],se=k[oe]||null;if(typeof G=="function")se||Rg(y);else if(se){var xe=null;if(G&&G.hasAttribute("formAction")){if(k=G,se=G[oe]||null)xe=se.formAction;else if(Kp(k)!==null)continue}else xe=se.action;typeof xe=="function"?y[I+1]=xe:(y.splice(I,3),I-=3),Rg(y)}}}function tm(o){this._internalRoot=o}Lf.prototype.render=tm.prototype.render=function(o){var f=this._internalRoot;if(f===null)throw Error(M(409));var y=f.current,I=Rs();s_(y,I,o,f,null,null)},Lf.prototype.unmount=tm.prototype.unmount=function(){var o=this._internalRoot;if(o!==null){this._internalRoot=null;var f=o.containerInfo;o.tag===0&&Af(),s_(o.current,2,null,o,null,null),Cd(),f[ye]=null}};function Lf(o){this._internalRoot=o}Lf.prototype.unstable_scheduleHydration=function(o){if(o){var f=Ls();o={blockedOn:null,target:o,priority:f};for(var y=0;y<wc.length&&f!==0&&f<wc[y].priority;y++);wc.splice(y,0,o),y===0&&Jp(o)}};var d_=m.version;if(d_!=="19.0.0")throw Error(M(527,d_,"19.0.0"));wi.findDOMNode=function(o){var f=o._reactInternals;if(f===void 0)throw typeof o.render=="function"?Error(M(188)):(o=Object.keys(o).join(","),Error(M(268,o)));return o=Kt(f),o=o!==null?Di(o):null,o=o===null?null:o.stateNode,o};var p_={bundleType:0,version:"19.0.0",rendererPackageName:"react-dom",currentDispatcherRef:ai,findFiberByHostInstance:Xe,reconcilerVersion:"19.0.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var im=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!im.isDisabled&&im.supportsFiber)try{Bn=im.inject(p_),Kn=im}catch{}}return B_.createRoot=function(o,f){if(!L(o))throw Error(M(299));var y=!1,I="",k=fu,G=gf,se=dh,xe=null;return f!=null&&(f.unstable_strictMode===!0&&(y=!0),f.identifierPrefix!==void 0&&(I=f.identifierPrefix),f.onUncaughtError!==void 0&&(k=f.onUncaughtError),f.onCaughtError!==void 0&&(G=f.onCaughtError),f.onRecoverableError!==void 0&&(se=f.onRecoverableError),f.unstable_transitionCallbacks!==void 0&&(xe=f.unstable_transitionCallbacks)),f=n_(o,1,!1,null,null,y,I,k,G,se,xe,null),o[ye]=f.current,Vp(o.nodeType===8?o.parentNode:o),new tm(f)},B_.hydrateRoot=function(o,f,y){if(!L(o))throw Error(M(299));var I=!1,k="",G=fu,se=gf,xe=dh,Ne=null,ot=null;return y!=null&&(y.unstable_strictMode===!0&&(I=!0),y.identifierPrefix!==void 0&&(k=y.identifierPrefix),y.onUncaughtError!==void 0&&(G=y.onUncaughtError),y.onCaughtError!==void 0&&(se=y.onCaughtError),y.onRecoverableError!==void 0&&(xe=y.onRecoverableError),y.unstable_transitionCallbacks!==void 0&&(Ne=y.unstable_transitionCallbacks),y.formState!==void 0&&(ot=y.formState)),f=n_(o,1,!0,f,y??null,I,k,G,se,xe,Ne,ot),f.context=a_(null),y=f.current,I=Rs(),k=rs(I),k.callback=null,Zo(y,k,I),f.current.lanes=I,Jr(f,I),Qs(f),o[ye]=f.current,Vp(o),new Lf(f)},B_.version="19.0.0",B_}var w1;function QS(){if(w1)return Qv.exports;w1=1;function x(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(x)}catch(m){console.error(m)}}return x(),Qv.exports=$S(),Qv.exports}var KS=QS();const JS=Ay(KS);var g0=function(x,m){return g0=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(w,M){w.__proto__=M}||function(w,M){for(var L in M)Object.prototype.hasOwnProperty.call(M,L)&&(w[L]=M[L])},g0(x,m)};function Ru(x,m){if(typeof m!="function"&&m!==null)throw new TypeError("Class extends value "+String(m)+" is not a constructor or null");g0(x,m);function w(){this.constructor=x}x.prototype=m===null?Object.create(m):(w.prototype=m.prototype,new w)}var ut=function(){return ut=Object.assign||function(m){for(var w,M=1,L=arguments.length;M<L;M++){w=arguments[M];for(var j in w)Object.prototype.hasOwnProperty.call(w,j)&&(m[j]=w[j])}return m},ut.apply(this,arguments)};function Ic(x,m){var w={};for(var M in x)Object.prototype.hasOwnProperty.call(x,M)&&m.indexOf(M)<0&&(w[M]=x[M]);if(x!=null&&typeof Object.getOwnPropertySymbols=="function")for(var L=0,M=Object.getOwnPropertySymbols(x);L<M.length;L++)m.indexOf(M[L])<0&&Object.prototype.propertyIsEnumerable.call(x,M[L])&&(w[M[L]]=x[M[L]]);return w}function jf(x,m,w,M){function L(j){return j instanceof w?j:new w(function(W){W(j)})}return new(w||(w=Promise))(function(j,W){function n(ge){try{ne(M.next(ge))}catch(Ie){W(Ie)}}function ae(ge){try{ne(M.throw(ge))}catch(Ie){W(Ie)}}function ne(ge){ge.done?j(ge.value):L(ge.value).then(n,ae)}ne((M=M.apply(x,m||[])).next())})}function qf(x,m){var w={label:0,sent:function(){if(j[0]&1)throw j[1];return j[1]},trys:[],ops:[]},M,L,j,W=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return W.next=n(0),W.throw=n(1),W.return=n(2),typeof Symbol=="function"&&(W[Symbol.iterator]=function(){return this}),W;function n(ne){return function(ge){return ae([ne,ge])}}function ae(ne){if(M)throw new TypeError("Generator is already executing.");for(;W&&(W=0,ne[0]&&(w=0)),w;)try{if(M=1,L&&(j=ne[0]&2?L.return:ne[0]?L.throw||((j=L.return)&&j.call(L),0):L.next)&&!(j=j.call(L,ne[1])).done)return j;switch(L=0,j&&(ne=[ne[0]&2,j.value]),ne[0]){case 0:case 1:j=ne;break;case 4:return w.label++,{value:ne[1],done:!1};case 5:w.label++,L=ne[1],ne=[0];continue;case 7:ne=w.ops.pop(),w.trys.pop();continue;default:if(j=w.trys,!(j=j.length>0&&j[j.length-1])&&(ne[0]===6||ne[0]===2)){w=0;continue}if(ne[0]===3&&(!j||ne[1]>j[0]&&ne[1]<j[3])){w.label=ne[1];break}if(ne[0]===6&&w.label<j[1]){w.label=j[1],j=ne;break}if(j&&w.label<j[2]){w.label=j[2],w.ops.push(ne);break}j[2]&&w.ops.pop(),w.trys.pop();continue}ne=m.call(x,w)}catch(ge){ne=[6,ge],L=0}finally{M=j=0}if(ne[0]&5)throw ne[1];return{value:ne[0]?ne[1]:void 0,done:!0}}}function Os(x,m,w){if(w||arguments.length===2)for(var M=0,L=m.length,j;M<L;M++)(j||!(M in m))&&(j||(j=Array.prototype.slice.call(m,0,M)),j[M]=m[M]);return x.concat(j||Array.prototype.slice.call(m))}var t0="Invariant Violation",T1=Object.setPrototypeOf,eE=T1===void 0?function(x,m){return x.__proto__=m,x}:T1,Iw=function(x){Ru(m,x);function m(w){w===void 0&&(w=t0);var M=x.call(this,typeof w=="number"?t0+": "+w+" (see https://github.com/apollographql/invariant-packages)":w)||this;return M.framesToPop=1,M.name=t0,eE(M,m.prototype),M}return m}(Error);function rp(x,m){if(!x)throw new Iw(m)}var Rw=["debug","log","warn","error","silent"],tE=Rw.indexOf("log");function ly(x){return function(){if(Rw.indexOf(x)>=tE){var m=console[x]||console.log;return m.apply(console,arguments)}}}(function(x){x.debug=ly("debug"),x.log=ly("log"),x.warn=ly("warn"),x.error=ly("error")})(rp||(rp={}));var G0="3.13.4";function Dc(x){try{return x()}catch{}}const y0=Dc(function(){return globalThis})||Dc(function(){return window})||Dc(function(){return self})||Dc(function(){return global})||Dc(function(){return Dc.constructor("return this")()});var S1=new Map;function v0(x){var m=S1.get(x)||1;return S1.set(x,m+1),"".concat(x,":").concat(m,":").concat(Math.random().toString(36).slice(2))}function zw(x,m){m===void 0&&(m=0);var w=v0("stringifyForDisplay");return JSON.stringify(x,function(M,L){return L===void 0?w:L},m).split(JSON.stringify(w)).join("<undefined>")}function cy(x){return function(m){for(var w=[],M=1;M<arguments.length;M++)w[M-1]=arguments[M];if(typeof m=="number"){var L=m;m=H0(L),m||(m=Z0(L,w),w=[])}x.apply(void 0,[m].concat(w))}}var Ei=Object.assign(function(m,w){for(var M=[],L=2;L<arguments.length;L++)M[L-2]=arguments[L];m||rp(m,H0(w,M)||Z0(w,M))},{debug:cy(rp.debug),log:cy(rp.log),warn:cy(rp.warn),error:cy(rp.error)});function eo(x){for(var m=[],w=1;w<arguments.length;w++)m[w-1]=arguments[w];return new Iw(H0(x,m)||Z0(x,m))}var E1=Symbol.for("ApolloErrorMessageHandler_"+G0);function Ow(x){if(typeof x=="string")return x;try{return zw(x,2).slice(0,1e3)}catch{return"<non-serializable>"}}function H0(x,m){if(m===void 0&&(m=[]),!!x)return y0[E1]&&y0[E1](x,m.map(Ow))}function Z0(x,m){if(m===void 0&&(m=[]),!!x)return"An error occurred! For more details, see the full error text at https://go.apollo.dev/c/err#".concat(encodeURIComponent(JSON.stringify({version:G0,message:x,args:m.map(Ow)})))}function fy(x,m){if(!!!x)throw new Error(m)}function iE(x){return typeof x=="object"&&x!==null}function rE(x,m){if(!!!x)throw new Error("Unexpected invariant triggered.")}const nE=/\r\n|[\n\r]/g;function x0(x,m){let w=0,M=1;for(const L of x.body.matchAll(nE)){if(typeof L.index=="number"||rE(!1),L.index>=m)break;w=L.index+L[0].length,M+=1}return{line:M,column:m+1-w}}function aE(x){return Lw(x.source,x0(x.source,x.start))}function Lw(x,m){const w=x.locationOffset.column-1,M="".padStart(w)+x.body,L=m.line-1,j=x.locationOffset.line-1,W=m.line+j,n=m.line===1?w:0,ae=m.column+n,ne=`${x.name}:${W}:${ae}
`,ge=M.split(/\r\n|[\n\r]/g),Ie=ge[L];if(Ie.length>120){const Re=Math.floor(ae/80),je=ae%80,Qe=[];for(let tt=0;tt<Ie.length;tt+=80)Qe.push(Ie.slice(tt,tt+80));return ne+M1([[`${W} |`,Qe[0]],...Qe.slice(1,Re+1).map(tt=>["|",tt]),["|","^".padStart(je)],["|",Qe[Re+1]]])}return ne+M1([[`${W-1} |`,ge[L-1]],[`${W} |`,Ie],["|","^".padStart(ae)],[`${W+1} |`,ge[L+1]]])}function M1(x){const m=x.filter(([M,L])=>L!==void 0),w=Math.max(...m.map(([M])=>M.length));return m.map(([M,L])=>M.padStart(w)+(L?" "+L:"")).join(`
`)}function sE(x){const m=x[0];return m==null||"kind"in m||"length"in m?{nodes:m,source:x[1],positions:x[2],path:x[3],originalError:x[4],extensions:x[5]}:m}class X0 extends Error{constructor(m,...w){var M,L,j;const{nodes:W,source:n,positions:ae,path:ne,originalError:ge,extensions:Ie}=sE(w);super(m),this.name="GraphQLError",this.path=ne??void 0,this.originalError=ge??void 0,this.nodes=A1(Array.isArray(W)?W:W?[W]:void 0);const Re=A1((M=this.nodes)===null||M===void 0?void 0:M.map(Qe=>Qe.loc).filter(Qe=>Qe!=null));this.source=n??(Re==null||(L=Re[0])===null||L===void 0?void 0:L.source),this.positions=ae??(Re==null?void 0:Re.map(Qe=>Qe.start)),this.locations=ae&&n?ae.map(Qe=>x0(n,Qe)):Re==null?void 0:Re.map(Qe=>x0(Qe.source,Qe.start));const je=iE(ge==null?void 0:ge.extensions)?ge==null?void 0:ge.extensions:void 0;this.extensions=(j=Ie??je)!==null&&j!==void 0?j:Object.create(null),Object.defineProperties(this,{message:{writable:!0,enumerable:!0},name:{enumerable:!1},nodes:{enumerable:!1},source:{enumerable:!1},positions:{enumerable:!1},originalError:{enumerable:!1}}),ge!=null&&ge.stack?Object.defineProperty(this,"stack",{value:ge.stack,writable:!0,configurable:!0}):Error.captureStackTrace?Error.captureStackTrace(this,X0):Object.defineProperty(this,"stack",{value:Error().stack,writable:!0,configurable:!0})}get[Symbol.toStringTag](){return"GraphQLError"}toString(){let m=this.message;if(this.nodes)for(const w of this.nodes)w.loc&&(m+=`

`+aE(w.loc));else if(this.source&&this.locations)for(const w of this.locations)m+=`

`+Lw(this.source,w);return m}toJSON(){const m={message:this.message};return this.locations!=null&&(m.locations=this.locations),this.path!=null&&(m.path=this.path),this.extensions!=null&&Object.keys(this.extensions).length>0&&(m.extensions=this.extensions),m}}function A1(x){return x===void 0||x.length===0?void 0:x}function Ya(x,m,w){return new X0(`Syntax Error: ${w}`,{source:x,positions:[m]})}class oE{constructor(m,w,M){this.start=m.start,this.end=w.end,this.startToken=m,this.endToken=w,this.source=M}get[Symbol.toStringTag](){return"Location"}toJSON(){return{start:this.start,end:this.end}}}class Pw{constructor(m,w,M,L,j,W){this.kind=m,this.start=w,this.end=M,this.line=L,this.column=j,this.value=W,this.prev=null,this.next=null}get[Symbol.toStringTag](){return"Token"}toJSON(){return{kind:this.kind,value:this.value,line:this.line,column:this.column}}}const kw={Name:[],Document:["definitions"],OperationDefinition:["name","variableDefinitions","directives","selectionSet"],VariableDefinition:["variable","type","defaultValue","directives"],Variable:["name"],SelectionSet:["selections"],Field:["alias","name","arguments","directives","selectionSet"],Argument:["name","value"],FragmentSpread:["name","directives"],InlineFragment:["typeCondition","directives","selectionSet"],FragmentDefinition:["name","variableDefinitions","typeCondition","directives","selectionSet"],IntValue:[],FloatValue:[],StringValue:[],BooleanValue:[],NullValue:[],EnumValue:[],ListValue:["values"],ObjectValue:["fields"],ObjectField:["name","value"],Directive:["name","arguments"],NamedType:["name"],ListType:["type"],NonNullType:["type"],SchemaDefinition:["description","directives","operationTypes"],OperationTypeDefinition:["type"],ScalarTypeDefinition:["description","name","directives"],ObjectTypeDefinition:["description","name","interfaces","directives","fields"],FieldDefinition:["description","name","arguments","type","directives"],InputValueDefinition:["description","name","type","defaultValue","directives"],InterfaceTypeDefinition:["description","name","interfaces","directives","fields"],UnionTypeDefinition:["description","name","directives","types"],EnumTypeDefinition:["description","name","directives","values"],EnumValueDefinition:["description","name","directives"],InputObjectTypeDefinition:["description","name","directives","fields"],DirectiveDefinition:["description","name","arguments","locations"],SchemaExtension:["directives","operationTypes"],ScalarTypeExtension:["name","directives"],ObjectTypeExtension:["name","interfaces","directives","fields"],InterfaceTypeExtension:["name","interfaces","directives","fields"],UnionTypeExtension:["name","directives","types"],EnumTypeExtension:["name","directives","values"],InputObjectTypeExtension:["name","directives","fields"]},lE=new Set(Object.keys(kw));function C1(x){const m=x==null?void 0:x.kind;return typeof m=="string"&&lE.has(m)}var gm;(function(x){x.QUERY="query",x.MUTATION="mutation",x.SUBSCRIPTION="subscription"})(gm||(gm={}));var b0;(function(x){x.QUERY="QUERY",x.MUTATION="MUTATION",x.SUBSCRIPTION="SUBSCRIPTION",x.FIELD="FIELD",x.FRAGMENT_DEFINITION="FRAGMENT_DEFINITION",x.FRAGMENT_SPREAD="FRAGMENT_SPREAD",x.INLINE_FRAGMENT="INLINE_FRAGMENT",x.VARIABLE_DEFINITION="VARIABLE_DEFINITION",x.SCHEMA="SCHEMA",x.SCALAR="SCALAR",x.OBJECT="OBJECT",x.FIELD_DEFINITION="FIELD_DEFINITION",x.ARGUMENT_DEFINITION="ARGUMENT_DEFINITION",x.INTERFACE="INTERFACE",x.UNION="UNION",x.ENUM="ENUM",x.ENUM_VALUE="ENUM_VALUE",x.INPUT_OBJECT="INPUT_OBJECT",x.INPUT_FIELD_DEFINITION="INPUT_FIELD_DEFINITION"})(b0||(b0={}));var Si;(function(x){x.NAME="Name",x.DOCUMENT="Document",x.OPERATION_DEFINITION="OperationDefinition",x.VARIABLE_DEFINITION="VariableDefinition",x.SELECTION_SET="SelectionSet",x.FIELD="Field",x.ARGUMENT="Argument",x.FRAGMENT_SPREAD="FragmentSpread",x.INLINE_FRAGMENT="InlineFragment",x.FRAGMENT_DEFINITION="FragmentDefinition",x.VARIABLE="Variable",x.INT="IntValue",x.FLOAT="FloatValue",x.STRING="StringValue",x.BOOLEAN="BooleanValue",x.NULL="NullValue",x.ENUM="EnumValue",x.LIST="ListValue",x.OBJECT="ObjectValue",x.OBJECT_FIELD="ObjectField",x.DIRECTIVE="Directive",x.NAMED_TYPE="NamedType",x.LIST_TYPE="ListType",x.NON_NULL_TYPE="NonNullType",x.SCHEMA_DEFINITION="SchemaDefinition",x.OPERATION_TYPE_DEFINITION="OperationTypeDefinition",x.SCALAR_TYPE_DEFINITION="ScalarTypeDefinition",x.OBJECT_TYPE_DEFINITION="ObjectTypeDefinition",x.FIELD_DEFINITION="FieldDefinition",x.INPUT_VALUE_DEFINITION="InputValueDefinition",x.INTERFACE_TYPE_DEFINITION="InterfaceTypeDefinition",x.UNION_TYPE_DEFINITION="UnionTypeDefinition",x.ENUM_TYPE_DEFINITION="EnumTypeDefinition",x.ENUM_VALUE_DEFINITION="EnumValueDefinition",x.INPUT_OBJECT_TYPE_DEFINITION="InputObjectTypeDefinition",x.DIRECTIVE_DEFINITION="DirectiveDefinition",x.SCHEMA_EXTENSION="SchemaExtension",x.SCALAR_TYPE_EXTENSION="ScalarTypeExtension",x.OBJECT_TYPE_EXTENSION="ObjectTypeExtension",x.INTERFACE_TYPE_EXTENSION="InterfaceTypeExtension",x.UNION_TYPE_EXTENSION="UnionTypeExtension",x.ENUM_TYPE_EXTENSION="EnumTypeExtension",x.INPUT_OBJECT_TYPE_EXTENSION="InputObjectTypeExtension"})(Si||(Si={}));function w0(x){return x===9||x===32}function Q_(x){return x>=48&&x<=57}function Fw(x){return x>=97&&x<=122||x>=65&&x<=90}function Bw(x){return Fw(x)||x===95}function cE(x){return Fw(x)||Q_(x)||x===95}function uE(x){var m;let w=Number.MAX_SAFE_INTEGER,M=null,L=-1;for(let W=0;W<x.length;++W){var j;const n=x[W],ae=hE(n);ae!==n.length&&(M=(j=M)!==null&&j!==void 0?j:W,L=W,W!==0&&ae<w&&(w=ae))}return x.map((W,n)=>n===0?W:W.slice(w)).slice((m=M)!==null&&m!==void 0?m:0,L+1)}function hE(x){let m=0;for(;m<x.length&&w0(x.charCodeAt(m));)++m;return m}function fE(x,m){const w=x.replace(/"""/g,'\\"""'),M=w.split(/\r\n|[\n\r]/g),L=M.length===1,j=M.length>1&&M.slice(1).every(je=>je.length===0||w0(je.charCodeAt(0))),W=w.endsWith('\\"""'),n=x.endsWith('"')&&!W,ae=x.endsWith("\\"),ne=n||ae,ge=!L||x.length>70||ne||j||W;let Ie="";const Re=L&&w0(x.charCodeAt(0));return(ge&&!Re||j)&&(Ie+=`
`),Ie+=w,(ge||ne)&&(Ie+=`
`),'"""'+Ie+'"""'}var Xt;(function(x){x.SOF="<SOF>",x.EOF="<EOF>",x.BANG="!",x.DOLLAR="$",x.AMP="&",x.PAREN_L="(",x.PAREN_R=")",x.SPREAD="...",x.COLON=":",x.EQUALS="=",x.AT="@",x.BRACKET_L="[",x.BRACKET_R="]",x.BRACE_L="{",x.PIPE="|",x.BRACE_R="}",x.NAME="Name",x.INT="Int",x.FLOAT="Float",x.STRING="String",x.BLOCK_STRING="BlockString",x.COMMENT="Comment"})(Xt||(Xt={}));class dE{constructor(m){const w=new Pw(Xt.SOF,0,0,0,0);this.source=m,this.lastToken=w,this.token=w,this.line=1,this.lineStart=0}get[Symbol.toStringTag](){return"Lexer"}advance(){return this.lastToken=this.token,this.token=this.lookahead()}lookahead(){let m=this.token;if(m.kind!==Xt.EOF)do if(m.next)m=m.next;else{const w=mE(this,m.end);m.next=w,w.prev=m,m=w}while(m.kind===Xt.COMMENT);return m}}function pE(x){return x===Xt.BANG||x===Xt.DOLLAR||x===Xt.AMP||x===Xt.PAREN_L||x===Xt.PAREN_R||x===Xt.SPREAD||x===Xt.COLON||x===Xt.EQUALS||x===Xt.AT||x===Xt.BRACKET_L||x===Xt.BRACKET_R||x===Xt.BRACE_L||x===Xt.PIPE||x===Xt.BRACE_R}function Im(x){return x>=0&&x<=55295||x>=57344&&x<=1114111}function Dy(x,m){return Nw(x.charCodeAt(m))&&Vw(x.charCodeAt(m+1))}function Nw(x){return x>=55296&&x<=56319}function Vw(x){return x>=56320&&x<=57343}function sp(x,m){const w=x.source.body.codePointAt(m);if(w===void 0)return Xt.EOF;if(w>=32&&w<=126){const M=String.fromCodePoint(w);return M==='"'?`'"'`:`"${M}"`}return"U+"+w.toString(16).toUpperCase().padStart(4,"0")}function Ta(x,m,w,M,L){const j=x.line,W=1+w-x.lineStart;return new Pw(m,w,M,j,W,L)}function mE(x,m){const w=x.source.body,M=w.length;let L=m;for(;L<M;){const j=w.charCodeAt(L);switch(j){case 65279:case 9:case 32:case 44:++L;continue;case 10:++L,++x.line,x.lineStart=L;continue;case 13:w.charCodeAt(L+1)===10?L+=2:++L,++x.line,x.lineStart=L;continue;case 35:return _E(x,L);case 33:return Ta(x,Xt.BANG,L,L+1);case 36:return Ta(x,Xt.DOLLAR,L,L+1);case 38:return Ta(x,Xt.AMP,L,L+1);case 40:return Ta(x,Xt.PAREN_L,L,L+1);case 41:return Ta(x,Xt.PAREN_R,L,L+1);case 46:if(w.charCodeAt(L+1)===46&&w.charCodeAt(L+2)===46)return Ta(x,Xt.SPREAD,L,L+3);break;case 58:return Ta(x,Xt.COLON,L,L+1);case 61:return Ta(x,Xt.EQUALS,L,L+1);case 64:return Ta(x,Xt.AT,L,L+1);case 91:return Ta(x,Xt.BRACKET_L,L,L+1);case 93:return Ta(x,Xt.BRACKET_R,L,L+1);case 123:return Ta(x,Xt.BRACE_L,L,L+1);case 124:return Ta(x,Xt.PIPE,L,L+1);case 125:return Ta(x,Xt.BRACE_R,L,L+1);case 34:return w.charCodeAt(L+1)===34&&w.charCodeAt(L+2)===34?wE(x,L):yE(x,L)}if(Q_(j)||j===45)return gE(x,L,j);if(Bw(j))return TE(x,L);throw Ya(x.source,L,j===39?`Unexpected single quote character ('), did you mean to use a double quote (")?`:Im(j)||Dy(w,L)?`Unexpected character: ${sp(x,L)}.`:`Invalid character: ${sp(x,L)}.`)}return Ta(x,Xt.EOF,M,M)}function _E(x,m){const w=x.source.body,M=w.length;let L=m+1;for(;L<M;){const j=w.charCodeAt(L);if(j===10||j===13)break;if(Im(j))++L;else if(Dy(w,L))L+=2;else break}return Ta(x,Xt.COMMENT,m,L,w.slice(m+1,L))}function gE(x,m,w){const M=x.source.body;let L=m,j=w,W=!1;if(j===45&&(j=M.charCodeAt(++L)),j===48){if(j=M.charCodeAt(++L),Q_(j))throw Ya(x.source,L,`Invalid number, unexpected digit after 0: ${sp(x,L)}.`)}else L=i0(x,L,j),j=M.charCodeAt(L);if(j===46&&(W=!0,j=M.charCodeAt(++L),L=i0(x,L,j),j=M.charCodeAt(L)),(j===69||j===101)&&(W=!0,j=M.charCodeAt(++L),(j===43||j===45)&&(j=M.charCodeAt(++L)),L=i0(x,L,j),j=M.charCodeAt(L)),j===46||Bw(j))throw Ya(x.source,L,`Invalid number, expected digit but got: ${sp(x,L)}.`);return Ta(x,W?Xt.FLOAT:Xt.INT,m,L,M.slice(m,L))}function i0(x,m,w){if(!Q_(w))throw Ya(x.source,m,`Invalid number, expected digit but got: ${sp(x,m)}.`);const M=x.source.body;let L=m+1;for(;Q_(M.charCodeAt(L));)++L;return L}function yE(x,m){const w=x.source.body,M=w.length;let L=m+1,j=L,W="";for(;L<M;){const n=w.charCodeAt(L);if(n===34)return W+=w.slice(j,L),Ta(x,Xt.STRING,m,L+1,W);if(n===92){W+=w.slice(j,L);const ae=w.charCodeAt(L+1)===117?w.charCodeAt(L+2)===123?vE(x,L):xE(x,L):bE(x,L);W+=ae.value,L+=ae.size,j=L;continue}if(n===10||n===13)break;if(Im(n))++L;else if(Dy(w,L))L+=2;else throw Ya(x.source,L,`Invalid character within String: ${sp(x,L)}.`)}throw Ya(x.source,L,"Unterminated string.")}function vE(x,m){const w=x.source.body;let M=0,L=3;for(;L<12;){const j=w.charCodeAt(m+L++);if(j===125){if(L<5||!Im(M))break;return{value:String.fromCodePoint(M),size:L}}if(M=M<<4|G_(j),M<0)break}throw Ya(x.source,m,`Invalid Unicode escape sequence: "${w.slice(m,m+L)}".`)}function xE(x,m){const w=x.source.body,M=D1(w,m+2);if(Im(M))return{value:String.fromCodePoint(M),size:6};if(Nw(M)&&w.charCodeAt(m+6)===92&&w.charCodeAt(m+7)===117){const L=D1(w,m+8);if(Vw(L))return{value:String.fromCodePoint(M,L),size:12}}throw Ya(x.source,m,`Invalid Unicode escape sequence: "${w.slice(m,m+6)}".`)}function D1(x,m){return G_(x.charCodeAt(m))<<12|G_(x.charCodeAt(m+1))<<8|G_(x.charCodeAt(m+2))<<4|G_(x.charCodeAt(m+3))}function G_(x){return x>=48&&x<=57?x-48:x>=65&&x<=70?x-55:x>=97&&x<=102?x-87:-1}function bE(x,m){const w=x.source.body;switch(w.charCodeAt(m+1)){case 34:return{value:'"',size:2};case 92:return{value:"\\",size:2};case 47:return{value:"/",size:2};case 98:return{value:"\b",size:2};case 102:return{value:"\f",size:2};case 110:return{value:`
`,size:2};case 114:return{value:"\r",size:2};case 116:return{value:"	",size:2}}throw Ya(x.source,m,`Invalid character escape sequence: "${w.slice(m,m+2)}".`)}function wE(x,m){const w=x.source.body,M=w.length;let L=x.lineStart,j=m+3,W=j,n="";const ae=[];for(;j<M;){const ne=w.charCodeAt(j);if(ne===34&&w.charCodeAt(j+1)===34&&w.charCodeAt(j+2)===34){n+=w.slice(W,j),ae.push(n);const ge=Ta(x,Xt.BLOCK_STRING,m,j+3,uE(ae).join(`
`));return x.line+=ae.length-1,x.lineStart=L,ge}if(ne===92&&w.charCodeAt(j+1)===34&&w.charCodeAt(j+2)===34&&w.charCodeAt(j+3)===34){n+=w.slice(W,j),W=j+1,j+=4;continue}if(ne===10||ne===13){n+=w.slice(W,j),ae.push(n),ne===13&&w.charCodeAt(j+1)===10?j+=2:++j,n="",W=j,L=j;continue}if(Im(ne))++j;else if(Dy(w,j))j+=2;else throw Ya(x.source,j,`Invalid character within String: ${sp(x,j)}.`)}throw Ya(x.source,j,"Unterminated string.")}function TE(x,m){const w=x.source.body,M=w.length;let L=m+1;for(;L<M;){const j=w.charCodeAt(L);if(cE(j))++L;else break}return Ta(x,Xt.NAME,m,L,w.slice(m,L))}const SE=10,Uw=2;function Y0(x){return Iy(x,[])}function Iy(x,m){switch(typeof x){case"string":return JSON.stringify(x);case"function":return x.name?`[function ${x.name}]`:"[function]";case"object":return EE(x,m);default:return String(x)}}function EE(x,m){if(x===null)return"null";if(m.includes(x))return"[Circular]";const w=[...m,x];if(ME(x)){const M=x.toJSON();if(M!==x)return typeof M=="string"?M:Iy(M,w)}else if(Array.isArray(x))return CE(x,w);return AE(x,w)}function ME(x){return typeof x.toJSON=="function"}function AE(x,m){const w=Object.entries(x);return w.length===0?"{}":m.length>Uw?"["+DE(x)+"]":"{ "+w.map(([L,j])=>L+": "+Iy(j,m)).join(", ")+" }"}function CE(x,m){if(x.length===0)return"[]";if(m.length>Uw)return"[Array]";const w=Math.min(SE,x.length),M=x.length-w,L=[];for(let j=0;j<w;++j)L.push(Iy(x[j],m));return M===1?L.push("... 1 more item"):M>1&&L.push(`... ${M} more items`),"["+L.join(", ")+"]"}function DE(x){const m=Object.prototype.toString.call(x).replace(/^\[object /,"").replace(/]$/,"");if(m==="Object"&&typeof x.constructor=="function"){const w=x.constructor.name;if(typeof w=="string"&&w!=="")return w}return m}const IE=globalThis.process&&!0,RE=IE?function(m,w){return m instanceof w}:function(m,w){if(m instanceof w)return!0;if(typeof m=="object"&&m!==null){var M;const L=w.prototype[Symbol.toStringTag],j=Symbol.toStringTag in m?m[Symbol.toStringTag]:(M=m.constructor)===null||M===void 0?void 0:M.name;if(L===j){const W=Y0(m);throw new Error(`Cannot use ${L} "${W}" from another module or realm.

Ensure that there is only one instance of "graphql" in the node_modules
directory. If different versions of "graphql" are the dependencies of other
relied on modules, use "resolutions" to ensure only one version is installed.

https://yarnpkg.com/en/docs/selective-version-resolutions

Duplicate "graphql" modules cannot be used at the same time since different
versions may have different capabilities and behavior. The data from one
version used in the function from another could produce confusing and
spurious results.`)}}return!1};class jw{constructor(m,w="GraphQL request",M={line:1,column:1}){typeof m=="string"||fy(!1,`Body must be a string. Received: ${Y0(m)}.`),this.body=m,this.name=w,this.locationOffset=M,this.locationOffset.line>0||fy(!1,"line in locationOffset is 1-indexed and must be positive."),this.locationOffset.column>0||fy(!1,"column in locationOffset is 1-indexed and must be positive.")}get[Symbol.toStringTag](){return"Source"}}function zE(x){return RE(x,jw)}function OE(x,m){const w=new LE(x,m),M=w.parseDocument();return Object.defineProperty(M,"tokenCount",{enumerable:!1,value:w.tokenCount}),M}class LE{constructor(m,w={}){const M=zE(m)?m:new jw(m);this._lexer=new dE(M),this._options=w,this._tokenCounter=0}get tokenCount(){return this._tokenCounter}parseName(){const m=this.expectToken(Xt.NAME);return this.node(m,{kind:Si.NAME,value:m.value})}parseDocument(){return this.node(this._lexer.token,{kind:Si.DOCUMENT,definitions:this.many(Xt.SOF,this.parseDefinition,Xt.EOF)})}parseDefinition(){if(this.peek(Xt.BRACE_L))return this.parseOperationDefinition();const m=this.peekDescription(),w=m?this._lexer.lookahead():this._lexer.token;if(w.kind===Xt.NAME){switch(w.value){case"schema":return this.parseSchemaDefinition();case"scalar":return this.parseScalarTypeDefinition();case"type":return this.parseObjectTypeDefinition();case"interface":return this.parseInterfaceTypeDefinition();case"union":return this.parseUnionTypeDefinition();case"enum":return this.parseEnumTypeDefinition();case"input":return this.parseInputObjectTypeDefinition();case"directive":return this.parseDirectiveDefinition()}if(m)throw Ya(this._lexer.source,this._lexer.token.start,"Unexpected description, descriptions are supported only on type definitions.");switch(w.value){case"query":case"mutation":case"subscription":return this.parseOperationDefinition();case"fragment":return this.parseFragmentDefinition();case"extend":return this.parseTypeSystemExtension()}}throw this.unexpected(w)}parseOperationDefinition(){const m=this._lexer.token;if(this.peek(Xt.BRACE_L))return this.node(m,{kind:Si.OPERATION_DEFINITION,operation:gm.QUERY,name:void 0,variableDefinitions:[],directives:[],selectionSet:this.parseSelectionSet()});const w=this.parseOperationType();let M;return this.peek(Xt.NAME)&&(M=this.parseName()),this.node(m,{kind:Si.OPERATION_DEFINITION,operation:w,name:M,variableDefinitions:this.parseVariableDefinitions(),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet()})}parseOperationType(){const m=this.expectToken(Xt.NAME);switch(m.value){case"query":return gm.QUERY;case"mutation":return gm.MUTATION;case"subscription":return gm.SUBSCRIPTION}throw this.unexpected(m)}parseVariableDefinitions(){return this.optionalMany(Xt.PAREN_L,this.parseVariableDefinition,Xt.PAREN_R)}parseVariableDefinition(){return this.node(this._lexer.token,{kind:Si.VARIABLE_DEFINITION,variable:this.parseVariable(),type:(this.expectToken(Xt.COLON),this.parseTypeReference()),defaultValue:this.expectOptionalToken(Xt.EQUALS)?this.parseConstValueLiteral():void 0,directives:this.parseConstDirectives()})}parseVariable(){const m=this._lexer.token;return this.expectToken(Xt.DOLLAR),this.node(m,{kind:Si.VARIABLE,name:this.parseName()})}parseSelectionSet(){return this.node(this._lexer.token,{kind:Si.SELECTION_SET,selections:this.many(Xt.BRACE_L,this.parseSelection,Xt.BRACE_R)})}parseSelection(){return this.peek(Xt.SPREAD)?this.parseFragment():this.parseField()}parseField(){const m=this._lexer.token,w=this.parseName();let M,L;return this.expectOptionalToken(Xt.COLON)?(M=w,L=this.parseName()):L=w,this.node(m,{kind:Si.FIELD,alias:M,name:L,arguments:this.parseArguments(!1),directives:this.parseDirectives(!1),selectionSet:this.peek(Xt.BRACE_L)?this.parseSelectionSet():void 0})}parseArguments(m){const w=m?this.parseConstArgument:this.parseArgument;return this.optionalMany(Xt.PAREN_L,w,Xt.PAREN_R)}parseArgument(m=!1){const w=this._lexer.token,M=this.parseName();return this.expectToken(Xt.COLON),this.node(w,{kind:Si.ARGUMENT,name:M,value:this.parseValueLiteral(m)})}parseConstArgument(){return this.parseArgument(!0)}parseFragment(){const m=this._lexer.token;this.expectToken(Xt.SPREAD);const w=this.expectOptionalKeyword("on");return!w&&this.peek(Xt.NAME)?this.node(m,{kind:Si.FRAGMENT_SPREAD,name:this.parseFragmentName(),directives:this.parseDirectives(!1)}):this.node(m,{kind:Si.INLINE_FRAGMENT,typeCondition:w?this.parseNamedType():void 0,directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet()})}parseFragmentDefinition(){const m=this._lexer.token;return this.expectKeyword("fragment"),this._options.allowLegacyFragmentVariables===!0?this.node(m,{kind:Si.FRAGMENT_DEFINITION,name:this.parseFragmentName(),variableDefinitions:this.parseVariableDefinitions(),typeCondition:(this.expectKeyword("on"),this.parseNamedType()),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet()}):this.node(m,{kind:Si.FRAGMENT_DEFINITION,name:this.parseFragmentName(),typeCondition:(this.expectKeyword("on"),this.parseNamedType()),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet()})}parseFragmentName(){if(this._lexer.token.value==="on")throw this.unexpected();return this.parseName()}parseValueLiteral(m){const w=this._lexer.token;switch(w.kind){case Xt.BRACKET_L:return this.parseList(m);case Xt.BRACE_L:return this.parseObject(m);case Xt.INT:return this.advanceLexer(),this.node(w,{kind:Si.INT,value:w.value});case Xt.FLOAT:return this.advanceLexer(),this.node(w,{kind:Si.FLOAT,value:w.value});case Xt.STRING:case Xt.BLOCK_STRING:return this.parseStringLiteral();case Xt.NAME:switch(this.advanceLexer(),w.value){case"true":return this.node(w,{kind:Si.BOOLEAN,value:!0});case"false":return this.node(w,{kind:Si.BOOLEAN,value:!1});case"null":return this.node(w,{kind:Si.NULL});default:return this.node(w,{kind:Si.ENUM,value:w.value})}case Xt.DOLLAR:if(m)if(this.expectToken(Xt.DOLLAR),this._lexer.token.kind===Xt.NAME){const M=this._lexer.token.value;throw Ya(this._lexer.source,w.start,`Unexpected variable "$${M}" in constant value.`)}else throw this.unexpected(w);return this.parseVariable();default:throw this.unexpected()}}parseConstValueLiteral(){return this.parseValueLiteral(!0)}parseStringLiteral(){const m=this._lexer.token;return this.advanceLexer(),this.node(m,{kind:Si.STRING,value:m.value,block:m.kind===Xt.BLOCK_STRING})}parseList(m){const w=()=>this.parseValueLiteral(m);return this.node(this._lexer.token,{kind:Si.LIST,values:this.any(Xt.BRACKET_L,w,Xt.BRACKET_R)})}parseObject(m){const w=()=>this.parseObjectField(m);return this.node(this._lexer.token,{kind:Si.OBJECT,fields:this.any(Xt.BRACE_L,w,Xt.BRACE_R)})}parseObjectField(m){const w=this._lexer.token,M=this.parseName();return this.expectToken(Xt.COLON),this.node(w,{kind:Si.OBJECT_FIELD,name:M,value:this.parseValueLiteral(m)})}parseDirectives(m){const w=[];for(;this.peek(Xt.AT);)w.push(this.parseDirective(m));return w}parseConstDirectives(){return this.parseDirectives(!0)}parseDirective(m){const w=this._lexer.token;return this.expectToken(Xt.AT),this.node(w,{kind:Si.DIRECTIVE,name:this.parseName(),arguments:this.parseArguments(m)})}parseTypeReference(){const m=this._lexer.token;let w;if(this.expectOptionalToken(Xt.BRACKET_L)){const M=this.parseTypeReference();this.expectToken(Xt.BRACKET_R),w=this.node(m,{kind:Si.LIST_TYPE,type:M})}else w=this.parseNamedType();return this.expectOptionalToken(Xt.BANG)?this.node(m,{kind:Si.NON_NULL_TYPE,type:w}):w}parseNamedType(){return this.node(this._lexer.token,{kind:Si.NAMED_TYPE,name:this.parseName()})}peekDescription(){return this.peek(Xt.STRING)||this.peek(Xt.BLOCK_STRING)}parseDescription(){if(this.peekDescription())return this.parseStringLiteral()}parseSchemaDefinition(){const m=this._lexer.token,w=this.parseDescription();this.expectKeyword("schema");const M=this.parseConstDirectives(),L=this.many(Xt.BRACE_L,this.parseOperationTypeDefinition,Xt.BRACE_R);return this.node(m,{kind:Si.SCHEMA_DEFINITION,description:w,directives:M,operationTypes:L})}parseOperationTypeDefinition(){const m=this._lexer.token,w=this.parseOperationType();this.expectToken(Xt.COLON);const M=this.parseNamedType();return this.node(m,{kind:Si.OPERATION_TYPE_DEFINITION,operation:w,type:M})}parseScalarTypeDefinition(){const m=this._lexer.token,w=this.parseDescription();this.expectKeyword("scalar");const M=this.parseName(),L=this.parseConstDirectives();return this.node(m,{kind:Si.SCALAR_TYPE_DEFINITION,description:w,name:M,directives:L})}parseObjectTypeDefinition(){const m=this._lexer.token,w=this.parseDescription();this.expectKeyword("type");const M=this.parseName(),L=this.parseImplementsInterfaces(),j=this.parseConstDirectives(),W=this.parseFieldsDefinition();return this.node(m,{kind:Si.OBJECT_TYPE_DEFINITION,description:w,name:M,interfaces:L,directives:j,fields:W})}parseImplementsInterfaces(){return this.expectOptionalKeyword("implements")?this.delimitedMany(Xt.AMP,this.parseNamedType):[]}parseFieldsDefinition(){return this.optionalMany(Xt.BRACE_L,this.parseFieldDefinition,Xt.BRACE_R)}parseFieldDefinition(){const m=this._lexer.token,w=this.parseDescription(),M=this.parseName(),L=this.parseArgumentDefs();this.expectToken(Xt.COLON);const j=this.parseTypeReference(),W=this.parseConstDirectives();return this.node(m,{kind:Si.FIELD_DEFINITION,description:w,name:M,arguments:L,type:j,directives:W})}parseArgumentDefs(){return this.optionalMany(Xt.PAREN_L,this.parseInputValueDef,Xt.PAREN_R)}parseInputValueDef(){const m=this._lexer.token,w=this.parseDescription(),M=this.parseName();this.expectToken(Xt.COLON);const L=this.parseTypeReference();let j;this.expectOptionalToken(Xt.EQUALS)&&(j=this.parseConstValueLiteral());const W=this.parseConstDirectives();return this.node(m,{kind:Si.INPUT_VALUE_DEFINITION,description:w,name:M,type:L,defaultValue:j,directives:W})}parseInterfaceTypeDefinition(){const m=this._lexer.token,w=this.parseDescription();this.expectKeyword("interface");const M=this.parseName(),L=this.parseImplementsInterfaces(),j=this.parseConstDirectives(),W=this.parseFieldsDefinition();return this.node(m,{kind:Si.INTERFACE_TYPE_DEFINITION,description:w,name:M,interfaces:L,directives:j,fields:W})}parseUnionTypeDefinition(){const m=this._lexer.token,w=this.parseDescription();this.expectKeyword("union");const M=this.parseName(),L=this.parseConstDirectives(),j=this.parseUnionMemberTypes();return this.node(m,{kind:Si.UNION_TYPE_DEFINITION,description:w,name:M,directives:L,types:j})}parseUnionMemberTypes(){return this.expectOptionalToken(Xt.EQUALS)?this.delimitedMany(Xt.PIPE,this.parseNamedType):[]}parseEnumTypeDefinition(){const m=this._lexer.token,w=this.parseDescription();this.expectKeyword("enum");const M=this.parseName(),L=this.parseConstDirectives(),j=this.parseEnumValuesDefinition();return this.node(m,{kind:Si.ENUM_TYPE_DEFINITION,description:w,name:M,directives:L,values:j})}parseEnumValuesDefinition(){return this.optionalMany(Xt.BRACE_L,this.parseEnumValueDefinition,Xt.BRACE_R)}parseEnumValueDefinition(){const m=this._lexer.token,w=this.parseDescription(),M=this.parseEnumValueName(),L=this.parseConstDirectives();return this.node(m,{kind:Si.ENUM_VALUE_DEFINITION,description:w,name:M,directives:L})}parseEnumValueName(){if(this._lexer.token.value==="true"||this._lexer.token.value==="false"||this._lexer.token.value==="null")throw Ya(this._lexer.source,this._lexer.token.start,`${uy(this._lexer.token)} is reserved and cannot be used for an enum value.`);return this.parseName()}parseInputObjectTypeDefinition(){const m=this._lexer.token,w=this.parseDescription();this.expectKeyword("input");const M=this.parseName(),L=this.parseConstDirectives(),j=this.parseInputFieldsDefinition();return this.node(m,{kind:Si.INPUT_OBJECT_TYPE_DEFINITION,description:w,name:M,directives:L,fields:j})}parseInputFieldsDefinition(){return this.optionalMany(Xt.BRACE_L,this.parseInputValueDef,Xt.BRACE_R)}parseTypeSystemExtension(){const m=this._lexer.lookahead();if(m.kind===Xt.NAME)switch(m.value){case"schema":return this.parseSchemaExtension();case"scalar":return this.parseScalarTypeExtension();case"type":return this.parseObjectTypeExtension();case"interface":return this.parseInterfaceTypeExtension();case"union":return this.parseUnionTypeExtension();case"enum":return this.parseEnumTypeExtension();case"input":return this.parseInputObjectTypeExtension()}throw this.unexpected(m)}parseSchemaExtension(){const m=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("schema");const w=this.parseConstDirectives(),M=this.optionalMany(Xt.BRACE_L,this.parseOperationTypeDefinition,Xt.BRACE_R);if(w.length===0&&M.length===0)throw this.unexpected();return this.node(m,{kind:Si.SCHEMA_EXTENSION,directives:w,operationTypes:M})}parseScalarTypeExtension(){const m=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("scalar");const w=this.parseName(),M=this.parseConstDirectives();if(M.length===0)throw this.unexpected();return this.node(m,{kind:Si.SCALAR_TYPE_EXTENSION,name:w,directives:M})}parseObjectTypeExtension(){const m=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("type");const w=this.parseName(),M=this.parseImplementsInterfaces(),L=this.parseConstDirectives(),j=this.parseFieldsDefinition();if(M.length===0&&L.length===0&&j.length===0)throw this.unexpected();return this.node(m,{kind:Si.OBJECT_TYPE_EXTENSION,name:w,interfaces:M,directives:L,fields:j})}parseInterfaceTypeExtension(){const m=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("interface");const w=this.parseName(),M=this.parseImplementsInterfaces(),L=this.parseConstDirectives(),j=this.parseFieldsDefinition();if(M.length===0&&L.length===0&&j.length===0)throw this.unexpected();return this.node(m,{kind:Si.INTERFACE_TYPE_EXTENSION,name:w,interfaces:M,directives:L,fields:j})}parseUnionTypeExtension(){const m=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("union");const w=this.parseName(),M=this.parseConstDirectives(),L=this.parseUnionMemberTypes();if(M.length===0&&L.length===0)throw this.unexpected();return this.node(m,{kind:Si.UNION_TYPE_EXTENSION,name:w,directives:M,types:L})}parseEnumTypeExtension(){const m=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("enum");const w=this.parseName(),M=this.parseConstDirectives(),L=this.parseEnumValuesDefinition();if(M.length===0&&L.length===0)throw this.unexpected();return this.node(m,{kind:Si.ENUM_TYPE_EXTENSION,name:w,directives:M,values:L})}parseInputObjectTypeExtension(){const m=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("input");const w=this.parseName(),M=this.parseConstDirectives(),L=this.parseInputFieldsDefinition();if(M.length===0&&L.length===0)throw this.unexpected();return this.node(m,{kind:Si.INPUT_OBJECT_TYPE_EXTENSION,name:w,directives:M,fields:L})}parseDirectiveDefinition(){const m=this._lexer.token,w=this.parseDescription();this.expectKeyword("directive"),this.expectToken(Xt.AT);const M=this.parseName(),L=this.parseArgumentDefs(),j=this.expectOptionalKeyword("repeatable");this.expectKeyword("on");const W=this.parseDirectiveLocations();return this.node(m,{kind:Si.DIRECTIVE_DEFINITION,description:w,name:M,arguments:L,repeatable:j,locations:W})}parseDirectiveLocations(){return this.delimitedMany(Xt.PIPE,this.parseDirectiveLocation)}parseDirectiveLocation(){const m=this._lexer.token,w=this.parseName();if(Object.prototype.hasOwnProperty.call(b0,w.value))return w;throw this.unexpected(m)}node(m,w){return this._options.noLocation!==!0&&(w.loc=new oE(m,this._lexer.lastToken,this._lexer.source)),w}peek(m){return this._lexer.token.kind===m}expectToken(m){const w=this._lexer.token;if(w.kind===m)return this.advanceLexer(),w;throw Ya(this._lexer.source,w.start,`Expected ${qw(m)}, found ${uy(w)}.`)}expectOptionalToken(m){return this._lexer.token.kind===m?(this.advanceLexer(),!0):!1}expectKeyword(m){const w=this._lexer.token;if(w.kind===Xt.NAME&&w.value===m)this.advanceLexer();else throw Ya(this._lexer.source,w.start,`Expected "${m}", found ${uy(w)}.`)}expectOptionalKeyword(m){const w=this._lexer.token;return w.kind===Xt.NAME&&w.value===m?(this.advanceLexer(),!0):!1}unexpected(m){const w=m??this._lexer.token;return Ya(this._lexer.source,w.start,`Unexpected ${uy(w)}.`)}any(m,w,M){this.expectToken(m);const L=[];for(;!this.expectOptionalToken(M);)L.push(w.call(this));return L}optionalMany(m,w,M){if(this.expectOptionalToken(m)){const L=[];do L.push(w.call(this));while(!this.expectOptionalToken(M));return L}return[]}many(m,w,M){this.expectToken(m);const L=[];do L.push(w.call(this));while(!this.expectOptionalToken(M));return L}delimitedMany(m,w){this.expectOptionalToken(m);const M=[];do M.push(w.call(this));while(this.expectOptionalToken(m));return M}advanceLexer(){const{maxTokens:m}=this._options,w=this._lexer.advance();if(w.kind!==Xt.EOF&&(++this._tokenCounter,m!==void 0&&this._tokenCounter>m))throw Ya(this._lexer.source,w.start,`Document contains more that ${m} tokens. Parsing aborted.`)}}function uy(x){const m=x.value;return qw(x.kind)+(m!=null?` "${m}"`:"")}function qw(x){return pE(x)?`"${x}"`:x}function PE(x){return`"${x.replace(kE,FE)}"`}const kE=/[\x00-\x1f\x22\x5c\x7f-\x9f]/g;function FE(x){return BE[x.charCodeAt(0)]}const BE=["\\u0000","\\u0001","\\u0002","\\u0003","\\u0004","\\u0005","\\u0006","\\u0007","\\b","\\t","\\n","\\u000B","\\f","\\r","\\u000E","\\u000F","\\u0010","\\u0011","\\u0012","\\u0013","\\u0014","\\u0015","\\u0016","\\u0017","\\u0018","\\u0019","\\u001A","\\u001B","\\u001C","\\u001D","\\u001E","\\u001F","","",'\\"',"","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","\\\\","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","\\u007F","\\u0080","\\u0081","\\u0082","\\u0083","\\u0084","\\u0085","\\u0086","\\u0087","\\u0088","\\u0089","\\u008A","\\u008B","\\u008C","\\u008D","\\u008E","\\u008F","\\u0090","\\u0091","\\u0092","\\u0093","\\u0094","\\u0095","\\u0096","\\u0097","\\u0098","\\u0099","\\u009A","\\u009B","\\u009C","\\u009D","\\u009E","\\u009F"],Ry=Object.freeze({});function Rc(x,m,w=kw){const M=new Map;for(const $e of Object.values(Si))M.set($e,NE(m,$e));let L,j=Array.isArray(x),W=[x],n=-1,ae=[],ne=x,ge,Ie;const Re=[],je=[];do{n++;const $e=n===W.length,Et=$e&&ae.length!==0;if($e){if(ge=je.length===0?void 0:Re[Re.length-1],ne=Ie,Ie=je.pop(),Et)if(j){ne=ne.slice();let Mt=0;for(const[Ft,ni]of ae){const qt=Ft-Mt;ni===null?(ne.splice(qt,1),Mt++):ne[qt]=ni}}else{ne=Object.defineProperties({},Object.getOwnPropertyDescriptors(ne));for(const[Mt,Ft]of ae)ne[Mt]=Ft}n=L.index,W=L.keys,ae=L.edits,j=L.inArray,L=L.prev}else if(Ie){if(ge=j?n:W[n],ne=Ie[ge],ne==null)continue;Re.push(ge)}let Tt;if(!Array.isArray(ne)){var Qe,tt;C1(ne)||fy(!1,`Invalid AST Node: ${Y0(ne)}.`);const Mt=$e?(Qe=M.get(ne.kind))===null||Qe===void 0?void 0:Qe.leave:(tt=M.get(ne.kind))===null||tt===void 0?void 0:tt.enter;if(Tt=Mt==null?void 0:Mt.call(m,ne,ge,Ie,Re,je),Tt===Ry)break;if(Tt===!1){if(!$e){Re.pop();continue}}else if(Tt!==void 0&&(ae.push([ge,Tt]),!$e))if(C1(Tt))ne=Tt;else{Re.pop();continue}}if(Tt===void 0&&Et&&ae.push([ge,ne]),$e)Re.pop();else{var pt;L={inArray:j,index:n,keys:W,edits:ae,prev:L},j=Array.isArray(ne),W=j?ne:(pt=w[ne.kind])!==null&&pt!==void 0?pt:[],n=-1,ae=[],Ie&&je.push(Ie),Ie=ne}}while(L!==void 0);return ae.length!==0?ae[ae.length-1][1]:x}function NE(x,m){const w=x[m];return typeof w=="object"?w:typeof w=="function"?{enter:w,leave:void 0}:{enter:x.enter,leave:x.leave}}function VE(x){return Rc(x,jE)}const UE=80,jE={Name:{leave:x=>x.value},Variable:{leave:x=>"$"+x.name},Document:{leave:x=>Oi(x.definitions,`

`)},OperationDefinition:{leave(x){const m=kr("(",Oi(x.variableDefinitions,", "),")"),w=Oi([x.operation,Oi([x.name,m]),Oi(x.directives," ")]," ");return(w==="query"?"":w+" ")+x.selectionSet}},VariableDefinition:{leave:({variable:x,type:m,defaultValue:w,directives:M})=>x+": "+m+kr(" = ",w)+kr(" ",Oi(M," "))},SelectionSet:{leave:({selections:x})=>Cc(x)},Field:{leave({alias:x,name:m,arguments:w,directives:M,selectionSet:L}){const j=kr("",x,": ")+m;let W=j+kr("(",Oi(w,", "),")");return W.length>UE&&(W=j+kr(`(
`,dy(Oi(w,`
`)),`
)`)),Oi([W,Oi(M," "),L]," ")}},Argument:{leave:({name:x,value:m})=>x+": "+m},FragmentSpread:{leave:({name:x,directives:m})=>"..."+x+kr(" ",Oi(m," "))},InlineFragment:{leave:({typeCondition:x,directives:m,selectionSet:w})=>Oi(["...",kr("on ",x),Oi(m," "),w]," ")},FragmentDefinition:{leave:({name:x,typeCondition:m,variableDefinitions:w,directives:M,selectionSet:L})=>`fragment ${x}${kr("(",Oi(w,", "),")")} on ${m} ${kr("",Oi(M," ")," ")}`+L},IntValue:{leave:({value:x})=>x},FloatValue:{leave:({value:x})=>x},StringValue:{leave:({value:x,block:m})=>m?fE(x):PE(x)},BooleanValue:{leave:({value:x})=>x?"true":"false"},NullValue:{leave:()=>"null"},EnumValue:{leave:({value:x})=>x},ListValue:{leave:({values:x})=>"["+Oi(x,", ")+"]"},ObjectValue:{leave:({fields:x})=>"{"+Oi(x,", ")+"}"},ObjectField:{leave:({name:x,value:m})=>x+": "+m},Directive:{leave:({name:x,arguments:m})=>"@"+x+kr("(",Oi(m,", "),")")},NamedType:{leave:({name:x})=>x},ListType:{leave:({type:x})=>"["+x+"]"},NonNullType:{leave:({type:x})=>x+"!"},SchemaDefinition:{leave:({description:x,directives:m,operationTypes:w})=>kr("",x,`
`)+Oi(["schema",Oi(m," "),Cc(w)]," ")},OperationTypeDefinition:{leave:({operation:x,type:m})=>x+": "+m},ScalarTypeDefinition:{leave:({description:x,name:m,directives:w})=>kr("",x,`
`)+Oi(["scalar",m,Oi(w," ")]," ")},ObjectTypeDefinition:{leave:({description:x,name:m,interfaces:w,directives:M,fields:L})=>kr("",x,`
`)+Oi(["type",m,kr("implements ",Oi(w," & ")),Oi(M," "),Cc(L)]," ")},FieldDefinition:{leave:({description:x,name:m,arguments:w,type:M,directives:L})=>kr("",x,`
`)+m+(I1(w)?kr(`(
`,dy(Oi(w,`
`)),`
)`):kr("(",Oi(w,", "),")"))+": "+M+kr(" ",Oi(L," "))},InputValueDefinition:{leave:({description:x,name:m,type:w,defaultValue:M,directives:L})=>kr("",x,`
`)+Oi([m+": "+w,kr("= ",M),Oi(L," ")]," ")},InterfaceTypeDefinition:{leave:({description:x,name:m,interfaces:w,directives:M,fields:L})=>kr("",x,`
`)+Oi(["interface",m,kr("implements ",Oi(w," & ")),Oi(M," "),Cc(L)]," ")},UnionTypeDefinition:{leave:({description:x,name:m,directives:w,types:M})=>kr("",x,`
`)+Oi(["union",m,Oi(w," "),kr("= ",Oi(M," | "))]," ")},EnumTypeDefinition:{leave:({description:x,name:m,directives:w,values:M})=>kr("",x,`
`)+Oi(["enum",m,Oi(w," "),Cc(M)]," ")},EnumValueDefinition:{leave:({description:x,name:m,directives:w})=>kr("",x,`
`)+Oi([m,Oi(w," ")]," ")},InputObjectTypeDefinition:{leave:({description:x,name:m,directives:w,fields:M})=>kr("",x,`
`)+Oi(["input",m,Oi(w," "),Cc(M)]," ")},DirectiveDefinition:{leave:({description:x,name:m,arguments:w,repeatable:M,locations:L})=>kr("",x,`
`)+"directive @"+m+(I1(w)?kr(`(
`,dy(Oi(w,`
`)),`
)`):kr("(",Oi(w,", "),")"))+(M?" repeatable":"")+" on "+Oi(L," | ")},SchemaExtension:{leave:({directives:x,operationTypes:m})=>Oi(["extend schema",Oi(x," "),Cc(m)]," ")},ScalarTypeExtension:{leave:({name:x,directives:m})=>Oi(["extend scalar",x,Oi(m," ")]," ")},ObjectTypeExtension:{leave:({name:x,interfaces:m,directives:w,fields:M})=>Oi(["extend type",x,kr("implements ",Oi(m," & ")),Oi(w," "),Cc(M)]," ")},InterfaceTypeExtension:{leave:({name:x,interfaces:m,directives:w,fields:M})=>Oi(["extend interface",x,kr("implements ",Oi(m," & ")),Oi(w," "),Cc(M)]," ")},UnionTypeExtension:{leave:({name:x,directives:m,types:w})=>Oi(["extend union",x,Oi(m," "),kr("= ",Oi(w," | "))]," ")},EnumTypeExtension:{leave:({name:x,directives:m,values:w})=>Oi(["extend enum",x,Oi(m," "),Cc(w)]," ")},InputObjectTypeExtension:{leave:({name:x,directives:m,fields:w})=>Oi(["extend input",x,Oi(m," "),Cc(w)]," ")}};function Oi(x,m=""){var w;return(w=x==null?void 0:x.filter(M=>M).join(m))!==null&&w!==void 0?w:""}function Cc(x){return kr(`{
`,dy(Oi(x,`
`)),`
}`)}function kr(x,m,w=""){return m!=null&&m!==""?x+m+w:""}function dy(x){return kr("  ",x.replace(/\n/g,`
  `))}function I1(x){var m;return(m=x==null?void 0:x.some(w=>w.includes(`
`)))!==null&&m!==void 0?m:!1}function R1(x){return x.kind===Si.FIELD||x.kind===Si.FRAGMENT_SPREAD||x.kind===Si.INLINE_FRAGMENT}function ig(x,m){var w=x.directives;return!w||!w.length?!0:HE(w).every(function(M){var L=M.directive,j=M.ifArgument,W=!1;return j.value.kind==="Variable"?(W=m&&m[j.value.name.value],Ei(W!==void 0,78,L.name.value)):W=j.value.value,L.name.value==="skip"?!W:W})}function K_(x,m,w){var M=new Set(x),L=M.size;return Rc(m,{Directive:function(j){if(M.delete(j.name.value)&&(!w||!M.size))return Ry}}),w?!M.size:M.size<L}function qE(x){return x&&K_(["client","export"],x,!0)}function GE(x){var m=x.name.value;return m==="skip"||m==="include"}function HE(x){var m=[];return x&&x.length&&x.forEach(function(w){if(GE(w)){var M=w.arguments,L=w.name.value;Ei(M&&M.length===1,79,L);var j=M[0];Ei(j.name&&j.name.value==="if",80,L);var W=j.value;Ei(W&&(W.kind==="Variable"||W.kind==="BooleanValue"),81,L),m.push({directive:w,ifArgument:j})}}),m}function ZE(x){var m,w,M=(m=x.directives)===null||m===void 0?void 0:m.find(function(j){var W=j.name;return W.value==="unmask"});if(!M)return"mask";var L=(w=M.arguments)===null||w===void 0?void 0:w.find(function(j){var W=j.name;return W.value==="mode"});return globalThis.__DEV__!==!1&&L&&(L.value.kind===Si.VARIABLE?globalThis.__DEV__!==!1&&Ei.warn(82):L.value.kind!==Si.STRING?globalThis.__DEV__!==!1&&Ei.warn(83):L.value.value!=="migrate"&&globalThis.__DEV__!==!1&&Ei.warn(84,L.value.value)),L&&"value"in L.value&&L.value.value==="migrate"?"migrate":"unmask"}const XE=()=>Object.create(null),{forEach:YE,slice:z1}=Array.prototype,{hasOwnProperty:WE}=Object.prototype;class Bh{constructor(m=!0,w=XE){this.weakness=m,this.makeData=w}lookup(){return this.lookupArray(arguments)}lookupArray(m){let w=this;return YE.call(m,M=>w=w.getChildTrie(M)),WE.call(w,"data")?w.data:w.data=this.makeData(z1.call(m))}peek(){return this.peekArray(arguments)}peekArray(m){let w=this;for(let M=0,L=m.length;w&&M<L;++M){const j=w.mapFor(m[M],!1);w=j&&j.get(m[M])}return w&&w.data}remove(){return this.removeArray(arguments)}removeArray(m){let w;if(m.length){const M=m[0],L=this.mapFor(M,!1),j=L&&L.get(M);j&&(w=j.removeArray(z1.call(m,1)),!j.data&&!j.weak&&!(j.strong&&j.strong.size)&&L.delete(M))}else w=this.data,delete this.data;return w}getChildTrie(m){const w=this.mapFor(m,!0);let M=w.get(m);return M||w.set(m,M=new Bh(this.weakness,this.makeData)),M}mapFor(m,w){return this.weakness&&$E(m)?this.weak||(w?this.weak=new WeakMap:void 0):this.strong||(w?this.strong=new Map:void 0)}}function $E(x){switch(typeof x){case"object":if(x===null)break;case"function":return!0}return!1}var Gw=Dc(function(){return navigator.product})=="ReactNative",cp=typeof WeakMap=="function"&&!(Gw&&!global.HermesInternal),W0=typeof WeakSet=="function",$0=typeof Symbol=="function"&&typeof Symbol.for=="function",zy=$0&&Symbol.asyncIterator,QE=typeof Dc(function(){return window.document.createElement})=="function",KE=Dc(function(){return navigator.userAgent.indexOf("jsdom")>=0})||!1,JE=(QE||Gw)&&!KE;function ca(x){return x!==null&&typeof x=="object"}function eM(x,m){var w=m,M=[];x.definitions.forEach(function(j){if(j.kind==="OperationDefinition")throw eo(85,j.operation,j.name?" named '".concat(j.name.value,"'"):"");j.kind==="FragmentDefinition"&&M.push(j)}),typeof w>"u"&&(Ei(M.length===1,86,M.length),w=M[0].name.value);var L=ut(ut({},x),{definitions:Os([{kind:"OperationDefinition",operation:"query",selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:w}}]}}],x.definitions,!0)});return L}function Rm(x){x===void 0&&(x=[]);var m={};return x.forEach(function(w){m[w.name.value]=w}),m}function Oy(x,m){switch(x.kind){case"InlineFragment":return x;case"FragmentSpread":{var w=x.name.value;if(typeof m=="function")return m(w);var M=m&&m[w];return Ei(M,87,w),M||null}default:return null}}function tM(x){var m=!0;return Rc(x,{FragmentSpread:function(w){if(m=!!w.directives&&w.directives.some(function(M){return M.name.value==="unmask"}),!m)return Ry}}),m}function iM(){}class T0{constructor(m=1/0,w=iM){this.max=m,this.dispose=w,this.map=new Map,this.newest=null,this.oldest=null}has(m){return this.map.has(m)}get(m){const w=this.getNode(m);return w&&w.value}get size(){return this.map.size}getNode(m){const w=this.map.get(m);if(w&&w!==this.newest){const{older:M,newer:L}=w;L&&(L.older=M),M&&(M.newer=L),w.older=this.newest,w.older.newer=w,w.newer=null,this.newest=w,w===this.oldest&&(this.oldest=L)}return w}set(m,w){let M=this.getNode(m);return M?M.value=w:(M={key:m,value:w,newer:null,older:this.newest},this.newest&&(this.newest.newer=M),this.newest=M,this.oldest=this.oldest||M,this.map.set(m,M),M.value)}clean(){for(;this.oldest&&this.map.size>this.max;)this.delete(this.oldest.key)}delete(m){const w=this.map.get(m);return w?(w===this.newest&&(this.newest=w.older),w===this.oldest&&(this.oldest=w.newer),w.newer&&(w.newer.older=w.older),w.older&&(w.older.newer=w.newer),this.map.delete(m),this.dispose(w.value,m),!0):!1}}function S0(){}const rM=S0,nM=typeof WeakRef<"u"?WeakRef:function(x){return{deref:()=>x}},aM=typeof WeakMap<"u"?WeakMap:Map,sM=typeof FinalizationRegistry<"u"?FinalizationRegistry:function(){return{register:S0,unregister:S0}},oM=10024;class Ty{constructor(m=1/0,w=rM){this.max=m,this.dispose=w,this.map=new aM,this.newest=null,this.oldest=null,this.unfinalizedNodes=new Set,this.finalizationScheduled=!1,this.size=0,this.finalize=()=>{const M=this.unfinalizedNodes.values();for(let L=0;L<oM;L++){const j=M.next().value;if(!j)break;this.unfinalizedNodes.delete(j);const W=j.key;delete j.key,j.keyRef=new nM(W),this.registry.register(W,j,j)}this.unfinalizedNodes.size>0?queueMicrotask(this.finalize):this.finalizationScheduled=!1},this.registry=new sM(this.deleteNode.bind(this))}has(m){return this.map.has(m)}get(m){const w=this.getNode(m);return w&&w.value}getNode(m){const w=this.map.get(m);if(w&&w!==this.newest){const{older:M,newer:L}=w;L&&(L.older=M),M&&(M.newer=L),w.older=this.newest,w.older.newer=w,w.newer=null,this.newest=w,w===this.oldest&&(this.oldest=L)}return w}set(m,w){let M=this.getNode(m);return M?M.value=w:(M={key:m,value:w,newer:null,older:this.newest},this.newest&&(this.newest.newer=M),this.newest=M,this.oldest=this.oldest||M,this.scheduleFinalization(M),this.map.set(m,M),this.size++,M.value)}clean(){for(;this.oldest&&this.size>this.max;)this.deleteNode(this.oldest)}deleteNode(m){m===this.newest&&(this.newest=m.older),m===this.oldest&&(this.oldest=m.newer),m.newer&&(m.newer.older=m.older),m.older&&(m.older.newer=m.newer),this.size--;const w=m.key||m.keyRef&&m.keyRef.deref();this.dispose(m.value,w),m.keyRef?this.registry.unregister(m):this.unfinalizedNodes.delete(m),w&&this.map.delete(w)}delete(m){const w=this.map.get(m);return w?(this.deleteNode(w),!0):!1}scheduleFinalization(m){this.unfinalizedNodes.add(m),this.finalizationScheduled||(this.finalizationScheduled=!0,queueMicrotask(this.finalize))}}var r0=new WeakSet;function Hw(x){x.size<=(x.max||-1)||r0.has(x)||(r0.add(x),setTimeout(function(){x.clean(),r0.delete(x)},100))}var Q0=function(x,m){var w=new Ty(x,m);return w.set=function(M,L){var j=Ty.prototype.set.call(this,M,L);return Hw(this),j},w},lM=function(x,m){var w=new T0(x,m);return w.set=function(M,L){var j=T0.prototype.set.call(this,M,L);return Hw(this),j},w},cM=Symbol.for("apollo.cacheSize"),Iu=ut({},y0[cM]),tp={};function K0(x,m){tp[x]=m}var uM=globalThis.__DEV__!==!1?pM:void 0,hM=globalThis.__DEV__!==!1?mM:void 0,fM=globalThis.__DEV__!==!1?Zw:void 0;function dM(){var x={parser:1e3,canonicalStringify:1e3,print:2e3,"documentTransform.cache":2e3,"queryManager.getDocumentInfo":2e3,"PersistedQueryLink.persistedQueryHashes":2e3,"fragmentRegistry.transform":2e3,"fragmentRegistry.lookup":1e3,"fragmentRegistry.findFragmentSpreads":4e3,"cache.fragmentQueryDocuments":1e3,"removeTypenameFromVariables.getVariableDefinitions":2e3,"inMemoryCache.maybeBroadcastWatch":5e3,"inMemoryCache.executeSelectionSet":5e4,"inMemoryCache.executeSubSelectedArray":1e4};return Object.fromEntries(Object.entries(x).map(function(m){var w=m[0],M=m[1];return[w,Iu[w]||M]}))}function pM(){var x,m,w,M,L;if(globalThis.__DEV__===!1)throw new Error("only supported in development mode");return{limits:dM(),sizes:ut({print:(x=tp.print)===null||x===void 0?void 0:x.call(tp),parser:(m=tp.parser)===null||m===void 0?void 0:m.call(tp),canonicalStringify:(w=tp.canonicalStringify)===null||w===void 0?void 0:w.call(tp),links:M0(this.link),queryManager:{getDocumentInfo:this.queryManager.transformCache.size,documentTransforms:Yw(this.queryManager.documentTransform)}},(L=(M=this.cache).getMemoryInternals)===null||L===void 0?void 0:L.call(M))}}function Zw(){return{cache:{fragmentQueryDocuments:Gf(this.getFragmentDoc)}}}function mM(){var x=this.config.fragments;return ut(ut({},Zw.apply(this)),{addTypenameDocumentTransform:Yw(this.addTypenameTransform),inMemoryCache:{executeSelectionSet:Gf(this.storeReader.executeSelectionSet),executeSubSelectedArray:Gf(this.storeReader.executeSubSelectedArray),maybeBroadcastWatch:Gf(this.maybeBroadcastWatch)},fragmentRegistry:{findFragmentSpreads:Gf(x==null?void 0:x.findFragmentSpreads),lookup:Gf(x==null?void 0:x.lookup),transform:Gf(x==null?void 0:x.transform)}})}function _M(x){return!!x&&"dirtyKey"in x}function Gf(x){return _M(x)?x.size:void 0}function Xw(x){return x!=null}function Yw(x){return E0(x).map(function(m){return{cache:m}})}function E0(x){return x?Os(Os([Gf(x==null?void 0:x.performWork)],E0(x==null?void 0:x.left),!0),E0(x==null?void 0:x.right),!0).filter(Xw):[]}function M0(x){var m;return x?Os(Os([(m=x==null?void 0:x.getMemoryInternals)===null||m===void 0?void 0:m.call(x)],M0(x==null?void 0:x.left),!0),M0(x==null?void 0:x.right),!0).filter(Xw):[]}var Hf=Object.assign(function(m){return JSON.stringify(m,gM)},{reset:function(){ym=new lM(Iu.canonicalStringify||1e3)}});globalThis.__DEV__!==!1&&K0("canonicalStringify",function(){return ym.size});var ym;Hf.reset();function gM(x,m){if(m&&typeof m=="object"){var w=Object.getPrototypeOf(m);if(w===Object.prototype||w===null){var M=Object.keys(m);if(M.every(yM))return m;var L=JSON.stringify(M),j=ym.get(L);if(!j){M.sort();var W=JSON.stringify(M);j=ym.get(W)||M,ym.set(L,j),ym.set(W,j)}var n=Object.create(w);return j.forEach(function(ae){n[ae]=m[ae]}),n}}return m}function yM(x,m,w){return m===0||w[m-1]<=x}function bm(x){return{__ref:String(x)}}function rn(x){return!!(x&&typeof x=="object"&&typeof x.__ref=="string")}function vM(x){return ca(x)&&x.kind==="Document"&&Array.isArray(x.definitions)}function xM(x){return x.kind==="StringValue"}function bM(x){return x.kind==="BooleanValue"}function wM(x){return x.kind==="IntValue"}function TM(x){return x.kind==="FloatValue"}function SM(x){return x.kind==="Variable"}function EM(x){return x.kind==="ObjectValue"}function MM(x){return x.kind==="ListValue"}function AM(x){return x.kind==="EnumValue"}function CM(x){return x.kind==="NullValue"}function Em(x,m,w,M){if(wM(w)||TM(w))x[m.value]=Number(w.value);else if(bM(w)||xM(w))x[m.value]=w.value;else if(EM(w)){var L={};w.fields.map(function(W){return Em(L,W.name,W.value,M)}),x[m.value]=L}else if(SM(w)){var j=(M||{})[w.name.value];x[m.value]=j}else if(MM(w))x[m.value]=w.values.map(function(W){var n={};return Em(n,m,W,M),n[m.value]});else if(AM(w))x[m.value]=w.value;else if(CM(w))x[m.value]=null;else throw eo(96,m.value,w.kind)}function DM(x,m){var w=null;x.directives&&(w={},x.directives.forEach(function(L){w[L.name.value]={},L.arguments&&L.arguments.forEach(function(j){var W=j.name,n=j.value;return Em(w[L.name.value],W,n,m)})}));var M=null;return x.arguments&&x.arguments.length&&(M={},x.arguments.forEach(function(L){var j=L.name,W=L.value;return Em(M,j,W,m)})),Ww(x.name.value,M,w)}var IM=["connection","include","skip","client","rest","export","nonreactive"],N_=Hf,Ww=Object.assign(function(x,m,w){if(m&&w&&w.connection&&w.connection.key)if(w.connection.filter&&w.connection.filter.length>0){var M=w.connection.filter?w.connection.filter:[];M.sort();var L={};return M.forEach(function(n){L[n]=m[n]}),"".concat(w.connection.key,"(").concat(N_(L),")")}else return w.connection.key;var j=x;if(m){var W=N_(m);j+="(".concat(W,")")}return w&&Object.keys(w).forEach(function(n){IM.indexOf(n)===-1&&(w[n]&&Object.keys(w[n]).length?j+="@".concat(n,"(").concat(N_(w[n]),")"):j+="@".concat(n))}),j},{setStringify:function(x){var m=N_;return N_=x,m}});function Ly(x,m){if(x.arguments&&x.arguments.length){var w={};return x.arguments.forEach(function(M){var L=M.name,j=M.value;return Em(w,L,j,m)}),w}return null}function Fh(x){return x.alias?x.alias.value:x.name.value}function A0(x,m,w){for(var M,L=0,j=m.selections;L<j.length;L++){var W=j[L];if(Zf(W)){if(W.name.value==="__typename")return x[Fh(W)]}else M?M.push(W):M=[W]}if(typeof x.__typename=="string")return x.__typename;if(M)for(var n=0,ae=M;n<ae.length;n++){var W=ae[n],ne=A0(x,Oy(W,w).selectionSet,w);if(typeof ne=="string")return ne}}function Zf(x){return x.kind==="Field"}function RM(x){return x.kind==="InlineFragment"}function zm(x){Ei(x&&x.kind==="Document",88);var m=x.definitions.filter(function(w){return w.kind!=="FragmentDefinition"}).map(function(w){if(w.kind!=="OperationDefinition")throw eo(89,w.kind);return w});return Ei(m.length<=1,90,m.length),x}function op(x){return zm(x),x.definitions.filter(function(m){return m.kind==="OperationDefinition"})[0]}function H_(x){return x.definitions.filter(function(m){return m.kind==="OperationDefinition"&&!!m.name}).map(function(m){return m.name.value})[0]||null}function Om(x){return x.definitions.filter(function(m){return m.kind==="FragmentDefinition"})}function $w(x){var m=op(x);return Ei(m&&m.operation==="query",91),m}function Qw(x){Ei(x.kind==="Document",92),Ei(x.definitions.length<=1,93);var m=x.definitions[0];return Ei(m.kind==="FragmentDefinition",94),m}function rg(x){zm(x);for(var m,w=0,M=x.definitions;w<M.length;w++){var L=M[w];if(L.kind==="OperationDefinition"){var j=L.operation;if(j==="query"||j==="mutation"||j==="subscription")return L}L.kind==="FragmentDefinition"&&!m&&(m=L)}if(m)return m;throw eo(95)}function J0(x){var m=Object.create(null),w=x&&x.variableDefinitions;return w&&w.length&&w.forEach(function(M){M.defaultValue&&Em(m,M.variable.name,M.defaultValue)}),m}let cs=null;const O1={};let zM=1;const OM=()=>class{constructor(){this.id=["slot",zM++,Date.now(),Math.random().toString(36).slice(2)].join(":")}hasValue(){for(let m=cs;m;m=m.parent)if(this.id in m.slots){const w=m.slots[this.id];if(w===O1)break;return m!==cs&&(cs.slots[this.id]=w),!0}return cs&&(cs.slots[this.id]=O1),!1}getValue(){if(this.hasValue())return cs.slots[this.id]}withValue(m,w,M,L){const j={__proto__:null,[this.id]:m},W=cs;cs={parent:W,slots:j};try{return w.apply(L,M)}finally{cs=W}}static bind(m){const w=cs;return function(){const M=cs;try{return cs=w,m.apply(this,arguments)}finally{cs=M}}}static noContext(m,w,M){if(cs){const L=cs;try{return cs=null,m.apply(M,w)}finally{cs=L}}else return m.apply(M,w)}};function L1(x){try{return x()}catch{}}const n0="@wry/context:Slot",LM=L1(()=>globalThis)||L1(()=>global)||Object.create(null),P1=LM,Py=P1[n0]||Array[n0]||function(x){try{Object.defineProperty(P1,n0,{value:x,enumerable:!1,writable:!1,configurable:!0})}finally{return x}}(OM()),{bind:fD,noContext:dD}=Py,ky=new Py,{hasOwnProperty:PM}=Object.prototype,ex=Array.from||function(x){const m=[];return x.forEach(w=>m.push(w)),m};function tx(x){const{unsubscribe:m}=x;typeof m=="function"&&(x.unsubscribe=void 0,m())}const J_=[],kM=100;function Mm(x,m){if(!x)throw new Error(m||"assertion failure")}function Kw(x,m){const w=x.length;return w>0&&w===m.length&&x[w-1]===m[w-1]}function Jw(x){switch(x.length){case 0:throw new Error("unknown value");case 1:return x[0];case 2:throw x[1]}}function e2(x){return x.slice(0)}class Fy{constructor(m){this.fn=m,this.parents=new Set,this.childValues=new Map,this.dirtyChildren=null,this.dirty=!0,this.recomputing=!1,this.value=[],this.deps=null,++Fy.count}peek(){if(this.value.length===1&&!Xf(this))return k1(this),this.value[0]}recompute(m){return Mm(!this.recomputing,"already recomputing"),k1(this),Xf(this)?FM(this,m):Jw(this.value)}setDirty(){this.dirty||(this.dirty=!0,t2(this),tx(this))}dispose(){this.setDirty(),s2(this),ix(this,(m,w)=>{m.setDirty(),o2(m,this)})}forget(){this.dispose()}dependOn(m){m.add(this),this.deps||(this.deps=J_.pop()||new Set),this.deps.add(m)}forgetDeps(){this.deps&&(ex(this.deps).forEach(m=>m.delete(this)),this.deps.clear(),J_.push(this.deps),this.deps=null)}}Fy.count=0;function k1(x){const m=ky.getValue();if(m)return x.parents.add(m),m.childValues.has(x)||m.childValues.set(x,[]),Xf(x)?r2(m,x):n2(m,x),m}function FM(x,m){return s2(x),ky.withValue(x,BM,[x,m]),VM(x,m)&&NM(x),Jw(x.value)}function BM(x,m){x.recomputing=!0;const{normalizeResult:w}=x;let M;w&&x.value.length===1&&(M=e2(x.value)),x.value.length=0;try{if(x.value[0]=x.fn.apply(null,m),w&&M&&!Kw(M,x.value))try{x.value[0]=w(x.value[0],M[0])}catch{}}catch(L){x.value[1]=L}x.recomputing=!1}function Xf(x){return x.dirty||!!(x.dirtyChildren&&x.dirtyChildren.size)}function NM(x){x.dirty=!1,!Xf(x)&&i2(x)}function t2(x){ix(x,r2)}function i2(x){ix(x,n2)}function ix(x,m){const w=x.parents.size;if(w){const M=ex(x.parents);for(let L=0;L<w;++L)m(M[L],x)}}function r2(x,m){Mm(x.childValues.has(m)),Mm(Xf(m));const w=!Xf(x);if(!x.dirtyChildren)x.dirtyChildren=J_.pop()||new Set;else if(x.dirtyChildren.has(m))return;x.dirtyChildren.add(m),w&&t2(x)}function n2(x,m){Mm(x.childValues.has(m)),Mm(!Xf(m));const w=x.childValues.get(m);w.length===0?x.childValues.set(m,e2(m.value)):Kw(w,m.value)||x.setDirty(),a2(x,m),!Xf(x)&&i2(x)}function a2(x,m){const w=x.dirtyChildren;w&&(w.delete(m),w.size===0&&(J_.length<kM&&J_.push(w),x.dirtyChildren=null))}function s2(x){x.childValues.size>0&&x.childValues.forEach((m,w)=>{o2(x,w)}),x.forgetDeps(),Mm(x.dirtyChildren===null)}function o2(x,m){m.parents.delete(x),x.childValues.delete(m),a2(x,m)}function VM(x,m){if(typeof x.subscribe=="function")try{tx(x),x.unsubscribe=x.subscribe.apply(null,m)}catch{return x.setDirty(),!1}return!0}const UM={setDirty:!0,dispose:!0,forget:!0};function l2(x){const m=new Map;function w(M){const L=ky.getValue();if(L){let j=m.get(M);j||m.set(M,j=new Set),L.dependOn(j)}}return w.dirty=function(L,j){const W=m.get(L);if(W){const n=j&&PM.call(UM,j)?j:"setDirty";ex(W).forEach(ae=>ae[n]()),m.delete(L),tx(W)}},w}let F1;function jM(...x){return(F1||(F1=new Bh(typeof WeakMap=="function"))).lookupArray(x)}const a0=new Set;function eg(x,{max:m=Math.pow(2,16),keyArgs:w,makeCacheKey:M=jM,normalizeResult:L,subscribe:j,cache:W=T0}=Object.create(null)){const n=typeof W=="function"?new W(m,Re=>Re.dispose()):W,ae=function(){const Re=M.apply(null,w?w.apply(null,arguments):arguments);if(Re===void 0)return x.apply(null,arguments);let je=n.get(Re);je||(n.set(Re,je=new Fy(x)),je.normalizeResult=L,je.subscribe=j,je.forget=()=>n.delete(Re));const Qe=je.recompute(Array.prototype.slice.call(arguments));return n.set(Re,je),a0.add(n),ky.hasValue()||(a0.forEach(tt=>tt.clean()),a0.clear()),Qe};Object.defineProperty(ae,"size",{get:()=>n.size,configurable:!1,enumerable:!1}),Object.freeze(ae.options={max:m,keyArgs:w,makeCacheKey:M,normalizeResult:L,subscribe:j,cache:n});function ne(Re){const je=Re&&n.get(Re);je&&je.setDirty()}ae.dirtyKey=ne,ae.dirty=function(){ne(M.apply(null,arguments))};function ge(Re){const je=Re&&n.get(Re);if(je)return je.peek()}ae.peekKey=ge,ae.peek=function(){return ge(M.apply(null,arguments))};function Ie(Re){return Re?n.delete(Re):!1}return ae.forgetKey=Ie,ae.forget=function(){return Ie(M.apply(null,arguments))},ae.makeCacheKey=M,ae.getKey=w?function(){return M.apply(null,w.apply(null,arguments))}:M,Object.freeze(ae)}function qM(x){return x}var c2=function(){function x(m,w){w===void 0&&(w=Object.create(null)),this.resultCache=W0?new WeakSet:new Set,this.transform=m,w.getCacheKey&&(this.getCacheKey=w.getCacheKey),this.cached=w.cache!==!1,this.resetCache()}return x.prototype.getCacheKey=function(m){return[m]},x.identity=function(){return new x(qM,{cache:!1})},x.split=function(m,w,M){return M===void 0&&(M=x.identity()),Object.assign(new x(function(L){var j=m(L)?w:M;return j.transformDocument(L)},{cache:!1}),{left:w,right:M})},x.prototype.resetCache=function(){var m=this;if(this.cached){var w=new Bh(cp);this.performWork=eg(x.prototype.performWork.bind(this),{makeCacheKey:function(M){var L=m.getCacheKey(M);if(L)return Ei(Array.isArray(L),77),w.lookupArray(L)},max:Iu["documentTransform.cache"],cache:Ty})}},x.prototype.performWork=function(m){return zm(m),this.transform(m)},x.prototype.transformDocument=function(m){if(this.resultCache.has(m))return m;var w=this.performWork(m);return this.resultCache.add(w),w},x.prototype.concat=function(m){var w=this;return Object.assign(new x(function(M){return m.transformDocument(w.transformDocument(M))},{cache:!1}),{left:this,right:m})},x}(),X_,np=Object.assign(function(x){var m=X_.get(x);return m||(m=VE(x),X_.set(x,m)),m},{reset:function(){X_=new Q0(Iu.print||2e3)}});np.reset();globalThis.__DEV__!==!1&&K0("print",function(){return X_?X_.size:0});var ua=Array.isArray;function ql(x){return Array.isArray(x)&&x.length>0}var B1={kind:Si.FIELD,name:{kind:Si.NAME,value:"__typename"}};function u2(x,m){return!x||x.selectionSet.selections.every(function(w){return w.kind===Si.FRAGMENT_SPREAD&&u2(m[w.name.value],m)})}function GM(x){return u2(op(x)||Qw(x),Rm(Om(x)))?null:x}function HM(x){var m=new Map,w=new Map;return x.forEach(function(M){M&&(M.name?m.set(M.name,M):M.test&&w.set(M.test,M))}),function(M){var L=m.get(M.name.value);return!L&&w.size&&w.forEach(function(j,W){W(M)&&(L=j)}),L}}function N1(x){var m=new Map;return function(M){M===void 0&&(M=x);var L=m.get(M);return L||m.set(M,L={variables:new Set,fragmentSpreads:new Set}),L}}function h2(x,m){zm(m);for(var w=N1(""),M=N1(""),L=function($e){for(var Et=0,Tt=void 0;Et<$e.length&&(Tt=$e[Et]);++Et)if(!ua(Tt)){if(Tt.kind===Si.OPERATION_DEFINITION)return w(Tt.name&&Tt.name.value);if(Tt.kind===Si.FRAGMENT_DEFINITION)return M(Tt.name.value)}return globalThis.__DEV__!==!1&&Ei.error(97),null},j=0,W=m.definitions.length-1;W>=0;--W)m.definitions[W].kind===Si.OPERATION_DEFINITION&&++j;var n=HM(x),ae=function($e){return ql($e)&&$e.map(n).some(function(Et){return Et&&Et.remove})},ne=new Map,ge=!1,Ie={enter:function($e){if(ae($e.directives))return ge=!0,null}},Re=Rc(m,{Field:Ie,InlineFragment:Ie,VariableDefinition:{enter:function(){return!1}},Variable:{enter:function($e,Et,Tt,Mt,Ft){var ni=L(Ft);ni&&ni.variables.add($e.name.value)}},FragmentSpread:{enter:function($e,Et,Tt,Mt,Ft){if(ae($e.directives))return ge=!0,null;var ni=L(Ft);ni&&ni.fragmentSpreads.add($e.name.value)}},FragmentDefinition:{enter:function($e,Et,Tt,Mt){ne.set(JSON.stringify(Mt),$e)},leave:function($e,Et,Tt,Mt){var Ft=ne.get(JSON.stringify(Mt));if($e===Ft)return $e;if(j>0&&$e.selectionSet.selections.every(function(ni){return ni.kind===Si.FIELD&&ni.name.value==="__typename"}))return M($e.name.value).removed=!0,ge=!0,null}},Directive:{leave:function($e){if(n($e))return ge=!0,null}}});if(!ge)return m;var je=function($e){return $e.transitiveVars||($e.transitiveVars=new Set($e.variables),$e.removed||$e.fragmentSpreads.forEach(function(Et){je(M(Et)).transitiveVars.forEach(function(Tt){$e.transitiveVars.add(Tt)})})),$e},Qe=new Set;Re.definitions.forEach(function($e){$e.kind===Si.OPERATION_DEFINITION?je(w($e.name&&$e.name.value)).fragmentSpreads.forEach(function(Et){Qe.add(Et)}):$e.kind===Si.FRAGMENT_DEFINITION&&j===0&&!M($e.name.value).removed&&Qe.add($e.name.value)}),Qe.forEach(function($e){je(M($e)).fragmentSpreads.forEach(function(Et){Qe.add(Et)})});var tt=function($e){return!!(!Qe.has($e)||M($e).removed)},pt={enter:function($e){if(tt($e.name.value))return null}};return GM(Rc(Re,{FragmentSpread:pt,FragmentDefinition:pt,OperationDefinition:{leave:function($e){if($e.variableDefinitions){var Et=je(w($e.name&&$e.name.value)).transitiveVars;if(Et.size<$e.variableDefinitions.length)return ut(ut({},$e),{variableDefinitions:$e.variableDefinitions.filter(function(Tt){return Et.has(Tt.variable.name.value)})})}}}}))}var rx=Object.assign(function(x){return Rc(x,{SelectionSet:{enter:function(m,w,M){if(!(M&&M.kind===Si.OPERATION_DEFINITION)){var L=m.selections;if(L){var j=L.some(function(n){return Zf(n)&&(n.name.value==="__typename"||n.name.value.lastIndexOf("__",0)===0)});if(!j){var W=M;if(!(Zf(W)&&W.directives&&W.directives.some(function(n){return n.name.value==="export"})))return ut(ut({},m),{selections:Os(Os([],L,!0),[B1],!1)})}}}}}})},{added:function(x){return x===B1}});function ZM(x){var m=rg(x),w=m.operation;if(w==="query")return x;var M=Rc(x,{OperationDefinition:{enter:function(L){return ut(ut({},L),{operation:"query"})}}});return M}function f2(x){zm(x);var m=h2([{test:function(w){return w.name.value==="client"},remove:!0}],x);return m}function XM(x){return zm(x),Rc(x,{FragmentSpread:function(m){var w;if(!(!((w=m.directives)===null||w===void 0)&&w.some(function(M){return M.name.value==="unmask"})))return ut(ut({},m),{directives:Os(Os([],m.directives||[],!0),[{kind:Si.DIRECTIVE,name:{kind:Si.NAME,value:"nonreactive"}}],!1)})}})}var YM=Object.prototype.hasOwnProperty;function V1(){for(var x=[],m=0;m<arguments.length;m++)x[m]=arguments[m];return By(x)}function By(x){var m=x[0]||{},w=x.length;if(w>1)for(var M=new Yf,L=1;L<w;++L)m=M.merge(m,x[L]);return m}var WM=function(x,m,w){return this.merge(x[w],m[w])},Yf=function(){function x(m){m===void 0&&(m=WM),this.reconciler=m,this.isObject=ca,this.pastCopies=new Set}return x.prototype.merge=function(m,w){for(var M=this,L=[],j=2;j<arguments.length;j++)L[j-2]=arguments[j];return ca(w)&&ca(m)?(Object.keys(w).forEach(function(W){if(YM.call(m,W)){var n=m[W];if(w[W]!==n){var ae=M.reconciler.apply(M,Os([m,w,W],L,!1));ae!==n&&(m=M.shallowCopyForMerge(m),m[W]=ae)}}else m=M.shallowCopyForMerge(m),m[W]=w[W]}),m):w},x.prototype.shallowCopyForMerge=function(m){return ca(m)&&(this.pastCopies.has(m)||(Array.isArray(m)?m=m.slice(0):m=ut({__proto__:Object.getPrototypeOf(m)},m),this.pastCopies.add(m))),m},x}();function $M(x,m){var w=typeof Symbol<"u"&&x[Symbol.iterator]||x["@@iterator"];if(w)return(w=w.call(x)).next.bind(w);if(Array.isArray(x)||(w=QM(x))||m){w&&(x=w);var M=0;return function(){return M>=x.length?{done:!0}:{done:!1,value:x[M++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function QM(x,m){if(x){if(typeof x=="string")return U1(x,m);var w=Object.prototype.toString.call(x).slice(8,-1);if(w==="Object"&&x.constructor&&(w=x.constructor.name),w==="Map"||w==="Set")return Array.from(x);if(w==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(w))return U1(x,m)}}function U1(x,m){(m==null||m>x.length)&&(m=x.length);for(var w=0,M=new Array(m);w<m;w++)M[w]=x[w];return M}function j1(x,m){for(var w=0;w<m.length;w++){var M=m[w];M.enumerable=M.enumerable||!1,M.configurable=!0,"value"in M&&(M.writable=!0),Object.defineProperty(x,M.key,M)}}function nx(x,m,w){return m&&j1(x.prototype,m),w&&j1(x,w),Object.defineProperty(x,"prototype",{writable:!1}),x}var ax=function(){return typeof Symbol=="function"},sx=function(x){return ax()&&!!Symbol[x]},ox=function(x){return sx(x)?Symbol[x]:"@@"+x};ax()&&!sx("observable")&&(Symbol.observable=Symbol("observable"));var KM=ox("iterator"),C0=ox("observable"),d2=ox("species");function Sy(x,m){var w=x[m];if(w!=null){if(typeof w!="function")throw new TypeError(w+" is not a function");return w}}function V_(x){var m=x.constructor;return m!==void 0&&(m=m[d2],m===null&&(m=void 0)),m!==void 0?m:xn}function JM(x){return x instanceof xn}function Am(x){Am.log?Am.log(x):setTimeout(function(){throw x})}function py(x){Promise.resolve().then(function(){try{x()}catch(m){Am(m)}})}function p2(x){var m=x._cleanup;if(m!==void 0&&(x._cleanup=void 0,!!m))try{if(typeof m=="function")m();else{var w=Sy(m,"unsubscribe");w&&w.call(m)}}catch(M){Am(M)}}function D0(x){x._observer=void 0,x._queue=void 0,x._state="closed"}function eA(x){var m=x._queue;if(m){x._queue=void 0,x._state="ready";for(var w=0;w<m.length&&(m2(x,m[w].type,m[w].value),x._state!=="closed");++w);}}function m2(x,m,w){x._state="running";var M=x._observer;try{var L=Sy(M,m);switch(m){case"next":L&&L.call(M,w);break;case"error":if(D0(x),L)L.call(M,w);else throw w;break;case"complete":D0(x),L&&L.call(M);break}}catch(j){Am(j)}x._state==="closed"?p2(x):x._state==="running"&&(x._state="ready")}function s0(x,m,w){if(x._state!=="closed"){if(x._state==="buffering"){x._queue.push({type:m,value:w});return}if(x._state!=="ready"){x._state="buffering",x._queue=[{type:m,value:w}],py(function(){return eA(x)});return}m2(x,m,w)}}var tA=function(){function x(w,M){this._cleanup=void 0,this._observer=w,this._queue=void 0,this._state="initializing";var L=new iA(this);try{this._cleanup=M.call(void 0,L)}catch(j){L.error(j)}this._state==="initializing"&&(this._state="ready")}var m=x.prototype;return m.unsubscribe=function(){this._state!=="closed"&&(D0(this),p2(this))},nx(x,[{key:"closed",get:function(){return this._state==="closed"}}]),x}(),iA=function(){function x(w){this._subscription=w}var m=x.prototype;return m.next=function(M){s0(this._subscription,"next",M)},m.error=function(M){s0(this._subscription,"error",M)},m.complete=function(){s0(this._subscription,"complete")},nx(x,[{key:"closed",get:function(){return this._subscription._state==="closed"}}]),x}(),xn=function(){function x(w){if(!(this instanceof x))throw new TypeError("Observable cannot be called as a function");if(typeof w!="function")throw new TypeError("Observable initializer must be a function");this._subscriber=w}var m=x.prototype;return m.subscribe=function(M){return(typeof M!="object"||M===null)&&(M={next:M,error:arguments[1],complete:arguments[2]}),new tA(M,this._subscriber)},m.forEach=function(M){var L=this;return new Promise(function(j,W){if(typeof M!="function"){W(new TypeError(M+" is not a function"));return}function n(){ae.unsubscribe(),j()}var ae=L.subscribe({next:function(ne){try{M(ne,n)}catch(ge){W(ge),ae.unsubscribe()}},error:W,complete:j})})},m.map=function(M){var L=this;if(typeof M!="function")throw new TypeError(M+" is not a function");var j=V_(this);return new j(function(W){return L.subscribe({next:function(n){try{n=M(n)}catch(ae){return W.error(ae)}W.next(n)},error:function(n){W.error(n)},complete:function(){W.complete()}})})},m.filter=function(M){var L=this;if(typeof M!="function")throw new TypeError(M+" is not a function");var j=V_(this);return new j(function(W){return L.subscribe({next:function(n){try{if(!M(n))return}catch(ae){return W.error(ae)}W.next(n)},error:function(n){W.error(n)},complete:function(){W.complete()}})})},m.reduce=function(M){var L=this;if(typeof M!="function")throw new TypeError(M+" is not a function");var j=V_(this),W=arguments.length>1,n=!1,ae=arguments[1],ne=ae;return new j(function(ge){return L.subscribe({next:function(Ie){var Re=!n;if(n=!0,!Re||W)try{ne=M(ne,Ie)}catch(je){return ge.error(je)}else ne=Ie},error:function(Ie){ge.error(Ie)},complete:function(){if(!n&&!W)return ge.error(new TypeError("Cannot reduce an empty sequence"));ge.next(ne),ge.complete()}})})},m.concat=function(){for(var M=this,L=arguments.length,j=new Array(L),W=0;W<L;W++)j[W]=arguments[W];var n=V_(this);return new n(function(ae){var ne,ge=0;function Ie(Re){ne=Re.subscribe({next:function(je){ae.next(je)},error:function(je){ae.error(je)},complete:function(){ge===j.length?(ne=void 0,ae.complete()):Ie(n.from(j[ge++]))}})}return Ie(M),function(){ne&&(ne.unsubscribe(),ne=void 0)}})},m.flatMap=function(M){var L=this;if(typeof M!="function")throw new TypeError(M+" is not a function");var j=V_(this);return new j(function(W){var n=[],ae=L.subscribe({next:function(ge){if(M)try{ge=M(ge)}catch(Re){return W.error(Re)}var Ie=j.from(ge).subscribe({next:function(Re){W.next(Re)},error:function(Re){W.error(Re)},complete:function(){var Re=n.indexOf(Ie);Re>=0&&n.splice(Re,1),ne()}});n.push(Ie)},error:function(ge){W.error(ge)},complete:function(){ne()}});function ne(){ae.closed&&n.length===0&&W.complete()}return function(){n.forEach(function(ge){return ge.unsubscribe()}),ae.unsubscribe()}})},m[C0]=function(){return this},x.from=function(M){var L=typeof this=="function"?this:x;if(M==null)throw new TypeError(M+" is not an object");var j=Sy(M,C0);if(j){var W=j.call(M);if(Object(W)!==W)throw new TypeError(W+" is not an object");return JM(W)&&W.constructor===L?W:new L(function(n){return W.subscribe(n)})}if(sx("iterator")&&(j=Sy(M,KM),j))return new L(function(n){py(function(){if(!n.closed){for(var ae=$M(j.call(M)),ne;!(ne=ae()).done;){var ge=ne.value;if(n.next(ge),n.closed)return}n.complete()}})});if(Array.isArray(M))return new L(function(n){py(function(){if(!n.closed){for(var ae=0;ae<M.length;++ae)if(n.next(M[ae]),n.closed)return;n.complete()}})});throw new TypeError(M+" is not observable")},x.of=function(){for(var M=arguments.length,L=new Array(M),j=0;j<M;j++)L[j]=arguments[j];var W=typeof this=="function"?this:x;return new W(function(n){py(function(){if(!n.closed){for(var ae=0;ae<L.length;++ae)if(n.next(L[ae]),n.closed)return;n.complete()}})})},nx(x,null,[{key:d2,get:function(){return this}}]),x}();ax()&&Object.defineProperty(xn,Symbol("extensions"),{value:{symbol:C0,hostReportError:Am},configurable:!0});function rA(x){var m,w=x.Symbol;if(typeof w=="function")if(w.observable)m=w.observable;else{typeof w.for=="function"?m=w.for("https://github.com/benlesh/symbol-observable"):m=w("https://github.com/benlesh/symbol-observable");try{w.observable=m}catch{}}else m="@@observable";return m}var mm;typeof self<"u"?mm=self:typeof window<"u"?mm=window:typeof global<"u"?mm=global:typeof q0<"u"?mm=q0:mm=Function("return this")();rA(mm);var q1=xn.prototype,G1="@@observable";q1[G1]||(q1[G1]=function(){return this});function nA(x){return x.catch(function(){}),x}var aA=Object.prototype.toString;function _2(x){return I0(x)}function I0(x,m){switch(aA.call(x)){case"[object Array]":{if(m=m||new Map,m.has(x))return m.get(x);var w=x.slice(0);return m.set(x,w),w.forEach(function(L,j){w[j]=I0(L,m)}),w}case"[object Object]":{if(m=m||new Map,m.has(x))return m.get(x);var M=Object.create(Object.getPrototypeOf(x));return m.set(x,M),Object.keys(x).forEach(function(L){M[L]=I0(x[L],m)}),M}default:return x}}function sA(x){var m=new Set([x]);return m.forEach(function(w){ca(w)&&oA(w)===w&&Object.getOwnPropertyNames(w).forEach(function(M){ca(w[M])&&m.add(w[M])})}),x}function oA(x){if(globalThis.__DEV__!==!1&&!Object.isFrozen(x))try{Object.freeze(x)}catch(m){if(m instanceof TypeError)return null;throw m}return x}function Cm(x){return globalThis.__DEV__!==!1&&sA(x),x}function Y_(x,m,w){var M=[];x.forEach(function(L){return L[m]&&M.push(L)}),M.forEach(function(L){return L[m](w)})}function o0(x,m,w){return new xn(function(M){var L={then:function(ae){return new Promise(function(ne){return ne(ae())})}};function j(ae,ne){return function(ge){if(ae){var Ie=function(){return M.closed?0:ae(ge)};L=L.then(Ie,Ie).then(function(Re){return M.next(Re)},function(Re){return M.error(Re)})}else M[ne](ge)}}var W={next:j(m,"next"),error:j(w,"error"),complete:function(){L.then(function(){return M.complete()})}},n=x.subscribe(W);return function(){return n.unsubscribe()}})}function g2(x){function m(w){Object.defineProperty(x,w,{value:xn})}return $0&&Symbol.species&&m(Symbol.species),m("@@species"),x}function H1(x){return x&&typeof x.then=="function"}var _m=function(x){Ru(m,x);function m(w){var M=x.call(this,function(L){return M.addObserver(L),function(){return M.removeObserver(L)}})||this;return M.observers=new Set,M.promise=new Promise(function(L,j){M.resolve=L,M.reject=j}),M.handlers={next:function(L){M.sub!==null&&(M.latest=["next",L],M.notify("next",L),Y_(M.observers,"next",L))},error:function(L){var j=M.sub;j!==null&&(j&&setTimeout(function(){return j.unsubscribe()}),M.sub=null,M.latest=["error",L],M.reject(L),M.notify("error",L),Y_(M.observers,"error",L))},complete:function(){var L=M,j=L.sub,W=L.sources,n=W===void 0?[]:W;if(j!==null){var ae=n.shift();ae?H1(ae)?ae.then(function(ne){return M.sub=ne.subscribe(M.handlers)},M.handlers.error):M.sub=ae.subscribe(M.handlers):(j&&setTimeout(function(){return j.unsubscribe()}),M.sub=null,M.latest&&M.latest[0]==="next"?M.resolve(M.latest[1]):M.resolve(),M.notify("complete"),Y_(M.observers,"complete"))}}},M.nextResultListeners=new Set,M.cancel=function(L){M.reject(L),M.sources=[],M.handlers.error(L)},M.promise.catch(function(L){}),typeof w=="function"&&(w=[new xn(w)]),H1(w)?w.then(function(L){return M.start(L)},M.handlers.error):M.start(w),M}return m.prototype.start=function(w){this.sub===void 0&&(this.sources=Array.from(w),this.handlers.complete())},m.prototype.deliverLastMessage=function(w){if(this.latest){var M=this.latest[0],L=w[M];L&&L.call(w,this.latest[1]),this.sub===null&&M==="next"&&w.complete&&w.complete()}},m.prototype.addObserver=function(w){this.observers.has(w)||(this.deliverLastMessage(w),this.observers.add(w))},m.prototype.removeObserver=function(w){this.observers.delete(w)&&this.observers.size<1&&this.handlers.complete()},m.prototype.notify=function(w,M){var L=this.nextResultListeners;L.size&&(this.nextResultListeners=new Set,L.forEach(function(j){return j(w,M)}))},m.prototype.beforeNext=function(w){var M=!1;this.nextResultListeners.add(function(L,j){M||(M=!0,w(L,j))})},m}(xn);g2(_m);function wm(x){return"incremental"in x}function lA(x){return"hasNext"in x&&"data"in x}function cA(x){return wm(x)||lA(x)}function uA(x){return ca(x)&&"payload"in x}function y2(x,m){var w=x,M=new Yf;return wm(m)&&ql(m.incremental)&&m.incremental.forEach(function(L){for(var j=L.data,W=L.path,n=W.length-1;n>=0;--n){var ae=W[n],ne=!isNaN(+ae),ge=ne?[]:{};ge[ae]=j,j=ge}w=M.merge(w,j)}),w}function my(x){var m=R0(x);return ql(m)}function R0(x){var m=ql(x.errors)?x.errors.slice(0):[];return wm(x)&&ql(x.incremental)&&x.incremental.forEach(function(w){w.errors&&m.push.apply(m,w.errors)}),m}function lp(){for(var x=[],m=0;m<arguments.length;m++)x[m]=arguments[m];var w=Object.create(null);return x.forEach(function(M){M&&Object.keys(M).forEach(function(L){var j=M[L];j!==void 0&&(w[L]=j)})}),w}function _y(x,m){return lp(x,m,m.variables&&{variables:lp(ut(ut({},x&&x.variables),m.variables))})}function l0(x){return new xn(function(m){m.error(x)})}var v2=function(x,m,w){var M=new Error(w);throw M.name="ServerError",M.response=x,M.statusCode=x.status,M.result=m,M};function hA(x){for(var m=["query","operationName","variables","extensions","context"],w=0,M=Object.keys(x);w<M.length;w++){var L=M[w];if(m.indexOf(L)<0)throw eo(46,L)}return x}function fA(x,m){var w=ut({},x),M=function(j){typeof j=="function"?w=ut(ut({},w),j(w)):w=ut(ut({},w),j)},L=function(){return ut({},w)};return Object.defineProperty(m,"setContext",{enumerable:!1,value:M}),Object.defineProperty(m,"getContext",{enumerable:!1,value:L}),m}function dA(x){var m={variables:x.variables||{},extensions:x.extensions||{},operationName:x.operationName,query:x.query};return m.operationName||(m.operationName=typeof m.query!="string"?H_(m.query)||void 0:""),m}function pA(x,m){var w=ut({},x),M=new Set(Object.keys(x));return Rc(m,{Variable:function(L,j,W){W&&W.kind!=="VariableDefinition"&&M.delete(L.name.value)}}),M.forEach(function(L){delete w[L]}),w}function Z1(x,m){return m?m(x):xn.of()}function U_(x){return typeof x=="function"?new ng(x):x}function hy(x){return x.request.length<=1}var ng=function(){function x(m){m&&(this.request=m)}return x.empty=function(){return new x(function(){return xn.of()})},x.from=function(m){return m.length===0?x.empty():m.map(U_).reduce(function(w,M){return w.concat(M)})},x.split=function(m,w,M){var L=U_(w),j=U_(M||new x(Z1)),W;return hy(L)&&hy(j)?W=new x(function(n){return m(n)?L.request(n)||xn.of():j.request(n)||xn.of()}):W=new x(function(n,ae){return m(n)?L.request(n,ae)||xn.of():j.request(n,ae)||xn.of()}),Object.assign(W,{left:L,right:j})},x.execute=function(m,w){return m.request(fA(w.context,dA(hA(w))))||xn.of()},x.concat=function(m,w){var M=U_(m);if(hy(M))return globalThis.__DEV__!==!1&&Ei.warn(38,M),M;var L=U_(w),j;return hy(L)?j=new x(function(W){return M.request(W,function(n){return L.request(n)||xn.of()})||xn.of()}):j=new x(function(W,n){return M.request(W,function(ae){return L.request(ae,n)||xn.of()})||xn.of()}),Object.assign(j,{left:M,right:L})},x.prototype.split=function(m,w,M){return this.concat(x.split(m,w,M||new x(Z1)))},x.prototype.concat=function(m){return x.concat(this,m)},x.prototype.request=function(m,w){throw eo(39)},x.prototype.onError=function(m,w){if(w&&w.error)return w.error(m),!1;throw m},x.prototype.setOnError=function(m){return this.onError=m,this},x}(),z0=ng.execute;function mA(x){var m,w=x[Symbol.asyncIterator]();return m={next:function(){return w.next()}},m[Symbol.asyncIterator]=function(){return this},m}function _A(x){var m=null,w=null,M=!1,L=[],j=[];function W(Ie){if(!w){if(j.length){var Re=j.shift();if(Array.isArray(Re)&&Re[0])return Re[0]({value:Ie,done:!1})}L.push(Ie)}}function n(Ie){w=Ie;var Re=j.slice();Re.forEach(function(je){je[1](Ie)}),!m||m()}function ae(){M=!0;var Ie=j.slice();Ie.forEach(function(Re){Re[0]({value:void 0,done:!0})}),!m||m()}m=function(){m=null,x.removeListener("data",W),x.removeListener("error",n),x.removeListener("end",ae),x.removeListener("finish",ae),x.removeListener("close",ae)},x.on("data",W),x.on("error",n),x.on("end",ae),x.on("finish",ae),x.on("close",ae);function ne(){return new Promise(function(Ie,Re){if(w)return Re(w);if(L.length)return Ie({value:L.shift(),done:!1});if(M)return Ie({value:void 0,done:!0});j.push([Ie,Re])})}var ge={next:function(){return ne()}};return zy&&(ge[Symbol.asyncIterator]=function(){return this}),ge}function gA(x){var m=!1,w={next:function(){return m?Promise.resolve({value:void 0,done:!0}):(m=!0,new Promise(function(M,L){x.then(function(j){M({value:j,done:!1})}).catch(L)}))}};return zy&&(w[Symbol.asyncIterator]=function(){return this}),w}function X1(x){var m={next:function(){return x.read()}};return zy&&(m[Symbol.asyncIterator]=function(){return this}),m}function yA(x){return!!x.body}function vA(x){return!!x.getReader}function xA(x){return!!(zy&&x[Symbol.asyncIterator])}function bA(x){return!!x.stream}function wA(x){return!!x.arrayBuffer}function TA(x){return!!x.pipe}function SA(x){var m=x;if(yA(x)&&(m=x.body),xA(m))return mA(m);if(vA(m))return X1(m.getReader());if(bA(m))return X1(m.stream().getReader());if(wA(m))return gA(m.arrayBuffer());if(TA(m))return _A(m);throw new Error("Unknown body type for responseIterator. Please pass a streamable response.")}var lx=Symbol();function EA(x){return x.extensions?Array.isArray(x.extensions[lx]):!1}function x2(x){return x.hasOwnProperty("graphQLErrors")}var MA=function(x){var m=Os(Os(Os([],x.graphQLErrors,!0),x.clientErrors,!0),x.protocolErrors,!0);return x.networkError&&m.push(x.networkError),m.map(function(w){return ca(w)&&w.message||"Error message not found."}).join(`
`)},Ph=function(x){Ru(m,x);function m(w){var M=w.graphQLErrors,L=w.protocolErrors,j=w.clientErrors,W=w.networkError,n=w.errorMessage,ae=w.extraInfo,ne=x.call(this,n)||this;return ne.name="ApolloError",ne.graphQLErrors=M||[],ne.protocolErrors=L||[],ne.clientErrors=j||[],ne.networkError=W||null,ne.message=n||MA(ne),ne.extraInfo=ae,ne.cause=Os(Os(Os([W],M||[],!0),L||[],!0),j||[],!0).find(function(ge){return!!ge})||null,ne.__proto__=m.prototype,ne}return m}(Error),Y1=Object.prototype.hasOwnProperty;function AA(x,m){return jf(this,void 0,void 0,function(){var w,M,L,j,W,n,ae,ne,ge,Ie,Re,je,Qe,tt,pt,$e,Et,Tt,Mt,Ft,ni,qt,Fi,ai;return qf(this,function(kt){switch(kt.label){case 0:if(TextDecoder===void 0)throw new Error("TextDecoder must be defined in the environment: please import a polyfill.");w=new TextDecoder("utf-8"),M=(ai=x.headers)===null||ai===void 0?void 0:ai.get("content-type"),L="boundary=",j=M!=null&&M.includes(L)?M==null?void 0:M.substring((M==null?void 0:M.indexOf(L))+L.length).replace(/['"]/g,"").replace(/\;(.*)/gm,"").trim():"-",W=`\r
--`.concat(j),n="",ae=SA(x),ne=!0,kt.label=1;case 1:return ne?[4,ae.next()]:[3,3];case 2:for(ge=kt.sent(),Ie=ge.value,Re=ge.done,je=typeof Ie=="string"?Ie:w.decode(Ie),Qe=n.length-W.length+1,ne=!Re,n+=je,tt=n.indexOf(W,Qe);tt>-1;){if(pt=void 0,qt=[n.slice(0,tt),n.slice(tt+W.length)],pt=qt[0],n=qt[1],$e=pt.indexOf(`\r
\r
`),Et=CA(pt.slice(0,$e)),Tt=Et["content-type"],Tt&&Tt.toLowerCase().indexOf("application/json")===-1)throw new Error("Unsupported patch content type: application/json is required.");if(Mt=pt.slice($e),Mt){if(Ft=b2(x,Mt),Object.keys(Ft).length>1||"data"in Ft||"incremental"in Ft||"errors"in Ft||"payload"in Ft)if(uA(Ft)){if(ni={},"payload"in Ft){if(Object.keys(Ft).length===1&&Ft.payload===null)return[2];ni=ut({},Ft.payload)}"errors"in Ft&&(ni=ut(ut({},ni),{extensions:ut(ut({},"extensions"in ni?ni.extensions:null),(Fi={},Fi[lx]=Ft.errors,Fi))})),m(ni)}else m(Ft);else if(Object.keys(Ft).length===1&&"hasNext"in Ft&&!Ft.hasNext)return[2]}tt=n.indexOf(W)}return[3,1];case 3:return[2]}})})}function CA(x){var m={};return x.split(`
`).forEach(function(w){var M=w.indexOf(":");if(M>-1){var L=w.slice(0,M).trim().toLowerCase(),j=w.slice(M+1).trim();m[L]=j}}),m}function b2(x,m){if(x.status>=300){var w=function(){try{return JSON.parse(m)}catch{return m}};v2(x,w(),"Response not successful: Received status code ".concat(x.status))}try{return JSON.parse(m)}catch(L){var M=L;throw M.name="ServerParseError",M.response=x,M.statusCode=x.status,M.bodyText=m,M}}function DA(x,m){x.result&&x.result.errors&&x.result.data&&m.next(x.result),m.error(x)}function IA(x){return function(m){return m.text().then(function(w){return b2(m,w)}).then(function(w){return!Array.isArray(w)&&!Y1.call(w,"data")&&!Y1.call(w,"errors")&&v2(m,w,"Server response was missing for query '".concat(Array.isArray(x)?x.map(function(M){return M.operationName}):x.operationName,"'.")),w})}}var O0=function(x,m){var w;try{w=JSON.stringify(x)}catch(L){var M=eo(42,m,L.message);throw M.parseError=L,M}return w},RA={includeQuery:!0,includeExtensions:!1,preserveHeaderCase:!1},zA={accept:"*/*","content-type":"application/json"},OA={method:"POST"},LA={http:RA,headers:zA,options:OA},PA=function(x,m){return m(x)};function kA(x,m){for(var w=[],M=2;M<arguments.length;M++)w[M-2]=arguments[M];var L={},j={};w.forEach(function(Ie){L=ut(ut(ut({},L),Ie.options),{headers:ut(ut({},L.headers),Ie.headers)}),Ie.credentials&&(L.credentials=Ie.credentials),j=ut(ut({},j),Ie.http)}),L.headers&&(L.headers=FA(L.headers,j.preserveHeaderCase));var W=x.operationName,n=x.extensions,ae=x.variables,ne=x.query,ge={operationName:W,variables:ae};return j.includeExtensions&&(ge.extensions=n),j.includeQuery&&(ge.query=m(ne,np)),{options:L,body:ge}}function FA(x,m){if(!m){var w={};return Object.keys(Object(x)).forEach(function(j){w[j.toLowerCase()]=x[j]}),w}var M={};Object.keys(Object(x)).forEach(function(j){M[j.toLowerCase()]={originalName:j,value:x[j]}});var L={};return Object.keys(M).forEach(function(j){L[M[j].originalName]=M[j].value}),L}var BA=function(x){if(!x&&typeof fetch>"u")throw eo(40)},NA=function(x,m){var w=x.getContext(),M=w.uri;return M||(typeof m=="function"?m(x):m||"/graphql")};function VA(x,m){var w=[],M=function(Ie,Re){w.push("".concat(Ie,"=").concat(encodeURIComponent(Re)))};if("query"in m&&M("query",m.query),m.operationName&&M("operationName",m.operationName),m.variables){var L=void 0;try{L=O0(m.variables,"Variables map")}catch(Ie){return{parseError:Ie}}M("variables",L)}if(m.extensions){var j=void 0;try{j=O0(m.extensions,"Extensions map")}catch(Ie){return{parseError:Ie}}M("extensions",j)}var W="",n=x,ae=x.indexOf("#");ae!==-1&&(W=x.substr(ae),n=x.substr(0,ae));var ne=n.indexOf("?")===-1?"?":"&",ge=n+ne+w.join("&")+W;return{newURI:ge}}var W1=Dc(function(){return fetch}),UA=function(x){x===void 0&&(x={});var m=x.uri,w=m===void 0?"/graphql":m,M=x.fetch,L=x.print,j=L===void 0?PA:L,W=x.includeExtensions,n=x.preserveHeaderCase,ae=x.useGETForQueries,ne=x.includeUnusedVariables,ge=ne===void 0?!1:ne,Ie=Ic(x,["uri","fetch","print","includeExtensions","preserveHeaderCase","useGETForQueries","includeUnusedVariables"]);globalThis.__DEV__!==!1&&BA(M||W1);var Re={http:{includeExtensions:W,preserveHeaderCase:n},options:Ie.fetchOptions,credentials:Ie.credentials,headers:Ie.headers};return new ng(function(je){var Qe=NA(je,w),tt=je.getContext(),pt={};if(tt.clientAwareness){var $e=tt.clientAwareness,Et=$e.name,Tt=$e.version;Et&&(pt["apollographql-client-name"]=Et),Tt&&(pt["apollographql-client-version"]=Tt)}var Mt=ut(ut({},pt),tt.headers),Ft={http:tt.http,options:tt.fetchOptions,credentials:tt.credentials,headers:Mt};if(K_(["client"],je.query)){var ni=f2(je.query);if(!ni)return l0(new Error("HttpLink: Trying to send a client-only query to the server. To send to the server, ensure a non-client field is added to the query or set the `transformOptions.removeClientFields` option to `true`."));je.query=ni}var qt=kA(je,j,LA,Re,Ft),Fi=qt.options,ai=qt.body;ai.variables&&!ge&&(ai.variables=pA(ai.variables,je.query));var kt;!Fi.signal&&typeof AbortController<"u"&&(kt=new AbortController,Fi.signal=kt.signal);var li=function(ti){return ti.kind==="OperationDefinition"&&ti.operation==="mutation"},bn=function(ti){return ti.kind==="OperationDefinition"&&ti.operation==="subscription"},Dr=bn(rg(je.query)),wn=K_(["defer"],je.query);if(ae&&!je.query.definitions.some(li)&&(Fi.method="GET"),wn||Dr){Fi.headers=Fi.headers||{};var gi="multipart/mixed;";Dr&&wn&&globalThis.__DEV__!==!1&&Ei.warn(41),Dr?gi+="boundary=graphql;subscriptionSpec=1.0,application/json":wn&&(gi+="deferSpec=20220824,application/json"),Fi.headers.accept=gi}if(Fi.method==="GET"){var ii=VA(Qe,ai),Xi=ii.newURI,Bi=ii.parseError;if(Bi)return l0(Bi);Qe=Xi}else try{Fi.body=O0(ai,"Payload")}catch(ti){return l0(ti)}return new xn(function(ti){var et=M||Dc(function(){return fetch})||W1,Kt=ti.next.bind(ti);return et(Qe,Fi).then(function(Di){var Nt;je.setContext({response:Di});var wi=(Nt=Di.headers)===null||Nt===void 0?void 0:Nt.get("content-type");return wi!==null&&/^multipart\/mixed/i.test(wi)?AA(Di,Kt):IA(je)(Di).then(Kt)}).then(function(){kt=void 0,ti.complete()}).catch(function(Di){kt=void 0,DA(Di,ti)}),function(){kt&&kt.abort()}})})},jA=function(x){Ru(m,x);function m(w){w===void 0&&(w={});var M=x.call(this,UA(w).request)||this;return M.options=w,M}return m}(ng);const{toString:$1,hasOwnProperty:qA}=Object.prototype,Q1=Function.prototype.toString,L0=new Map;function cn(x,m){try{return P0(x,m)}finally{L0.clear()}}function P0(x,m){if(x===m)return!0;const w=$1.call(x),M=$1.call(m);if(w!==M)return!1;switch(w){case"[object Array]":if(x.length!==m.length)return!1;case"[object Object]":{if(J1(x,m))return!0;const L=K1(x),j=K1(m),W=L.length;if(W!==j.length)return!1;for(let n=0;n<W;++n)if(!qA.call(m,L[n]))return!1;for(let n=0;n<W;++n){const ae=L[n];if(!P0(x[ae],m[ae]))return!1}return!0}case"[object Error]":return x.name===m.name&&x.message===m.message;case"[object Number]":if(x!==x)return m!==m;case"[object Boolean]":case"[object Date]":return+x==+m;case"[object RegExp]":case"[object String]":return x==`${m}`;case"[object Map]":case"[object Set]":{if(x.size!==m.size)return!1;if(J1(x,m))return!0;const L=x.entries(),j=w==="[object Map]";for(;;){const W=L.next();if(W.done)break;const[n,ae]=W.value;if(!m.has(n)||j&&!P0(ae,m.get(n)))return!1}return!0}case"[object Uint16Array]":case"[object Uint8Array]":case"[object Uint32Array]":case"[object Int32Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object ArrayBuffer]":x=new Uint8Array(x),m=new Uint8Array(m);case"[object DataView]":{let L=x.byteLength;if(L===m.byteLength)for(;L--&&x[L]===m[L];);return L===-1}case"[object AsyncFunction]":case"[object GeneratorFunction]":case"[object AsyncGeneratorFunction]":case"[object Function]":{const L=Q1.call(x);return L!==Q1.call(m)?!1:!ZA(L,HA)}}return!1}function K1(x){return Object.keys(x).filter(GA,x)}function GA(x){return this[x]!==void 0}const HA="{ [native code] }";function ZA(x,m){const w=x.length-m.length;return w>=0&&x.indexOf(m,w)===w}function J1(x,m){let w=L0.get(x);if(w){if(w.has(m))return!0}else L0.set(x,w=new Set);return w.add(m),!1}function w2(x,m,w,M){var L=m.data,j=Ic(m,["data"]),W=w.data,n=Ic(w,["data"]);return cn(j,n)&&gy(rg(x).selectionSet,L,W,{fragmentMap:Rm(Om(x)),variables:M})}function gy(x,m,w,M){if(m===w)return!0;var L=new Set;return x.selections.every(function(j){if(L.has(j)||(L.add(j),!ig(j,M.variables))||ew(j))return!0;if(Zf(j)){var W=Fh(j),n=m&&m[W],ae=w&&w[W],ne=j.selectionSet;if(!ne)return cn(n,ae);var ge=Array.isArray(n),Ie=Array.isArray(ae);if(ge!==Ie)return!1;if(ge&&Ie){var Re=n.length;if(ae.length!==Re)return!1;for(var je=0;je<Re;++je)if(!gy(ne,n[je],ae[je],M))return!1;return!0}return gy(ne,n,ae,M)}else{var Qe=Oy(j,M.fragmentMap);if(Qe)return ew(Qe)?!0:gy(Qe.selectionSet,m,w,M)}})}function ew(x){return!!x.directives&&x.directives.some(XA)}function XA(x){return x.name.value==="nonreactive"}var T2=cp?WeakMap:Map,S2=W0?WeakSet:Set,cx=new Py,tw=!1;function E2(){tw||(tw=!0,globalThis.__DEV__!==!1&&Ei.warn(52))}function M2(x,m,w){return cx.withValue(!0,function(){var M=Z_(x,m,w,!1);return Object.isFrozen(x)&&Cm(M),M})}function YA(x,m){if(m.has(x))return m.get(x);var w=Array.isArray(x)?[]:Object.create(null);return m.set(x,w),w}function Z_(x,m,w,M,L){var j,W=w.knownChanged,n=YA(x,w.mutableTargets);if(Array.isArray(x)){for(var ae=0,ne=Array.from(x.entries());ae<ne.length;ae++){var ge=ne[ae],Ie=ge[0],Re=ge[1];if(Re===null){n[Ie]=null;continue}var je=Z_(Re,m,w,M,globalThis.__DEV__!==!1?"".concat(L||"","[").concat(Ie,"]"):void 0);W.has(je)&&W.add(n),n[Ie]=je}return W.has(n)?n:x}for(var Qe=0,tt=m.selections;Qe<tt.length;Qe++){var pt=tt[Qe],$e=void 0;if(M&&W.add(n),pt.kind===Si.FIELD){var Et=Fh(pt),Tt=pt.selectionSet;if($e=n[Et]||x[Et],$e===void 0)continue;if(Tt&&$e!==null){var je=Z_(x[Et],Tt,w,M,globalThis.__DEV__!==!1?"".concat(L||"",".").concat(Et):void 0);W.has(je)&&($e=je)}globalThis.__DEV__===!1&&(n[Et]=$e),globalThis.__DEV__!==!1&&(M&&Et!=="__typename"&&!(!((j=Object.getOwnPropertyDescriptor(n,Et))===null||j===void 0)&&j.value)?Object.defineProperty(n,Et,WA(Et,$e,L||"",w.operationName,w.operationType)):(delete n[Et],n[Et]=$e))}if(pt.kind===Si.INLINE_FRAGMENT&&(!pt.typeCondition||w.cache.fragmentMatches(pt,x.__typename))&&($e=Z_(x,pt.selectionSet,w,M,L)),pt.kind===Si.FRAGMENT_SPREAD){var Mt=pt.name.value,Ft=w.fragmentMap[Mt]||(w.fragmentMap[Mt]=w.cache.lookupFragment(Mt));Ei(Ft,47,Mt);var ni=ZE(pt);ni!=="mask"&&($e=Z_(x,Ft.selectionSet,w,ni==="migrate",L))}W.has($e)&&W.add(n)}return"__typename"in x&&!("__typename"in n)&&(n.__typename=x.__typename),Object.keys(n).length!==Object.keys(x).length&&W.add(n),W.has(n)?n:x}function WA(x,m,w,M,L){var j=function(){return cx.getValue()||(globalThis.__DEV__!==!1&&Ei.warn(48,M?"".concat(L," '").concat(M,"'"):"anonymous ".concat(L),"".concat(w,".").concat(x).replace(/^\./,"")),j=function(){return m}),m};return{get:function(){return j()},set:function(W){j=function(){return W}},enumerable:!0,configurable:!0}}function A2(x,m,w,M){if(!w.fragmentMatches)return globalThis.__DEV__!==!1&&E2(),x;var L=m.definitions.filter(function(W){return W.kind===Si.FRAGMENT_DEFINITION});typeof M>"u"&&(Ei(L.length===1,49,L.length),M=L[0].name.value);var j=L.find(function(W){return W.name.value===M});return Ei(!!j,50,M),x==null||cn(x,{})?x:M2(x,j.selectionSet,{operationType:"fragment",operationName:j.name.value,fragmentMap:Rm(Om(m)),cache:w,mutableTargets:new T2,knownChanged:new S2})}function $A(x,m,w){var M;if(!w.fragmentMatches)return globalThis.__DEV__!==!1&&E2(),x;var L=op(m);return Ei(L,51),x==null?x:M2(x,L.selectionSet,{operationType:L.operation,operationName:(M=L.name)===null||M===void 0?void 0:M.value,fragmentMap:Rm(Om(m)),cache:w,mutableTargets:new T2,knownChanged:new S2})}var C2=function(){function x(){this.assumeImmutableResults=!1,this.getFragmentDoc=eg(eM,{max:Iu["cache.fragmentQueryDocuments"]||1e3,cache:Ty})}return x.prototype.lookupFragment=function(m){return null},x.prototype.batch=function(m){var w=this,M=typeof m.optimistic=="string"?m.optimistic:m.optimistic===!1?null:void 0,L;return this.performTransaction(function(){return L=m.update(w)},M),L},x.prototype.recordOptimisticTransaction=function(m,w){this.performTransaction(m,w)},x.prototype.transformDocument=function(m){return m},x.prototype.transformForLink=function(m){return m},x.prototype.identify=function(m){},x.prototype.gc=function(){return[]},x.prototype.modify=function(m){return!1},x.prototype.readQuery=function(m,w){return w===void 0&&(w=!!m.optimistic),this.read(ut(ut({},m),{rootId:m.id||"ROOT_QUERY",optimistic:w}))},x.prototype.watchFragment=function(m){var w=this,M=m.fragment,L=m.fragmentName,j=m.from,W=m.optimistic,n=W===void 0?!0:W,ae=Ic(m,["fragment","fragmentName","from","optimistic"]),ne=this.getFragmentDoc(M,L),ge=typeof j>"u"||typeof j=="string"?j:this.identify(j),Ie=!!m[Symbol.for("apollo.dataMasking")];if(globalThis.__DEV__!==!1){var Re=L||Qw(M).name.value;ge||globalThis.__DEV__!==!1&&Ei.warn(1,Re)}var je=ut(ut({},ae),{returnPartialData:!0,id:ge,query:ne,optimistic:n}),Qe;return new xn(function(tt){return w.watch(ut(ut({},je),{immediate:!0,callback:function(pt){var $e=Ie?A2(pt.result,M,w,L):pt.result;if(!(Qe&&w2(ne,{data:Qe.result},{data:$e},m.variables))){var Et={data:$e,complete:!!pt.complete};pt.missing&&(Et.missing=By(pt.missing.map(function(Tt){return Tt.missing}))),Qe=ut(ut({},pt),{result:$e}),tt.next(Et)}}}))})},x.prototype.readFragment=function(m,w){return w===void 0&&(w=!!m.optimistic),this.read(ut(ut({},m),{query:this.getFragmentDoc(m.fragment,m.fragmentName),rootId:m.id,optimistic:w}))},x.prototype.writeQuery=function(m){var w=m.id,M=m.data,L=Ic(m,["id","data"]);return this.write(Object.assign(L,{dataId:w||"ROOT_QUERY",result:M}))},x.prototype.writeFragment=function(m){var w=m.id,M=m.data,L=m.fragment,j=m.fragmentName,W=Ic(m,["id","data","fragment","fragmentName"]);return this.write(Object.assign(W,{query:this.getFragmentDoc(L,j),dataId:w,result:M}))},x.prototype.updateQuery=function(m,w){return this.batch({update:function(M){var L=M.readQuery(m),j=w(L);return j==null?L:(M.writeQuery(ut(ut({},m),{data:j})),j)}})},x.prototype.updateFragment=function(m,w){return this.batch({update:function(M){var L=M.readFragment(m),j=w(L);return j==null?L:(M.writeFragment(ut(ut({},m),{data:j})),j)}})},x}();globalThis.__DEV__!==!1&&(C2.prototype.getMemoryInternals=fM);var D2=function(x){Ru(m,x);function m(w,M,L,j){var W,n=x.call(this,w)||this;if(n.message=w,n.path=M,n.query=L,n.variables=j,Array.isArray(n.path)){n.missing=n.message;for(var ae=n.path.length-1;ae>=0;--ae)n.missing=(W={},W[n.path[ae]]=n.missing,W)}else n.missing=n.path;return n.__proto__=m.prototype,n}return m}(Error),Xa=Object.prototype.hasOwnProperty;function j_(x){return x==null}function I2(x,m){var w=x.__typename,M=x.id,L=x._id;if(typeof w=="string"&&(m&&(m.keyObject=j_(M)?j_(L)?void 0:{_id:L}:{id:M}),j_(M)&&!j_(L)&&(M=L),!j_(M)))return"".concat(w,":").concat(typeof M=="number"||typeof M=="string"?M:JSON.stringify(M))}var R2={dataIdFromObject:I2,addTypename:!0,resultCaching:!0,canonizeResults:!1};function QA(x){return lp(R2,x)}function z2(x){var m=x.canonizeResults;return m===void 0?R2.canonizeResults:m}function KA(x,m){return rn(m)?x.get(m.__ref,"__typename"):m&&m.__typename}var O2=/^[_a-z][_0-9a-z]*/i;function Wf(x){var m=x.match(O2);return m?m[0]:x}function k0(x,m,w){return ca(m)?ua(m)?m.every(function(M){return k0(x,M,w)}):x.selections.every(function(M){if(Zf(M)&&ig(M,w)){var L=Fh(M);return Xa.call(m,L)&&(!M.selectionSet||k0(M.selectionSet,m[L],w))}return!0}):!1}function vm(x){return ca(x)&&!rn(x)&&!ua(x)}function JA(){return new Yf}function L2(x,m){var w=Rm(Om(x));return{fragmentMap:w,lookupFragment:function(M){var L=w[M];return!L&&m&&(L=m.lookup(M)),L||null}}}var yy=Object.create(null),c0=function(){return yy},iw=Object.create(null),tg=function(){function x(m,w){var M=this;this.policies=m,this.group=w,this.data=Object.create(null),this.rootIds=Object.create(null),this.refs=Object.create(null),this.getFieldValue=function(L,j){return Cm(rn(L)?M.get(L.__ref,j):L&&L[j])},this.canRead=function(L){return rn(L)?M.has(L.__ref):typeof L=="object"},this.toReference=function(L,j){if(typeof L=="string")return bm(L);if(rn(L))return L;var W=M.policies.identify(L)[0];if(W){var n=bm(W);return j&&M.merge(W,L),n}}}return x.prototype.toObject=function(){return ut({},this.data)},x.prototype.has=function(m){return this.lookup(m,!0)!==void 0},x.prototype.get=function(m,w){if(this.group.depend(m,w),Xa.call(this.data,m)){var M=this.data[m];if(M&&Xa.call(M,w))return M[w]}if(w==="__typename"&&Xa.call(this.policies.rootTypenamesById,m))return this.policies.rootTypenamesById[m];if(this instanceof Uf)return this.parent.get(m,w)},x.prototype.lookup=function(m,w){if(w&&this.group.depend(m,"__exists"),Xa.call(this.data,m))return this.data[m];if(this instanceof Uf)return this.parent.lookup(m,w);if(this.policies.rootTypenamesById[m])return Object.create(null)},x.prototype.merge=function(m,w){var M=this,L;rn(m)&&(m=m.__ref),rn(w)&&(w=w.__ref);var j=typeof m=="string"?this.lookup(L=m):m,W=typeof w=="string"?this.lookup(L=w):w;if(W){Ei(typeof L=="string",2);var n=new Yf(tC).merge(j,W);if(this.data[L]=n,n!==j&&(delete this.refs[L],this.group.caching)){var ae=Object.create(null);j||(ae.__exists=1),Object.keys(W).forEach(function(ne){if(!j||j[ne]!==n[ne]){ae[ne]=1;var ge=Wf(ne);ge!==ne&&!M.policies.hasKeyArgs(n.__typename,ge)&&(ae[ge]=1),n[ne]===void 0&&!(M instanceof Uf)&&delete n[ne]}}),ae.__typename&&!(j&&j.__typename)&&this.policies.rootTypenamesById[L]===n.__typename&&delete ae.__typename,Object.keys(ae).forEach(function(ne){return M.group.dirty(L,ne)})}}},x.prototype.modify=function(m,w){var M=this,L=this.lookup(m);if(L){var j=Object.create(null),W=!1,n=!0,ae={DELETE:yy,INVALIDATE:iw,isReference:rn,toReference:this.toReference,canRead:this.canRead,readField:function(ne,ge){return M.policies.readField(typeof ne=="string"?{fieldName:ne,from:ge||bm(m)}:ne,{store:M})}};if(Object.keys(L).forEach(function(ne){var ge=Wf(ne),Ie=L[ne];if(Ie!==void 0){var Re=typeof w=="function"?w:w[ne]||w[ge];if(Re){var je=Re===c0?yy:Re(Cm(Ie),ut(ut({},ae),{fieldName:ge,storeFieldName:ne,storage:M.getStorage(m,ne)}));if(je===iw)M.group.dirty(m,ne);else if(je===yy&&(je=void 0),je!==Ie&&(j[ne]=je,W=!0,Ie=je,globalThis.__DEV__!==!1)){var Qe=function(Ft){if(M.lookup(Ft.__ref)===void 0)return globalThis.__DEV__!==!1&&Ei.warn(3,Ft),!0};if(rn(je))Qe(je);else if(Array.isArray(je))for(var tt=!1,pt=void 0,$e=0,Et=je;$e<Et.length;$e++){var Tt=Et[$e];if(rn(Tt)){if(tt=!0,Qe(Tt))break}else if(typeof Tt=="object"&&Tt){var Mt=M.policies.identify(Tt)[0];Mt&&(pt=Tt)}if(tt&&pt!==void 0){globalThis.__DEV__!==!1&&Ei.warn(4,pt);break}}}}Ie!==void 0&&(n=!1)}}),W)return this.merge(m,j),n&&(this instanceof Uf?this.data[m]=void 0:delete this.data[m],this.group.dirty(m,"__exists")),!0}return!1},x.prototype.delete=function(m,w,M){var L,j=this.lookup(m);if(j){var W=this.getFieldValue(j,"__typename"),n=w&&M?this.policies.getStoreFieldName({typename:W,fieldName:w,args:M}):w;return this.modify(m,n?(L={},L[n]=c0,L):c0)}return!1},x.prototype.evict=function(m,w){var M=!1;return m.id&&(Xa.call(this.data,m.id)&&(M=this.delete(m.id,m.fieldName,m.args)),this instanceof Uf&&this!==w&&(M=this.parent.evict(m,w)||M),(m.fieldName||M)&&this.group.dirty(m.id,m.fieldName||"__exists")),M},x.prototype.clear=function(){this.replace(null)},x.prototype.extract=function(){var m=this,w=this.toObject(),M=[];return this.getRootIdSet().forEach(function(L){Xa.call(m.policies.rootTypenamesById,L)||M.push(L)}),M.length&&(w.__META={extraRootIds:M.sort()}),w},x.prototype.replace=function(m){var w=this;if(Object.keys(this.data).forEach(function(j){m&&Xa.call(m,j)||w.delete(j)}),m){var M=m.__META,L=Ic(m,["__META"]);Object.keys(L).forEach(function(j){w.merge(j,L[j])}),M&&M.extraRootIds.forEach(this.retain,this)}},x.prototype.retain=function(m){return this.rootIds[m]=(this.rootIds[m]||0)+1},x.prototype.release=function(m){if(this.rootIds[m]>0){var w=--this.rootIds[m];return w||delete this.rootIds[m],w}return 0},x.prototype.getRootIdSet=function(m){return m===void 0&&(m=new Set),Object.keys(this.rootIds).forEach(m.add,m),this instanceof Uf?this.parent.getRootIdSet(m):Object.keys(this.policies.rootTypenamesById).forEach(m.add,m),m},x.prototype.gc=function(){var m=this,w=this.getRootIdSet(),M=this.toObject();w.forEach(function(W){Xa.call(M,W)&&(Object.keys(m.findChildRefIds(W)).forEach(w.add,w),delete M[W])});var L=Object.keys(M);if(L.length){for(var j=this;j instanceof Uf;)j=j.parent;L.forEach(function(W){return j.delete(W)})}return L},x.prototype.findChildRefIds=function(m){if(!Xa.call(this.refs,m)){var w=this.refs[m]=Object.create(null),M=this.data[m];if(!M)return w;var L=new Set([M]);L.forEach(function(j){rn(j)&&(w[j.__ref]=!0),ca(j)&&Object.keys(j).forEach(function(W){var n=j[W];ca(n)&&L.add(n)})})}return this.refs[m]},x.prototype.makeCacheKey=function(){return this.group.keyMaker.lookupArray(arguments)},x}(),P2=function(){function x(m,w){w===void 0&&(w=null),this.caching=m,this.parent=w,this.d=null,this.resetCaching()}return x.prototype.resetCaching=function(){this.d=this.caching?l2():null,this.keyMaker=new Bh(cp)},x.prototype.depend=function(m,w){if(this.d){this.d(u0(m,w));var M=Wf(w);M!==w&&this.d(u0(m,M)),this.parent&&this.parent.depend(m,w)}},x.prototype.dirty=function(m,w){this.d&&this.d.dirty(u0(m,w),w==="__exists"?"forget":"setDirty")},x}();function u0(x,m){return m+"#"+x}function rw(x,m){W_(x)&&x.group.depend(m,"__exists")}(function(x){var m=function(w){Ru(M,w);function M(L){var j=L.policies,W=L.resultCaching,n=W===void 0?!0:W,ae=L.seed,ne=w.call(this,j,new P2(n))||this;return ne.stump=new eC(ne),ne.storageTrie=new Bh(cp),ae&&ne.replace(ae),ne}return M.prototype.addLayer=function(L,j){return this.stump.addLayer(L,j)},M.prototype.removeLayer=function(){return this},M.prototype.getStorage=function(){return this.storageTrie.lookupArray(arguments)},M}(x);x.Root=m})(tg||(tg={}));var Uf=function(x){Ru(m,x);function m(w,M,L,j){var W=x.call(this,M.policies,j)||this;return W.id=w,W.parent=M,W.replay=L,W.group=j,L(W),W}return m.prototype.addLayer=function(w,M){return new m(w,this,M,this.group)},m.prototype.removeLayer=function(w){var M=this,L=this.parent.removeLayer(w);return w===this.id?(this.group.caching&&Object.keys(this.data).forEach(function(j){var W=M.data[j],n=L.lookup(j);n?W?W!==n&&Object.keys(W).forEach(function(ae){cn(W[ae],n[ae])||M.group.dirty(j,ae)}):(M.group.dirty(j,"__exists"),Object.keys(n).forEach(function(ae){M.group.dirty(j,ae)})):M.delete(j)}),L):L===this.parent?this:L.addLayer(this.id,this.replay)},m.prototype.toObject=function(){return ut(ut({},this.parent.toObject()),this.data)},m.prototype.findChildRefIds=function(w){var M=this.parent.findChildRefIds(w);return Xa.call(this.data,w)?ut(ut({},M),x.prototype.findChildRefIds.call(this,w)):M},m.prototype.getStorage=function(){for(var w=this.parent;w.parent;)w=w.parent;return w.getStorage.apply(w,arguments)},m}(tg),eC=function(x){Ru(m,x);function m(w){return x.call(this,"EntityStore.Stump",w,function(){},new P2(w.group.caching,w.group))||this}return m.prototype.removeLayer=function(){return this},m.prototype.merge=function(w,M){return this.parent.merge(w,M)},m}(Uf);function tC(x,m,w){var M=x[w],L=m[w];return cn(M,L)?M:L}function W_(x){return!!(x instanceof tg&&x.group.caching)}function iC(x){return ca(x)?ua(x)?x.slice(0):ut({__proto__:Object.getPrototypeOf(x)},x):x}var nw=function(){function x(){this.known=new(W0?WeakSet:Set),this.pool=new Bh(cp),this.passes=new WeakMap,this.keysByJSON=new Map,this.empty=this.admit({})}return x.prototype.isKnown=function(m){return ca(m)&&this.known.has(m)},x.prototype.pass=function(m){if(ca(m)){var w=iC(m);return this.passes.set(w,m),w}return m},x.prototype.admit=function(m){var w=this;if(ca(m)){var M=this.passes.get(m);if(M)return M;var L=Object.getPrototypeOf(m);switch(L){case Array.prototype:{if(this.known.has(m))return m;var j=m.map(this.admit,this),W=this.pool.lookupArray(j);return W.array||(this.known.add(W.array=j),globalThis.__DEV__!==!1&&Object.freeze(j)),W.array}case null:case Object.prototype:{if(this.known.has(m))return m;var n=Object.getPrototypeOf(m),ae=[n],ne=this.sortedKeys(m);ae.push(ne.json);var ge=ae.length;ne.sorted.forEach(function(je){ae.push(w.admit(m[je]))});var W=this.pool.lookupArray(ae);if(!W.object){var Ie=W.object=Object.create(n);this.known.add(Ie),ne.sorted.forEach(function(je,Qe){Ie[je]=ae[ge+Qe]}),globalThis.__DEV__!==!1&&Object.freeze(Ie)}return W.object}}}return m},x.prototype.sortedKeys=function(m){var w=Object.keys(m),M=this.pool.lookupArray(w);if(!M.keys){w.sort();var L=JSON.stringify(w);(M.keys=this.keysByJSON.get(L))||this.keysByJSON.set(L,M.keys={sorted:w,json:L})}return M.keys},x}();function aw(x){return[x.selectionSet,x.objectOrReference,x.context,x.context.canonizeResults]}var rC=function(){function x(m){var w=this;this.knownResults=new(cp?WeakMap:Map),this.config=lp(m,{addTypename:m.addTypename!==!1,canonizeResults:z2(m)}),this.canon=m.canon||new nw,this.executeSelectionSet=eg(function(M){var L,j=M.context.canonizeResults,W=aw(M);W[3]=!j;var n=(L=w.executeSelectionSet).peek.apply(L,W);return n?j?ut(ut({},n),{result:w.canon.admit(n.result)}):n:(rw(M.context.store,M.enclosingRef.__ref),w.execSelectionSetImpl(M))},{max:this.config.resultCacheMaxSize||Iu["inMemoryCache.executeSelectionSet"]||5e4,keyArgs:aw,makeCacheKey:function(M,L,j,W){if(W_(j.store))return j.store.makeCacheKey(M,rn(L)?L.__ref:L,j.varString,W)}}),this.executeSubSelectedArray=eg(function(M){return rw(M.context.store,M.enclosingRef.__ref),w.execSubSelectedArrayImpl(M)},{max:this.config.resultCacheMaxSize||Iu["inMemoryCache.executeSubSelectedArray"]||1e4,makeCacheKey:function(M){var L=M.field,j=M.array,W=M.context;if(W_(W.store))return W.store.makeCacheKey(L,j,W.varString)}})}return x.prototype.resetCanon=function(){this.canon=new nw},x.prototype.diffQueryAgainstStore=function(m){var w=m.store,M=m.query,L=m.rootId,j=L===void 0?"ROOT_QUERY":L,W=m.variables,n=m.returnPartialData,ae=n===void 0?!0:n,ne=m.canonizeResults,ge=ne===void 0?this.config.canonizeResults:ne,Ie=this.config.cache.policies;W=ut(ut({},J0($w(M))),W);var Re=bm(j),je=this.executeSelectionSet({selectionSet:rg(M).selectionSet,objectOrReference:Re,enclosingRef:Re,context:ut({store:w,query:M,policies:Ie,variables:W,varString:Hf(W),canonizeResults:ge},L2(M,this.config.fragments))}),Qe;if(je.missing&&(Qe=[new D2(nC(je.missing),je.missing,M,W)],!ae))throw Qe[0];return{result:je.result,complete:!Qe,missing:Qe}},x.prototype.isFresh=function(m,w,M,L){if(W_(L.store)&&this.knownResults.get(m)===M){var j=this.executeSelectionSet.peek(M,w,L,this.canon.isKnown(m));if(j&&m===j.result)return!0}return!1},x.prototype.execSelectionSetImpl=function(m){var w=this,M=m.selectionSet,L=m.objectOrReference,j=m.enclosingRef,W=m.context;if(rn(L)&&!W.policies.rootTypenamesById[L.__ref]&&!W.store.has(L.__ref))return{result:this.canon.empty,missing:"Dangling reference to missing ".concat(L.__ref," object")};var n=W.variables,ae=W.policies,ne=W.store,ge=ne.getFieldValue(L,"__typename"),Ie=[],Re,je=new Yf;this.config.addTypename&&typeof ge=="string"&&!ae.rootIdsByTypename[ge]&&Ie.push({__typename:ge});function Qe(Tt,Mt){var Ft;return Tt.missing&&(Re=je.merge(Re,(Ft={},Ft[Mt]=Tt.missing,Ft))),Tt.result}var tt=new Set(M.selections);tt.forEach(function(Tt){var Mt,Ft;if(ig(Tt,n))if(Zf(Tt)){var ni=ae.readField({fieldName:Tt.name.value,field:Tt,variables:W.variables,from:L},W),qt=Fh(Tt);ni===void 0?rx.added(Tt)||(Re=je.merge(Re,(Mt={},Mt[qt]="Can't find field '".concat(Tt.name.value,"' on ").concat(rn(L)?L.__ref+" object":"object "+JSON.stringify(L,null,2)),Mt))):ua(ni)?ni.length>0&&(ni=Qe(w.executeSubSelectedArray({field:Tt,array:ni,enclosingRef:j,context:W}),qt)):Tt.selectionSet?ni!=null&&(ni=Qe(w.executeSelectionSet({selectionSet:Tt.selectionSet,objectOrReference:ni,enclosingRef:rn(ni)?ni:j,context:W}),qt)):W.canonizeResults&&(ni=w.canon.pass(ni)),ni!==void 0&&Ie.push((Ft={},Ft[qt]=ni,Ft))}else{var Fi=Oy(Tt,W.lookupFragment);if(!Fi&&Tt.kind===Si.FRAGMENT_SPREAD)throw eo(10,Tt.name.value);Fi&&ae.fragmentMatches(Fi,ge)&&Fi.selectionSet.selections.forEach(tt.add,tt)}});var pt=By(Ie),$e={result:pt,missing:Re},Et=W.canonizeResults?this.canon.admit($e):Cm($e);return Et.result&&this.knownResults.set(Et.result,M),Et},x.prototype.execSubSelectedArrayImpl=function(m){var w=this,M=m.field,L=m.array,j=m.enclosingRef,W=m.context,n,ae=new Yf;function ne(ge,Ie){var Re;return ge.missing&&(n=ae.merge(n,(Re={},Re[Ie]=ge.missing,Re))),ge.result}return M.selectionSet&&(L=L.filter(W.store.canRead)),L=L.map(function(ge,Ie){return ge===null?null:ua(ge)?ne(w.executeSubSelectedArray({field:M,array:ge,enclosingRef:j,context:W}),Ie):M.selectionSet?ne(w.executeSelectionSet({selectionSet:M.selectionSet,objectOrReference:ge,enclosingRef:rn(ge)?ge:j,context:W}),Ie):(globalThis.__DEV__!==!1&&aC(W.store,M,ge),ge)}),{result:W.canonizeResults?this.canon.admit(L):L,missing:n}},x}();function nC(x){try{JSON.stringify(x,function(m,w){if(typeof w=="string")throw w;return w})}catch(m){return m}}function aC(x,m,w){if(!m.selectionSet){var M=new Set([w]);M.forEach(function(L){ca(L)&&(Ei(!rn(L),11,KA(x,L),m.name.value),Object.values(L).forEach(M.add,M))})}}var ux=new Py,sw=new WeakMap;function $_(x){var m=sw.get(x);return m||sw.set(x,m={vars:new Set,dep:l2()}),m}function ow(x){$_(x).vars.forEach(function(m){return m.forgetCache(x)})}function sC(x){$_(x).vars.forEach(function(m){return m.attachCache(x)})}function oC(x){var m=new Set,w=new Set,M=function(j){if(arguments.length>0){if(x!==j){x=j,m.forEach(function(ae){$_(ae).dep.dirty(M),lC(ae)});var W=Array.from(w);w.clear(),W.forEach(function(ae){return ae(x)})}}else{var n=ux.getValue();n&&(L(n),$_(n).dep(M))}return x};M.onNextChange=function(j){return w.add(j),function(){w.delete(j)}};var L=M.attachCache=function(j){return m.add(j),$_(j).vars.add(M),M};return M.forgetCache=function(j){return m.delete(j)},M}function lC(x){x.broadcastWatches&&x.broadcastWatches()}var lw=Object.create(null);function hx(x){var m=JSON.stringify(x);return lw[m]||(lw[m]=Object.create(null))}function cw(x){var m=hx(x);return m.keyFieldsFn||(m.keyFieldsFn=function(w,M){var L=function(W,n){return M.readField(n,W)},j=M.keyObject=fx(x,function(W){var n=Tm(M.storeObject,W,L);return n===void 0&&w!==M.storeObject&&Xa.call(w,W[0])&&(n=Tm(w,W,F2)),Ei(n!==void 0,5,W.join("."),w),n});return"".concat(M.typename,":").concat(JSON.stringify(j))})}function uw(x){var m=hx(x);return m.keyArgsFn||(m.keyArgsFn=function(w,M){var L=M.field,j=M.variables,W=M.fieldName,n=fx(x,function(ne){var ge=ne[0],Ie=ge.charAt(0);if(Ie==="@"){if(L&&ql(L.directives)){var Re=ge.slice(1),je=L.directives.find(function($e){return $e.name.value===Re}),Qe=je&&Ly(je,j);return Qe&&Tm(Qe,ne.slice(1))}return}if(Ie==="$"){var tt=ge.slice(1);if(j&&Xa.call(j,tt)){var pt=ne.slice(0);return pt[0]=tt,Tm(j,pt)}return}if(w)return Tm(w,ne)}),ae=JSON.stringify(n);return(w||ae!=="{}")&&(W+=":"+ae),W})}function fx(x,m){var w=new Yf;return k2(x).reduce(function(M,L){var j,W=m(L);if(W!==void 0){for(var n=L.length-1;n>=0;--n)W=(j={},j[L[n]]=W,j);M=w.merge(M,W)}return M},Object.create(null))}function k2(x){var m=hx(x);if(!m.paths){var w=m.paths=[],M=[];x.forEach(function(L,j){ua(L)?(k2(L).forEach(function(W){return w.push(M.concat(W))}),M.length=0):(M.push(L),ua(x[j+1])||(w.push(M.slice(0)),M.length=0))})}return m.paths}function F2(x,m){return x[m]}function Tm(x,m,w){return w=w||F2,B2(m.reduce(function M(L,j){return ua(L)?L.map(function(W){return M(W,j)}):L&&w(L,j)},x))}function B2(x){return ca(x)?ua(x)?x.map(B2):fx(Object.keys(x).sort(),function(m){return Tm(x,m)}):x}function F0(x){return x.args!==void 0?x.args:x.field?Ly(x.field,x.variables):null}var cC=function(){},hw=function(x,m){return m.fieldName},fw=function(x,m,w){var M=w.mergeObjects;return M(x,m)},dw=function(x,m){return m},uC=function(){function x(m){this.config=m,this.typePolicies=Object.create(null),this.toBeAdded=Object.create(null),this.supertypeMap=new Map,this.fuzzySubtypes=new Map,this.rootIdsByTypename=Object.create(null),this.rootTypenamesById=Object.create(null),this.usingPossibleTypes=!1,this.config=ut({dataIdFromObject:I2},m),this.cache=this.config.cache,this.setRootTypename("Query"),this.setRootTypename("Mutation"),this.setRootTypename("Subscription"),m.possibleTypes&&this.addPossibleTypes(m.possibleTypes),m.typePolicies&&this.addTypePolicies(m.typePolicies)}return x.prototype.identify=function(m,w){var M,L=this,j=w&&(w.typename||((M=w.storeObject)===null||M===void 0?void 0:M.__typename))||m.__typename;if(j===this.rootTypenamesById.ROOT_QUERY)return["ROOT_QUERY"];var W=w&&w.storeObject||m,n=ut(ut({},w),{typename:j,storeObject:W,readField:w&&w.readField||function(){var Ie=dx(arguments,W);return L.readField(Ie,{store:L.cache.data,variables:Ie.variables})}}),ae,ne=j&&this.getTypePolicy(j),ge=ne&&ne.keyFn||this.config.dataIdFromObject;return cx.withValue(!0,function(){for(;ge;){var Ie=ge(ut(ut({},m),W),n);if(ua(Ie))ge=cw(Ie);else{ae=Ie;break}}}),ae=ae?String(ae):void 0,n.keyObject?[ae,n.keyObject]:[ae]},x.prototype.addTypePolicies=function(m){var w=this;Object.keys(m).forEach(function(M){var L=m[M],j=L.queryType,W=L.mutationType,n=L.subscriptionType,ae=Ic(L,["queryType","mutationType","subscriptionType"]);j&&w.setRootTypename("Query",M),W&&w.setRootTypename("Mutation",M),n&&w.setRootTypename("Subscription",M),Xa.call(w.toBeAdded,M)?w.toBeAdded[M].push(ae):w.toBeAdded[M]=[ae]})},x.prototype.updateTypePolicy=function(m,w){var M=this,L=this.getTypePolicy(m),j=w.keyFields,W=w.fields;function n(ae,ne){ae.merge=typeof ne=="function"?ne:ne===!0?fw:ne===!1?dw:ae.merge}n(L,w.merge),L.keyFn=j===!1?cC:ua(j)?cw(j):typeof j=="function"?j:L.keyFn,W&&Object.keys(W).forEach(function(ae){var ne=M.getFieldPolicy(m,ae,!0),ge=W[ae];if(typeof ge=="function")ne.read=ge;else{var Ie=ge.keyArgs,Re=ge.read,je=ge.merge;ne.keyFn=Ie===!1?hw:ua(Ie)?uw(Ie):typeof Ie=="function"?Ie:ne.keyFn,typeof Re=="function"&&(ne.read=Re),n(ne,je)}ne.read&&ne.merge&&(ne.keyFn=ne.keyFn||hw)})},x.prototype.setRootTypename=function(m,w){w===void 0&&(w=m);var M="ROOT_"+m.toUpperCase(),L=this.rootTypenamesById[M];w!==L&&(Ei(!L||L===m,6,m),L&&delete this.rootIdsByTypename[L],this.rootIdsByTypename[w]=M,this.rootTypenamesById[M]=w)},x.prototype.addPossibleTypes=function(m){var w=this;this.usingPossibleTypes=!0,Object.keys(m).forEach(function(M){w.getSupertypeSet(M,!0),m[M].forEach(function(L){w.getSupertypeSet(L,!0).add(M);var j=L.match(O2);(!j||j[0]!==L)&&w.fuzzySubtypes.set(L,new RegExp(L))})})},x.prototype.getTypePolicy=function(m){var w=this;if(!Xa.call(this.typePolicies,m)){var M=this.typePolicies[m]=Object.create(null);M.fields=Object.create(null);var L=this.supertypeMap.get(m);!L&&this.fuzzySubtypes.size&&(L=this.getSupertypeSet(m,!0),this.fuzzySubtypes.forEach(function(W,n){if(W.test(m)){var ae=w.supertypeMap.get(n);ae&&ae.forEach(function(ne){return L.add(ne)})}})),L&&L.size&&L.forEach(function(W){var n=w.getTypePolicy(W),ae=n.fields,ne=Ic(n,["fields"]);Object.assign(M,ne),Object.assign(M.fields,ae)})}var j=this.toBeAdded[m];return j&&j.length&&j.splice(0).forEach(function(W){w.updateTypePolicy(m,W)}),this.typePolicies[m]},x.prototype.getFieldPolicy=function(m,w,M){if(m){var L=this.getTypePolicy(m).fields;return L[w]||M&&(L[w]=Object.create(null))}},x.prototype.getSupertypeSet=function(m,w){var M=this.supertypeMap.get(m);return!M&&w&&this.supertypeMap.set(m,M=new Set),M},x.prototype.fragmentMatches=function(m,w,M,L){var j=this;if(!m.typeCondition)return!0;if(!w)return!1;var W=m.typeCondition.name.value;if(w===W)return!0;if(this.usingPossibleTypes&&this.supertypeMap.has(W))for(var n=this.getSupertypeSet(w,!0),ae=[n],ne=function(Qe){var tt=j.getSupertypeSet(Qe,!1);tt&&tt.size&&ae.indexOf(tt)<0&&ae.push(tt)},ge=!!(M&&this.fuzzySubtypes.size),Ie=!1,Re=0;Re<ae.length;++Re){var je=ae[Re];if(je.has(W))return n.has(W)||(Ie&&globalThis.__DEV__!==!1&&Ei.warn(7,w,W),n.add(W)),!0;je.forEach(ne),ge&&Re===ae.length-1&&k0(m.selectionSet,M,L)&&(ge=!1,Ie=!0,this.fuzzySubtypes.forEach(function(Qe,tt){var pt=w.match(Qe);pt&&pt[0]===w&&ne(tt)}))}return!1},x.prototype.hasKeyArgs=function(m,w){var M=this.getFieldPolicy(m,w,!1);return!!(M&&M.keyFn)},x.prototype.getStoreFieldName=function(m){var w=m.typename,M=m.fieldName,L=this.getFieldPolicy(w,M,!1),j,W=L&&L.keyFn;if(W&&w)for(var n={typename:w,fieldName:M,field:m.field||null,variables:m.variables},ae=F0(m);W;){var ne=W(ae,n);if(ua(ne))W=uw(ne);else{j=ne||M;break}}return j===void 0&&(j=m.field?DM(m.field,m.variables):Ww(M,F0(m))),j===!1?M:M===Wf(j)?j:M+":"+j},x.prototype.readField=function(m,w){var M=m.from;if(M){var L=m.field||m.fieldName;if(L){if(m.typename===void 0){var j=w.store.getFieldValue(M,"__typename");j&&(m.typename=j)}var W=this.getStoreFieldName(m),n=Wf(W),ae=w.store.getFieldValue(M,W),ne=this.getFieldPolicy(m.typename,n,!1),ge=ne&&ne.read;if(ge){var Ie=pw(this,M,m,w,w.store.getStorage(rn(M)?M.__ref:M,W));return ux.withValue(this.cache,ge,[ae,Ie])}return ae}}},x.prototype.getReadFunction=function(m,w){var M=this.getFieldPolicy(m,w,!1);return M&&M.read},x.prototype.getMergeFunction=function(m,w,M){var L=this.getFieldPolicy(m,w,!1),j=L&&L.merge;return!j&&M&&(L=this.getTypePolicy(M),j=L&&L.merge),j},x.prototype.runMergeFunction=function(m,w,M,L,j){var W=M.field,n=M.typename,ae=M.merge;return ae===fw?N2(L.store)(m,w):ae===dw?w:(L.overwrite&&(m=void 0),ae(m,w,pw(this,void 0,{typename:n,fieldName:W.name.value,field:W,variables:L.variables},L,j||Object.create(null))))},x}();function pw(x,m,w,M,L){var j=x.getStoreFieldName(w),W=Wf(j),n=w.variables||M.variables,ae=M.store,ne=ae.toReference,ge=ae.canRead;return{args:F0(w),field:w.field||null,fieldName:W,storeFieldName:j,variables:n,isReference:rn,toReference:ne,storage:L,cache:x.cache,canRead:ge,readField:function(){return x.readField(dx(arguments,m,n),M)},mergeObjects:N2(M.store)}}function dx(x,m,w){var M=x[0],L=x[1],j=x.length,W;return typeof M=="string"?W={fieldName:M,from:j>1?L:m}:(W=ut({},M),Xa.call(W,"from")||(W.from=m)),globalThis.__DEV__!==!1&&W.from===void 0&&globalThis.__DEV__!==!1&&Ei.warn(8,zw(Array.from(x))),W.variables===void 0&&(W.variables=w),W}function N2(x){return function(w,M){if(ua(w)||ua(M))throw eo(9);if(ca(w)&&ca(M)){var L=x.getFieldValue(w,"__typename"),j=x.getFieldValue(M,"__typename"),W=L&&j&&L!==j;if(W)return M;if(rn(w)&&vm(M))return x.merge(w.__ref,M),w;if(vm(w)&&rn(M))return x.merge(w,M.__ref),M;if(vm(w)&&vm(M))return ut(ut({},w),M)}return M}}function h0(x,m,w){var M="".concat(m).concat(w),L=x.flavors.get(M);return L||x.flavors.set(M,L=x.clientOnly===m&&x.deferred===w?x:ut(ut({},x),{clientOnly:m,deferred:w})),L}var hC=function(){function x(m,w,M){this.cache=m,this.reader=w,this.fragments=M}return x.prototype.writeToStore=function(m,w){var M=this,L=w.query,j=w.result,W=w.dataId,n=w.variables,ae=w.overwrite,ne=op(L),ge=JA();n=ut(ut({},J0(ne)),n);var Ie=ut(ut({store:m,written:Object.create(null),merge:function(je,Qe){return ge.merge(je,Qe)},variables:n,varString:Hf(n)},L2(L,this.fragments)),{overwrite:!!ae,incomingById:new Map,clientOnly:!1,deferred:!1,flavors:new Map}),Re=this.processSelectionSet({result:j||Object.create(null),dataId:W,selectionSet:ne.selectionSet,mergeTree:{map:new Map},context:Ie});if(!rn(Re))throw eo(12,j);return Ie.incomingById.forEach(function(je,Qe){var tt=je.storeObject,pt=je.mergeTree,$e=je.fieldNodeSet,Et=bm(Qe);if(pt&&pt.map.size){var Tt=M.applyMerges(pt,Et,tt,Ie);if(rn(Tt))return;tt=Tt}if(globalThis.__DEV__!==!1&&!Ie.overwrite){var Mt=Object.create(null);$e.forEach(function(qt){qt.selectionSet&&(Mt[qt.name.value]=!0)});var Ft=function(qt){return Mt[Wf(qt)]===!0},ni=function(qt){var Fi=pt&&pt.map.get(qt);return!!(Fi&&Fi.info&&Fi.info.merge)};Object.keys(tt).forEach(function(qt){Ft(qt)&&!ni(qt)&&fC(Et,tt,qt,Ie.store)})}m.merge(Qe,tt)}),m.retain(Re.__ref),Re},x.prototype.processSelectionSet=function(m){var w=this,M=m.dataId,L=m.result,j=m.selectionSet,W=m.context,n=m.mergeTree,ae=this.cache.policies,ne=Object.create(null),ge=M&&ae.rootTypenamesById[M]||A0(L,j,W.fragmentMap)||M&&W.store.get(M,"__typename");typeof ge=="string"&&(ne.__typename=ge);var Ie=function(){var Tt=dx(arguments,ne,W.variables);if(rn(Tt.from)){var Mt=W.incomingById.get(Tt.from.__ref);if(Mt){var Ft=ae.readField(ut(ut({},Tt),{from:Mt.storeObject}),W);if(Ft!==void 0)return Ft}}return ae.readField(Tt,W)},Re=new Set;this.flattenFields(j,L,W,ge).forEach(function(Tt,Mt){var Ft,ni=Fh(Mt),qt=L[ni];if(Re.add(Mt),qt!==void 0){var Fi=ae.getStoreFieldName({typename:ge,fieldName:Mt.name.value,field:Mt,variables:Tt.variables}),ai=mw(n,Fi),kt=w.processFieldValue(qt,Mt,Mt.selectionSet?h0(Tt,!1,!1):Tt,ai),li=void 0;Mt.selectionSet&&(rn(kt)||vm(kt))&&(li=Ie("__typename",kt));var bn=ae.getMergeFunction(ge,Mt.name.value,li);bn?ai.info={field:Mt,typename:ge,merge:bn}:_w(n,Fi),ne=Tt.merge(ne,(Ft={},Ft[Fi]=kt,Ft))}else globalThis.__DEV__!==!1&&!Tt.clientOnly&&!Tt.deferred&&!rx.added(Mt)&&!ae.getReadFunction(ge,Mt.name.value)&&globalThis.__DEV__!==!1&&Ei.error(13,Fh(Mt),L)});try{var je=ae.identify(L,{typename:ge,selectionSet:j,fragmentMap:W.fragmentMap,storeObject:ne,readField:Ie}),Qe=je[0],tt=je[1];M=M||Qe,tt&&(ne=W.merge(ne,tt))}catch(Tt){if(!M)throw Tt}if(typeof M=="string"){var pt=bm(M),$e=W.written[M]||(W.written[M]=[]);if($e.indexOf(j)>=0||($e.push(j),this.reader&&this.reader.isFresh(L,pt,j,W)))return pt;var Et=W.incomingById.get(M);return Et?(Et.storeObject=W.merge(Et.storeObject,ne),Et.mergeTree=B0(Et.mergeTree,n),Re.forEach(function(Tt){return Et.fieldNodeSet.add(Tt)})):W.incomingById.set(M,{storeObject:ne,mergeTree:Ey(n)?void 0:n,fieldNodeSet:Re}),pt}return ne},x.prototype.processFieldValue=function(m,w,M,L){var j=this;return!w.selectionSet||m===null?globalThis.__DEV__!==!1?_2(m):m:ua(m)?m.map(function(W,n){var ae=j.processFieldValue(W,w,M,mw(L,n));return _w(L,n),ae}):this.processSelectionSet({result:m,selectionSet:w.selectionSet,context:M,mergeTree:L})},x.prototype.flattenFields=function(m,w,M,L){L===void 0&&(L=A0(w,m,M.fragmentMap));var j=new Map,W=this.cache.policies,n=new Bh(!1);return function ae(ne,ge){var Ie=n.lookup(ne,ge.clientOnly,ge.deferred);Ie.visited||(Ie.visited=!0,ne.selections.forEach(function(Re){if(ig(Re,M.variables)){var je=ge.clientOnly,Qe=ge.deferred;if(!(je&&Qe)&&ql(Re.directives)&&Re.directives.forEach(function($e){var Et=$e.name.value;if(Et==="client"&&(je=!0),Et==="defer"){var Tt=Ly($e,M.variables);(!Tt||Tt.if!==!1)&&(Qe=!0)}}),Zf(Re)){var tt=j.get(Re);tt&&(je=je&&tt.clientOnly,Qe=Qe&&tt.deferred),j.set(Re,h0(M,je,Qe))}else{var pt=Oy(Re,M.lookupFragment);if(!pt&&Re.kind===Si.FRAGMENT_SPREAD)throw eo(14,Re.name.value);pt&&W.fragmentMatches(pt,L,w,M.variables)&&ae(pt.selectionSet,h0(M,je,Qe))}}}))}(m,M),j},x.prototype.applyMerges=function(m,w,M,L,j){var W,n=this;if(m.map.size&&!rn(M)){var ae=!ua(M)&&(rn(w)||vm(w))?w:void 0,ne=M;ae&&!j&&(j=[rn(ae)?ae.__ref:ae]);var ge,Ie=function(Re,je){return ua(Re)?typeof je=="number"?Re[je]:void 0:L.store.getFieldValue(Re,String(je))};m.map.forEach(function(Re,je){var Qe=Ie(ae,je),tt=Ie(ne,je);if(tt!==void 0){j&&j.push(je);var pt=n.applyMerges(Re,Qe,tt,L,j);pt!==tt&&(ge=ge||new Map,ge.set(je,pt)),j&&Ei(j.pop()===je)}}),ge&&(M=ua(ne)?ne.slice(0):ut({},ne),ge.forEach(function(Re,je){M[je]=Re}))}return m.info?this.cache.policies.runMergeFunction(w,M,m.info,L,j&&(W=L.store).getStorage.apply(W,j)):M},x}(),V2=[];function mw(x,m){var w=x.map;return w.has(m)||w.set(m,V2.pop()||{map:new Map}),w.get(m)}function B0(x,m){if(x===m||!m||Ey(m))return x;if(!x||Ey(x))return m;var w=x.info&&m.info?ut(ut({},x.info),m.info):x.info||m.info,M=x.map.size&&m.map.size,L=M?new Map:x.map.size?x.map:m.map,j={info:w,map:L};if(M){var W=new Set(m.map.keys());x.map.forEach(function(n,ae){j.map.set(ae,B0(n,m.map.get(ae))),W.delete(ae)}),W.forEach(function(n){j.map.set(n,B0(m.map.get(n),x.map.get(n)))})}return j}function Ey(x){return!x||!(x.info||x.map.size)}function _w(x,m){var w=x.map,M=w.get(m);M&&Ey(M)&&(V2.push(M),w.delete(m))}var gw=new Set;function fC(x,m,w,M){var L=function(Ie){var Re=M.getFieldValue(Ie,w);return typeof Re=="object"&&Re},j=L(x);if(j){var W=L(m);if(W&&!rn(j)&&!cn(j,W)&&!Object.keys(j).every(function(Ie){return M.getFieldValue(W,Ie)!==void 0})){var n=M.getFieldValue(x,"__typename")||M.getFieldValue(m,"__typename"),ae=Wf(w),ne="".concat(n,".").concat(ae);if(!gw.has(ne)){gw.add(ne);var ge=[];!ua(j)&&!ua(W)&&[j,W].forEach(function(Ie){var Re=M.getFieldValue(Ie,"__typename");typeof Re=="string"&&!ge.includes(Re)&&ge.push(Re)}),globalThis.__DEV__!==!1&&Ei.warn(15,ae,n,ge.length?"either ensure all objects of type "+ge.join(" and ")+" have an ID or a custom merge function, or ":"",ne,ut({},j),ut({},W))}}}}var U2=function(x){Ru(m,x);function m(w){w===void 0&&(w={});var M=x.call(this)||this;return M.watches=new Set,M.addTypenameTransform=new c2(rx),M.assumeImmutableResults=!0,M.makeVar=oC,M.txCount=0,M.config=QA(w),M.addTypename=!!M.config.addTypename,M.policies=new uC({cache:M,dataIdFromObject:M.config.dataIdFromObject,possibleTypes:M.config.possibleTypes,typePolicies:M.config.typePolicies}),M.init(),M}return m.prototype.init=function(){var w=this.data=new tg.Root({policies:this.policies,resultCaching:this.config.resultCaching});this.optimisticData=w.stump,this.resetResultCache()},m.prototype.resetResultCache=function(w){var M=this,L=this.storeReader,j=this.config.fragments;this.storeWriter=new hC(this,this.storeReader=new rC({cache:this,addTypename:this.addTypename,resultCacheMaxSize:this.config.resultCacheMaxSize,canonizeResults:z2(this.config),canon:w?void 0:L&&L.canon,fragments:j}),j),this.maybeBroadcastWatch=eg(function(W,n){return M.broadcastWatch(W,n)},{max:this.config.resultCacheMaxSize||Iu["inMemoryCache.maybeBroadcastWatch"]||5e3,makeCacheKey:function(W){var n=W.optimistic?M.optimisticData:M.data;if(W_(n)){var ae=W.optimistic,ne=W.id,ge=W.variables;return n.makeCacheKey(W.query,W.callback,Hf({optimistic:ae,id:ne,variables:ge}))}}}),new Set([this.data.group,this.optimisticData.group]).forEach(function(W){return W.resetCaching()})},m.prototype.restore=function(w){return this.init(),w&&this.data.replace(w),this},m.prototype.extract=function(w){return w===void 0&&(w=!1),(w?this.optimisticData:this.data).extract()},m.prototype.read=function(w){var M=w.returnPartialData,L=M===void 0?!1:M;try{return this.storeReader.diffQueryAgainstStore(ut(ut({},w),{store:w.optimistic?this.optimisticData:this.data,config:this.config,returnPartialData:L})).result||null}catch(j){if(j instanceof D2)return null;throw j}},m.prototype.write=function(w){try{return++this.txCount,this.storeWriter.writeToStore(this.data,w)}finally{!--this.txCount&&w.broadcast!==!1&&this.broadcastWatches()}},m.prototype.modify=function(w){if(Xa.call(w,"id")&&!w.id)return!1;var M=w.optimistic?this.optimisticData:this.data;try{return++this.txCount,M.modify(w.id||"ROOT_QUERY",w.fields)}finally{!--this.txCount&&w.broadcast!==!1&&this.broadcastWatches()}},m.prototype.diff=function(w){return this.storeReader.diffQueryAgainstStore(ut(ut({},w),{store:w.optimistic?this.optimisticData:this.data,rootId:w.id||"ROOT_QUERY",config:this.config}))},m.prototype.watch=function(w){var M=this;return this.watches.size||sC(this),this.watches.add(w),w.immediate&&this.maybeBroadcastWatch(w),function(){M.watches.delete(w)&&!M.watches.size&&ow(M),M.maybeBroadcastWatch.forget(w)}},m.prototype.gc=function(w){var M;Hf.reset(),np.reset(),this.addTypenameTransform.resetCache(),(M=this.config.fragments)===null||M===void 0||M.resetCaches();var L=this.optimisticData.gc();return w&&!this.txCount&&(w.resetResultCache?this.resetResultCache(w.resetResultIdentities):w.resetResultIdentities&&this.storeReader.resetCanon()),L},m.prototype.retain=function(w,M){return(M?this.optimisticData:this.data).retain(w)},m.prototype.release=function(w,M){return(M?this.optimisticData:this.data).release(w)},m.prototype.identify=function(w){if(rn(w))return w.__ref;try{return this.policies.identify(w)[0]}catch(M){globalThis.__DEV__!==!1&&Ei.warn(M)}},m.prototype.evict=function(w){if(!w.id){if(Xa.call(w,"id"))return!1;w=ut(ut({},w),{id:"ROOT_QUERY"})}try{return++this.txCount,this.optimisticData.evict(w,this.data)}finally{!--this.txCount&&w.broadcast!==!1&&this.broadcastWatches()}},m.prototype.reset=function(w){var M=this;return this.init(),Hf.reset(),w&&w.discardWatches?(this.watches.forEach(function(L){return M.maybeBroadcastWatch.forget(L)}),this.watches.clear(),ow(this)):this.broadcastWatches(),Promise.resolve()},m.prototype.removeOptimistic=function(w){var M=this.optimisticData.removeLayer(w);M!==this.optimisticData&&(this.optimisticData=M,this.broadcastWatches())},m.prototype.batch=function(w){var M=this,L=w.update,j=w.optimistic,W=j===void 0?!0:j,n=w.removeOptimistic,ae=w.onWatchUpdated,ne,ge=function(Re){var je=M,Qe=je.data,tt=je.optimisticData;++M.txCount,Re&&(M.data=M.optimisticData=Re);try{return ne=L(M)}finally{--M.txCount,M.data=Qe,M.optimisticData=tt}},Ie=new Set;return ae&&!this.txCount&&this.broadcastWatches(ut(ut({},w),{onWatchUpdated:function(Re){return Ie.add(Re),!1}})),typeof W=="string"?this.optimisticData=this.optimisticData.addLayer(W,ge):W===!1?ge(this.data):ge(),typeof n=="string"&&(this.optimisticData=this.optimisticData.removeLayer(n)),ae&&Ie.size?(this.broadcastWatches(ut(ut({},w),{onWatchUpdated:function(Re,je){var Qe=ae.call(this,Re,je);return Qe!==!1&&Ie.delete(Re),Qe}})),Ie.size&&Ie.forEach(function(Re){return M.maybeBroadcastWatch.dirty(Re)})):this.broadcastWatches(w),ne},m.prototype.performTransaction=function(w,M){return this.batch({update:w,optimistic:M||M!==null})},m.prototype.transformDocument=function(w){return this.addTypenameToDocument(this.addFragmentsToDocument(w))},m.prototype.fragmentMatches=function(w,M){return this.policies.fragmentMatches(w,M)},m.prototype.lookupFragment=function(w){var M;return((M=this.config.fragments)===null||M===void 0?void 0:M.lookup(w))||null},m.prototype.broadcastWatches=function(w){var M=this;this.txCount||this.watches.forEach(function(L){return M.maybeBroadcastWatch(L,w)})},m.prototype.addFragmentsToDocument=function(w){var M=this.config.fragments;return M?M.transform(w):w},m.prototype.addTypenameToDocument=function(w){return this.addTypename?this.addTypenameTransform.transformDocument(w):w},m.prototype.broadcastWatch=function(w,M){var L=w.lastDiff,j=this.diff(w);M&&(w.optimistic&&typeof M.optimistic=="string"&&(j.fromOptimisticTransaction=!0),M.onWatchUpdated&&M.onWatchUpdated.call(this,w,j,L)===!1)||(!L||!cn(L.result,j.result))&&w.callback(w.lastDiff=j,L)},m}(C2);globalThis.__DEV__!==!1&&(U2.prototype.getMemoryInternals=hM);var Vr;(function(x){x[x.loading=1]="loading",x[x.setVariables=2]="setVariables",x[x.fetchMore=3]="fetchMore",x[x.refetch=4]="refetch",x[x.poll=6]="poll",x[x.ready=7]="ready",x[x.error=8]="error"})(Vr||(Vr={}));function Sm(x){return x?x<7:!1}var yw=Object.assign,dC=Object.hasOwnProperty,N0=function(x){Ru(m,x);function m(w){var M=w.queryManager,L=w.queryInfo,j=w.options,W=x.call(this,function(pt){try{var $e=pt._subscription._observer;$e&&!$e.error&&($e.error=pC)}catch{}var Et=!W.observers.size;W.observers.add(pt);var Tt=W.last;return Tt&&Tt.error?pt.error&&pt.error(Tt.error):Tt&&Tt.result&&pt.next&&pt.next(W.maskResult(Tt.result)),Et&&W.reobserve().catch(function(){}),function(){W.observers.delete(pt)&&!W.observers.size&&W.tearDownQuery()}})||this;W.observers=new Set,W.subscriptions=new Set,W.queryInfo=L,W.queryManager=M,W.waitForOwnResult=f0(j.fetchPolicy),W.isTornDown=!1,W.subscribeToMore=W.subscribeToMore.bind(W),W.maskResult=W.maskResult.bind(W);var n=M.defaultOptions.watchQuery,ae=n===void 0?{}:n,ne=ae.fetchPolicy,ge=ne===void 0?"cache-first":ne,Ie=j.fetchPolicy,Re=Ie===void 0?ge:Ie,je=j.initialFetchPolicy,Qe=je===void 0?Re==="standby"?ge:Re:je;W.options=ut(ut({},j),{initialFetchPolicy:Qe,fetchPolicy:Re}),W.queryId=L.queryId||M.generateQueryId();var tt=op(W.query);return W.queryName=tt&&tt.name&&tt.name.value,W}return Object.defineProperty(m.prototype,"query",{get:function(){return this.lastQuery||this.options.query},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"variables",{get:function(){return this.options.variables},enumerable:!1,configurable:!0}),m.prototype.result=function(){var w=this;return new Promise(function(M,L){var j={next:function(n){M(n),w.observers.delete(j),w.observers.size||w.queryManager.removeQuery(w.queryId),setTimeout(function(){W.unsubscribe()},0)},error:L},W=w.subscribe(j)})},m.prototype.resetDiff=function(){this.queryInfo.resetDiff()},m.prototype.getCurrentFullResult=function(w){w===void 0&&(w=!0);var M=this.getLastResult(!0),L=this.queryInfo.networkStatus||M&&M.networkStatus||Vr.ready,j=ut(ut({},M),{loading:Sm(L),networkStatus:L}),W=this.options.fetchPolicy,n=W===void 0?"cache-first":W;if(!(f0(n)||this.queryManager.getDocumentInfo(this.query).hasForcedResolvers))if(this.waitForOwnResult)this.queryInfo.updateWatch();else{var ae=this.queryInfo.getDiff();(ae.complete||this.options.returnPartialData)&&(j.data=ae.result),cn(j.data,{})&&(j.data=void 0),ae.complete?(delete j.partial,ae.complete&&j.networkStatus===Vr.loading&&(n==="cache-first"||n==="cache-only")&&(j.networkStatus=Vr.ready,j.loading=!1)):j.partial=!0,j.networkStatus===Vr.ready&&(j.error||j.errors)&&(j.networkStatus=Vr.error),globalThis.__DEV__!==!1&&!ae.complete&&!this.options.partialRefetch&&!j.loading&&!j.data&&!j.error&&q2(ae.missing)}return w&&this.updateLastResult(j),j},m.prototype.getCurrentResult=function(w){return w===void 0&&(w=!0),this.maskResult(this.getCurrentFullResult(w))},m.prototype.isDifferentFromLastResult=function(w,M){if(!this.last)return!0;var L=this.queryManager.getDocumentInfo(this.query),j=this.queryManager.dataMasking,W=j?L.nonReactiveQuery:this.query,n=j||L.hasNonreactiveDirective?!w2(W,this.last.result,w,this.variables):!cn(this.last.result,w);return n||M&&!cn(this.last.variables,M)},m.prototype.getLast=function(w,M){var L=this.last;if(L&&L[w]&&(!M||cn(L.variables,this.variables)))return L[w]},m.prototype.getLastResult=function(w){return this.getLast("result",w)},m.prototype.getLastError=function(w){return this.getLast("error",w)},m.prototype.resetLastResults=function(){delete this.last,this.isTornDown=!1},m.prototype.resetQueryStoreErrors=function(){this.queryManager.resetErrors(this.queryId)},m.prototype.refetch=function(w){var M,L={pollInterval:0},j=this.options.fetchPolicy;if(j==="no-cache"?L.fetchPolicy="no-cache":L.fetchPolicy="network-only",globalThis.__DEV__!==!1&&w&&dC.call(w,"variables")){var W=$w(this.query),n=W.variableDefinitions;(!n||!n.some(function(ae){return ae.variable.name.value==="variables"}))&&globalThis.__DEV__!==!1&&Ei.warn(21,w,((M=W.name)===null||M===void 0?void 0:M.value)||W)}return w&&!cn(this.options.variables,w)&&(L.variables=this.options.variables=ut(ut({},this.options.variables),w)),this.queryInfo.resetLastWrite(),this.reobserve(L,Vr.refetch)},m.prototype.fetchMore=function(w){var M=this,L=ut(ut({},w.query?w:ut(ut(ut(ut({},this.options),{query:this.options.query}),w),{variables:ut(ut({},this.options.variables),w.variables)})),{fetchPolicy:"no-cache"});L.query=this.transformDocument(L.query);var j=this.queryManager.generateQueryId();this.lastQuery=w.query?this.transformDocument(this.options.query):L.query;var W=this.queryInfo,n=W.networkStatus;W.networkStatus=Vr.fetchMore,L.notifyOnNetworkStatusChange&&this.observe();var ae=new Set,ne=w==null?void 0:w.updateQuery,ge=this.options.fetchPolicy!=="no-cache";return ge||Ei(ne,22),this.queryManager.fetchQuery(j,L,Vr.fetchMore).then(function(Ie){if(M.queryManager.removeQuery(j),W.networkStatus===Vr.fetchMore&&(W.networkStatus=n),ge)M.queryManager.cache.batch({update:function(Qe){var tt=w.updateQuery;tt?Qe.updateQuery({query:M.query,variables:M.variables,returnPartialData:!0,optimistic:!1},function(pt){return tt(pt,{fetchMoreResult:Ie.data,variables:L.variables})}):Qe.writeQuery({query:L.query,variables:L.variables,data:Ie.data})},onWatchUpdated:function(Qe){ae.add(Qe.query)}});else{var Re=M.getLast("result"),je=ne(Re.data,{fetchMoreResult:Ie.data,variables:L.variables});M.reportResult(ut(ut({},Re),{networkStatus:n,loading:Sm(n),data:je}),M.variables)}return M.maskResult(Ie)}).finally(function(){ge&&!ae.has(M.query)&&j2(M)})},m.prototype.subscribeToMore=function(w){var M=this,L=this.queryManager.startGraphQLSubscription({query:w.document,variables:w.variables,context:w.context}).subscribe({next:function(j){var W=w.updateQuery;W&&M.updateQuery(function(n,ae){return W(n,ut({subscriptionData:j},ae))})},error:function(j){if(w.onError){w.onError(j);return}globalThis.__DEV__!==!1&&Ei.error(23,j)}});return this.subscriptions.add(L),function(){M.subscriptions.delete(L)&&L.unsubscribe()}},m.prototype.setOptions=function(w){return this.reobserve(w)},m.prototype.silentSetOptions=function(w){var M=lp(this.options,w||{});yw(this.options,M)},m.prototype.setVariables=function(w){return cn(this.variables,w)?this.observers.size?this.result():Promise.resolve():(this.options.variables=w,this.observers.size?this.reobserve({fetchPolicy:this.options.initialFetchPolicy,variables:w},Vr.setVariables):Promise.resolve())},m.prototype.updateQuery=function(w){var M=this.queryManager,L=M.cache.diff({query:this.options.query,variables:this.variables,returnPartialData:!0,optimistic:!1}),j=L.result,W=L.complete,n=w(j,{variables:this.variables,complete:!!W,previousData:j});n&&(M.cache.writeQuery({query:this.options.query,data:n,variables:this.variables}),M.broadcastQueries())},m.prototype.startPolling=function(w){this.options.pollInterval=w,this.updatePolling()},m.prototype.stopPolling=function(){this.options.pollInterval=0,this.updatePolling()},m.prototype.applyNextFetchPolicy=function(w,M){if(M.nextFetchPolicy){var L=M.fetchPolicy,j=L===void 0?"cache-first":L,W=M.initialFetchPolicy,n=W===void 0?j:W;j==="standby"||(typeof M.nextFetchPolicy=="function"?M.fetchPolicy=M.nextFetchPolicy(j,{reason:w,options:M,observable:this,initialFetchPolicy:n}):w==="variables-changed"?M.fetchPolicy=n:M.fetchPolicy=M.nextFetchPolicy)}return M.fetchPolicy},m.prototype.fetch=function(w,M,L){return this.queryManager.setObservableQuery(this),this.queryManager.fetchConcastWithInfo(this.queryId,w,M,L)},m.prototype.updatePolling=function(){var w=this;if(!this.queryManager.ssrMode){var M=this,L=M.pollingInfo,j=M.options.pollInterval;if(!j||!this.hasObservers()){L&&(clearTimeout(L.timeout),delete this.pollingInfo);return}if(!(L&&L.interval===j)){Ei(j,24);var W=L||(this.pollingInfo={});W.interval=j;var n=function(){var ne,ge;w.pollingInfo&&(!Sm(w.queryInfo.networkStatus)&&!(!((ge=(ne=w.options).skipPollAttempt)===null||ge===void 0)&&ge.call(ne))?w.reobserve({fetchPolicy:w.options.initialFetchPolicy==="no-cache"?"no-cache":"network-only"},Vr.poll).then(ae,ae):ae())},ae=function(){var ne=w.pollingInfo;ne&&(clearTimeout(ne.timeout),ne.timeout=setTimeout(n,ne.interval))};ae()}}},m.prototype.updateLastResult=function(w,M){M===void 0&&(M=this.variables);var L=this.getLastError();return L&&this.last&&!cn(M,this.last.variables)&&(L=void 0),this.last=ut({result:this.queryManager.assumeImmutableResults?w:_2(w),variables:M},L?{error:L}:null)},m.prototype.reobserveAsConcast=function(w,M){var L=this;this.isTornDown=!1;var j=M===Vr.refetch||M===Vr.fetchMore||M===Vr.poll,W=this.options.variables,n=this.options.fetchPolicy,ae=lp(this.options,w||{}),ne=j?ae:yw(this.options,ae),ge=this.transformDocument(ne.query);this.lastQuery=ge,j||(this.updatePolling(),w&&w.variables&&!cn(w.variables,W)&&ne.fetchPolicy!=="standby"&&(ne.fetchPolicy===n||typeof ne.nextFetchPolicy=="function")&&(this.applyNextFetchPolicy("variables-changed",ne),M===void 0&&(M=Vr.setVariables))),this.waitForOwnResult&&(this.waitForOwnResult=f0(ne.fetchPolicy));var Ie=function(){L.concast===Qe&&(L.waitForOwnResult=!1)},Re=ne.variables&&ut({},ne.variables),je=this.fetch(ne,M,ge),Qe=je.concast,tt=je.fromLink,pt={next:function($e){cn(L.variables,Re)&&(Ie(),L.reportResult($e,Re))},error:function($e){cn(L.variables,Re)&&(x2($e)||($e=new Ph({networkError:$e})),Ie(),L.reportError($e,Re))}};return!j&&(tt||!this.concast)&&(this.concast&&this.observer&&this.concast.removeObserver(this.observer),this.concast=Qe,this.observer=pt),Qe.addObserver(pt),Qe},m.prototype.reobserve=function(w,M){return nA(this.reobserveAsConcast(w,M).promise.then(this.maskResult))},m.prototype.resubscribeAfterError=function(){for(var w=[],M=0;M<arguments.length;M++)w[M]=arguments[M];var L=this.last;this.resetLastResults();var j=this.subscribe.apply(this,w);return this.last=L,j},m.prototype.observe=function(){this.reportResult(this.getCurrentFullResult(!1),this.variables)},m.prototype.reportResult=function(w,M){var L=this.getLastError(),j=this.isDifferentFromLastResult(w,M);(L||!w.partial||this.options.returnPartialData)&&this.updateLastResult(w,M),(L||j)&&Y_(this.observers,"next",this.maskResult(w))},m.prototype.reportError=function(w,M){var L=ut(ut({},this.getLastResult()),{error:w,errors:w.graphQLErrors,networkStatus:Vr.error,loading:!1});this.updateLastResult(L,M),Y_(this.observers,"error",this.last.error=w)},m.prototype.hasObservers=function(){return this.observers.size>0},m.prototype.tearDownQuery=function(){this.isTornDown||(this.concast&&this.observer&&(this.concast.removeObserver(this.observer),delete this.concast,delete this.observer),this.stopPolling(),this.subscriptions.forEach(function(w){return w.unsubscribe()}),this.subscriptions.clear(),this.queryManager.stopQuery(this.queryId),this.observers.clear(),this.isTornDown=!0)},m.prototype.transformDocument=function(w){return this.queryManager.transform(w)},m.prototype.maskResult=function(w){return w&&"data"in w?ut(ut({},w),{data:this.queryManager.maskOperation({document:this.query,data:w.data,fetchPolicy:this.options.fetchPolicy,id:this.queryId})}):w},m}(xn);g2(N0);function j2(x){var m=x.options,w=m.fetchPolicy,M=m.nextFetchPolicy;return w==="cache-and-network"||w==="network-only"?x.reobserve({fetchPolicy:"cache-first",nextFetchPolicy:function(L,j){return this.nextFetchPolicy=M,typeof this.nextFetchPolicy=="function"?this.nextFetchPolicy(L,j):w}}):x.reobserve()}function pC(x){globalThis.__DEV__!==!1&&Ei.error(25,x.message,x.stack)}function q2(x){globalThis.__DEV__!==!1&&x&&globalThis.__DEV__!==!1&&Ei.debug(26,x)}function f0(x){return x==="network-only"||x==="no-cache"||x==="standby"}var xm=new(cp?WeakMap:Map);function d0(x,m){var w=x[m];typeof w=="function"&&(x[m]=function(){return xm.set(x,(xm.get(x)+1)%1e15),w.apply(this,arguments)})}function vw(x){x.notifyTimeout&&(clearTimeout(x.notifyTimeout),x.notifyTimeout=void 0)}var p0=function(){function x(m,w){w===void 0&&(w=m.generateQueryId()),this.queryId=w,this.listeners=new Set,this.document=null,this.lastRequestId=1,this.stopped=!1,this.dirty=!1,this.observableQuery=null;var M=this.cache=m.cache;xm.has(M)||(xm.set(M,0),d0(M,"evict"),d0(M,"modify"),d0(M,"reset"))}return x.prototype.init=function(m){var w=m.networkStatus||Vr.loading;return this.variables&&this.networkStatus!==Vr.loading&&!cn(this.variables,m.variables)&&(w=Vr.setVariables),cn(m.variables,this.variables)||(this.lastDiff=void 0),Object.assign(this,{document:m.document,variables:m.variables,networkError:null,graphQLErrors:this.graphQLErrors||[],networkStatus:w}),m.observableQuery&&this.setObservableQuery(m.observableQuery),m.lastRequestId&&(this.lastRequestId=m.lastRequestId),this},x.prototype.reset=function(){vw(this),this.dirty=!1},x.prototype.resetDiff=function(){this.lastDiff=void 0},x.prototype.getDiff=function(){var m=this.getDiffOptions();if(this.lastDiff&&cn(m,this.lastDiff.options))return this.lastDiff.diff;this.updateWatch(this.variables);var w=this.observableQuery;if(w&&w.options.fetchPolicy==="no-cache")return{complete:!1};var M=this.cache.diff(m);return this.updateLastDiff(M,m),M},x.prototype.updateLastDiff=function(m,w){this.lastDiff=m?{diff:m,options:w||this.getDiffOptions()}:void 0},x.prototype.getDiffOptions=function(m){var w;return m===void 0&&(m=this.variables),{query:this.document,variables:m,returnPartialData:!0,optimistic:!0,canonizeResults:(w=this.observableQuery)===null||w===void 0?void 0:w.options.canonizeResults}},x.prototype.setDiff=function(m){var w=this,M,L=this.lastDiff&&this.lastDiff.diff;m&&!m.complete&&(!((M=this.observableQuery)===null||M===void 0)&&M.getLastError())||(this.updateLastDiff(m),!this.dirty&&!cn(L&&L.result,m&&m.result)&&(this.dirty=!0,this.notifyTimeout||(this.notifyTimeout=setTimeout(function(){return w.notify()},0))))},x.prototype.setObservableQuery=function(m){var w=this;m!==this.observableQuery&&(this.oqListener&&this.listeners.delete(this.oqListener),this.observableQuery=m,m?(m.queryInfo=this,this.listeners.add(this.oqListener=function(){var M=w.getDiff();M.fromOptimisticTransaction?m.observe():j2(m)})):delete this.oqListener)},x.prototype.notify=function(){var m=this;vw(this),this.shouldNotify()&&this.listeners.forEach(function(w){return w(m)}),this.dirty=!1},x.prototype.shouldNotify=function(){if(!this.dirty||!this.listeners.size)return!1;if(Sm(this.networkStatus)&&this.observableQuery){var m=this.observableQuery.options.fetchPolicy;if(m!=="cache-only"&&m!=="cache-and-network")return!1}return!0},x.prototype.stop=function(){if(!this.stopped){this.stopped=!0,this.reset(),this.cancel(),this.cancel=x.prototype.cancel;var m=this.observableQuery;m&&m.stopPolling()}},x.prototype.cancel=function(){},x.prototype.updateWatch=function(m){var w=this;m===void 0&&(m=this.variables);var M=this.observableQuery;if(!(M&&M.options.fetchPolicy==="no-cache")){var L=ut(ut({},this.getDiffOptions(m)),{watcher:this,callback:function(j){return w.setDiff(j)}});(!this.lastWatch||!cn(L,this.lastWatch))&&(this.cancel(),this.cancel=this.cache.watch(this.lastWatch=L))}},x.prototype.resetLastWrite=function(){this.lastWrite=void 0},x.prototype.shouldWrite=function(m,w){var M=this.lastWrite;return!(M&&M.dmCount===xm.get(this.cache)&&cn(w,M.variables)&&cn(m.data,M.result.data))},x.prototype.markResult=function(m,w,M,L){var j=this,W=new Yf,n=ql(m.errors)?m.errors.slice(0):[];if(this.reset(),"incremental"in m&&ql(m.incremental)){var ae=y2(this.getDiff().result,m);m.data=ae}else if("hasNext"in m&&m.hasNext){var ne=this.getDiff();m.data=W.merge(ne.result,m.data)}this.graphQLErrors=n,M.fetchPolicy==="no-cache"?this.updateLastDiff({result:m.data,complete:!0},this.getDiffOptions(M.variables)):L!==0&&(V0(m,M.errorPolicy)?this.cache.performTransaction(function(ge){if(j.shouldWrite(m,M.variables))ge.writeQuery({query:w,data:m.data,variables:M.variables,overwrite:L===1}),j.lastWrite={result:m,variables:M.variables,dmCount:xm.get(j.cache)};else if(j.lastDiff&&j.lastDiff.diff.complete){m.data=j.lastDiff.diff.result;return}var Ie=j.getDiffOptions(M.variables),Re=ge.diff(Ie);!j.stopped&&cn(j.variables,M.variables)&&j.updateWatch(M.variables),j.updateLastDiff(Re,Ie),Re.complete&&(m.data=Re.result)}):this.lastWrite=void 0)},x.prototype.markReady=function(){return this.networkError=null,this.networkStatus=Vr.ready},x.prototype.markError=function(m){return this.networkStatus=Vr.error,this.lastWrite=void 0,this.reset(),m.graphQLErrors&&(this.graphQLErrors=m.graphQLErrors),m.networkError&&(this.networkError=m.networkError),m},x}();function V0(x,m){m===void 0&&(m="none");var w=m==="ignore"||m==="all",M=!my(x);return!M&&w&&x.data&&(M=!0),M}var mC=Object.prototype.hasOwnProperty,xw=Object.create(null),_C=function(){function x(m){var w=this;this.clientAwareness={},this.queries=new Map,this.fetchCancelFns=new Map,this.transformCache=new Q0(Iu["queryManager.getDocumentInfo"]||2e3),this.queryIdCounter=1,this.requestIdCounter=1,this.mutationIdCounter=1,this.inFlightLinkObservables=new Bh(!1),this.noCacheWarningsByQueryId=new Set;var M=new c2(function(j){return w.cache.transformDocument(j)},{cache:!1});this.cache=m.cache,this.link=m.link,this.defaultOptions=m.defaultOptions,this.queryDeduplication=m.queryDeduplication,this.clientAwareness=m.clientAwareness,this.localState=m.localState,this.ssrMode=m.ssrMode,this.assumeImmutableResults=m.assumeImmutableResults,this.dataMasking=m.dataMasking;var L=m.documentTransform;this.documentTransform=L?M.concat(L).concat(M):M,this.defaultContext=m.defaultContext||Object.create(null),(this.onBroadcast=m.onBroadcast)&&(this.mutationStore=Object.create(null))}return x.prototype.stop=function(){var m=this;this.queries.forEach(function(w,M){m.stopQueryNoBroadcast(M)}),this.cancelPendingFetches(eo(27))},x.prototype.cancelPendingFetches=function(m){this.fetchCancelFns.forEach(function(w){return w(m)}),this.fetchCancelFns.clear()},x.prototype.mutate=function(m){return jf(this,arguments,void 0,function(w){var M,L,j,W,n,ae,ne,ge=w.mutation,Ie=w.variables,Re=w.optimisticResponse,je=w.updateQueries,Qe=w.refetchQueries,tt=Qe===void 0?[]:Qe,pt=w.awaitRefetchQueries,$e=pt===void 0?!1:pt,Et=w.update,Tt=w.onQueryUpdated,Mt=w.fetchPolicy,Ft=Mt===void 0?((ae=this.defaultOptions.mutate)===null||ae===void 0?void 0:ae.fetchPolicy)||"network-only":Mt,ni=w.errorPolicy,qt=ni===void 0?((ne=this.defaultOptions.mutate)===null||ne===void 0?void 0:ne.errorPolicy)||"none":ni,Fi=w.keepRootFields,ai=w.context;return qf(this,function(kt){switch(kt.label){case 0:return Ei(ge,28),Ei(Ft==="network-only"||Ft==="no-cache",29),M=this.generateMutationId(),ge=this.cache.transformForLink(this.transform(ge)),L=this.getDocumentInfo(ge).hasClientExports,Ie=this.getVariables(ge,Ie),L?[4,this.localState.addExportedVariables(ge,Ie,ai)]:[3,2];case 1:Ie=kt.sent(),kt.label=2;case 2:return j=this.mutationStore&&(this.mutationStore[M]={mutation:ge,variables:Ie,loading:!0,error:null}),W=Re&&this.markMutationOptimistic(Re,{mutationId:M,document:ge,variables:Ie,fetchPolicy:Ft,errorPolicy:qt,context:ai,updateQueries:je,update:Et,keepRootFields:Fi}),this.broadcastQueries(),n=this,[2,new Promise(function(li,bn){return o0(n.getObservableFromLink(ge,ut(ut({},ai),{optimisticResponse:W?Re:void 0}),Ie,{},!1),function(Dr){if(my(Dr)&&qt==="none")throw new Ph({graphQLErrors:R0(Dr)});j&&(j.loading=!1,j.error=null);var wn=ut({},Dr);return typeof tt=="function"&&(tt=tt(wn)),qt==="ignore"&&my(wn)&&delete wn.errors,n.markMutationResult({mutationId:M,result:wn,document:ge,variables:Ie,fetchPolicy:Ft,errorPolicy:qt,context:ai,update:Et,updateQueries:je,awaitRefetchQueries:$e,refetchQueries:tt,removeOptimistic:W?M:void 0,onQueryUpdated:Tt,keepRootFields:Fi})}).subscribe({next:function(Dr){n.broadcastQueries(),(!("hasNext"in Dr)||Dr.hasNext===!1)&&li(ut(ut({},Dr),{data:n.maskOperation({document:ge,data:Dr.data,fetchPolicy:Ft,id:M})}))},error:function(Dr){j&&(j.loading=!1,j.error=Dr),W&&n.cache.removeOptimistic(M),n.broadcastQueries(),bn(Dr instanceof Ph?Dr:new Ph({networkError:Dr}))}})})]}})})},x.prototype.markMutationResult=function(m,w){var M=this;w===void 0&&(w=this.cache);var L=m.result,j=[],W=m.fetchPolicy==="no-cache";if(!W&&V0(L,m.errorPolicy)){if(wm(L)||j.push({result:L.data,dataId:"ROOT_MUTATION",query:m.document,variables:m.variables}),wm(L)&&ql(L.incremental)){var n=w.diff({id:"ROOT_MUTATION",query:this.getDocumentInfo(m.document).asQuery,variables:m.variables,optimistic:!1,returnPartialData:!0}),ae=void 0;n.result&&(ae=y2(n.result,L)),typeof ae<"u"&&(L.data=ae,j.push({result:ae,dataId:"ROOT_MUTATION",query:m.document,variables:m.variables}))}var ne=m.updateQueries;ne&&this.queries.forEach(function(Ie,Re){var je=Ie.observableQuery,Qe=je&&je.queryName;if(!(!Qe||!mC.call(ne,Qe))){var tt=ne[Qe],pt=M.queries.get(Re),$e=pt.document,Et=pt.variables,Tt=w.diff({query:$e,variables:Et,returnPartialData:!0,optimistic:!1}),Mt=Tt.result,Ft=Tt.complete;if(Ft&&Mt){var ni=tt(Mt,{mutationResult:L,queryName:$e&&H_($e)||void 0,queryVariables:Et});ni&&j.push({result:ni,dataId:"ROOT_QUERY",query:$e,variables:Et})}}})}if(j.length>0||(m.refetchQueries||"").length>0||m.update||m.onQueryUpdated||m.removeOptimistic){var ge=[];if(this.refetchQueries({updateCache:function(Ie){W||j.forEach(function(tt){return Ie.write(tt)});var Re=m.update,je=!cA(L)||wm(L)&&!L.hasNext;if(Re){if(!W){var Qe=Ie.diff({id:"ROOT_MUTATION",query:M.getDocumentInfo(m.document).asQuery,variables:m.variables,optimistic:!1,returnPartialData:!0});Qe.complete&&(L=ut(ut({},L),{data:Qe.result}),"incremental"in L&&delete L.incremental,"hasNext"in L&&delete L.hasNext)}je&&Re(Ie,L,{context:m.context,variables:m.variables})}!W&&!m.keepRootFields&&je&&Ie.modify({id:"ROOT_MUTATION",fields:function(tt,pt){var $e=pt.fieldName,Et=pt.DELETE;return $e==="__typename"?tt:Et}})},include:m.refetchQueries,optimistic:!1,removeOptimistic:m.removeOptimistic,onQueryUpdated:m.onQueryUpdated||null}).forEach(function(Ie){return ge.push(Ie)}),m.awaitRefetchQueries||m.onQueryUpdated)return Promise.all(ge).then(function(){return L})}return Promise.resolve(L)},x.prototype.markMutationOptimistic=function(m,w){var M=this,L=typeof m=="function"?m(w.variables,{IGNORE:xw}):m;return L===xw?!1:(this.cache.recordOptimisticTransaction(function(j){try{M.markMutationResult(ut(ut({},w),{result:{data:L}}),j)}catch(W){globalThis.__DEV__!==!1&&Ei.error(W)}},w.mutationId),!0)},x.prototype.fetchQuery=function(m,w,M){return this.fetchConcastWithInfo(m,w,M).concast.promise},x.prototype.getQueryStore=function(){var m=Object.create(null);return this.queries.forEach(function(w,M){m[M]={variables:w.variables,networkStatus:w.networkStatus,networkError:w.networkError,graphQLErrors:w.graphQLErrors}}),m},x.prototype.resetErrors=function(m){var w=this.queries.get(m);w&&(w.networkError=void 0,w.graphQLErrors=[])},x.prototype.transform=function(m){return this.documentTransform.transformDocument(m)},x.prototype.getDocumentInfo=function(m){var w=this.transformCache;if(!w.has(m)){var M={hasClientExports:qE(m),hasForcedResolvers:this.localState.shouldForceResolvers(m),hasNonreactiveDirective:K_(["nonreactive"],m),nonReactiveQuery:XM(m),clientQuery:this.localState.clientQuery(m),serverQuery:h2([{name:"client",remove:!0},{name:"connection"},{name:"nonreactive"},{name:"unmask"}],m),defaultVars:J0(op(m)),asQuery:ut(ut({},m),{definitions:m.definitions.map(function(L){return L.kind==="OperationDefinition"&&L.operation!=="query"?ut(ut({},L),{operation:"query"}):L})})};w.set(m,M)}return w.get(m)},x.prototype.getVariables=function(m,w){return ut(ut({},this.getDocumentInfo(m).defaultVars),w)},x.prototype.watchQuery=function(m){var w=this.transform(m.query);m=ut(ut({},m),{variables:this.getVariables(w,m.variables)}),typeof m.notifyOnNetworkStatusChange>"u"&&(m.notifyOnNetworkStatusChange=!1);var M=new p0(this),L=new N0({queryManager:this,queryInfo:M,options:m});return L.lastQuery=w,this.queries.set(L.queryId,M),M.init({document:w,observableQuery:L,variables:L.variables}),L},x.prototype.query=function(m,w){var M=this;w===void 0&&(w=this.generateQueryId()),Ei(m.query,30),Ei(m.query.kind==="Document",31),Ei(!m.returnPartialData,32),Ei(!m.pollInterval,33);var L=this.transform(m.query);return this.fetchQuery(w,ut(ut({},m),{query:L})).then(function(j){return j&&ut(ut({},j),{data:M.maskOperation({document:L,data:j.data,fetchPolicy:m.fetchPolicy,id:w})})}).finally(function(){return M.stopQuery(w)})},x.prototype.generateQueryId=function(){return String(this.queryIdCounter++)},x.prototype.generateRequestId=function(){return this.requestIdCounter++},x.prototype.generateMutationId=function(){return String(this.mutationIdCounter++)},x.prototype.stopQueryInStore=function(m){this.stopQueryInStoreNoBroadcast(m),this.broadcastQueries()},x.prototype.stopQueryInStoreNoBroadcast=function(m){var w=this.queries.get(m);w&&w.stop()},x.prototype.clearStore=function(m){return m===void 0&&(m={discardWatches:!0}),this.cancelPendingFetches(eo(34)),this.queries.forEach(function(w){w.observableQuery?w.networkStatus=Vr.loading:w.stop()}),this.mutationStore&&(this.mutationStore=Object.create(null)),this.cache.reset(m)},x.prototype.getObservableQueries=function(m){var w=this;m===void 0&&(m="active");var M=new Map,L=new Map,j=new Map,W=new Set;return Array.isArray(m)&&m.forEach(function(n){if(typeof n=="string")L.set(n,n),j.set(n,!1);else if(vM(n)){var ae=np(w.transform(n));L.set(ae,H_(n)),j.set(ae,!1)}else ca(n)&&n.query&&W.add(n)}),this.queries.forEach(function(n,ae){var ne=n.observableQuery,ge=n.document;if(ne){if(m==="all"){M.set(ae,ne);return}var Ie=ne.queryName,Re=ne.options.fetchPolicy;if(Re==="standby"||m==="active"&&!ne.hasObservers())return;(m==="active"||Ie&&j.has(Ie)||ge&&j.has(np(ge)))&&(M.set(ae,ne),Ie&&j.set(Ie,!0),ge&&j.set(np(ge),!0))}}),W.size&&W.forEach(function(n){var ae=v0("legacyOneTimeQuery"),ne=w.getQuery(ae).init({document:n.query,variables:n.variables}),ge=new N0({queryManager:w,queryInfo:ne,options:ut(ut({},n),{fetchPolicy:"network-only"})});Ei(ge.queryId===ae),ne.setObservableQuery(ge),M.set(ae,ge)}),globalThis.__DEV__!==!1&&j.size&&j.forEach(function(n,ae){if(!n){var ne=L.get(ae);ne?globalThis.__DEV__!==!1&&Ei.warn(35,ne):globalThis.__DEV__!==!1&&Ei.warn(36)}}),M},x.prototype.reFetchObservableQueries=function(m){var w=this;m===void 0&&(m=!1);var M=[];return this.getObservableQueries(m?"all":"active").forEach(function(L,j){var W=L.options.fetchPolicy;L.resetLastResults(),(m||W!=="standby"&&W!=="cache-only")&&M.push(L.refetch()),w.getQuery(j).setDiff(null)}),this.broadcastQueries(),Promise.all(M)},x.prototype.setObservableQuery=function(m){this.getQuery(m.queryId).setObservableQuery(m)},x.prototype.startGraphQLSubscription=function(m){var w=this,M=m.query,L=m.variables,j=m.fetchPolicy,W=m.errorPolicy,n=W===void 0?"none":W,ae=m.context,ne=ae===void 0?{}:ae,ge=m.extensions,Ie=ge===void 0?{}:ge;M=this.transform(M),L=this.getVariables(M,L);var Re=function(Qe){return w.getObservableFromLink(M,ne,Qe,Ie).map(function(tt){j!=="no-cache"&&(V0(tt,n)&&w.cache.write({query:M,result:tt.data,dataId:"ROOT_SUBSCRIPTION",variables:Qe}),w.broadcastQueries());var pt=my(tt),$e=EA(tt);if(pt||$e){var Et={};if(pt&&(Et.graphQLErrors=tt.errors),$e&&(Et.protocolErrors=tt.extensions[lx]),n==="none"||$e)throw new Ph(Et)}return n==="ignore"&&delete tt.errors,tt})};if(this.getDocumentInfo(M).hasClientExports){var je=this.localState.addExportedVariables(M,L,ne).then(Re);return new xn(function(Qe){var tt=null;return je.then(function(pt){return tt=pt.subscribe(Qe)},Qe.error),function(){return tt&&tt.unsubscribe()}})}return Re(L)},x.prototype.stopQuery=function(m){this.stopQueryNoBroadcast(m),this.broadcastQueries()},x.prototype.stopQueryNoBroadcast=function(m){this.stopQueryInStoreNoBroadcast(m),this.removeQuery(m)},x.prototype.removeQuery=function(m){this.fetchCancelFns.delete(m),this.queries.has(m)&&(this.getQuery(m).stop(),this.queries.delete(m))},x.prototype.broadcastQueries=function(){this.onBroadcast&&this.onBroadcast(),this.queries.forEach(function(m){return m.notify()})},x.prototype.getLocalState=function(){return this.localState},x.prototype.getObservableFromLink=function(m,w,M,L,j){var W=this,n;j===void 0&&(j=(n=w==null?void 0:w.queryDeduplication)!==null&&n!==void 0?n:this.queryDeduplication);var ae,ne=this.getDocumentInfo(m),ge=ne.serverQuery,Ie=ne.clientQuery;if(ge){var Re=this,je=Re.inFlightLinkObservables,Qe=Re.link,tt={query:ge,variables:M,operationName:H_(ge)||void 0,context:this.prepareContext(ut(ut({},w),{forceFetch:!j})),extensions:L};if(w=tt.context,j){var pt=np(ge),$e=Hf(M),Et=je.lookup(pt,$e);if(ae=Et.observable,!ae){var Tt=new _m([z0(Qe,tt)]);ae=Et.observable=Tt,Tt.beforeNext(function Mt(Ft,ni){Ft==="next"&&"hasNext"in ni&&ni.hasNext?Tt.beforeNext(Mt):je.remove(pt,$e)})}}else ae=new _m([z0(Qe,tt)])}else ae=new _m([xn.of({data:{}})]),w=this.prepareContext(w);return Ie&&(ae=o0(ae,function(Mt){return W.localState.runResolvers({document:Ie,remoteResult:Mt,context:w,variables:M})})),ae},x.prototype.getResultsFromLink=function(m,w,M){var L=m.lastRequestId=this.generateRequestId(),j=this.cache.transformForLink(M.query);return o0(this.getObservableFromLink(j,M.context,M.variables),function(W){var n=R0(W),ae=n.length>0,ne=M.errorPolicy;if(L>=m.lastRequestId){if(ae&&ne==="none")throw m.markError(new Ph({graphQLErrors:n}));m.markResult(W,j,M,w),m.markReady()}var ge={data:W.data,loading:!1,networkStatus:Vr.ready};return ae&&ne==="none"&&(ge.data=void 0),ae&&ne!=="ignore"&&(ge.errors=n,ge.networkStatus=Vr.error),ge},function(W){var n=x2(W)?W:new Ph({networkError:W});throw L>=m.lastRequestId&&m.markError(n),n})},x.prototype.fetchConcastWithInfo=function(m,w,M,L){var j=this;M===void 0&&(M=Vr.loading),L===void 0&&(L=w.query);var W=this.getVariables(L,w.variables),n=this.getQuery(m),ae=this.defaultOptions.watchQuery,ne=w.fetchPolicy,ge=ne===void 0?ae&&ae.fetchPolicy||"cache-first":ne,Ie=w.errorPolicy,Re=Ie===void 0?ae&&ae.errorPolicy||"none":Ie,je=w.returnPartialData,Qe=je===void 0?!1:je,tt=w.notifyOnNetworkStatusChange,pt=tt===void 0?!1:tt,$e=w.context,Et=$e===void 0?{}:$e,Tt=Object.assign({},w,{query:L,variables:W,fetchPolicy:ge,errorPolicy:Re,returnPartialData:Qe,notifyOnNetworkStatusChange:pt,context:Et}),Mt=function(ai){Tt.variables=ai;var kt=j.fetchQueryByPolicy(n,Tt,M);return Tt.fetchPolicy!=="standby"&&kt.sources.length>0&&n.observableQuery&&n.observableQuery.applyNextFetchPolicy("after-fetch",w),kt},Ft=function(){return j.fetchCancelFns.delete(m)};this.fetchCancelFns.set(m,function(ai){Ft(),setTimeout(function(){return ni.cancel(ai)})});var ni,qt;if(this.getDocumentInfo(Tt.query).hasClientExports)ni=new _m(this.localState.addExportedVariables(Tt.query,Tt.variables,Tt.context).then(Mt).then(function(ai){return ai.sources})),qt=!0;else{var Fi=Mt(Tt.variables);qt=Fi.fromLink,ni=new _m(Fi.sources)}return ni.promise.then(Ft,Ft),{concast:ni,fromLink:qt}},x.prototype.refetchQueries=function(m){var w=this,M=m.updateCache,L=m.include,j=m.optimistic,W=j===void 0?!1:j,n=m.removeOptimistic,ae=n===void 0?W?v0("refetchQueries"):void 0:n,ne=m.onQueryUpdated,ge=new Map;L&&this.getObservableQueries(L).forEach(function(Re,je){ge.set(je,{oq:Re,lastDiff:w.getQuery(je).getDiff()})});var Ie=new Map;return M&&this.cache.batch({update:M,optimistic:W&&ae||!1,removeOptimistic:ae,onWatchUpdated:function(Re,je,Qe){var tt=Re.watcher instanceof p0&&Re.watcher.observableQuery;if(tt){if(ne){ge.delete(tt.queryId);var pt=ne(tt,je,Qe);return pt===!0&&(pt=tt.refetch()),pt!==!1&&Ie.set(tt,pt),pt}ne!==null&&ge.set(tt.queryId,{oq:tt,lastDiff:Qe,diff:je})}}}),ge.size&&ge.forEach(function(Re,je){var Qe=Re.oq,tt=Re.lastDiff,pt=Re.diff,$e;if(ne){if(!pt){var Et=Qe.queryInfo;Et.reset(),pt=Et.getDiff()}$e=ne(Qe,pt,tt)}(!ne||$e===!0)&&($e=Qe.refetch()),$e!==!1&&Ie.set(Qe,$e),je.indexOf("legacyOneTimeQuery")>=0&&w.stopQueryNoBroadcast(je)}),ae&&this.cache.removeOptimistic(ae),Ie},x.prototype.maskOperation=function(m){var w,M,L,j=m.document,W=m.data;if(globalThis.__DEV__!==!1){var n=m.fetchPolicy,ae=m.id,ne=(w=op(j))===null||w===void 0?void 0:w.operation,ge=((M=ne==null?void 0:ne[0])!==null&&M!==void 0?M:"o")+ae;this.dataMasking&&n==="no-cache"&&!tM(j)&&!this.noCacheWarningsByQueryId.has(ge)&&(this.noCacheWarningsByQueryId.add(ge),globalThis.__DEV__!==!1&&Ei.warn(37,(L=H_(j))!==null&&L!==void 0?L:"Unnamed ".concat(ne??"operation")))}return this.dataMasking?$A(W,j,this.cache):W},x.prototype.maskFragment=function(m){var w=m.data,M=m.fragment,L=m.fragmentName;return this.dataMasking?A2(w,M,this.cache,L):w},x.prototype.fetchQueryByPolicy=function(m,w,M){var L=this,j=w.query,W=w.variables,n=w.fetchPolicy,ae=w.refetchWritePolicy,ne=w.errorPolicy,ge=w.returnPartialData,Ie=w.context,Re=w.notifyOnNetworkStatusChange,je=m.networkStatus;m.init({document:j,variables:W,networkStatus:M});var Qe=function(){return m.getDiff()},tt=function(Mt,Ft){Ft===void 0&&(Ft=m.networkStatus||Vr.loading);var ni=Mt.result;globalThis.__DEV__!==!1&&!ge&&!cn(ni,{})&&q2(Mt.missing);var qt=function(Fi){return xn.of(ut({data:Fi,loading:Sm(Ft),networkStatus:Ft},Mt.complete?null:{partial:!0}))};return ni&&L.getDocumentInfo(j).hasForcedResolvers?L.localState.runResolvers({document:j,remoteResult:{data:ni},context:Ie,variables:W,onlyRunForcedResolvers:!0}).then(function(Fi){return qt(Fi.data||void 0)}):ne==="none"&&Ft===Vr.refetch&&Array.isArray(Mt.missing)?qt(void 0):qt(ni)},pt=n==="no-cache"?0:M===Vr.refetch&&ae!=="merge"?1:2,$e=function(){return L.getResultsFromLink(m,pt,{query:j,variables:W,context:Ie,fetchPolicy:n,errorPolicy:ne})},Et=Re&&typeof je=="number"&&je!==M&&Sm(M);switch(n){default:case"cache-first":{var Tt=Qe();return Tt.complete?{fromLink:!1,sources:[tt(Tt,m.markReady())]}:ge||Et?{fromLink:!0,sources:[tt(Tt),$e()]}:{fromLink:!0,sources:[$e()]}}case"cache-and-network":{var Tt=Qe();return Tt.complete||ge||Et?{fromLink:!0,sources:[tt(Tt),$e()]}:{fromLink:!0,sources:[$e()]}}case"cache-only":return{fromLink:!1,sources:[tt(Qe(),m.markReady())]};case"network-only":return Et?{fromLink:!0,sources:[tt(Qe()),$e()]}:{fromLink:!0,sources:[$e()]};case"no-cache":return Et?{fromLink:!0,sources:[tt(m.getDiff()),$e()]}:{fromLink:!0,sources:[$e()]};case"standby":return{fromLink:!1,sources:[]}}},x.prototype.getQuery=function(m){return m&&!this.queries.has(m)&&this.queries.set(m,new p0(this,m)),this.queries.get(m)},x.prototype.prepareContext=function(m){m===void 0&&(m={});var w=this.localState.prepareContext(m);return ut(ut(ut({},this.defaultContext),w),{clientAwareness:this.clientAwareness})},x}(),gC=function(){function x(m){var w=m.cache,M=m.client,L=m.resolvers,j=m.fragmentMatcher;this.selectionsToResolveCache=new WeakMap,this.cache=w,M&&(this.client=M),L&&this.addResolvers(L),j&&this.setFragmentMatcher(j)}return x.prototype.addResolvers=function(m){var w=this;this.resolvers=this.resolvers||{},Array.isArray(m)?m.forEach(function(M){w.resolvers=V1(w.resolvers,M)}):this.resolvers=V1(this.resolvers,m)},x.prototype.setResolvers=function(m){this.resolvers={},this.addResolvers(m)},x.prototype.getResolvers=function(){return this.resolvers||{}},x.prototype.runResolvers=function(m){return jf(this,arguments,void 0,function(w){var M=w.document,L=w.remoteResult,j=w.context,W=w.variables,n=w.onlyRunForcedResolvers,ae=n===void 0?!1:n;return qf(this,function(ne){return M?[2,this.resolveDocument(M,L.data,j,W,this.fragmentMatcher,ae).then(function(ge){return ut(ut({},L),{data:ge.result})})]:[2,L]})})},x.prototype.setFragmentMatcher=function(m){this.fragmentMatcher=m},x.prototype.getFragmentMatcher=function(){return this.fragmentMatcher},x.prototype.clientQuery=function(m){return K_(["client"],m)&&this.resolvers?m:null},x.prototype.serverQuery=function(m){return f2(m)},x.prototype.prepareContext=function(m){var w=this.cache;return ut(ut({},m),{cache:w,getCacheKey:function(M){return w.identify(M)}})},x.prototype.addExportedVariables=function(m){return jf(this,arguments,void 0,function(w,M,L){return M===void 0&&(M={}),L===void 0&&(L={}),qf(this,function(j){return w?[2,this.resolveDocument(w,this.buildRootValueFromCache(w,M)||{},this.prepareContext(L),M).then(function(W){return ut(ut({},M),W.exportedVariables)})]:[2,ut({},M)]})})},x.prototype.shouldForceResolvers=function(m){var w=!1;return Rc(m,{Directive:{enter:function(M){if(M.name.value==="client"&&M.arguments&&(w=M.arguments.some(function(L){return L.name.value==="always"&&L.value.kind==="BooleanValue"&&L.value.value===!0}),w))return Ry}}}),w},x.prototype.buildRootValueFromCache=function(m,w){return this.cache.diff({query:ZM(m),variables:w,returnPartialData:!0,optimistic:!1}).result},x.prototype.resolveDocument=function(m,w){return jf(this,arguments,void 0,function(M,L,j,W,n,ae){var ne,ge,Ie,Re,je,Qe,tt,pt,$e,Et,Tt;return j===void 0&&(j={}),W===void 0&&(W={}),n===void 0&&(n=function(){return!0}),ae===void 0&&(ae=!1),qf(this,function(Mt){return ne=rg(M),ge=Om(M),Ie=Rm(ge),Re=this.collectSelectionsToResolve(ne,Ie),je=ne.operation,Qe=je?je.charAt(0).toUpperCase()+je.slice(1):"Query",tt=this,pt=tt.cache,$e=tt.client,Et={fragmentMap:Ie,context:ut(ut({},j),{cache:pt,client:$e}),variables:W,fragmentMatcher:n,defaultOperationType:Qe,exportedVariables:{},selectionsToResolve:Re,onlyRunForcedResolvers:ae},Tt=!1,[2,this.resolveSelectionSet(ne.selectionSet,Tt,L,Et).then(function(Ft){return{result:Ft,exportedVariables:Et.exportedVariables}})]})})},x.prototype.resolveSelectionSet=function(m,w,M,L){return jf(this,void 0,void 0,function(){var j,W,n,ae,ne,ge=this;return qf(this,function(Ie){return j=L.fragmentMap,W=L.context,n=L.variables,ae=[M],ne=function(Re){return jf(ge,void 0,void 0,function(){var je,Qe;return qf(this,function(tt){return!w&&!L.selectionsToResolve.has(Re)?[2]:ig(Re,n)?Zf(Re)?[2,this.resolveField(Re,w,M,L).then(function(pt){var $e;typeof pt<"u"&&ae.push(($e={},$e[Fh(Re)]=pt,$e))})]:(RM(Re)?je=Re:(je=j[Re.name.value],Ei(je,19,Re.name.value)),je&&je.typeCondition&&(Qe=je.typeCondition.name.value,L.fragmentMatcher(M,Qe,W))?[2,this.resolveSelectionSet(je.selectionSet,w,M,L).then(function(pt){ae.push(pt)})]:[2]):[2]})})},[2,Promise.all(m.selections.map(ne)).then(function(){return By(ae)})]})})},x.prototype.resolveField=function(m,w,M,L){return jf(this,void 0,void 0,function(){var j,W,n,ae,ne,ge,Ie,Re,je,Qe=this;return qf(this,function(tt){return M?(j=L.variables,W=m.name.value,n=Fh(m),ae=W!==n,ne=M[n]||M[W],ge=Promise.resolve(ne),(!L.onlyRunForcedResolvers||this.shouldForceResolvers(m))&&(Ie=M.__typename||L.defaultOperationType,Re=this.resolvers&&this.resolvers[Ie],Re&&(je=Re[ae?W:n],je&&(ge=Promise.resolve(ux.withValue(this.cache,je,[M,Ly(m,j),L.context,{field:m,fragmentMap:L.fragmentMap}]))))),[2,ge.then(function(pt){var $e,Et;if(pt===void 0&&(pt=ne),m.directives&&m.directives.forEach(function(Mt){Mt.name.value==="export"&&Mt.arguments&&Mt.arguments.forEach(function(Ft){Ft.name.value==="as"&&Ft.value.kind==="StringValue"&&(L.exportedVariables[Ft.value.value]=pt)})}),!m.selectionSet||pt==null)return pt;var Tt=(Et=($e=m.directives)===null||$e===void 0?void 0:$e.some(function(Mt){return Mt.name.value==="client"}))!==null&&Et!==void 0?Et:!1;if(Array.isArray(pt))return Qe.resolveSubSelectedArray(m,w||Tt,pt,L);if(m.selectionSet)return Qe.resolveSelectionSet(m.selectionSet,w||Tt,pt,L)})]):[2,null]})})},x.prototype.resolveSubSelectedArray=function(m,w,M,L){var j=this;return Promise.all(M.map(function(W){if(W===null)return null;if(Array.isArray(W))return j.resolveSubSelectedArray(m,w,W,L);if(m.selectionSet)return j.resolveSelectionSet(m.selectionSet,w,W,L)}))},x.prototype.collectSelectionsToResolve=function(m,w){var M=function(W){return!Array.isArray(W)},L=this.selectionsToResolveCache;function j(W){if(!L.has(W)){var n=new Set;L.set(W,n),Rc(W,{Directive:function(ae,ne,ge,Ie,Re){ae.name.value==="client"&&Re.forEach(function(je){M(je)&&R1(je)&&n.add(je)})},FragmentSpread:function(ae,ne,ge,Ie,Re){var je=w[ae.name.value];Ei(je,20,ae.name.value);var Qe=j(je);Qe.size>0&&(Re.forEach(function(tt){M(tt)&&R1(tt)&&n.add(tt)}),n.add(ae),Qe.forEach(function(tt){n.add(tt)}))}})}return L.get(W)}return j(m)},x}(),bw=!1,G2=function(){function x(m){var w=this,M;if(this.resetStoreCallbacks=[],this.clearStoreCallbacks=[],!m.cache)throw eo(16);var L=m.uri,j=m.credentials,W=m.headers,n=m.cache,ae=m.documentTransform,ne=m.ssrMode,ge=ne===void 0?!1:ne,Ie=m.ssrForceFetchDelay,Re=Ie===void 0?0:Ie,je=m.connectToDevTools,Qe=m.queryDeduplication,tt=Qe===void 0?!0:Qe,pt=m.defaultOptions,$e=m.defaultContext,Et=m.assumeImmutableResults,Tt=Et===void 0?n.assumeImmutableResults:Et,Mt=m.resolvers,Ft=m.typeDefs,ni=m.fragmentMatcher,qt=m.name,Fi=m.version,ai=m.devtools,kt=m.dataMasking,li=m.link;li||(li=L?new jA({uri:L,credentials:j,headers:W}):ng.empty()),this.link=li,this.cache=n,this.disableNetworkFetches=ge||Re>0,this.queryDeduplication=tt,this.defaultOptions=pt||Object.create(null),this.typeDefs=Ft,this.devtoolsConfig=ut(ut({},ai),{enabled:(M=ai==null?void 0:ai.enabled)!==null&&M!==void 0?M:je}),this.devtoolsConfig.enabled===void 0&&(this.devtoolsConfig.enabled=globalThis.__DEV__!==!1),Re&&setTimeout(function(){return w.disableNetworkFetches=!1},Re),this.watchQuery=this.watchQuery.bind(this),this.query=this.query.bind(this),this.mutate=this.mutate.bind(this),this.watchFragment=this.watchFragment.bind(this),this.resetStore=this.resetStore.bind(this),this.reFetchObservableQueries=this.reFetchObservableQueries.bind(this),this.version=G0,this.localState=new gC({cache:n,client:this,resolvers:Mt,fragmentMatcher:ni}),this.queryManager=new _C({cache:this.cache,link:this.link,defaultOptions:this.defaultOptions,defaultContext:$e,documentTransform:ae,queryDeduplication:tt,ssrMode:ge,dataMasking:!!kt,clientAwareness:{name:qt,version:Fi},localState:this.localState,assumeImmutableResults:Tt,onBroadcast:this.devtoolsConfig.enabled?function(){w.devToolsHookCb&&w.devToolsHookCb({action:{},state:{queries:w.queryManager.getQueryStore(),mutations:w.queryManager.mutationStore||{}},dataWithOptimisticResults:w.cache.extract(!0)})}:void 0}),this.devtoolsConfig.enabled&&this.connectToDevTools()}return x.prototype.connectToDevTools=function(){if(!(typeof window>"u")){var m=window,w=Symbol.for("apollo.devtools");(m[w]=m[w]||[]).push(this),m.__APOLLO_CLIENT__=this,!bw&&globalThis.__DEV__!==!1&&(bw=!0,window.document&&window.top===window.self&&/^(https?|file):$/.test(window.location.protocol)&&setTimeout(function(){if(!window.__APOLLO_DEVTOOLS_GLOBAL_HOOK__){var M=window.navigator,L=M&&M.userAgent,j=void 0;typeof L=="string"&&(L.indexOf("Chrome/")>-1?j="https://chrome.google.com/webstore/detail/apollo-client-developer-t/jdkknkkbebbapilgoeccciglkfbmbnfm":L.indexOf("Firefox/")>-1&&(j="https://addons.mozilla.org/en-US/firefox/addon/apollo-developer-tools/")),j&&globalThis.__DEV__!==!1&&Ei.log("Download the Apollo DevTools for a better development experience: %s",j)}},1e4))}},Object.defineProperty(x.prototype,"documentTransform",{get:function(){return this.queryManager.documentTransform},enumerable:!1,configurable:!0}),x.prototype.stop=function(){this.queryManager.stop()},x.prototype.watchQuery=function(m){return this.defaultOptions.watchQuery&&(m=_y(this.defaultOptions.watchQuery,m)),this.disableNetworkFetches&&(m.fetchPolicy==="network-only"||m.fetchPolicy==="cache-and-network")&&(m=ut(ut({},m),{fetchPolicy:"cache-first"})),this.queryManager.watchQuery(m)},x.prototype.query=function(m){return this.defaultOptions.query&&(m=_y(this.defaultOptions.query,m)),Ei(m.fetchPolicy!=="cache-and-network",17),this.disableNetworkFetches&&m.fetchPolicy==="network-only"&&(m=ut(ut({},m),{fetchPolicy:"cache-first"})),this.queryManager.query(m)},x.prototype.mutate=function(m){return this.defaultOptions.mutate&&(m=_y(this.defaultOptions.mutate,m)),this.queryManager.mutate(m)},x.prototype.subscribe=function(m){var w=this,M=this.queryManager.generateQueryId();return this.queryManager.startGraphQLSubscription(m).map(function(L){return ut(ut({},L),{data:w.queryManager.maskOperation({document:m.query,data:L.data,fetchPolicy:m.fetchPolicy,id:M})})})},x.prototype.readQuery=function(m,w){return w===void 0&&(w=!1),this.cache.readQuery(m,w)},x.prototype.watchFragment=function(m){var w;return this.cache.watchFragment(ut(ut({},m),(w={},w[Symbol.for("apollo.dataMasking")]=this.queryManager.dataMasking,w)))},x.prototype.readFragment=function(m,w){return w===void 0&&(w=!1),this.cache.readFragment(m,w)},x.prototype.writeQuery=function(m){var w=this.cache.writeQuery(m);return m.broadcast!==!1&&this.queryManager.broadcastQueries(),w},x.prototype.writeFragment=function(m){var w=this.cache.writeFragment(m);return m.broadcast!==!1&&this.queryManager.broadcastQueries(),w},x.prototype.__actionHookForDevTools=function(m){this.devToolsHookCb=m},x.prototype.__requestRaw=function(m){return z0(this.link,m)},x.prototype.resetStore=function(){var m=this;return Promise.resolve().then(function(){return m.queryManager.clearStore({discardWatches:!1})}).then(function(){return Promise.all(m.resetStoreCallbacks.map(function(w){return w()}))}).then(function(){return m.reFetchObservableQueries()})},x.prototype.clearStore=function(){var m=this;return Promise.resolve().then(function(){return m.queryManager.clearStore({discardWatches:!0})}).then(function(){return Promise.all(m.clearStoreCallbacks.map(function(w){return w()}))})},x.prototype.onResetStore=function(m){var w=this;return this.resetStoreCallbacks.push(m),function(){w.resetStoreCallbacks=w.resetStoreCallbacks.filter(function(M){return M!==m})}},x.prototype.onClearStore=function(m){var w=this;return this.clearStoreCallbacks.push(m),function(){w.clearStoreCallbacks=w.clearStoreCallbacks.filter(function(M){return M!==m})}},x.prototype.reFetchObservableQueries=function(m){return this.queryManager.reFetchObservableQueries(m)},x.prototype.refetchQueries=function(m){var w=this.queryManager.refetchQueries(m),M=[],L=[];w.forEach(function(W,n){M.push(n),L.push(W)});var j=Promise.all(L);return j.queries=M,j.results=L,j.catch(function(W){globalThis.__DEV__!==!1&&Ei.debug(18,W)}),j},x.prototype.getObservableQueries=function(m){return m===void 0&&(m="active"),this.queryManager.getObservableQueries(m)},x.prototype.extract=function(m){return this.cache.extract(m)},x.prototype.restore=function(m){return this.cache.restore(m)},x.prototype.addResolvers=function(m){this.localState.addResolvers(m)},x.prototype.setResolvers=function(m){this.localState.setResolvers(m)},x.prototype.getResolvers=function(){return this.localState.getResolvers()},x.prototype.setLocalStateFragmentMatcher=function(m){this.localState.setFragmentMatcher(m)},x.prototype.setLink=function(m){this.link=this.queryManager.link=m},Object.defineProperty(x.prototype,"defaultContext",{get:function(){return this.queryManager.defaultContext},enumerable:!1,configurable:!0}),x}();globalThis.__DEV__!==!1&&(G2.prototype.getMemoryInternals=uM);var vy=new Map,U0=new Map,H2=!0,My=!1;function Z2(x){return x.replace(/[\s,]+/g," ").trim()}function yC(x){return Z2(x.source.body.substring(x.start,x.end))}function vC(x){var m=new Set,w=[];return x.definitions.forEach(function(M){if(M.kind==="FragmentDefinition"){var L=M.name.value,j=yC(M.loc),W=U0.get(L);W&&!W.has(j)?H2&&console.warn("Warning: fragment with name "+L+` already exists.
graphql-tag enforces all fragment names across your application to be unique; read more about
this in the docs: http://dev.apollodata.com/core/fragments.html#unique-names`):W||U0.set(L,W=new Set),W.add(j),m.has(j)||(m.add(j),w.push(M))}else w.push(M)}),ut(ut({},x),{definitions:w})}function xC(x){var m=new Set(x.definitions);m.forEach(function(M){M.loc&&delete M.loc,Object.keys(M).forEach(function(L){var j=M[L];j&&typeof j=="object"&&m.add(j)})});var w=x.loc;return w&&(delete w.startToken,delete w.endToken),x}function bC(x){var m=Z2(x);if(!vy.has(m)){var w=OE(x,{experimentalFragmentVariables:My,allowLegacyFragmentVariables:My});if(!w||w.kind!=="Document")throw new Error("Not a valid GraphQL document.");vy.set(m,xC(vC(w)))}return vy.get(m)}function Dm(x){for(var m=[],w=1;w<arguments.length;w++)m[w-1]=arguments[w];typeof x=="string"&&(x=[x]);var M=x[0];return m.forEach(function(L,j){L&&L.kind==="Document"?M+=L.loc.source.body:M+=L,M+=x[j+1]}),bC(M)}function wC(){vy.clear(),U0.clear()}function TC(){H2=!1}function SC(){My=!0}function EC(){My=!1}var q_={gql:Dm,resetCaches:wC,disableFragmentWarnings:TC,enableExperimentalFragmentVariables:SC,disableExperimentalFragmentVariables:EC};(function(x){x.gql=q_.gql,x.resetCaches=q_.resetCaches,x.disableFragmentWarnings=q_.disableFragmentWarnings,x.enableExperimentalFragmentVariables=q_.enableExperimentalFragmentVariables,x.disableExperimentalFragmentVariables=q_.disableExperimentalFragmentVariables})(Dm||(Dm={}));Dm.default=Dm;var m0={exports:{}},ww;function MC(){return ww||(ww=1,function(x){x.exports.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=void 0,x.exports.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=void 0,x.exports.__SERVER_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=void 0,Object.assign(x.exports,Cy())}(m0)),m0.exports}var Sa=MC();const AC=Ay(Sa),X2=US({__proto__:null,default:AC},[Sa]);var Tw=$0?Symbol.for("__APOLLO_CONTEXT__"):"__APOLLO_CONTEXT__";function px(){Ei("createContext"in X2,54);var x=Sa.createContext[Tw];return x||(Object.defineProperty(Sa.createContext,Tw,{value:x=Sa.createContext({}),enumerable:!1,writable:!1,configurable:!0}),x.displayName="ApolloContext"),x}var CC=function(x){var m=x.client,w=x.children,M=px(),L=Sa.useContext(M),j=Sa.useMemo(function(){return ut(ut({},L),{client:m||L.client})},[L,m]);return Ei(j.client,55),Sa.createElement(M.Provider,{value:j},w)};function Y2(x){var m=Sa.useContext(px()),w=x||m.client;return Ei(!!w,58),w}var Sw=!1,DC="useSyncExternalStore",IC=X2[DC],RC=IC||function(x,m,w){var M=m();globalThis.__DEV__!==!1&&!Sw&&M!==m()&&(Sw=!0,globalThis.__DEV__!==!1&&Ei.error(68));var L=Sa.useState({inst:{value:M,getSnapshot:m}}),j=L[0].inst,W=L[1];return JE?Sa.useLayoutEffect(function(){Object.assign(j,{value:M,getSnapshot:m}),_0(j)&&W({inst:j})},[x,M,m]):Object.assign(j,{value:M,getSnapshot:m}),Sa.useEffect(function(){return _0(j)&&W({inst:j}),x(function(){_0(j)&&W({inst:j})})},[x]),M};function _0(x){var m=x.value,w=x.getSnapshot;try{return m!==w()}catch{return!0}}var kh;(function(x){x[x.Query=0]="Query",x[x.Mutation=1]="Mutation",x[x.Subscription=2]="Subscription"})(kh||(kh={}));var ap;function Ew(x){var m;switch(x){case kh.Query:m="Query";break;case kh.Mutation:m="Mutation";break;case kh.Subscription:m="Subscription";break}return m}function W2(x){ap||(ap=new Q0(Iu.parser||1e3));var m=ap.get(x);if(m)return m;var w,M,L;Ei(!!x&&!!x.kind,70,x);for(var j=[],W=[],n=[],ae=[],ne=0,ge=x.definitions;ne<ge.length;ne++){var Ie=ge[ne];if(Ie.kind==="FragmentDefinition"){j.push(Ie);continue}if(Ie.kind==="OperationDefinition")switch(Ie.operation){case"query":W.push(Ie);break;case"mutation":n.push(Ie);break;case"subscription":ae.push(Ie);break}}Ei(!j.length||W.length||n.length||ae.length,71),Ei(W.length+n.length+ae.length<=1,72,x,W.length,ae.length,n.length),M=W.length?kh.Query:kh.Mutation,!W.length&&!n.length&&(M=kh.Subscription);var Re=W.length?W:n.length?n:ae;Ei(Re.length===1,73,x,Re.length);var je=Re[0];w=je.variableDefinitions||[],je.name&&je.name.kind==="Name"?L=je.name.value:L="data";var Qe={name:L,type:M,variables:w};return ap.set(x,Qe),Qe}W2.resetCache=function(){ap=void 0};globalThis.__DEV__!==!1&&K0("parser",function(){return ap?ap.size:0});function zC(x,m){var w=W2(x),M=Ew(m),L=Ew(w.type);Ei(w.type===m,74,M,M,L)}var OC=Symbol.for("apollo.hook.wrappers");function LC(x,m,w){var M=w.queryManager,L=M&&M[OC],j=L&&L[x];return j?j(m):m}var PC=Object.prototype.hasOwnProperty;function Mw(){}var xy=Symbol();function kC(x,m){return m===void 0&&(m=Object.create(null)),LC("useQuery",FC,Y2(m&&m.client))(x,m)}function FC(x,m){var w=NC(x,m),M=w.result,L=w.obsQueryFields;return Sa.useMemo(function(){return ut(ut({},M),L)},[M,L])}function BC(x,m,w,M,L){function j(Ie){var Re;zC(m,kh.Query);var je={client:x,query:m,observable:M&&M.getSSRObservable(L())||x.watchQuery($2(void 0,x,w,L())),resultData:{previousData:(Re=Ie==null?void 0:Ie.resultData.current)===null||Re===void 0?void 0:Re.data}};return je}var W=Sa.useState(j),n=W[0],ae=W[1];function ne(Ie){var Re,je;Object.assign(n.observable,(Re={},Re[xy]=Ie,Re));var Qe=n.resultData;ae(ut(ut({},n),{query:Ie.query,resultData:Object.assign(Qe,{previousData:((je=Qe.current)===null||je===void 0?void 0:je.data)||Qe.previousData,current:void 0})}))}if(x!==n.client||m!==n.query){var ge=j(n);return ae(ge),[ge,ne]}return[n,ne]}function NC(x,m){var w=Y2(m.client),M=Sa.useContext(px()).renderPromises,L=!!M,j=w.disableNetworkFetches,W=m.ssr!==!1&&!m.skip,n=m.partialRefetch,ae=qC(w,x,m,L),ne=BC(w,x,m,M,ae),ge=ne[0],Ie=ge.observable,Re=ge.resultData,je=ne[1],Qe=ae(Ie);jC(Re,Ie,w,m,Qe);var tt=Sa.useMemo(function(){return XC(Ie)},[Ie]);UC(Ie,M,W);var pt=VC(Re,Ie,w,m,Qe,j,n,L,{onCompleted:m.onCompleted||Mw,onError:m.onError||Mw});return{result:pt,obsQueryFields:tt,observable:Ie,resultData:Re,client:w,onQueryExecuted:je}}function VC(x,m,w,M,L,j,W,n,ae){var ne=Sa.useRef(ae);Sa.useEffect(function(){ne.current=ae});var ge=(n||j)&&M.ssr===!1&&!M.skip?K2:M.skip||L.fetchPolicy==="standby"?J2:void 0,Ie=x.previousData,Re=Sa.useMemo(function(){return ge&&Q2(ge,Ie,m,w)},[w,m,ge,Ie]);return RC(Sa.useCallback(function(je){if(n)return function(){};var Qe=function(){var $e=x.current,Et=m.getCurrentResult();$e&&$e.loading===Et.loading&&$e.networkStatus===Et.networkStatus&&cn($e.data,Et.data)||j0(Et,x,m,w,W,je,ne.current)},tt=function($e){if(pt.current.unsubscribe(),pt.current=m.resubscribeAfterError(Qe,tt),!PC.call($e,"graphQLErrors"))throw $e;var Et=x.current;(!Et||Et&&Et.loading||!cn($e,Et.error))&&j0({data:Et&&Et.data,error:$e,loading:!1,networkStatus:Vr.error},x,m,w,W,je,ne.current)},pt={current:m.subscribe(Qe,tt)};return function(){setTimeout(function(){return pt.current.unsubscribe()})}},[j,n,m,x,W,w]),function(){return Re||Aw(x,m,ne.current,W,w)},function(){return Re||Aw(x,m,ne.current,W,w)})}function UC(x,m,w){m&&w&&(m.registerSSRObservable(x),x.getCurrentResult().loading&&m.addObservableQueryPromise(x))}function jC(x,m,w,M,L){var j;m[xy]&&!cn(m[xy],L)&&(m.reobserve($2(m,w,M,L)),x.previousData=((j=x.current)===null||j===void 0?void 0:j.data)||x.previousData,x.current=void 0),m[xy]=L}function qC(x,m,w,M){w===void 0&&(w={});var L=w.skip;w.ssr,w.onCompleted,w.onError;var j=w.defaultOptions,W=Ic(w,["skip","ssr","onCompleted","onError","defaultOptions"]);return function(n){var ae=Object.assign(W,{query:m});return M&&(ae.fetchPolicy==="network-only"||ae.fetchPolicy==="cache-and-network")&&(ae.fetchPolicy="cache-first"),ae.variables||(ae.variables={}),L?(ae.initialFetchPolicy=ae.initialFetchPolicy||ae.fetchPolicy||Cw(j,x.defaultOptions),ae.fetchPolicy="standby"):ae.fetchPolicy||(ae.fetchPolicy=(n==null?void 0:n.options.initialFetchPolicy)||Cw(j,x.defaultOptions)),ae}}function $2(x,m,w,M){var L=[],j=m.defaultOptions.watchQuery;return j&&L.push(j),w.defaultOptions&&L.push(w.defaultOptions),L.push(lp(x&&x.options,M)),L.reduce(_y)}function j0(x,m,w,M,L,j,W){var n=m.current;n&&n.data&&(m.previousData=n.data),!x.error&&ql(x.errors)&&(x.error=new Ph({graphQLErrors:x.errors})),m.current=Q2(ZC(x,w,L),m.previousData,w,M),j(),GC(x,n==null?void 0:n.networkStatus,W)}function GC(x,m,w){if(!x.loading){var M=HC(x);Promise.resolve().then(function(){M?w.onError(M):x.data&&m!==x.networkStatus&&x.networkStatus===Vr.ready&&w.onCompleted(x.data)}).catch(function(L){globalThis.__DEV__!==!1&&Ei.warn(L)})}}function Aw(x,m,w,M,L){return x.current||j0(m.getCurrentResult(),x,m,L,M,function(){},w),x.current}function Cw(x,m){var w;return(x==null?void 0:x.fetchPolicy)||((w=m==null?void 0:m.watchQuery)===null||w===void 0?void 0:w.fetchPolicy)||"cache-first"}function HC(x){return ql(x.errors)?new Ph({graphQLErrors:x.errors}):x.error}function Q2(x,m,w,M){var L=x.data;x.partial;var j=Ic(x,["data","partial"]),W=ut(ut({data:L},j),{client:M,observable:w,variables:w.variables,called:x!==K2&&x!==J2,previousData:m});return W}function ZC(x,m,w){return x.partial&&w&&!x.loading&&(!x.data||Object.keys(x.data).length===0)&&m.options.fetchPolicy!=="cache-only"?(m.refetch(),ut(ut({},x),{loading:!0,networkStatus:Vr.refetch})):x}var K2=Cm({loading:!0,data:void 0,error:void 0,networkStatus:Vr.loading}),J2=Cm({loading:!1,data:void 0,error:void 0,networkStatus:Vr.ready});function XC(x){return{refetch:x.refetch.bind(x),reobserve:x.reobserve.bind(x),fetchMore:x.fetchMore.bind(x),updateQuery:x.updateQuery.bind(x),startPolling:x.startPolling.bind(x),stopPolling:x.stopPolling.bind(x),subscribeToMore:x.subscribeToMore.bind(x)}}const eT="https://d375qvy687fllt.cloudfront.net/api/graphql";console.log(`[Apollo Client] Connecting to GraphQL at: ${eT}`);const YC=new G2({uri:eT,cache:new U2});var by={exports:{}},WC=by.exports,Dw;function $C(){return Dw||(Dw=1,function(x,m){(function(w,M){x.exports=M()})(WC,function(){var w,M,L;function j(n,ae){if(!w)w=ae;else if(!M)M=ae;else{var ne="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+w+")(sharedChunk); ("+M+")(sharedChunk); self.onerror = null;",ge={};w(ge),L=ae(ge),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(L.workerUrl=window.URL.createObjectURL(new Blob([ne],{type:"text/javascript"})))}}j(["exports"],function(n){function ae(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var ne,ge={},Ie={};function Re(){if(ne)return Ie;ne=1,Object.defineProperty(Ie,"__esModule",{value:!0}),Ie.setMatrixArrayType=function(h){Ie.ARRAY_TYPE=e=h},Ie.toRadian=function(h){return h*s},Ie.equals=function(h,l){return Math.abs(h-l)<=a*Math.max(1,Math.abs(h),Math.abs(l))},Ie.RANDOM=Ie.ARRAY_TYPE=Ie.EPSILON=void 0;var a=1e-6;Ie.EPSILON=a;var e=typeof Float32Array<"u"?Float32Array:Array;Ie.ARRAY_TYPE=e;var i=Math.random;Ie.RANDOM=i;var s=Math.PI/180;return Math.hypot||(Math.hypot=function(){for(var h=0,l=arguments.length;l--;)h+=arguments[l]*arguments[l];return Math.sqrt(h)}),Ie}var je,Qe={};function tt(){if(je)return Qe;function a(l){return a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(d){return typeof d}:function(d){return d&&typeof Symbol=="function"&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d},a(l)}je=1,Object.defineProperty(Qe,"__esModule",{value:!0}),Qe.create=function(){var l=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(l[1]=0,l[2]=0),l[0]=1,l[3]=1,l},Qe.clone=function(l){var d=new e.ARRAY_TYPE(4);return d[0]=l[0],d[1]=l[1],d[2]=l[2],d[3]=l[3],d},Qe.copy=function(l,d){return l[0]=d[0],l[1]=d[1],l[2]=d[2],l[3]=d[3],l},Qe.identity=function(l){return l[0]=1,l[1]=0,l[2]=0,l[3]=1,l},Qe.fromValues=function(l,d,v,S){var R=new e.ARRAY_TYPE(4);return R[0]=l,R[1]=d,R[2]=v,R[3]=S,R},Qe.set=function(l,d,v,S,R){return l[0]=d,l[1]=v,l[2]=S,l[3]=R,l},Qe.transpose=function(l,d){if(l===d){var v=d[1];l[1]=d[2],l[2]=v}else l[0]=d[0],l[1]=d[2],l[2]=d[1],l[3]=d[3];return l},Qe.invert=function(l,d){var v=d[0],S=d[1],R=d[2],g=d[3],E=v*g-R*S;return E?(l[0]=g*(E=1/E),l[1]=-S*E,l[2]=-R*E,l[3]=v*E,l):null},Qe.adjoint=function(l,d){var v=d[0];return l[0]=d[3],l[1]=-d[1],l[2]=-d[2],l[3]=v,l},Qe.determinant=function(l){return l[0]*l[3]-l[2]*l[1]},Qe.multiply=s,Qe.rotate=function(l,d,v){var S=d[0],R=d[1],g=d[2],E=d[3],D=Math.sin(v),T=Math.cos(v);return l[0]=S*T+g*D,l[1]=R*T+E*D,l[2]=S*-D+g*T,l[3]=R*-D+E*T,l},Qe.scale=function(l,d,v){var S=d[1],R=d[2],g=d[3],E=v[0],D=v[1];return l[0]=d[0]*E,l[1]=S*E,l[2]=R*D,l[3]=g*D,l},Qe.fromRotation=function(l,d){var v=Math.sin(d),S=Math.cos(d);return l[0]=S,l[1]=v,l[2]=-v,l[3]=S,l},Qe.fromScaling=function(l,d){return l[0]=d[0],l[1]=0,l[2]=0,l[3]=d[1],l},Qe.str=function(l){return"mat2("+l[0]+", "+l[1]+", "+l[2]+", "+l[3]+")"},Qe.frob=function(l){return Math.hypot(l[0],l[1],l[2],l[3])},Qe.LDU=function(l,d,v,S){return l[2]=S[2]/S[0],v[0]=S[0],v[1]=S[1],v[3]=S[3]-l[2]*v[1],[l,d,v]},Qe.add=function(l,d,v){return l[0]=d[0]+v[0],l[1]=d[1]+v[1],l[2]=d[2]+v[2],l[3]=d[3]+v[3],l},Qe.subtract=h,Qe.exactEquals=function(l,d){return l[0]===d[0]&&l[1]===d[1]&&l[2]===d[2]&&l[3]===d[3]},Qe.equals=function(l,d){var v=l[0],S=l[1],R=l[2],g=l[3],E=d[0],D=d[1],T=d[2],A=d[3];return Math.abs(v-E)<=e.EPSILON*Math.max(1,Math.abs(v),Math.abs(E))&&Math.abs(S-D)<=e.EPSILON*Math.max(1,Math.abs(S),Math.abs(D))&&Math.abs(R-T)<=e.EPSILON*Math.max(1,Math.abs(R),Math.abs(T))&&Math.abs(g-A)<=e.EPSILON*Math.max(1,Math.abs(g),Math.abs(A))},Qe.multiplyScalar=function(l,d,v){return l[0]=d[0]*v,l[1]=d[1]*v,l[2]=d[2]*v,l[3]=d[3]*v,l},Qe.multiplyScalarAndAdd=function(l,d,v,S){return l[0]=d[0]+v[0]*S,l[1]=d[1]+v[1]*S,l[2]=d[2]+v[2]*S,l[3]=d[3]+v[3]*S,l},Qe.sub=Qe.mul=void 0;var e=function(l,d){if(l&&l.__esModule)return l;if(l===null||a(l)!=="object"&&typeof l!="function")return{default:l};var v=i(void 0);if(v&&v.has(l))return v.get(l);var S={},R=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var g in l)if(g!=="default"&&Object.prototype.hasOwnProperty.call(l,g)){var E=R?Object.getOwnPropertyDescriptor(l,g):null;E&&(E.get||E.set)?Object.defineProperty(S,g,E):S[g]=l[g]}return S.default=l,v&&v.set(l,S),S}(Re());function i(l){if(typeof WeakMap!="function")return null;var d=new WeakMap,v=new WeakMap;return(i=function(S){return S?v:d})(l)}function s(l,d,v){var S=d[0],R=d[1],g=d[2],E=d[3],D=v[0],T=v[1],A=v[2],z=v[3];return l[0]=S*D+g*T,l[1]=R*D+E*T,l[2]=S*A+g*z,l[3]=R*A+E*z,l}function h(l,d,v){return l[0]=d[0]-v[0],l[1]=d[1]-v[1],l[2]=d[2]-v[2],l[3]=d[3]-v[3],l}return Qe.mul=s,Qe.sub=h,Qe}var pt,$e={};function Et(){if(pt)return $e;function a(l){return a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(d){return typeof d}:function(d){return d&&typeof Symbol=="function"&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d},a(l)}pt=1,Object.defineProperty($e,"__esModule",{value:!0}),$e.create=function(){var l=new e.ARRAY_TYPE(6);return e.ARRAY_TYPE!=Float32Array&&(l[1]=0,l[2]=0,l[4]=0,l[5]=0),l[0]=1,l[3]=1,l},$e.clone=function(l){var d=new e.ARRAY_TYPE(6);return d[0]=l[0],d[1]=l[1],d[2]=l[2],d[3]=l[3],d[4]=l[4],d[5]=l[5],d},$e.copy=function(l,d){return l[0]=d[0],l[1]=d[1],l[2]=d[2],l[3]=d[3],l[4]=d[4],l[5]=d[5],l},$e.identity=function(l){return l[0]=1,l[1]=0,l[2]=0,l[3]=1,l[4]=0,l[5]=0,l},$e.fromValues=function(l,d,v,S,R,g){var E=new e.ARRAY_TYPE(6);return E[0]=l,E[1]=d,E[2]=v,E[3]=S,E[4]=R,E[5]=g,E},$e.set=function(l,d,v,S,R,g,E){return l[0]=d,l[1]=v,l[2]=S,l[3]=R,l[4]=g,l[5]=E,l},$e.invert=function(l,d){var v=d[0],S=d[1],R=d[2],g=d[3],E=d[4],D=d[5],T=v*g-S*R;return T?(l[0]=g*(T=1/T),l[1]=-S*T,l[2]=-R*T,l[3]=v*T,l[4]=(R*D-g*E)*T,l[5]=(S*E-v*D)*T,l):null},$e.determinant=function(l){return l[0]*l[3]-l[1]*l[2]},$e.multiply=s,$e.rotate=function(l,d,v){var S=d[0],R=d[1],g=d[2],E=d[3],D=d[4],T=d[5],A=Math.sin(v),z=Math.cos(v);return l[0]=S*z+g*A,l[1]=R*z+E*A,l[2]=S*-A+g*z,l[3]=R*-A+E*z,l[4]=D,l[5]=T,l},$e.scale=function(l,d,v){var S=d[1],R=d[2],g=d[3],E=d[4],D=d[5],T=v[0],A=v[1];return l[0]=d[0]*T,l[1]=S*T,l[2]=R*A,l[3]=g*A,l[4]=E,l[5]=D,l},$e.translate=function(l,d,v){var S=d[0],R=d[1],g=d[2],E=d[3],D=d[4],T=d[5],A=v[0],z=v[1];return l[0]=S,l[1]=R,l[2]=g,l[3]=E,l[4]=S*A+g*z+D,l[5]=R*A+E*z+T,l},$e.fromRotation=function(l,d){var v=Math.sin(d),S=Math.cos(d);return l[0]=S,l[1]=v,l[2]=-v,l[3]=S,l[4]=0,l[5]=0,l},$e.fromScaling=function(l,d){return l[0]=d[0],l[1]=0,l[2]=0,l[3]=d[1],l[4]=0,l[5]=0,l},$e.fromTranslation=function(l,d){return l[0]=1,l[1]=0,l[2]=0,l[3]=1,l[4]=d[0],l[5]=d[1],l},$e.str=function(l){return"mat2d("+l[0]+", "+l[1]+", "+l[2]+", "+l[3]+", "+l[4]+", "+l[5]+")"},$e.frob=function(l){return Math.hypot(l[0],l[1],l[2],l[3],l[4],l[5],1)},$e.add=function(l,d,v){return l[0]=d[0]+v[0],l[1]=d[1]+v[1],l[2]=d[2]+v[2],l[3]=d[3]+v[3],l[4]=d[4]+v[4],l[5]=d[5]+v[5],l},$e.subtract=h,$e.multiplyScalar=function(l,d,v){return l[0]=d[0]*v,l[1]=d[1]*v,l[2]=d[2]*v,l[3]=d[3]*v,l[4]=d[4]*v,l[5]=d[5]*v,l},$e.multiplyScalarAndAdd=function(l,d,v,S){return l[0]=d[0]+v[0]*S,l[1]=d[1]+v[1]*S,l[2]=d[2]+v[2]*S,l[3]=d[3]+v[3]*S,l[4]=d[4]+v[4]*S,l[5]=d[5]+v[5]*S,l},$e.exactEquals=function(l,d){return l[0]===d[0]&&l[1]===d[1]&&l[2]===d[2]&&l[3]===d[3]&&l[4]===d[4]&&l[5]===d[5]},$e.equals=function(l,d){var v=l[0],S=l[1],R=l[2],g=l[3],E=l[4],D=l[5],T=d[0],A=d[1],z=d[2],B=d[3],N=d[4],Z=d[5];return Math.abs(v-T)<=e.EPSILON*Math.max(1,Math.abs(v),Math.abs(T))&&Math.abs(S-A)<=e.EPSILON*Math.max(1,Math.abs(S),Math.abs(A))&&Math.abs(R-z)<=e.EPSILON*Math.max(1,Math.abs(R),Math.abs(z))&&Math.abs(g-B)<=e.EPSILON*Math.max(1,Math.abs(g),Math.abs(B))&&Math.abs(E-N)<=e.EPSILON*Math.max(1,Math.abs(E),Math.abs(N))&&Math.abs(D-Z)<=e.EPSILON*Math.max(1,Math.abs(D),Math.abs(Z))},$e.sub=$e.mul=void 0;var e=function(l,d){if(l&&l.__esModule)return l;if(l===null||a(l)!=="object"&&typeof l!="function")return{default:l};var v=i(void 0);if(v&&v.has(l))return v.get(l);var S={},R=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var g in l)if(g!=="default"&&Object.prototype.hasOwnProperty.call(l,g)){var E=R?Object.getOwnPropertyDescriptor(l,g):null;E&&(E.get||E.set)?Object.defineProperty(S,g,E):S[g]=l[g]}return S.default=l,v&&v.set(l,S),S}(Re());function i(l){if(typeof WeakMap!="function")return null;var d=new WeakMap,v=new WeakMap;return(i=function(S){return S?v:d})(l)}function s(l,d,v){var S=d[0],R=d[1],g=d[2],E=d[3],D=d[4],T=d[5],A=v[0],z=v[1],B=v[2],N=v[3],Z=v[4],X=v[5];return l[0]=S*A+g*z,l[1]=R*A+E*z,l[2]=S*B+g*N,l[3]=R*B+E*N,l[4]=S*Z+g*X+D,l[5]=R*Z+E*X+T,l}function h(l,d,v){return l[0]=d[0]-v[0],l[1]=d[1]-v[1],l[2]=d[2]-v[2],l[3]=d[3]-v[3],l[4]=d[4]-v[4],l[5]=d[5]-v[5],l}return $e.mul=s,$e.sub=h,$e}var Tt,Mt={};function Ft(){if(Tt)return Mt;function a(l){return a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(d){return typeof d}:function(d){return d&&typeof Symbol=="function"&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d},a(l)}Tt=1,Object.defineProperty(Mt,"__esModule",{value:!0}),Mt.create=function(){var l=new e.ARRAY_TYPE(9);return e.ARRAY_TYPE!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[5]=0,l[6]=0,l[7]=0),l[0]=1,l[4]=1,l[8]=1,l},Mt.fromMat4=function(l,d){return l[0]=d[0],l[1]=d[1],l[2]=d[2],l[3]=d[4],l[4]=d[5],l[5]=d[6],l[6]=d[8],l[7]=d[9],l[8]=d[10],l},Mt.clone=function(l){var d=new e.ARRAY_TYPE(9);return d[0]=l[0],d[1]=l[1],d[2]=l[2],d[3]=l[3],d[4]=l[4],d[5]=l[5],d[6]=l[6],d[7]=l[7],d[8]=l[8],d},Mt.copy=function(l,d){return l[0]=d[0],l[1]=d[1],l[2]=d[2],l[3]=d[3],l[4]=d[4],l[5]=d[5],l[6]=d[6],l[7]=d[7],l[8]=d[8],l},Mt.fromValues=function(l,d,v,S,R,g,E,D,T){var A=new e.ARRAY_TYPE(9);return A[0]=l,A[1]=d,A[2]=v,A[3]=S,A[4]=R,A[5]=g,A[6]=E,A[7]=D,A[8]=T,A},Mt.set=function(l,d,v,S,R,g,E,D,T,A){return l[0]=d,l[1]=v,l[2]=S,l[3]=R,l[4]=g,l[5]=E,l[6]=D,l[7]=T,l[8]=A,l},Mt.identity=function(l){return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=1,l[5]=0,l[6]=0,l[7]=0,l[8]=1,l},Mt.transpose=function(l,d){if(l===d){var v=d[1],S=d[2],R=d[5];l[1]=d[3],l[2]=d[6],l[3]=v,l[5]=d[7],l[6]=S,l[7]=R}else l[0]=d[0],l[1]=d[3],l[2]=d[6],l[3]=d[1],l[4]=d[4],l[5]=d[7],l[6]=d[2],l[7]=d[5],l[8]=d[8];return l},Mt.invert=function(l,d){var v=d[0],S=d[1],R=d[2],g=d[3],E=d[4],D=d[5],T=d[6],A=d[7],z=d[8],B=z*E-D*A,N=-z*g+D*T,Z=A*g-E*T,X=v*B+S*N+R*Z;return X?(l[0]=B*(X=1/X),l[1]=(-z*S+R*A)*X,l[2]=(D*S-R*E)*X,l[3]=N*X,l[4]=(z*v-R*T)*X,l[5]=(-D*v+R*g)*X,l[6]=Z*X,l[7]=(-A*v+S*T)*X,l[8]=(E*v-S*g)*X,l):null},Mt.adjoint=function(l,d){var v=d[0],S=d[1],R=d[2],g=d[3],E=d[4],D=d[5],T=d[6],A=d[7],z=d[8];return l[0]=E*z-D*A,l[1]=R*A-S*z,l[2]=S*D-R*E,l[3]=D*T-g*z,l[4]=v*z-R*T,l[5]=R*g-v*D,l[6]=g*A-E*T,l[7]=S*T-v*A,l[8]=v*E-S*g,l},Mt.determinant=function(l){var d=l[3],v=l[4],S=l[5],R=l[6],g=l[7],E=l[8];return l[0]*(E*v-S*g)+l[1]*(-E*d+S*R)+l[2]*(g*d-v*R)},Mt.multiply=s,Mt.translate=function(l,d,v){var S=d[0],R=d[1],g=d[2],E=d[3],D=d[4],T=d[5],A=d[6],z=d[7],B=d[8],N=v[0],Z=v[1];return l[0]=S,l[1]=R,l[2]=g,l[3]=E,l[4]=D,l[5]=T,l[6]=N*S+Z*E+A,l[7]=N*R+Z*D+z,l[8]=N*g+Z*T+B,l},Mt.rotate=function(l,d,v){var S=d[0],R=d[1],g=d[2],E=d[3],D=d[4],T=d[5],A=d[6],z=d[7],B=d[8],N=Math.sin(v),Z=Math.cos(v);return l[0]=Z*S+N*E,l[1]=Z*R+N*D,l[2]=Z*g+N*T,l[3]=Z*E-N*S,l[4]=Z*D-N*R,l[5]=Z*T-N*g,l[6]=A,l[7]=z,l[8]=B,l},Mt.scale=function(l,d,v){var S=v[0],R=v[1];return l[0]=S*d[0],l[1]=S*d[1],l[2]=S*d[2],l[3]=R*d[3],l[4]=R*d[4],l[5]=R*d[5],l[6]=d[6],l[7]=d[7],l[8]=d[8],l},Mt.fromTranslation=function(l,d){return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=1,l[5]=0,l[6]=d[0],l[7]=d[1],l[8]=1,l},Mt.fromRotation=function(l,d){var v=Math.sin(d),S=Math.cos(d);return l[0]=S,l[1]=v,l[2]=0,l[3]=-v,l[4]=S,l[5]=0,l[6]=0,l[7]=0,l[8]=1,l},Mt.fromScaling=function(l,d){return l[0]=d[0],l[1]=0,l[2]=0,l[3]=0,l[4]=d[1],l[5]=0,l[6]=0,l[7]=0,l[8]=1,l},Mt.fromMat2d=function(l,d){return l[0]=d[0],l[1]=d[1],l[2]=0,l[3]=d[2],l[4]=d[3],l[5]=0,l[6]=d[4],l[7]=d[5],l[8]=1,l},Mt.fromQuat=function(l,d){var v=d[0],S=d[1],R=d[2],g=d[3],E=v+v,D=S+S,T=R+R,A=v*E,z=S*E,B=S*D,N=R*E,Z=R*D,X=R*T,q=g*E,Y=g*D,K=g*T;return l[0]=1-B-X,l[3]=z-K,l[6]=N+Y,l[1]=z+K,l[4]=1-A-X,l[7]=Z-q,l[2]=N-Y,l[5]=Z+q,l[8]=1-A-B,l},Mt.normalFromMat4=function(l,d){var v=d[0],S=d[1],R=d[2],g=d[3],E=d[4],D=d[5],T=d[6],A=d[7],z=d[8],B=d[9],N=d[10],Z=d[11],X=d[12],q=d[13],Y=d[14],K=d[15],re=v*D-S*E,he=v*T-R*E,ue=v*A-g*E,ce=S*T-R*D,Te=S*A-g*D,de=R*A-g*T,Se=z*q-B*X,Ce=z*Y-N*X,Me=z*K-Z*X,Le=B*Y-N*q,ke=B*K-Z*q,Ue=N*K-Z*Y,Pe=re*Ue-he*ke+ue*Le+ce*Me-Te*Ce+de*Se;return Pe?(l[0]=(D*Ue-T*ke+A*Le)*(Pe=1/Pe),l[1]=(T*Me-E*Ue-A*Ce)*Pe,l[2]=(E*ke-D*Me+A*Se)*Pe,l[3]=(R*ke-S*Ue-g*Le)*Pe,l[4]=(v*Ue-R*Me+g*Ce)*Pe,l[5]=(S*Me-v*ke-g*Se)*Pe,l[6]=(q*de-Y*Te+K*ce)*Pe,l[7]=(Y*ue-X*de-K*he)*Pe,l[8]=(X*Te-q*ue+K*re)*Pe,l):null},Mt.projection=function(l,d,v){return l[0]=2/d,l[1]=0,l[2]=0,l[3]=0,l[4]=-2/v,l[5]=0,l[6]=-1,l[7]=1,l[8]=1,l},Mt.str=function(l){return"mat3("+l[0]+", "+l[1]+", "+l[2]+", "+l[3]+", "+l[4]+", "+l[5]+", "+l[6]+", "+l[7]+", "+l[8]+")"},Mt.frob=function(l){return Math.hypot(l[0],l[1],l[2],l[3],l[4],l[5],l[6],l[7],l[8])},Mt.add=function(l,d,v){return l[0]=d[0]+v[0],l[1]=d[1]+v[1],l[2]=d[2]+v[2],l[3]=d[3]+v[3],l[4]=d[4]+v[4],l[5]=d[5]+v[5],l[6]=d[6]+v[6],l[7]=d[7]+v[7],l[8]=d[8]+v[8],l},Mt.subtract=h,Mt.multiplyScalar=function(l,d,v){return l[0]=d[0]*v,l[1]=d[1]*v,l[2]=d[2]*v,l[3]=d[3]*v,l[4]=d[4]*v,l[5]=d[5]*v,l[6]=d[6]*v,l[7]=d[7]*v,l[8]=d[8]*v,l},Mt.multiplyScalarAndAdd=function(l,d,v,S){return l[0]=d[0]+v[0]*S,l[1]=d[1]+v[1]*S,l[2]=d[2]+v[2]*S,l[3]=d[3]+v[3]*S,l[4]=d[4]+v[4]*S,l[5]=d[5]+v[5]*S,l[6]=d[6]+v[6]*S,l[7]=d[7]+v[7]*S,l[8]=d[8]+v[8]*S,l},Mt.exactEquals=function(l,d){return l[0]===d[0]&&l[1]===d[1]&&l[2]===d[2]&&l[3]===d[3]&&l[4]===d[4]&&l[5]===d[5]&&l[6]===d[6]&&l[7]===d[7]&&l[8]===d[8]},Mt.equals=function(l,d){var v=l[0],S=l[1],R=l[2],g=l[3],E=l[4],D=l[5],T=l[6],A=l[7],z=l[8],B=d[0],N=d[1],Z=d[2],X=d[3],q=d[4],Y=d[5],K=d[6],re=d[7],he=d[8];return Math.abs(v-B)<=e.EPSILON*Math.max(1,Math.abs(v),Math.abs(B))&&Math.abs(S-N)<=e.EPSILON*Math.max(1,Math.abs(S),Math.abs(N))&&Math.abs(R-Z)<=e.EPSILON*Math.max(1,Math.abs(R),Math.abs(Z))&&Math.abs(g-X)<=e.EPSILON*Math.max(1,Math.abs(g),Math.abs(X))&&Math.abs(E-q)<=e.EPSILON*Math.max(1,Math.abs(E),Math.abs(q))&&Math.abs(D-Y)<=e.EPSILON*Math.max(1,Math.abs(D),Math.abs(Y))&&Math.abs(T-K)<=e.EPSILON*Math.max(1,Math.abs(T),Math.abs(K))&&Math.abs(A-re)<=e.EPSILON*Math.max(1,Math.abs(A),Math.abs(re))&&Math.abs(z-he)<=e.EPSILON*Math.max(1,Math.abs(z),Math.abs(he))},Mt.sub=Mt.mul=void 0;var e=function(l,d){if(l&&l.__esModule)return l;if(l===null||a(l)!=="object"&&typeof l!="function")return{default:l};var v=i(void 0);if(v&&v.has(l))return v.get(l);var S={},R=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var g in l)if(g!=="default"&&Object.prototype.hasOwnProperty.call(l,g)){var E=R?Object.getOwnPropertyDescriptor(l,g):null;E&&(E.get||E.set)?Object.defineProperty(S,g,E):S[g]=l[g]}return S.default=l,v&&v.set(l,S),S}(Re());function i(l){if(typeof WeakMap!="function")return null;var d=new WeakMap,v=new WeakMap;return(i=function(S){return S?v:d})(l)}function s(l,d,v){var S=d[0],R=d[1],g=d[2],E=d[3],D=d[4],T=d[5],A=d[6],z=d[7],B=d[8],N=v[0],Z=v[1],X=v[2],q=v[3],Y=v[4],K=v[5],re=v[6],he=v[7],ue=v[8];return l[0]=N*S+Z*E+X*A,l[1]=N*R+Z*D+X*z,l[2]=N*g+Z*T+X*B,l[3]=q*S+Y*E+K*A,l[4]=q*R+Y*D+K*z,l[5]=q*g+Y*T+K*B,l[6]=re*S+he*E+ue*A,l[7]=re*R+he*D+ue*z,l[8]=re*g+he*T+ue*B,l}function h(l,d,v){return l[0]=d[0]-v[0],l[1]=d[1]-v[1],l[2]=d[2]-v[2],l[3]=d[3]-v[3],l[4]=d[4]-v[4],l[5]=d[5]-v[5],l[6]=d[6]-v[6],l[7]=d[7]-v[7],l[8]=d[8]-v[8],l}return Mt.mul=s,Mt.sub=h,Mt}var ni,qt={};function Fi(){if(ni)return qt;function a(g){return a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(E){return typeof E}:function(E){return E&&typeof Symbol=="function"&&E.constructor===Symbol&&E!==Symbol.prototype?"symbol":typeof E},a(g)}ni=1,Object.defineProperty(qt,"__esModule",{value:!0}),qt.create=function(){var g=new e.ARRAY_TYPE(16);return e.ARRAY_TYPE!=Float32Array&&(g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[6]=0,g[7]=0,g[8]=0,g[9]=0,g[11]=0,g[12]=0,g[13]=0,g[14]=0),g[0]=1,g[5]=1,g[10]=1,g[15]=1,g},qt.clone=function(g){var E=new e.ARRAY_TYPE(16);return E[0]=g[0],E[1]=g[1],E[2]=g[2],E[3]=g[3],E[4]=g[4],E[5]=g[5],E[6]=g[6],E[7]=g[7],E[8]=g[8],E[9]=g[9],E[10]=g[10],E[11]=g[11],E[12]=g[12],E[13]=g[13],E[14]=g[14],E[15]=g[15],E},qt.copy=function(g,E){return g[0]=E[0],g[1]=E[1],g[2]=E[2],g[3]=E[3],g[4]=E[4],g[5]=E[5],g[6]=E[6],g[7]=E[7],g[8]=E[8],g[9]=E[9],g[10]=E[10],g[11]=E[11],g[12]=E[12],g[13]=E[13],g[14]=E[14],g[15]=E[15],g},qt.fromValues=function(g,E,D,T,A,z,B,N,Z,X,q,Y,K,re,he,ue){var ce=new e.ARRAY_TYPE(16);return ce[0]=g,ce[1]=E,ce[2]=D,ce[3]=T,ce[4]=A,ce[5]=z,ce[6]=B,ce[7]=N,ce[8]=Z,ce[9]=X,ce[10]=q,ce[11]=Y,ce[12]=K,ce[13]=re,ce[14]=he,ce[15]=ue,ce},qt.set=function(g,E,D,T,A,z,B,N,Z,X,q,Y,K,re,he,ue,ce){return g[0]=E,g[1]=D,g[2]=T,g[3]=A,g[4]=z,g[5]=B,g[6]=N,g[7]=Z,g[8]=X,g[9]=q,g[10]=Y,g[11]=K,g[12]=re,g[13]=he,g[14]=ue,g[15]=ce,g},qt.identity=s,qt.transpose=function(g,E){if(g===E){var D=E[1],T=E[2],A=E[3],z=E[6],B=E[7],N=E[11];g[1]=E[4],g[2]=E[8],g[3]=E[12],g[4]=D,g[6]=E[9],g[7]=E[13],g[8]=T,g[9]=z,g[11]=E[14],g[12]=A,g[13]=B,g[14]=N}else g[0]=E[0],g[1]=E[4],g[2]=E[8],g[3]=E[12],g[4]=E[1],g[5]=E[5],g[6]=E[9],g[7]=E[13],g[8]=E[2],g[9]=E[6],g[10]=E[10],g[11]=E[14],g[12]=E[3],g[13]=E[7],g[14]=E[11],g[15]=E[15];return g},qt.invert=function(g,E){var D=E[0],T=E[1],A=E[2],z=E[3],B=E[4],N=E[5],Z=E[6],X=E[7],q=E[8],Y=E[9],K=E[10],re=E[11],he=E[12],ue=E[13],ce=E[14],Te=E[15],de=D*N-T*B,Se=D*Z-A*B,Ce=D*X-z*B,Me=T*Z-A*N,Le=T*X-z*N,ke=A*X-z*Z,Ue=q*ue-Y*he,Pe=q*ce-K*he,at=q*Te-re*he,mt=Y*ce-K*ue,nt=Y*Te-re*ue,Bt=K*Te-re*ce,Ot=de*Bt-Se*nt+Ce*mt+Me*at-Le*Pe+ke*Ue;return Ot?(g[0]=(N*Bt-Z*nt+X*mt)*(Ot=1/Ot),g[1]=(A*nt-T*Bt-z*mt)*Ot,g[2]=(ue*ke-ce*Le+Te*Me)*Ot,g[3]=(K*Le-Y*ke-re*Me)*Ot,g[4]=(Z*at-B*Bt-X*Pe)*Ot,g[5]=(D*Bt-A*at+z*Pe)*Ot,g[6]=(ce*Ce-he*ke-Te*Se)*Ot,g[7]=(q*ke-K*Ce+re*Se)*Ot,g[8]=(B*nt-N*at+X*Ue)*Ot,g[9]=(T*at-D*nt-z*Ue)*Ot,g[10]=(he*Le-ue*Ce+Te*de)*Ot,g[11]=(Y*Ce-q*Le-re*de)*Ot,g[12]=(N*Pe-B*mt-Z*Ue)*Ot,g[13]=(D*mt-T*Pe+A*Ue)*Ot,g[14]=(ue*Se-he*Me-ce*de)*Ot,g[15]=(q*Me-Y*Se+K*de)*Ot,g):null},qt.adjoint=function(g,E){var D=E[0],T=E[1],A=E[2],z=E[3],B=E[4],N=E[5],Z=E[6],X=E[7],q=E[8],Y=E[9],K=E[10],re=E[11],he=E[12],ue=E[13],ce=E[14],Te=E[15];return g[0]=N*(K*Te-re*ce)-Y*(Z*Te-X*ce)+ue*(Z*re-X*K),g[1]=-(T*(K*Te-re*ce)-Y*(A*Te-z*ce)+ue*(A*re-z*K)),g[2]=T*(Z*Te-X*ce)-N*(A*Te-z*ce)+ue*(A*X-z*Z),g[3]=-(T*(Z*re-X*K)-N*(A*re-z*K)+Y*(A*X-z*Z)),g[4]=-(B*(K*Te-re*ce)-q*(Z*Te-X*ce)+he*(Z*re-X*K)),g[5]=D*(K*Te-re*ce)-q*(A*Te-z*ce)+he*(A*re-z*K),g[6]=-(D*(Z*Te-X*ce)-B*(A*Te-z*ce)+he*(A*X-z*Z)),g[7]=D*(Z*re-X*K)-B*(A*re-z*K)+q*(A*X-z*Z),g[8]=B*(Y*Te-re*ue)-q*(N*Te-X*ue)+he*(N*re-X*Y),g[9]=-(D*(Y*Te-re*ue)-q*(T*Te-z*ue)+he*(T*re-z*Y)),g[10]=D*(N*Te-X*ue)-B*(T*Te-z*ue)+he*(T*X-z*N),g[11]=-(D*(N*re-X*Y)-B*(T*re-z*Y)+q*(T*X-z*N)),g[12]=-(B*(Y*ce-K*ue)-q*(N*ce-Z*ue)+he*(N*K-Z*Y)),g[13]=D*(Y*ce-K*ue)-q*(T*ce-A*ue)+he*(T*K-A*Y),g[14]=-(D*(N*ce-Z*ue)-B*(T*ce-A*ue)+he*(T*Z-A*N)),g[15]=D*(N*K-Z*Y)-B*(T*K-A*Y)+q*(T*Z-A*N),g},qt.determinant=function(g){var E=g[0],D=g[1],T=g[2],A=g[3],z=g[4],B=g[5],N=g[6],Z=g[7],X=g[8],q=g[9],Y=g[10],K=g[11],re=g[12],he=g[13],ue=g[14],ce=g[15];return(E*B-D*z)*(Y*ce-K*ue)-(E*N-T*z)*(q*ce-K*he)+(E*Z-A*z)*(q*ue-Y*he)+(D*N-T*B)*(X*ce-K*re)-(D*Z-A*B)*(X*ue-Y*re)+(T*Z-A*N)*(X*he-q*re)},qt.multiply=h,qt.translate=function(g,E,D){var T,A,z,B,N,Z,X,q,Y,K,re,he,ue=D[0],ce=D[1],Te=D[2];return E===g?(g[12]=E[0]*ue+E[4]*ce+E[8]*Te+E[12],g[13]=E[1]*ue+E[5]*ce+E[9]*Te+E[13],g[14]=E[2]*ue+E[6]*ce+E[10]*Te+E[14],g[15]=E[3]*ue+E[7]*ce+E[11]*Te+E[15]):(A=E[1],z=E[2],B=E[3],N=E[4],Z=E[5],X=E[6],q=E[7],Y=E[8],K=E[9],re=E[10],he=E[11],g[0]=T=E[0],g[1]=A,g[2]=z,g[3]=B,g[4]=N,g[5]=Z,g[6]=X,g[7]=q,g[8]=Y,g[9]=K,g[10]=re,g[11]=he,g[12]=T*ue+N*ce+Y*Te+E[12],g[13]=A*ue+Z*ce+K*Te+E[13],g[14]=z*ue+X*ce+re*Te+E[14],g[15]=B*ue+q*ce+he*Te+E[15]),g},qt.scale=function(g,E,D){var T=D[0],A=D[1],z=D[2];return g[0]=E[0]*T,g[1]=E[1]*T,g[2]=E[2]*T,g[3]=E[3]*T,g[4]=E[4]*A,g[5]=E[5]*A,g[6]=E[6]*A,g[7]=E[7]*A,g[8]=E[8]*z,g[9]=E[9]*z,g[10]=E[10]*z,g[11]=E[11]*z,g[12]=E[12],g[13]=E[13],g[14]=E[14],g[15]=E[15],g},qt.rotate=function(g,E,D,T){var A,z,B,N,Z,X,q,Y,K,re,he,ue,ce,Te,de,Se,Ce,Me,Le,ke,Ue,Pe,at,mt,nt=T[0],Bt=T[1],Ot=T[2],bt=Math.hypot(nt,Bt,Ot);return bt<e.EPSILON?null:(nt*=bt=1/bt,Bt*=bt,Ot*=bt,A=Math.sin(D),z=Math.cos(D),Z=E[1],X=E[2],q=E[3],K=E[5],re=E[6],he=E[7],ce=E[9],Te=E[10],de=E[11],Se=nt*nt*(B=1-z)+z,Le=nt*Bt*B-Ot*A,ke=Bt*Bt*B+z,Ue=Ot*Bt*B+nt*A,Pe=nt*Ot*B+Bt*A,at=Bt*Ot*B-nt*A,mt=Ot*Ot*B+z,g[0]=(N=E[0])*Se+(Y=E[4])*(Ce=Bt*nt*B+Ot*A)+(ue=E[8])*(Me=Ot*nt*B-Bt*A),g[1]=Z*Se+K*Ce+ce*Me,g[2]=X*Se+re*Ce+Te*Me,g[3]=q*Se+he*Ce+de*Me,g[4]=N*Le+Y*ke+ue*Ue,g[5]=Z*Le+K*ke+ce*Ue,g[6]=X*Le+re*ke+Te*Ue,g[7]=q*Le+he*ke+de*Ue,g[8]=N*Pe+Y*at+ue*mt,g[9]=Z*Pe+K*at+ce*mt,g[10]=X*Pe+re*at+Te*mt,g[11]=q*Pe+he*at+de*mt,E!==g&&(g[12]=E[12],g[13]=E[13],g[14]=E[14],g[15]=E[15]),g)},qt.rotateX=function(g,E,D){var T=Math.sin(D),A=Math.cos(D),z=E[4],B=E[5],N=E[6],Z=E[7],X=E[8],q=E[9],Y=E[10],K=E[11];return E!==g&&(g[0]=E[0],g[1]=E[1],g[2]=E[2],g[3]=E[3],g[12]=E[12],g[13]=E[13],g[14]=E[14],g[15]=E[15]),g[4]=z*A+X*T,g[5]=B*A+q*T,g[6]=N*A+Y*T,g[7]=Z*A+K*T,g[8]=X*A-z*T,g[9]=q*A-B*T,g[10]=Y*A-N*T,g[11]=K*A-Z*T,g},qt.rotateY=function(g,E,D){var T=Math.sin(D),A=Math.cos(D),z=E[0],B=E[1],N=E[2],Z=E[3],X=E[8],q=E[9],Y=E[10],K=E[11];return E!==g&&(g[4]=E[4],g[5]=E[5],g[6]=E[6],g[7]=E[7],g[12]=E[12],g[13]=E[13],g[14]=E[14],g[15]=E[15]),g[0]=z*A-X*T,g[1]=B*A-q*T,g[2]=N*A-Y*T,g[3]=Z*A-K*T,g[8]=z*T+X*A,g[9]=B*T+q*A,g[10]=N*T+Y*A,g[11]=Z*T+K*A,g},qt.rotateZ=function(g,E,D){var T=Math.sin(D),A=Math.cos(D),z=E[0],B=E[1],N=E[2],Z=E[3],X=E[4],q=E[5],Y=E[6],K=E[7];return E!==g&&(g[8]=E[8],g[9]=E[9],g[10]=E[10],g[11]=E[11],g[12]=E[12],g[13]=E[13],g[14]=E[14],g[15]=E[15]),g[0]=z*A+X*T,g[1]=B*A+q*T,g[2]=N*A+Y*T,g[3]=Z*A+K*T,g[4]=X*A-z*T,g[5]=q*A-B*T,g[6]=Y*A-N*T,g[7]=K*A-Z*T,g},qt.fromTranslation=function(g,E){return g[0]=1,g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[5]=1,g[6]=0,g[7]=0,g[8]=0,g[9]=0,g[10]=1,g[11]=0,g[12]=E[0],g[13]=E[1],g[14]=E[2],g[15]=1,g},qt.fromScaling=function(g,E){return g[0]=E[0],g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[5]=E[1],g[6]=0,g[7]=0,g[8]=0,g[9]=0,g[10]=E[2],g[11]=0,g[12]=0,g[13]=0,g[14]=0,g[15]=1,g},qt.fromRotation=function(g,E,D){var T,A,z,B=D[0],N=D[1],Z=D[2],X=Math.hypot(B,N,Z);return X<e.EPSILON?null:(B*=X=1/X,N*=X,Z*=X,T=Math.sin(E),A=Math.cos(E),g[0]=B*B*(z=1-A)+A,g[1]=N*B*z+Z*T,g[2]=Z*B*z-N*T,g[3]=0,g[4]=B*N*z-Z*T,g[5]=N*N*z+A,g[6]=Z*N*z+B*T,g[7]=0,g[8]=B*Z*z+N*T,g[9]=N*Z*z-B*T,g[10]=Z*Z*z+A,g[11]=0,g[12]=0,g[13]=0,g[14]=0,g[15]=1,g)},qt.fromXRotation=function(g,E){var D=Math.sin(E),T=Math.cos(E);return g[0]=1,g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[5]=T,g[6]=D,g[7]=0,g[8]=0,g[9]=-D,g[10]=T,g[11]=0,g[12]=0,g[13]=0,g[14]=0,g[15]=1,g},qt.fromYRotation=function(g,E){var D=Math.sin(E),T=Math.cos(E);return g[0]=T,g[1]=0,g[2]=-D,g[3]=0,g[4]=0,g[5]=1,g[6]=0,g[7]=0,g[8]=D,g[9]=0,g[10]=T,g[11]=0,g[12]=0,g[13]=0,g[14]=0,g[15]=1,g},qt.fromZRotation=function(g,E){var D=Math.sin(E),T=Math.cos(E);return g[0]=T,g[1]=D,g[2]=0,g[3]=0,g[4]=-D,g[5]=T,g[6]=0,g[7]=0,g[8]=0,g[9]=0,g[10]=1,g[11]=0,g[12]=0,g[13]=0,g[14]=0,g[15]=1,g},qt.fromRotationTranslation=l,qt.fromQuat2=function(g,E){var D=new e.ARRAY_TYPE(3),T=-E[0],A=-E[1],z=-E[2],B=E[3],N=E[4],Z=E[5],X=E[6],q=E[7],Y=T*T+A*A+z*z+B*B;return Y>0?(D[0]=2*(N*B+q*T+Z*z-X*A)/Y,D[1]=2*(Z*B+q*A+X*T-N*z)/Y,D[2]=2*(X*B+q*z+N*A-Z*T)/Y):(D[0]=2*(N*B+q*T+Z*z-X*A),D[1]=2*(Z*B+q*A+X*T-N*z),D[2]=2*(X*B+q*z+N*A-Z*T)),l(g,E,D),g},qt.getTranslation=function(g,E){return g[0]=E[12],g[1]=E[13],g[2]=E[14],g},qt.getScaling=d,qt.getRotation=function(g,E){var D=new e.ARRAY_TYPE(3);d(D,E);var T=1/D[0],A=1/D[1],z=1/D[2],B=E[0]*T,N=E[1]*A,Z=E[2]*z,X=E[4]*T,q=E[5]*A,Y=E[6]*z,K=E[8]*T,re=E[9]*A,he=E[10]*z,ue=B+q+he,ce=0;return ue>0?(ce=2*Math.sqrt(ue+1),g[3]=.25*ce,g[0]=(Y-re)/ce,g[1]=(K-Z)/ce,g[2]=(N-X)/ce):B>q&&B>he?(ce=2*Math.sqrt(1+B-q-he),g[3]=(Y-re)/ce,g[0]=.25*ce,g[1]=(N+X)/ce,g[2]=(K+Z)/ce):q>he?(ce=2*Math.sqrt(1+q-B-he),g[3]=(K-Z)/ce,g[0]=(N+X)/ce,g[1]=.25*ce,g[2]=(Y+re)/ce):(ce=2*Math.sqrt(1+he-B-q),g[3]=(N-X)/ce,g[0]=(K+Z)/ce,g[1]=(Y+re)/ce,g[2]=.25*ce),g},qt.fromRotationTranslationScale=function(g,E,D,T){var A=E[0],z=E[1],B=E[2],N=E[3],Z=A+A,X=z+z,q=B+B,Y=A*Z,K=A*X,re=A*q,he=z*X,ue=z*q,ce=B*q,Te=N*Z,de=N*X,Se=N*q,Ce=T[0],Me=T[1],Le=T[2];return g[0]=(1-(he+ce))*Ce,g[1]=(K+Se)*Ce,g[2]=(re-de)*Ce,g[3]=0,g[4]=(K-Se)*Me,g[5]=(1-(Y+ce))*Me,g[6]=(ue+Te)*Me,g[7]=0,g[8]=(re+de)*Le,g[9]=(ue-Te)*Le,g[10]=(1-(Y+he))*Le,g[11]=0,g[12]=D[0],g[13]=D[1],g[14]=D[2],g[15]=1,g},qt.fromRotationTranslationScaleOrigin=function(g,E,D,T,A){var z=E[0],B=E[1],N=E[2],Z=E[3],X=z+z,q=B+B,Y=N+N,K=z*X,re=z*q,he=z*Y,ue=B*q,ce=B*Y,Te=N*Y,de=Z*X,Se=Z*q,Ce=Z*Y,Me=T[0],Le=T[1],ke=T[2],Ue=A[0],Pe=A[1],at=A[2],mt=(1-(ue+Te))*Me,nt=(re+Ce)*Me,Bt=(he-Se)*Me,Ot=(re-Ce)*Le,bt=(1-(K+Te))*Le,yt=(ce+de)*Le,ei=(he+Se)*ke,jt=(ce-de)*ke,Wt=(1-(K+ue))*ke;return g[0]=mt,g[1]=nt,g[2]=Bt,g[3]=0,g[4]=Ot,g[5]=bt,g[6]=yt,g[7]=0,g[8]=ei,g[9]=jt,g[10]=Wt,g[11]=0,g[12]=D[0]+Ue-(mt*Ue+Ot*Pe+ei*at),g[13]=D[1]+Pe-(nt*Ue+bt*Pe+jt*at),g[14]=D[2]+at-(Bt*Ue+yt*Pe+Wt*at),g[15]=1,g},qt.fromQuat=function(g,E){var D=E[0],T=E[1],A=E[2],z=E[3],B=D+D,N=T+T,Z=A+A,X=D*B,q=T*B,Y=T*N,K=A*B,re=A*N,he=A*Z,ue=z*B,ce=z*N,Te=z*Z;return g[0]=1-Y-he,g[1]=q+Te,g[2]=K-ce,g[3]=0,g[4]=q-Te,g[5]=1-X-he,g[6]=re+ue,g[7]=0,g[8]=K+ce,g[9]=re-ue,g[10]=1-X-Y,g[11]=0,g[12]=0,g[13]=0,g[14]=0,g[15]=1,g},qt.frustum=function(g,E,D,T,A,z,B){var N=1/(D-E),Z=1/(A-T),X=1/(z-B);return g[0]=2*z*N,g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[5]=2*z*Z,g[6]=0,g[7]=0,g[8]=(D+E)*N,g[9]=(A+T)*Z,g[10]=(B+z)*X,g[11]=-1,g[12]=0,g[13]=0,g[14]=B*z*2*X,g[15]=0,g},qt.perspectiveNO=v,qt.perspectiveZO=function(g,E,D,T,A){var z,B=1/Math.tan(E/2);return g[0]=B/D,g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[5]=B,g[6]=0,g[7]=0,g[8]=0,g[9]=0,g[11]=-1,g[12]=0,g[13]=0,g[15]=0,A!=null&&A!==1/0?(g[10]=A*(z=1/(T-A)),g[14]=A*T*z):(g[10]=-1,g[14]=-T),g},qt.perspectiveFromFieldOfView=function(g,E,D,T){var A=Math.tan(E.upDegrees*Math.PI/180),z=Math.tan(E.downDegrees*Math.PI/180),B=Math.tan(E.leftDegrees*Math.PI/180),N=Math.tan(E.rightDegrees*Math.PI/180),Z=2/(B+N),X=2/(A+z);return g[0]=Z,g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[5]=X,g[6]=0,g[7]=0,g[8]=-(B-N)*Z*.5,g[9]=(A-z)*X*.5,g[10]=T/(D-T),g[11]=-1,g[12]=0,g[13]=0,g[14]=T*D/(D-T),g[15]=0,g},qt.orthoNO=S,qt.orthoZO=function(g,E,D,T,A,z,B){var N=1/(E-D),Z=1/(T-A),X=1/(z-B);return g[0]=-2*N,g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[5]=-2*Z,g[6]=0,g[7]=0,g[8]=0,g[9]=0,g[10]=X,g[11]=0,g[12]=(E+D)*N,g[13]=(A+T)*Z,g[14]=z*X,g[15]=1,g},qt.lookAt=function(g,E,D,T){var A,z,B,N,Z,X,q,Y,K,re,he=E[0],ue=E[1],ce=E[2],Te=T[0],de=T[1],Se=T[2],Ce=D[0],Me=D[1],Le=D[2];return Math.abs(he-Ce)<e.EPSILON&&Math.abs(ue-Me)<e.EPSILON&&Math.abs(ce-Le)<e.EPSILON?s(g):(q=he-Ce,Y=ue-Me,K=ce-Le,A=de*(K*=re=1/Math.hypot(q,Y,K))-Se*(Y*=re),z=Se*(q*=re)-Te*K,B=Te*Y-de*q,(re=Math.hypot(A,z,B))?(A*=re=1/re,z*=re,B*=re):(A=0,z=0,B=0),N=Y*B-K*z,Z=K*A-q*B,X=q*z-Y*A,(re=Math.hypot(N,Z,X))?(N*=re=1/re,Z*=re,X*=re):(N=0,Z=0,X=0),g[0]=A,g[1]=N,g[2]=q,g[3]=0,g[4]=z,g[5]=Z,g[6]=Y,g[7]=0,g[8]=B,g[9]=X,g[10]=K,g[11]=0,g[12]=-(A*he+z*ue+B*ce),g[13]=-(N*he+Z*ue+X*ce),g[14]=-(q*he+Y*ue+K*ce),g[15]=1,g)},qt.targetTo=function(g,E,D,T){var A=E[0],z=E[1],B=E[2],N=T[0],Z=T[1],X=T[2],q=A-D[0],Y=z-D[1],K=B-D[2],re=q*q+Y*Y+K*K;re>0&&(q*=re=1/Math.sqrt(re),Y*=re,K*=re);var he=Z*K-X*Y,ue=X*q-N*K,ce=N*Y-Z*q;return(re=he*he+ue*ue+ce*ce)>0&&(he*=re=1/Math.sqrt(re),ue*=re,ce*=re),g[0]=he,g[1]=ue,g[2]=ce,g[3]=0,g[4]=Y*ce-K*ue,g[5]=K*he-q*ce,g[6]=q*ue-Y*he,g[7]=0,g[8]=q,g[9]=Y,g[10]=K,g[11]=0,g[12]=A,g[13]=z,g[14]=B,g[15]=1,g},qt.str=function(g){return"mat4("+g[0]+", "+g[1]+", "+g[2]+", "+g[3]+", "+g[4]+", "+g[5]+", "+g[6]+", "+g[7]+", "+g[8]+", "+g[9]+", "+g[10]+", "+g[11]+", "+g[12]+", "+g[13]+", "+g[14]+", "+g[15]+")"},qt.frob=function(g){return Math.hypot(g[0],g[1],g[2],g[3],g[4],g[5],g[6],g[7],g[8],g[9],g[10],g[11],g[12],g[13],g[14],g[15])},qt.add=function(g,E,D){return g[0]=E[0]+D[0],g[1]=E[1]+D[1],g[2]=E[2]+D[2],g[3]=E[3]+D[3],g[4]=E[4]+D[4],g[5]=E[5]+D[5],g[6]=E[6]+D[6],g[7]=E[7]+D[7],g[8]=E[8]+D[8],g[9]=E[9]+D[9],g[10]=E[10]+D[10],g[11]=E[11]+D[11],g[12]=E[12]+D[12],g[13]=E[13]+D[13],g[14]=E[14]+D[14],g[15]=E[15]+D[15],g},qt.subtract=R,qt.multiplyScalar=function(g,E,D){return g[0]=E[0]*D,g[1]=E[1]*D,g[2]=E[2]*D,g[3]=E[3]*D,g[4]=E[4]*D,g[5]=E[5]*D,g[6]=E[6]*D,g[7]=E[7]*D,g[8]=E[8]*D,g[9]=E[9]*D,g[10]=E[10]*D,g[11]=E[11]*D,g[12]=E[12]*D,g[13]=E[13]*D,g[14]=E[14]*D,g[15]=E[15]*D,g},qt.multiplyScalarAndAdd=function(g,E,D,T){return g[0]=E[0]+D[0]*T,g[1]=E[1]+D[1]*T,g[2]=E[2]+D[2]*T,g[3]=E[3]+D[3]*T,g[4]=E[4]+D[4]*T,g[5]=E[5]+D[5]*T,g[6]=E[6]+D[6]*T,g[7]=E[7]+D[7]*T,g[8]=E[8]+D[8]*T,g[9]=E[9]+D[9]*T,g[10]=E[10]+D[10]*T,g[11]=E[11]+D[11]*T,g[12]=E[12]+D[12]*T,g[13]=E[13]+D[13]*T,g[14]=E[14]+D[14]*T,g[15]=E[15]+D[15]*T,g},qt.exactEquals=function(g,E){return g[0]===E[0]&&g[1]===E[1]&&g[2]===E[2]&&g[3]===E[3]&&g[4]===E[4]&&g[5]===E[5]&&g[6]===E[6]&&g[7]===E[7]&&g[8]===E[8]&&g[9]===E[9]&&g[10]===E[10]&&g[11]===E[11]&&g[12]===E[12]&&g[13]===E[13]&&g[14]===E[14]&&g[15]===E[15]},qt.equals=function(g,E){var D=g[0],T=g[1],A=g[2],z=g[3],B=g[4],N=g[5],Z=g[6],X=g[7],q=g[8],Y=g[9],K=g[10],re=g[11],he=g[12],ue=g[13],ce=g[14],Te=g[15],de=E[0],Se=E[1],Ce=E[2],Me=E[3],Le=E[4],ke=E[5],Ue=E[6],Pe=E[7],at=E[8],mt=E[9],nt=E[10],Bt=E[11],Ot=E[12],bt=E[13],yt=E[14],ei=E[15];return Math.abs(D-de)<=e.EPSILON*Math.max(1,Math.abs(D),Math.abs(de))&&Math.abs(T-Se)<=e.EPSILON*Math.max(1,Math.abs(T),Math.abs(Se))&&Math.abs(A-Ce)<=e.EPSILON*Math.max(1,Math.abs(A),Math.abs(Ce))&&Math.abs(z-Me)<=e.EPSILON*Math.max(1,Math.abs(z),Math.abs(Me))&&Math.abs(B-Le)<=e.EPSILON*Math.max(1,Math.abs(B),Math.abs(Le))&&Math.abs(N-ke)<=e.EPSILON*Math.max(1,Math.abs(N),Math.abs(ke))&&Math.abs(Z-Ue)<=e.EPSILON*Math.max(1,Math.abs(Z),Math.abs(Ue))&&Math.abs(X-Pe)<=e.EPSILON*Math.max(1,Math.abs(X),Math.abs(Pe))&&Math.abs(q-at)<=e.EPSILON*Math.max(1,Math.abs(q),Math.abs(at))&&Math.abs(Y-mt)<=e.EPSILON*Math.max(1,Math.abs(Y),Math.abs(mt))&&Math.abs(K-nt)<=e.EPSILON*Math.max(1,Math.abs(K),Math.abs(nt))&&Math.abs(re-Bt)<=e.EPSILON*Math.max(1,Math.abs(re),Math.abs(Bt))&&Math.abs(he-Ot)<=e.EPSILON*Math.max(1,Math.abs(he),Math.abs(Ot))&&Math.abs(ue-bt)<=e.EPSILON*Math.max(1,Math.abs(ue),Math.abs(bt))&&Math.abs(ce-yt)<=e.EPSILON*Math.max(1,Math.abs(ce),Math.abs(yt))&&Math.abs(Te-ei)<=e.EPSILON*Math.max(1,Math.abs(Te),Math.abs(ei))},qt.sub=qt.mul=qt.ortho=qt.perspective=void 0;var e=function(g,E){if(g&&g.__esModule)return g;if(g===null||a(g)!=="object"&&typeof g!="function")return{default:g};var D=i(void 0);if(D&&D.has(g))return D.get(g);var T={},A=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var z in g)if(z!=="default"&&Object.prototype.hasOwnProperty.call(g,z)){var B=A?Object.getOwnPropertyDescriptor(g,z):null;B&&(B.get||B.set)?Object.defineProperty(T,z,B):T[z]=g[z]}return T.default=g,D&&D.set(g,T),T}(Re());function i(g){if(typeof WeakMap!="function")return null;var E=new WeakMap,D=new WeakMap;return(i=function(T){return T?D:E})(g)}function s(g){return g[0]=1,g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[5]=1,g[6]=0,g[7]=0,g[8]=0,g[9]=0,g[10]=1,g[11]=0,g[12]=0,g[13]=0,g[14]=0,g[15]=1,g}function h(g,E,D){var T=E[0],A=E[1],z=E[2],B=E[3],N=E[4],Z=E[5],X=E[6],q=E[7],Y=E[8],K=E[9],re=E[10],he=E[11],ue=E[12],ce=E[13],Te=E[14],de=E[15],Se=D[0],Ce=D[1],Me=D[2],Le=D[3];return g[0]=Se*T+Ce*N+Me*Y+Le*ue,g[1]=Se*A+Ce*Z+Me*K+Le*ce,g[2]=Se*z+Ce*X+Me*re+Le*Te,g[3]=Se*B+Ce*q+Me*he+Le*de,g[4]=(Se=D[4])*T+(Ce=D[5])*N+(Me=D[6])*Y+(Le=D[7])*ue,g[5]=Se*A+Ce*Z+Me*K+Le*ce,g[6]=Se*z+Ce*X+Me*re+Le*Te,g[7]=Se*B+Ce*q+Me*he+Le*de,g[8]=(Se=D[8])*T+(Ce=D[9])*N+(Me=D[10])*Y+(Le=D[11])*ue,g[9]=Se*A+Ce*Z+Me*K+Le*ce,g[10]=Se*z+Ce*X+Me*re+Le*Te,g[11]=Se*B+Ce*q+Me*he+Le*de,g[12]=(Se=D[12])*T+(Ce=D[13])*N+(Me=D[14])*Y+(Le=D[15])*ue,g[13]=Se*A+Ce*Z+Me*K+Le*ce,g[14]=Se*z+Ce*X+Me*re+Le*Te,g[15]=Se*B+Ce*q+Me*he+Le*de,g}function l(g,E,D){var T=E[0],A=E[1],z=E[2],B=E[3],N=T+T,Z=A+A,X=z+z,q=T*N,Y=T*Z,K=T*X,re=A*Z,he=A*X,ue=z*X,ce=B*N,Te=B*Z,de=B*X;return g[0]=1-(re+ue),g[1]=Y+de,g[2]=K-Te,g[3]=0,g[4]=Y-de,g[5]=1-(q+ue),g[6]=he+ce,g[7]=0,g[8]=K+Te,g[9]=he-ce,g[10]=1-(q+re),g[11]=0,g[12]=D[0],g[13]=D[1],g[14]=D[2],g[15]=1,g}function d(g,E){var D=E[4],T=E[5],A=E[6],z=E[8],B=E[9],N=E[10];return g[0]=Math.hypot(E[0],E[1],E[2]),g[1]=Math.hypot(D,T,A),g[2]=Math.hypot(z,B,N),g}function v(g,E,D,T,A){var z,B=1/Math.tan(E/2);return g[0]=B/D,g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[5]=B,g[6]=0,g[7]=0,g[8]=0,g[9]=0,g[11]=-1,g[12]=0,g[13]=0,g[15]=0,A!=null&&A!==1/0?(g[10]=(A+T)*(z=1/(T-A)),g[14]=2*A*T*z):(g[10]=-1,g[14]=-2*T),g}function S(g,E,D,T,A,z,B){var N=1/(E-D),Z=1/(T-A),X=1/(z-B);return g[0]=-2*N,g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[5]=-2*Z,g[6]=0,g[7]=0,g[8]=0,g[9]=0,g[10]=2*X,g[11]=0,g[12]=(E+D)*N,g[13]=(A+T)*Z,g[14]=(B+z)*X,g[15]=1,g}function R(g,E,D){return g[0]=E[0]-D[0],g[1]=E[1]-D[1],g[2]=E[2]-D[2],g[3]=E[3]-D[3],g[4]=E[4]-D[4],g[5]=E[5]-D[5],g[6]=E[6]-D[6],g[7]=E[7]-D[7],g[8]=E[8]-D[8],g[9]=E[9]-D[9],g[10]=E[10]-D[10],g[11]=E[11]-D[11],g[12]=E[12]-D[12],g[13]=E[13]-D[13],g[14]=E[14]-D[14],g[15]=E[15]-D[15],g}return qt.perspective=v,qt.ortho=S,qt.mul=h,qt.sub=R,qt}var ai,kt={},li={};function bn(){if(ai)return li;function a(A){return a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(z){return typeof z}:function(z){return z&&typeof Symbol=="function"&&z.constructor===Symbol&&z!==Symbol.prototype?"symbol":typeof z},a(A)}ai=1,Object.defineProperty(li,"__esModule",{value:!0}),li.create=s,li.clone=function(A){var z=new e.ARRAY_TYPE(3);return z[0]=A[0],z[1]=A[1],z[2]=A[2],z},li.length=h,li.fromValues=function(A,z,B){var N=new e.ARRAY_TYPE(3);return N[0]=A,N[1]=z,N[2]=B,N},li.copy=function(A,z){return A[0]=z[0],A[1]=z[1],A[2]=z[2],A},li.set=function(A,z,B,N){return A[0]=z,A[1]=B,A[2]=N,A},li.add=function(A,z,B){return A[0]=z[0]+B[0],A[1]=z[1]+B[1],A[2]=z[2]+B[2],A},li.subtract=l,li.multiply=d,li.divide=v,li.ceil=function(A,z){return A[0]=Math.ceil(z[0]),A[1]=Math.ceil(z[1]),A[2]=Math.ceil(z[2]),A},li.floor=function(A,z){return A[0]=Math.floor(z[0]),A[1]=Math.floor(z[1]),A[2]=Math.floor(z[2]),A},li.min=function(A,z,B){return A[0]=Math.min(z[0],B[0]),A[1]=Math.min(z[1],B[1]),A[2]=Math.min(z[2],B[2]),A},li.max=function(A,z,B){return A[0]=Math.max(z[0],B[0]),A[1]=Math.max(z[1],B[1]),A[2]=Math.max(z[2],B[2]),A},li.round=function(A,z){return A[0]=Math.round(z[0]),A[1]=Math.round(z[1]),A[2]=Math.round(z[2]),A},li.scale=function(A,z,B){return A[0]=z[0]*B,A[1]=z[1]*B,A[2]=z[2]*B,A},li.scaleAndAdd=function(A,z,B,N){return A[0]=z[0]+B[0]*N,A[1]=z[1]+B[1]*N,A[2]=z[2]+B[2]*N,A},li.distance=S,li.squaredDistance=R,li.squaredLength=g,li.negate=function(A,z){return A[0]=-z[0],A[1]=-z[1],A[2]=-z[2],A},li.inverse=function(A,z){return A[0]=1/z[0],A[1]=1/z[1],A[2]=1/z[2],A},li.normalize=function(A,z){var B=z[0],N=z[1],Z=z[2],X=B*B+N*N+Z*Z;return X>0&&(X=1/Math.sqrt(X)),A[0]=z[0]*X,A[1]=z[1]*X,A[2]=z[2]*X,A},li.dot=E,li.cross=function(A,z,B){var N=z[0],Z=z[1],X=z[2],q=B[0],Y=B[1],K=B[2];return A[0]=Z*K-X*Y,A[1]=X*q-N*K,A[2]=N*Y-Z*q,A},li.lerp=function(A,z,B,N){var Z=z[0],X=z[1],q=z[2];return A[0]=Z+N*(B[0]-Z),A[1]=X+N*(B[1]-X),A[2]=q+N*(B[2]-q),A},li.hermite=function(A,z,B,N,Z,X){var q=X*X,Y=q*(2*X-3)+1,K=q*(X-2)+X,re=q*(X-1),he=q*(3-2*X);return A[0]=z[0]*Y+B[0]*K+N[0]*re+Z[0]*he,A[1]=z[1]*Y+B[1]*K+N[1]*re+Z[1]*he,A[2]=z[2]*Y+B[2]*K+N[2]*re+Z[2]*he,A},li.bezier=function(A,z,B,N,Z,X){var q=1-X,Y=q*q,K=X*X,re=Y*q,he=3*X*Y,ue=3*K*q,ce=K*X;return A[0]=z[0]*re+B[0]*he+N[0]*ue+Z[0]*ce,A[1]=z[1]*re+B[1]*he+N[1]*ue+Z[1]*ce,A[2]=z[2]*re+B[2]*he+N[2]*ue+Z[2]*ce,A},li.random=function(A,z){z=z||1;var B=2*e.RANDOM()*Math.PI,N=2*e.RANDOM()-1,Z=Math.sqrt(1-N*N)*z;return A[0]=Math.cos(B)*Z,A[1]=Math.sin(B)*Z,A[2]=N*z,A},li.transformMat4=function(A,z,B){var N=z[0],Z=z[1],X=z[2],q=B[3]*N+B[7]*Z+B[11]*X+B[15];return A[0]=(B[0]*N+B[4]*Z+B[8]*X+B[12])/(q=q||1),A[1]=(B[1]*N+B[5]*Z+B[9]*X+B[13])/q,A[2]=(B[2]*N+B[6]*Z+B[10]*X+B[14])/q,A},li.transformMat3=function(A,z,B){var N=z[0],Z=z[1],X=z[2];return A[0]=N*B[0]+Z*B[3]+X*B[6],A[1]=N*B[1]+Z*B[4]+X*B[7],A[2]=N*B[2]+Z*B[5]+X*B[8],A},li.transformQuat=function(A,z,B){var N=B[0],Z=B[1],X=B[2],q=z[0],Y=z[1],K=z[2],re=Z*K-X*Y,he=X*q-N*K,ue=N*Y-Z*q,ce=Z*ue-X*he,Te=X*re-N*ue,de=N*he-Z*re,Se=2*B[3];return he*=Se,ue*=Se,Te*=2,de*=2,A[0]=q+(re*=Se)+(ce*=2),A[1]=Y+he+Te,A[2]=K+ue+de,A},li.rotateX=function(A,z,B,N){var Z=[],X=[];return Z[0]=z[0]-B[0],Z[1]=z[1]-B[1],Z[2]=z[2]-B[2],X[0]=Z[0],X[1]=Z[1]*Math.cos(N)-Z[2]*Math.sin(N),X[2]=Z[1]*Math.sin(N)+Z[2]*Math.cos(N),A[0]=X[0]+B[0],A[1]=X[1]+B[1],A[2]=X[2]+B[2],A},li.rotateY=function(A,z,B,N){var Z=[],X=[];return Z[0]=z[0]-B[0],Z[1]=z[1]-B[1],Z[2]=z[2]-B[2],X[0]=Z[2]*Math.sin(N)+Z[0]*Math.cos(N),X[1]=Z[1],X[2]=Z[2]*Math.cos(N)-Z[0]*Math.sin(N),A[0]=X[0]+B[0],A[1]=X[1]+B[1],A[2]=X[2]+B[2],A},li.rotateZ=function(A,z,B,N){var Z=[],X=[];return Z[0]=z[0]-B[0],Z[1]=z[1]-B[1],Z[2]=z[2]-B[2],X[0]=Z[0]*Math.cos(N)-Z[1]*Math.sin(N),X[1]=Z[0]*Math.sin(N)+Z[1]*Math.cos(N),X[2]=Z[2],A[0]=X[0]+B[0],A[1]=X[1]+B[1],A[2]=X[2]+B[2],A},li.angle=function(A,z){var B=A[0],N=A[1],Z=A[2],X=z[0],q=z[1],Y=z[2],K=Math.sqrt(B*B+N*N+Z*Z)*Math.sqrt(X*X+q*q+Y*Y),re=K&&E(A,z)/K;return Math.acos(Math.min(Math.max(re,-1),1))},li.zero=function(A){return A[0]=0,A[1]=0,A[2]=0,A},li.str=function(A){return"vec3("+A[0]+", "+A[1]+", "+A[2]+")"},li.exactEquals=function(A,z){return A[0]===z[0]&&A[1]===z[1]&&A[2]===z[2]},li.equals=function(A,z){var B=A[0],N=A[1],Z=A[2],X=z[0],q=z[1],Y=z[2];return Math.abs(B-X)<=e.EPSILON*Math.max(1,Math.abs(B),Math.abs(X))&&Math.abs(N-q)<=e.EPSILON*Math.max(1,Math.abs(N),Math.abs(q))&&Math.abs(Z-Y)<=e.EPSILON*Math.max(1,Math.abs(Z),Math.abs(Y))},li.forEach=li.sqrLen=li.len=li.sqrDist=li.dist=li.div=li.mul=li.sub=void 0;var e=function(A,z){if(A&&A.__esModule)return A;if(A===null||a(A)!=="object"&&typeof A!="function")return{default:A};var B=i(void 0);if(B&&B.has(A))return B.get(A);var N={},Z=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var X in A)if(X!=="default"&&Object.prototype.hasOwnProperty.call(A,X)){var q=Z?Object.getOwnPropertyDescriptor(A,X):null;q&&(q.get||q.set)?Object.defineProperty(N,X,q):N[X]=A[X]}return N.default=A,B&&B.set(A,N),N}(Re());function i(A){if(typeof WeakMap!="function")return null;var z=new WeakMap,B=new WeakMap;return(i=function(N){return N?B:z})(A)}function s(){var A=new e.ARRAY_TYPE(3);return e.ARRAY_TYPE!=Float32Array&&(A[0]=0,A[1]=0,A[2]=0),A}function h(A){return Math.hypot(A[0],A[1],A[2])}function l(A,z,B){return A[0]=z[0]-B[0],A[1]=z[1]-B[1],A[2]=z[2]-B[2],A}function d(A,z,B){return A[0]=z[0]*B[0],A[1]=z[1]*B[1],A[2]=z[2]*B[2],A}function v(A,z,B){return A[0]=z[0]/B[0],A[1]=z[1]/B[1],A[2]=z[2]/B[2],A}function S(A,z){return Math.hypot(z[0]-A[0],z[1]-A[1],z[2]-A[2])}function R(A,z){var B=z[0]-A[0],N=z[1]-A[1],Z=z[2]-A[2];return B*B+N*N+Z*Z}function g(A){var z=A[0],B=A[1],N=A[2];return z*z+B*B+N*N}function E(A,z){return A[0]*z[0]+A[1]*z[1]+A[2]*z[2]}li.sub=l,li.mul=d,li.div=v,li.dist=S,li.sqrDist=R,li.len=h,li.sqrLen=g;var D,T=(D=s(),function(A,z,B,N,Z,X){var q,Y;for(z||(z=3),B||(B=0),Y=N?Math.min(N*z+B,A.length):A.length,q=B;q<Y;q+=z)D[0]=A[q],D[1]=A[q+1],D[2]=A[q+2],Z(D,D,X),A[q]=D[0],A[q+1]=D[1],A[q+2]=D[2];return A});return li.forEach=T,li}var Dr,wn,gi={};function ii(){if(Dr)return gi;function a(T){return a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(A){return typeof A}:function(A){return A&&typeof Symbol=="function"&&A.constructor===Symbol&&A!==Symbol.prototype?"symbol":typeof A},a(T)}Dr=1,Object.defineProperty(gi,"__esModule",{value:!0}),gi.create=s,gi.clone=function(T){var A=new e.ARRAY_TYPE(4);return A[0]=T[0],A[1]=T[1],A[2]=T[2],A[3]=T[3],A},gi.fromValues=function(T,A,z,B){var N=new e.ARRAY_TYPE(4);return N[0]=T,N[1]=A,N[2]=z,N[3]=B,N},gi.copy=function(T,A){return T[0]=A[0],T[1]=A[1],T[2]=A[2],T[3]=A[3],T},gi.set=function(T,A,z,B,N){return T[0]=A,T[1]=z,T[2]=B,T[3]=N,T},gi.add=function(T,A,z){return T[0]=A[0]+z[0],T[1]=A[1]+z[1],T[2]=A[2]+z[2],T[3]=A[3]+z[3],T},gi.subtract=h,gi.multiply=l,gi.divide=d,gi.ceil=function(T,A){return T[0]=Math.ceil(A[0]),T[1]=Math.ceil(A[1]),T[2]=Math.ceil(A[2]),T[3]=Math.ceil(A[3]),T},gi.floor=function(T,A){return T[0]=Math.floor(A[0]),T[1]=Math.floor(A[1]),T[2]=Math.floor(A[2]),T[3]=Math.floor(A[3]),T},gi.min=function(T,A,z){return T[0]=Math.min(A[0],z[0]),T[1]=Math.min(A[1],z[1]),T[2]=Math.min(A[2],z[2]),T[3]=Math.min(A[3],z[3]),T},gi.max=function(T,A,z){return T[0]=Math.max(A[0],z[0]),T[1]=Math.max(A[1],z[1]),T[2]=Math.max(A[2],z[2]),T[3]=Math.max(A[3],z[3]),T},gi.round=function(T,A){return T[0]=Math.round(A[0]),T[1]=Math.round(A[1]),T[2]=Math.round(A[2]),T[3]=Math.round(A[3]),T},gi.scale=function(T,A,z){return T[0]=A[0]*z,T[1]=A[1]*z,T[2]=A[2]*z,T[3]=A[3]*z,T},gi.scaleAndAdd=function(T,A,z,B){return T[0]=A[0]+z[0]*B,T[1]=A[1]+z[1]*B,T[2]=A[2]+z[2]*B,T[3]=A[3]+z[3]*B,T},gi.distance=v,gi.squaredDistance=S,gi.length=R,gi.squaredLength=g,gi.negate=function(T,A){return T[0]=-A[0],T[1]=-A[1],T[2]=-A[2],T[3]=-A[3],T},gi.inverse=function(T,A){return T[0]=1/A[0],T[1]=1/A[1],T[2]=1/A[2],T[3]=1/A[3],T},gi.normalize=function(T,A){var z=A[0],B=A[1],N=A[2],Z=A[3],X=z*z+B*B+N*N+Z*Z;return X>0&&(X=1/Math.sqrt(X)),T[0]=z*X,T[1]=B*X,T[2]=N*X,T[3]=Z*X,T},gi.dot=function(T,A){return T[0]*A[0]+T[1]*A[1]+T[2]*A[2]+T[3]*A[3]},gi.cross=function(T,A,z,B){var N=z[0]*B[1]-z[1]*B[0],Z=z[0]*B[2]-z[2]*B[0],X=z[0]*B[3]-z[3]*B[0],q=z[1]*B[2]-z[2]*B[1],Y=z[1]*B[3]-z[3]*B[1],K=z[2]*B[3]-z[3]*B[2],re=A[0],he=A[1],ue=A[2],ce=A[3];return T[0]=he*K-ue*Y+ce*q,T[1]=-re*K+ue*X-ce*Z,T[2]=re*Y-he*X+ce*N,T[3]=-re*q+he*Z-ue*N,T},gi.lerp=function(T,A,z,B){var N=A[0],Z=A[1],X=A[2],q=A[3];return T[0]=N+B*(z[0]-N),T[1]=Z+B*(z[1]-Z),T[2]=X+B*(z[2]-X),T[3]=q+B*(z[3]-q),T},gi.random=function(T,A){var z,B,N,Z,X,q;A=A||1;do X=(z=2*e.RANDOM()-1)*z+(B=2*e.RANDOM()-1)*B;while(X>=1);do q=(N=2*e.RANDOM()-1)*N+(Z=2*e.RANDOM()-1)*Z;while(q>=1);var Y=Math.sqrt((1-X)/q);return T[0]=A*z,T[1]=A*B,T[2]=A*N*Y,T[3]=A*Z*Y,T},gi.transformMat4=function(T,A,z){var B=A[0],N=A[1],Z=A[2],X=A[3];return T[0]=z[0]*B+z[4]*N+z[8]*Z+z[12]*X,T[1]=z[1]*B+z[5]*N+z[9]*Z+z[13]*X,T[2]=z[2]*B+z[6]*N+z[10]*Z+z[14]*X,T[3]=z[3]*B+z[7]*N+z[11]*Z+z[15]*X,T},gi.transformQuat=function(T,A,z){var B=A[0],N=A[1],Z=A[2],X=z[0],q=z[1],Y=z[2],K=z[3],re=K*B+q*Z-Y*N,he=K*N+Y*B-X*Z,ue=K*Z+X*N-q*B,ce=-X*B-q*N-Y*Z;return T[0]=re*K+ce*-X+he*-Y-ue*-q,T[1]=he*K+ce*-q+ue*-X-re*-Y,T[2]=ue*K+ce*-Y+re*-q-he*-X,T[3]=A[3],T},gi.zero=function(T){return T[0]=0,T[1]=0,T[2]=0,T[3]=0,T},gi.str=function(T){return"vec4("+T[0]+", "+T[1]+", "+T[2]+", "+T[3]+")"},gi.exactEquals=function(T,A){return T[0]===A[0]&&T[1]===A[1]&&T[2]===A[2]&&T[3]===A[3]},gi.equals=function(T,A){var z=T[0],B=T[1],N=T[2],Z=T[3],X=A[0],q=A[1],Y=A[2],K=A[3];return Math.abs(z-X)<=e.EPSILON*Math.max(1,Math.abs(z),Math.abs(X))&&Math.abs(B-q)<=e.EPSILON*Math.max(1,Math.abs(B),Math.abs(q))&&Math.abs(N-Y)<=e.EPSILON*Math.max(1,Math.abs(N),Math.abs(Y))&&Math.abs(Z-K)<=e.EPSILON*Math.max(1,Math.abs(Z),Math.abs(K))},gi.forEach=gi.sqrLen=gi.len=gi.sqrDist=gi.dist=gi.div=gi.mul=gi.sub=void 0;var e=function(T,A){if(T&&T.__esModule)return T;if(T===null||a(T)!=="object"&&typeof T!="function")return{default:T};var z=i(void 0);if(z&&z.has(T))return z.get(T);var B={},N=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Z in T)if(Z!=="default"&&Object.prototype.hasOwnProperty.call(T,Z)){var X=N?Object.getOwnPropertyDescriptor(T,Z):null;X&&(X.get||X.set)?Object.defineProperty(B,Z,X):B[Z]=T[Z]}return B.default=T,z&&z.set(T,B),B}(Re());function i(T){if(typeof WeakMap!="function")return null;var A=new WeakMap,z=new WeakMap;return(i=function(B){return B?z:A})(T)}function s(){var T=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(T[0]=0,T[1]=0,T[2]=0,T[3]=0),T}function h(T,A,z){return T[0]=A[0]-z[0],T[1]=A[1]-z[1],T[2]=A[2]-z[2],T[3]=A[3]-z[3],T}function l(T,A,z){return T[0]=A[0]*z[0],T[1]=A[1]*z[1],T[2]=A[2]*z[2],T[3]=A[3]*z[3],T}function d(T,A,z){return T[0]=A[0]/z[0],T[1]=A[1]/z[1],T[2]=A[2]/z[2],T[3]=A[3]/z[3],T}function v(T,A){return Math.hypot(A[0]-T[0],A[1]-T[1],A[2]-T[2],A[3]-T[3])}function S(T,A){var z=A[0]-T[0],B=A[1]-T[1],N=A[2]-T[2],Z=A[3]-T[3];return z*z+B*B+N*N+Z*Z}function R(T){return Math.hypot(T[0],T[1],T[2],T[3])}function g(T){var A=T[0],z=T[1],B=T[2],N=T[3];return A*A+z*z+B*B+N*N}gi.sub=h,gi.mul=l,gi.div=d,gi.dist=v,gi.sqrDist=S,gi.len=R,gi.sqrLen=g;var E,D=(E=s(),function(T,A,z,B,N,Z){var X,q;for(A||(A=4),z||(z=0),q=B?Math.min(B*A+z,T.length):T.length,X=z;X<q;X+=A)E[0]=T[X],E[1]=T[X+1],E[2]=T[X+2],E[3]=T[X+3],N(E,E,Z),T[X]=E[0],T[X+1]=E[1],T[X+2]=E[2],T[X+3]=E[3];return T});return gi.forEach=D,gi}function Xi(){if(wn)return kt;function a(de){return a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Se){return typeof Se}:function(Se){return Se&&typeof Symbol=="function"&&Se.constructor===Symbol&&Se!==Symbol.prototype?"symbol":typeof Se},a(de)}wn=1,Object.defineProperty(kt,"__esModule",{value:!0}),kt.create=v,kt.identity=function(de){return de[0]=0,de[1]=0,de[2]=0,de[3]=1,de},kt.setAxisAngle=S,kt.getAxisAngle=function(de,Se){var Ce=2*Math.acos(Se[3]),Me=Math.sin(Ce/2);return Me>e.EPSILON?(de[0]=Se[0]/Me,de[1]=Se[1]/Me,de[2]=Se[2]/Me):(de[0]=1,de[1]=0,de[2]=0),Ce},kt.getAngle=function(de,Se){var Ce=z(de,Se);return Math.acos(2*Ce*Ce-1)},kt.multiply=R,kt.rotateX=function(de,Se,Ce){Ce*=.5;var Me=Se[0],Le=Se[1],ke=Se[2],Ue=Se[3],Pe=Math.sin(Ce),at=Math.cos(Ce);return de[0]=Me*at+Ue*Pe,de[1]=Le*at+ke*Pe,de[2]=ke*at-Le*Pe,de[3]=Ue*at-Me*Pe,de},kt.rotateY=function(de,Se,Ce){Ce*=.5;var Me=Se[0],Le=Se[1],ke=Se[2],Ue=Se[3],Pe=Math.sin(Ce),at=Math.cos(Ce);return de[0]=Me*at-ke*Pe,de[1]=Le*at+Ue*Pe,de[2]=ke*at+Me*Pe,de[3]=Ue*at-Le*Pe,de},kt.rotateZ=function(de,Se,Ce){Ce*=.5;var Me=Se[0],Le=Se[1],ke=Se[2],Ue=Se[3],Pe=Math.sin(Ce),at=Math.cos(Ce);return de[0]=Me*at+Le*Pe,de[1]=Le*at-Me*Pe,de[2]=ke*at+Ue*Pe,de[3]=Ue*at-ke*Pe,de},kt.calculateW=function(de,Se){var Ce=Se[0],Me=Se[1],Le=Se[2];return de[0]=Ce,de[1]=Me,de[2]=Le,de[3]=Math.sqrt(Math.abs(1-Ce*Ce-Me*Me-Le*Le)),de},kt.exp=g,kt.ln=E,kt.pow=function(de,Se,Ce){return E(de,Se),A(de,de,Ce),g(de,de),de},kt.slerp=D,kt.random=function(de){var Se=e.RANDOM(),Ce=e.RANDOM(),Me=e.RANDOM(),Le=Math.sqrt(1-Se),ke=Math.sqrt(Se);return de[0]=Le*Math.sin(2*Math.PI*Ce),de[1]=Le*Math.cos(2*Math.PI*Ce),de[2]=ke*Math.sin(2*Math.PI*Me),de[3]=ke*Math.cos(2*Math.PI*Me),de},kt.invert=function(de,Se){var Ce=Se[0],Me=Se[1],Le=Se[2],ke=Se[3],Ue=Ce*Ce+Me*Me+Le*Le+ke*ke,Pe=Ue?1/Ue:0;return de[0]=-Ce*Pe,de[1]=-Me*Pe,de[2]=-Le*Pe,de[3]=ke*Pe,de},kt.conjugate=function(de,Se){return de[0]=-Se[0],de[1]=-Se[1],de[2]=-Se[2],de[3]=Se[3],de},kt.fromMat3=T,kt.fromEuler=function(de,Se,Ce,Me){var Le=.5*Math.PI/180;Se*=Le,Ce*=Le,Me*=Le;var ke=Math.sin(Se),Ue=Math.cos(Se),Pe=Math.sin(Ce),at=Math.cos(Ce),mt=Math.sin(Me),nt=Math.cos(Me);return de[0]=ke*at*nt-Ue*Pe*mt,de[1]=Ue*Pe*nt+ke*at*mt,de[2]=Ue*at*mt-ke*Pe*nt,de[3]=Ue*at*nt+ke*Pe*mt,de},kt.str=function(de){return"quat("+de[0]+", "+de[1]+", "+de[2]+", "+de[3]+")"},kt.setAxes=kt.sqlerp=kt.rotationTo=kt.equals=kt.exactEquals=kt.normalize=kt.sqrLen=kt.squaredLength=kt.len=kt.length=kt.lerp=kt.dot=kt.scale=kt.mul=kt.add=kt.set=kt.copy=kt.fromValues=kt.clone=void 0;var e=d(Re()),i=d(Ft()),s=d(bn()),h=d(ii());function l(de){if(typeof WeakMap!="function")return null;var Se=new WeakMap,Ce=new WeakMap;return(l=function(Me){return Me?Ce:Se})(de)}function d(de,Se){if(de&&de.__esModule)return de;if(de===null||a(de)!=="object"&&typeof de!="function")return{default:de};var Ce=l(Se);if(Ce&&Ce.has(de))return Ce.get(de);var Me={},Le=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var ke in de)if(ke!=="default"&&Object.prototype.hasOwnProperty.call(de,ke)){var Ue=Le?Object.getOwnPropertyDescriptor(de,ke):null;Ue&&(Ue.get||Ue.set)?Object.defineProperty(Me,ke,Ue):Me[ke]=de[ke]}return Me.default=de,Ce&&Ce.set(de,Me),Me}function v(){var de=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(de[0]=0,de[1]=0,de[2]=0),de[3]=1,de}function S(de,Se,Ce){Ce*=.5;var Me=Math.sin(Ce);return de[0]=Me*Se[0],de[1]=Me*Se[1],de[2]=Me*Se[2],de[3]=Math.cos(Ce),de}function R(de,Se,Ce){var Me=Se[0],Le=Se[1],ke=Se[2],Ue=Se[3],Pe=Ce[0],at=Ce[1],mt=Ce[2],nt=Ce[3];return de[0]=Me*nt+Ue*Pe+Le*mt-ke*at,de[1]=Le*nt+Ue*at+ke*Pe-Me*mt,de[2]=ke*nt+Ue*mt+Me*at-Le*Pe,de[3]=Ue*nt-Me*Pe-Le*at-ke*mt,de}function g(de,Se){var Ce=Se[0],Me=Se[1],Le=Se[2],ke=Se[3],Ue=Math.sqrt(Ce*Ce+Me*Me+Le*Le),Pe=Math.exp(ke),at=Ue>0?Pe*Math.sin(Ue)/Ue:0;return de[0]=Ce*at,de[1]=Me*at,de[2]=Le*at,de[3]=Pe*Math.cos(Ue),de}function E(de,Se){var Ce=Se[0],Me=Se[1],Le=Se[2],ke=Se[3],Ue=Math.sqrt(Ce*Ce+Me*Me+Le*Le),Pe=Ue>0?Math.atan2(Ue,ke)/Ue:0;return de[0]=Ce*Pe,de[1]=Me*Pe,de[2]=Le*Pe,de[3]=.5*Math.log(Ce*Ce+Me*Me+Le*Le+ke*ke),de}function D(de,Se,Ce,Me){var Le,ke,Ue,Pe,at,mt=Se[0],nt=Se[1],Bt=Se[2],Ot=Se[3],bt=Ce[0],yt=Ce[1],ei=Ce[2],jt=Ce[3];return(ke=mt*bt+nt*yt+Bt*ei+Ot*jt)<0&&(ke=-ke,bt=-bt,yt=-yt,ei=-ei,jt=-jt),1-ke>e.EPSILON?(Le=Math.acos(ke),Ue=Math.sin(Le),Pe=Math.sin((1-Me)*Le)/Ue,at=Math.sin(Me*Le)/Ue):(Pe=1-Me,at=Me),de[0]=Pe*mt+at*bt,de[1]=Pe*nt+at*yt,de[2]=Pe*Bt+at*ei,de[3]=Pe*Ot+at*jt,de}function T(de,Se){var Ce,Me=Se[0]+Se[4]+Se[8];if(Me>0)Ce=Math.sqrt(Me+1),de[3]=.5*Ce,de[0]=(Se[5]-Se[7])*(Ce=.5/Ce),de[1]=(Se[6]-Se[2])*Ce,de[2]=(Se[1]-Se[3])*Ce;else{var Le=0;Se[4]>Se[0]&&(Le=1),Se[8]>Se[3*Le+Le]&&(Le=2);var ke=(Le+1)%3,Ue=(Le+2)%3;Ce=Math.sqrt(Se[3*Le+Le]-Se[3*ke+ke]-Se[3*Ue+Ue]+1),de[Le]=.5*Ce,de[3]=(Se[3*ke+Ue]-Se[3*Ue+ke])*(Ce=.5/Ce),de[ke]=(Se[3*ke+Le]+Se[3*Le+ke])*Ce,de[Ue]=(Se[3*Ue+Le]+Se[3*Le+Ue])*Ce}return de}kt.clone=h.clone,kt.fromValues=h.fromValues,kt.copy=h.copy,kt.set=h.set,kt.add=h.add,kt.mul=R;var A=h.scale;kt.scale=A;var z=h.dot;kt.dot=z,kt.lerp=h.lerp;var B=h.length;kt.length=B,kt.len=B;var N=h.squaredLength;kt.squaredLength=N,kt.sqrLen=N;var Z=h.normalize;kt.normalize=Z,kt.exactEquals=h.exactEquals,kt.equals=h.equals;var X,q,Y,K=(X=s.create(),q=s.fromValues(1,0,0),Y=s.fromValues(0,1,0),function(de,Se,Ce){var Me=s.dot(Se,Ce);return Me<-.999999?(s.cross(X,q,Se),s.len(X)<1e-6&&s.cross(X,Y,Se),s.normalize(X,X),S(de,X,Math.PI),de):Me>.999999?(de[0]=0,de[1]=0,de[2]=0,de[3]=1,de):(s.cross(X,Se,Ce),de[0]=X[0],de[1]=X[1],de[2]=X[2],de[3]=1+Me,Z(de,de))});kt.rotationTo=K;var re,he,ue=(re=v(),he=v(),function(de,Se,Ce,Me,Le,ke){return D(re,Se,Le,ke),D(he,Ce,Me,ke),D(de,re,he,2*ke*(1-ke)),de});kt.sqlerp=ue;var ce,Te=(ce=i.create(),function(de,Se,Ce,Me){return ce[0]=Ce[0],ce[3]=Ce[1],ce[6]=Ce[2],ce[1]=Me[0],ce[4]=Me[1],ce[7]=Me[2],ce[2]=-Se[0],ce[5]=-Se[1],ce[8]=-Se[2],Z(de,T(de,ce))});return kt.setAxes=Te,kt}var Bi,ti={};function et(){if(Bi)return ti;function a(D){return a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(T){return typeof T}:function(T){return T&&typeof Symbol=="function"&&T.constructor===Symbol&&T!==Symbol.prototype?"symbol":typeof T},a(D)}Bi=1,Object.defineProperty(ti,"__esModule",{value:!0}),ti.create=function(){var D=new e.ARRAY_TYPE(8);return e.ARRAY_TYPE!=Float32Array&&(D[0]=0,D[1]=0,D[2]=0,D[4]=0,D[5]=0,D[6]=0,D[7]=0),D[3]=1,D},ti.clone=function(D){var T=new e.ARRAY_TYPE(8);return T[0]=D[0],T[1]=D[1],T[2]=D[2],T[3]=D[3],T[4]=D[4],T[5]=D[5],T[6]=D[6],T[7]=D[7],T},ti.fromValues=function(D,T,A,z,B,N,Z,X){var q=new e.ARRAY_TYPE(8);return q[0]=D,q[1]=T,q[2]=A,q[3]=z,q[4]=B,q[5]=N,q[6]=Z,q[7]=X,q},ti.fromRotationTranslationValues=function(D,T,A,z,B,N,Z){var X=new e.ARRAY_TYPE(8);X[0]=D,X[1]=T,X[2]=A,X[3]=z;var q=.5*B,Y=.5*N,K=.5*Z;return X[4]=q*z+Y*A-K*T,X[5]=Y*z+K*D-q*A,X[6]=K*z+q*T-Y*D,X[7]=-q*D-Y*T-K*A,X},ti.fromRotationTranslation=d,ti.fromTranslation=function(D,T){return D[0]=0,D[1]=0,D[2]=0,D[3]=1,D[4]=.5*T[0],D[5]=.5*T[1],D[6]=.5*T[2],D[7]=0,D},ti.fromRotation=function(D,T){return D[0]=T[0],D[1]=T[1],D[2]=T[2],D[3]=T[3],D[4]=0,D[5]=0,D[6]=0,D[7]=0,D},ti.fromMat4=function(D,T){var A=i.create();s.getRotation(A,T);var z=new e.ARRAY_TYPE(3);return s.getTranslation(z,T),d(D,A,z),D},ti.copy=v,ti.identity=function(D){return D[0]=0,D[1]=0,D[2]=0,D[3]=1,D[4]=0,D[5]=0,D[6]=0,D[7]=0,D},ti.set=function(D,T,A,z,B,N,Z,X,q){return D[0]=T,D[1]=A,D[2]=z,D[3]=B,D[4]=N,D[5]=Z,D[6]=X,D[7]=q,D},ti.getDual=function(D,T){return D[0]=T[4],D[1]=T[5],D[2]=T[6],D[3]=T[7],D},ti.setDual=function(D,T){return D[4]=T[0],D[5]=T[1],D[6]=T[2],D[7]=T[3],D},ti.getTranslation=function(D,T){var A=T[4],z=T[5],B=T[6],N=T[7],Z=-T[0],X=-T[1],q=-T[2],Y=T[3];return D[0]=2*(A*Y+N*Z+z*q-B*X),D[1]=2*(z*Y+N*X+B*Z-A*q),D[2]=2*(B*Y+N*q+A*X-z*Z),D},ti.translate=function(D,T,A){var z=T[0],B=T[1],N=T[2],Z=T[3],X=.5*A[0],q=.5*A[1],Y=.5*A[2],K=T[4],re=T[5],he=T[6],ue=T[7];return D[0]=z,D[1]=B,D[2]=N,D[3]=Z,D[4]=Z*X+B*Y-N*q+K,D[5]=Z*q+N*X-z*Y+re,D[6]=Z*Y+z*q-B*X+he,D[7]=-z*X-B*q-N*Y+ue,D},ti.rotateX=function(D,T,A){var z=-T[0],B=-T[1],N=-T[2],Z=T[3],X=T[4],q=T[5],Y=T[6],K=T[7],re=X*Z+K*z+q*N-Y*B,he=q*Z+K*B+Y*z-X*N,ue=Y*Z+K*N+X*B-q*z,ce=K*Z-X*z-q*B-Y*N;return i.rotateX(D,T,A),D[4]=re*(Z=D[3])+ce*(z=D[0])+he*(N=D[2])-ue*(B=D[1]),D[5]=he*Z+ce*B+ue*z-re*N,D[6]=ue*Z+ce*N+re*B-he*z,D[7]=ce*Z-re*z-he*B-ue*N,D},ti.rotateY=function(D,T,A){var z=-T[0],B=-T[1],N=-T[2],Z=T[3],X=T[4],q=T[5],Y=T[6],K=T[7],re=X*Z+K*z+q*N-Y*B,he=q*Z+K*B+Y*z-X*N,ue=Y*Z+K*N+X*B-q*z,ce=K*Z-X*z-q*B-Y*N;return i.rotateY(D,T,A),D[4]=re*(Z=D[3])+ce*(z=D[0])+he*(N=D[2])-ue*(B=D[1]),D[5]=he*Z+ce*B+ue*z-re*N,D[6]=ue*Z+ce*N+re*B-he*z,D[7]=ce*Z-re*z-he*B-ue*N,D},ti.rotateZ=function(D,T,A){var z=-T[0],B=-T[1],N=-T[2],Z=T[3],X=T[4],q=T[5],Y=T[6],K=T[7],re=X*Z+K*z+q*N-Y*B,he=q*Z+K*B+Y*z-X*N,ue=Y*Z+K*N+X*B-q*z,ce=K*Z-X*z-q*B-Y*N;return i.rotateZ(D,T,A),D[4]=re*(Z=D[3])+ce*(z=D[0])+he*(N=D[2])-ue*(B=D[1]),D[5]=he*Z+ce*B+ue*z-re*N,D[6]=ue*Z+ce*N+re*B-he*z,D[7]=ce*Z-re*z-he*B-ue*N,D},ti.rotateByQuatAppend=function(D,T,A){var z=A[0],B=A[1],N=A[2],Z=A[3],X=T[0],q=T[1],Y=T[2],K=T[3];return D[0]=X*Z+K*z+q*N-Y*B,D[1]=q*Z+K*B+Y*z-X*N,D[2]=Y*Z+K*N+X*B-q*z,D[3]=K*Z-X*z-q*B-Y*N,D[4]=(X=T[4])*Z+(K=T[7])*z+(q=T[5])*N-(Y=T[6])*B,D[5]=q*Z+K*B+Y*z-X*N,D[6]=Y*Z+K*N+X*B-q*z,D[7]=K*Z-X*z-q*B-Y*N,D},ti.rotateByQuatPrepend=function(D,T,A){var z=T[0],B=T[1],N=T[2],Z=T[3],X=A[0],q=A[1],Y=A[2],K=A[3];return D[0]=z*K+Z*X+B*Y-N*q,D[1]=B*K+Z*q+N*X-z*Y,D[2]=N*K+Z*Y+z*q-B*X,D[3]=Z*K-z*X-B*q-N*Y,D[4]=z*(K=A[7])+Z*(X=A[4])+B*(Y=A[6])-N*(q=A[5]),D[5]=B*K+Z*q+N*X-z*Y,D[6]=N*K+Z*Y+z*q-B*X,D[7]=Z*K-z*X-B*q-N*Y,D},ti.rotateAroundAxis=function(D,T,A,z){if(Math.abs(z)<e.EPSILON)return v(D,T);var B=Math.hypot(A[0],A[1],A[2]);z*=.5;var N=Math.sin(z),Z=N*A[0]/B,X=N*A[1]/B,q=N*A[2]/B,Y=Math.cos(z),K=T[0],re=T[1],he=T[2],ue=T[3];D[0]=K*Y+ue*Z+re*q-he*X,D[1]=re*Y+ue*X+he*Z-K*q,D[2]=he*Y+ue*q+K*X-re*Z,D[3]=ue*Y-K*Z-re*X-he*q;var ce=T[4],Te=T[5],de=T[6],Se=T[7];return D[4]=ce*Y+Se*Z+Te*q-de*X,D[5]=Te*Y+Se*X+de*Z-ce*q,D[6]=de*Y+Se*q+ce*X-Te*Z,D[7]=Se*Y-ce*Z-Te*X-de*q,D},ti.add=function(D,T,A){return D[0]=T[0]+A[0],D[1]=T[1]+A[1],D[2]=T[2]+A[2],D[3]=T[3]+A[3],D[4]=T[4]+A[4],D[5]=T[5]+A[5],D[6]=T[6]+A[6],D[7]=T[7]+A[7],D},ti.multiply=S,ti.scale=function(D,T,A){return D[0]=T[0]*A,D[1]=T[1]*A,D[2]=T[2]*A,D[3]=T[3]*A,D[4]=T[4]*A,D[5]=T[5]*A,D[6]=T[6]*A,D[7]=T[7]*A,D},ti.lerp=function(D,T,A,z){var B=1-z;return R(T,A)<0&&(z=-z),D[0]=T[0]*B+A[0]*z,D[1]=T[1]*B+A[1]*z,D[2]=T[2]*B+A[2]*z,D[3]=T[3]*B+A[3]*z,D[4]=T[4]*B+A[4]*z,D[5]=T[5]*B+A[5]*z,D[6]=T[6]*B+A[6]*z,D[7]=T[7]*B+A[7]*z,D},ti.invert=function(D,T){var A=E(T);return D[0]=-T[0]/A,D[1]=-T[1]/A,D[2]=-T[2]/A,D[3]=T[3]/A,D[4]=-T[4]/A,D[5]=-T[5]/A,D[6]=-T[6]/A,D[7]=T[7]/A,D},ti.conjugate=function(D,T){return D[0]=-T[0],D[1]=-T[1],D[2]=-T[2],D[3]=T[3],D[4]=-T[4],D[5]=-T[5],D[6]=-T[6],D[7]=T[7],D},ti.normalize=function(D,T){var A=E(T);if(A>0){A=Math.sqrt(A);var z=T[0]/A,B=T[1]/A,N=T[2]/A,Z=T[3]/A,X=T[4],q=T[5],Y=T[6],K=T[7],re=z*X+B*q+N*Y+Z*K;D[0]=z,D[1]=B,D[2]=N,D[3]=Z,D[4]=(X-z*re)/A,D[5]=(q-B*re)/A,D[6]=(Y-N*re)/A,D[7]=(K-Z*re)/A}return D},ti.str=function(D){return"quat2("+D[0]+", "+D[1]+", "+D[2]+", "+D[3]+", "+D[4]+", "+D[5]+", "+D[6]+", "+D[7]+")"},ti.exactEquals=function(D,T){return D[0]===T[0]&&D[1]===T[1]&&D[2]===T[2]&&D[3]===T[3]&&D[4]===T[4]&&D[5]===T[5]&&D[6]===T[6]&&D[7]===T[7]},ti.equals=function(D,T){var A=D[0],z=D[1],B=D[2],N=D[3],Z=D[4],X=D[5],q=D[6],Y=D[7],K=T[0],re=T[1],he=T[2],ue=T[3],ce=T[4],Te=T[5],de=T[6],Se=T[7];return Math.abs(A-K)<=e.EPSILON*Math.max(1,Math.abs(A),Math.abs(K))&&Math.abs(z-re)<=e.EPSILON*Math.max(1,Math.abs(z),Math.abs(re))&&Math.abs(B-he)<=e.EPSILON*Math.max(1,Math.abs(B),Math.abs(he))&&Math.abs(N-ue)<=e.EPSILON*Math.max(1,Math.abs(N),Math.abs(ue))&&Math.abs(Z-ce)<=e.EPSILON*Math.max(1,Math.abs(Z),Math.abs(ce))&&Math.abs(X-Te)<=e.EPSILON*Math.max(1,Math.abs(X),Math.abs(Te))&&Math.abs(q-de)<=e.EPSILON*Math.max(1,Math.abs(q),Math.abs(de))&&Math.abs(Y-Se)<=e.EPSILON*Math.max(1,Math.abs(Y),Math.abs(Se))},ti.sqrLen=ti.squaredLength=ti.len=ti.length=ti.dot=ti.mul=ti.setReal=ti.getReal=void 0;var e=l(Re()),i=l(Xi()),s=l(Fi());function h(D){if(typeof WeakMap!="function")return null;var T=new WeakMap,A=new WeakMap;return(h=function(z){return z?A:T})(D)}function l(D,T){if(D&&D.__esModule)return D;if(D===null||a(D)!=="object"&&typeof D!="function")return{default:D};var A=h(T);if(A&&A.has(D))return A.get(D);var z={},B=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var N in D)if(N!=="default"&&Object.prototype.hasOwnProperty.call(D,N)){var Z=B?Object.getOwnPropertyDescriptor(D,N):null;Z&&(Z.get||Z.set)?Object.defineProperty(z,N,Z):z[N]=D[N]}return z.default=D,A&&A.set(D,z),z}function d(D,T,A){var z=.5*A[0],B=.5*A[1],N=.5*A[2],Z=T[0],X=T[1],q=T[2],Y=T[3];return D[0]=Z,D[1]=X,D[2]=q,D[3]=Y,D[4]=z*Y+B*q-N*X,D[5]=B*Y+N*Z-z*q,D[6]=N*Y+z*X-B*Z,D[7]=-z*Z-B*X-N*q,D}function v(D,T){return D[0]=T[0],D[1]=T[1],D[2]=T[2],D[3]=T[3],D[4]=T[4],D[5]=T[5],D[6]=T[6],D[7]=T[7],D}function S(D,T,A){var z=T[0],B=T[1],N=T[2],Z=T[3],X=A[4],q=A[5],Y=A[6],K=A[7],re=T[4],he=T[5],ue=T[6],ce=T[7],Te=A[0],de=A[1],Se=A[2],Ce=A[3];return D[0]=z*Ce+Z*Te+B*Se-N*de,D[1]=B*Ce+Z*de+N*Te-z*Se,D[2]=N*Ce+Z*Se+z*de-B*Te,D[3]=Z*Ce-z*Te-B*de-N*Se,D[4]=z*K+Z*X+B*Y-N*q+re*Ce+ce*Te+he*Se-ue*de,D[5]=B*K+Z*q+N*X-z*Y+he*Ce+ce*de+ue*Te-re*Se,D[6]=N*K+Z*Y+z*q-B*X+ue*Ce+ce*Se+re*de-he*Te,D[7]=Z*K-z*X-B*q-N*Y+ce*Ce-re*Te-he*de-ue*Se,D}ti.getReal=i.copy,ti.setReal=i.copy,ti.mul=S;var R=i.dot;ti.dot=R;var g=i.length;ti.length=g,ti.len=g;var E=i.squaredLength;return ti.squaredLength=E,ti.sqrLen=E,ti}var Kt,Di,Nt={};function wi(){if(Kt)return Nt;function a(T){return a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(A){return typeof A}:function(A){return A&&typeof Symbol=="function"&&A.constructor===Symbol&&A!==Symbol.prototype?"symbol":typeof A},a(T)}Kt=1,Object.defineProperty(Nt,"__esModule",{value:!0}),Nt.create=s,Nt.clone=function(T){var A=new e.ARRAY_TYPE(2);return A[0]=T[0],A[1]=T[1],A},Nt.fromValues=function(T,A){var z=new e.ARRAY_TYPE(2);return z[0]=T,z[1]=A,z},Nt.copy=function(T,A){return T[0]=A[0],T[1]=A[1],T},Nt.set=function(T,A,z){return T[0]=A,T[1]=z,T},Nt.add=function(T,A,z){return T[0]=A[0]+z[0],T[1]=A[1]+z[1],T},Nt.subtract=h,Nt.multiply=l,Nt.divide=d,Nt.ceil=function(T,A){return T[0]=Math.ceil(A[0]),T[1]=Math.ceil(A[1]),T},Nt.floor=function(T,A){return T[0]=Math.floor(A[0]),T[1]=Math.floor(A[1]),T},Nt.min=function(T,A,z){return T[0]=Math.min(A[0],z[0]),T[1]=Math.min(A[1],z[1]),T},Nt.max=function(T,A,z){return T[0]=Math.max(A[0],z[0]),T[1]=Math.max(A[1],z[1]),T},Nt.round=function(T,A){return T[0]=Math.round(A[0]),T[1]=Math.round(A[1]),T},Nt.scale=function(T,A,z){return T[0]=A[0]*z,T[1]=A[1]*z,T},Nt.scaleAndAdd=function(T,A,z,B){return T[0]=A[0]+z[0]*B,T[1]=A[1]+z[1]*B,T},Nt.distance=v,Nt.squaredDistance=S,Nt.length=R,Nt.squaredLength=g,Nt.negate=function(T,A){return T[0]=-A[0],T[1]=-A[1],T},Nt.inverse=function(T,A){return T[0]=1/A[0],T[1]=1/A[1],T},Nt.normalize=function(T,A){var z=A[0],B=A[1],N=z*z+B*B;return N>0&&(N=1/Math.sqrt(N)),T[0]=A[0]*N,T[1]=A[1]*N,T},Nt.dot=function(T,A){return T[0]*A[0]+T[1]*A[1]},Nt.cross=function(T,A,z){var B=A[0]*z[1]-A[1]*z[0];return T[0]=T[1]=0,T[2]=B,T},Nt.lerp=function(T,A,z,B){var N=A[0],Z=A[1];return T[0]=N+B*(z[0]-N),T[1]=Z+B*(z[1]-Z),T},Nt.random=function(T,A){A=A||1;var z=2*e.RANDOM()*Math.PI;return T[0]=Math.cos(z)*A,T[1]=Math.sin(z)*A,T},Nt.transformMat2=function(T,A,z){var B=A[0],N=A[1];return T[0]=z[0]*B+z[2]*N,T[1]=z[1]*B+z[3]*N,T},Nt.transformMat2d=function(T,A,z){var B=A[0],N=A[1];return T[0]=z[0]*B+z[2]*N+z[4],T[1]=z[1]*B+z[3]*N+z[5],T},Nt.transformMat3=function(T,A,z){var B=A[0],N=A[1];return T[0]=z[0]*B+z[3]*N+z[6],T[1]=z[1]*B+z[4]*N+z[7],T},Nt.transformMat4=function(T,A,z){var B=A[0],N=A[1];return T[0]=z[0]*B+z[4]*N+z[12],T[1]=z[1]*B+z[5]*N+z[13],T},Nt.rotate=function(T,A,z,B){var N=A[0]-z[0],Z=A[1]-z[1],X=Math.sin(B),q=Math.cos(B);return T[0]=N*q-Z*X+z[0],T[1]=N*X+Z*q+z[1],T},Nt.angle=function(T,A){var z=T[0],B=T[1],N=A[0],Z=A[1],X=Math.sqrt(z*z+B*B)*Math.sqrt(N*N+Z*Z);return Math.acos(Math.min(Math.max(X&&(z*N+B*Z)/X,-1),1))},Nt.zero=function(T){return T[0]=0,T[1]=0,T},Nt.str=function(T){return"vec2("+T[0]+", "+T[1]+")"},Nt.exactEquals=function(T,A){return T[0]===A[0]&&T[1]===A[1]},Nt.equals=function(T,A){var z=T[0],B=T[1],N=A[0],Z=A[1];return Math.abs(z-N)<=e.EPSILON*Math.max(1,Math.abs(z),Math.abs(N))&&Math.abs(B-Z)<=e.EPSILON*Math.max(1,Math.abs(B),Math.abs(Z))},Nt.forEach=Nt.sqrLen=Nt.sqrDist=Nt.dist=Nt.div=Nt.mul=Nt.sub=Nt.len=void 0;var e=function(T,A){if(T&&T.__esModule)return T;if(T===null||a(T)!=="object"&&typeof T!="function")return{default:T};var z=i(void 0);if(z&&z.has(T))return z.get(T);var B={},N=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Z in T)if(Z!=="default"&&Object.prototype.hasOwnProperty.call(T,Z)){var X=N?Object.getOwnPropertyDescriptor(T,Z):null;X&&(X.get||X.set)?Object.defineProperty(B,Z,X):B[Z]=T[Z]}return B.default=T,z&&z.set(T,B),B}(Re());function i(T){if(typeof WeakMap!="function")return null;var A=new WeakMap,z=new WeakMap;return(i=function(B){return B?z:A})(T)}function s(){var T=new e.ARRAY_TYPE(2);return e.ARRAY_TYPE!=Float32Array&&(T[0]=0,T[1]=0),T}function h(T,A,z){return T[0]=A[0]-z[0],T[1]=A[1]-z[1],T}function l(T,A,z){return T[0]=A[0]*z[0],T[1]=A[1]*z[1],T}function d(T,A,z){return T[0]=A[0]/z[0],T[1]=A[1]/z[1],T}function v(T,A){return Math.hypot(A[0]-T[0],A[1]-T[1])}function S(T,A){var z=A[0]-T[0],B=A[1]-T[1];return z*z+B*B}function R(T){return Math.hypot(T[0],T[1])}function g(T){var A=T[0],z=T[1];return A*A+z*z}Nt.len=R,Nt.sub=h,Nt.mul=l,Nt.div=d,Nt.dist=v,Nt.sqrDist=S,Nt.sqrLen=g;var E,D=(E=s(),function(T,A,z,B,N,Z){var X,q;for(A||(A=2),z||(z=0),q=B?Math.min(B*A+z,T.length):T.length,X=z;X<q;X+=A)E[0]=T[X],E[1]=T[X+1],N(E,E,Z),T[X]=E[0],T[X+1]=E[1];return T});return Nt.forEach=D,Nt}function _r(){if(Di)return ge;function a(T){return a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(A){return typeof A}:function(A){return A&&typeof Symbol=="function"&&A.constructor===Symbol&&A!==Symbol.prototype?"symbol":typeof A},a(T)}Di=1,Object.defineProperty(ge,"__esModule",{value:!0}),ge.vec4=ge.vec3=ge.vec2=ge.quat2=ge.quat=ge.mat4=ge.mat3=ge.mat2d=ge.mat2=ge.glMatrix=void 0;var e=D(Re());ge.glMatrix=e;var i=D(tt());ge.mat2=i;var s=D(Et());ge.mat2d=s;var h=D(Ft());ge.mat3=h;var l=D(Fi());ge.mat4=l;var d=D(Xi());ge.quat=d;var v=D(et());ge.quat2=v;var S=D(wi());ge.vec2=S;var R=D(bn());ge.vec3=R;var g=D(ii());function E(T){if(typeof WeakMap!="function")return null;var A=new WeakMap,z=new WeakMap;return(E=function(B){return B?z:A})(T)}function D(T,A){if(T&&T.__esModule)return T;if(T===null||a(T)!=="object"&&typeof T!="function")return{default:T};var z=E(A);if(z&&z.has(T))return z.get(T);var B={},N=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Z in T)if(Z!=="default"&&Object.prototype.hasOwnProperty.call(T,Z)){var X=N?Object.getOwnPropertyDescriptor(T,Z):null;X&&(X.get||X.set)?Object.defineProperty(B,Z,X):B[Z]=T[Z]}return B.default=T,z&&z.set(T,B),B}return ge.vec4=g,ge}var lr,Cn,gr,nn,Ae=_r(),Ea=function(){if(Cn)return lr;function a(e,i,s,h){this.cx=3*e,this.bx=3*(s-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(h-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=s,this.p2y=h}return Cn=1,lr=a,a.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var s=e,h=0;h<8;h++){var l=this.sampleCurveX(s)-e;if(Math.abs(l)<i)return s;var d=this.sampleCurveDerivativeX(s);if(Math.abs(d)<1e-6)break;s-=l/d}var v=0,S=1;for(s=e,h=0;h<20&&(l=this.sampleCurveX(s),!(Math.abs(l-e)<i));h++)e>l?v=s:S=s,s=.5*(S-v)+v;return s},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},lr}(),to=ae(Ea);function Pa(){if(nn)return gr;function a(e,i){this.x=e,this.y=i}return nn=1,gr=a,a.prototype={clone:function(){return new a(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,i){return this.clone()._rotateAround(e,i)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var i=e.x-this.x,s=e.y-this.y;return i*i+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,i){return Math.atan2(this.x*i-this.y*e,this.x*e+this.y*i)},_matMult:function(e){var i=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=i,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var i=Math.cos(e),s=Math.sin(e),h=s*this.x+i*this.y;return this.x=i*this.x-s*this.y,this.y=h,this},_rotateAround:function(e,i){var s=Math.cos(e),h=Math.sin(e),l=i.y+h*(this.x-i.x)+s*(this.y-i.y);return this.x=i.x+s*(this.x-i.x)-h*(this.y-i.y),this.y=l,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},a.convert=function(e){return e instanceof a?e:Array.isArray(e)?new a(e[0],e[1]):e},gr}var Rt=ae(Pa());function kn(a,e){if(Array.isArray(a)){if(!Array.isArray(e)||a.length!==e.length)return!1;for(let i=0;i<a.length;i++)if(!kn(a[i],e[i]))return!1;return!0}if(typeof a=="object"&&a!==null&&e!==null){if(typeof e!="object"||Object.keys(a).length!==Object.keys(e).length)return!1;for(const i in a)if(!kn(a[i],e[i]))return!1;return!0}return a===e}const Dn=Math.PI/180,Jo=180/Math.PI;function Yi(a){return a*Dn}function Tn(a){return a*Jo}const ka=[[0,0],[1,0],[1,1],[0,1]];function io(a){if(a<=0)return 0;if(a>=1)return 1;const e=a*a,i=e*a;return 4*(a<.5?i:3*(a-e)+i-.75)}function Gl(a,e,i,s){const h=new to(a,e,i,s);return function(l){return h.solve(l)}}const Hl=Gl(.25,.1,.25,1);function Mi(a,e,i){return Math.min(i,Math.max(e,a))}function ro(a,e,i){return(i=Mi((i-a)/(e-a),0,1))*i*(3-2*i)}function us(a,e,i){const s=i-e,h=((a-e)%s+s)%s+e;return h===e?i:h}function wo(a,e,i){if(!a.length)return i(null,[]);let s=a.length;const h=new Array(a.length);let l=null;a.forEach((d,v)=>{e(d,(S,R)=>{S&&(l=S),h[v]=R,--s==0&&i(l,h)})})}function Fn(a,...e){for(const i of e)for(const s in i)a[s]=i[s];return a}let To=1;function el(){return To++}function zc(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))}function Oc(a,e){a.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function Bn(a,e){return a.indexOf(e,a.length-e.length)!==-1}function Kn(a,e,i){const s={};for(const h in a)s[h]=e.call(this,a[h],h,a);return s}function Lc(a,e,i){const s={};for(const h in a)e.call(this,a[h],h,a)&&(s[h]=a[h]);return s}function In(a){return Array.isArray(a)?a.map(In):typeof a=="object"&&a?Kn(a,In):a}const Nn={};function Ri(a){Nn[a]||(typeof console<"u"&&console.warn(a),Nn[a]=!0)}function no(a,e,i){return(i.y-a.y)*(e.x-a.x)>(e.y-a.y)*(i.x-a.x)}function Nh(a){let e=0;for(let i,s,h=0,l=a.length,d=l-1;h<l;d=h++)i=a[h],s=a[d],e+=(s.x-i.x)*(i.y+s.y);return e}function ha([a,e,i]){const s=Yi(e+90),h=Yi(i);return{x:a*Math.cos(s)*Math.sin(h),y:a*Math.sin(s)*Math.sin(h),z:a*Math.cos(h),azimuthal:e,polar:i}}function hs(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function fs(a){const e={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,s,h,l)=>{const d=h||l;return e[s]=!d||d.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let So=null;function ao(a,e){return[a[4*e],a[4*e+1],a[4*e+2],a[4*e+3]]}function Vh(a,e,i,s){for(;e<i;){const h=e+i>>1;a[h]<s?e=h+1:i=h}return e}function Zl(a,e,i,s){for(;e<i;){const h=e+i>>1;a[h]<=s?e=h+1:i=h}return e}function zu(a){return a>0?1/(1.001-a):1+a}function Pc(a){return a>0?1-1/(1.001-a):-a}const Jr={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Jr.API_URL)return null;try{const a=new URL(Jr.API_URL);return a.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":a.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Ou(a){return Jr.API_URL_REGEX.test(a)}function Lu(a){return Jr.API_SPRITE_REGEX.test(a)}let kc,Vn,Ls,We,Q,ie;function oe(){return kc==null&&(kc=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),kc}const ye={now:()=>We!==void 0?We:performance.now(),setNow(a){We=a},restoreNow(){We=void 0},frame(a){const e=requestAnimationFrame(a);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(a,e=0){const{width:i,height:s}=a;Q||(Q=document.createElement("canvas"));const h=Q.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return(i>Q.width||s>Q.height)&&(Q.width=i,Q.height=s),h.clearRect(-e,-e,i+2*e,s+2*e),h.drawImage(a,0,0,i,s),h.getImageData(-e,-e,i+2*e,s+2*e)},resolveURL:a=>(Vn||(Vn=document.createElement("a")),Vn.href=a,Vn.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Ls==null&&(Ls=window.matchMedia("(prefers-reduced-motion: reduce)")),Ls.matches)},hasCanvasFingerprintNoise(){if(ie!==void 0)return ie;if(!oe())return ie=!1,!1;const a=new OffscreenCanvas(85,1),e=a.getContext("2d",{willReadFrequently:!0});let i=0;for(let h=0;h<a.width;++h)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(h,0,1,1);const s=e.getImageData(0,0,a.width,a.height);i=0;for(let h=0;h<s.data.length;++h)if(h%4!=3&&i++!==s.data[h])return ie=!0,!0;return ie=!1,!1}};function we(a,e){const i=a.indexOf("?");if(i<0)return`${a}?${new URLSearchParams(e).toString()}`;const s=new URLSearchParams(a.slice(i));for(const h in e)s.set(h,e[h]);return`${a.slice(0,i)}?${s.toString()}`}function De(a,e={persistentParams:[]}){const i=a.indexOf("?");if(i<0)return a;const s=new URLSearchParams,h=new URLSearchParams(a.slice(i));for(const d of e.persistentParams){const v=h.get(d);v&&s.set(d,v)}const l=s.toString();return`${a.slice(0,i)}${l.length>0?`?${l}`:""}`}const Ve="mapbox-tiles";let Oe=500,Ze=50;const He=["language","worldview","jobid"];let Xe,ht;function At(){try{return caches}catch{}}function Dt(){const a=At();a&&Xe==null&&(Xe=a.open(Ve))}let Jt=1/0;const fi={supported:!1,testSupport:function(a){!ji&&si&&(qi?tr(a):pi=a)}};let pi,si,ji=!1,qi=!1;const Ni=typeof self<"u"?self:{};function tr(a){const e=a.createTexture();a.bindTexture(a.TEXTURE_2D,e);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,si),a.isContextLost())return;fi.supported=!0}catch{}a.deleteTexture(e),ji=!0}Ni.document&&(si=Ni.document.createElement("img"),si.onload=function(){pi&&tr(pi),pi=null,qi=!0},si.onerror=function(){ji=!0,pi=null},si.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const sr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(sr);class un extends Error{constructor(e,i,s){i===401&&Ou(s)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=s}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Wa=hs()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,an=function(a,e){if(!(/^file:/.test(i=a.url)||/^file:/.test(Wa())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(s,h){const l=new AbortController,d=new Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,referrer:Wa(),referrerPolicy:s.referrerPolicy,signal:l.signal});let v=!1,S=!1;const R=(g=d.url).indexOf("sku=")>0&&Ou(g);var g;s.type==="json"&&d.headers.set("Accept","application/json");const E=(T,A,z)=>{if(S)return;if(T&&T.message!=="SecurityError"&&Ri(T.toString()),A&&z)return D(A);const B=Date.now();fetch(d).then(N=>{if(N.ok){const Z=R?N.clone():null;return D(N,Z,B)}return h(new un(N.statusText,N.status,s.url))}).catch(N=>{N.name!=="AbortError"&&h(new Error(`${N.message} ${s.url}`))})},D=(T,A,z)=>{(s.type==="arrayBuffer"?T.arrayBuffer():s.type==="json"?T.json():T.text()).then(B=>{S||(A&&z&&function(N,Z,X){if(Dt(),Xe==null)return;const q=fs(Z.headers.get("Cache-Control")||"");if(q["no-store"])return;const Y={status:Z.status,statusText:Z.statusText,headers:new Headers};Z.headers.forEach((he,ue)=>Y.headers.set(ue,he)),q["max-age"]&&Y.headers.set("Expires",new Date(X+1e3*q["max-age"]).toUTCString());const K=Y.headers.get("Expires");if(!K||new Date(K).getTime()-X<42e4)return;let re=De(N.url,{persistentParams:He});if(Z.status===206){const he=N.headers.get("Range");if(!he)return;Y.status=200,re=we(re,{range:he})}(function(he,ue){if(ht===void 0)try{new Response(new ReadableStream),ht=!0}catch{ht=!1}ht?ue(he.body):he.blob().then(ue)})(Z,he=>{const ue=new Response((ce=Z.status)!==200&&ce!==404&&[101,103,204,205,304].includes(ce)?null:he,Y);var ce;Dt(),Xe!=null&&Xe.then(Te=>Te.put(re,ue)).catch(Te=>Ri(Te.message))})}(d,A,z),v=!0,h(null,B,T.headers.get("Cache-Control"),T.headers.get("Expires")))}).catch(B=>{S||h(new Error(B.message))})};return R?function(T,A){if(Dt(),Xe==null)return A(null);Xe.then(z=>{let B=De(T.url,{persistentParams:He});const N=T.headers.get("Range");N&&(B=we(B,{range:N})),z.match(B).then(Z=>{const X=function(q){if(!q)return!1;const Y=new Date(q.headers.get("Expires")||0),K=fs(q.headers.get("Cache-Control")||"");return Y>Date.now()&&!K["no-cache"]}(Z);z.delete(B),X&&z.put(B,Z.clone()),A(null,Z,X)}).catch(A)}).catch(A)}(d,E):E(null,null),{cancel:()=>{S=!0,v||l.abort()}}}(a,e);if(hs()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,e,void 0,!0)}var i;return function(s,h){const l=new XMLHttpRequest;l.open(s.method||"GET",s.url,!0),s.type==="arrayBuffer"&&(l.responseType="arraybuffer");for(const d in s.headers)l.setRequestHeader(d,s.headers[d]);return s.type==="json"&&(l.responseType="text",l.setRequestHeader("Accept","application/json")),l.withCredentials=s.credentials==="include",l.onerror=()=>{h(new Error(l.statusText))},l.onload=()=>{if((l.status>=200&&l.status<300||l.status===0)&&l.response!==null){let d=l.response;if(s.type==="json")try{d=JSON.parse(l.response)}catch(v){return h(v)}h(null,d,l.getResponseHeader("Cache-Control"),l.getResponseHeader("Expires"))}else h(new un(l.statusText,l.status,s.url))},l.send(s.body),{cancel:()=>l.abort()}}(a,e)},Gr=function(a,e){return an(Fn(a,{type:"arrayBuffer"}),e)};function $r(a){const e=document.createElement("a");return e.href=a,e.protocol===location.protocol&&e.host===location.host}const Fc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Eo,tl;Eo=[],tl=0;const Uh=function(a,e){if(fi.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),tl>=Jr.MAX_PARALLEL_IMAGE_REQUESTS){const l={requestParameters:a,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Eo.push(l),l}tl++;let i=!1;const s=()=>{if(!i)for(i=!0,tl--;Eo.length&&tl<Jr.MAX_PARALLEL_IMAGE_REQUESTS;){const l=Eo.shift(),{requestParameters:d,callback:v,cancelled:S}=l;S||(l.cancel=Uh(d,v).cancel)}},h=Gr(a,(l,d,v,S)=>{s(),l?e(l):d&&(self.createImageBitmap?function(R,g){const E=new Blob([new Uint8Array(R)],{type:"image/png"});createImageBitmap(E).then(D=>{g(null,D)}).catch(D=>{g(new Error(`Could not load image because of ${D.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(d,(R,g)=>e(R,g,v,S)):function(R,g){const E=new Image;E.onload=()=>{g(null,E),URL.revokeObjectURL(E.src),E.onload=null,requestAnimationFrame(()=>{E.src=Fc})},E.onerror=()=>g(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const D=new Blob([new Uint8Array(R)],{type:"image/png"});E.src=R.byteLength?URL.createObjectURL(D):Fc}(d,(R,g)=>e(R,g,v,S)))});return{cancel:()=>{h.cancel(),s()}}};var Pu,$f,Fa,Jn={exports:{}},ds={exports:{}},Ps={exports:{}},Ma=function(){if(Fa)return Jn.exports;Fa=1;var a=(Pu||(Pu=1,ds.exports=function(i,s){var h,l,d,v,S,R,g,E;for(l=i.length-(h=3&i.length),d=s,S=3432918353,R=461845907,E=0;E<l;)g=255&i.charCodeAt(E)|(255&i.charCodeAt(++E))<<8|(255&i.charCodeAt(++E))<<16|(255&i.charCodeAt(++E))<<24,++E,d=27492+(65535&(v=5*(65535&(d=(d^=g=(65535&(g=(g=(65535&g)*S+(((g>>>16)*S&65535)<<16)&4294967295)<<15|g>>>17))*R+(((g>>>16)*R&65535)<<16)&4294967295)<<13|d>>>19))+((5*(d>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(g=0,h){case 3:g^=(255&i.charCodeAt(E+2))<<16;case 2:g^=(255&i.charCodeAt(E+1))<<8;case 1:d^=g=(65535&(g=(g=(65535&(g^=255&i.charCodeAt(E)))*S+(((g>>>16)*S&65535)<<16)&4294967295)<<15|g>>>17))*R+(((g>>>16)*R&65535)<<16)&4294967295}return d^=i.length,d=2246822507*(65535&(d^=d>>>16))+((2246822507*(d>>>16)&65535)<<16)&4294967295,d=3266489909*(65535&(d^=d>>>13))+((3266489909*(d>>>16)&65535)<<16)&4294967295,(d^=d>>>16)>>>0}),ds.exports),e=($f||($f=1,Ps.exports=function(i,s){for(var h,l=i.length,d=s^l,v=0;l>=4;)h=1540483477*(65535&(h=255&i.charCodeAt(v)|(255&i.charCodeAt(++v))<<8|(255&i.charCodeAt(++v))<<16|(255&i.charCodeAt(++v))<<24))+((1540483477*(h>>>16)&65535)<<16),d=1540483477*(65535&d)+((1540483477*(d>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),l-=4,++v;switch(l){case 3:d^=(255&i.charCodeAt(v+2))<<16;case 2:d^=(255&i.charCodeAt(v+1))<<8;case 1:d=1540483477*(65535&(d^=255&i.charCodeAt(v)))+((1540483477*(d>>>16)&65535)<<16)}return d=1540483477*(65535&(d^=d>>>13))+((1540483477*(d>>>16)&65535)<<16),(d^=d>>>15)>>>0}),Ps.exports);return Jn.exports=a,Jn.exports.murmur3=a,Jn.exports.murmur2=e,Jn.exports}(),ps=ae(Ma);class ks{constructor(e,...i){Fn(this,i[0]||{}),this.type=e}}class Mo extends ks{constructor(e,i={}){super("error",Fn({error:e},i))}}function Qf(a,e,i){i[a]&&i[a].indexOf(e)!==-1||(i[a]=i[a]||[],i[a].push(e))}function Ao(a,e,i){if(i&&i[a]){const s=i[a].indexOf(e);s!==-1&&i[a].splice(s,1)}}class Co{on(e,i){return this._listeners=this._listeners||{},Qf(e,i,this._listeners),this}off(e,i){return Ao(e,i,this._listeners),Ao(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},Qf(e,i,this._oneTimeListeners),this):new Promise(s=>this.once(e,s))}fire(e,i){const s=typeof e=="string"?new ks(e,i):e,h=s.type;if(this.listens(h)){s.target=this;const l=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const S of l)S.call(this,s);const d=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const S of d)Ao(h,S,this._oneTimeListeners),S.call(this,s);const v=this._eventedParent;v&&(Fn(s,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),v.fire(s))}else s instanceof Mo&&console.error(s.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}var jh,Kf={},ms=function(){if(jh)return Kf;jh=1;var a={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(l){return(l=Math.round(l))<0?0:l>255?255:l}function i(l){return e(l[l.length-1]==="%"?parseFloat(l)/100*255:parseInt(l))}function s(l){return(d=l[l.length-1]==="%"?parseFloat(l)/100:parseFloat(l))<0?0:d>1?1:d;var d}function h(l,d,v){return v<0?v+=1:v>1&&(v-=1),6*v<1?l+(d-l)*v*6:2*v<1?d:3*v<2?l+(d-l)*(2/3-v)*6:l}try{Kf.parseCSSColor=function(l){var d,v=l.replace(/ /g,"").toLowerCase();if(v in a)return a[v].slice();if(v[0]==="#")return v.length===4?(d=parseInt(v.substr(1),16))>=0&&d<=4095?[(3840&d)>>4|(3840&d)>>8,240&d|(240&d)>>4,15&d|(15&d)<<4,1]:null:v.length===7&&(d=parseInt(v.substr(1),16))>=0&&d<=16777215?[(16711680&d)>>16,(65280&d)>>8,255&d,1]:null;var S=v.indexOf("("),R=v.indexOf(")");if(S!==-1&&R+1===v.length){var g=v.substr(0,S),E=v.substr(S+1,R-(S+1)).split(","),D=1;switch(g){case"rgba":if(E.length!==4)return null;D=s(E.pop());case"rgb":return E.length!==3?null:[i(E[0]),i(E[1]),i(E[2]),D];case"hsla":if(E.length!==4)return null;D=s(E.pop());case"hsl":if(E.length!==3)return null;var T=(parseFloat(E[0])%360+360)%360/360,A=s(E[1]),z=s(E[2]),B=z<=.5?z*(A+1):z+A-z*A,N=2*z-B;return[e(255*h(N,B,T+1/3)),e(255*h(N,B,T)),e(255*h(N,B,T-1/3)),D];default:return null}}return null}}catch{}return Kf}();class nr{constructor(e,i,s,h=1){this.r=e,this.g=i,this.b=s,this.a=h}static parse(e){if(!e)return;if(e instanceof nr)return e;if(typeof e!="string")return;const i=ms.parseCSSColor(e);return i?new nr(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toStringPremultipliedAlpha(){const[e,i,s,h]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(s)},${h})`}toString(){const[e,i,s,h]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*i)},${Math.round(255*s)},${h})`}toRenderColor(e){const{r:i,g:s,b:h,a:l}=this;return new ku(e,i,s,h,l)}clone(){return new nr(this.r,this.g,this.b,this.a)}}class ku{constructor(e,i,s,h,l){if(e){const d=e.image.height,v=d*d;i=l===0?0:i/l*(d-1),s=l===0?0:s/l*(d-1),h=l===0?0:h/l*(d-1);const S=Math.floor(i),R=Math.floor(s),g=Math.floor(h),E=Math.ceil(i),D=Math.ceil(s),T=Math.ceil(h),A=i-S,z=s-R,B=h-g,N=e.image.data,Z=4*(S+R*v+g*d),X=4*(S+R*v+T*d),q=4*(S+D*v+g*d),Y=4*(S+D*v+T*d),K=4*(E+R*v+g*d),re=4*(E+R*v+T*d),he=4*(E+D*v+g*d),ue=4*(E+D*v+T*d);if(Z<0||ue>=N.length)throw new Error("out of range");this.r=di(di(di(N[Z],N[X],B),di(N[q],N[Y],B),z),di(di(N[K],N[re],B),di(N[he],N[ue],B),z),A)/255*l,this.g=di(di(di(N[Z+1],N[X+1],B),di(N[q+1],N[Y+1],B),z),di(di(N[K+1],N[re+1],B),di(N[he+1],N[ue+1],B),z),A)/255*l,this.b=di(di(di(N[Z+2],N[X+2],B),di(N[q+2],N[Y+2],B),z),di(di(N[K+2],N[re+2],B),di(N[he+2],N[ue+2],B),z),A)/255*l,this.a=l}else this.r=i,this.g=s,this.b=h,this.a=l}toArray(){const{r:e,g:i,b:s,a:h}=this;return h===0?[0,0,0,0]:[255*e/h,255*i/h,255*s/h,h]}toHslaArray(){if(this.a===0)return[0,0,0,0];const{r:e,g:i,b:s,a:h}=this,l=Math.min(Math.max(e/h,0),1),d=Math.min(Math.max(i/h,0),1),v=Math.min(Math.max(s/h,0),1),S=Math.min(l,d,v),R=Math.max(l,d,v),g=(S+R)/2;if(S===R)return[0,0,100*g,h];const E=R-S,D=g>.5?E/(2-R-S):E/(R+S);let T=0;return R===l?T=(d-v)/E+(d<v?6:0):R===d?T=(v-l)/E+2:R===v&&(T=(l-d)/E+4),T*=60,[Math.min(Math.max(T,0),360),Math.min(Math.max(100*D,0),100),Math.min(Math.max(100*g,0),100),h]}toArray01(){const{r:e,g:i,b:s,a:h}=this;return h===0?[0,0,0,0]:[e/h,i/h,s/h,h]}toArray01Scaled(e){const{r:i,g:s,b:h,a:l}=this;return l===0?[0,0,0]:[i/l*e,s/l*e,h/l*e]}toArray01PremultipliedAlpha(){const{r:e,g:i,b:s,a:h}=this;return[e,i,s,h]}toArray01Linear(){const{r:e,g:i,b:s,a:h}=this;return h===0?[0,0,0,0]:[Math.pow(e/h,2.2),Math.pow(i/h,2.2),Math.pow(s/h,2.2),h]}}function di(a,e,i){return a*(1-i)+e*i}function Xl(a,e,i){return a.map((s,h)=>di(s,e[h],i))}nr.black=new nr(0,0,0,1),nr.white=new nr(1,1,1,1),nr.transparent=new nr(0,0,0,0),nr.red=new nr(1,0,0,1),nr.blue=new nr(0,0,1,1);var Do=Object.freeze({__proto__:null,array:Xl,color:function(a,e,i){return new nr(di(a.r,e.r,i),di(a.g,e.g,i),di(a.b,e.b,i),di(a.a,e.a,i))},number:di});function Fu(a,...e){for(const i of e)for(const s in i)a[s]=i[s];return a}class Vi extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class Bu{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[s,h]of i)this.bindings[s]=h}concat(e){return new Bu(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Fs={kind:"null"},Qt={kind:"number"},or={kind:"string"},Hi={kind:"boolean"},Un={kind:"color"},_s={kind:"object"},ar={kind:"value"},il={kind:"collator"},$a={kind:"formatted"},Bc={kind:"resolvedImage"};function Or(a,e){return{kind:"array",itemType:a,N:e}}function Lr(a){if(a.kind==="array"){const e=Lr(a.itemType);return typeof a.N=="number"?`array<${e}, ${a.N}>`:a.itemType.kind==="value"?"array":`array<${e}>`}return a.kind}const Nc=[Fs,Qt,or,Hi,Un,$a,_s,Or(ar),Bc];function jn(a,e){if(e.kind==="error")return null;if(a.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!jn(a.itemType,e.itemType))&&(typeof a.N!="number"||a.N===e.N))return null}else{if(a.kind===e.kind)return null;if(a.kind==="value"){for(const i of Nc)if(!jn(i,e))return null}}return`Expected ${Lr(a)} but found ${Lr(e)} instead.`}function qh(a,e){return e.some(i=>i.kind===a.kind)}function Yl(a,e){return e.some(i=>i==="null"?a===null:i==="array"?Array.isArray(a):i==="object"?a&&!Array.isArray(a)&&typeof a=="object":i===typeof a)}class Vc{constructor(e,i,s){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Io{constructor(e,i,s,h,l){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=s,this.fontStack=h,this.textColor=l}}class Rn{constructor(e){this.sections=e}static fromString(e){return new Rn([new Io(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.namePrimary)}static factory(e){return e instanceof Rn?e:Rn.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){e.push(["image",i.image.namePrimary]);continue}e.push(i.text);const s={};i.fontStack&&(s["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(s["font-scale"]=i.scale),i.textColor&&(s["text-color"]=["rgba"].concat(i.textColor.toRenderColor(null).toArray())),e.push(s)}return e}}class Bs{constructor(e,i){if(this.id=e,this.options=i||{params:{}},this.options.transform){const{a:s,b:h,c:l,d,e:v,f:S}=this.options.transform;this.options.transform=new DOMMatrix([s,h,l,d,v,S])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}static deserializeId(e){return JSON.parse(e).id}static deserializeFromString(e){const i=JSON.parse(e),{a:s,b:h,c:l,d,e:v,f:S}=i.options.transform;return new DOMMatrix([s,h,l,d,v,S]),new Bs(i.id,i.options)}scaleSelf(e){return this.options.transform=this.options.transform.scale(e),this}serialize(){const e={id:this.id};this.options&&(e.options=this.options);const{a:i,b:s,c:h,d:l,e:d,f:v}=this.options.transform;return e.options.transform={a:i,b:s,c:h,d:l,e:d,f:v},JSON.stringify(e)}}class ea{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),e.optionsPrimary&&(this.optionsPrimary=e.optionsPrimary),e.optionsSecondary&&(this.optionsSecondary=e.optionsSecondary),this.available=e.available}toString(){return this.namePrimary&&this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}getPrimary(){return new Bs(this.namePrimary,{params:this.optionsPrimary&&this.optionsPrimary.params||{}})}getSerializedPrimary(){return this.getPrimary().serialize()}getSecondary(){return this.nameSecondary?new Bs(this.nameSecondary,{params:this.optionsSecondary&&this.optionsSecondary.params||{}}):null}static from(e){return typeof e=="string"?ea.build(e):e}static build(e,i,s,h){return e?new ea({namePrimary:e,nameSecondary:i,optionsPrimary:s,optionsSecondary:h,available:!1}):null}}function Jf(a,e,i,s){return typeof a=="number"&&a>=0&&a<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?s===void 0||typeof s=="number"&&s>=0&&s<=1?null:`Invalid rgba value [${[a,e,i,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof s=="number"?[a,e,i,s]:[a,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ro(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof nr||a instanceof Vc||a instanceof Rn||a instanceof ea)return!0;if(Array.isArray(a)){for(const e of a)if(!Ro(e))return!1;return!0}if(typeof a=="object"){for(const e in a)if(!Ro(a[e]))return!1;return!0}return!1}function Hr(a){if(a===null)return Fs;if(typeof a=="string")return or;if(typeof a=="boolean")return Hi;if(typeof a=="number")return Qt;if(a instanceof nr)return Un;if(a instanceof Vc)return il;if(a instanceof Rn)return $a;if(a instanceof ea)return Bc;if(Array.isArray(a)){const e=a.length;let i;for(const s of a){const h=Hr(s);if(i){if(i===h)continue;i=ar;break}i=h}return Or(i||ar,e)}return _s}function gs(a){const e=typeof a;return a===null?"":e==="string"||e==="number"||e==="boolean"?String(a):a instanceof nr?a.toStringPremultipliedAlpha():a instanceof Rn||a instanceof ea?a.toString():JSON.stringify(a)}class qn{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Ro(e[1]))return i.error("invalid value");const s=e[1];let h=Hr(s);const l=i.expectedType;return h.kind!=="array"||h.N!==0||!l||l.kind!=="array"||typeof l.N=="number"&&l.N!==0||(h=l),new qn(h,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof nr?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof Rn?this.value.serialize():this.value}}class hn{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Nu={string:or,number:Qt,boolean:Hi,object:_s};class Ns{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let s,h=1;const l=e[0];if(l==="array"){let v,S;if(e.length>2){const R=e[1];if(typeof R!="string"||!(R in Nu)||R==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);v=Nu[R],h++}else v=ar;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);S=e[2],h++}s=Or(v,S)}else s=Nu[l];const d=[];for(;h<e.length;h++){const v=i.parse(e[h],h,ar);if(!v)return null;d.push(v)}return new Ns(s,d)}evaluate(e){for(let i=0;i<this.args.length;i++){const s=this.args[i].evaluate(e);if(!jn(this.type,Hr(s)))return s;if(i===this.args.length-1)throw new hn(`The expression ${JSON.stringify(this.args[i].serialize())} evaluated to ${Lr(Hr(s))} but was expected to be of type ${Lr(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const s=e.itemType;if(s.kind==="string"||s.kind==="number"||s.kind==="boolean"){i.push(s.kind);const h=e.N;(typeof h=="number"||this.args.length>1)&&i.push(h)}}return i.concat(this.args.map(s=>s.serialize()))}}class rl{constructor(e){this.type=$a,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&typeof s=="object")return i.error("First argument must be an image or text section.");const h=[];let l=!1;for(let d=1;d<=e.length-1;++d){const v=e[d];if(l&&typeof v=="object"&&!Array.isArray(v)){l=!1;let S=null;if(v["font-scale"]&&(S=i.parseObjectValue(v["font-scale"],d,"font-scale",Qt),!S))return null;let R=null;if(v["text-font"]&&(R=i.parseObjectValue(v["text-font"],d,"text-font",Or(or)),!R))return null;let g=null;if(v["text-color"]&&(g=i.parseObjectValue(v["text-color"],d,"text-color",Un),!g))return null;const E=h[h.length-1];E.scale=S,E.font=R,E.textColor=g}else{const S=i.parse(e[d],d,ar);if(!S)return null;const R=S.type.kind;if(R!=="string"&&R!=="value"&&R!=="null"&&R!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");l=!0,h.push({content:S,scale:null,font:null,textColor:null})}}return new rl(h)}evaluate(e){return new Rn(this.sections.map(i=>{const s=i.content.evaluate(e);return Hr(s)===Bc?new Io("",s,null,null,null):new Io(gs(s),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const s={};i.scale&&(s["font-scale"]=i.scale.serialize()),i.font&&(s["text-font"]=i.font.serialize()),i.textColor&&(s["text-color"]=i.textColor.serialize()),e.push(s)}return e}}class Vu{constructor(e,i,s,h){this._imageWarnHistory={},this.type=Bc,this.inputPrimary=e,this.inputSecondary=i,this.inputPrimaryParams=s,this.inputSecondaryParams=h}static parse(e,i){if(e.length<2)return i.error("Expected two or more arguments.");let s=1;const h=[];function l(){if(s<e.length){const v=i.parse(e[s],s++,or);return v?(h.push({image:v,options:void 0}),!0):(i.error(h.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function d(){if(s<e.length){if((v=e[s])===null||typeof v!="object"||Array.isArray(v))return!0;const S=e[s].params,R=i.concat(s);if(!S)return s++,!0;if(typeof S!="object"||S.constructor!==Object)return R.error('Image options "params" should be an object'),!1;const g={},E=R.concat(void 0,"params");for(const D in S){if(!D)return E.error("Image parameter name should be non-empty"),!1;const T=E.concat(void 0,D).parse(S[D],void 0,Un,void 0,{typeAnnotation:"coerce"});if(!T)return!1;g[D]=T}return h[h.length-1].options=g,s++,!0}var v;return!0}for(let v=0;v<2;v++)if(!l()||!d())return;return new Vu(h[0].image,h[1]?h[1].image:void 0,h[0].options,h[1]?h[1].options:void 0)}evaluateParams(e,i){const s={};if(i){for(const h in i)if(i[h])try{const l=i[h].evaluate(e),d=`Ignoring image parameter "${h}" with semi-transparent color ${l.toString()}`;if(l.a!==1){this._imageWarnHistory[d]||(console.warn(d),this._imageWarnHistory[d]=!0);continue}s[h]=l}catch{continue}if(Object.keys(s).length!==0)return{params:s}}}evaluate(e){const i=ea.build(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0,this.inputPrimaryParams?this.evaluateParams(e,this.inputPrimaryParams):void 0,this.inputSecondaryParams?this.evaluateParams(e,this.inputSecondaryParams):void 0);return i&&e.availableImages&&(i.available=e.availableImages.indexOf(i.namePrimary)>-1,i.nameSecondary&&i.available&&e.availableImages&&(i.available=e.availableImages.indexOf(i.nameSecondary)>-1)),i}eachChild(e){if(e(this.inputPrimary),this.inputPrimaryParams)for(const i in this.inputPrimaryParams)this.inputPrimaryParams[i]&&e(this.inputPrimaryParams[i]);if(this.inputSecondary&&(e(this.inputSecondary),this.inputSecondaryParams))for(const i in this.inputSecondaryParams)this.inputSecondaryParams[i]&&e(this.inputSecondaryParams[i])}outputDefined(){return!1}serializeParams(e){const i={};if(e){for(const s in e)e[s]&&(i[s]=e[s].serialize());return{params:i}}}serialize(){const e=["image",this.inputPrimary.serialize()];return this.inputPrimaryParams&&e.push(this.serializeParams(this.inputPrimaryParams)),this.inputSecondary&&(e.push(this.inputSecondary.serialize()),this.inputSecondaryParams&&e.push(this.serializeParams(this.inputSecondaryParams))),e}}function Vs(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}const ed={"to-boolean":Hi,"to-color":Un,"to-number":Qt,"to-string":or};class zo{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const s=e[0],h=[];let l=Fs;if(s==="to-array"){if(!Array.isArray(e[1]))return null;const d=e[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);l=Or(i.expectedType.itemType,d)}else{if(!(d>0&&Ro(e[1][0])))return null;l=Or(Hr(e[1][0]),d)}for(let v=0;v<d;v++){const S=e[1][v];let R;if(Vs(S)==="array")R=i.parse(S,void 0,l.itemType);else{const g=Vs(S);if(g!==l.itemType.kind)return i.error(`Expected ${l.itemType.kind} but found ${g}.`);R=i.registry.literal.parse(["literal",S===void 0?null:S],i)}if(!R)return null;h.push(R)}}else{if((s==="to-boolean"||s==="to-string")&&e.length!==2)return i.error("Expected one argument.");l=ed[s];for(let d=1;d<e.length;d++){const v=i.parse(e[d],d,ar);if(!v)return null;h.push(v)}}return new zo(l,h)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,s;for(const h of this.args){if(i=h.evaluate(e),s=null,i instanceof nr)return i;if(typeof i=="string"){const l=e.parseColor(i);if(l)return l}else if(Array.isArray(i)&&(s=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Jf(i[0],i[1],i[2],i[3]),!s))return new nr(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new hn(s||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const s of this.args){if(i=s.evaluate(e),i===null)return 0;const h=Number(i);if(!isNaN(h))return h}throw new hn(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?Rn.fromString(gs(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?ea.build(gs(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(i=>i.evaluate(e)):gs(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new rl([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Vu(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}const td=["Unknown","Point","LineString","Polygon"];class id{constructor(e,i){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=i}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?td[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:s,y:h}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(s*i-e[0])+this.featureDistanceData.bearing[1]*(h*i-e[1])}return 0}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=nr.parse(e)),i}getConfig(e){return this.options?this.options.get(e):null}}class Aa{constructor(e,i,s,h,l){this.name=e,this.type=i,this._evaluate=s,this.args=h,this._overloadIndex=l}evaluate(e){if(!this._evaluate){const i=Aa.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const s=e[0],h=Aa.definitions[s];if(!h)return i.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const l=Array.isArray(h)?h[0]:h.type,d=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,v=[];let S=null,R=-1;for(const[g,E]of d){if(Array.isArray(g)&&g.length!==e.length-1)continue;v.push(g),R++,S=new dl(i.registry,i.path,null,i.scope,void 0,i._scope,i.options);const D=[];let T=!1;for(let A=1;A<e.length;A++){const z=e[A],B=Array.isArray(g)?g[A-1]:g.type,N=S.parse(z,1+D.length,B);if(!N){T=!0;break}D.push(N)}if(!T)if(Array.isArray(g)&&g.length!==D.length)S.error(`Expected ${g.length} arguments, but found ${D.length} instead.`);else{for(let A=0;A<D.length;A++){const z=Array.isArray(g)?g[A]:g.type,B=D[A];S.concat(A+1).checkSubtype(z,B.type)}if(S.errors.length===0)return new Aa(s,l,E,D,R)}}if(v.length===1)i.errors.push(...S.errors);else{const g=(v.length?v:d.map(([D])=>D)).map(rd).join(" | "),E=[];for(let D=1;D<e.length;D++){const T=i.parse(e[D],1+E.length);if(!T)return null;E.push(Lr(T.type))}i.error(`Expected arguments of type ${g}, but found (${E.join(", ")}) instead.`)}return null}static register(e,i){Aa.definitions=i;for(const s in i)e[s]=Aa}}function rd(a){return Array.isArray(a)?`(${a.map(Lr).join(", ")})`:`(${Lr(a.type)}...)`}class Uu{constructor(e,i,s){this.type=il,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const s=e[1];if(typeof s!="object"||Array.isArray(s))return i.error("Collator options argument must be an object.");const h=s["case-sensitive"]===void 0?i.parse(!1,1,Hi):i.parseObjectValue(s["case-sensitive"],1,"case-sensitive",Hi);if(!h)return null;const l=s["diacritic-sensitive"]===void 0?i.parse(!1,1,Hi):i.parseObjectValue(s["diacritic-sensitive"],1,"diacritic-sensitive",Hi);if(!l)return null;let d=null;return s.locale&&(d=i.parseObjectValue(s.locale,1,"locale",or),!d)?null:new Uu(h,l,d)}evaluate(e){return new Vc(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function ju(a,e,i=0,s=a.length-1,h=Lm){for(;s>i;){if(s-i>600){const S=s-i+1,R=e-i+1,g=Math.log(S),E=.5*Math.exp(2*g/3),D=.5*Math.sqrt(g*E*(S-E)/S)*(R-S/2<0?-1:1);ju(a,e,Math.max(i,Math.floor(e-R*E/S+D)),Math.min(s,Math.floor(e+(S-R)*E/S+D)),h)}const l=a[e];let d=i,v=s;for(qu(a,i,e),h(a[s],l)>0&&qu(a,i,s);d<v;){for(qu(a,d,v),d++,v--;h(a[d],l)<0;)d++;for(;h(a[v],l)>0;)v--}h(a[i],l)===0?qu(a,i,v):(v++,qu(a,v,s)),v<=e&&(i=v+1),e<=v&&(s=v-1)}}function qu(a,e,i){const s=a[e];a[e]=a[i],a[i]=s}function Lm(a,e){return a<e?-1:a>e?1:0}function Pm(a){let e=0;for(let i,s,h=0,l=a.length,d=l-1;h<l;d=h++)i=a[h],s=a[d],e+=(s.x-i.x)*(i.y+s.y);return e}function Gu(a,e){a[0]=Math.min(a[0],e[0]),a[1]=Math.min(a[1],e[1]),a[2]=Math.max(a[2],e[0]),a[3]=Math.max(a[3],e[1])}function Hu(a,e){return!(a[0]<=e[0]||a[2]>=e[2]||a[1]<=e[1]||a[3]>=e[3])}function km(a,e,i){const s=a[0]-e[0],h=a[1]-e[1],l=a[0]-i[0],d=a[1]-i[1];return s*d-l*h==0&&s*l<=0&&h*d<=0}function Uc(a,e,i=!1){let s=!1;for(let v=0,S=e.length;v<S;v++){const R=e[v];for(let g=0,E=R.length,D=E-1;g<E;D=g++){const T=R[D],A=R[g];if(km(a,T,A))return i;(l=T)[1]>(h=a)[1]!=(d=A)[1]>h[1]&&h[0]<(d[0]-l[0])*(h[1]-l[1])/(d[1]-l[1])+l[0]&&(s=!s)}}var h,l,d;return s}function nd(a,e,i,s){const h=s[0]-i[0],l=s[1]-i[1],d=(a[0]-i[0])*l-h*(a[1]-i[1]),v=(e[0]-i[0])*l-h*(e[1]-i[1]);return d>0&&v<0||d<0&&v>0}function Us(a,e,i,s){return(h=[s[0]-i[0],s[1]-i[1]])[0]*(l=[e[0]-a[0],e[1]-a[1]])[1]-h[1]*l[0]!=0&&!(!nd(a,e,i,s)||!nd(i,s,a,e));var h,l}const ys=8192;function Fm(a,e){const i=(180+a[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,h=Math.pow(2,e.z);return[Math.round(i*h*ys),Math.round(s*h*ys)]}function Gh(a,e){for(let i=0;i<e.length;i++)if(Uc(a,e[i]))return!0;return!1}function up(a,e,i){for(const s of i)for(let h=0,l=s.length,d=l-1;h<l;d=h++)if(Us(a,e,s[d],s[h]))return!0;return!1}function ad(a,e){for(let i=0;i<a.length;++i)if(!Uc(a[i],e))return!1;for(let i=0;i<a.length-1;++i)if(up(a[i],a[i+1],e))return!1;return!0}function hp(a,e){for(let i=0;i<e.length;i++)if(ad(a,e[i]))return!0;return!1}function Hh(a,e,i){const s=[];for(let h=0;h<a.length;h++){const l=[];for(let d=0;d<a[h].length;d++){const v=Fm(a[h][d],i);Gu(e,v),l.push(v)}s.push(l)}return s}function vs(a,e,i){const s=[];for(let h=0;h<a.length;h++){const l=Hh(a[h],e,i);s.push(l)}return s}function Ui(a,e,i,s){if(a[0]<i[0]||a[0]>i[2]){const h=.5*s;let l=a[0]-i[0]>h?-s:i[0]-a[0]>h?s:0;l===0&&(l=a[0]-i[2]>h?-s:i[2]-a[0]>h?s:0),a[0]+=l}Gu(e,a)}function ci(a,e,i,s){const h=Math.pow(2,s.z)*ys,l=[s.x*ys,s.y*ys],d=[];if(!a)return d;for(const v of a)for(const S of v){const R=[S.x+l[0],S.y+l[1]];Ui(R,e,i,h),d.push(R)}return d}function Zh(a,e,i,s){const h=Math.pow(2,s.z)*ys,l=[s.x*ys,s.y*ys],d=[];if(!a)return d;for(const S of a){const R=[];for(const g of S){const E=[g.x+l[0],g.y+l[1]];Gu(e,E),R.push(E)}d.push(R)}if(e[2]-e[0]<=h/2){(v=e)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const S of d)for(const R of S)Ui(R,e,i,h)}var v;return d}class vi{constructor(e,i){this.type=Hi,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ro(e[1])){const s=e[1];if(s.type==="FeatureCollection")for(let h=0;h<s.features.length;++h){const l=s.features[h].geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new vi(s,s.features[h].geometry)}else if(s.type==="Feature"){const h=s.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new vi(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new vi(s,s)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,s){const h=[1/0,1/0,-1/0,-1/0],l=[1/0,1/0,-1/0,-1/0],d=i.canonicalID();if(!d)return!1;if(s.type==="Polygon"){const v=Hh(s.coordinates,l,d),S=ci(i.geometry(),h,l,d);if(!Hu(h,l))return!1;for(const R of S)if(!Uc(R,v))return!1}if(s.type==="MultiPolygon"){const v=vs(s.coordinates,l,d),S=ci(i.geometry(),h,l,d);if(!Hu(h,l))return!1;for(const R of S)if(!Gh(R,v))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,s){const h=[1/0,1/0,-1/0,-1/0],l=[1/0,1/0,-1/0,-1/0],d=i.canonicalID();if(!d)return!1;if(s.type==="Polygon"){const v=Hh(s.coordinates,l,d),S=Zh(i.geometry(),h,l,d);if(!Hu(h,l))return!1;for(const R of S)if(!ad(R,v))return!1}if(s.type==="MultiPolygon"){const v=vs(s.coordinates,l,d),S=Zh(i.geometry(),h,l,d);if(!Hu(h,l))return!1;for(const R of S)if(!hp(R,v))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Wl={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},nl=1/298.257223563,yi=nl*(2-nl),jc=Math.PI/180;class so{static fromTile(e,i,s){const h=Math.PI*(1-2*(e+.5)/Math.pow(2,i)),l=Math.atan(.5*(Math.exp(h)-Math.exp(-h)))/jc;return new so(l,s)}static get units(){return Wl}constructor(e,i){if(e===void 0)throw new Error("No latitude given.");if(i&&!Wl[i])throw new Error(`Unknown unit ${i}. Use one of: ${Object.keys(Wl).join(", ")}`);const s=6378.137*jc*(i?Wl[i]:1),h=Math.cos(e*jc),l=1/(1-yi*(1-h*h)),d=Math.sqrt(l);this.kx=s*d*h,this.ky=s*d*l*(1-yi)}distance(e,i){const s=fa(e[0]-i[0])*this.kx,h=(e[1]-i[1])*this.ky;return Math.sqrt(s*s+h*h)}bearing(e,i){const s=fa(i[0]-e[0])*this.kx;return Math.atan2(s,(i[1]-e[1])*this.ky)/jc}destination(e,i,s){const h=s*jc;return this.offset(e,Math.sin(h)*i,Math.cos(h)*i)}offset(e,i,s){return[e[0]+i/this.kx,e[1]+s/this.ky]}lineDistance(e){let i=0;for(let s=0;s<e.length-1;s++)i+=this.distance(e[s],e[s+1]);return i}area(e){let i=0;for(let s=0;s<e.length;s++){const h=e[s];for(let l=0,d=h.length,v=d-1;l<d;v=l++)i+=fa(h[l][0]-h[v][0])*(h[l][1]+h[v][1])*(s?-1:1)}return Math.abs(i)/2*this.kx*this.ky}along(e,i){let s=0;if(i<=0)return e[0];for(let h=0;h<e.length-1;h++){const l=e[h],d=e[h+1],v=this.distance(l,d);if(s+=v,s>i)return Zu(l,d,(i-(s-v))/v)}return e[e.length-1]}pointToSegmentDistance(e,i,s){let[h,l]=i,d=fa(s[0]-h)*this.kx,v=(s[1]-l)*this.ky;if(d!==0||v!==0){const S=(fa(e[0]-h)*this.kx*d+(e[1]-l)*this.ky*v)/(d*d+v*v);S>1?(h=s[0],l=s[1]):S>0&&(h+=d/this.kx*S,l+=v/this.ky*S)}return d=fa(e[0]-h)*this.kx,v=(e[1]-l)*this.ky,Math.sqrt(d*d+v*v)}pointOnLine(e,i){let s=1/0,h=e[0][0],l=e[0][1],d=0,v=0;for(let S=0;S<e.length-1;S++){let R=e[S][0],g=e[S][1],E=fa(e[S+1][0]-R)*this.kx,D=(e[S+1][1]-g)*this.ky,T=0;E===0&&D===0||(T=(fa(i[0]-R)*this.kx*E+(i[1]-g)*this.ky*D)/(E*E+D*D),T>1?(R=e[S+1][0],g=e[S+1][1]):T>0&&(R+=E/this.kx*T,g+=D/this.ky*T)),E=fa(i[0]-R)*this.kx,D=(i[1]-g)*this.ky;const A=E*E+D*D;A<s&&(s=A,h=R,l=g,d=S,v=T)}return{point:[h,l],index:d,t:Math.max(0,Math.min(1,v))}}lineSlice(e,i,s){let h=this.pointOnLine(s,e),l=this.pointOnLine(s,i);if(h.index>l.index||h.index===l.index&&h.t>l.t){const R=h;h=l,l=R}const d=[h.point],v=h.index+1,S=l.index;!Xh(s[v],d[0])&&v<=S&&d.push(s[v]);for(let R=v+1;R<=S;R++)d.push(s[R]);return Xh(s[S],l.point)||d.push(l.point),d}lineSliceAlong(e,i,s){let h=0;const l=[];for(let d=0;d<s.length-1;d++){const v=s[d],S=s[d+1],R=this.distance(v,S);if(h+=R,h>e&&l.length===0&&l.push(Zu(v,S,(e-(h-R))/R)),h>=i)return l.push(Zu(v,S,(i-(h-R))/R)),l;h>e&&l.push(S)}return l}bufferPoint(e,i){const s=i/this.ky,h=i/this.kx;return[e[0]-h,e[1]-s,e[0]+h,e[1]+s]}bufferBBox(e,i){const s=i/this.ky,h=i/this.kx;return[e[0]-h,e[1]-s,e[2]+h,e[3]+s]}insideBBox(e,i){return fa(e[0]-i[0])>=0&&fa(e[0]-i[2])<=0&&e[1]>=i[1]&&e[1]<=i[3]}}function Xh(a,e){return a[0]===e[0]&&a[1]===e[1]}function Zu(a,e,i){const s=fa(e[0]-a[0]);return[a[0]+s*i,a[1]+(e[1]-a[1])*i]}function fa(a){for(;a<-180;)a+=360;for(;a>180;)a-=360;return a}class zn{constructor(e=[],i=(s,h)=>s<h?-1:s>h?1:0){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:s}=this,h=i[e];for(;e>0;){const l=e-1>>1,d=i[l];if(s(h,d)>=0)break;i[e]=d,e=l}i[e]=h}_down(e){const{data:i,compare:s}=this,h=this.length>>1,l=i[e];for(;e<h;){let d=1+(e<<1);const v=d+1;if(v<this.length&&s(i[v],i[d])<0&&(d=v),s(i[d],l)>=0)break;i[e]=i[d],e=d}i[e]=l}}var zt=8192;function Yh(a,e){return e.dist-a.dist}const Xu=100,Yu=50;function al(a){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==a.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==a[i])return!1;return!0}function Gn(a){return a[1]-a[0]+1}function Oo(a,e){const i=a[1]>=a[0]&&a[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function sd(a,e){if(a[0]>a[1])return[null,null];const i=Gn(a);if(e){if(i===2)return[a,null];const s=Math.floor(i/2);return[[a[0],a[0]+s],[a[0]+s,a[1]]]}{if(i===1)return[a,null];const s=Math.floor(i/2)-1;return[[a[0],a[0]+s],[a[0]+s+1,a[1]]]}}function Hn(a,e){const i=[1/0,1/0,-1/0,-1/0];if(!Oo(e,a.length))return i;for(let s=e[0];s<=e[1];++s)Gu(i,a[s]);return i}function js(a){const e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<a.length;++i)for(let s=0;s<a[i].length;++s)Gu(e,a[i][s]);return e}function sl(a,e,i){if(al(a)||al(e))return NaN;let s=0,h=0;return a[2]<e[0]&&(s=e[0]-a[2]),a[0]>e[2]&&(s=a[0]-e[2]),a[1]>e[3]&&(h=a[1]-e[3]),a[3]<e[1]&&(h=e[1]-a[3]),i.distance([0,0],[s,h])}function Wh(a){return 360*a-180}function fp(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function $h(a,e){const i=Math.pow(2,e.z),s=(a.y/zt+e.y)/i;return[Wh((a.x/zt+e.x)/i),fp(s)]}function od(a,e){const i=[];for(let s=0;s<a.length;++s)i.push($h(a[s],e));return i}function dp(a,e,i){const s=i.pointOnLine(e,a).point;return i.distance(a,s)}function ld(a,e,i,s,h){const l=i.slice(s[0],s[1]+1);let d=1/0;for(let v=e[0];v<=e[1];++v)if((d=Math.min(d,dp(a[v],l,h)))===0)return 0;return d}function ol(a,e,i,s,h){const l=Math.min(h.pointToSegmentDistance(a,i,s),h.pointToSegmentDistance(e,i,s)),d=Math.min(h.pointToSegmentDistance(i,a,e),h.pointToSegmentDistance(s,a,e));return Math.min(l,d)}function cd(a,e,i,s,h){if(!Oo(e,a.length)||!Oo(s,i.length))return NaN;let l=1/0;for(let d=e[0];d<e[1];++d)for(let v=s[0];v<s[1];++v){if(Us(a[d],a[d+1],i[v],i[v+1]))return 0;l=Math.min(l,ol(a[d],a[d+1],i[v],i[v+1],h))}return l}function qc(a,e,i,s,h){if(!Oo(e,a.length)||!Oo(s,i.length))return NaN;let l=1/0;for(let d=e[0];d<=e[1];++d)for(let v=s[0];v<=s[1];++v)if((l=Math.min(l,h.distance(a[d],i[v])))===0)return l;return l}function Lo(a,e,i){if(Uc(a,e,!0))return 0;let s=1/0;for(const h of e){const l=h.length;if(l<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(h[0]!==h[l-1]&&(s=Math.min(s,i.pointToSegmentDistance(a,h[l-1],h[0])))===0||(s=Math.min(s,dp(a,h,i)))===0)return s}return s}function pp(a,e,i,s){if(!Oo(e,a.length))return NaN;for(let l=e[0];l<=e[1];++l)if(Uc(a[l],i,!0))return 0;let h=1/0;for(let l=e[0];l<e[1];++l)for(const d of i)for(let v=0,S=d.length,R=S-1;v<S;R=v++){if(Us(a[l],a[l+1],d[R],d[v]))return 0;h=Math.min(h,ol(a[l],a[l+1],d[R],d[v],s))}return h}function ll(a,e){for(const i of a)for(let s=0;s<=i.length-1;++s)if(Uc(i[s],e,!0))return!0;return!1}function cl(a,e,i,s=1/0){const h=js(a),l=js(e);if(s!==1/0&&sl(h,l,i)>=s)return s;if(Hu(h,l)){if(ll(a,e))return 0}else if(ll(e,a))return 0;let d=s;for(const v of a)for(let S=0,R=v.length,g=R-1;S<R;g=S++)for(const E of e)for(let D=0,T=E.length,A=T-1;D<T;A=D++){if(Us(v[g],v[S],E[A],E[D]))return 0;d=Math.min(d,ol(v[g],v[S],E[A],E[D],i))}return d}function $l(a,e,i,s,h,l,d){if(l===null||d===null)return;const v=sl(Hn(s,l),Hn(h,d),i);v<e&&a.push({dist:v,range1:l,range2:d})}function ud(a,e,i,s,h=1/0){let l=Math.min(s.distance(a[0],i[0][0]),h);if(l===0)return l;const d=new zn([{dist:0,range1:[0,a.length-1],range2:[0,0]}],Yh),v=e?Yu:Xu,S=js(i);for(;d.length;){const R=d.pop();if(R.dist>=l)continue;const g=R.range1;if(Gn(g)<=v){if(!Oo(g,a.length))return NaN;if(e){const E=pp(a,g,i,s);if((l=Math.min(l,E))===0)return l}else for(let E=g[0];E<=g[1];++E){const D=Lo(a[E],i,s);if((l=Math.min(l,D))===0)return l}}else{const E=sd(g,e);if(E[0]!==null){const D=sl(Hn(a,E[0]),S,s);D<l&&d.push({dist:D,range1:E[0],range2:[0,0]})}if(E[1]!==null){const D=sl(Hn(a,E[1]),S,s);D<l&&d.push({dist:D,range1:E[1],range2:[0,0]})}}}return l}function ta(a,e,i,s,h,l=1/0){let d=Math.min(l,h.distance(a[0],i[0]));if(d===0)return d;const v=new zn([{dist:0,range1:[0,a.length-1],range2:[0,i.length-1]}],Yh),S=e?Yu:Xu,R=s?Yu:Xu;for(;v.length;){const g=v.pop();if(g.dist>=d)continue;const E=g.range1,D=g.range2;if(Gn(E)<=S&&Gn(D)<=R){if(!Oo(E,a.length)||!Oo(D,i.length))return NaN;if(e&&s?d=Math.min(d,cd(a,E,i,D,h)):e||s?e&&!s?d=Math.min(d,ld(i,D,a,E,h)):!e&&s&&(d=Math.min(d,ld(a,E,i,D,h))):d=Math.min(d,qc(a,E,i,D,h)),d===0)return d}else{const T=sd(E,e),A=sd(D,s);$l(v,d,h,a,i,T[0],A[0]),$l(v,d,h,a,i,T[0],A[1]),$l(v,d,h,a,i,T[1],A[0]),$l(v,d,h,a,i,T[1],A[1])}}return d}function Wu(a,e,i,s,h=1/0){let l=h;const d=Hn(a,[0,a.length-1]);for(const v of i)if(!(l!==1/0&&sl(d,Hn(v,[0,v.length-1]),s)>=l)&&(l=Math.min(l,ta(a,e,v,!0,s,l)),l===0))return l;return l}function Gc(a,e,i,s,h=1/0){let l=h;const d=Hn(a,[0,a.length-1]);for(const v of i){if(l!==1/0&&sl(d,js(v),s)>=l)continue;const S=ud(a,e,v,s,l);if(isNaN(S))return S;if((l=Math.min(l,S))===0)return l}return l}function $u(a){return a==="Point"||a==="MultiPoint"||a==="LineString"||a==="MultiLineString"||a==="Polygon"||a==="MultiPolygon"}class ul{constructor(e,i){this.type=Qt,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Ro(e[1])){const s=e[1];if(s.type==="FeatureCollection"){for(let h=0;h<s.features.length;++h)if($u(s.features[h].geometry.type))return new ul(s,s.features[h].geometry)}else if(s.type==="Feature"){if($u(s.geometry.type))return new ul(s,s.geometry)}else if($u(s.type))return new ul(s,s)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const i=e.geometry(),s=e.canonicalID();if(i!=null&&s!=null){if(e.geometryType()==="Point")return function(h,l,d){const v=[];for(const R of h)for(const g of R)v.push($h(g,l));const S=new so(v[0][1],"meters");return d.type==="Point"||d.type==="MultiPoint"||d.type==="LineString"?ta(v,!1,d.type==="Point"?[d.coordinates]:d.coordinates,d.type==="LineString",S):d.type==="MultiLineString"?Wu(v,!1,d.coordinates,S):d.type==="Polygon"||d.type==="MultiPolygon"?Gc(v,!1,d.type==="Polygon"?[d.coordinates]:d.coordinates,S):null}(i,s,this.geometries);if(e.geometryType()==="LineString")return function(h,l,d){const v=[];for(const R of h){const g=[];for(const E of R)g.push($h(E,l));v.push(g)}const S=new so(v[0][0][1],"meters");if(d.type==="Point"||d.type==="MultiPoint"||d.type==="LineString")return Wu(d.type==="Point"?[d.coordinates]:d.coordinates,d.type==="LineString",v,S);if(d.type==="MultiLineString"){let R=1/0;for(let g=0;g<d.coordinates.length;g++){const E=Wu(d.coordinates[g],!0,v,S,R);if(isNaN(E))return E;if((R=Math.min(R,E))===0)return R}return R}if(d.type==="Polygon"||d.type==="MultiPolygon"){let R=1/0;for(let g=0;g<v.length;g++){const E=Gc(v[g],!0,d.type==="Polygon"?[d.coordinates]:d.coordinates,S,R);if(isNaN(E))return E;if((R=Math.min(R,E))===0)return R}return R}return null}(i,s,this.geometries);if(e.geometryType()==="Polygon")return function(h,l,d){const v=[];for(const R of function(g,E){const D=g.length;if(D<=1)return[g];const T=[];let A,z;for(let B=0;B<D;B++){const N=Pm(g[B]);N!==0&&(g[B].area=Math.abs(N),z===void 0&&(z=N<0),z===N<0?(A&&T.push(A),A=[g[B]]):A.push(g[B]))}return A&&T.push(A),T}(h)){const g=[];for(let E=0;E<R.length;++E)g.push(od(R[E],l));v.push(g)}const S=new so(v[0][0][0][1],"meters");if(d.type==="Point"||d.type==="MultiPoint"||d.type==="LineString")return Gc(d.type==="Point"?[d.coordinates]:d.coordinates,d.type==="LineString",v,S);if(d.type==="MultiLineString"){let R=1/0;for(let g=0;g<d.coordinates.length;g++){const E=Gc(d.coordinates[g],!0,v,S,R);if(isNaN(E))return E;if((R=Math.min(R,E))===0)return R}return R}return d.type==="Polygon"||d.type==="MultiPolygon"?function(R,g,E){let D=1/0;for(const T of R)for(const A of g){const z=cl(T,A,E,D);if(isNaN(z))return z;if((D=Math.min(D,z))===0)return D}return D}(d.type==="Polygon"?[d.coordinates]:d.coordinates,v,S):null}(i,s,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Qh(a,e){switch(a){case"string":return gs(e);case"number":return+e;case"boolean":return!!e;case"color":return nr.parse(e);case"formatted":return Rn.fromString(gs(e));case"resolvedImage":return ea.build(gs(e))}return e}function hd(a,e,i,s){return s!==void 0&&(a=s*Math.round(a/s)),e!==void 0&&a<e&&(a=e),i!==void 0&&a>i&&(a=i),a}class hl{constructor(e,i,s){this.type=e,this.key=i,this.scope=s}static parse(e,i){let s=i.expectedType;if(s==null&&(s=ar),e.length<2||e.length>3)return i.error("Invalid number of arguments for 'config' expression.");const h=i.parse(e[1],1);if(!(h instanceof qn))return i.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){const l=i.parse(e[2],2);return l instanceof qn?new hl(s,gs(h.value),gs(l.value)):i.error("Scope of 'config' expression must be a string literal.")}return new hl(s,gs(h.value))}evaluate(e){const i=[this.key,this.scope,e.scope].filter(Boolean).join(""),s=e.getConfig(i);if(!s)return null;const{type:h,value:l,values:d,minValue:v,maxValue:S,stepValue:R}=s,g=s.default.evaluate(e);let E=g;if(l){const D=e.scope;e.scope=(D||"").split("").slice(1).join(""),E=l.evaluate(e),e.scope=D}return h&&(E=Qh(h,E)),E===void 0||v===void 0&&S===void 0&&R===void 0||(typeof E=="number"?E=hd(E,v,S,R):Array.isArray(E)&&(E=E.map(D=>typeof D=="number"?hd(D,v,S,R):D))),l!==void 0&&E!==void 0&&d&&!d.includes(E)&&(E=g,h&&(E=Qh(h,E))),(h&&h!==this.type||E!==void 0&&Hr(E)!==this.type)&&(E=Qh(this.type.kind,E)),E}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.key),e}}function Ql(a){if(a instanceof Aa&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof vi||a instanceof ul)return!1;let e=!0;return a.eachChild(i=>{e&&!Ql(i)&&(e=!1)}),e}function Hc(a){if(a instanceof Aa&&a.name==="feature-state")return!1;let e=!0;return a.eachChild(i=>{e&&!Hc(i)&&(e=!1)}),e}function Ca(a){if(a instanceof hl)return new Set([a.key]);let e=new Set;return a.eachChild(i=>{e=new Set([...e,...Ca(i)])}),e}function ia(a,e){if(a instanceof Aa&&e.indexOf(a.name)>=0)return!1;let i=!0;return a.eachChild(s=>{i&&!ia(s,e)&&(i=!1)}),i}class xs{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const s=e[1];return i.scope.has(s)?new xs(s,i.scope.get(s)):i.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class fl{constructor(e,i=[],s,h=new Bu,l=[],d,v){this.registry=e,this.path=i,this.key=i.map(S=>typeof S=="string"?`['${S}']`:`[${S}]`).join(""),this.scope=h,this.errors=l,this.expectedType=s,this._scope=d,this.options=v}parse(e,i,s,h,l={}){return i||s?this.concat(i,null,s,h)._parse(e,l):this._parse(e,l)}parseObjectValue(e,i,s,h,l,d={}){return this.concat(i,s,h,l)._parse(e,d)}_parse(e,i){function s(h,l,d){return d==="assert"?new Ns(l,[h]):d==="coerce"?new zo(l,[h]):h}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(h){let l=h.parse(e,this);if(!l)return null;if(this.expectedType){const d=this.expectedType,v=l.type;if(d.kind!=="string"&&d.kind!=="number"&&d.kind!=="boolean"&&d.kind!=="object"&&d.kind!=="array"||v.kind!=="value")if(d.kind!=="color"&&d.kind!=="formatted"&&d.kind!=="resolvedImage"||v.kind!=="value"&&v.kind!=="string"){if(this.checkSubtype(d,v))return null}else l=s(l,d,i.typeAnnotation||"coerce");else l=s(l,d,i.typeAnnotation||"assert")}if(!(l instanceof qn)&&l.type.kind!=="resolvedImage"&&Kl(l)){const d=new id(this._scope,this.options);try{l=new qn(l.type,l.evaluate(d))}catch(v){return this.error(v.message),null}}return l}return zo.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,s,h){let l=typeof e=="number"?this.path.concat(e):this.path;l=typeof i=="string"?l.concat(i):l;const d=h?this.scope.concat(h):this.scope;return new fl(this.registry,l,s||null,d,this.errors,this._scope,this.options)}error(e,...i){const s=`${this.key}${i.map(h=>`[${h}]`).join("")}`;this.errors.push(new Vi(s,e))}checkSubtype(e,i){const s=jn(e,i);return s&&this.error(s),s}}var dl=fl;function Kl(a){if(a instanceof xs)return Kl(a.boundExpression);if(a instanceof Aa&&a.name==="error"||a instanceof Uu||a instanceof vi||a instanceof ul||a instanceof hl)return!1;const e=a instanceof zo||a instanceof Ns;let i=!0;return a.eachChild(s=>{i=e?i&&Kl(s):i&&s instanceof qn}),!!i&&Ql(a)&&ia(a,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Jl(a,e){const i=a.length-1;let s,h,l=0,d=i,v=0;for(;l<=d;)if(v=Math.floor((l+d)/2),s=a[v],h=a[v+1],s<=e){if(v===i||e<h)return v;l=v+1}else{if(!(s>e))throw new hn("Input is not a number.");d=v-1}return 0}class Qa{constructor(e,i,s){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[h,l]of s)this.labels.push(h),this.outputs.push(l)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const s=i.parse(e[1],1,Qt);if(!s)return null;const h=[];let l=null;i.expectedType&&i.expectedType.kind!=="value"&&(l=i.expectedType);for(let d=1;d<e.length;d+=2){const v=d===1?-1/0:e[d],S=e[d+1],R=d,g=d+1;if(typeof v!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',R);if(h.length&&h[h.length-1][0]>=v)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',R);const E=i.parse(S,g,l);if(!E)return null;l=l||E.type,h.push([v,E])}return new Qa(l,s,h)}evaluate(e){const i=this.labels,s=this.outputs;if(i.length===1)return s[0].evaluate(e);const h=this.input.evaluate(e);if(h<=i[0])return s[0].evaluate(e);const l=i.length;return h>=i[l-1]?s[l-1].evaluate(e):s[Jl(i,h)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}const pl=.95047,Wi=1.08883,ec=4/29,tc=6/29,Ka=3*tc*tc,ic=tc*tc*tc,Zc=Math.PI/180,Er=180/Math.PI;function Xc(a){return a>ic?Math.pow(a,1/3):a/Ka+ec}function Ba(a){return a>tc?a*a*a:Ka*(a-ec)}function Na(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function Po(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function oo(a){const e=Po(a.r),i=Po(a.g),s=Po(a.b),h=Xc((.4124564*e+.3575761*i+.1804375*s)/pl),l=Xc((.2126729*e+.7151522*i+.072175*s)/1);return{l:116*l-16,a:500*(h-l),b:200*(l-Xc((.0193339*e+.119192*i+.9503041*s)/Wi)),alpha:a.a}}function lo(a){let e=(a.l+16)/116,i=isNaN(a.a)?e:e+a.a/500,s=isNaN(a.b)?e:e-a.b/200;return e=1*Ba(e),i=pl*Ba(i),s=Wi*Ba(s),new nr(Na(3.2404542*i-1.5371385*e-.4985314*s),Na(-.969266*i+1.8760108*e+.041556*s),Na(.0556434*i-.2040259*e+1.0572252*s),a.alpha)}function rc(a,e,i){const s=e-a;return a+i*(s>180||s<-180?s-360*Math.round(s/360):s)}const Yc={forward:oo,reverse:lo,interpolate:function(a,e,i){return{l:di(a.l,e.l,i),a:di(a.a,e.a,i),b:di(a.b,e.b,i),alpha:di(a.alpha,e.alpha,i)}}},nc={forward:function(a){const{l:e,a:i,b:s}=oo(a),h=Math.atan2(s,i)*Er;return{h:h<0?h+360:h,c:Math.sqrt(i*i+s*s),l:e,alpha:a.a}},reverse:function(a){const e=a.h*Zc,i=a.c;return lo({l:a.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:a.alpha})},interpolate:function(a,e,i){return{h:rc(a.h,e.h,i),c:di(a.c,e.c,i),l:di(a.l,e.l,i),alpha:di(a.alpha,e.alpha,i)}}};var Kh=Object.freeze({__proto__:null,hcl:nc,lab:Yc});class Zr{constructor(e,i,s,h,l,d){this.type=e,this.operator=i,this.interpolation=s,this.input=h,this.dynamicStops=l,this.labels=[],this.outputs=[];for(const[v,S]of d)this.labels.push(v),this.outputs.push(S)}static interpolationFactor(e,i,s,h){let l=0;if(e.name==="exponential")l=Zn(i,e.base,s,h);else if(e.name==="linear")l=Zn(i,1,s,h);else if(e.name==="cubic-bezier"){const d=e.controlPoints;l=new to(d[0],d[1],d[2],d[3]).solve(Zn(i,1,s,h))}return l}static parse(e,i){let[s,h,l,...d]=e;if(!Array.isArray(h)||h.length===0)return i.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const R=h[1];if(typeof R!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:R}}else{if(h[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const R=h.slice(1);if(R.length!==4||R.some(g=>typeof g!="number"||g<0||g>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:R}}}if(e.length-1<3)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(l=i.parse(l,2,Qt),!l)return null;const v=[];let S=null;if(s==="interpolate-hcl"||s==="interpolate-lab"?S=Un:i.expectedType&&i.expectedType.kind!=="value"&&(S=i.expectedType),e.length-1==3){const R=i.parse(d[0],3,ar);return R?new Zr(S,s,h,l,R,v):null}for(let R=0;R<d.length;R+=2){const g=d[R],E=d[R+1],D=R+3,T=R+4;if(typeof g!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(v.length&&v[v.length-1][0]>=g)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',D);const A=i.parse(E,T,S);if(!A)return null;S=S||A.type,v.push([g,A])}return S.kind==="number"||S.kind==="color"||S.kind==="array"&&S.itemType.kind==="number"&&typeof S.N=="number"?new Zr(S,s,h,l,null,v):i.error(`Type ${Lr(S)} is not interpolatable.`)}evaluate(e){let i=this.labels,s=this.outputs;if(this.dynamicStops){const g=this.dynamicStops.evaluate(e);if(g.length%2!=0)throw new hn("Expected an even number of arguments.");i=[],s=[];for(let E=0;E<g.length;E+=2){const D=g[E],T=new qn(Qt,g[E+1]);if(typeof D!="number")throw new hn('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.');if(i.length&&i[i.length-1]>=D)throw new hn('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.');i.push(D),s.push(T)}if(i.length===0)throw new hn("Expected at least one input/output pair.")}if(i.length===1)return s[0].evaluate(e);const h=this.input.evaluate(e);if(h<=i[0])return s[0].evaluate(e);const l=i.length;if(h>=i[l-1])return s[l-1].evaluate(e);const d=Jl(i,h),v=Zr.interpolationFactor(this.interpolation,h,i[d],i[d+1]),S=s[d].evaluate(e),R=s[d+1].evaluate(e);return this.operator==="interpolate"?Do[this.type.kind.toLowerCase()](S,R,v):this.operator==="interpolate-hcl"?nc.reverse(nc.interpolate(nc.forward(S),nc.forward(R),v)):Yc.reverse(Yc.interpolate(Yc.forward(S),Yc.forward(R),v))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const i=[this.operator,e,this.input.serialize()];if(this.dynamicStops)i.push(this.dynamicStops.serialize());else for(let s=0;s<this.labels.length;s++)i.push(this.labels[s],this.outputs[s].serialize());return i}}function Zn(a,e,i,s){const h=s-i,l=a-i;return h===0?0:e===1?l/h:(Math.pow(e,l)-1)/(Math.pow(e,h)-1)}class Mr{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let s=null;const h=i.expectedType;h&&h.kind!=="value"&&(s=h);const l=[];for(const v of e.slice(1)){const S=i.parse(v,1+l.length,s,void 0,{typeAnnotation:"omit"});if(!S)return null;s=s||S.type,l.push(S)}const d=h&&l.some(v=>jn(h,v.type));return new Mr(d?ar:s,l)}evaluate(e){let i,s=null,h=0;for(const l of this.args){if(h++,s=l.evaluate(e),s&&s instanceof ea&&!s.available&&(i||(i=s),s=null,h===this.args.length))return i;if(s!==null)break}return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class Va{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let l=1;l<e.length-1;l+=2){const d=e[l];if(typeof d!="string")return i.error(`Expected string, but found ${typeof d} instead.`,l);if(/[^a-zA-Z0-9_]/.test(d))return i.error("Variable names must contain only alphanumeric characters or '_'.",l);const v=i.parse(e[l+1],l+1);if(!v)return null;s.push([d,v])}const h=i.parse(e[e.length-1],e.length-1,i.expectedType,s);return h?new Va(s,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,s]of this.bindings)e.push(i,s.serialize());return e.push(this.result.serialize()),e}}class bs{constructor(e,i,s){this.type=e,this.index=i,this.input=s}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,Qt),h=i.parse(e[2],2,Or(i.expectedType||ar));return s&&h?new bs(h.type.itemType,s,h):null}evaluate(e){const i=this.index.evaluate(e),s=this.input.evaluate(e);if(i<0)throw new hn(`Array index out of bounds: ${i} < 0.`);if(i>s.length-1)throw new hn(`Array index out of bounds: ${i} > ${s.length-1}.`);if(i===Math.floor(i))return s[i];const h=Math.floor(i),l=Math.ceil(i),d=s[h],v=s[l];if(typeof d!="number"||typeof v!="number")throw new hn(`Cannot interpolate between non-number values at index ${i}.`);const S=i-h;return d*(1-S)+v*S}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Qu{constructor(e,i){this.type=Hi,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,ar),h=i.parse(e[2],2,ar);return s&&h?qh(s.type,[Hi,or,Qt,Fs,ar])?new Qu(s,h):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Lr(s.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(s==null)return!1;if(!Yl(i,["boolean","string","number","null"]))throw new hn(`Expected first argument to be of type boolean, string, number or null, but found ${Lr(Hr(i))} instead.`);if(!Yl(s,["string","array"]))throw new hn(`Expected second argument to be of type array or string, but found ${Lr(Hr(s))} instead.`);return s.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class co{constructor(e,i,s){this.type=Qt,this.needle=e,this.haystack=i,this.fromIndex=s}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,ar),h=i.parse(e[2],2,ar);if(!s||!h)return null;if(!qh(s.type,[Hi,or,Qt,Fs,ar]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Lr(s.type)} instead`);if(e.length===4){const l=i.parse(e[3],3,Qt);return l?new co(s,h,l):null}return new co(s,h)}evaluate(e){const i=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!Yl(i,["boolean","string","number","null"]))throw new hn(`Expected first argument to be of type boolean, string, number or null, but found ${Lr(Hr(i))} instead.`);if(!Yl(s,["string","array"]))throw new hn(`Expected second argument to be of type array or string, but found ${Lr(Hr(s))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(e);return s.indexOf(i,h)}return s.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Jh{constructor(e,i,s,h,l,d){this.inputType=e,this.type=i,this.input=s,this.cases=h,this.outputs=l,this.otherwise=d}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let s,h;i.expectedType&&i.expectedType.kind!=="value"&&(h=i.expectedType);const l={},d=[];for(let R=2;R<e.length-1;R+=2){let g=e[R];const E=e[R+1];Array.isArray(g)||(g=[g]);const D=i.concat(R);if(g.length===0)return D.error("Expected at least one branch label.");for(const A of g){if(typeof A!="number"&&typeof A!="string")return D.error("Branch labels must be numbers or strings.");if(typeof A=="number"&&Math.abs(A)>Number.MAX_SAFE_INTEGER)return D.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof A=="number"&&Math.floor(A)!==A)return D.error("Numeric branch labels must be integer values.");if(s){if(D.checkSubtype(s,Hr(A)))return null}else s=Hr(A);if(l[String(A)]!==void 0)return D.error("Branch labels must be unique.");l[String(A)]=d.length}const T=i.parse(E,R,h);if(!T)return null;h=h||T.type,d.push(T)}const v=i.parse(e[1],1,ar);if(!v)return null;const S=i.parse(e[e.length-1],e.length-1,h);return S?v.type.kind!=="value"&&i.concat(1).checkSubtype(s,v.type)?null:new Jh(s,h,v,l,d,S):null}evaluate(e){const i=this.input.evaluate(e);return(Hr(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),s=[],h={};for(const d of i){const v=h[this.cases[d]];v===void 0?(h[this.cases[d]]=s.length,s.push([this.cases[d],[d]])):s[v][1].push(d)}const l=d=>this.inputType.kind==="number"?Number(d):d;for(const[d,v]of s)e.push(v.length===1?l(v[0]):v.map(l)),e.push(this.outputs[d].serialize());return e.push(this.otherwise.serialize()),e}}class ef{constructor(e,i,s){this.type=e,this.branches=i,this.otherwise=s}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let s;i.expectedType&&i.expectedType.kind!=="value"&&(s=i.expectedType);const h=[];for(let d=1;d<e.length-1;d+=2){const v=i.parse(e[d],d,Hi);if(!v)return null;const S=i.parse(e[d+1],d+1,s);if(!S)return null;h.push([v,S]),s=s||S.type}const l=i.parse(e[e.length-1],e.length-1,s);return l?new ef(s,h,l):null}evaluate(e){for(const[i,s]of this.branches)if(i.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,s]of this.branches)e(i),e(s);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class ml{constructor(e,i,s,h){this.type=e,this.input=i,this.beginIndex=s,this.endIndex=h}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,ar),h=i.parse(e[2],2,Qt);if(!s||!h)return null;if(!qh(s.type,[Or(ar),or,ar]))return i.error(`Expected first argument to be of type array or string, but found ${Lr(s.type)} instead`);if(e.length===4){const l=i.parse(e[3],3,Qt);return l?new ml(s.type,s,h,l):null}return new ml(s.type,s,h)}evaluate(e){const i=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!Yl(i,["string","array"]))throw new hn(`Expected first argument to be of type array or string, but found ${Lr(Hr(i))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(e);return i.slice(s,h)}return i.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Wc(a,e){return a==="=="||a==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function $c(a,e,i,s){return s.compare(e,i)===0}function uo(a,e,i){const s=a!=="=="&&a!=="!=";return class tT{constructor(l,d,v){this.type=Hi,this.lhs=l,this.rhs=d,this.collator=v,this.hasUntypedArgument=l.type.kind==="value"||d.type.kind==="value"}static parse(l,d){if(l.length!==3&&l.length!==4)return d.error("Expected two or three arguments.");const v=l[0];let S=d.parse(l[1],1,ar);if(!S)return null;if(!Wc(v,S.type))return d.concat(1).error(`"${v}" comparisons are not supported for type '${Lr(S.type)}'.`);let R=d.parse(l[2],2,ar);if(!R)return null;if(!Wc(v,R.type))return d.concat(2).error(`"${v}" comparisons are not supported for type '${Lr(R.type)}'.`);if(S.type.kind!==R.type.kind&&S.type.kind!=="value"&&R.type.kind!=="value")return d.error(`Cannot compare types '${Lr(S.type)}' and '${Lr(R.type)}'.`);s&&(S.type.kind==="value"&&R.type.kind!=="value"?S=new Ns(R.type,[S]):S.type.kind!=="value"&&R.type.kind==="value"&&(R=new Ns(S.type,[R])));let g=null;if(l.length===4){if(S.type.kind!=="string"&&R.type.kind!=="string"&&S.type.kind!=="value"&&R.type.kind!=="value")return d.error("Cannot use collator to compare non-string types.");if(g=d.parse(l[3],3,il),!g)return null}return new tT(S,R,g)}evaluate(l){const d=this.lhs.evaluate(l),v=this.rhs.evaluate(l);if(s&&this.hasUntypedArgument){const S=Hr(d),R=Hr(v);if(S.kind!==R.kind||S.kind!=="string"&&S.kind!=="number")throw new hn(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${S.kind}, ${R.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const S=Hr(d),R=Hr(v);if(S.kind!=="string"||R.kind!=="string")return e(l,d,v)}return this.collator?i(l,d,v,this.collator.evaluate(l)):e(l,d,v)}eachChild(l){l(this.lhs),l(this.rhs),this.collator&&l(this.collator)}outputDefined(){return!0}serialize(){const l=[a];return this.eachChild(d=>{l.push(d.serialize())}),l}}}const mp=uo("==",function(a,e,i){return e===i},$c),fd=uo("!=",function(a,e,i){return e!==i},function(a,e,i,s){return!$c(0,e,i,s)}),_p=uo("<",function(a,e,i){return e<i},function(a,e,i,s){return s.compare(e,i)<0}),tf=uo(">",function(a,e,i){return e>i},function(a,e,i,s){return s.compare(e,i)>0}),gp=uo("<=",function(a,e,i){return e<=i},function(a,e,i,s){return s.compare(e,i)<=0}),Ku=uo(">=",function(a,e,i){return e>=i},function(a,e,i,s){return s.compare(e,i)>=0});class rf{constructor(e,i,s,h,l,d){this.type=or,this.number=e,this.locale=i,this.currency=s,this.unit=h,this.minFractionDigits=l,this.maxFractionDigits=d}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const s=i.parse(e[1],1,Qt);if(!s)return null;const h=e[2];if(typeof h!="object"||Array.isArray(h))return i.error("NumberFormat options argument must be an object.");let l=null;if(h.locale&&(l=i.parseObjectValue(h.locale,2,"locale",or),!l))return null;let d=null;if(h.currency&&(d=i.parseObjectValue(h.currency,2,"currency",or),!d))return null;let v=null;if(h.unit&&(v=i.parseObjectValue(h.unit,2,"unit",or),!v))return null;let S=null;if(h["min-fraction-digits"]&&(S=i.parseObjectValue(h["min-fraction-digits"],2,"min-fraction-digits",Qt),!S))return null;let R=null;return h["max-fraction-digits"]&&(R=i.parseObjectValue(h["max-fraction-digits"],2,"max-fraction-digits",Qt),!R)?null:new rf(s,l,d,v,S,R)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class _l{constructor(e){this.type=Qt,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=i.parse(e[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${Lr(s.type)} instead.`):new _l(s):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new hn(`Expected value to be of type string or array, but found ${Lr(Hr(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}function gl(a){return function(){a=1831565813+(a|=0)|0;let e=Math.imul(a^a>>>15,1|a);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const ko={"==":mp,"!=":fd,">":tf,"<":_p,">=":Ku,"<=":gp,array:Ns,at:bs,boolean:Ns,case:ef,coalesce:Mr,collator:Uu,format:rl,image:Vu,in:Qu,"index-of":co,interpolate:Zr,"interpolate-hcl":Zr,"interpolate-lab":Zr,length:_l,let:Va,literal:qn,match:Jh,number:Ns,"number-format":rf,object:Ns,slice:ml,step:Qa,string:Ns,"to-boolean":zo,"to-color":zo,"to-number":zo,"to-string":zo,var:xs,within:vi,distance:ul,config:hl};function ac(a,[e,i,s,h]){e=e.evaluate(a),i=i.evaluate(a),s=s.evaluate(a);const l=h?h.evaluate(a):1,d=Jf(e,i,s,l);if(d)throw new hn(d);return new nr(e/255*l,i/255*l,s/255*l,l)}function Ju(a,[e,i,s,h]){e=e.evaluate(a),i=i.evaluate(a),s=s.evaluate(a);const l=h?h.evaluate(a):1,d=function(R,g,E,D){return typeof R=="number"&&R>=0&&R<=360?typeof g=="number"&&g>=0&&g<=100&&typeof E=="number"&&E>=0&&E<=100?D===void 0||typeof D=="number"&&D>=0&&D<=1?null:`Invalid hsla value [${[R,g,E,D].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof D=="number"?[R,g,E,D]:[R,g,E]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof D=="number"?[R,g,E,D]:[R,g,E]).join(", ")}]: 'h' must be between 0 and 360.`}(e,i,s,l);if(d)throw new hn(d);const v=`hsla(${e}, ${i}%, ${s}%, ${l})`,S=nr.parse(v);if(!S)throw new hn(`Failed to parse HSLA color: ${v}`);return S}function dd(a,e){return a in e}function nf(a,e){const i=e[a];return i===void 0?null:i}function Ua(a){return{type:a}}function af(a){return{result:"success",value:a}}function ra(a){return{result:"error",value:a}}function sc(a,e){return!!a&&!!a.parameters&&a.parameters.indexOf(e)>-1}function Qc(a){return a["property-type"]==="data-driven"}function sf(a){return sc(a.expression,"measure-light")}function Kc(a){return sc(a.expression,"zoom")}function ga(a){return!!a.expression&&a.expression.interpolated}function ws(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)}function yl(a){return a}function of(a,e){const i=e.type==="color",s=a.stops&&typeof a.stops[0][0]=="object",h=s||!(s||a.property!==void 0),l=a.type||(ga(e)?"exponential":"interval");if(i&&((a=Fu({},a)).stops&&(a.stops=a.stops.map(R=>[R[0],nr.parse(R[1])])),a.default=nr.parse(a.default?a.default:e.default)),a.colorSpace&&a.colorSpace!=="rgb"&&!Kh[a.colorSpace])throw new Error(`Unknown color space: ${a.colorSpace}`);let d,v,S;if(l==="exponential")d=eh;else if(l==="interval")d=Xn;else if(l==="categorical"){d=Fo,v=Object.create(null);for(const R of a.stops)v[R[0]]=R[1];S=typeof a.stops[0][0]}else{if(l!=="identity")throw new Error(`Unknown function type "${l}"`);d=yp}if(s){const R={},g=[];for(let T=0;T<a.stops.length;T++){const A=a.stops[T],z=A[0].zoom;R[z]===void 0&&(R[z]={zoom:z,type:a.type,property:a.property,default:a.default,stops:[]},g.push(z)),R[z].stops.push([A[0].value,A[1]])}const E=[];for(const T of g)E.push([R[T].zoom,of(R[T],e)]);const D={name:"linear"};return{kind:"composite",interpolationType:D,interpolationFactor:Zr.interpolationFactor.bind(void 0,D),zoomStops:E.map(T=>T[0]),evaluate:({zoom:T},A)=>eh({stops:E,base:a.base},e,T).evaluate(T,A)}}if(h){const R=l==="exponential"?{name:"exponential",base:a.base!==void 0?a.base:1}:null;return{kind:"camera",interpolationType:R,interpolationFactor:Zr.interpolationFactor.bind(void 0,R),zoomStops:a.stops.map(g=>g[0]),evaluate:({zoom:g})=>d(a,e,g,v,S)}}return{kind:"source",evaluate(R,g){const E=g&&g.properties?g.properties[a.property]:void 0;return E===void 0?Ja(a.default,e.default):d(a,e,E,v,S)}}}function Ja(a,e,i){return a!==void 0?a:e!==void 0?e:i!==void 0?i:void 0}function Fo(a,e,i,s,h){return Ja(typeof i===h?s[i]:void 0,a.default,e.default)}function Xn(a,e,i){if(Vs(i)!=="number")return Ja(a.default,e.default);const s=a.stops.length;if(s===1||i<=a.stops[0][0])return a.stops[0][1];if(i>=a.stops[s-1][0])return a.stops[s-1][1];const h=Jl(a.stops.map(l=>l[0]),i);return a.stops[h][1]}function eh(a,e,i){const s=a.base!==void 0?a.base:1;if(Vs(i)!=="number")return Ja(a.default,e.default);const h=a.stops.length;if(h===1||i<=a.stops[0][0])return a.stops[0][1];if(i>=a.stops[h-1][0])return a.stops[h-1][1];const l=Jl(a.stops.map(g=>g[0]),i),d=function(g,E,D,T){const A=T-D,z=g-D;return A===0?0:E===1?z/A:(Math.pow(E,z)-1)/(Math.pow(E,A)-1)}(i,s,a.stops[l][0],a.stops[l+1][0]),v=a.stops[l][1],S=a.stops[l+1][1];let R=Do[e.type]||yl;if(a.colorSpace&&a.colorSpace!=="rgb"){const g=Kh[a.colorSpace];R=(E,D)=>g.reverse(g.interpolate(g.forward(E),g.forward(D),d))}return typeof v.evaluate=="function"?{evaluate(...g){const E=v.evaluate.apply(void 0,g),D=S.evaluate.apply(void 0,g);if(E!==void 0&&D!==void 0)return R(E,D,d)}}:R(v,S,d)}function yp(a,e,i){return e.type==="color"?i=nr.parse(i):e.type==="formatted"?i=Rn.fromString(i.toString()):e.type==="resolvedImage"?i=ea.build(i.toString()):Vs(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),Ja(i,a.default,e.default)}Aa.register(ko,{error:[{kind:"error"},[or],(a,[e])=>{throw new hn(e.evaluate(a))}],typeof:[or,[ar],(a,[e])=>Lr(Hr(e.evaluate(a)))],"to-rgba":[Or(Qt,4),[Un],(a,[e])=>e.evaluate(a).toRenderColor(null).toArray()],"to-hsla":[Or(Qt,4),[Un],(a,[e])=>e.evaluate(a).toRenderColor(null).toHslaArray()],rgb:[Un,[Qt,Qt,Qt],ac],rgba:[Un,[Qt,Qt,Qt,Qt],ac],hsl:[Un,[Qt,Qt,Qt],Ju],hsla:[Un,[Qt,Qt,Qt,Qt],Ju],has:{type:Hi,overloads:[[[or],(a,[e])=>dd(e.evaluate(a),a.properties())],[[or,_s],(a,[e,i])=>dd(e.evaluate(a),i.evaluate(a))]]},get:{type:ar,overloads:[[[or],(a,[e])=>nf(e.evaluate(a),a.properties())],[[or,_s],(a,[e,i])=>nf(e.evaluate(a),i.evaluate(a))]]},"feature-state":[ar,[or],(a,[e])=>nf(e.evaluate(a),a.featureState||{})],properties:[_s,[],a=>a.properties()],"geometry-type":[or,[],a=>a.geometryType()],id:[ar,[],a=>a.id()],zoom:[Qt,[],a=>a.globals.zoom],pitch:[Qt,[],a=>a.globals.pitch||0],"distance-from-center":[Qt,[],a=>a.distanceFromCenter()],"measure-light":[Qt,[or],(a,[e])=>a.measureLight(e.evaluate(a))],"heatmap-density":[Qt,[],a=>a.globals.heatmapDensity||0],"line-progress":[Qt,[],a=>a.globals.lineProgress||0],"raster-value":[Qt,[],a=>a.globals.rasterValue||0],"raster-particle-speed":[Qt,[],a=>a.globals.rasterParticleSpeed||0],"sky-radial-progress":[Qt,[],a=>a.globals.skyRadialProgress||0],accumulated:[ar,[],a=>a.globals.accumulated===void 0?null:a.globals.accumulated],"+":[Qt,Ua(Qt),(a,e)=>{let i=0;for(const s of e)i+=s.evaluate(a);return i}],"*":[Qt,Ua(Qt),(a,e)=>{let i=1;for(const s of e)i*=s.evaluate(a);return i}],"-":{type:Qt,overloads:[[[Qt,Qt],(a,[e,i])=>e.evaluate(a)-i.evaluate(a)],[[Qt],(a,[e])=>-e.evaluate(a)]]},"/":[Qt,[Qt,Qt],(a,[e,i])=>e.evaluate(a)/i.evaluate(a)],"%":[Qt,[Qt,Qt],(a,[e,i])=>e.evaluate(a)%i.evaluate(a)],ln2:[Qt,[],()=>Math.LN2],pi:[Qt,[],()=>Math.PI],e:[Qt,[],()=>Math.E],"^":[Qt,[Qt,Qt],(a,[e,i])=>Math.pow(e.evaluate(a),i.evaluate(a))],sqrt:[Qt,[Qt],(a,[e])=>Math.sqrt(e.evaluate(a))],log10:[Qt,[Qt],(a,[e])=>Math.log(e.evaluate(a))/Math.LN10],ln:[Qt,[Qt],(a,[e])=>Math.log(e.evaluate(a))],log2:[Qt,[Qt],(a,[e])=>Math.log(e.evaluate(a))/Math.LN2],sin:[Qt,[Qt],(a,[e])=>Math.sin(e.evaluate(a))],cos:[Qt,[Qt],(a,[e])=>Math.cos(e.evaluate(a))],tan:[Qt,[Qt],(a,[e])=>Math.tan(e.evaluate(a))],asin:[Qt,[Qt],(a,[e])=>Math.asin(e.evaluate(a))],acos:[Qt,[Qt],(a,[e])=>Math.acos(e.evaluate(a))],atan:[Qt,[Qt],(a,[e])=>Math.atan(e.evaluate(a))],min:[Qt,Ua(Qt),(a,e)=>Math.min(...e.map(i=>i.evaluate(a)))],max:[Qt,Ua(Qt),(a,e)=>Math.max(...e.map(i=>i.evaluate(a)))],abs:[Qt,[Qt],(a,[e])=>Math.abs(e.evaluate(a))],round:[Qt,[Qt],(a,[e])=>{const i=e.evaluate(a);return i<0?-Math.round(-i):Math.round(i)}],floor:[Qt,[Qt],(a,[e])=>Math.floor(e.evaluate(a))],ceil:[Qt,[Qt],(a,[e])=>Math.ceil(e.evaluate(a))],"filter-==":[Hi,[or,ar],(a,[e,i])=>a.properties()[e.value]===i.value],"filter-id-==":[Hi,[ar],(a,[e])=>a.id()===e.value],"filter-type-==":[Hi,[or],(a,[e])=>a.geometryType()===e.value],"filter-<":[Hi,[or,ar],(a,[e,i])=>{const s=a.properties()[e.value],h=i.value;return typeof s==typeof h&&s<h}],"filter-id-<":[Hi,[ar],(a,[e])=>{const i=a.id(),s=e.value;return typeof i==typeof s&&i<s}],"filter->":[Hi,[or,ar],(a,[e,i])=>{const s=a.properties()[e.value],h=i.value;return typeof s==typeof h&&s>h}],"filter-id->":[Hi,[ar],(a,[e])=>{const i=a.id(),s=e.value;return typeof i==typeof s&&i>s}],"filter-<=":[Hi,[or,ar],(a,[e,i])=>{const s=a.properties()[e.value],h=i.value;return typeof s==typeof h&&s<=h}],"filter-id-<=":[Hi,[ar],(a,[e])=>{const i=a.id(),s=e.value;return typeof i==typeof s&&i<=s}],"filter->=":[Hi,[or,ar],(a,[e,i])=>{const s=a.properties()[e.value],h=i.value;return typeof s==typeof h&&s>=h}],"filter-id->=":[Hi,[ar],(a,[e])=>{const i=a.id(),s=e.value;return typeof i==typeof s&&i>=s}],"filter-has":[Hi,[ar],(a,[e])=>e.value in a.properties()],"filter-has-id":[Hi,[],a=>a.id()!==null&&a.id()!==void 0],"filter-type-in":[Hi,[Or(or)],(a,[e])=>e.value.indexOf(a.geometryType())>=0],"filter-id-in":[Hi,[Or(ar)],(a,[e])=>e.value.indexOf(a.id())>=0],"filter-in-small":[Hi,[or,Or(ar)],(a,[e,i])=>i.value.indexOf(a.properties()[e.value])>=0],"filter-in-large":[Hi,[or,Or(ar)],(a,[e,i])=>function(s,h,l,d){for(;l<=d;){const v=l+d>>1;if(h[v]===s)return!0;h[v]>s?d=v-1:l=v+1}return!1}(a.properties()[e.value],i.value,0,i.value.length-1)],all:{type:Hi,overloads:[[[Hi,Hi],(a,[e,i])=>e.evaluate(a)&&i.evaluate(a)],[Ua(Hi),(a,e)=>{for(const i of e)if(!i.evaluate(a))return!1;return!0}]]},any:{type:Hi,overloads:[[[Hi,Hi],(a,[e,i])=>e.evaluate(a)||i.evaluate(a)],[Ua(Hi),(a,e)=>{for(const i of e)if(i.evaluate(a))return!0;return!1}]]},"!":[Hi,[Hi],(a,[e])=>!e.evaluate(a)],"is-supported-script":[Hi,[or],(a,[e])=>{const i=a.globals&&a.globals.isSupportedScript;return!i||i(e.evaluate(a))}],upcase:[or,[or],(a,[e])=>e.evaluate(a).toUpperCase()],downcase:[or,[or],(a,[e])=>e.evaluate(a).toLowerCase()],concat:[or,Ua(ar),(a,e)=>e.map(i=>gs(i.evaluate(a))).join("")],"resolved-locale":[or,[il],(a,[e])=>e.evaluate(a).resolvedLocale()],random:[Qt,[Qt,Qt,ar],(a,e)=>{const[i,s,h]=e.map(d=>d.evaluate(a));if(i>s||i===s)return i;let l;if(typeof h=="string")l=function(d){let v=0;if(d.length===0)return v;for(let S=0;S<d.length;S++)v=(v<<5)-v+d.charCodeAt(S),v|=0;return v}(h);else{if(typeof h!="number")throw new hn(`Invalid seed input: ${h}`);l=h}return i+gl(l)()*(s-i)}]});class lf{constructor(e,i,s,h){this.expression=e,this._warningHistory={},this._evaluator=new id(s,h),this._defaultValue=i?function(l){return l.type==="color"&&(ws(l.default)||Array.isArray(l.default))?new nr(0,0,0,0):l.type==="color"?nr.parse(l.default)||null:l.default===void 0?null:l.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null,this.configDependencies=Ca(e)}evaluateWithoutErrorHandling(e,i,s,h,l,d,v,S){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=s,this._evaluator.canonical=h||null,this._evaluator.availableImages=l||null,this._evaluator.formattedSection=d,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=S||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,s,h,l,d,v,S){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=s||null,this._evaluator.canonical=h||null,this._evaluator.availableImages=l||null,this._evaluator.formattedSection=d||null,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=S||null;try{const R=this.expression.evaluate(this._evaluator);if(R==null||typeof R=="number"&&R!=R)return this._defaultValue;if(this._enumValues&&!(R in this._enumValues))throw new hn(`Expected value to be one of ${Object.keys(this._enumValues).map(g=>JSON.stringify(g)).join(", ")}, but found ${JSON.stringify(R)} instead.`);return R}catch(R){return this._warningHistory[R.message]||(this._warningHistory[R.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${R.message}`)),this._defaultValue}}}function Jc(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in ko}function fn(a,e,i,s){const h=new dl(ko,[],e?function(d){const v={color:Un,string:or,number:Qt,enum:or,boolean:Hi,formatted:$a,resolvedImage:Bc};return d.type==="array"?Or(v[d.value]||ar,d.length):v[d.type]}(e):void 0,void 0,void 0,i,s),l=h.parse(a,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return l?af(new lf(l,e,i,s)):ra(h.errors)}class eu{constructor(e,i,s,h){this.kind=e,this._styleExpression=i,this.isLightConstant=s,this.isLineProgressConstant=h,this.isStateDependent=e!=="constant"&&!Hc(i.expression),this.configDependencies=Ca(i.expression)}evaluateWithoutErrorHandling(e,i,s,h,l,d){return this._styleExpression.evaluateWithoutErrorHandling(e,i,s,h,l,d)}evaluate(e,i,s,h,l,d){return this._styleExpression.evaluate(e,i,s,h,l,d)}}class Bo{constructor(e,i,s,h,l,d){this.kind=e,this.zoomStops=s,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!Hc(i.expression),this.isLightConstant=l,this.isLineProgressConstant=d,this.configDependencies=Ca(i.expression),this.interpolationType=h}evaluateWithoutErrorHandling(e,i,s,h,l,d){return this._styleExpression.evaluateWithoutErrorHandling(e,i,s,h,l,d)}evaluate(e,i,s,h,l,d){return this._styleExpression.evaluate(e,i,s,h,l,d)}interpolationFactor(e,i,s){return this.interpolationType?Zr.interpolationFactor(this.interpolationType,e,i,s):0}}function tu(a,e,i,s){if((a=fn(a,e,i,s)).result==="error")return a;const h=a.value.expression,l=Ql(h);if(!l&&!Qc(e))return ra([new Vi("","data expressions not supported")]);const d=ia(h,["zoom","pitch","distance-from-center"]);if(!d&&!Kc(e))return ra([new Vi("","zoom expressions not supported")]);const v=ia(h,["measure-light"]);if(!v&&!sf(e))return ra([new Vi("","measure-light expression not supported")]);const S=ia(h,["line-progress"]);if(!S&&!function(E){return sc(E.expression,"line-progress")}(e))return ra([new Vi("","line-progress expression not supported")]);const R=e.expression&&e.expression.relaxZoomRestriction,g=ho(h);return g||d||R?g instanceof Vi?ra([g]):g instanceof Zr&&!ga(e)?ra([new Vi("",'"interpolate" expressions cannot be used with this property')]):af(g?new Bo(l&&S?"camera":"composite",a.value,g.labels,g instanceof Zr?g.interpolation:void 0,v,S):new eu(l&&S?"constant":"source",a.value,v,S)):ra([new Vi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class oc{constructor(e,i){this._parameters=e,this._specification=i,Fu(this,of(this._parameters,this._specification))}static deserialize(e){return new oc(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function ho(a){let e=null;if(a instanceof Va)e=ho(a.result);else if(a instanceof Mr){for(const i of a.args)if(e=ho(i),e)break}else(a instanceof Qa||a instanceof Zr)&&a.input instanceof Aa&&a.input.name==="zoom"&&(e=a);return e instanceof Vi||a.eachChild(i=>{const s=ho(i);s instanceof Vi?e=s:e&&s&&e!==s&&(e=new Vi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var vl,vp,xp=function(){if(vp)return vl;vp=1,vl=e;var a=3;function e(i,s,h){var l=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var d=new Int32Array(this.arrayBuffer);i=d[0],this.d=(s=d[1])+2*(h=d[2]);for(var v=0;v<this.d*this.d;v++){var S=d[a+v],R=d[a+v+1];l.push(S===R?null:d.subarray(S,R))}var g=d[a+l.length+1];this.keys=d.subarray(d[a+l.length],g),this.bboxes=d.subarray(g),this.insert=this._insertReadonly}else{this.d=s+2*h;for(var E=0;E<this.d*this.d;E++)l.push([]);this.keys=[],this.bboxes=[]}this.n=s,this.extent=i,this.padding=h,this.scale=s/i,this.uid=0;var D=h/s*i;this.min=-D,this.max=i+D}return e.prototype.insert=function(i,s,h,l,d){this._forEachCell(s,h,l,d,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(s),this.bboxes.push(h),this.bboxes.push(l),this.bboxes.push(d)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(i,s,h,l,d,v){this.cells[d].push(v)},e.prototype.query=function(i,s,h,l,d){var v=this.min,S=this.max;if(i<=v&&s<=v&&S<=h&&S<=l&&!d)return Array.prototype.slice.call(this.keys);var R=[];return this._forEachCell(i,s,h,l,this._queryCell,R,{},d),R},e.prototype._queryCell=function(i,s,h,l,d,v,S,R){var g=this.cells[d];if(g!==null)for(var E=this.keys,D=this.bboxes,T=0;T<g.length;T++){var A=g[T];if(S[A]===void 0){var z=4*A;(R?R(D[z+0],D[z+1],D[z+2],D[z+3]):i<=D[z+2]&&s<=D[z+3]&&h>=D[z+0]&&l>=D[z+1])?(S[A]=!0,v.push(E[A])):S[A]=!1}}},e.prototype._forEachCell=function(i,s,h,l,d,v,S,R){for(var g=this._convertToCellCoord(i),E=this._convertToCellCoord(s),D=this._convertToCellCoord(h),T=this._convertToCellCoord(l),A=g;A<=D;A++)for(var z=E;z<=T;z++){var B=this.d*z+A;if((!R||R(this._convertFromCellCoord(A),this._convertFromCellCoord(z),this._convertFromCellCoord(A+1),this._convertFromCellCoord(z+1)))&&d.call(this,i,s,h,l,B,v,S,R))return}},e.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},e.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,s=a+this.cells.length+1+1,h=0,l=0;l<this.cells.length;l++)h+=this.cells[l].length;var d=new Int32Array(s+h+this.keys.length+this.bboxes.length);d[0]=this.extent,d[1]=this.n,d[2]=this.padding;for(var v=s,S=0;S<i.length;S++){var R=i[S];d[a+S]=v,d.set(R,v),v+=R.length}return d[a+i.length]=v,d.set(this.keys,v),d[a+i.length+1]=v+=this.keys.length,d.set(this.bboxes,v),v+=this.bboxes.length,d.buffer},vl}(),lc=ae(xp);const th={};function Zt(a,e,i={}){Object.defineProperty(a,"_classRegistryKey",{value:e,writable:!1}),th[e]={klass:a,omit:i.omit||[]}}Zt(Object,"Object"),lc.serialize=function(a,e){const i=a.toArrayBuffer();return e&&e.add(i),{buffer:i}},lc.deserialize=function(a){return new lc(a.buffer)},Object.defineProperty(lc,"name",{value:"Grid"}),Zt(lc,"Grid"),typeof DOMMatrix<"u"&&Zt(DOMMatrix,"DOMMatrix"),Zt(nr,"Color"),Zt(Error,"Error"),Zt(Rn,"Formatted"),Zt(Io,"FormattedSection"),Zt(un,"AJAXError"),Zt(ea,"ResolvedImage"),Zt(oc,"StylePropertyFunction"),Zt(lf,"StyleExpression",{omit:["_evaluator"]}),Zt(Bs,"ImageIdWithOptions"),Zt(Bo,"ZoomDependentExpression"),Zt(eu,"ZoomConstantExpression"),Zt(Aa,"CompoundExpression",{omit:["_evaluate"]});for(const a in ko)th[ko[a]._classRegistryKey]||Zt(ko[a],`Expression${a}`);function ih(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function iu(a){return self.ImageBitmap&&a instanceof ImageBitmap}function No(a,e){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(ih(a)||iu(a))return e&&e.add(a),a;if(ArrayBuffer.isView(a))return e&&e.add(a.buffer),a;if(a instanceof ImageData)return e&&e.add(a.data.buffer),a;if(Array.isArray(a)){const i=[];for(const s of a)i.push(No(s,e));return i}if(a instanceof Map){const i={$name:"Map"};for(const[s,h]of a.entries())i[s]=No(h);return i}if(a instanceof Set){const i={$name:"Set"};let s=0;for(const h of a.values())i[++s]=No(h);return i}if(typeof a=="object"){const i=a.constructor,s=i._classRegistryKey;if(!s)throw new Error(`Can't serialize object of unregistered class "${s}".`);const h=i.serialize?i.serialize(a,e):{};if(!i.serialize){for(const l in a)a.hasOwnProperty(l)&&(th[s].omit.indexOf(l)>=0||(h[l]=No(a[l],e)));a instanceof Error&&(h.message=a.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(h.$name=s),h}throw new Error("can't serialize object of type "+typeof a)}function ja(a){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||ih(a)||iu(a)||ArrayBuffer.isView(a)||a instanceof ImageData)return a;if(Array.isArray(a))return a.map(ja);if(typeof a=="object"){const e=a.$name||"Object";if(e==="Map"){const h=new Map;for(const l of Object.keys(a))l!=="$name"&&h.set(l,ja(a[l]));return h}if(e==="Set"){const h=new Set;for(const l of Object.keys(a))l!=="$name"&&h.add(ja(a[l]));return h}const{klass:i}=th[e];if(!i)throw new Error(`Can't deserialize unregistered class "${e}".`);if(i.deserialize)return i.deserialize(a);const s=Object.create(i.prototype);for(const h of Object.keys(a))h!=="$name"&&(s[h]=ja(a[h]));return s}throw new Error("can't deserialize object of type "+typeof a)}const It={"Latin-1 Supplement":a=>a>=128&&a<=255,Arabic:a=>a>=1536&&a<=1791,"Arabic Supplement":a=>a>=1872&&a<=1919,"Arabic Extended-A":a=>a>=2208&&a<=2303,"Hangul Jamo":a=>a>=4352&&a<=4607,"Unified Canadian Aboriginal Syllabics":a=>a>=5120&&a<=5759,Khmer:a=>a>=6016&&a<=6143,"Unified Canadian Aboriginal Syllabics Extended":a=>a>=6320&&a<=6399,"General Punctuation":a=>a>=8192&&a<=8303,"Letterlike Symbols":a=>a>=8448&&a<=8527,"Number Forms":a=>a>=8528&&a<=8591,"Miscellaneous Technical":a=>a>=8960&&a<=9215,"Control Pictures":a=>a>=9216&&a<=9279,"Optical Character Recognition":a=>a>=9280&&a<=9311,"Enclosed Alphanumerics":a=>a>=9312&&a<=9471,"Geometric Shapes":a=>a>=9632&&a<=9727,"Miscellaneous Symbols":a=>a>=9728&&a<=9983,"Miscellaneous Symbols and Arrows":a=>a>=11008&&a<=11263,"CJK Radicals Supplement":a=>a>=11904&&a<=12031,"Kangxi Radicals":a=>a>=12032&&a<=12255,"Ideographic Description Characters":a=>a>=12272&&a<=12287,"CJK Symbols and Punctuation":a=>a>=12288&&a<=12351,Hiragana:a=>a>=12352&&a<=12447,Katakana:a=>a>=12448&&a<=12543,Bopomofo:a=>a>=12544&&a<=12591,"Hangul Compatibility Jamo":a=>a>=12592&&a<=12687,Kanbun:a=>a>=12688&&a<=12703,"Bopomofo Extended":a=>a>=12704&&a<=12735,"CJK Strokes":a=>a>=12736&&a<=12783,"Katakana Phonetic Extensions":a=>a>=12784&&a<=12799,"Enclosed CJK Letters and Months":a=>a>=12800&&a<=13055,"CJK Compatibility":a=>a>=13056&&a<=13311,"CJK Unified Ideographs Extension A":a=>a>=13312&&a<=19903,"Yijing Hexagram Symbols":a=>a>=19904&&a<=19967,"CJK Unified Ideographs":a=>a>=19968&&a<=40959,"Yi Syllables":a=>a>=40960&&a<=42127,"Yi Radicals":a=>a>=42128&&a<=42191,"Hangul Jamo Extended-A":a=>a>=43360&&a<=43391,"Hangul Syllables":a=>a>=44032&&a<=55215,"Hangul Jamo Extended-B":a=>a>=55216&&a<=55295,"Private Use Area":a=>a>=57344&&a<=63743,"CJK Compatibility Ideographs":a=>a>=63744&&a<=64255,"Arabic Presentation Forms-A":a=>a>=64336&&a<=65023,"Vertical Forms":a=>a>=65040&&a<=65055,"CJK Compatibility Forms":a=>a>=65072&&a<=65103,"Small Form Variants":a=>a>=65104&&a<=65135,"Arabic Presentation Forms-B":a=>a>=65136&&a<=65279,"Halfwidth and Fullwidth Forms":a=>a>=65280&&a<=65519,Osage:a=>a>=66736&&a<=66815,"CJK Unified Ideographs Extension B":a=>a>=131072&&a<=173791};function Ur(a){for(const e of a)if(Vo(e.charCodeAt(0)))return!0;return!1}function On(a){for(const e of a)if(!cf(e.charCodeAt(0)))return!1;return!0}function cf(a){return!(It.Arabic(a)||It["Arabic Supplement"](a)||It["Arabic Extended-A"](a)||It["Arabic Presentation Forms-A"](a)||It["Arabic Presentation Forms-B"](a))}function Vo(a){return!(a!==746&&a!==747&&(a<4352||!(It["Bopomofo Extended"](a)||It.Bopomofo(a)||It["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||It["CJK Compatibility Ideographs"](a)||It["CJK Compatibility"](a)||It["CJK Radicals Supplement"](a)||It["CJK Strokes"](a)||!(!It["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||It["CJK Unified Ideographs Extension A"](a)||It["CJK Unified Ideographs"](a)||It["Enclosed CJK Letters and Months"](a)||It["Hangul Compatibility Jamo"](a)||It["Hangul Jamo Extended-A"](a)||It["Hangul Jamo Extended-B"](a)||It["Hangul Jamo"](a)||It["Hangul Syllables"](a)||It.Hiragana(a)||It["Ideographic Description Characters"](a)||It.Kanbun(a)||It["Kangxi Radicals"](a)||It["Katakana Phonetic Extensions"](a)||It.Katakana(a)&&a!==12540||!(!It["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!It["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||It["Unified Canadian Aboriginal Syllabics"](a)||It["Unified Canadian Aboriginal Syllabics Extended"](a)||It["Vertical Forms"](a)||It["Yijing Hexagram Symbols"](a)||It["Yi Syllables"](a)||It["Yi Radicals"](a))))}function Uo(a){return!(Vo(a)||function(e){return!!(It["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||It["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||It["Letterlike Symbols"](e)||It["Number Forms"](e)||It["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||It["Control Pictures"](e)&&e!==9251||It["Optical Character Recognition"](e)||It["Enclosed Alphanumerics"](e)||It["Geometric Shapes"](e)||It["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||It["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||It["CJK Symbols and Punctuation"](e)||It.Katakana(e)||It["Private Use Area"](e)||It["CJK Compatibility Forms"](e)||It["Small Form Variants"](e)||It["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(a))}function ru(a){return a>=1424&&a<=2303||It["Arabic Presentation Forms-A"](a)||It["Arabic Presentation Forms-B"](a)}function nu(a,e){return!(!e&&ru(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||It.Khmer(a))}function xl(a){for(const e of a)if(ru(e.charCodeAt(0)))return!0;return!1}const rh="deferred",dn="loading",nh="loaded";let Ts=null,Da="unavailable",jo=null;const pd=function(a){a&&typeof a=="string"&&a.indexOf("NetworkError")>-1&&(Da="error"),Ts&&Ts(a)};function ah(){bl.fire(new ks("pluginStateChange",{pluginStatus:Da,pluginURL:jo}))}const bl=new Co,au=function(){return Da},na=function(){if(Da!==rh||!jo)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Da=dn,ah(),jo&&Gr({url:jo},a=>{a?pd(a):(Da=nh,ah())})},Pr={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Da===nh||Pr.applyArabicShaping!=null,isLoading:()=>Da===dn,setState(a){Da=a.pluginStatus,jo=a.pluginURL},isParsed:()=>Pr.applyArabicShaping!=null&&Pr.processBidirectionalText!=null&&Pr.processStyledBidirectionalText!=null,getPluginURL:()=>jo};class wr{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(i,s){for(const h of i)if(!nu(h.charCodeAt(0),s))return!1;return!0}(e,Pr.isLoaded())}}class wl{constructor(e,i,s,h){this.property=e,this.value=i,this.expression=function(l,d,v,S){if(ws(l))return new oc(l,d);if(Jc(l)||Array.isArray(l)&&l.length>0){const R=tu(l,d,v,S);if(R.result==="error")throw new Error(R.value.map(g=>`${g.key}: ${g.message}`).join(", "));return R.value}{let R=l;return typeof l=="string"&&d.type==="color"&&(R=nr.parse(l)),{kind:"constant",configDependencies:new Set,evaluate:()=>R}}}(i===void 0?e.specification.default:i,e.specification,s,h)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,s){return this.property.possiblyEvaluate(this,e,i,s)}}class Tl{constructor(e,i,s){this.property=e,this.value=new wl(e,void 0,i,s)}transitioned(e,i){return new qs(this.property,this.value,i,Fn({},e.transition,this.transition),e.now)}untransitioned(){return new qs(this.property,this.value,null,{},0)}}class su{constructor(e,i,s){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=i,this._options=s,this.configDependencies=new Set}getValue(e){return In(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Tl(this._values[e].property,this._scope,this._options)),this._values[e].value=new wl(this._values[e].property,i===null?void 0:In(i),this._scope,this._options),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]))}setTransitionOrValue(e,i){i&&(this._options=i);const s=this._properties.properties;if(e)for(const h in e){const l=e[h];if(Bn(h,"-transition")){const d=h.slice(0,-11);s[d]&&this.setTransition(d,l)}else s.hasOwnProperty(h)&&this.setValue(h,l)}}getTransition(e){return In(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Tl(this._values[e].property)),this._values[e].transition=In(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const s=this.getValue(i);s!==void 0&&(e[i]=s);const h=this.getTransition(i);h!==void 0&&(e[`${i}-transition`]=h)}return e}transitioned(e,i){const s=new Sl(this._properties);for(const h of Object.keys(this._values))s._values[h]=this._values[h].transitioned(e,i._values[h]);return s}untransitioned(){const e=new Sl(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class qs{constructor(e,i,s,h,l){const d=h.delay||0,v=h.duration||0;l=l||0,this.property=e,this.value=i,this.begin=l+d,this.end=this.begin+v,e.specification.transition&&(h.delay||h.duration)&&(this.prior=s)}possiblyEvaluate(e,i,s){const h=e.now||0,l=this.value.possiblyEvaluate(e,i,s),d=this.prior;if(d){if(h>this.end)return this.prior=null,l;if(this.value.isDataDriven())return this.prior=null,l;if(h<this.begin)return d.possiblyEvaluate(e,i,s);{const v=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(d.possiblyEvaluate(e,i,s),l,io(v))}}return l}}class Sl{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,s){const h=new cc(this._properties);for(const l of Object.keys(this._values))h._values[l]=this._values[l].possiblyEvaluate(e,i,s);return h}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class El{constructor(e,i,s){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=i,this._options=s,this.configDependencies=new Set}getValue(e){return In(this._values[e].value)}setValue(e,i){this._values[e]=new wl(this._values[e].property,i===null?void 0:In(i),this._scope,this._options),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]))}serialize(){const e={};for(const i of Object.keys(this._values)){const s=this.getValue(i);s!==void 0&&(e[i]=s)}return e}possiblyEvaluate(e,i,s){const h=new cc(this._properties);for(const l of Object.keys(this._values))h._values[l]=this._values[l].possiblyEvaluate(e,i,s);return h}}class Ml{constructor(e,i,s){this.property=e,this.value=i,this.parameters=s}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,s,h){return this.property.evaluate(this.value,this.parameters,e,i,s,h)}}class cc{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class wt{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,s){const h=Do[this.specification.type];return h?h(e,i,s):e}}class Gt{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,s,h){return new Ml(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},s,h)}:e.expression,i)}interpolate(e,i,s){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new Ml(this,{kind:"constant",value:void 0},e.parameters);const h=Do[this.specification.type];return h?new Ml(this,{kind:"constant",value:h(e.value.value,i.value.value,s)},e.parameters):e}evaluate(e,i,s,h,l,d){return e.kind==="constant"?e.value:e.evaluate(i,s,h,l,d)}}class uc{constructor(e){this.specification=e}possiblyEvaluate(e,i,s,h){return!!e.expression.evaluate(i,null,{},s,h)}interpolate(){return!1}}class jr{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new wr(0,{});for(const s in e){const h=e[s];h.specification.overridable&&this.overridableProperties.push(s);const l=this.defaultPropertyValues[s]=new wl(h,void 0),d=this.defaultTransitionablePropertyValues[s]=new Tl(h);this.defaultTransitioningPropertyValues[s]=d.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=l.possiblyEvaluate(i)}}}Zt(Gt,"DataDrivenProperty"),Zt(wt,"DataConstantProperty"),Zt(uc,"ColorRampProperty");var Ge=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow","experimental":true},"rain":{"type":"rain","experimental":true},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor","experimental":true},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"experimental":true,"type":"featuresets"}},"featuresets":{"experimental":true,"*":{"type":"featureset"}},"featureset":{"experimental":true,"metadata":{"experimental":true,"type":"*"},"selectors":{"experimental":true,"type":"array","value":"selector"}},"selector":{"experimental":true,"layer":{"experimental":true,"type":"string","required":true},"properties":{"experimental":true,"type":"selectorProperty","required":false},"featureNamespace":{"experimental":true,"type":"string","required":false},"_uniqueFeatureID":{"experimental":true,"type":"boolean","private":true,"required":false}},"selectorProperty":{"experimental":true,"*":{"experimental":true,"type":"*"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"property-type":"data-constant"},"shadow-quality":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]},"experimental":true},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant"},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","experimental":true,"private":true,"expression":{},"property-type":"data-constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"line-cross-slope":{"type":"number","experimental":true,"expression":{},"property-type":"constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","experimental":true,"private":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","experimental":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.4,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","property-type":"data-constant","default":0.71,"minimum":0,"maximum":5,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.57,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","property-type":"data-constant","default":0.7,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}},"buildingFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"flat","property-type":"data-constant"},"fill-extrusion-base-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"terrain","property-type":"data-constant"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]},"experimental":true,"property-type":"data-constant"},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"*"}}}');function uf(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function sh(a){if(Array.isArray(a))return a.map(sh);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const e={};for(const i in a)e[i]=sh(a[i]);return e}return uf(a)}function md(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const e of a.slice(1))if(!md(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function _d(a,e="",i=null,s="fill"){if(a==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};md(a)||(a=oh(a));const h=a;let l=!0;try{l=function(g){if(!Al(g))return g;let E=sh(g);return yd(E),E=gd(E),E}(h)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(h,null,2)}
        `)}let d=null,v=null;if(s!=="background"&&s!=="sky"&&s!=="slot"){v=Ge[`filter_${s}`];const g=fn(l,v,e,i);if(g.result==="error")throw new Error(g.value.map(E=>`${E.key}: ${E.message}`).join(", "));d=(E,D,T)=>g.value.evaluate(E,D,{},T)}let S=null,R=null;if(l!==h){const g=fn(h,v,e,i);if(g.result==="error")throw new Error(g.value.map(E=>`${E.key}: ${E.message}`).join(", "));S=(E,D,T,A,z)=>g.value.evaluate(E,D,{},T,void 0,void 0,A,z),R=!Ql(g.value.expression)}return{filter:d,dynamicFilter:S||void 0,needGeometry:vd(l),needFeature:!!R}}function gd(a){if(!Array.isArray(a))return a;const e=function(i){if(bp.has(i[0])){for(let s=1;s<i.length;s++)if(Al(i[s]))return!0}return i}(a);return e===!0?e:e.map(i=>gd(i))}function yd(a){let e=!1;const i=[];if(a[0]==="case"){for(let s=1;s<a.length-1;s+=2)e=e||Al(a[s]),i.push(a[s+1]);i.push(a[a.length-1])}else if(a[0]==="match"){e=e||Al(a[1]);for(let s=2;s<a.length-1;s+=2)i.push(a[s+1]);i.push(a[a.length-1])}else if(a[0]==="step"){e=e||Al(a[1]);for(let s=1;s<a.length-1;s+=2)i.push(a[s+1])}e&&(a.length=0,a.push("any",...i));for(let s=1;s<a.length;s++)yd(a[s])}function Al(a){if(!Array.isArray(a))return!1;if((e=a[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<a.length;i++)if(Al(a[i]))return!0;return!1}const bp=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function wp(a,e){return a<e?-1:a>e?1:0}function vd(a){if(!Array.isArray(a))return!1;if(a[0]==="within"||a[0]==="distance")return!0;for(let e=1;e<a.length;e++)if(vd(a[e]))return!0;return!1}function oh(a){if(!a)return!0;const e=a[0];return a.length<=1?e!=="any":e==="=="?qo(a[1],a[2],"=="):e==="!="?Ss(qo(a[1],a[2],"==")):e==="<"||e===">"||e==="<="||e===">="?qo(a[1],a[2],e):e==="any"?(i=a.slice(1),["any"].concat(i.map(oh))):e==="all"?["all"].concat(a.slice(1).map(oh)):e==="none"?["all"].concat(a.slice(1).map(oh).map(Ss)):e==="in"?xd(a[1],a.slice(2)):e==="!in"?Ss(xd(a[1],a.slice(2))):e==="has"?hf(a[1]):e!=="!has"||Ss(hf(a[1]));var i}function qo(a,e,i){switch(a){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,a,e]}}function xd(a,e){if(e.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",a,["literal",e.sort(wp)]]:["filter-in-small",a,["literal",e]]}}function hf(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function Ss(a){return["!",a]}const lh="";function es(a,e){return e?`${a}${lh}${e}`:a}const Es="-transition",bd=new Set(["fill","line","background","hillshade","raster"]);class _n extends Co{constructor(e,i,s,h,l){if(super(),this.id=e.id,this.fqid=es(this.id,s),this.type=e.type,this.scope=s,this.lut=h,this.options=l,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const d=fn(this.filter,Ge[`filter_${e.type}`]);d.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...d.value.configDependencies]))}if(e.slot&&(this.slot=e.slot),i.layout&&(this._unevaluatedLayout=new El(i.layout,this.scope,l),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),i.paint){this._transitionablePaint=new su(i.paint,this.scope,l);for(const d in e.paint)this.setPaintProperty(d,e.paint[d]);for(const d in e.layout)this.setLayoutProperty(d,e.layout[d]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new cc(i.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D()&&bd.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i){if(this.type==="custom"&&e==="visibility")return void(this.visibility=i);const s=this._unevaluatedLayout;s._properties.properties[e]&&(s.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...s.configDependencies]),e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return Bn(e,Es)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i){const s=this._transitionablePaint,h=s._properties.properties;if(Bn(e,Es)){const E=e.slice(0,-11);return h[E]&&s.setTransition(E,i||void 0),!1}if(!h[e])return!1;const l=s._values[e],d=l.value.isDataDriven(),v=l.value;s.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...s.configDependencies]),this._handleSpecialPaintPropertyUpdate(e);const S=s._values[e].value,R=S.isDataDriven(),g=Bn(e,"pattern")||e==="line-dasharray";return R||d||g||this._handleOverridablePaintPropertyUpdate(e,v,S)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,i,s){return null}_handleOverridablePaintPropertyUpdate(e,i,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){return Lc({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,i)=>!(e===void 0||i==="layout"&&!Object.keys(e).length||i==="paint"&&!Object.keys(e).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof Ml&&Qc(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=_d(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,i,s,h,l,d,v,S,R){}}const Tp={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ou{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ar{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function cr(a,e=1){let i=0,s=0;return{members:a.map(h=>{const l=Tp[h.type].BYTES_PER_ELEMENT,d=i=ff(i,Math.max(e,l)),v=h.components||1;return s=Math.max(s,l),i+=l*v,{name:h.name,type:h.type,components:v,offset:d}}),size:ff(i,Math.max(s,e)),alignment:e}}function ff(a,e){return Math.ceil(a/e)*e}class fo extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){const h=2*e;return this.int16[h+0]=i,this.int16[h+1]=s,e}}fo.prototype.bytesPerElement=4,Zt(fo,"StructArrayLayout2i4");class hc extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,s)}emplace(e,i,s,h){const l=3*e;return this.int16[l+0]=i,this.int16[l+1]=s,this.int16[l+2]=h,e}}hc.prototype.bytesPerElement=6,Zt(hc,"StructArrayLayout3i6");class Gs extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,h){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,s,h)}emplace(e,i,s,h,l){const d=4*e;return this.int16[d+0]=i,this.int16[d+1]=s,this.int16[d+2]=h,this.int16[d+3]=l,e}}Gs.prototype.bytesPerElement=8,Zt(Gs,"StructArrayLayout4i8");class ch extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,h,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,s,h,l)}emplace(e,i,s,h,l,d){const v=5*e;return this.int16[v+0]=i,this.int16[v+1]=s,this.int16[v+2]=h,this.int16[v+3]=l,this.int16[v+4]=d,e}}ch.prototype.bytesPerElement=10,Zt(ch,"StructArrayLayout5i10");class lu extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,h,l,d,v){const S=this.length;return this.resize(S+1),this.emplace(S,e,i,s,h,l,d,v)}emplace(e,i,s,h,l,d,v,S){const R=6*e,g=12*e,E=3*e;return this.int16[R+0]=i,this.int16[R+1]=s,this.uint8[g+4]=h,this.uint8[g+5]=l,this.uint8[g+6]=d,this.uint8[g+7]=v,this.float32[E+2]=S,e}}lu.prototype.bytesPerElement=12,Zt(lu,"StructArrayLayout2i4ub1f12");class po extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,s)}emplace(e,i,s,h){const l=3*e;return this.float32[l+0]=i,this.float32[l+1]=s,this.float32[l+2]=h,e}}po.prototype.bytesPerElement=12,Zt(po,"StructArrayLayout3f12");class Yn extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,h,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,s,h,l)}emplace(e,i,s,h,l,d){const v=6*e,S=3*e;return this.uint16[v+0]=i,this.uint16[v+1]=s,this.uint16[v+2]=h,this.uint16[v+3]=l,this.float32[S+2]=d,e}}Yn.prototype.bytesPerElement=12,Zt(Yn,"StructArrayLayout4ui1f12");class uh extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,h){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,s,h)}emplace(e,i,s,h,l){const d=4*e;return this.uint16[d+0]=i,this.uint16[d+1]=s,this.uint16[d+2]=h,this.uint16[d+3]=l,e}}uh.prototype.bytesPerElement=8,Zt(uh,"StructArrayLayout4ui8");class cu extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,h,l,d){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,s,h,l,d)}emplace(e,i,s,h,l,d,v){const S=6*e;return this.int16[S+0]=i,this.int16[S+1]=s,this.int16[S+2]=h,this.int16[S+3]=l,this.int16[S+4]=d,this.int16[S+5]=v,e}}cu.prototype.bytesPerElement=12,Zt(cu,"StructArrayLayout6i12");class hh extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,h,l,d,v,S,R,g,E,D){const T=this.length;return this.resize(T+1),this.emplace(T,e,i,s,h,l,d,v,S,R,g,E,D)}emplace(e,i,s,h,l,d,v,S,R,g,E,D,T){const A=12*e;return this.int16[A+0]=i,this.int16[A+1]=s,this.int16[A+2]=h,this.int16[A+3]=l,this.uint16[A+4]=d,this.uint16[A+5]=v,this.uint16[A+6]=S,this.uint16[A+7]=R,this.int16[A+8]=g,this.int16[A+9]=E,this.int16[A+10]=D,this.int16[A+11]=T,e}}hh.prototype.bytesPerElement=24,Zt(hh,"StructArrayLayout4i4ui4i24");class df extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,h,l,d){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,s,h,l,d)}emplace(e,i,s,h,l,d,v){const S=10*e,R=5*e;return this.int16[S+0]=i,this.int16[S+1]=s,this.int16[S+2]=h,this.float32[R+2]=l,this.float32[R+3]=d,this.float32[R+4]=v,e}}df.prototype.bytesPerElement=20,Zt(df,"StructArrayLayout3i3f20");class Cl extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,h){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,s,h)}emplace(e,i,s,h,l){const d=4*e;return this.float32[d+0]=i,this.float32[d+1]=s,this.float32[d+2]=h,this.float32[d+3]=l,e}}Cl.prototype.bytesPerElement=16,Zt(Cl,"StructArrayLayout4f16");class wd extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}wd.prototype.bytesPerElement=4,Zt(wd,"StructArrayLayout1ul4");class Dl extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){const h=2*e;return this.uint16[h+0]=i,this.uint16[h+1]=s,e}}Dl.prototype.bytesPerElement=4,Zt(Dl,"StructArrayLayout2ui4");class pf extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,h,l,d,v,S,R,g,E,D,T){const A=this.length;return this.resize(A+1),this.emplace(A,e,i,s,h,l,d,v,S,R,g,E,D,T)}emplace(e,i,s,h,l,d,v,S,R,g,E,D,T,A){const z=20*e,B=10*e;return this.int16[z+0]=i,this.int16[z+1]=s,this.int16[z+2]=h,this.int16[z+3]=l,this.int16[z+4]=d,this.float32[B+3]=v,this.float32[B+4]=S,this.float32[B+5]=R,this.float32[B+6]=g,this.int16[z+14]=E,this.uint32[B+8]=D,this.uint16[z+18]=T,this.uint16[z+19]=A,e}}pf.prototype.bytesPerElement=40,Zt(pf,"StructArrayLayout5i4f1i1ul2ui40");class Il extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,h,l,d,v){const S=this.length;return this.resize(S+1),this.emplace(S,e,i,s,h,l,d,v)}emplace(e,i,s,h,l,d,v,S){const R=8*e;return this.int16[R+0]=i,this.int16[R+1]=s,this.int16[R+2]=h,this.int16[R+4]=l,this.int16[R+5]=d,this.int16[R+6]=v,this.int16[R+7]=S,e}}Il.prototype.bytesPerElement=16,Zt(Il,"StructArrayLayout3i2i2i16");class fh extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,h,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,s,h,l)}emplace(e,i,s,h,l,d){const v=4*e,S=8*e;return this.float32[v+0]=i,this.float32[v+1]=s,this.float32[v+2]=h,this.int16[S+6]=l,this.int16[S+7]=d,e}}fh.prototype.bytesPerElement=16,Zt(fh,"StructArrayLayout2f1f2i16");class uu extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,h,l,d){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,s,h,l,d)}emplace(e,i,s,h,l,d,v){const S=20*e,R=5*e;return this.uint8[S+0]=i,this.uint8[S+1]=s,this.float32[R+1]=h,this.float32[R+2]=l,this.float32[R+3]=d,this.float32[R+4]=v,e}}uu.prototype.bytesPerElement=20,Zt(uu,"StructArrayLayout2ub4f20");class Ln extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,s)}emplace(e,i,s,h){const l=3*e;return this.uint16[l+0]=i,this.uint16[l+1]=s,this.uint16[l+2]=h,e}}Ln.prototype.bytesPerElement=6,Zt(Ln,"StructArrayLayout3ui6");class mf extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,s,h,l,d,v,S,R,g,E,D,T,A,z,B,N,Z,X,q,Y){const K=this.length;return this.resize(K+1),this.emplace(K,e,i,s,h,l,d,v,S,R,g,E,D,T,A,z,B,N,Z,X,q,Y)}emplace(e,i,s,h,l,d,v,S,R,g,E,D,T,A,z,B,N,Z,X,q,Y,K){const re=30*e,he=15*e,ue=60*e;return this.int16[re+0]=i,this.int16[re+1]=s,this.int16[re+2]=h,this.float32[he+2]=l,this.float32[he+3]=d,this.uint16[re+8]=v,this.uint16[re+9]=S,this.uint32[he+5]=R,this.uint32[he+6]=g,this.uint32[he+7]=E,this.uint16[re+16]=D,this.uint16[re+17]=T,this.uint16[re+18]=A,this.float32[he+10]=z,this.float32[he+11]=B,this.uint8[ue+48]=N,this.uint8[ue+49]=Z,this.uint8[ue+50]=X,this.uint32[he+13]=q,this.int16[re+28]=Y,this.uint8[ue+58]=K,e}}mf.prototype.bytesPerElement=60,Zt(mf,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Ms extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,s,h,l,d,v,S,R,g,E,D,T,A,z,B,N,Z,X,q,Y,K,re,he,ue,ce,Te,de,Se,Ce,Me,Le){const ke=this.length;return this.resize(ke+1),this.emplace(ke,e,i,s,h,l,d,v,S,R,g,E,D,T,A,z,B,N,Z,X,q,Y,K,re,he,ue,ce,Te,de,Se,Ce,Me,Le)}emplace(e,i,s,h,l,d,v,S,R,g,E,D,T,A,z,B,N,Z,X,q,Y,K,re,he,ue,ce,Te,de,Se,Ce,Me,Le,ke){const Ue=20*e,Pe=40*e,at=80*e;return this.float32[Ue+0]=i,this.float32[Ue+1]=s,this.int16[Pe+4]=h,this.int16[Pe+5]=l,this.int16[Pe+6]=d,this.int16[Pe+7]=v,this.int16[Pe+8]=S,this.int16[Pe+9]=R,this.int16[Pe+10]=g,this.int16[Pe+11]=E,this.int16[Pe+12]=D,this.uint16[Pe+13]=T,this.uint16[Pe+14]=A,this.uint16[Pe+15]=z,this.uint16[Pe+16]=B,this.uint16[Pe+17]=N,this.uint16[Pe+18]=Z,this.uint16[Pe+19]=X,this.uint16[Pe+20]=q,this.uint16[Pe+21]=Y,this.uint16[Pe+22]=K,this.uint16[Pe+23]=re,this.uint16[Pe+24]=he,this.uint16[Pe+25]=ue,this.uint16[Pe+26]=ce,this.uint16[Pe+27]=Te,this.uint32[Ue+14]=de,this.float32[Ue+15]=Se,this.float32[Ue+16]=Ce,this.float32[Ue+17]=Me,this.float32[Ue+18]=Le,this.uint8[at+76]=ke,e}}Ms.prototype.bytesPerElement=80,Zt(Ms,"StructArrayLayout2f9i15ui1ul4f1ub80");class Hs extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}Hs.prototype.bytesPerElement=4,Zt(Hs,"StructArrayLayout1f4");class Ia extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,h,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,s,h,l)}emplace(e,i,s,h,l,d){const v=5*e;return this.float32[v+0]=i,this.float32[v+1]=s,this.float32[v+2]=h,this.float32[v+3]=l,this.float32[v+4]=d,e}}Ia.prototype.bytesPerElement=20,Zt(Ia,"StructArrayLayout5f20");class mo extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,h,l,d,v){const S=this.length;return this.resize(S+1),this.emplace(S,e,i,s,h,l,d,v)}emplace(e,i,s,h,l,d,v,S){const R=7*e;return this.float32[R+0]=i,this.float32[R+1]=s,this.float32[R+2]=h,this.float32[R+3]=l,this.float32[R+4]=d,this.float32[R+5]=v,this.float32[R+6]=S,e}}mo.prototype.bytesPerElement=28,Zt(mo,"StructArrayLayout7f28");class As extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,h,l,d,v,S,R,g,E){const D=this.length;return this.resize(D+1),this.emplace(D,e,i,s,h,l,d,v,S,R,g,E)}emplace(e,i,s,h,l,d,v,S,R,g,E,D){const T=11*e;return this.float32[T+0]=i,this.float32[T+1]=s,this.float32[T+2]=h,this.float32[T+3]=l,this.float32[T+4]=d,this.float32[T+5]=v,this.float32[T+6]=S,this.float32[T+7]=R,this.float32[T+8]=g,this.float32[T+9]=E,this.float32[T+10]=D,e}}As.prototype.bytesPerElement=44,Zt(As,"StructArrayLayout11f44");class hu extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,h,l,d,v,S,R){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,s,h,l,d,v,S,R)}emplace(e,i,s,h,l,d,v,S,R,g){const E=9*e;return this.float32[E+0]=i,this.float32[E+1]=s,this.float32[E+2]=h,this.float32[E+3]=l,this.float32[E+4]=d,this.float32[E+5]=v,this.float32[E+6]=S,this.float32[E+7]=R,this.float32[E+8]=g,e}}hu.prototype.bytesPerElement=36,Zt(hu,"StructArrayLayout9f36");class fc extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){const h=2*e;return this.float32[h+0]=i,this.float32[h+1]=s,e}}fc.prototype.bytesPerElement=8,Zt(fc,"StructArrayLayout2f8");class _f extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,h){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,s,h)}emplace(e,i,s,h,l){const d=6*e;return this.uint32[3*e+0]=i,this.uint16[d+2]=s,this.uint16[d+3]=h,this.uint16[d+4]=l,e}}_f.prototype.bytesPerElement=12,Zt(_f,"StructArrayLayout1ul3ui12");class Go extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}Go.prototype.bytesPerElement=2,Zt(Go,"StructArrayLayout1ui2");class Rl extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,h,l,d,v,S,R,g,E,D,T,A,z,B){const N=this.length;return this.resize(N+1),this.emplace(N,e,i,s,h,l,d,v,S,R,g,E,D,T,A,z,B)}emplace(e,i,s,h,l,d,v,S,R,g,E,D,T,A,z,B,N){const Z=16*e;return this.float32[Z+0]=i,this.float32[Z+1]=s,this.float32[Z+2]=h,this.float32[Z+3]=l,this.float32[Z+4]=d,this.float32[Z+5]=v,this.float32[Z+6]=S,this.float32[Z+7]=R,this.float32[Z+8]=g,this.float32[Z+9]=E,this.float32[Z+10]=D,this.float32[Z+11]=T,this.float32[Z+12]=A,this.float32[Z+13]=z,this.float32[Z+14]=B,this.float32[Z+15]=N,e}}Rl.prototype.bytesPerElement=64,Zt(Rl,"StructArrayLayout16f64");class fu extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,h,l,d,v){const S=this.length;return this.resize(S+1),this.emplace(S,e,i,s,h,l,d,v)}emplace(e,i,s,h,l,d,v,S){const R=10*e,g=5*e;return this.uint16[R+0]=i,this.uint16[R+1]=s,this.uint16[R+2]=h,this.uint16[R+3]=l,this.float32[g+2]=d,this.float32[g+3]=v,this.float32[g+4]=S,e}}fu.prototype.bytesPerElement=20,Zt(fu,"StructArrayLayout4ui3f20");class gf extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.int16[1*e+0]=i,e}}gf.prototype.bytesPerElement=2,Zt(gf,"StructArrayLayout1i2");class dh extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint8[1*e+0]=i,e}}dh.prototype.bytesPerElement=1,Zt(dh,"StructArrayLayout1ub1");class ph extends ou{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}ph.prototype.size=40;class yf extends pf{get(e){return new ph(this,e)}}Zt(yf,"CollisionBoxArray");class dc extends ou{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}dc.prototype.size=60;class Td extends mf{get(e){return new dc(this,e)}}Zt(Td,"PlacedSymbolArray");class Sd extends ou{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}Sd.prototype.size=80;class Sp extends Ms{get(e){return new Sd(this,e)}}Zt(Sp,"SymbolInstanceArray");class Ed extends Hs{getoffsetX(e){return this.float32[1*e+0]}}Zt(Ed,"GlyphOffsetArray");class Wn extends fo{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Zt(Wn,"SymbolLineVertexArray");class Sn extends ou{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Sn.prototype.size=12;class du extends _f{get(e){return new Sn(this,e)}}Zt(du,"FeatureIndexArray");class Ra extends Dl{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Zt(Ra,"FillExtrusionCentroidArray");class pu extends ou{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}pu.prototype.size=6;class Md extends hc{get(e){return new pu(this,e)}}Zt(Md,"FillExtrusionWallArray");const Ep=cr([{name:"a_pos",components:2,type:"Int16"}],4),mh=cr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Xr{constructor(e=[]){this.segments=e}_prepareSegment(e,i,s,h){let l=this.segments[this.segments.length-1];return e>Xr.MAX_VERTEX_ARRAY_LENGTH&&Ri(`Max vertices per segment is ${Xr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!l||l.vertexLength+e>Xr.MAX_VERTEX_ARRAY_LENGTH||l.sortKey!==h)&&(l={vertexOffset:i,primitiveOffset:s,vertexLength:0,primitiveLength:0},h!==void 0&&(l.sortKey=h),this.segments.push(l)),l}prepareSegment(e,i,s,h){return this._prepareSegment(e,i.length,s.length,h)}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,s,h){return new Xr([{vertexOffset:e,primitiveOffset:i,vertexLength:s,primitiveLength:h,vaos:{},sortKey:0}])}}function _h(a,e){return 256*(a=Mi(Math.floor(a),0,255))+Mi(Math.floor(e),0,255)}Xr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Zt(Xr,"SegmentVector");const Mp=cr([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),vf=cr([{name:"a_dash",components:4,type:"Uint16"}]);class pc{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,i,s,h){this.ids.push(xf(e)),this.positions.push(i,s,h)}eachPosition(e,i){const s=xf(e);let h=0,l=this.ids.length-1;for(;h<l;){const d=h+l>>1;this.ids[d]>=s?l=d:h=d+1}for(;this.ids[h]===s;)i(this.positions[3*h],this.positions[3*h+1],this.positions[3*h+2]),h++}static serialize(e,i){const s=new Float64Array(e.ids),h=new Uint32Array(e.positions);return mc(s,h,0,s.length-1),i&&(i.add(s.buffer),i.add(h.buffer)),{ids:s,positions:h}}static deserialize(e){const i=new pc;let s;i.ids=e.ids,i.positions=e.positions;for(const h of i.ids)h!==s&&i.uniqueIds.push(h),s=h;return i.indexed=!0,i}}function xf(a){const e=+a;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:ps(String(a))}function mc(a,e,i,s){for(;i<s;){const h=a[i+s>>1];let l=i-1,d=s+1;for(;;){do l++;while(a[l]<h);do d--;while(a[d]>h);if(l>=d)break;gh(a,l,d),gh(e,3*l,3*d),gh(e,3*l+1,3*d+1),gh(e,3*l+2,3*d+2)}d-i<s-d?(mc(a,e,i,d),i=d+1):(mc(a,e,d+1,s),s=d)}}function gh(a,e,i){const s=a[e];a[e]=a[i],a[i]=s}Zt(pc,"FeaturePositionMap");class Cs{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}set(e,i,s){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class _c extends Cs{constructor(e){super(e),this.current=0}set(e,i,s){this.fetchUniformLocation(e,i)&&this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}}class Qr extends Cs{constructor(e){super(e),this.current=0}set(e,i,s){this.fetchUniformLocation(e,i)&&this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class ts extends Cs{constructor(e){super(e),this.current=[0,0]}set(e,i,s){this.fetchUniformLocation(e,i)&&(s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1])))}}class zl extends Cs{constructor(e){super(e),this.current=[0,0,0]}set(e,i,s){this.fetchUniformLocation(e,i)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2])))}}class mu extends Cs{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,s){this.fetchUniformLocation(e,i)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3])))}}class _o extends Cs{constructor(e){super(e),this.current=nr.transparent.toRenderColor(null)}set(e,i,s){this.fetchUniformLocation(e,i)&&(s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a)))}}const bf=new Float32Array(16);class yh extends Cs{constructor(e){super(e),this.current=bf}set(e,i,s){if(this.fetchUniformLocation(e,i)){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let h=1;h<16;h++)if(s[h]!==this.current[h]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}}}const wf=new Float32Array(9),Ad=new Float32Array(4);class Ho extends Cs{constructor(e){super(e),this.current=Ad}set(e,i,s){if(this.fetchUniformLocation(e,i)){for(let h=0;h<4;h++)if(s[h]!==this.current[h]){this.current=s,this.gl.uniformMatrix2fv(this.location,!1,s);break}}}}function Zs(a){return[_h(255*a.r,255*a.g),_h(255*a.b,255*a.a)]}class qa{constructor(e,i,s,h){this.value=e,this.uniformNames=i.map(l=>`u_${l}`),this.type=s,this.context=h}setUniform(e,i,s,h,l){const d=h.constantOr(this.value);i.set(e,l,d instanceof nr?d.toRenderColor(this.ignoreLut?null:this.context.lut):d)}getBinding(e,i){return this.type==="color"?new _o(e):new Qr(e)}}class za{constructor(e,i){this.uniformNames=i.map(s=>`u_${s}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,i,s,h,l){const d=l==="u_pattern"||l==="u_dash"?this.pattern:l==="u_pixel_ratio"?this.pixelRatio:null;d&&i.set(e,l,d)}getBinding(e,i){return i==="u_pattern"||i==="u_dash"?new mu(e):new Qr(e)}}class Xs{constructor(e,i,s,h){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=i.map(l=>({name:`a_${l}`,type:"Float32",components:s==="color"?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(e,i,s,h,l,d,v){const S=this.paintVertexArray.length,R=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new wr(0,{brightness:d}),i,{},l,h,v):this.expression.kind==="constant"&&this.expression.value;!this.lutExpression||this.lutExpression.kind!=="composite"&&this.lutExpression.kind!=="source"||(this.ignoreLut=this.lutExpression.evaluate(new wr(0,{brightness:d}),i,{},l,h,v)==="none"),this.paintVertexArray.resize(e),this._setPaintValue(S,e,R,this.context)}updatePaintArray(e,i,s,h,l,d,v){const S=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:v},s,h,void 0,l):this.expression.kind==="constant"&&this.expression.value;!this.lutExpression||this.lutExpression.kind!=="composite"&&this.lutExpression.kind!=="source"||(this.ignoreLut=this.lutExpression.evaluate({zoom:0,brightness:v},s,h,void 0,l)==="none"),this._setPaintValue(e,i,S,this.context)}_setPaintValue(e,i,s,h){if(this.type==="color"){const l=Zs(s.toRenderColor(this.ignoreLut?null:h.lut));for(let d=e;d<i;d++)this.paintVertexArray.emplace(d,l[0],l[1])}else{for(let l=e;l<i;l++)this.paintVertexArray.emplace(l,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class is{constructor(e,i,s,h,l,d){this.expression=e,this.uniformNames=i.map(v=>`u_${v}_t`),this.type=s,this.useIntegerZoom=h,this.context=l,this.maxValue=0,this.paintVertexAttributes=i.map(v=>({name:`a_${v}`,type:"Float32",components:s==="color"?4:2,offset:0})),this.paintVertexArray=new d}populatePaintArray(e,i,s,h,l,d,v){const S=this.expression.evaluate(new wr(this.context.zoom,{brightness:d}),i,{},l,h,v),R=this.expression.evaluate(new wr(this.context.zoom+1,{brightness:d}),i,{},l,h,v);!this.lutExpression||this.lutExpression.kind!=="composite"&&this.lutExpression.kind!=="source"||(this.ignoreLut=this.lutExpression.evaluate(new wr(this.context.zoom,{brightness:d}),i,{},l,h,v)==="none");const g=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(g,e,S,R,this.context)}updatePaintArray(e,i,s,h,l,d,v){const S=this.expression.evaluate({zoom:this.context.zoom,brightness:v},s,h,void 0,l),R=this.expression.evaluate({zoom:this.context.zoom+1,brightness:v},s,h,void 0,l);!this.lutExpression||this.lutExpression.kind!=="composite"&&this.lutExpression.kind!=="source"||(this.ignoreLut=this.lutExpression.evaluate({zoom:this.context.zoom,brightness:v},s,h,void 0,l)==="none"),this._setPaintValue(e,i,S,R,this.context)}_setPaintValue(e,i,s,h,l){if(this.type==="color"){const d=Zs(s.toRenderColor(this.ignoreLut?null:l.lut)),v=Zs(s.toRenderColor(this.ignoreLut?null:l.lut));for(let S=e;S<i;S++)this.paintVertexArray.emplace(S,d[0],d[1],v[0],v[1])}else{for(let d=e;d<i;d++)this.paintVertexArray.emplace(d,s,h);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(h))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,s,h,l){const d=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,v=Mi(this.expression.interpolationFactor(d,this.context.zoom,this.context.zoom+1),0,1);i.set(e,l,v)}getBinding(e,i){return new Qr(e)}}class Ds{constructor(e,i,s,h,l){this.expression=e,this.layerId=l,this.paintVertexAttributes=(s==="array"?vf:Mp).members;for(let d=0;d<i.length;++d);this.paintVertexArray=new h}populatePaintArray(e,i,s,h){const l=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(l,e,i.patterns&&i.patterns[this.layerId],s)}updatePaintArray(e,i,s,h,l,d,v){this._setPaintValues(e,i,s.patterns&&s.patterns[this.layerId],d)}_setPaintValues(e,i,s,h){if(!h||!s)return;const l=h[s];if(!l)return;const{tl:d,br:v,pixelRatio:S}=l;for(let R=e;R<i;R++)this.paintVertexArray.emplace(R,d[0],d[1],v[0],v[1],S)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class go{constructor(e,i,s=()=>!0){this.binders={},this._buffers=[],this.context=i;const h=[];for(const l in e.paint._values){const d=e.paint.get(l),v=e.paint.get(`${l}-use-theme`);if(l.endsWith("-use-theme")||!s(l)||!(d instanceof Ml&&Qc(d.property.specification)))continue;const S=Tf(l,e.type),R=d.value,g=d.property.specification.type,E=!!d.property.useIntegerZoom,D=l==="line-dasharray"||l.endsWith("pattern"),T=l==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||v&&v.value.kind!=="constant";if(R.kind!=="constant"||T)if(R.kind==="source"||T||D){const A=Sf(l,g,"source");this.binders[l]=D?new Ds(R,S,g,A,e.id):new Xs(R,S,g,A),h.push(`/a_${l}`)}else{const A=Sf(l,g,"composite");this.binders[l]=new is(R,S,g,E,i,A),h.push(`/z_${l}`)}else this.binders[l]=D?new za(R.value,S):new qa(R.value,S,g,i),h.push(`/u_${l}`);v&&(this.binders[l].ignoreLut=v.constantOr("default")==="none",this.binders[l].lutExpression=v.value,this.binders[l].checkUseTheme=!0)}this.cacheKey=h.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof Xs||i instanceof is?i.maxValue:0}populatePaintArrays(e,i,s,h,l,d,v){for(const S in this.binders){const R=this.binders[S];R.context=this.context,R instanceof Xs||R instanceof is||R instanceof Ds?R.populatePaintArray(e,i,s,h,l,d,v):R.lutExpression&&R instanceof qa&&R.lutExpression&&(R.lutExpression.kind==="composite"||R.lutExpression.kind==="source")&&(R.ignoreLut=R.lutExpression.evaluate(new wr(0,{brightness:d}),i,{},l,h,v)==="none")}}setConstantPatternPositions(e){for(const i in this.binders){const s=this.binders[i];s instanceof za&&s.setConstantPatternPositions(e)}}updatePaintArrays(e,i,s,h,l,d,v,S,R){let g=!1;const E=Object.keys(e),D=E.length!==0&&!S,T=D?E:i.uniqueIds;this.context.lut=l.lut;for(const A in this.binders){const z=this.binders[A];if(z.context=this.context,(z instanceof Xs||z instanceof is||z instanceof Ds)&&z.expression&&z.expression.kind&&z.expression.kind!=="constant"&&(z.expression.isStateDependent===!0||z.expression.isLightConstant===!1)){const B=l.paint.get(A);z.expression=B.value;for(const N of T){const Z=e[N.toString()];i.eachPosition(N,(X,q,Y)=>{const K=h.feature(X);z.updatePaintArray(q,Y,K,Z,d,v,R)})}if(!D)for(const N of s.uniqueIds){const Z=e[N.toString()];s.eachPosition(N,(X,q,Y)=>{const K=h.feature(X);z.updatePaintArray(q,Y,K,Z,d,v,R)})}g=!0}}return g}defines(){const e=[];for(const i in this.binders){const s=this.binders[i];(s instanceof qa||s instanceof za)&&e.push(...s.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const s=this.binders[i];if(s instanceof Xs||s instanceof is||s instanceof Ds)for(let h=0;h<s.paintVertexAttributes.length;h++)e.push(s.paintVertexAttributes[h].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const s=this.binders[i];if(s instanceof qa||s instanceof za||s instanceof is)for(const h of s.uniformNames)e.push(h)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const s in this.binders){const h=this.binders[s];if(h instanceof qa||h instanceof za||h instanceof is)for(const l of h.uniformNames)i.push({name:l,property:s,binding:h.getBinding(e,l)})}return i}setUniforms(e,i,s,h,l){for(const{name:d,property:v,binding:S}of s){if(this.binders[v].checkUseTheme&&this.binders[v]instanceof qa){const R=h.get(`${v}-use-theme`);R.isConstant()&&(this.binders[v].ignoreLut=R.constantOr("default")==="none")}this.binders[v].setUniform(e,S,l,h.get(v),d)}}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof Xs||i instanceof is||i instanceof Ds)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(e){for(const i in this.binders){const s=this.binders[i];(s instanceof Xs||s instanceof is||s instanceof Ds)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof Xs||i instanceof is||i instanceof Ds)&&i.destroy()}}}class Ga{constructor(e,i,s=()=>!0){this.programConfigurations={};for(const h of e)this.programConfigurations[h.id]=new go(h,i,s);this.needsUpload=!1,this._featureMap=new pc,this._featureMapWithoutIds=new pc,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,i,s,h,l,d,v,S){for(const R in this.programConfigurations)this.programConfigurations[R].populatePaintArrays(e,i,h,l,d,v,S);i.id!==void 0?this._featureMap.add(i.id,s,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,s,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,s,h,l,d,v){for(const S of s)this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,i,S,h,l,d,v||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const ya={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Tf(a,e){return ya[a]||[a.replace(`${e}-`,"").replace(/-/g,"_")]}const Ap={"line-pattern":{source:Yn,composite:Yn},"fill-pattern":{source:Yn,composite:Yn},"fill-extrusion-pattern":{source:Yn,composite:Yn},"line-dasharray":{source:uh,composite:uh}},Ys={color:{source:fc,composite:Cl},number:{source:Hs,composite:fc}};function Sf(a,e,i){const s=Ap[a];return s&&s[i]||Ys[e][i]}Zt(qa,"ConstantBinder"),Zt(za,"PatternConstantBinder"),Zt(Xs,"SourceExpressionBinder"),Zt(Ds,"PatternCompositeBinder"),Zt(is,"CompositeExpressionBinder"),Zt(go,"ProgramConfiguration",{omit:["_buffers"]}),Zt(Ga,"ProgramConfigurationSet");const aa=zt/Math.PI/2,rs=5,Zo=6,_u=16383,Ol=64,gu=[Ol,32,16],da=-aa,pa=aa;function gc(a,e,i,s=aa){return i=Yi(i),[a*Math.sin(i)*s,-e*s,a*Math.cos(i)*s]}function Ll(a,e,i){return gc(Math.cos(Yi(a)),Math.sin(Yi(a)),e,i)}const Ws=63710088e-1,yo=2*Math.PI*Ws;class ir{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ir(us(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,s=this.lat*i,h=e.lat*i,l=Math.sin(s)*Math.sin(h)+Math.cos(s)*Math.cos(h)*Math.cos((e.lng-this.lng)*i);return Ws*Math.acos(Math.min(l,1))}toBounds(e=0){const i=360*e/40075017,s=i/Math.cos(Math.PI/180*this.lat);return new Xo({lng:this.lng-s,lat:this.lat-i},{lng:this.lng+s,lat:this.lat+i})}toEcef(e){return Ll(this.lat,this.lng,aa+e*aa/Ws)}static convert(e){if(e instanceof ir)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new ir(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new ir(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Xo{constructor(e,i){if(e)if(i)this.setSouthWest(e).setNorthEast(i);else if(e.length===4){const s=e;this.setSouthWest([s[0],s[1]]).setNorthEast([s[2],s[3]])}else{const s=e;this.setSouthWest(s[0]).setNorthEast(s[1])}}setNorthEast(e){return this._ne=e instanceof ir?new ir(e.lng,e.lat):ir.convert(e),this}setSouthWest(e){return this._sw=e instanceof ir?new ir(e.lng,e.lat):ir.convert(e),this}extend(e){const i=this._sw,s=this._ne;let h,l;if(e instanceof ir)h=e,l=e;else{if(!(e instanceof Xo))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Xo.convert(e)):this.extend(ir.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(ir.convert(e)):this;if(h=e._sw,l=e._ne,!h||!l)return this}return i||s?(i.lng=Math.min(h.lng,i.lng),i.lat=Math.min(h.lat,i.lat),s.lng=Math.max(l.lng,s.lng),s.lat=Math.max(l.lat,s.lat)):(this._sw=new ir(h.lng,h.lat),this._ne=new ir(l.lng,l.lat)),this}getCenter(){return new ir((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new ir(this.getWest(),this.getNorth())}getSouthEast(){return new ir(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:s}=ir.convert(e);let h=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&h}static convert(e){if(e)return e instanceof Xo?e:new Xo(e)}}const yc=0,ns=25.5;function vh(a){return yo*Math.cos(a*Math.PI/180)}function $s(a){return(180+a)/360}function Is(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function sa(a,e){return a/vh(e)}function va(a){return 360*a-180}function gn(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function vo(a,e){return a*vh(gn(e))}const Tr=85.051129;function xh(a){return Math.cos(Yi(Mi(a,-85.051129,Tr)))}function vc(a,e){const i=Mi(e,yc,ns),s=Math.pow(2,i);return xh(a)*yo/(512*s)}function c(a){return 1/Math.cos(a*Math.PI/180)}function t(a,e=0){const i=Math.exp(Math.PI*(1-(a.y+e/zt)/(1<<a.z)*2));return 80150034*i/(i*i+1)/zt/(1<<a.z)}class r{constructor(e,i,s=0){this.x=+e,this.y=+i,this.z=+s}static fromLngLat(e,i=0){const s=ir.convert(e);return new r($s(s.lng),Is(s.lat),sa(i,s.lat))}toLngLat(){return new ir(va(this.x),gn(this.y))}toAltitude(){return vo(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/yo*c(gn(this.y))}}function u(a,e,i,s,h,l,d,v,S){const R=(e+s)/2,g=(i+h)/2,E=new Rt(R,g);v(E),function(D,T,A,z,B,N){const Z=A-B,X=z-N;return Math.abs((z-T)*Z-(A-D)*X)/Math.hypot(Z,X)}(E.x,E.y,l.x,l.y,d.x,d.y)>=S?(u(a,e,i,R,g,l,E,v,S),u(a,R,g,s,h,E,d,v,S)):a.push(d)}function p(a,e,i){let s=a[0],h=s.x,l=s.y;e(s);const d=[s];for(let v=1;v<a.length;v++){const S=a[v],{x:R,y:g}=S;e(S),u(d,h,l,R,g,s,S,e,i),h=R,l=g,s=S}return d}function _(a,e,i,s){if(s(e,i)){const h=e.add(i)._mult(.5);_(a,e,h,s),_(a,h,i,s)}else a.push(i)}function b(a,e){let i=a[0];const s=[i];for(let h=1;h<a.length;h++){const l=a[h];_(s,i,l,e),i=l}return s}const C=Math.pow(2,14)-1,O=-C-1;function P(a,e){const i=Math.round(a.x*e),s=Math.round(a.y*e);return a.x=Mi(i,O,C),a.y=Mi(s,O,C),(i<a.x||i>a.x+1||s<a.y||s>a.y+1)&&Ri("Geometry exceeds allowed extent, reduce your vector tile buffer size"),a}function F(a,e,i){const s=a.loadGeometry(),h=a.extent,l=zt/h;if(e&&i&&i.projection.isReprojectedInTileSpace){const d=1<<e.z,{scale:v,x:S,y:R,projection:g}=i,E=D=>{const T=va((e.x+D.x/h)/d),A=gn((e.y+D.y/h)/d),z=g.project(T,A);D.x=(z.x*v-S)*h,D.y=(z.y*v-R)*h};for(let D=0;D<s.length;D++)if(a.type!==1)s[D]=p(s[D],E,1);else{const T=[];for(const A of s[D])A.x<0||A.x>=h||A.y<0||A.y>=h||(E(A),T.push(A));s[D]=T}}for(const d of s)for(const v of d)P(v,l);return s}function V(a,e){return{type:a.type,id:a.id,properties:a.properties,geometry:e?F(a):[]}}function U(a,e,i,s,h){a.emplaceBack(2*e+(s+1)/2,2*i+(h+1)/2)}function H(a,e,i){a.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class J{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new fo,this.indexArray=new Ln,this.segments=new Xr,this.programConfigurations=new Ga(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}updateFootprints(e,i){}populate(e,i,s,h){const l=this.layers[0],d=[];let v=null;l.type==="circle"&&(v=l.layout.get("circle-sort-key"));for(const{feature:R,id:g,index:E,sourceLayerIndex:D}of e){const T=this.layers[0]._featureFilter.needGeometry,A=V(R,T);if(!this.layers[0]._featureFilter.filter(new wr(this.zoom),A,s))continue;const z=v?v.evaluate(A,{},s):void 0,B={id:g,properties:R.properties,type:R.type,sourceLayerIndex:D,index:E,geometry:T?A.geometry:F(R,s,h),patterns:{},sortKey:z};d.push(B)}v&&d.sort((R,g)=>R.sortKey-g.sortKey);let S=null;h.projection.name==="globe"&&(this.globeExtVertexArray=new cu,S=h.projection);for(const R of d){const{geometry:g,index:E,sourceLayerIndex:D}=R,T=e[E].feature;this.addFeature(R,g,E,i.availableImages,s,S,i.brightness),i.featureIndex.insert(T,g,E,D,this.index)}}update(e,i,s,h,l,d,v){this.programConfigurations.updatePaintArrays(e,i,l,s,h,d,v)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ep.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,mh.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,i,s,h,l,d,v){for(const S of i)for(const R of S){const g=R.x,E=R.y;if(g<0||g>=zt||E<0||E>=zt)continue;if(d){const A=d.projectTilePoint(g,E,l),z=d.upVector(l,g,E),B=this.globeExtVertexArray;H(B,A,z),H(B,A,z),H(B,A,z),H(B,A,z)}const D=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),T=D.vertexLength;U(this.layoutVertexArray,g,E,-1,-1),U(this.layoutVertexArray,g,E,1,-1),U(this.layoutVertexArray,g,E,1,1),U(this.layoutVertexArray,g,E,-1,1),this.indexArray.emplaceBack(T,T+1,T+2),this.indexArray.emplaceBack(T,T+2,T+3),D.vertexLength+=4,D.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},h,l,v)}}function $(a,e){for(let i=0;i<a.length;i++)if(_e(e,a[i]))return!0;for(let i=0;i<e.length;i++)if(_e(a,e[i]))return!0;return!!pe(a,e)}function te(a,e,i){return!!_e(a,e)||!!be(e,a,i)}function ee(a,e){if(a.length===1)return ve(e,a[0]);for(let i=0;i<e.length;i++){const s=e[i];for(let h=0;h<s.length;h++)if(_e(a,s[h]))return!0}for(let i=0;i<a.length;i++)if(ve(e,a[i]))return!0;for(let i=0;i<e.length;i++)if(pe(a,e[i]))return!0;return!1}function le(a,e,i){if(a.length>1){if(pe(a,e))return!0;for(let s=0;s<e.length;s++)if(be(e[s],a,i))return!0}for(let s=0;s<a.length;s++)if(be(a[s],e,i))return!0;return!1}function pe(a,e){if(a.length===0||e.length===0)return!1;for(let i=0;i<a.length-1;i++){const s=a[i],h=a[i+1];for(let l=0;l<e.length-1;l++)if(fe(s,h,e[l],e[l+1]))return!0}return!1}function fe(a,e,i,s){return no(a,i,s)!==no(e,i,s)&&no(a,e,i)!==no(a,e,s)}function be(a,e,i){const s=i*i;if(e.length===1)return a.distSqr(e[0])<s;for(let h=1;h<e.length;h++)if(me(a,e[h-1],e[h])<s)return!0;return!1}function me(a,e,i){const s=e.distSqr(i);if(s===0)return a.distSqr(e);const h=((a.x-e.x)*(i.x-e.x)+(a.y-e.y)*(i.y-e.y))/s;return a.distSqr(h<0?e:h>1?i:i.sub(e)._mult(h)._add(e))}function ve(a,e){let i,s,h,l=!1;for(let d=0;d<a.length;d++){i=a[d];for(let v=0,S=i.length-1;v<i.length;S=v++)s=i[v],h=i[S],s.y>e.y!=h.y>e.y&&e.x<(h.x-s.x)*(e.y-s.y)/(h.y-s.y)+s.x&&(l=!l)}return l}function _e(a,e){let i=!1;for(let s=0,h=a.length-1;s<a.length;h=s++){const l=a[s],d=a[h];l.y>e.y!=d.y>e.y&&e.x<(d.x-l.x)*(e.y-l.y)/(d.y-l.y)+l.x&&(i=!i)}return i}function Ee(a,e,i,s,h){for(const d of a)if(e<=d.x&&i<=d.y&&s>=d.x&&h>=d.y)return!0;const l=[new Rt(e,i),new Rt(e,h),new Rt(s,h),new Rt(s,i)];if(a.length>2){for(const d of l)if(_e(a,d))return!0}for(let d=0;d<a.length-1;d++)if(ze(a[d],a[d+1],l))return!0;return!1}function ze(a,e,i){const s=i[0],h=i[2];if(a.x<s.x&&e.x<s.x||a.x>h.x&&e.x>h.x||a.y<s.y&&e.y<s.y||a.y>h.y&&e.y>h.y)return!1;const l=no(a,e,i[0]);return l!==no(a,e,i[1])||l!==no(a,e,i[2])||l!==no(a,e,i[3])}function Ye(a,e,i,s,h,l){let d=e.y-a.y,v=a.x-e.x;if(l=l||0){const S=d*d+v*v;if(S===0)return!0;const R=Math.sqrt(S);d/=R,v/=R}return!((i.x-a.x)*d+(i.y-a.y)*v-l<0||(s.x-a.x)*d+(s.y-a.y)*v-l<0||(h.x-a.x)*d+(h.y-a.y)*v-l<0)}function qe(a,e,i,s,h,l,d){return!(Ye(a,e,s,h,l,d)||Ye(e,i,s,h,l,d)||Ye(i,a,s,h,l,d)||Ye(s,h,a,e,i,d)||Ye(h,l,a,e,i,d)||Ye(l,s,a,e,i,d))}function lt(a,e,i){const s=e.paint.get(a).value;return s.kind==="constant"?s.value:i.programConfigurations.get(e.id).getMaxValue(a)}function it(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function Be(a,e,i,s,h){if(!e[0]&&!e[1])return a;const l=Rt.convert(e)._mult(h);i==="viewport"&&l._rotate(-s);const d=[];for(let v=0;v<a.length;v++)d.push(a[v].sub(l));return d}function Ke(a,e,i,s){const h=Rt.convert(a)._mult(s);return e==="viewport"&&h._rotate(-i),h}let gt,Fe;Zt(J,"CircleBucket",{omit:["layers"]});var st,Je={exports:{}},St=(st||(st=1,function(a,e){(function(i){function s(l,d,v){var S=h(256*l,256*(d=Math.pow(2,v)-d-1),v),R=h(256*(l+1),256*(d+1),v);return S[0]+","+S[1]+","+R[0]+","+R[1]}function h(l,d,v){var S=2*Math.PI*6378137/256/Math.pow(2,v);return[l*S-2*Math.PI*6378137/2,d*S-2*Math.PI*6378137/2]}i.getURL=function(l,d,v,S,R,g){return g=g||{},l+"?"+["bbox="+s(v,S,R),"format="+(g.format||"image/png"),"service="+(g.service||"WMS"),"version="+(g.version||"1.1.1"),"request="+(g.request||"GetMap"),"srs="+(g.srs||"EPSG:3857"),"width="+(g.width||256),"height="+(g.height||256),"layers="+d].join("&")},i.getTileBBox=s,i.getMercCoords=h,Object.defineProperty(i,"__esModule",{value:!0})})(e)}(0,Je.exports)),Je.exports);class dt{constructor(e,i,s){this.z=e,this.x=i,this.y=s,this.key=Ct(0,e,e,i,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const s=St.getTileBBox(this.x,this.y,this.z),h=function(l,d,v){let S,R="";for(let g=l;g>0;g--)S=1<<g-1,R+=(d&S?1:0)+(v&S?2:0);return R}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",s)}toString(){return`${this.z}/${this.x}/${this.y}`}}class ct{constructor(e,i){this.wrap=e,this.canonical=i,this.key=Ct(e,i.z,i.z,i.x,i.y)}}class vt{constructor(e,i,s,h,l){this.overscaledZ=e,this.wrap=i,this.canonical=new dt(s,+h,+l),this.key=i===0&&e===s?this.canonical.key:Ct(i,e,s,h,l)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new vt(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new vt(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return Ct(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const s=this.canonical.z-e;return Ct(this.wrap*+i,e,e,this.canonical.x>>s,this.canonical.y>>s)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new vt(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,s=2*this.canonical.x,h=2*this.canonical.y;return[new vt(i,this.wrap,i,s,h),new vt(i,this.wrap,i,s+1,h),new vt(i,this.wrap,i,s,h+1),new vt(i,this.wrap,i,s+1,h+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new vt(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new vt(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new ct(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Ct(a,e,i,s,h){const l=1<<Math.min(i,22);let d=l*(h%l)+s%l;return a&&i<22&&(d+=l*l*((a<0?-2*a-1:2*a)%(1<<2*(22-i)))),16*(32*d+i)+(e-i)}const Vt=[a=>{let e=a.canonical.x-1,i=a.wrap;return e<0&&(e=(1<<a.canonical.z)-1,i--),new vt(a.overscaledZ,i,a.canonical.z,e,a.canonical.y)},a=>{let e=a.canonical.x+1,i=a.wrap;return e===1<<a.canonical.z&&(e=0,i++),new vt(a.overscaledZ,i,a.canonical.z,e,a.canonical.y)},a=>new vt(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,(a.canonical.y===0?1<<a.canonical.z:a.canonical.y)-1),a=>new vt(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,a.canonical.y===(1<<a.canonical.z)-1?0:a.canonical.y+1)];Zt(dt,"CanonicalTileID"),Zt(vt,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const Yt=cr([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:ui}=Yt,oi=cr([{name:"a_pos_3",components:3,type:"Int16"}]);var ri=cr([{name:"a_pos",type:"Int16",components:2}]);class xi{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,s){const h=Ae.vec3.dot(i,this.dir);if(Math.abs(h)<1e-6)return!1;const l=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/h;return s[0]=this.pos[0]+this.dir[0]*l,s[1]=this.pos[1]+this.dir[1]*l,s[2]=this.pos[2]+this.dir[2]*l,!0}closestPointOnSphere(e,i,s){if(Ae.vec3.equals(this.pos,e)||i===0)return s[0]=s[1]=s[2]=0,!1;const[h,l,d]=this.dir,v=this.pos[0]-e[0],S=this.pos[1]-e[1],R=this.pos[2]-e[2],g=h*h+l*l+d*d,E=2*(v*h+S*l+R*d),D=E*E-4*g*(v*v+S*S+R*R-i*i);if(D<0){const T=Math.max(-E/2,0),A=v+h*T,z=S+l*T,B=R+d*T,N=Math.hypot(A,z,B);return s[0]=A*i/N,s[1]=z*i/N,s[2]=B*i/N,!1}{const T=(-E-Math.sqrt(D))/(2*g);if(T<0){const A=Math.hypot(v,S,R);return s[0]=v*i/A,s[1]=S*i/A,s[2]=R*i/A,!1}return s[0]=v+h*T,s[1]=S+l*T,s[2]=R+d*T,!0}}}class bi{constructor(e,i,s,h,l){this.TL=e,this.TR=i,this.BR=s,this.BL=h,this.horizon=l}static fromInvProjectionMatrix(e,i,s){const h=[-1,1,1],l=[1,1,1],d=[1,-1,1],v=[-1,-1,1],S=Ae.vec3.transformMat4(h,h,e),R=Ae.vec3.transformMat4(l,l,e),g=Ae.vec3.transformMat4(d,d,e),E=Ae.vec3.transformMat4(v,v,e);return new bi(S,R,g,E,i/s)}}function pr(a,e,i){let s=1/0,h=-1/0;const l=[];for(const d of a){Ae.vec3.sub(l,d,e);const v=Ae.vec3.dot(l,i);s=Math.min(s,v),h=Math.max(h,v)}return[s,h]}function Yr(a,e){let i=!0;for(let s=0;s<a.planes.length;s++){const h=a.planes[s];let l=0;for(let d=0;d<e.length;d++)l+=Ae.vec3.dot(h,e[d])+h[3]>=0;if(l===0)return 0;l!==e.length&&(i=!1)}return i?2:1}function Cr(a,e){for(const i of a.projections){const s=pr(e,a.points[0],i.axis);if(i.projection[1]<s[0]||i.projection[0]>s[1])return 0}return 1}function Ai(a,e){let i=0;const s=[0,0,0,0];for(let h=0;h<a.length;h++)s[0]=a[h][0],s[1]=a[h][1],s[2]=a[h][2],s[3]=1,Ae.vec4.dot(s,e)>=0&&i++;return i}class rr{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=Ut.fromPoints(this.points),this.projections=[],this.frustumEdges=[Ae.vec3.sub([],this.points[2],this.points[3]),Ae.vec3.sub([],this.points[0],this.points[3]),Ae.vec3.sub([],this.points[4],this.points[0]),Ae.vec3.sub([],this.points[5],this.points[1]),Ae.vec3.sub([],this.points[6],this.points[2]),Ae.vec3.sub([],this.points[7],this.points[3])];for(const s of this.frustumEdges){const h=[0,-s[2],s[1]],l=[s[2],0,-s[0]];this.projections.push({axis:h,projection:pr(this.points,this.points[0],h)}),this.projections.push({axis:l,projection:pr(this.points,this.points[0],l)})}}static fromInvProjectionMatrix(e,i,s,h){const l=Math.pow(2,s),d=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(R=>{const g=Ae.vec4.transformMat4([],R,e),E=1/g[3]/i*l;return Ae.vec4.mul(g,g,[E,E,h?1/g[3]:E,E])}),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(R=>{const g=Ae.vec3.sub([],d[R[0]],d[R[1]]),E=Ae.vec3.sub([],d[R[2]],d[R[1]]),D=Ae.vec3.normalize([],Ae.vec3.cross([],g,E)),T=-Ae.vec3.dot(D,d[R[1]]);return D.concat(T)}),S=[];for(let R=0;R<d.length;R++)S.push([d[R][0],d[R][1],d[R][2]]);return new rr(S,v)}intersectsPrecise(e,i,s){for(let h=0;h<i.length;h++)if(!Ai(e,i[h]))return 0;for(let h=0;h<this.planes.length;h++)if(!Ai(e,this.planes[h]))return 0;for(const h of s)for(const l of this.frustumEdges){const d=Ae.vec3.cross([],h,l),v=Ae.vec3.length(d);if(v===0)continue;Ae.vec3.scale(d,d,1/v);const S=pr(this.points,this.points[0],d),R=pr(e,this.points[0],d);if(S[0]>R[1]||R[0]>S[1])return 0}return 1}containsPoint(e){for(const i of this.planes){const s=i[3];if(Ae.vec3.dot([i[0],i[1],i[2]],e)+s<0)return!1}return!0}}class Ut{static fromPoints(e){const i=[1/0,1/0,1/0],s=[-1/0,-1/0,-1/0];for(const h of e)Ae.vec3.min(i,i,h),Ae.vec3.max(s,s,h);return new Ut(i,s)}static fromTileIdAndHeight(e,i,s){const h=1<<e.canonical.z,l=e.canonical.x,d=e.canonical.y;return new Ut([l/h,d/h,i],[(l+1)/h,(d+1)/h,s])}static applyTransform(e,i){const s=e.getCorners();for(let h=0;h<s.length;++h)Ae.vec3.transformMat4(s[h],s[h],i);return Ut.fromPoints(s)}static applyTransformFast(e,i){const s=[i[12],i[13],i[14]],h=[...s];for(let l=0;l<3;l++)for(let d=0;d<3;d++){const v=i[4*d+l],S=v*e.min[d],R=v*e.max[d];s[l]+=Math.min(S,R),h[l]+=Math.max(S,R)}return new Ut(s,h)}static projectAabbCorners(e,i){const s=e.getCorners();for(let h=0;h<s.length;++h)Ae.vec3.transformMat4(s[h],s[h],i);return s}constructor(e,i){this.min=e,this.max=i,this.center=Ae.vec3.scale([],Ae.vec3.add([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],s=Ae.vec3.clone(this.min),h=Ae.vec3.clone(this.max);for(let l=0;l<i.length;l++)s[l]=i[l]?this.min[l]:this.center[l],h[l]=i[l]?this.center[l]:this.max[l];return h[2]=this.max[2],new Ut(s,h)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Yr(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Yr(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,i){return i||this.intersects(e)?Cr(e,this.getCorners()):0}intersectsPreciseFlat(e,i){return i||this.intersectsFlat(e)?Cr(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let i=0;i<3;++i)if(this.min[i]>e.max[i]||e.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e.min[i]),this.max[i]=Math.max(this.max[i],e.max[i])}encapsulatePoint(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e[i]),this.max[i]=Math.max(this.max[i],e[i])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}function mi(a){return a*aa/Ws}Zt(Ut,"Aabb");const hi=[new Ut([da,da,da],[pa,pa,pa]),new Ut([da,da,da],[0,0,pa]),new Ut([0,da,da],[pa,0,pa]),new Ut([da,0,da],[0,pa,pa]),new Ut([0,0,da],[pa,pa,pa])];function _i(a,e,i,s=!0){const h=Ae.vec3.scale([],a._camera.position,a.worldSize),l=[e,i,1,1];Ae.vec4.transformMat4(l,l,a.pixelMatrixInverse),Ae.vec4.scale(l,l,1/l[3]);const d=Ae.vec3.sub([],l,h),v=Ae.vec3.normalize([],d),S=a.globeMatrix,R=[S[12],S[13],S[14]],g=Ae.vec3.sub([],R,h),E=Ae.vec3.length(g),D=Ae.vec3.normalize([],g),T=a.worldSize/(2*Math.PI),A=Ae.vec3.dot(D,v),z=Math.asin(T/E);if(z<Math.acos(A)){if(!s)return null;const Te=[],de=[];Ae.vec3.scale(Te,v,E/A),Ae.vec3.normalize(de,Ae.vec3.sub(de,Te,g)),Ae.vec3.normalize(v,Ae.vec3.add(v,g,Ae.vec3.scale(v,de,Math.tan(z)*E)))}const B=[];new xi(h,v).closestPointOnSphere(R,T,B);const N=Ae.vec3.normalize([],ao(S,0)),Z=Ae.vec3.normalize([],ao(S,1)),X=Ae.vec3.normalize([],ao(S,2)),q=Ae.vec3.dot(N,B),Y=Ae.vec3.dot(Z,B),K=Ae.vec3.dot(X,B),re=Tn(Math.asin(-Y/T));let he=Tn(Math.atan2(q,K));he=a.center.lng+function(Te,de){const Se=(de-Te+180)%360-180;return Se<-180?Se+360:Se}(a.center.lng,he);const ue=$s(he),ce=Mi(Is(re),0,1);return new r(ue,ce)}class Zi{constructor(e,i,s){this.a=Ae.vec3.sub([],e,s),this.b=Ae.vec3.sub([],i,s),this.center=s;const h=Ae.vec3.normalize([],this.a),l=Ae.vec3.normalize([],this.b);this.angle=Math.acos(Ae.vec3.dot(h,l))}}function Ir(a,e){if(a.angle===0)return null;let i;return i=a.a[e]===0?1/a.angle*.5*Math.PI:1/a.angle*Math.atan(a.b[e]/a.a[e]/Math.sin(a.angle)-1/Math.tan(a.angle)),i<0||i>1?null:function(s,h,l,d){const v=Math.sin(l);return s*(Math.sin((1-d)*l)/v)+h*(Math.sin(d*l)/v)}(a.a[e],a.b[e],a.angle,Mi(i,0,1))+a.center[e]}function Fr(a){if(a.z<=1)return hi[a.z+2*a.y+a.x];const e=fr(Ji(a));return Ut.fromPoints(e)}function Wr(a,e,i){return Ae.vec3.scale(a,a,1-i),Ae.vec3.scaleAndAdd(a,a,e,i)}function Oa(a,e,i){for(const s of a)Ae.vec3.transformMat4(s,s,e),Ae.vec3.scale(s,s,i)}function sn(a,e,i,s){const h=e/a.worldSize,l=a.globeMatrix;if(i.z<=1){const ue=Fr(i).getCorners();return Oa(ue,l,h),Ut.fromPoints(ue)}const d=Ji(i,s),v=fr(d,aa+mi(a._tileCoverLift));Oa(v,l,h);const S=Number.MAX_VALUE,R=[-S,-S,-S],g=[S,S,S];if(d.contains(a.center)){for(const Te of v)Ae.vec3.min(g,g,Te),Ae.vec3.max(R,R,Te);R[2]=0;const ue=a.point,ce=[ue.x*h,ue.y*h,0];return Ae.vec3.min(g,g,ce),Ae.vec3.max(R,R,ce),new Ut(g,R)}if(a._tileCoverLift>0){for(const ue of v)Ae.vec3.min(g,g,ue),Ae.vec3.max(R,R,ue);return new Ut(g,R)}const E=[l[12]*h,l[13]*h,l[14]*h],D=d.getCenter(),T=Mi(a.center.lat,-85.051129,Tr),A=Mi(D.lat,-85.051129,Tr),z=$s(a.center.lng),B=Is(T);let N=z-$s(D.lng);const Z=B-Is(A);N>.5?N-=1:N<-.5&&(N+=1);let X=0;if(Math.abs(N)>Math.abs(Z))X=N>=0?1:3;else{X=Z>=0?0:2;const ue=[l[4]*h,l[5]*h,l[6]*h],ce=-Math.sin(Yi(Z>=0?d.getSouth():d.getNorth()))*aa;Ae.vec3.scaleAndAdd(E,E,ue,ce)}const q=v[X],Y=v[(X+1)%4],K=new Zi(q,Y,E),re=[Ir(K,0)||q[0],Ir(K,1)||q[1],Ir(K,2)||q[2]],he=oa(a.zoom);if(he>0){const ue=function({x:Te,y:de,z:Se},Ce,Me,Le,ke){const Ue=1/(1<<Se);let Pe=Te*Ue,at=Pe+Ue,mt=de*Ue,nt=mt+Ue,Bt=0;const Ot=(Pe+at)/2-Le;return Ot>.5?Bt=-1:Ot<-.5&&(Bt=1),Pe=((Pe+Bt)*Ce-(Le*=Ce))*Me+Le,at=((at+Bt)*Ce-Le)*Me+Le,mt=(mt*Ce-(ke*=Ce))*Me+ke,nt=(nt*Ce-ke)*Me+ke,[[Pe,nt,0],[at,nt,0],[at,mt,0],[Pe,mt,0]]}(i,e,a._pixelsPerMercatorPixel,z,B);for(let Te=0;Te<v.length;Te++)Wr(v[Te],ue[Te],he);const ce=Ae.vec3.add([],ue[X],ue[(X+1)%4]);Ae.vec3.scale(ce,ce,.5),Wr(re,ce,he)}for(const ue of v)Ae.vec3.min(g,g,ue),Ae.vec3.max(R,R,ue);return g[2]=Math.min(q[2],Y[2]),Ae.vec3.min(g,g,re),Ae.vec3.max(R,R,re),new Ut(g,R)}function Ji({x:a,y:e,z:i},s=!1){const h=1/(1<<i),l=new ir(va(a*h),e===(1<<i)-1&&s?-90:gn((e+1)*h)),d=new ir(va((a+1)*h),e===0&&s?90:gn(e*h));return new Xo(l,d)}function fr(a,e=aa){const i=Yi(a.getNorth()),s=Yi(a.getSouth()),h=Math.cos(i),l=Math.cos(s),d=Math.sin(i),v=Math.sin(s),S=a.getWest(),R=a.getEast();return[gc(l,v,S,e),gc(l,v,R,e),gc(h,d,R,e),gc(h,d,S,e)]}function hr(a,e,i,s){const h=1<<i.z,l=(a/zt+i.x)/h;return Ll(gn((e/zt+i.y)/h),va(l),s)}function Qi({min:a,max:e}){return _u/Math.max(e[0]-a[0],e[1]-a[1],e[2]-a[2])}const Sr=new Float64Array(16);function en(a){const e=Qi(a),i=Ae.mat4.fromScaling(Sr,[e,e,e]);return Ae.mat4.translate(i,i,Ae.vec3.negate([],a.min))}function mr(a){const e=Ae.mat4.fromTranslation(Sr,a.min),i=1/Qi(a);return Ae.mat4.scale(e,e,[i,i,i])}function tn(a){const e=zt/(2*Math.PI);return a/(2*Math.PI)/e}function Ha(a,e){return zt/(512*Math.pow(2,a))*Qi(Fr(e))}function xa(a,e,i,s,h){const l=tn(i),d=[a,e,-i/(2*Math.PI)],v=Ae.mat4.identity(new Float64Array(16));return Ae.mat4.translate(v,v,d),Ae.mat4.scale(v,v,[l,l,l]),Ae.mat4.rotateX(v,v,Yi(-h)),Ae.mat4.rotateY(v,v,Yi(-s)),v}function oa(a){return ro(rs,Zo,a)}function as(a,e){const i=Ll(e.lat,e.lng),s=function(l){const d=Ll(l._center.lat,l._center.lng),v=Ae.vec3.fromValues(0,1,0);let S=Ae.vec3.cross([],v,d);const R=Ae.mat4.fromRotation([],-l.angle,d);S=Ae.vec3.transformMat4(S,S,R),Ae.mat4.fromRotation(R,-l._pitch,S);const g=Ae.vec3.normalize([],d);return Ae.vec3.scale(g,g,mi(l.cameraToCenterDistance/l.pixelsPerMeter)),Ae.vec3.transformMat4(g,g,R),Ae.vec3.add([],d,g)}(a),h=Ae.vec3.subtract([],s,i);return Ae.vec3.angle(h,i)}function $n(a,e){return as(a,e)>Math.PI/2*1.01}const ba=Yi(85),ss=Math.cos(ba),Za=Math.sin(ba),Yo=Ae.mat4.create(),Pl=a=>{const e=[];return a.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),a.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function kl(a,e,i,s,h,l,d,v,S){if(l&&a.queryGeometry.isAboveHorizon)return!1;l&&(S*=a.pixelToTileUnitsFactor);const R=a.tileID.canonical,g=i.projection.upVectorScale(R,i.center.lat,i.worldSize).metersToTile;for(const E of e)for(const D of E){const T=D.add(v),A=h&&i.elevation?i.elevation.exaggeration()*h.getElevationAt(T.x,T.y,!0):0,z=i.projection.projectTilePoint(T.x,T.y,R);if(A>0){const X=i.projection.upVector(R,T.x,T.y);z.x+=X[0]*g*A,z.y+=X[1]*g*A,z.z+=X[2]*g*A}const B=l?T:bh(z.x,z.y,z.z,s),N=l?a.tilespaceRays.map(X=>os(X,A)):a.queryGeometry.screenGeometry,Z=Ae.vec4.transformMat4([],[z.x,z.y,z.z,1],s);if(!d&&l?S*=Z[3]/i.cameraToCenterDistance:d&&!l&&(S*=i.cameraToCenterDistance/Z[3]),l){const X=gn((D.y/zt+R.y)/(1<<R.z));S/=i.projection.pixelsPerMeter(X,1)/sa(1,X)}if(te(N,B,S))return!0}return!1}function bh(a,e,i,s){const h=Ae.vec4.transformMat4([],[a,e,i,1],s);return new Rt(h[0]/h[3],h[1]/h[3])}const Rs=Ae.vec3.fromValues(0,0,0),ag=Ae.vec3.fromValues(0,0,1);function os(a,e){const i=Ae.vec3.create();return Rs[2]=e,a.intersectsPlane(Rs,ag,i),new Rt(i[0],i[1])}class Bm extends J{}let Cp,Nm,sg,Fl;function Cd(a,{width:e,height:i},s,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==e*i*s)throw new RangeError("mismatched image size")}else h=new Uint8Array(e*i*s);return a.width=e,a.height=i,a.data=h,a}function Dp(a,e,i){const{width:s,height:h}=e;s===a.width&&h===a.height||(yu(a,e,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,s),height:Math.min(a.height,h)},i,null),a.width=s,a.height=h,a.data=e.data)}function yu(a,e,i,s,h,l,d,v){if(h.width===0||h.height===0)return e;if(h.width>a.width||h.height>a.height||i.x>a.width-h.width||i.y>a.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>e.width||h.height>e.height||s.x>e.width-h.width||s.y>e.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const S=a.data,R=e.data,g=l===4&&v;for(let E=0;E<h.height;E++){const D=((i.y+E)*a.width+i.x)*l,T=((s.y+E)*e.width+s.x)*l;if(g)for(let A=0;A<h.width;A++){const z=D+A*l+3,B=T+A*l;R[B+0]=255,R[B+1]=255,R[B+2]=255,R[B+3]=S[z]}else if(d)for(let A=0;A<h.width;A++){const z=D+A*l,B=T+A*l,N=S[z+3],Z=new nr(S[z+0]/255*N,S[z+1]/255*N,S[z+2]/255*N,N).toRenderColor(d).toArray();R[B+0]=Z[0],R[B+1]=Z[1],R[B+2]=Z[2],R[B+3]=Z[3]}else for(let A=0;A<h.width*l;A++)R[T+A]=S[D+A]}return e}Zt(Bm,"HeatmapBucket",{omit:["layers"]});class xc{constructor(e,i){Cd(this,e,1,i)}resize(e){Dp(this,new xc(e),1)}clone(){return new xc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,s,h,l){yu(e,i,s,h,l,1,null)}}class Qn{constructor(e,i){Cd(this,e,4,i)}resize(e){Dp(this,new Qn(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Qn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,s,h,l,d,v){yu(e,i,s,h,l,4,d,v)}}class Vm{constructor(e,i){this.width=e.width,this.height=e.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}function wh(a){const e={},i=a.resolution||256,s=a.clips?a.clips.length:1,h=a.image||new Qn({width:i,height:s}),l=(d,v,S)=>{e[a.evaluationKey]=S;const R=a.expression.evaluate(e);R&&(h.data[d+v+0]=Math.floor(255*R.r/R.a),h.data[d+v+1]=Math.floor(255*R.g/R.a),h.data[d+v+2]=Math.floor(255*R.b/R.a),h.data[d+v+3]=Math.floor(255*R.a))};if(a.clips)for(let d=0,v=0;d<s;++d,v+=4*i)for(let S=0,R=0;S<i;S++,R+=4){const g=S/(i-1),{start:E,end:D}=a.clips[d];l(v,R,E*(1-g)+D*g)}else for(let d=0,v=0;d<i;d++,v+=4)l(0,v,d/(i-1));return h}Zt(xc,"AlphaImage"),Zt(Qn,"RGBAImage");const Um=cr([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ny}=Um;function Dd(a,e,i=2){const s=e&&e.length,h=s?e[0]*i:a.length;let l=og(a,0,h,i,!0);const d=[];if(!l||l.next===l.prev)return d;let v,S,R;if(s&&(l=function(g,E,D,T){const A=[];for(let z=0,B=E.length;z<B;z++){const N=og(g,E[z]*T,z<B-1?E[z+1]*T:g.length,T,!1);N===N.next&&(N.steiner=!0),A.push(on(N))}A.sort(Vy);for(let z=0;z<A.length;z++)D=ug(A[z],D);return D}(a,e,l,i)),a.length>80*i){v=1/0,S=1/0;let g=-1/0,E=-1/0;for(let D=i;D<h;D+=i){const T=a[D],A=a[D+1];T<v&&(v=T),A<S&&(S=A),T>g&&(g=T),A>E&&(E=A)}R=Math.max(g-v,E-S),R=R!==0?32767/R:0}return Ef(l,d,i,v,S,R,0),d}function og(a,e,i,s,h){let l;if(h===function(d,v,S,R){let g=0;for(let E=v,D=S-R;E<S;E+=R)g+=(d[D]-d[E])*(d[E+1]+d[D+1]),D=E;return g}(a,e,i,s)>0)for(let d=e;d<i;d+=s)l=Id(d/s|0,a[d],a[d+1],l);else for(let d=i-s;d>=e;d-=s)l=Id(d/s|0,a[d],a[d+1],l);return l&&zp(l,l.next)&&(Sh(l),l=l.next),l}function vu(a,e){if(!a)return a;e||(e=a);let i,s=a;do if(i=!1,s.steiner||!zp(s,s.next)&&yn(s.prev,s,s.next)!==0)s=s.next;else{if(Sh(s),s=e=s.prev,s===s.next)break;i=!0}while(i||s!==e);return e}function Ef(a,e,i,s,h,l,d){if(!a)return;!d&&l&&function(S,R,g,E){let D=S;do D.z===0&&(D.z=Rp(D.x,D.y,R,g,E)),D.prevZ=D.prev,D.nextZ=D.next,D=D.next;while(D!==S);D.prevZ.nextZ=null,D.prevZ=null,function(T){let A,z=1;do{let B,N=T;T=null;let Z=null;for(A=0;N;){A++;let X=N,q=0;for(let K=0;K<z&&(q++,X=X.nextZ,X);K++);let Y=z;for(;q>0||Y>0&&X;)q!==0&&(Y===0||!X||N.z<=X.z)?(B=N,N=N.nextZ,q--):(B=X,X=X.nextZ,Y--),Z?Z.nextZ=B:T=B,B.prevZ=Z,Z=B;N=X}Z.nextZ=null,z*=2}while(A>1)}(D)}(a,s,h,l);let v=a;for(;a.prev!==a.next;){const S=a.prev,R=a.next;if(l?Ip(a,s,h,l):Mf(a))e.push(S.i,a.i,R.i),Sh(a),a=R.next,v=R.next;else if((a=R)===v){d?d===1?Ef(a=lg(vu(a),e),e,i,s,h,l,2):d===2&&cg(a,e,i,s,h,l):Ef(vu(a),e,i,s,h,l,1);break}}}function Mf(a){const e=a.prev,i=a,s=a.next;if(yn(e,i,s)>=0)return!1;const h=e.x,l=i.x,d=s.x,v=e.y,S=i.y,R=s.y,g=h<l?h<d?h:d:l<d?l:d,E=v<S?v<R?v:R:S<R?S:R,D=h>l?h>d?h:d:l>d?l:d,T=v>S?v>R?v:R:S>R?S:R;let A=s.next;for(;A!==e;){if(A.x>=g&&A.x<=D&&A.y>=E&&A.y<=T&&xu(h,v,l,S,d,R,A.x,A.y)&&yn(A.prev,A,A.next)>=0)return!1;A=A.next}return!0}function Ip(a,e,i,s){const h=a.prev,l=a,d=a.next;if(yn(h,l,d)>=0)return!1;const v=h.x,S=l.x,R=d.x,g=h.y,E=l.y,D=d.y,T=v<S?v<R?v:R:S<R?S:R,A=g<E?g<D?g:D:E<D?E:D,z=v>S?v>R?v:R:S>R?S:R,B=g>E?g>D?g:D:E>D?E:D,N=Rp(T,A,e,i,s),Z=Rp(z,B,e,i,s);let X=a.prevZ,q=a.nextZ;for(;X&&X.z>=N&&q&&q.z<=Z;){if(X.x>=T&&X.x<=z&&X.y>=A&&X.y<=B&&X!==h&&X!==d&&xu(v,g,S,E,R,D,X.x,X.y)&&yn(X.prev,X,X.next)>=0||(X=X.prevZ,q.x>=T&&q.x<=z&&q.y>=A&&q.y<=B&&q!==h&&q!==d&&xu(v,g,S,E,R,D,q.x,q.y)&&yn(q.prev,q,q.next)>=0))return!1;q=q.nextZ}for(;X&&X.z>=N;){if(X.x>=T&&X.x<=z&&X.y>=A&&X.y<=B&&X!==h&&X!==d&&xu(v,g,S,E,R,D,X.x,X.y)&&yn(X.prev,X,X.next)>=0)return!1;X=X.prevZ}for(;q&&q.z<=Z;){if(q.x>=T&&q.x<=z&&q.y>=A&&q.y<=B&&q!==h&&q!==d&&xu(v,g,S,E,R,D,q.x,q.y)&&yn(q.prev,q,q.next)>=0)return!1;q=q.nextZ}return!0}function lg(a,e){let i=a;do{const s=i.prev,h=i.next.next;!zp(s,h)&&hg(s,i,i.next,h)&&Bl(s,h)&&Bl(h,s)&&(e.push(s.i,i.i,h.i),Sh(i),Sh(i.next),i=a=h),i=i.next}while(i!==a);return vu(i)}function cg(a,e,i,s,h,l){let d=a;do{let v=d.next.next;for(;v!==d.prev;){if(d.i!==v.i&&Uy(d,v)){let S=Lp(d,v);return d=vu(d,d.next),S=vu(S,S.next),Ef(d,e,i,s,h,l,0),void Ef(S,e,i,s,h,l,0)}v=v.next}d=d.next}while(d!==a)}function Vy(a,e){return a.x-e.x}function ug(a,e){const i=function(h,l){let d=l;const v=h.x,S=h.y;let R,g=-1/0;do{if(S<=d.y&&S>=d.next.y&&d.next.y!==d.y){const z=d.x+(S-d.y)*(d.next.x-d.x)/(d.next.y-d.y);if(z<=v&&z>g&&(g=z,R=d.x<d.next.x?d:d.next,z===v))return R}d=d.next}while(d!==l);if(!R)return null;const E=R,D=R.x,T=R.y;let A=1/0;d=R;do{if(v>=d.x&&d.x>=D&&v!==d.x&&xu(S<T?v:g,S,D,T,S<T?g:v,S,d.x,d.y)){const z=Math.abs(S-d.y)/(v-d.x);Bl(d,h)&&(z<A||z===A&&(d.x>R.x||d.x===R.x&&Af(R,d)))&&(R=d,A=z)}d=d.next}while(d!==E);return R}(a,e);if(!i)return e;const s=Lp(i,a);return vu(s,s.next),vu(i,i.next)}function Af(a,e){return yn(a.prev,a,e.prev)<0&&yn(e.next,a,a.next)<0}function Rp(a,e,i,s,h){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-i)*h|0)|a<<8))|a<<4))|a<<2))|a<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*h|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function on(a){let e=a,i=a;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==a);return i}function xu(a,e,i,s,h,l,d,v){return(h-d)*(e-v)>=(a-d)*(l-v)&&(a-d)*(s-v)>=(i-d)*(e-v)&&(i-d)*(l-v)>=(h-d)*(s-v)}function Uy(a,e){return a.next.i!==e.i&&a.prev.i!==e.i&&!function(i,s){let h=i;do{if(h.i!==i.i&&h.next.i!==i.i&&h.i!==s.i&&h.next.i!==s.i&&hg(h,h.next,i,s))return!0;h=h.next}while(h!==i);return!1}(a,e)&&(Bl(a,e)&&Bl(e,a)&&function(i,s){let h=i,l=!1;const d=(i.x+s.x)/2,v=(i.y+s.y)/2;do h.y>v!=h.next.y>v&&h.next.y!==h.y&&d<(h.next.x-h.x)*(v-h.y)/(h.next.y-h.y)+h.x&&(l=!l),h=h.next;while(h!==i);return l}(a,e)&&(yn(a.prev,a,e.prev)||yn(a,e.prev,e))||zp(a,e)&&yn(a.prev,a,a.next)>0&&yn(e.prev,e,e.next)>0)}function yn(a,e,i){return(e.y-a.y)*(i.x-e.x)-(e.x-a.x)*(i.y-e.y)}function zp(a,e){return a.x===e.x&&a.y===e.y}function hg(a,e,i,s){const h=Th(yn(a,e,i)),l=Th(yn(a,e,s)),d=Th(yn(i,s,a)),v=Th(yn(i,s,e));return h!==l&&d!==v||!(h!==0||!Op(a,i,e))||!(l!==0||!Op(a,s,e))||!(d!==0||!Op(i,a,s))||!(v!==0||!Op(i,e,s))}function Op(a,e,i){return e.x<=Math.max(a.x,i.x)&&e.x>=Math.min(a.x,i.x)&&e.y<=Math.max(a.y,i.y)&&e.y>=Math.min(a.y,i.y)}function Th(a){return a>0?1:a<0?-1:0}function Bl(a,e){return yn(a.prev,a,a.next)<0?yn(a,e,a.next)>=0&&yn(a,a.prev,e)>=0:yn(a,e,a.prev)<0||yn(a,a.next,e)<0}function Lp(a,e){const i=bc(a.i,a.x,a.y),s=bc(e.i,e.x,e.y),h=a.next,l=e.prev;return a.next=e,e.prev=a,i.next=h,h.prev=i,s.next=i,i.prev=s,l.next=s,s.prev=l,s}function Id(a,e,i,s){const h=bc(a,e,i);return s?(h.next=s.next,h.prev=s,s.next.prev=h,s.next=h):(h.prev=h,h.next=h),h}function Sh(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function bc(a,e,i){return{i:a,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Qs(a,e){const i=a.length;if(i<=1)return[a];const s=[];let h,l;for(let d=0;d<i;d++){const v=Nh(a[d]);v!==0&&(a[d].area=Math.abs(v),l===void 0&&(l=v<0),l===v<0?(h&&s.push(h),h=[a[d]]):h.push(a[d]))}if(h&&s.push(h),e>1)for(let d=0;d<s.length;d++)s[d].length<=e||(ju(s[d],e,1,s[d].length-1,Rd),s[d]=s[d].slice(0,e));return s}function Rd(a,e){return e.area-a.area}function fg(a,e,i=1){if(!a)return null;const s=typeof a=="string"?a:a.getPrimary().id;e[s]||(e[s]=[]);const h=ea.from(s).getPrimary().scaleSelf(i);return e[s].push(h),h.serialize()}function Pp(a,e,i,s){const h=s.patternDependencies;let l=!1;for(const d of e){const v=d.paint.get(`${a}-pattern`);v.isConstant()||(l=!0),fg(v.constantOr(null),h,i)&&(l=!0)}return l}function kp(a,e,i,s,h,l){const d=l.patternDependencies;for(const v of e){const S=v.paint.get(`${a}-pattern`).value;if(S.kind!=="constant"){let R=S.evaluate({zoom:s},i,{},l.availableImages);R=R&&R.name?R.name:R;const g=fg(R,d,h);g&&(i.patterns[v.id]=g)}}return i}class Fp{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new fo,this.indexArray=new Ln,this.indexArray2=new Dl,this.programConfigurations=new Ga(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new Xr,this.segments2=new Xr,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection}updateFootprints(e,i){}populate(e,i,s,h){this.hasPattern=Pp("fill",this.layers,this.pixelRatio,i);const l=this.layers[0].layout.get("fill-sort-key"),d=[];for(const{feature:v,id:S,index:R,sourceLayerIndex:g}of e){const E=this.layers[0]._featureFilter.needGeometry,D=V(v,E);if(!this.layers[0]._featureFilter.filter(new wr(this.zoom),D,s))continue;const T=l?l.evaluate(D,{},s,i.availableImages):void 0,A={id:S,properties:v.properties,type:v.type,sourceLayerIndex:g,index:R,geometry:E?D.geometry:F(v,s,h),patterns:{},sortKey:T};d.push(A)}l&&d.sort((v,S)=>v.sortKey-S.sortKey);for(const v of d){const{geometry:S,index:R,sourceLayerIndex:g}=v;if(this.hasPattern){const E=kp("fill",this.layers,v,this.zoom,this.pixelRatio,i);this.patternFeatures.push(E)}else this.addFeature(v,S,R,s,{},i.availableImages,i.brightness,i.elevationFeatures);i.featureIndex.insert(e[R].feature,S,R,g,this.index)}}update(e,i,s,h,l,d,v){this.programConfigurations.updatePaintArrays(e,i,l,s,h,d,v)}addFeatures(e,i,s,h,l,d){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,i,s,h,d,e.elevationFeatures)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ny),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,s,h,l,d=[],v,S){for(const R of Qs(i,500)){let g=0;for(const B of R)g+=B.length;const E=this.segments.prepareSegment(g,this.layoutVertexArray,this.indexArray),D=E.vertexLength,T=[],A=[];for(const B of R){if(B.length===0)continue;B!==R[0]&&A.push(T.length/2);const N=this.segments2.prepareSegment(B.length,this.layoutVertexArray,this.indexArray2),Z=N.vertexLength;this.layoutVertexArray.emplaceBack(B[0].x,B[0].y),this.indexArray2.emplaceBack(Z+B.length-1,Z),T.push(B[0].x),T.push(B[0].y);for(let X=1;X<B.length;X++)this.layoutVertexArray.emplaceBack(B[X].x,B[X].y),this.indexArray2.emplaceBack(Z+X-1,Z+X),T.push(B[X].x),T.push(B[X].y);N.vertexLength+=B.length,N.primitiveLength+=B.length}const z=Dd(T,A);for(let B=0;B<z.length;B+=3)this.indexArray.emplaceBack(D+z[B],D+z[B+1],D+z[B+2]);E.vertexLength+=g,E.primitiveLength+=z.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,l,d,h,v)}}let dg,Bp,jm,qm;Zt(Fp,"FillBucket",{omit:["layers","patternFeatures"]});class Gm{constructor(e,i,s,h){if(this.triangleCount=i.length/3,this.min=new Rt(0,0),this.max=new Rt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[l,d]=[e[0].clone(),e[0].clone()];for(let E=1;E<e.length;++E){const D=e[E];l.x=Math.min(l.x,D.x),l.y=Math.min(l.y,D.y),d.x=Math.max(d.x,D.x),d.y=Math.max(d.y,D.y)}if(h){const E=Math.ceil(Math.max(d.x-l.x,d.y-l.y)/h);s=Math.max(s,E)}if(s===0)return;this.min=l,this.max=d;const v=this.max.sub(this.min);v.x=Math.max(v.x,1),v.y=Math.max(v.y,1);const S=Math.max(v.x,v.y)/s;this.cellsX=Math.max(1,Math.ceil(v.x/S)),this.cellsY=Math.max(1,Math.ceil(v.y/S)),this.xScale=1/S,this.yScale=1/S;const R=[];for(let E=0;E<this.triangleCount;E++){const D=e[i[3*E+0]].sub(this.min),T=e[i[3*E+1]].sub(this.min),A=e[i[3*E+2]].sub(this.min),z=xo(Math.floor(Math.min(D.x,T.x,A.x)),this.xScale,this.cellsX),B=xo(Math.floor(Math.max(D.x,T.x,A.x)),this.xScale,this.cellsX),N=xo(Math.floor(Math.min(D.y,T.y,A.y)),this.yScale,this.cellsY),Z=xo(Math.floor(Math.max(D.y,T.y,A.y)),this.yScale,this.cellsY),X=new Rt(0,0),q=new Rt(0,0),Y=new Rt(0,0),K=new Rt(0,0);for(let re=N;re<=Z;++re){X.y=q.y=re*S,Y.y=K.y=(re+1)*S;for(let he=z;he<=B;++he)X.x=Y.x=he*S,q.x=K.x=(he+1)*S,(qe(D,T,A,X,q,K)||qe(D,T,A,X,K,Y))&&R.push({cellIdx:re*this.cellsX+he,triIdx:E})}}if(R.length===0)return;R.sort((E,D)=>E.cellIdx-D.cellIdx||E.triIdx-D.triIdx);let g=0;for(;g<R.length;){const E=R[g].cellIdx,D={start:this.payload.length,len:0};for(;g<R.length&&R[g].cellIdx===E;)++D.len,this.payload.push(R[g++].triIdx);this.cells[E]=D}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,i){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const s=xo(e.x-this.min.x,this.xScale,this.cellsX),h=xo(e.y-this.min.y,this.yScale,this.cellsY),l=this.cells[h*this.cellsX+s];if(l){this._lazyInitLookup();for(let d=0;d<l.len;d++){const v=this.payload[l.start+d],S=Math.floor(v/8),R=1<<v%8;if(!(this.lookup[S]&R)&&(this.lookup[S]|=R,i.push(v),i.length===this.triangleCount))return}}}query(e,i,s){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)return;this._lazyInitLookup();const h=xo(e.x-this.min.x,this.xScale,this.cellsX),l=xo(i.x-this.min.x,this.xScale,this.cellsX),d=xo(e.y-this.min.y,this.yScale,this.cellsY),v=xo(i.y-this.min.y,this.yScale,this.cellsY);for(let S=d;S<=v;S++)for(let R=h;R<=l;R++){const g=this.cells[S*this.cellsX+R];if(g)for(let E=0;E<g.len;E++){const D=this.payload[g.start+E],T=Math.floor(D/8),A=1<<D%8;if(!(this.lookup[T]&A)&&(this.lookup[T]|=A,s.push(D),s.length===this.triangleCount))return}}}}function xo(a,e,i){return Math.max(0,Math.min(i-1,Math.floor(a*e)))}Zt(Gm,"TriangleGridIndex");class Np{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.footprints=[]}updateFootprints(e,i){for(const s of this.footprints)i.push({footprint:s,id:e})}populate(e,i,s,h){const l=[];for(const{feature:d,id:v,index:S,sourceLayerIndex:R}of e){const g=this.layers[0]._featureFilter.needGeometry,E=V(d,g);if(!this.layers[0]._featureFilter.filter(new wr(this.zoom),E,s))continue;const D={id:v,properties:d.properties,type:d.type,sourceLayerIndex:R,index:S,geometry:g?E.geometry:F(d,s,h),patterns:{}};l.push(D)}for(const d of l){const{geometry:v,index:S,sourceLayerIndex:R}=d;this.addFeature(d,v,S,s,{},i.availableImages,i.brightness),i.featureIndex.insert(e[S].feature,v,S,R,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,i,s,h,l,d,v){}destroy(){}addFeature(e,i,s,h,l,d=[],v){for(const S of Qs(i,2)){const R=[],g=[],E=[],D=new Rt(1/0,1/0),T=new Rt(-1/0,-1/0);for(const B of S)if(B.length!==0){B!==S[0]&&E.push(g.length/2);for(let N=0;N<B.length;N++)g.push(B[N].x),g.push(B[N].y),R.push(B[N]),D.x=Math.min(D.x,B[N].x),D.y=Math.min(D.y,B[N].y),T.x=Math.max(T.x,B[N].x),T.y=Math.max(T.y,B[N].y)}const A=Dd(g,E),z=new Gm(R,A,8,256);this.footprints.push({vertices:R,indices:A,grid:z,min:D,max:T})}}}Zt(Np,"ClipBucket",{omit:["layers"]});const jy=cr([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),qy=cr([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),zd=cr([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Gy=cr([{name:"a_join_normal_inside",components:3,type:"Int16"}]),pg=cr([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),Rr=cr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Hm}=jy;var Cf,Vp,Up,jp,Eh,Od,Mh,Ld={};function mg(){if(Vp)return Cf;Vp=1;var a=Pa();function e(h,l,d,v,S){this.properties={},this.extent=d,this.type=0,this._pbf=h,this._geometry=-1,this._keys=v,this._values=S,h.readFields(i,this,l)}function i(h,l,d){h==1?l.id=d.readVarint():h==2?function(v,S){for(var R=v.readVarint()+v.pos;v.pos<R;){var g=S._keys[v.readVarint()],E=S._values[v.readVarint()];S.properties[g]=E}}(d,l):h==3?l.type=d.readVarint():h==4&&(l._geometry=d.pos)}function s(h){for(var l,d,v=0,S=0,R=h.length,g=R-1;S<R;g=S++)v+=((d=h[g]).x-(l=h[S]).x)*(l.y+d.y);return v}return Cf=e,e.types=["Unknown","Point","LineString","Polygon"],e.prototype.loadGeometry=function(){var h=this._pbf;h.pos=this._geometry;for(var l,d=h.readVarint()+h.pos,v=1,S=0,R=0,g=0,E=[];h.pos<d;){if(S<=0){var D=h.readVarint();v=7&D,S=D>>3}if(S--,v===1||v===2)R+=h.readSVarint(),g+=h.readSVarint(),v===1&&(l&&E.push(l),l=[]),l.push(new a(R,g));else{if(v!==7)throw new Error("unknown command "+v);l&&l.push(l[0].clone())}}return l&&E.push(l),E},e.prototype.bbox=function(){var h=this._pbf;h.pos=this._geometry;for(var l=h.readVarint()+h.pos,d=1,v=0,S=0,R=0,g=1/0,E=-1/0,D=1/0,T=-1/0;h.pos<l;){if(v<=0){var A=h.readVarint();d=7&A,v=A>>3}if(v--,d===1||d===2)(S+=h.readSVarint())<g&&(g=S),S>E&&(E=S),(R+=h.readSVarint())<D&&(D=R),R>T&&(T=R);else if(d!==7)throw new Error("unknown command "+d)}return[g,D,E,T]},e.prototype.toGeoJSON=function(h,l,d){var v,S,R=this.extent*Math.pow(2,d),g=this.extent*h,E=this.extent*l,D=this.loadGeometry(),T=e.types[this.type];function A(N){for(var Z=0;Z<N.length;Z++){var X=N[Z];N[Z]=[360*(X.x+g)/R-180,360/Math.PI*Math.atan(Math.exp((180-360*(X.y+E)/R)*Math.PI/180))-90]}}switch(this.type){case 1:var z=[];for(v=0;v<D.length;v++)z[v]=D[v][0];A(D=z);break;case 2:for(v=0;v<D.length;v++)A(D[v]);break;case 3:for(D=function(N){var Z=N.length;if(Z<=1)return[N];for(var X,q,Y=[],K=0;K<Z;K++){var re=s(N[K]);re!==0&&(q===void 0&&(q=re<0),q===re<0?(X&&Y.push(X),X=[N[K]]):X.push(N[K]))}return X&&Y.push(X),Y}(D),v=0;v<D.length;v++)for(S=0;S<D[v].length;S++)A(D[v][S])}D.length===1?D=D[0]:T="Multi"+T;var B={type:"Feature",geometry:{type:T,coordinates:D},properties:this.properties};return"id"in this&&(B.id=this.id),B},Cf}function _g(){if(jp)return Up;jp=1;var a=mg();function e(s,h){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(i,this,h),this.length=this._features.length}function i(s,h,l){s===15?h.version=l.readVarint():s===1?h.name=l.readString():s===5?h.extent=l.readVarint():s===2?h._features.push(l.pos):s===3?h._keys.push(l.readString()):s===4&&h._values.push(function(d){for(var v=null,S=d.readVarint()+d.pos;d.pos<S;){var R=d.readVarint()>>3;v=R===1?d.readString():R===2?d.readFloat():R===3?d.readDouble():R===4?d.readVarint64():R===5?d.readVarint():R===6?d.readSVarint():R===7?d.readBoolean():null}return v}(l))}return Up=e,e.prototype.feature=function(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];var h=this._pbf.readVarint()+this._pbf.pos;return new a(this._pbf,h,this.extent,this._keys,this._values)},Up}function Zm(){return Mh||(Mh=1,Ld.VectorTile=function(){if(Od)return Eh;Od=1;var a=_g();function e(i,s,h){if(i===3){var l=new a(h,h.readVarint()+h.pos);l.length&&(s[l.name]=l)}}return Eh=function(i,s){this.layers=i.readFields(e,{},s)},Eh}(),Ld.VectorTileFeature=mg(),Ld.VectorTileLayer=_g()),Ld}var Ah=Zm();class Nl extends Rt{constructor(e,i,s){super(e,i),this.z=s}}class Kr extends Nl{constructor(e,i,s,h){super(e,i,s),this.w=h}}function Df(a,e,i,s){const h=[],l=s===0?(d,v,S,R,g,E)=>{d.push(new Rt(E,S+(E-v)/(R-v)*(g-S)))}:(d,v,S,R,g,E)=>{d.push(new Rt(v+(E-S)/(g-S)*(R-v),E))};for(const d of a){const v=[];for(const S of d){if(S.length<=2)continue;const R=[];for(let D=0;D<S.length-1;D++){const T=S[D].x,A=S[D].y,z=S[D+1].x,B=S[D+1].y,N=s===0?T:A,Z=s===0?z:B;N<e?Z>e&&l(R,T,A,z,B,e):N>i?Z<i&&l(R,T,A,z,B,i):R.push(S[D]),Z<e&&N>=e&&l(R,T,A,z,B,e),Z>i&&N<=i&&l(R,T,A,z,B,i)}let g=S[S.length-1];const E=s===0?g.x:g.y;E>=e&&E<=i&&R.push(g),R.length&&(g=R[R.length-1],R[0].x===g.x&&R[0].y===g.y||R.push(R[0]),v.push(R))}v.length&&h.push(v)}return h}function wa(a,e,i,s){const h=i==="x"?"y":"x",l=(s-a[i])/(e[i]-a[i]);a[h]=a[h]+(e[h]-a[h])*l,a[i]=s,a.hasOwnProperty("z")&&(a.z=di(a.z,e.z,l)),a.hasOwnProperty("w")&&(a.w=di(a.w,e.w,l))}function gg(a,e,i,s){const h=i,l=s;for(const d of["x","y"]){let v=a,S=e;v[d]>=S[d]&&(v=e,S=a),v[d]<h&&S[d]>h&&wa(v,S,d,h),v[d]<l&&S[d]>l&&wa(S,v,d,l)}}const If=Number.MAX_SAFE_INTEGER;function qp(a,e,i,s){return a.order<e||a.order===If||!(a.clipMask&i)||function(h,l){return l.length!==0&&l.find(d=>d===h)===void 0}(s,a.clipScope)}function Ch(a,e){return a.x-e.x||a.y-e.y}function Xm(a,e){return Ch(a.min,e.min)===0&&Ch(a.max,e.max)===0}function Gp(a,e){return!(a.min.x>e.max.x||a.max.x<e.min.x||a.min.y>e.max.y||a.max.y<e.min.y)}function Pd(a,e){if(a.length!==e.length)return!1;for(let i=0;i<a.length;i++)if(a[i].sourceId!==e[i].sourceId||!Xm(a[i],e[i])||a[i].order!==e[i].order||a[i].clipMask!==e[i].clipMask||!kn(a[i].clipScope,e[i].clipScope))return!1;return!0}function Hp(a,e,i){const s=1/zt,h=1/(1<<i.canonical.z),l=(e.x*s+i.canonical.x)*h+i.wrap,d=(e.y*s+i.canonical.y)*h;return{min:new Rt((a.x*s+i.canonical.x)*h+i.wrap,(a.y*s+i.canonical.y)*h),max:new Rt(l,d)}}function Hy(a,e,i){const s=1<<i.canonical.z,h=((e.x-i.wrap)*s-i.canonical.x)*zt,l=(e.y*s-i.canonical.y)*zt;return{min:new Rt(((a.x-i.wrap)*s-i.canonical.x)*zt,(a.y*s-i.canonical.y)*zt),max:new Rt(h,l)}}function Ym(a,e,i,s,h,l,d){const v=a.indices,S=a.vertices,R=[];for(let g=s;g<s+h;g+=3){const E=e[i[g+0]+l],D=e[i[g+1]+l],T=e[i[g+2]+l],A=Math.min(E.x,D.x,T.x),z=Math.max(E.x,D.x,T.x),B=Math.min(E.y,D.y,T.y),N=Math.max(E.y,D.y,T.y);R.length=0,a.grid.query(new Rt(A,B),new Rt(z,N),R);for(let Z=0;Z<R.length;Z++){const X=R[Z];if(qe(S[v[3*X+0]],S[v[3*X+1]],S[v[3*X+2]],E,D,T,d))return!0}}return!1}function yg(a,e,i,s){if(!a||!i)return!1;let h=a.vertices;if(!e.canonical.equals(s.canonical)||e.wrap!==s.wrap){if(i.vertices.length<a.vertices.length)return yg(i,s,a,e);const l=e.canonical,d=s.canonical,v=Math.pow(2,d.z-l.z);h=a.vertices.map(S=>new Rt((S.x+l.x*zt)*v-d.x*zt,(S.y+l.y*zt)*v-d.y*zt))}return Ym(i,h,a.indices,0,a.indices.length,0,0)}function Wm(a,e,i,s){const h=Math.pow(2,s.z-i.z);return new Rt((a+i.x*zt)*h-s.x*zt,(e+i.y*zt)*h-s.y*zt)}function vg(a,e){const i=[];e.grid.queryPoint(a,i);const s=e.indices,h=e.vertices;for(let l=0;l<i.length;l++){const d=i[l];if(_e([h[s[3*d+0]],h[s[3*d+1]],h[s[3*d+2]]],a))return!0}return!1}const $m=[new Rt(0,0),new Rt(zt,0),new Rt(zt,zt),new Rt(0,zt)];function Zp(a,e){const i=[];let s=[];if(!e||a.length<2)return[a];if(a.length===2)return ze(a[0],a[1],$m)?[a]:[];for(let h=0;h<a.length+2;h++){const l=a[h%a.length],d=a[(h+1)%a.length],v=ze(h===0?a[a.length-1]:a[(h-1)%a.length],l,$m),S=ze(l,d,$m),R=v||S;R&&s.push(l),R&&S||s.length>0&&(s.length>1&&i.push(s),s=[])}return s.length>1&&i.push(s),i}const kd=Ah.VectorTileFeature.types,Zy=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],Xy=["fill-extrusion-flood-light-ground-radius"],Wo=Math.pow(2,13),xg=Math.pow(2,15)-1,Qm=new Rt(0,1),ma=2147483648;function Rf(a,e,i,s,h,l,d,v){a.emplaceBack((e<<1)+d,(i<<1)+l,(Math.floor(s*Wo)<<1)+h,Math.round(v))}function bu(a,e,i){a.emplaceBack(e.x*zt,e.y*zt,i?1:0)}function bo(a,e,i,s,h,l){a.emplaceBack(e.x,e.y,(i.x<<1)+s,(i.y<<1)+h,l)}function Fd(a,e,i){a.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class bg{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class Dh{constructor(){this.centroidXY=new Rt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Rt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Rt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Rt(this.max.x-this.min.x,this.max.y-this.min.y)}}class Km{constructor(){this.acc=new Rt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,i){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=i.x,e.min.y=e.max.y=i.y)}appendEdge(e,i,s){this.accCount++,this.acc._add(i);let h=!!this.borders;i.x<e.min.x?(e.min.x=i.x,h=!0):i.x>e.max.x&&(e.max.x=i.x,h=!0),i.y<e.min.y?(e.min.y=i.y,h=!0):i.y>e.max.y&&(e.max.y=i.y,h=!0),((i.x===0||i.x===zt)&&i.x===s.x)!=((i.y===0||i.y===zt)&&i.y===s.y)&&this.processBorderOverlap(i,s),h&&this.checkBorderIntersection(i,s)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,di(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>zt!=e.x>zt&&this.addBorderIntersection(1,di(i.y,e.y,(zt-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,di(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>zt!=e.y>zt&&this.addBorderIntersection(3,di(i.x,e.x,(zt-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const s=this.borders[e];i<s[0]&&(s[0]=i),i>s[1]&&(s[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const s=e.x===0?0:1;this.addBorderIntersection(s,i.y),this.addBorderIntersection(s,e.y)}else{const s=e.y===0?2:3;this.addBorderIntersection(s,i.x),this.addBorderIntersection(s,e.x)}}centroid(){return this.accCount===0?new Rt(0,0):new Rt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0):0}}function wg(a,e){const i=a.add(e)._unit(),s=Mi(a.x*i.x+a.y*i.y,-1,1);var h,l,d;return d=Math.acos(s),Math.min(4,Math.max(-4,Math.tan(d)))/4*xg*((h=a).x*(l=e).y-h.y*l.x<0?-1:1)}const Yy=[a=>a.x<0,a=>a.x>zt,a=>a.y<0,a=>a.y>zt];function Wy(a,e,i,s){const h=[4];if(s===0)return h;i._mult(s);const l=a.sub(i),d=e.sub(i),v=[a,e,l,d];for(let S=0;S<4;S++)for(const R of v)if(Yy[S](R)){h.push(S);break}return h}class Tg{constructor(e){this.vertexArray=new ch,this.indexArray=new Ln,this.programConfigurations=new Ga(e.layers,{zoom:e.zoom,lut:e.lut},i=>Xy.includes(i)),this._segments=new Xr,this.hiddenByLandmarkVertexArray=new dh,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Xr}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,i,s,h=!1){const l=e.length;if(l>2){let d=Math.max(0,this._segments.get().length-1);const v=this._segments._prepareSegment(4*l,this.vertexArray.length,2*this._segmentToGroundQuads[d].length);let S;d!==this._segments.get().length-1&&(d++,this._segmentToGroundQuads[d]=[],this._segmentToRegionTriCounts[d]=[0,0,0,0,0]);{const R=e[0],g=e[1];S=wg(R.sub(e[l-1])._perp()._unit(),g.sub(R)._perp()._unit())}for(let R=0;R<l;R++){const g=R===l-1?0:R+1,E=e[R],D=e[g],T=e[g===l-1?0:g+1],A=D.sub(E)._perp()._unit(),z=wg(A,T.sub(D)._perp()._unit()),B=S,N=z;if(wu(E,D,i)||h&&zf(E,i)&&zf(D,i)){S=z;continue}const Z=v.vertexLength;bo(this.vertexArray,E,D,1,1,B),bo(this.vertexArray,E,D,1,0,B),bo(this.vertexArray,E,D,0,1,N),bo(this.vertexArray,E,D,0,0,N),v.vertexLength+=4;const X=Wy(E,D,A,s);for(const q of X)this._segmentToGroundQuads[d].push({id:Z,region:q}),this._segmentToRegionTriCounts[d][q]+=2,v.primitiveLength+=2;S=z}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),i=e.length;for(let s=0;s<i;s++)this._segmentToGroundQuads[s].sort((h,l)=>h.region-l.region);for(let s=0;s<i;s++){const h=this._segmentToGroundQuads[s],l=e[s],d=this._segmentToRegionTriCounts[s];d.reduce((S,R)=>S+R,0);let v=0;for(let S=0;S<=4;S++){const R=d[S];if(R!==0){let g=this.regionSegments[S];g||(g=this.regionSegments[S]=new Xr);const E={vertexOffset:l.vertexOffset,primitiveOffset:l.primitiveOffset+v,vertexLength:l.vertexLength,primitiveLength:R};g.get().push(E)}v+=R}for(let S=0;S<h.length;S++){const R=h[S].id;this.indexArray.emplaceBack(R,R+1,R+3),this.indexArray.emplaceBack(R,R+3,R+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,i,s,h,l,d){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,i,s,h,l,d)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,qy.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,i,s,h,l,d,v){this.hasData()&&this.programConfigurations.updatePaintArrays(e,i,s,h,l,d,v)}updateHiddenByLandmark(e){if(!this.hasData())return;const i=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;const s=e.flags&ma?1:0;for(let h=e.groundVertexArrayOffset;h<i;++h)this.hiddenByLandmarkVertexArray.emplace(h,s);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,pg.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const i=this.regionSegments[e];i&&i.destroy()}}}}class Xp{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Ln,this.footprintVertices=new fo,this.footprintSegments=[],this.layoutVertexArray=new Gs,this.centroidVertexArray=new Ra,this.wallVertexArray=new Md,this.indexArray=new Ln,this.programConfigurations=new Ga(e.layers,{zoom:e.zoom,lut:e.lut},i=>Zy.includes(i)),this.segments=new Xr,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.groundEffect=new Tg(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(e,i){}populate(e,i,s,h){this.features=[],this.hasPattern=Pp("fill-extrusion",this.layers,this.pixelRatio,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=t(s),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:l,id:d,index:v,sourceLayerIndex:S}of e){const R=this.layers[0]._featureFilter.needGeometry,g=V(l,R);if(!this.layers[0]._featureFilter.filter(new wr(this.zoom),g,s))continue;const E={id:d,sourceLayerIndex:S,index:v,geometry:R?g.geometry:F(l,s,h),properties:l.properties,type:l.type,patterns:{}},D=this.layoutVertexArray.length,T=kd[E.type]==="Polygon";if(this.hasPattern)this.features.push(kp("fill-extrusion",this.layers,E,this.zoom,this.pixelRatio,i));else if(this.wallMode)for(const A of E.geometry)for(const z of Zp(A,T))this.addFeature(E,[z],v,s,{},i.availableImages,h,i.brightness);else this.addFeature(E,E.geometry,v,s,{},i.availableImages,h,i.brightness);i.featureIndex.insert(l,E.geometry,v,S,this.index,D)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,i,s,h,l,d){for(const v of this.features){const S=kd[v.type]==="Polygon",{geometry:R}=v;if(this.wallMode)for(const g of R)for(const E of Zp(g,S))this.addFeature(v,[E],v.index,i,s,h,l,d);else this.addFeature(v,R,v.index,i,s,h,l,d)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,i,s,h,l,d,v){this.programConfigurations.updatePaintArrays(e,i,l,s,h,d,v),this.groundEffect.update(e,i,l,s,h,d,v)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Hm),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,Gy.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,Rr.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,zd.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,s,h,l,d,v,S){const R=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,g=[new Rt(0,0),new Rt(zt,zt)],E=v.projection,D=E.name==="globe",T=this.wallMode||kd[e.type]==="Polygon",A=new Km;A.centroidDataIndex=this.centroidData.length;const z=new Dh,B=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},h)<=0,N=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},h);let Z;if(z.height=N,z.vertexArrayOffset=this.layoutVertexArray.length,z.groundVertexArrayOffset=this.groundEffect.vertexArray.length,D&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new cu),this.wallMode){if(D)return void Ri("Non zero fill-extrusion-line-width is not yet supported on globe.");if(i.length!==1)return;Z=function(ce){const Te=ce[0].x===ce[ce.length-1].x&&ce[0].y===ce[ce.length-1].y;(function(bt){let yt=0;const ei=bt.length;for(let jt=0;jt<ei;jt++)yt+=(bt[(jt+1)%ei].x-bt[jt].x)*(bt[(jt+1)%ei].y+bt[jt].y);return yt>=0})(ce)||(ce=ce.reverse());const Se={geometry:[],joinNormals:[],indices:[]},Ce=[],Me=[],Le=[];let ke=ce.length;for(;ke>=2&&ce[ke-1].equals(ce[ke-2]);)ke--;if(ke<(Te?3:2))return Se;let Ue,Pe,at,mt,nt,Bt=0;for(;Bt<ke-1&&ce[Bt].equals(ce[Bt+1]);)Bt++;Te&&(Ue=ce[ke-2],nt=ce[Bt].sub(Ue)._unit()._perp());for(let bt=Bt;bt<ke;bt++){if(at=bt===ke-1?Te?ce[Bt+1]:void 0:ce[bt+1],at&&ce[bt].equals(at))continue;nt&&(mt=nt),Ue&&(Pe=Ue),Ue=ce[bt],nt=at?at.sub(Ue)._unit()._perp():mt,mt=mt||nt;let yt=mt.add(nt);yt.x===0&&yt.y===0||yt._unit();const ei=yt.x*nt.x+yt.y*nt.y,jt=ei!==0?1/ei:1/0,Wt=mt.x*nt.y-mt.y*nt.x>0;let Ti="miter";const zi=2;Ti==="miter"&&jt>zi&&(Ti="bevel"),Ti==="bevel"&&(jt>100&&(Ti="flipbevel"),jt<zi&&(Ti="miter"));const Pi=(ki,$i,Ki,zr)=>{const xr=new Rt(ki.x,ki.y),Ci=new Rt(ki.x,ki.y);xr.x+=$i.x*zr,xr.y+=$i.y*zr,Ci.x-=$i.x*Math.max(Ki,1),Ci.y-=$i.y*Math.max(Ki,1),Le.push($i),Ce.push(xr),Me.push(Ci)};if(Ti==="miter")yt._mult(jt),Pi(Ue,yt,0,0);else if(Ti==="flipbevel")yt=nt.mult(-1),Pi(Ue,yt,0,0),Pi(Ue,yt.mult(-1),0,0);else{const ki=-Math.sqrt(jt*jt-1),$i=Wt?ki:0,Ki=Wt?0:ki;Pe&&Pi(Ue,mt,$i,Ki),at&&Pi(Ue,nt,$i,Ki)}}Se.geometry=[...Ce,...Me.reverse(),Ce[0]],Se.joinNormals=[...Le,...Le.reverse(),Le[Le.length-1]];const Ot=Se.geometry.length-1;for(let bt=0;bt<Ot/2;bt++)if(bt+1<Ot/2){let yt=bt,ei=bt+1,jt=Ot-1-bt,Wt=Ot-2-bt;yt=yt===0?Ot-1:yt-1,ei=ei===0?Ot-1:ei-1,jt=jt===0?Ot-1:jt-1,Wt=Wt===0?Ot-1:Wt-1,Se.indices.push(jt),Se.indices.push(ei),Se.indices.push(yt),Se.indices.push(jt),Se.indices.push(Wt),Se.indices.push(ei)}return Se}(i[0]),i=[Z.geometry]}const X=(ce,Te)=>ce<(Te.length-1)/2||ce===Te.length-1,q=this.wallMode?[i]:Qs(i,500);for(let ce=q.length-1;ce>=0;ce--){const Te=q[ce];(Te.length===0||(Y=Te[0]).every(de=>de.x<=0)||Y.every(de=>de.x>=zt)||Y.every(de=>de.y<=0)||Y.every(de=>de.y>=zt))&&q.splice(ce,1)}var Y;let K;if(D)K=Of(q,g,h);else{K=[];for(const ce of q)K.push({polygon:ce,bounds:g})}const re=T?this.edgeRadius:0,he=re>0&&this.zoom<17,ue=(ce,Te)=>{if(ce.length===0)return!1;const de=ce[ce.length-1];return Te.x===de.x&&Te.y===de.y};for(const{polygon:ce,bounds:Te}of K){let de=0,Se=0;for(const ke of ce)T&&!ke[0].equals(ke[ke.length-1])&&ke.push(ke[0]),Se+=T?ke.length-1:ke.length;const Ce=this.segments.prepareSegment((T?5:4)*Se,this.layoutVertexArray,this.indexArray);z.footprintSegIdx<0&&(z.footprintSegIdx=this.footprintSegments.length),z.polygonSegIdx<0&&(z.polygonSegIdx=this.polygonSegments.length);const Me={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Le=new bg;if(Le.vertexOffset=this.footprintVertices.length,Le.indexOffset=3*this.footprintIndices.length,Le.ringIndices=[],T){const ke=[],Ue=[];de=Ce.vertexLength;for(let at=0;at<ce.length;at++){const mt=ce[at];mt.length&&at!==0&&Ue.push(ke.length/2);const nt=[];let Bt,Ot;Bt=mt[1].sub(mt[0])._perp()._unit(),Le.ringIndices.push(mt.length-1);for(let bt=1;bt<mt.length;bt++){const yt=mt[bt],ei=mt[bt===mt.length-1?1:bt+1],jt=yt.clone();if(re){Ot=ei.sub(yt)._perp()._unit();const Wt=Bt.add(Ot)._unit(),Ti=re*Math.min(4,1/(Bt.x*Wt.x+Bt.y*Wt.y));jt.x+=Ti*Wt.x,jt.y+=Ti*Wt.y,jt.x=Math.round(jt.x),jt.y=Math.round(jt.y),Bt=Ot}if(!B||re!==0&&!he||ue(nt,jt)||nt.push(jt),Rf(this.layoutVertexArray,jt.x,jt.y,0,0,1,1,0),this.wallMode){const Wt=X(bt,mt);bu(this.wallVertexArray,Z.joinNormals[bt],!Wt)}Ce.vertexLength++,this.footprintVertices.emplaceBack(yt.x,yt.y),ke.push(yt.x,yt.y),D&&Fd(this.layoutVertexExtArray,E.projectTilePoint(jt.x,jt.y,h),E.upVector(h,jt.x,jt.y))}B&&(re===0||he)&&(nt.length!==0&&ue(nt,nt[0])&&nt.pop(),this.groundEffect.addData(nt,Te,R))}const Pe=this.wallMode?Z.indices:Dd(ke,Ue);for(let at=0;at<Pe.length;at+=3)this.footprintIndices.emplaceBack(Le.vertexOffset+Pe[at+0],Le.vertexOffset+Pe[at+1],Le.vertexOffset+Pe[at+2]),this.indexArray.emplaceBack(de+Pe[at],de+Pe[at+2],de+Pe[at+1]),Ce.primitiveLength++;Le.indexCount+=Pe.length,Le.vertexCount+=this.footprintVertices.length-Le.vertexOffset}for(let ke=0;ke<ce.length;ke++){const Ue=ce[ke];A.startRing(z,Ue[0]);let Pe=Ue.length>4&&e_(Ue[Ue.length-2],Ue[0],Ue[1]),at=re?$y(Ue[Ue.length-2],Ue[0],Ue[1],re):0;const mt=[];let nt,Bt,Ot;Bt=Ue[1].sub(Ue[0])._perp()._unit();let bt=!0;for(let yt=1,ei=0;yt<Ue.length;yt++){let jt=Ue[yt-1],Wt=Ue[yt];const Ti=Ue[yt===Ue.length-1?1:yt+1];if(A.appendEdge(z,Wt,jt),wu(Wt,jt,Te)){re&&(Bt=Ti.sub(Wt)._perp()._unit(),bt=!bt);continue}const zi=Wt.sub(jt)._perp(),Pi=zi.x/(Math.abs(zi.x)+Math.abs(zi.y)),ki=zi.y>0?1:0,$i=jt.dist(Wt);if(ei+$i>32768&&(ei=0),re){Ot=Ti.sub(Wt)._perp()._unit();let Ci=Jm(jt,Wt,Ti,Sg(Bt,Ot),re);isNaN(Ci)&&(Ci=0);const yr=Wt.sub(jt)._unit();jt=jt.add(yr.mult(at))._round(),Wt=Wt.add(yr.mult(-Ci))._round(),at=Ci,Bt=Ot,B&&this.zoom>=17&&(ue(mt,jt)||mt.push(jt),ue(mt,Wt)||mt.push(Wt))}const Ki=Ce.vertexLength,zr=Ue.length>4&&e_(jt,Wt,Ti);let xr=Eg(ei,Pe,bt);if(Rf(this.layoutVertexArray,jt.x,jt.y,Pi,ki,0,0,xr),Rf(this.layoutVertexArray,jt.x,jt.y,Pi,ki,0,1,xr),this.wallMode){const Ci=X(yt-1,Ue),yr=Z.joinNormals[yt-1];bu(this.wallVertexArray,yr,Ci),bu(this.wallVertexArray,yr,Ci)}if(ei+=$i,xr=Eg(ei,zr,!bt),Pe=zr,Rf(this.layoutVertexArray,Wt.x,Wt.y,Pi,ki,0,0,xr),Rf(this.layoutVertexArray,Wt.x,Wt.y,Pi,ki,0,1,xr),this.wallMode){const Ci=X(yt,Ue),yr=Z.joinNormals[yt];bu(this.wallVertexArray,yr,Ci),bu(this.wallVertexArray,yr,Ci)}if(Ce.vertexLength+=4,this.indexArray.emplaceBack(Ki+0,Ki+1,Ki+2),this.indexArray.emplaceBack(Ki+1,Ki+3,Ki+2),Ce.primitiveLength+=2,re){const Ci=de+(yt===1?Ue.length-2:yt-2),yr=yt===1?de:Ci+1;if(this.indexArray.emplaceBack(Ki+1,Ci,Ki+3),this.indexArray.emplaceBack(Ci,yr,Ki+3),Ce.primitiveLength+=2,nt===void 0&&(nt=Ki),!wu(Ti,Ue[yt],Te)){const vr=yt===Ue.length-1?nt:Ce.vertexLength;this.indexArray.emplaceBack(Ki+2,Ki+3,vr),this.indexArray.emplaceBack(Ki+3,vr+1,vr),this.indexArray.emplaceBack(Ki+3,yr,vr+1),Ce.primitiveLength+=3}bt=!bt}if(D){const Ci=this.layoutVertexExtArray,yr=E.projectTilePoint(jt.x,jt.y,h),vr=E.projectTilePoint(Wt.x,Wt.y,h),qr=E.upVector(h,jt.x,jt.y),pn=E.upVector(h,Wt.x,Wt.y);Fd(Ci,yr,qr),Fd(Ci,yr,qr),Fd(Ci,vr,pn),Fd(Ci,vr,pn)}}T&&(de+=Ue.length-1),B&&re&&this.zoom>=17&&(mt.length!==0&&ue(mt,mt[0])&&mt.pop(),this.groundEffect.addData(mt,Te,R,re>0))}this.footprintSegments.push(Le),Me.triangleCount=this.indexArray.length-Me.triangleArrayOffset,this.polygonSegments.push(Me),++z.footprintSegLen,++z.polygonSegLen}if(z.vertexCount=this.layoutVertexArray.length-z.vertexArrayOffset,z.groundVertexCount=this.groundEffect.vertexArray.length-z.groundVertexArrayOffset,z.vertexCount!==0){if(z.centroidXY=A.borders?Qm:this.encodeCentroid(A,z),this.centroidData.push(z),A.borders){this.featuresOnBorder.push(A);const ce=this.featuresOnBorder.length-1;for(let Te=0;Te<A.borders.length;Te++)A.borders[Te][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Te].push(ce)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,l,d,h,S),this.groundEffect.addPaintPropertiesData(e,s,l,d,h,S),this.maxHeight=Math.max(this.maxHeight,N)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((i,s)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[s].borders[e][0])}splitToSubtiles(){const e=[];for(let v=0;v<this.centroidData.length;v++){const S=this.centroidData[v],R=+(S.min.y+S.max.y>zt),g=2*R+(+(S.min.x+S.max.x>zt)^R);for(let E=0;E<S.polygonSegLen;E++){const D=S.polygonSegIdx+E;e.push({centroidIdx:v,subtile:g,polygonSegmentIdx:D,triangleSegmentIdx:this.polygonSegments[D].triangleSegIdx})}}const i=new Ln;e.sort((v,S)=>v.triangleSegmentIdx===S.triangleSegmentIdx?v.subtile-S.subtile:v.triangleSegmentIdx-S.triangleSegmentIdx);let s=0,h=0,l=0;for(const v of e){if(v.triangleSegmentIdx!==s)break;l++}const d=e.length;for(;h!==e.length;){s=e[h].triangleSegmentIdx;let v=0,S=h,R=h;for(let g=S;g<l&&e[g].subtile===v;g++)R++;for(;S!==l;){const g=e[S];v=g.subtile;const E=this.centroidData[g.centroidIdx].min.clone(),D=this.centroidData[g.centroidIdx].max.clone(),T={vertexOffset:this.segments.segments[s].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[s].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let A=S;A<R;A++){const z=e[A],B=this.polygonSegments[z.polygonSegmentIdx],N=this.centroidData[z.centroidIdx].min,Z=this.centroidData[z.centroidIdx].max,X=this.indexArray.uint16;for(let q=B.triangleArrayOffset;q<B.triangleArrayOffset+B.triangleCount;q++)i.emplaceBack(X[3*q],X[3*q+1],X[3*q+2]);T.primitiveLength+=B.triangleCount,E.x=Math.min(E.x,N.x),E.y=Math.min(E.y,N.y),D.x=Math.max(D.x,Z.x),D.y=Math.max(D.y,Z.y)}T.primitiveLength>0&&this.triangleSubSegments.push({segment:T,min:E,max:D}),S=R;for(let A=S;A<l&&e[A].subtile===e[S].subtile;A++)R++}h=l;for(let g=h;g<d&&e[g].triangleSegmentIdx===e[h].triangleSegmentIdx;g++)l++}i._trim(),this.indexArray=i}getVisibleSegments(e,i,s){const h=new Xr;if(this.wallMode){for(const z of this.triangleSubSegments)h.segments.push(z.segment);return h}let l=0,d=0;const v=1<<e.canonical.z;if(i){const z=i.getMinMaxForTile(e);z&&(l=z.min,d=z.max)}d+=this.maxHeight;const S=e.toUnwrapped();let R;const g=[S.canonical.x/v+S.wrap,S.canonical.y/v],E=[(S.canonical.x+1)/v+S.wrap,(S.canonical.y+1)/v],D=(z,B,N)=>[z[0]*(1-N[0])+B[0]*N[0],z[1]*(1-N[1])+B[1]*N[1]],T=[],A=[];for(const z of this.triangleSubSegments){T[0]=z.min.x/zt,T[1]=z.min.y/zt,A[0]=z.max.x/zt,A[1]=z.max.y/zt;const B=D(g,E,T),N=D(g,E,A);if(new Ut([B[0],B[1],l],[N[0],N[1],d]).intersectsPrecise(s)===0){R&&(h.segments.push(R),R=void 0);continue}const Z=z.segment;R&&R.vertexOffset!==Z.vertexOffset&&(h.segments.push(R),R=void 0),R?(R.vertexLength+=Z.vertexLength,R.primitiveLength+=Z.primitiveLength):R={vertexOffset:Z.vertexOffset,primitiveLength:Z.primitiveLength,vertexLength:Z.vertexLength,primitiveOffset:Z.primitiveOffset,sortKey:void 0,vaos:{}}}return R&&h.segments.push(R),h}encodeCentroid(e,i){const s=e.centroid(),h=i.span(),l=Math.min(7,Math.round(h.x*this.tileToMeter/10)),d=Math.min(7,Math.round(h.y*this.tileToMeter/10));return new Rt(Mi(s.x,1,zt-1)<<3|l,Mi(s.y,1,zt-1)<<3|d)}encodeBorderCentroid(e){if(!e.borders)return new Rt(0,0);const i=e.borders,s=Number.MAX_VALUE;if(i[0][0]!==s||i[1][0]!==s){const h=i[0][0]!==s?0:1;return new Rt(6|(i[0][0]!==s?0:65528),(i[h][0]+i[h][1])/2<<3|6)}{const h=i[2][0]!==s?2:3;return new Rt((i[h][0]+i[h][1])/2<<3|6,6|(i[2][0]!==s?0:65528))}}showCentroid(e){const i=this.centroidData[e.centroidDataIndex];i.flags&=ma,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const i=e.vertexArrayOffset,s=e.vertexCount+e.vertexArrayOffset,h=e.flags&ma?Qm:e.centroidXY,l=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==h.y||l!==h.x){for(let d=i;d<s;++d)this.centroidVertexArray.emplace(d,h.x,h.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,i,s){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const h=i.getReplacementRegionsForTile(e.toUnwrapped());if(Pd(this.activeReplacements,h))return;if(this.activeReplacements=h,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const d of this.centroidData)d.flags&=2147483647;const l=[];for(const d of this.activeReplacements){if(d.order<s)continue;const v=Math.max(1,Math.pow(2,d.footprintTileId.canonical.z-e.canonical.z));for(const S of this.centroidData)if(!(S.flags&ma||d.min.x>S.max.x||S.min.x>d.max.x||d.min.y>S.max.y||S.min.y>d.max.y))for(let R=0;R<S.footprintSegLen;R++){const g=this.footprintSegments[S.footprintSegIdx+R];if(l.length=0,Mg(this.footprintVertices,g.vertexOffset,g.vertexCount,d.footprintTileId.canonical,e.canonical,l),Ym(d.footprint,l,this.footprintIndices.uint16,g.indexOffset,g.indexCount,-g.vertexOffset,-v)){S.flags|=ma;break}}}for(const d of this.centroidData)this.writeCentroidToBuffer(d);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,i,s){let h=!1;for(let l=0;l<s.footprintSegLen;l++){const d=this.footprintSegments[s.footprintSegIdx+l];let v=0;for(const S of d.ringIndices){for(let R=v,g=S+v-1;R<S+v;g=R++){const E=this.footprintVertices.int16[2*(R+d.vertexOffset)+0],D=this.footprintVertices.int16[2*(R+d.vertexOffset)+1],T=this.footprintVertices.int16[2*(g+d.vertexOffset)+1];D>i!=T>i&&e<(this.footprintVertices.int16[2*(g+d.vertexOffset)+0]-E)*(i-D)/(T-D)+E&&(h=!h)}v=S}}return h}getHeightAtTileCoord(e,i){let s=Number.NEGATIVE_INFINITY,h=!0;const l=4*(e+zt)*zt+(i+zt);if(this.partLookup.hasOwnProperty(l)){const d=this.partLookup[l];return d?{height:d.height,hidden:!!(d.flags&ma)}:void 0}for(const d of this.centroidData)e>d.max.x||d.min.x>e||i>d.max.y||d.min.y>i||this.footprintContainsPoint(e,i,d)&&d&&d.height>s&&(s=d.height,this.partLookup[l]=d,h=!!(d.flags&ma));if(s!==Number.NEGATIVE_INFINITY)return{height:s,hidden:h};this.partLookup[l]=void 0}}function Sg(a,e){const i=a.add(e)._unit();return a.x*i.x+a.y*i.y}function $y(a,e,i,s){const h=e.sub(a)._perp()._unit(),l=i.sub(e)._perp()._unit();return Jm(a,e,i,Sg(h,l),s)}function Jm(a,e,i,s,h){const l=Math.sqrt(1-s*s);return Math.min(a.dist(e)/3,e.dist(i)/3,h*l/s)}function wu(a,e,i){return a.x<i[0].x&&e.x<i[0].x||a.x>i[1].x&&e.x>i[1].x||a.y<i[0].y&&e.y<i[0].y||a.y>i[1].y&&e.y>i[1].y}function zf(a,e){return a.x<e[0].x||a.x>e[1].x||a.y<e[0].y||a.y>e[1].y}function e_(a,e,i){if(a.x<0||a.x>=zt||e.x<0||e.x>=zt||i.x<0||i.x>=zt)return!1;const s=i.sub(e),h=s.perp(),l=a.sub(e);return(s.x*l.x+s.y*l.y)/Math.sqrt((s.x*s.x+s.y*s.y)*(l.x*l.x+l.y*l.y))>-.866&&h.x*l.x+h.y*l.y<0}function Eg(a,e,i){const s=e?2|a:-3&a;return i?1|s:-2&s}function Ih(){const a=Math.PI/32,e=Math.tan(a),i=Ws;return i*Math.sqrt(1+2*e*e)-i}function Of(a,e,i){const s=1<<i.z,h=va(i.x/s),l=va((i.x+1)/s),d=gn(i.y/s),v=gn((i.y+1)/s);return function(S,R,g,E,D=0,T){const A=[];if(!S.length||!g||!E)return A;const z=(K,re)=>{for(const he of K)A.push({polygon:he,bounds:re})},B=Math.ceil(Math.log2(g)),N=Math.ceil(Math.log2(E)),Z=B-N,X=[];for(let K=0;K<Math.abs(Z);K++)X.push(Z>0?0:1);for(let K=0;K<Math.min(B,N);K++)X.push(0),X.push(1);let q=S;if(q=Df(q,R[0].y-D,R[1].y+D,1),q=Df(q,R[0].x-D,R[1].x+D,0),!q.length)return A;const Y=[];for(X.length?Y.push({polygons:q,bounds:R,depth:0}):z(q,R);Y.length;){const K=Y.pop(),re=K.depth,he=X[re],ue=K.bounds[0],ce=K.bounds[1],Te=he===0?ue.x:ue.y,de=he===0?ce.x:ce.y,Se=T?T(he,Te,de):.5*(Te+de),Ce=Df(K.polygons,Te-D,Se+D,he),Me=Df(K.polygons,Se-D,de+D,he);if(Ce.length){const Le=[ue,new Rt(he===0?Se:ce.x,he===1?Se:ce.y)];X.length>re+1?Y.push({polygons:Ce,bounds:Le,depth:re+1}):z(Ce,Le)}if(Me.length){const Le=[new Rt(he===0?Se:ue.x,he===1?Se:ue.y),ce];X.length>re+1?Y.push({polygons:Me,bounds:Le,depth:re+1}):z(Me,Le)}}return A}(a,e,Math.ceil((l-h)/11.25),Math.ceil((d-v)/11.25),1,(S,R,g)=>{if(S===0)return .5*(R+g);{const E=gn((i.y+R/zt)/s);return(Is(.5*(gn((i.y+g/zt)/s)+E))*s-i.y)*zt}})}function Mg(a,e,i,s,h,l){const d=Math.pow(2,s.z-h.z);for(let v=0;v<i;v++){let S=a.int16[2*(v+e)+0],R=a.int16[2*(v+e)+1];S=(S+h.x*zt)*d-s.x*zt,R=(R+h.y*zt)*d-s.y*zt,l.push(new Rt(S,R))}}let Bd,Yp;function Rh(a,e){return a.x*e.x+a.y*e.y}function Nd(a,e){if(a.length===1){let i=0;const s=e[i++];let h;for(;!h||s.equals(h);)if(h=e[i++],!h)return 1/0;for(;i<e.length;i++){const l=e[i],d=a[0],v=h.sub(s),S=l.sub(s),R=d.sub(s),g=Rh(v,v),E=Rh(v,S),D=Rh(S,S),T=Rh(R,v),A=Rh(R,S),z=g*D-E*E,B=(D*T-E*A)/z,N=(g*A-E*T)/z,Z=s.z*(1-B-N)+h.z*B+l.z*N;if(isFinite(Z))return Z}return 1/0}{let i=1/0;for(const s of e)i=Math.min(i,s.z);return i}}function t_(a,e,i,s,h,l,d,v){const S=d*h.getElevationAt(a,e,!0,!0),R=l[0]!==0,g=R?l[1]===0?d*(l[0]/7-450):d*function(E,D,T){const A=Math.floor(D[0]/8),z=Math.floor(D[1]/8),B=10*(D[0]-8*A),N=10*(D[1]-8*z),Z=E.getElevationAt(A,z,!0,!0),X=E.getMeterToDEM(T),q=Math.floor(.5*(B*X-1)),Y=Math.floor(.5*(N*X-1)),K=E.tileCoordToPixel(A,z),re=2*q+1,he=2*Y+1,ue=function(Me,Le,ke,Ue,Pe){return[Me.getElevationAtPixel(Le,ke,!0),Me.getElevationAtPixel(Le+Pe,ke,!0),Me.getElevationAtPixel(Le,ke+Pe,!0),Me.getElevationAtPixel(Le+Ue,ke+Pe,!0)]}(E,K.x-q,K.y-Y,re,he),ce=Math.abs(ue[0]-ue[1]),Te=Math.abs(ue[2]-ue[3]),de=Math.abs(ue[0]-ue[2])+Math.abs(ue[1]-ue[3]),Se=Math.min(.25,.5*X*(ce+Te)/re),Ce=Math.min(.25,.5*X*de/he);return Z+Math.max(Se*B,Ce*N)}(h,l,v):S;return{base:S+(i===0?-1:i),top:R?Math.max(g+s,S+i+2):S+s}}Zt(Xp,"FillExtrusionBucket",{omit:["layers","features"]}),Zt(Dh,"PartData"),Zt(bg,"FootprintSegment"),Zt(Km,"BorderCentroidData"),Zt(Tg,"GroundEffect");const Ag=cr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),Qy=cr([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:Cg}=Ag,Vd=cr([{name:"a_packed",components:3,type:"Float32"}]),{members:Ky}=Vd,Jy=cr([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:ev}=Jy;class Ud{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new xc({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const s=this.getKey(e,i);return this.positions[s]}trim(){const e=this.width,i=this.height=zc(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,s){const h=[];let l=e.length%2==1?-e[e.length-1]*s:0,d=e[0]*s,v=!0;h.push({left:l,right:d,isDash:v,zeroLength:e[0]===0});let S=e[0];for(let R=1;R<e.length;R++){v=!v;const g=e[R];l=S*s,S+=g,d=S*s,h.push({left:l,right:d,isDash:v,zeroLength:g===0})}return h}addRoundDash(e,i,s){const h=i/2;for(let l=-s;l<=s;l++){const d=this.width*(this.nextRow+s+l);let v=0,S=e[v];for(let R=0;R<this.width;R++){R/S.right>1&&(S=e[++v]);const g=Math.abs(R-S.left),E=Math.abs(R-S.right),D=Math.min(g,E);let T;const A=l/s*(h+1);if(S.isDash){const z=h-Math.abs(A);T=Math.sqrt(D*D+z*z)}else T=h-Math.sqrt(D*D+A*A);this.image.data[d+R]=Math.max(0,Math.min(255,T+128))}}}addRegularDash(e,i){for(let S=e.length-1;S>=0;--S){const R=e[S],g=e[S+1];R.zeroLength?e.splice(S,1):g&&g.isDash===R.isDash&&(g.left=R.left,e.splice(S,1))}const s=e[0],h=e[e.length-1];s.isDash===h.isDash&&(s.left=h.left-this.width,h.right=s.right+this.width);const l=this.width*this.nextRow;let d=0,v=e[d];for(let S=0;S<this.width;S++){S/v.right>1&&(v=e[++d]);const R=Math.abs(S-v.left),g=Math.abs(S-v.right),E=Math.min(R,g);this.image.data[l+S]=Math.max(0,Math.min(255,(v.isDash?E:-E)+i+128))}}addDash(e,i){const s=this.getKey(e,i);if(this.positions[s])return this.positions[s];const h=i==="round",l=h?7:0,d=2*l+1;if(this.nextRow+d>this.height)return Ri("LineAtlas out of space"),null;e.length===0&&e.push(1);let v=0;for(let g=0;g<e.length;g++)e[g]<0&&(Ri("Negative value is found in line dasharray, replacing values with 0"),e[g]=0),v+=e[g];if(v!==0){const g=this.width/v,E=this.getDashRanges(e,this.width,g);h?this.addRoundDash(E,g,l):this.addRegularDash(E,i==="square"?.5*g:0)}const S=this.nextRow+l;this.nextRow+=d;const R={tl:[S,l],br:[v,0]};return this.positions[s]=R,R}}Zt(Ud,"LineAtlas");const Wp=Ah.VectorTileFeature.types,i_=Math.cos(Math.PI/180*37.5),tv=Math.cos(Math.PI/180*5);class zh{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasZOffset=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new lu,this.layoutVertexArray2=new po,this.patternVertexArray=new po,this.indexArray=new Ln,this.programConfigurations=new Ga(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new Xr,this.maxLineLength=0,this.zOffsetVertexArray=new po,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:zt/64}updateFootprints(e,i){}populate(e,i,s,h){this.hasPattern=Pp("line",this.layers,this.pixelRatio,i);const l=this.layers[0].layout.get("line-sort-key");this.tileToMeter=t(s);const d=this.layers[0].layout.get("line-z-offset"),v=d.isConstant()&&!d.constantOr(0),S=this.layers[0].layout.get("line-elevation-reference");this.hasZOffset=S==="sea"||S==="ground"||!v&&S==="none",this.hasZOffset&&S==="none"&&Ri(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`);const R=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.hasZOffset&&R!==void 0;const g=[];for(const{feature:A,id:z,index:B,sourceLayerIndex:N}of e){const Z=this.layers[0]._featureFilter.needGeometry,X=V(A,Z);if(!this.layers[0]._featureFilter.filter(new wr(this.zoom),X,s))continue;const q=l?l.evaluate(X,{},s):void 0,Y={id:z,properties:A.properties,type:A.type,sourceLayerIndex:N,index:B,geometry:Z?X.geometry:F(A,s,h),patterns:{},sortKey:q};g.push(Y)}l&&g.sort((A,z)=>A.sortKey-z.sortKey);const{lineAtlas:E,featureIndex:D}=i,T=this.addConstantDashes(E);for(const A of g){const{geometry:z,index:B,sourceLayerIndex:N}=A;if(T&&this.addFeatureDashes(A,E),this.hasPattern){const Z=kp("line",this.layers,A,this.zoom,this.pixelRatio,i);this.patternFeatures.push(Z)}else this.addFeature(A,z,B,s,E.positions,i.availableImages,i.brightness);D.insert(e[B].feature,z,B,N,this.index)}}addConstantDashes(e){let i=!1;for(const s of this.layers){const h=s.paint.get("line-dasharray").value,l=s.layout.get("line-cap").value;if(h.kind!=="constant"||l.kind!=="constant")i=!0;else{const d=l.value,v=h.value;if(!v)continue;e.addDash(v,d)}}return i}addFeatureDashes(e,i){const s=this.zoom;for(const h of this.layers){const l=h.paint.get("line-dasharray").value,d=h.layout.get("line-cap").value;if(l.kind==="constant"&&d.kind==="constant")continue;let v,S;if(l.kind==="constant"){if(v=l.value,!v)continue}else v=l.evaluate({zoom:s},e);S=d.kind==="constant"?d.value:d.evaluate({zoom:s},e),i.addDash(v,S),e.patterns[h.id]=i.getKey(v,S)}}update(e,i,s,h,l,d,v){this.programConfigurations.updatePaintArrays(e,i,l,s,h,d,v)}addFeatures(e,i,s,h,l,d){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,i,s,h,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Ky)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,ev)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,Qy.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Cg),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,s,h,l,d,v){const S=this.layers[0].layout,R=S.get("line-join").evaluate(e,{}),g=S.get("line-cap").evaluate(e,{}),E=S.get("line-miter-limit"),D=S.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e,this.zOffsetValue=S.get("line-z-offset").value;const T=this.layers[0].paint.get("line-width").value;T.kind!=="constant"&&T.isLineProgressConstant===!1&&(this.variableWidthValue=T);for(const A of i)this.addLine(A,e,h,R,g,E,D);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,l,d,h,v)}addLine(e,i,s,h,l,d,v){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const S=h==="none";if(this.patternJoinNone=this.hasPattern&&S,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let X=0;X<e.length-1;X++)this.totalDistance+=e[X].dist(e[X+1]);this.totalFeatureLength=this.totalDistance/(this.lineClips.end-this.lineClips.start),this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const R=Wp[i.type]==="Polygon";let g=e.length;for(;g>=2&&e[g-1].equals(e[g-2]);)g--;let E=0;for(;E<g-1&&e[E].equals(e[E+1]);)E++;if(g<(R?3:2))return;h==="bevel"&&(d=1.05);const D=this.segments.prepareSegment(10*g,this.layoutVertexArray,this.indexArray);let T,A,z,B,N,Z;this.e1=this.e2=-1,R&&(T=e[g-2],N=e[E].sub(T)._unit()._perp());for(let X=E;X<g;X++){if(z=X===g-1?R?e[E+1]:void 0:e[X+1],z&&e[X].equals(z))continue;N&&(B=N),T&&(A=T),T=e[X],Z=this.evaluateLineProgressFeatures(A?A.dist(T):0),N=z?z.sub(T)._unit()._perp():B,B=B||N;const q=A&&z;let Y=q?h:R||S?"butt":l;const K=B.x*N.x+B.y*N.y;if(S){const Ce=function(Me){if(Me.patternJoinNone){const Le=Me.segmentPoints.length/2,ke=Me.lineSoFar-Me.segmentStart;for(let Ue=0;Ue<Le;++Ue){const Pe=Me.segmentPoints[2*Ue+1],at=Math.round(Me.segmentPoints[2*Ue])+.5+.25*Pe;Me.patternVertexArray.emplaceBack(at,ke,Me.segmentStart),Me.patternVertexArray.emplaceBack(at,ke,Me.segmentStart)}Me.segmentPoints.length=0}Me.e1=Me.e2=-1};if(q&&K<tv){this.updateDistance(A,T),this.addCurrentVertex(T,B,1,1,D,Z),Ce(this),this.addCurrentVertex(T,N,-1,-1,D,Z);continue}if(A){if(!z){this.updateDistance(A,T),this.addCurrentVertex(T,B,1,1,D,Z),Ce(this);continue}Y="miter"}}let re=B.add(N);re.x===0&&re.y===0||re._unit();const he=re.x*N.x+re.y*N.y,ue=he!==0?1/he:1/0,ce=2*Math.sqrt(2-2*he),Te=he<i_&&A&&z,de=B.x*N.y-B.y*N.x>0,Se=this.overscaling<=16?15*zt/(512*this.overscaling):0;if(q&&Y==="round"){if(ue<v)Y="miter";else if(ue<=2){const Ce=r_(T,-10,zt+10);Y=this.hasZOffset&&(Ce||this.hasCrossSlope)?"miter":"fakeround"}}if(Y==="miter"&&ue>d&&(Y="bevel"),Y==="bevel"&&(ue>2&&(Y="flipbevel"),ue<d&&(Y="miter")),A&&!(Y==="miter"&&Te)&&this.updateDistance(A,T),Y==="miter")if(Te){const Ce=T.dist(A);if(Ce>2*Se){const Le=T.sub(T.sub(A)._mult(Se/Ce)._round());this.updateDistance(A,Le),this.addCurrentVertex(Le,B,0,0,D,Z),A=Le}this.updateDistance(A,T),re._mult(ue),this.addCurrentVertex(T,re,0,0,D,Z);const Me=T.dist(z);if(Me>2*Se){const Le=T.add(z.sub(T)._mult(Se/Me)._round());this.updateDistance(T,Le),this.addCurrentVertex(Le,N,0,0,D,Z),T=Le}}else re._mult(ue),this.addCurrentVertex(T,re,0,0,D,Z);else if(Y==="flipbevel"){if(ue>100)re=N.mult(-1);else{const Ce=ue*B.add(N).mag()/B.sub(N).mag();re._perp()._mult(Ce*(de?-1:1))}this.addCurrentVertex(T,re,0,0,D,Z),this.addCurrentVertex(T,re.mult(-1),0,0,D,Z)}else if(Y==="bevel"||Y==="fakeround"){Z!=null&&A&&this.addCurrentVertex(T,B,-1,-1,D,Z);const Ce=T.dist(A)<=2*Se&&Y!=="bevel",Me=re.mult(de?1:-1);Me._mult(ue);const Le=N.mult(de?-1:1),ke=B.mult(de?-1:1),Ue=this.evaluateLineProgressFeatures(this.distance);if(Z==null&&(this.addHalfVertex(T,Me.x,Me.y,!1,!de,0,D,Ue),Ce||this.addHalfVertex(T,Me.x+2*ke.x,Me.y+2*ke.y,!1,de,0,D,Ue)),Y==="fakeround"){const Pe=Math.round(180*ce/Math.PI/20);this.addHalfVertex(T,ke.x,ke.y,!1,de,0,D,Ue);for(let at=0;at<Pe;at++){let mt=at/Pe;if(mt!==.5){const Bt=mt-.5;mt+=mt*Bt*(mt-1)*((1.0904+K*(K*(3.55645-1.43519*K)-3.2452))*Bt*Bt+(.848013+K*(.215638*K-1.06021)))}const nt=Le.sub(ke)._mult(mt)._add(ke)._unit();this.addHalfVertex(T,nt.x,nt.y,!1,de,0,D,Ue)}this.addHalfVertex(T,Le.x,Le.y,!1,de,0,D,Ue)}Ce||Z!=null||this.addHalfVertex(T,Me.x+2*Le.x,Me.y+2*Le.y,!1,de,0,D,Ue),Z!=null&&z&&this.addCurrentVertex(T,N,1,1,D,Z)}else Y==="butt"?this.addCurrentVertex(T,re,0,0,D,Z):Y==="square"?(A||this.addCurrentVertex(T,re,-1,-1,D,Z),this.addCurrentVertex(T,re,0,0,D,Z),A&&this.addCurrentVertex(T,re,1,1,D,Z)):Y==="round"&&(A&&(this.addCurrentVertex(T,B,0,0,D,Z),this.addCurrentVertex(T,B,1,1,D,Z,!0)),z&&(this.addCurrentVertex(T,N,-1,-1,D,Z,!0),this.addCurrentVertex(T,N,0,0,D,Z)))}}addVerticesTo(e,i,s,h,l,d,v,S,R,g){const E=(i.w-e.w)/this.tessellationStep|0;let D=0;const T=this.scaledDistance;if(E>1){this.lineSoFar=e.w;const z=(i.x-e.x)/E,B=(i.y-e.y)/E,N=(i.z-e.z)/E,Z=(i.w-e.w)/E;for(let X=1;X<E;++X){e.x+=z,e.y+=B,e.z+=N,this.lineSoFar+=Z,D+=Z;const q=this.evaluateLineProgressFeatures(this.prevDistance+D);this.scaledDistance=(this.prevDistance+D)/this.totalDistance,this.addHalfVertex(e,s,h,g,!1,v,R,q),this.addHalfVertex(e,l,d,g,!0,-S,R,q)}}this.lineSoFar=i.w,this.scaledDistance=T;const A=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(i,s,h,g,!1,v,R,A),this.addHalfVertex(i,l,d,g,!0,-S,R,A)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&!this.hasZOffset)return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):Ri(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let i=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(i=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.hasZOffset?this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:i}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:i}:{zOffset:0,variableWidth:i}}addCurrentVertex(e,i,s,h,l,d,v=!1){const S=i.x+i.y*s,R=i.y-i.x*s,g=i.y*h-i.x,E=-i.y-i.x*h;if(d!=null){const D=this.hasZOffset,T=-10,A=zt+10,z=d.zOffset,B=new Kr(e.x,e.y,z,this.lineSoFar),N=!!D&&r_(e,T,A),Z=this.lineSoFar,X=this.distance;if(this.currentVertex)if(N){const q=this.currentVertexIsOutside,Y=this.currentVertex,K=new Kr(e.x,e.y,z,this.lineSoFar);if(gg(Y,K,T,A),!r_(K,T,A)){if(q){this.e1=this.e2=-1,this.distance-=Y.dist(B),this.lineSoFar=Y.w;const re=this.evaluateLineProgressFeatures(Y.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Y,S,R,v,!1,s,l,re),this.addHalfVertex(Y,g,E,v,!0,-h,l,re),this.prevDistance=this.distance}this.distance=this.prevDistance+Y.dist(K),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(Y,K,S,R,g,E,s,h,l,v),this.distance=X,this.scaledDistance=this.distance/this.totalDistance}}else{const q=this.currentVertex;if(this.currentVertexIsOutside){gg(q,B,T,A),this.e1=this.e2=-1,this.distance-=q.dist(B),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=q.w;const Y=this.evaluateLineProgressFeatures(q.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(q,S,R,v,!1,s,l,Y),this.addHalfVertex(q,g,E,v,!0,-h,l,Y),this.prevDistance=this.distance,this.distance=X,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(q,B,S,R,g,E,s,h,l,v)}else N||(this.addHalfVertex(e,S,R,v,!1,s,l,d),this.addHalfVertex(e,g,E,v,!0,-h,l,d));this.currentVertex=B,this.currentVertexIsOutside=N,this.lineSoFar=Z}else this.addHalfVertex(e,S,R,v,!1,s,l,d),this.addHalfVertex(e,g,E,v,!0,-h,l,d)}addHalfVertex({x:e,y:i},s,h,l,d,v,S,R){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),d||this.segmentPoints.push(this.lineSoFar-this.segmentStart,v)),this.layoutVertexArray.emplaceBack((e<<1)+(l?1:0),(i<<1)+(d?1:0),Math.round(63*s)+128,Math.round(63*h)+128,1+(v===0?0:v<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const E=di(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,E)}const g=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,g),S.primitiveLength++),d?this.e2=g:this.e1=g,R!=null&&this.zOffsetVertexArray.emplaceBack(R.zOffset,R.variableWidth,R.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,i){this.prevDistance=this.distance,this.distance+=e.dist(i),this.updateScaledDistance()}}function r_(a,e,i){return a.x<e||a.x>i||a.y<e||a.y>i}let n_,a_;function s_(a,e,i){return e*(zt/(a.tileSize*Math.pow(2,i-a.tileID.overscaledZ)))}Zt(zh,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const o_=(a,e,i)=>(1-i)*a+i*e;function $p(a,e){return 1/s_(a,1,e.tileZoom)}function l_(a,e,i,s){return a.translatePosMatrix(s||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const jd=a=>{const e=[];Dg(a)&&e.push("RENDER_LINE_DASH"),a.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const i=a.paint.get("line-trim-offset");i[0]===0&&i[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),a.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const s=a.layout.get("line-join").constantOr("miter")==="none",h=!!a.paint.get("line-pattern").constantOr(1);return s&&h&&e.push("LINE_JOIN_NONE"),e};function Dg(a){const e=a.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}let c_;const Qp=()=>c_||(c_={layout:n_||(n_=new jr({"line-cap":new Gt(Ge.layout_line["line-cap"]),"line-join":new Gt(Ge.layout_line["line-join"]),"line-miter-limit":new wt(Ge.layout_line["line-miter-limit"]),"line-round-limit":new wt(Ge.layout_line["line-round-limit"]),"line-sort-key":new Gt(Ge.layout_line["line-sort-key"]),"line-z-offset":new Gt(Ge.layout_line["line-z-offset"]),"line-elevation-reference":new wt(Ge.layout_line["line-elevation-reference"]),"line-cross-slope":new wt(Ge.layout_line["line-cross-slope"]),visibility:new wt(Ge.layout_line.visibility),"line-width-unit":new wt(Ge.layout_line["line-width-unit"])})),paint:a_||(a_=new jr({"line-opacity":new Gt(Ge.paint_line["line-opacity"]),"line-color":new Gt(Ge.paint_line["line-color"]),"line-translate":new wt(Ge.paint_line["line-translate"]),"line-translate-anchor":new wt(Ge.paint_line["line-translate-anchor"]),"line-width":new Gt(Ge.paint_line["line-width"]),"line-gap-width":new Gt(Ge.paint_line["line-gap-width"]),"line-offset":new Gt(Ge.paint_line["line-offset"]),"line-blur":new Gt(Ge.paint_line["line-blur"]),"line-dasharray":new Gt(Ge.paint_line["line-dasharray"]),"line-pattern":new Gt(Ge.paint_line["line-pattern"]),"line-gradient":new uc(Ge.paint_line["line-gradient"]),"line-trim-offset":new wt(Ge.paint_line["line-trim-offset"]),"line-trim-fade-range":new wt(Ge.paint_line["line-trim-fade-range"]),"line-trim-color":new wt(Ge.paint_line["line-trim-color"]),"line-emissive-strength":new wt(Ge.paint_line["line-emissive-strength"]),"line-border-width":new Gt(Ge.paint_line["line-border-width"]),"line-border-color":new Gt(Ge.paint_line["line-border-color"]),"line-occlusion-opacity":new wt(Ge.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"})}))},c_);class u_ extends Gt{possiblyEvaluate(e,i){return i=new wr(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,transition:i.transition}),super.possiblyEvaluate(e,i)}evaluate(e,i,s,h){return i=Fn({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(e,i,s,h)}}let Tu;function Kp(a,e){return e>0?e+2*a:a}const Ig=cr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),h_=cr([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Su=cr([{name:"a_projected_pos",components:4,type:"Float32"}],4);cr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Eu=cr([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),Mu=cr([{name:"a_texb",components:2,type:"Uint16"}]),qd=cr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),Gd=cr([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);cr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const wc=cr([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),iv=cr([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);cr([{name:"triangle",components:3,type:"Uint16"}]),cr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),cr([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),cr([{type:"Float32",name:"offsetX"}]),cr([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var la=24;const ls=128;function f_(a,e,i,s,h){if(a.kind==="camera")return a.maxSize;if(a.kind==="composite"){const l=e.possiblyEvaluate(new wr(a.maxZoom),i).evaluate(h,{},i),d=e.possiblyEvaluate(new wr(a.minZoom),i).evaluate(h,{},i);return Math.max(l,d)}return e.possiblyEvaluate(new wr(s)).evaluate(h,{},i)}function Jp(a,e){const{expression:i}=e;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new wr(a+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:s,interpolationType:h}=i;let l=0;for(;l<s.length&&s[l]<=a;)l++;l=Math.max(0,l-1);let d=l;for(;d<s.length&&s[d]<a+1;)d++;d=Math.min(s.length-1,d);const v=s[l],S=s[d];return i.kind==="composite"?{kind:"composite",minZoom:v,maxZoom:S,interpolationType:h}:{kind:"camera",minZoom:v,maxZoom:S,minSize:i.evaluate(new wr(v)),maxSize:i.evaluate(new wr(S)),interpolationType:h}}}function Oh(a,{uSize:e,uSizeT:i},{lowerSize:s,upperSize:h}){return a.kind==="source"?s/ls:a.kind==="composite"?di(s/ls,h/ls,i):e}function Lh(a,e,i=1){let s=0,h=0;if(a.kind==="constant")h=a.layoutSize*i;else if(a.kind!=="source"){const{interpolationType:l,minZoom:d,maxZoom:v}=a,S=l?Mi(Zr.interpolationFactor(l,e,d,v),0,1):0;a.kind==="camera"?h=di(a.minSize,a.maxSize,S)*i:s=S*i}return{uSizeT:s,uSize:h}}var rv=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:ls,evaluateSizeForFeature:Oh,evaluateSizeForZoom:Lh,getRasterizedIconSize:f_,getSizeData:Jp});function em(a,e,i){return a.sections.forEach(s=>{s.text=function(h,l,d){const v=l.layout.get("text-transform").evaluate(d,{});return v==="uppercase"?h=h.toLocaleUpperCase():v==="lowercase"&&(h=h.toLocaleLowerCase()),Pr.applyArabicShaping&&(h=Pr.applyArabicShaping(h)),h}(s.text,e,i)}),a}const Au={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function Rg(a){return a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""}function Hd(a){return a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""}var tm,Lf,d_,p_={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function im(){return tm||(tm=1,p_.read=function(a,e,i,s,h){var l,d,v=8*h-s-1,S=(1<<v)-1,R=S>>1,g=-7,E=i?h-1:0,D=i?-1:1,T=a[e+E];for(E+=D,l=T&(1<<-g)-1,T>>=-g,g+=v;g>0;l=256*l+a[e+E],E+=D,g-=8);for(d=l&(1<<-g)-1,l>>=-g,g+=s;g>0;d=256*d+a[e+E],E+=D,g-=8);if(l===0)l=1-R;else{if(l===S)return d?NaN:1/0*(T?-1:1);d+=Math.pow(2,s),l-=R}return(T?-1:1)*d*Math.pow(2,l-s)},p_.write=function(a,e,i,s,h,l){var d,v,S,R=8*l-h-1,g=(1<<R)-1,E=g>>1,D=h===23?Math.pow(2,-24)-Math.pow(2,-77):0,T=s?0:l-1,A=s?1:-1,z=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(v=isNaN(e)?1:0,d=g):(d=Math.floor(Math.log(e)/Math.LN2),e*(S=Math.pow(2,-d))<1&&(d--,S*=2),(e+=d+E>=1?D/S:D*Math.pow(2,1-E))*S>=2&&(d++,S/=2),d+E>=g?(v=0,d=g):d+E>=1?(v=(e*S-1)*Math.pow(2,h),d+=E):(v=e*Math.pow(2,E-1)*Math.pow(2,h),d=0));h>=8;a[i+T]=255&v,T+=A,v/=256,h-=8);for(d=d<<h|v,R+=h;R>0;a[i+T]=255&d,T+=A,d/=256,R-=8);a[i+T-A]|=128*z}),p_}function o(){if(d_)return Lf;d_=1,Lf=e;var a=im();function e(q){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(q)?q:new Uint8Array(q||0),this.pos=0,this.type=0,this.length=this.buf.length}e.Varint=0,e.Fixed64=1,e.Bytes=2,e.Fixed32=5;var i=4294967296,s=1/i,h=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function l(q){return q.type===e.Bytes?q.readVarint()+q.pos:q.pos+1}function d(q,Y,K){return K?4294967296*Y+(q>>>0):4294967296*(Y>>>0)+(q>>>0)}function v(q,Y,K){var re=Y<=16383?1:Y<=2097151?2:Y<=268435455?3:Math.floor(Math.log(Y)/(7*Math.LN2));K.realloc(re);for(var he=K.pos-1;he>=q;he--)K.buf[he+re]=K.buf[he]}function S(q,Y){for(var K=0;K<q.length;K++)Y.writeVarint(q[K])}function R(q,Y){for(var K=0;K<q.length;K++)Y.writeSVarint(q[K])}function g(q,Y){for(var K=0;K<q.length;K++)Y.writeFloat(q[K])}function E(q,Y){for(var K=0;K<q.length;K++)Y.writeDouble(q[K])}function D(q,Y){for(var K=0;K<q.length;K++)Y.writeBoolean(q[K])}function T(q,Y){for(var K=0;K<q.length;K++)Y.writeFixed32(q[K])}function A(q,Y){for(var K=0;K<q.length;K++)Y.writeSFixed32(q[K])}function z(q,Y){for(var K=0;K<q.length;K++)Y.writeFixed64(q[K])}function B(q,Y){for(var K=0;K<q.length;K++)Y.writeSFixed64(q[K])}function N(q,Y){return(q[Y]|q[Y+1]<<8|q[Y+2]<<16)+16777216*q[Y+3]}function Z(q,Y,K){q[K]=Y,q[K+1]=Y>>>8,q[K+2]=Y>>>16,q[K+3]=Y>>>24}function X(q,Y){return(q[Y]|q[Y+1]<<8|q[Y+2]<<16)+(q[Y+3]<<24)}return e.prototype={destroy:function(){this.buf=null},readFields:function(q,Y,K){for(K=K||this.length;this.pos<K;){var re=this.readVarint(),he=re>>3,ue=this.pos;this.type=7&re,q(he,Y,this),this.pos===ue&&this.skip(re)}return Y},readMessage:function(q,Y){return this.readFields(q,Y,this.readVarint()+this.pos)},readFixed32:function(){var q=N(this.buf,this.pos);return this.pos+=4,q},readSFixed32:function(){var q=X(this.buf,this.pos);return this.pos+=4,q},readFixed64:function(){var q=N(this.buf,this.pos)+N(this.buf,this.pos+4)*i;return this.pos+=8,q},readSFixed64:function(){var q=N(this.buf,this.pos)+X(this.buf,this.pos+4)*i;return this.pos+=8,q},readFloat:function(){var q=a.read(this.buf,this.pos,!0,23,4);return this.pos+=4,q},readDouble:function(){var q=a.read(this.buf,this.pos,!0,52,8);return this.pos+=8,q},readVarint:function(q){var Y,K,re=this.buf;return Y=127&(K=re[this.pos++]),K<128?Y:(Y|=(127&(K=re[this.pos++]))<<7,K<128?Y:(Y|=(127&(K=re[this.pos++]))<<14,K<128?Y:(Y|=(127&(K=re[this.pos++]))<<21,K<128?Y:function(he,ue,ce){var Te,de,Se=ce.buf;if(Te=(112&(de=Se[ce.pos++]))>>4,de<128||(Te|=(127&(de=Se[ce.pos++]))<<3,de<128)||(Te|=(127&(de=Se[ce.pos++]))<<10,de<128)||(Te|=(127&(de=Se[ce.pos++]))<<17,de<128)||(Te|=(127&(de=Se[ce.pos++]))<<24,de<128)||(Te|=(1&(de=Se[ce.pos++]))<<31,de<128))return d(he,Te,ue);throw new Error("Expected varint not more than 10 bytes")}(Y|=(15&(K=re[this.pos]))<<28,q,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var q=this.readVarint();return q%2==1?(q+1)/-2:q/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var q=this.readVarint()+this.pos,Y=this.pos;return this.pos=q,q-Y>=12&&h?function(K,re,he){return h.decode(K.subarray(re,he))}(this.buf,Y,q):function(K,re,he){for(var ue="",ce=re;ce<he;){var Te,de,Se,Ce=K[ce],Me=null,Le=Ce>239?4:Ce>223?3:Ce>191?2:1;if(ce+Le>he)break;Le===1?Ce<128&&(Me=Ce):Le===2?(192&(Te=K[ce+1]))==128&&(Me=(31&Ce)<<6|63&Te)<=127&&(Me=null):Le===3?(de=K[ce+2],(192&(Te=K[ce+1]))==128&&(192&de)==128&&((Me=(15&Ce)<<12|(63&Te)<<6|63&de)<=2047||Me>=55296&&Me<=57343)&&(Me=null)):Le===4&&(de=K[ce+2],Se=K[ce+3],(192&(Te=K[ce+1]))==128&&(192&de)==128&&(192&Se)==128&&((Me=(15&Ce)<<18|(63&Te)<<12|(63&de)<<6|63&Se)<=65535||Me>=1114112)&&(Me=null)),Me===null?(Me=65533,Le=1):Me>65535&&(Me-=65536,ue+=String.fromCharCode(Me>>>10&1023|55296),Me=56320|1023&Me),ue+=String.fromCharCode(Me),ce+=Le}return ue}(this.buf,Y,q)},readBytes:function(){var q=this.readVarint()+this.pos,Y=this.buf.subarray(this.pos,q);return this.pos=q,Y},readPackedVarint:function(q,Y){if(this.type!==e.Bytes)return q.push(this.readVarint(Y));var K=l(this);for(q=q||[];this.pos<K;)q.push(this.readVarint(Y));return q},readPackedSVarint:function(q){if(this.type!==e.Bytes)return q.push(this.readSVarint());var Y=l(this);for(q=q||[];this.pos<Y;)q.push(this.readSVarint());return q},readPackedBoolean:function(q){if(this.type!==e.Bytes)return q.push(this.readBoolean());var Y=l(this);for(q=q||[];this.pos<Y;)q.push(this.readBoolean());return q},readPackedFloat:function(q){if(this.type!==e.Bytes)return q.push(this.readFloat());var Y=l(this);for(q=q||[];this.pos<Y;)q.push(this.readFloat());return q},readPackedDouble:function(q){if(this.type!==e.Bytes)return q.push(this.readDouble());var Y=l(this);for(q=q||[];this.pos<Y;)q.push(this.readDouble());return q},readPackedFixed32:function(q){if(this.type!==e.Bytes)return q.push(this.readFixed32());var Y=l(this);for(q=q||[];this.pos<Y;)q.push(this.readFixed32());return q},readPackedSFixed32:function(q){if(this.type!==e.Bytes)return q.push(this.readSFixed32());var Y=l(this);for(q=q||[];this.pos<Y;)q.push(this.readSFixed32());return q},readPackedFixed64:function(q){if(this.type!==e.Bytes)return q.push(this.readFixed64());var Y=l(this);for(q=q||[];this.pos<Y;)q.push(this.readFixed64());return q},readPackedSFixed64:function(q){if(this.type!==e.Bytes)return q.push(this.readSFixed64());var Y=l(this);for(q=q||[];this.pos<Y;)q.push(this.readSFixed64());return q},skip:function(q){var Y=7&q;if(Y===e.Varint)for(;this.buf[this.pos++]>127;);else if(Y===e.Bytes)this.pos=this.readVarint()+this.pos;else if(Y===e.Fixed32)this.pos+=4;else{if(Y!==e.Fixed64)throw new Error("Unimplemented type: "+Y);this.pos+=8}},writeTag:function(q,Y){this.writeVarint(q<<3|Y)},realloc:function(q){for(var Y=this.length||16;Y<this.pos+q;)Y*=2;if(Y!==this.length){var K=new Uint8Array(Y);K.set(this.buf),this.buf=K,this.length=Y}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(q){this.realloc(4),Z(this.buf,q,this.pos),this.pos+=4},writeSFixed32:function(q){this.realloc(4),Z(this.buf,q,this.pos),this.pos+=4},writeFixed64:function(q){this.realloc(8),Z(this.buf,-1&q,this.pos),Z(this.buf,Math.floor(q*s),this.pos+4),this.pos+=8},writeSFixed64:function(q){this.realloc(8),Z(this.buf,-1&q,this.pos),Z(this.buf,Math.floor(q*s),this.pos+4),this.pos+=8},writeVarint:function(q){(q=+q||0)>268435455||q<0?function(Y,K){var re,he;if(Y>=0?(re=Y%4294967296|0,he=Y/4294967296|0):(he=~(-Y/4294967296),4294967295^(re=~(-Y%4294967296))?re=re+1|0:(re=0,he=he+1|0)),Y>=18446744073709552e3||Y<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");K.realloc(10),function(ue,ce,Te){Te.buf[Te.pos++]=127&ue|128,ue>>>=7,Te.buf[Te.pos++]=127&ue|128,ue>>>=7,Te.buf[Te.pos++]=127&ue|128,ue>>>=7,Te.buf[Te.pos++]=127&ue|128,Te.buf[Te.pos]=127&(ue>>>=7)}(re,0,K),function(ue,ce){var Te=(7&ue)<<4;ce.buf[ce.pos++]|=Te|((ue>>>=3)?128:0),ue&&(ce.buf[ce.pos++]=127&ue|((ue>>>=7)?128:0),ue&&(ce.buf[ce.pos++]=127&ue|((ue>>>=7)?128:0),ue&&(ce.buf[ce.pos++]=127&ue|((ue>>>=7)?128:0),ue&&(ce.buf[ce.pos++]=127&ue|((ue>>>=7)?128:0),ue&&(ce.buf[ce.pos++]=127&ue)))))}(he,K)}(q,this):(this.realloc(4),this.buf[this.pos++]=127&q|(q>127?128:0),q<=127||(this.buf[this.pos++]=127&(q>>>=7)|(q>127?128:0),q<=127||(this.buf[this.pos++]=127&(q>>>=7)|(q>127?128:0),q<=127||(this.buf[this.pos++]=q>>>7&127))))},writeSVarint:function(q){this.writeVarint(q<0?2*-q-1:2*q)},writeBoolean:function(q){this.writeVarint(!!q)},writeString:function(q){q=String(q),this.realloc(4*q.length),this.pos++;var Y=this.pos;this.pos=function(re,he,ue){for(var ce,Te,de=0;de<he.length;de++){if((ce=he.charCodeAt(de))>55295&&ce<57344){if(!Te){ce>56319||de+1===he.length?(re[ue++]=239,re[ue++]=191,re[ue++]=189):Te=ce;continue}if(ce<56320){re[ue++]=239,re[ue++]=191,re[ue++]=189,Te=ce;continue}ce=Te-55296<<10|ce-56320|65536,Te=null}else Te&&(re[ue++]=239,re[ue++]=191,re[ue++]=189,Te=null);ce<128?re[ue++]=ce:(ce<2048?re[ue++]=ce>>6|192:(ce<65536?re[ue++]=ce>>12|224:(re[ue++]=ce>>18|240,re[ue++]=ce>>12&63|128),re[ue++]=ce>>6&63|128),re[ue++]=63&ce|128)}return ue}(this.buf,q,this.pos);var K=this.pos-Y;K>=128&&v(Y,K,this),this.pos=Y-1,this.writeVarint(K),this.pos+=K},writeFloat:function(q){this.realloc(4),a.write(this.buf,q,this.pos,!0,23,4),this.pos+=4},writeDouble:function(q){this.realloc(8),a.write(this.buf,q,this.pos,!0,52,8),this.pos+=8},writeBytes:function(q){var Y=q.length;this.writeVarint(Y),this.realloc(Y);for(var K=0;K<Y;K++)this.buf[this.pos++]=q[K]},writeRawMessage:function(q,Y){this.pos++;var K=this.pos;q(Y,this);var re=this.pos-K;re>=128&&v(K,re,this),this.pos=K-1,this.writeVarint(re),this.pos+=re},writeMessage:function(q,Y,K){this.writeTag(q,e.Bytes),this.writeRawMessage(Y,K)},writePackedVarint:function(q,Y){Y.length&&this.writeMessage(q,S,Y)},writePackedSVarint:function(q,Y){Y.length&&this.writeMessage(q,R,Y)},writePackedBoolean:function(q,Y){Y.length&&this.writeMessage(q,D,Y)},writePackedFloat:function(q,Y){Y.length&&this.writeMessage(q,g,Y)},writePackedDouble:function(q,Y){Y.length&&this.writeMessage(q,E,Y)},writePackedFixed32:function(q,Y){Y.length&&this.writeMessage(q,T,Y)},writePackedSFixed32:function(q,Y){Y.length&&this.writeMessage(q,A,Y)},writePackedFixed64:function(q,Y){Y.length&&this.writeMessage(q,z,Y)},writePackedSFixed64:function(q,Y){Y.length&&this.writeMessage(q,B,Y)},writeBytesField:function(q,Y){this.writeTag(q,e.Bytes),this.writeBytes(Y)},writeFixed32Field:function(q,Y){this.writeTag(q,e.Fixed32),this.writeFixed32(Y)},writeSFixed32Field:function(q,Y){this.writeTag(q,e.Fixed32),this.writeSFixed32(Y)},writeFixed64Field:function(q,Y){this.writeTag(q,e.Fixed64),this.writeFixed64(Y)},writeSFixed64Field:function(q,Y){this.writeTag(q,e.Fixed64),this.writeSFixed64(Y)},writeVarintField:function(q,Y){this.writeTag(q,e.Varint),this.writeVarint(Y)},writeSVarintField:function(q,Y){this.writeTag(q,e.Varint),this.writeSVarint(Y)},writeStringField:function(q,Y){this.writeTag(q,e.Bytes),this.writeString(Y)},writeFloatField:function(q,Y){this.writeTag(q,e.Fixed32),this.writeFloat(Y)},writeDoubleField:function(q,Y){this.writeTag(q,e.Fixed64),this.writeDouble(Y)},writeBooleanField:function(q,Y){this.writeVarintField(q,!!Y)}},Lf}var f=ae(o());const y=3;function I(a,e,i){e.glyphs=[],a===1&&i.readMessage(k,e)}function k(a,e,i){if(a===3){const{id:s,bitmap:h,width:l,height:d,left:v,top:S,advance:R}=i.readMessage(G,{});e.glyphs.push({id:s,bitmap:new xc({width:l+2*y,height:d+2*y},h),metrics:{width:l,height:d,left:v,top:S,advance:R}})}else a===4?e.ascender=i.readSVarint():a===5&&(e.descender=i.readSVarint())}function G(a,e,i){a===1?e.id=i.readVarint():a===2?e.bitmap=i.readBytes():a===3?e.width=i.readVarint():a===4?e.height=i.readVarint():a===5?e.left=i.readSVarint():a===6?e.top=i.readSVarint():a===7&&(e.advance=i.readVarint())}const se=y,xe={horizontal:1,vertical:2,horizontalOnly:3};class Ne{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,i){const s=new Ne;return s.scale=e||1,s.fontStack=i,s}static forImage(e){const i=new Ne;return i.image=e,i}}class ot{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i){const s=new ot;for(let h=0;h<e.sections.length;h++){const l=e.sections[h];l.image?s.addImageSection(l):s.addTextSection(l,i)}return s}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(i,s){let h="";for(let l=0;l<i.length;l++){const d=i.charCodeAt(l+1)||null,v=i.charCodeAt(l-1)||null;h+=!s&&(d&&Uo(d)&&!Au[i[l+1]]||v&&Uo(v)&&!Au[i[l-1]])||!Au[i[l]]?i[l]:Au[i[l]]}return h}(this.text,e)}trim(){let e=0;for(let s=0;s<this.text.length&&$t[this.text.charCodeAt(s)];s++)e++;let i=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&$t[this.text.charCodeAt(s)];s--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const s=new ot;return s.text=this.text.substring(e,i),s.sectionIndex=this.sectionIndex.slice(e,i),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(Ne.forText(e.scale,e.fontStack||i));const s=this.sections.length-1;for(let h=0;h<e.text.length;++h)this.sectionIndex.push(s)}addImageSection(e){const i=e.image&&e.image.namePrimary?e.image.getPrimary():null;if(!i)return void Ri("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCodePoint(s),this.sections.push(Ne.forImage(i)),this.sectionIndex.push(this.sections.length-1)):Ri("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Pt(a,e,i,s,h,l,d,v,S,R,g,E,D,T,A){const z=ot.fromFeature(a,h);E===xe.vertical&&z.verticalizePunctuation(D);let B=[];const N=function(K,re,he,ue,ce,Te){if(!K)return[];const de=[],Se=function(ke,Ue,Pe,at,mt,nt){let Bt=0;for(let Ot=0;Ot<ke.length();Ot++){const bt=ke.getSection(Ot);Bt+=Lt(ke.getCodePoint(Ot),bt,at,mt,Ue,nt)}return Bt/Math.max(1,Math.ceil(Bt/Pe))}(K,re,he,ue,ce,Te),Ce=K.text.indexOf("")>=0;let Me=0;for(let ke=0;ke<K.length();ke++){const Ue=K.getSection(ke),Pe=K.getCodePoint(ke);if($t[Pe]||(Me+=Lt(Pe,Ue,ue,ce,re,Te)),ke<K.length()-1){const at=!((Le=Pe)<11904||!(It["Bopomofo Extended"](Le)||It.Bopomofo(Le)||It["CJK Compatibility Forms"](Le)||It["CJK Compatibility Ideographs"](Le)||It["CJK Compatibility"](Le)||It["CJK Radicals Supplement"](Le)||It["CJK Strokes"](Le)||It["CJK Symbols and Punctuation"](Le)||It["CJK Unified Ideographs Extension A"](Le)||It["CJK Unified Ideographs"](Le)||It["Enclosed CJK Letters and Months"](Le)||It["Halfwidth and Fullwidth Forms"](Le)||It.Hiragana(Le)||It["Ideographic Description Characters"](Le)||It["Kangxi Radicals"](Le)||It["Katakana Phonetic Extensions"](Le)||It.Katakana(Le)||It["Vertical Forms"](Le)||It["Yi Radicals"](Le)||It["Yi Syllables"](Le)));(xt[Pe]||at||Ue.image)&&de.push(En(ke+1,Me,Se,de,dr(Pe,K.getCodePoint(ke+1),at&&Ce),!1))}}var Le;return ft(En(K.length(),Me,Se,de,0,!0))}(z,R,l,e,s,T),{processBidirectionalText:Z,processStyledBidirectionalText:X}=Pr;if(Z&&z.sections.length===1){const K=Z(z.toString(),N);for(const re of K){const he=new ot;he.text=re,he.sections=z.sections;for(let ue=0;ue<re.length;ue++)he.sectionIndex.push(0);B.push(he)}}else if(X){const K=X(z.text,z.sectionIndex,N);for(const re of K){const he=new ot;he.text=re[0],he.sectionIndex=re[1],he.sections=z.sections,B.push(he)}}else B=function(K,re){const he=[],ue=K.text;let ce=0;for(const Te of re)he.push(K.substring(ce,Te)),ce=Te;return ce<ue.length&&he.push(K.substring(ce,ue.length)),he}(z,N);const q=[],Y={positionedLines:q,text:z.toString(),top:g[1],bottom:g[1],left:g[0],right:g[0],writingMode:E,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(K,re,he,ue,ce,Te,de,Se,Ce,Me,Le,ke){let Ue=0,Pe=0,at=0;const mt=Se==="right"?1:Se==="left"?0:.5;let nt=!1;for(const jt of ce){const Wt=jt.getSections();for(const Ti of Wt){if(Ti.image)continue;const zi=re[Ti.fontStack];if(zi&&(nt=zi.ascender!==void 0&&zi.descender!==void 0,!nt))break}if(!nt)break}let Bt=0;for(const jt of ce){jt.trim();const Wt=jt.getMaxScale(),Ti=(Wt-1)*la,zi={positionedGlyphs:[],lineOffset:0};K.positionedLines[Bt]=zi;const Pi=zi.positionedGlyphs;let ki=0;if(!jt.length()){Pe+=Te,++Bt;continue}let $i=0,Ki=0;for(let xr=0;xr<jt.length();xr++){const Ci=jt.getSection(xr),yr=jt.getSectionIndex(xr),vr=jt.getCodePoint(xr);let qr=Ci.scale,pn=null,An=null,mn=null,ln=la,vn=0;const Pn=!(Ce===xe.horizontal||!Le&&!Vo(vr)||Le&&($t[vr]||(Ot=vr,It.Arabic(Ot)||It["Arabic Supplement"](Ot)||It["Arabic Extended-A"](Ot)||It["Arabic Presentation Forms-A"](Ot)||It["Arabic Presentation Forms-B"](Ot))));if(Ci.image){const La=ue[Ci.image.serialize()];if(!La)continue;mn=Ci.image.id,K.iconsInText=K.iconsInText||!0,An=La.paddedRect;const Nr=La.displaySize;qr=qr*la/ke,pn={width:Nr[0],height:Nr[1],left:0,top:-3,advance:Pn?Nr[1]:Nr[0],localGlyph:!1},vn=nt?-pn.height*qr:Wt*la-17-Nr[1]*qr,ln=pn.advance;const Ks=(Pn?Nr[0]:Nr[1])*qr-la*Wt;Ks>0&&Ks>ki&&(ki=Ks)}else{const La=he[Ci.fontStack];if(!La)continue;La[vr]&&(An=La[vr]);const Nr=re[Ci.fontStack];if(!Nr)continue;const Ks=Nr.glyphs[vr];if(!Ks)continue;if(pn=Ks.metrics,ln=vr!==8203?la:0,nt){const Ac=Nr.ascender!==void 0?Math.abs(Nr.ascender):0,Ul=Nr.descender!==void 0?Math.abs(Nr.descender):0,jl=(Ac+Ul)*qr;$i<jl&&($i=jl,Ki=(Ac-Ul)/2*qr),vn=-Ac*qr}else vn=(Wt-qr)*la-17}Pn?(K.verticalizable=!0,Pi.push({glyph:vr,imageName:mn,x:Ue,y:Pe+vn,vertical:Pn,scale:qr,localGlyph:pn.localGlyph,fontStack:Ci.fontStack,sectionIndex:yr,metrics:pn,rect:An}),Ue+=ln*qr+Me):(Pi.push({glyph:vr,imageName:mn,x:Ue,y:Pe+vn,vertical:Pn,scale:qr,localGlyph:pn.localGlyph,fontStack:Ci.fontStack,sectionIndex:yr,metrics:pn,rect:An}),Ue+=pn.advance*qr+Me)}Pi.length!==0&&(at=Math.max(Ue-Me,at),nt?_t(Pi,mt,ki,Ki,Te*Wt/2):_t(Pi,mt,ki,0,Te/2)),Ue=0;const zr=Te*Wt+ki;zi.lineOffset=Math.max(ki,Ti),Pe+=zr,++Bt}var Ot;const bt=Pe,{horizontalAlign:yt,verticalAlign:ei}=rt(de);(function(jt,Wt,Ti,zi,Pi,ki){const $i=(Wt-Ti)*Pi,Ki=-ki*zi;for(const zr of jt)for(const xr of zr.positionedGlyphs)xr.x+=$i,xr.y+=Ki})(K.positionedLines,mt,yt,ei,at,bt),K.top+=-ei*bt,K.bottom=K.top+bt,K.left+=-yt*at,K.right=K.left+at,K.hasBaseline=nt}(Y,e,i,s,B,d,v,S,E,R,D,A),!function(K){for(const re of K)if(re.positionedGlyphs.length!==0)return!1;return!0}(q)&&Y}const $t={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},xt={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Lt(a,e,i,s,h,l){if(e.image){const d=s[e.image.serialize()];return d?d.displaySize[0]*e.scale*la/l+h:0}{const d=i[e.fontStack],v=d&&d.glyphs[a];return v?v.metrics.advance*e.scale+h:0}}function Li(a,e,i,s){const h=Math.pow(a-e,2);return s?a<e?h/2:2*h:h+Math.abs(i)*i}function dr(a,e,i){let s=0;return a===10&&(s-=1e4),i&&(s+=150),a!==40&&a!==65288||(s+=50),e!==41&&e!==65289||(s+=50),s}function En(a,e,i,s,h,l){let d=null,v=Li(e,i,h,l);for(const S of s){const R=Li(e-S.x,i,h,l)+S.badness;R<=v&&(d=S,v=R)}return{index:a,x:e,priorBreak:d,badness:v}}function ft(a){return a?ft(a.priorBreak).concat(a.index):[]}function rt(a){let e=.5,i=.5;switch(a){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function _t(a,e,i,s,h){if(!(e||i||s||h))return;const l=a.length-1,d=a[l],v=(d.x+d.metrics.advance*d.scale)*e;for(let S=0;S<=l;S++)a[S].x-=v,a[S].y+=i+s+h}function Ht(a,e,i,s){const{horizontalAlign:h,verticalAlign:l}=rt(s),d=i[0]-a.displaySize[0]*h,v=i[1]-a.displaySize[1]*l;return{imagePrimary:a,imageSecondary:e,top:v,bottom:v+a.displaySize[1],left:d,right:d+a.displaySize[0]}}function Ii(a,e,i,s,h,l){const d=a.imagePrimary;let v;if(d.content){const B=d.content,N=d.pixelRatio||1;v=[B[0]/N,B[1]/N,d.displaySize[0]-B[2]/N,d.displaySize[1]-B[3]/N]}const S=e.left*l,R=e.right*l;let g,E,D,T;i==="width"||i==="both"?(T=h[0]+S-s[3],E=h[0]+R+s[1]):(T=h[0]+(S+R-d.displaySize[0])/2,E=T+d.displaySize[0]);const A=e.top*l,z=e.bottom*l;return i==="height"||i==="both"?(g=h[1]+A-s[0],D=h[1]+z+s[2]):(g=h[1]+(A+z-d.displaySize[1])/2,D=g+d.displaySize[1]),{imagePrimary:d,imageSecondary:void 0,top:g,right:E,bottom:D,left:T,collisionPadding:v}}class ur extends Rt{constructor(e,i,s,h,l){super(e,i),this.angle=h,this.z=s,l!==void 0&&(this.segment=l)}clone(){return new ur(this.x,this.y,this.z,this.angle,this.segment)}}function Gi(a,e,i,s,h){if(e.segment===void 0)return!0;let l=e,d=e.segment+1,v=0;for(;v>-i/2;){if(d--,d<0)return!1;v-=a[d].dist(l),l=a[d]}v+=a[d].dist(a[d+1]),d++;const S=[];let R=0;for(;v<i/2;){const g=a[d],E=a[d+1];if(!E)return!1;let D=a[d-1].angleTo(g)-g.angleTo(E);for(D=Math.abs((D+3*Math.PI)%(2*Math.PI)-Math.PI),S.push({distance:v,angleDelta:D}),R+=D;v-S[0].distance>s;)R-=S.shift().angleDelta;if(R>h)return!1;d++,v+=g.dist(E)}return!0}function er(a){let e=0;for(let i=0;i<a.length-1;i++)e+=a[i].dist(a[i+1]);return e}function _a(a,e,i){return a?.6*e*i:0}function Br(a,e){return Math.max(a?a.right-a.left:0,e?e.right-e.left:0)}function Cu(a,e,i,s,h,l){const d=_a(i,h,l),v=Br(i,s)*l;let S=0;const R=er(a)/2;for(let g=0;g<a.length-1;g++){const E=a[g],D=a[g+1],T=E.dist(D);if(S+T>R){const A=(R-S)/T,z=di(E.x,D.x,A),B=di(E.y,D.y,A),N=new ur(z,B,0,D.angleTo(E),g);return!d||Gi(a,N,v,d,e)?N:void 0}S+=T}}function nv(a,e,i,s,h,l,d,v,S){const R=_a(s,l,d),g=Br(s,h),E=g*d,D=a[0].x===0||a[0].x===S||a[0].y===0||a[0].y===S;return e-E<e/4&&(e=E+e/4),mx(a,D?e/2*v%e:(g/2+2*l)*d*v%e,e,R,i,E,D,!1,S)}function mx(a,e,i,s,h,l,d,v,S){const R=l/2,g=er(a);let E=0,D=e-i,T=[];for(let A=0;A<a.length-1;A++){const z=a[A],B=a[A+1],N=z.dist(B),Z=B.angleTo(z);for(;D+i<E+N;){D+=i;const X=(D-E)/N,q=di(z.x,B.x,X),Y=di(z.y,B.y,X);if(q>=0&&q<S&&Y>=0&&Y<S&&D-R>=0&&D+R<=g){const K=new ur(q,Y,0,Z,A);s&&!Gi(a,K,l,s,h)||T.push(K)}}E+=N}return v||T.length||d||(T=mx(a,E/2,i,s,h,l,d,!0,S)),T}function _x(a,e,i,s,h){const l=[];for(let d=0;d<a.length;d++){const v=a[d];let S;for(let R=0;R<v.length-1;R++){let g=v[R],E=v[R+1];g.x<e&&E.x<e||(g.x<e?g=new Rt(e,g.y+(e-g.x)/(E.x-g.x)*(E.y-g.y))._round():E.x<e&&(E=new Rt(e,g.y+(e-g.x)/(E.x-g.x)*(E.y-g.y))._round()),g.y<i&&E.y<i||(g.y<i?g=new Rt(g.x+(i-g.y)/(E.y-g.y)*(E.x-g.x),i)._round():E.y<i&&(E=new Rt(g.x+(i-g.y)/(E.y-g.y)*(E.x-g.x),i)._round()),g.x>=s&&E.x>=s||(g.x>=s?g=new Rt(s,g.y+(s-g.x)/(E.x-g.x)*(E.y-g.y))._round():E.x>=s&&(E=new Rt(s,g.y+(s-g.x)/(E.x-g.x)*(E.y-g.y))._round()),g.y>=h&&E.y>=h||(g.y>=h?g=new Rt(g.x+(h-g.y)/(E.y-g.y)*(E.x-g.x),h)._round():E.y>=h&&(E=new Rt(g.x+(h-g.y)/(E.y-g.y)*(E.x-g.x),h)._round()),S&&g.equals(S[S.length-1])||(S=[g],l.push(S)),S.push(E)))))}}return l}function gx(a){let e=0,i=0;for(const d of a)e+=d.w*d.h,i=Math.max(i,d.w);a.sort((d,v)=>v.h-d.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let h=0,l=0;for(const d of a)for(let v=s.length-1;v>=0;v--){const S=s[v];if(!(d.w>S.w||d.h>S.h)){if(d.x=S.x,d.y=S.y,l=Math.max(l,d.y+d.h),h=Math.max(h,d.x+d.w),d.w===S.w&&d.h===S.h){const R=s.pop();v<s.length&&(s[v]=R)}else d.h===S.h?(S.x+=d.w,S.w-=d.w):d.w===S.w?(S.y+=d.h,S.h-=d.h):(s.push({x:S.x+d.w,y:S.y,w:S.w-d.w,h:d.h}),S.y+=d.h,S.h-=d.h);break}}return{w:h,h:l,fill:e/(h*l)||0}}Zt(ur,"Anchor");const m_=1;class __{static getImagePositionScale(e,i,s){return i&&e&&e.options&&e.options.transform?{x:e.options.transform.a,y:e.options.transform.d}:{x:s,y:s}}constructor(e,{pixelRatio:i,version:s,stretchX:h,stretchY:l,content:d,sdf:v,usvg:S},R,g){this.paddedRect=e,this.pixelRatio=i,this.stretchX=h,this.stretchY=l,this.content=d,this.version=s,this.padding=R,this.sdf=v,this.scale=__.getImagePositionScale(g,S,i)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}class yx{constructor(e,i,s){const h={},l={};this.haveRenderCallbacks=[];const d=[];this.addImages(e,h,m_,d),this.addImages(i,l,2,d);const{w:v,h:S}=gx(d),R=new Qn({width:v||1,height:S||1});for(const g in e){const E=e[g],D=h[g].paddedRect;Qn.copy(E.data,R,{x:0,y:0},{x:D.x+m_,y:D.y+m_},E.data,s,E.sdf)}for(const g in i){const E=i[g],D=l[g].paddedRect;let T=l[g].padding;const A=D.x+T,z=D.y+T,B=E.data.width,N=E.data.height;T=T>1?T-1:T,Qn.copy(E.data,R,{x:0,y:0},{x:A,y:z},E.data,s),Qn.copy(E.data,R,{x:0,y:N-T},{x:A,y:z-T},{width:B,height:T},s),Qn.copy(E.data,R,{x:0,y:0},{x:A,y:z+N},{width:B,height:T},s),Qn.copy(E.data,R,{x:B-T,y:0},{x:A-T,y:z},{width:T,height:N},s),Qn.copy(E.data,R,{x:0,y:0},{x:A+B,y:z},{width:T,height:N},s),Qn.copy(E.data,R,{x:B-T,y:N-T},{x:A-T,y:z-T},{width:T,height:T},s),Qn.copy(E.data,R,{x:0,y:N-T},{x:A+B,y:z-T},{width:T,height:T},s),Qn.copy(E.data,R,{x:0,y:0},{x:A+B,y:z+N},{width:T,height:T},s),Qn.copy(E.data,R,{x:B-T,y:0},{x:A-T,y:z+N},{width:T,height:T},s)}this.lut=s,this.image=R,this.iconPositions=h,this.patternPositions=l}addImages(e,i,s,h){for(const l in e){const d=e[l],v={x:0,y:0,w:d.data.width+2*s,h:d.data.height+2*s};h.push(v);const S=Bs.deserializeFromString(l);i[l]=new __(v,d,s,S),d.hasRenderCallback&&this.haveRenderCallbacks.push(S.id)}}patchUpdatedImages(e,i,s){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(h=>e.hasImage(h,s)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,s);for(const h in e.getUpdatedImages(s)){for(const l of Object.keys(this.iconPositions))Bs.deserializeId(l)===h&&this.patchUpdatedImage(this.iconPositions[l],e.getImage(h,s),i);for(const l of Object.keys(this.patternPositions))Bs.deserializeId(l)===h&&this.patchUpdatedImage(this.patternPositions[l],e.getImage(h,s),i)}}patchUpdatedImage(e,i,s){if(!e||!i||e.version===i.version)return;e.version=i.version;const[h,l]=e.tl,d=e.sdf;if(this.lut||d){const v={width:i.data.width,height:i.data.height},S=new Qn(v);Qn.copy(i.data,S,{x:0,y:0},{x:0,y:0},v,this.lut,d),s.update(S,{position:{x:h,y:l}})}else s.update(i.data,{position:{x:h,y:l}})}}Zt(__,"ImagePosition"),Zt(yx,"ImageAtlas");const zg=1e20;function vx(a,e,i,s,h,l,d,v,S){for(let R=e;R<e+s;R++)xx(a,i*l+R,l,h,d,v,S);for(let R=i;R<i+h;R++)xx(a,R*l+e,1,s,d,v,S)}function xx(a,e,i,s,h,l,d){l[0]=0,d[0]=-1e20,d[1]=zg,h[0]=a[e];for(let v=1,S=0,R=0;v<s;v++){h[v]=a[e+v*i];const g=v*v;do{const E=l[S];R=(h[v]-h[E]+g-E*E)/(v-E)/2}while(R<=d[S]&&--S>-1);S++,l[S]=v,d[S]=R,d[S+1]=zg}for(let v=0,S=0;v<s;v++){for(;d[S+1]<v;)S++;const R=l[S],g=v-R;a[e+v*i]=h[R]+g*g}}const Tc=2,av={none:0,ideographs:1,all:2};class rm{constructor(e,i,s){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=s,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,i){this.urls[i]=e}getGlyphs(e,i,s){const h=[],l=this.urls[i]||Jr.GLYPHS_URL;for(const d in e)for(const v of e[d])h.push({stack:d,id:v});wo(h,({stack:d,id:v},S)=>{let R=this.entries[d];R||(R=this.entries[d]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let g=R.glyphs[v];if(g!==void 0)return void S(null,{stack:d,id:v,glyph:g});if(g=this._tinySDF(R,d,v),g)return R.glyphs[v]=g,void S(null,{stack:d,id:v,glyph:g});const E=Math.floor(v/256);if(256*E>65535)return Ri("glyphs > 65535 not supported"),void S(null,{stack:d,id:v,glyph:g});if(R.ranges[E])return void S(null,{stack:d,id:v,glyph:g});let D=R.requests[E];D||(D=R.requests[E]=[],rm.loadGlyphRange(d,E,l,this.requestManager,(T,A)=>{if(A){R.ascender=A.ascender,R.descender=A.descender;for(const z in A.glyphs)this._doesCharSupportLocalGlyph(+z)||(R.glyphs[+z]=A.glyphs[+z]);R.ranges[E]=!0}for(const z of D)z(T,A);delete R.requests[E]})),D.push((T,A)=>{T?S(T):A&&S(null,{stack:d,id:v,glyph:A.glyphs[v]||null})})},(d,v)=>{if(d)s(d);else if(v){const S={};for(const{stack:R,id:g,glyph:E}of v)S[R]===void 0&&(S[R]={}),S[R].glyphs===void 0&&(S[R].glyphs={}),S[R].glyphs[g]=E&&{id:E.id,bitmap:E.bitmap.clone(),metrics:E.metrics},S[R].ascender=this.entries[R].ascender,S[R].descender=this.entries[R].descender;s(null,S)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==av.none&&(this.localGlyphMode===av.all?!!this.localFontFamily:!!this.localFontFamily&&(It["CJK Unified Ideographs"](e)||It["Hangul Syllables"](e)||It.Hiragana(e)||It.Katakana(e)||It["CJK Symbols and Punctuation"](e)||It["CJK Unified Ideographs Extension A"](e)||It["CJK Unified Ideographs Extension B"](e)||It.Osage(e)))}_tinySDF(e,i,s){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(s))return;let l=e.tinySDF;if(!l){let z="400";/bold/i.test(i)?z="900":/medium/i.test(i)?z="500":/light/i.test(i)&&(z="200"),l=e.tinySDF=new rm.TinySDF({fontFamily:h,fontWeight:z,fontSize:24*Tc,buffer:3*Tc,radius:8*Tc}),l.fontWeight=z}if(this.localGlyphs[l.fontWeight][s])return this.localGlyphs[l.fontWeight][s];const d=String.fromCodePoint(s),{data:v,width:S,height:R,glyphWidth:g,glyphHeight:E,glyphLeft:D,glyphTop:T,glyphAdvance:A}=l.draw(d);return this.localGlyphs[l.fontWeight][s]={id:s,bitmap:new xc({width:S,height:R},v),metrics:{width:g/Tc,height:E/Tc,left:D/Tc,top:T/Tc-27,advance:A/Tc,localGlyph:!0}}}}rm.loadGlyphRange=function(a,e,i,s,h){const l=256*e,d=l+255,v=s.transformRequest(s.normalizeGlyphsURL(i).replace("{fontstack}",a).replace("{range}",`${l}-${d}`),sr.Glyphs);Gr(v,(S,R)=>{if(S)h(S);else if(R){const g={},E=function(D){return new f(D).readFields(I,{})}(R);for(const D of E.glyphs)g[D.id]=D;h(null,{glyphs:g,ascender:E.ascender,descender:E.descender})}})},rm.TinySDF=class{constructor({fontSize:a=24,buffer:e=3,radius:i=8,cutoff:s=.25,fontFamily:h="sans-serif",fontWeight:l="normal",fontStyle:d="normal"}={}){this.buffer=e,this.cutoff=s,this.radius=i;const v=this.size=a+4*e,S=this._createCanvas(v),R=this.ctx=S.getContext("2d",{willReadFrequently:!0});R.font=`${d} ${l} ${a}px ${h}`,R.textBaseline="alphabetic",R.textAlign="left",R.fillStyle="black",this.gridOuter=new Float64Array(v*v),this.gridInner=new Float64Array(v*v),this.f=new Float64Array(v),this.z=new Float64Array(v+1),this.v=new Uint16Array(v)}_createCanvas(a){const e=document.createElement("canvas");return e.width=e.height=a,e}draw(a){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:s,actualBoundingBoxLeft:h,actualBoundingBoxRight:l}=this.ctx.measureText(a),d=Math.ceil(i),v=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(l-h))),S=Math.min(this.size-this.buffer,d+Math.ceil(s)),R=v+2*this.buffer,g=S+2*this.buffer,E=Math.max(R*g,0),D=new Uint8ClampedArray(E),T={data:D,width:R,height:g,glyphWidth:v,glyphHeight:S,glyphTop:d,glyphLeft:0,glyphAdvance:e};if(v===0||S===0)return T;const{ctx:A,buffer:z,gridInner:B,gridOuter:N}=this;A.clearRect(z,z,v,S),A.fillText(a,z,z+d);const Z=A.getImageData(z,z,v,S);N.fill(zg,0,E),B.fill(0,0,E);for(let X=0;X<S;X++)for(let q=0;q<v;q++){const Y=Z.data[4*(X*v+q)+3]/255;if(Y===0)continue;const K=(X+z)*R+q+z;if(Y===1)N[K]=0,B[K]=zg;else{const re=.5-Y;N[K]=re>0?re*re:0,B[K]=re<0?re*re:0}}vx(N,0,0,R,g,R,this.f,this.v,this.z),vx(B,z,z,v,S,R,this.f,this.v,this.z);for(let X=0;X<E;X++){const q=Math.sqrt(N[X])-Math.sqrt(B[X]);D[X]=Math.round(255-255*(q/this.radius+this.cutoff))}return T}};const Zd=m_;function bx(a,e){return a+e[1]-e[0]}function wx(a,e,i,s,h=1){const l=[],d=a.imagePrimary,v=d.pixelRatio,S=d.paddedRect.w-2*Zd,R=d.paddedRect.h-2*Zd,g=(a.right-a.left)*h,E=(a.bottom-a.top)*h,D=d.stretchX||[[0,S]],T=d.stretchY||[[0,R]],A=D.reduce(bx,0),z=T.reduce(bx,0),B=S-A,N=R-z;let Z=0,X=A,q=0,Y=z,K=0,re=B,he=0,ue=N;if(d.content&&s){const Te=d.content;Z=Og(D,0,Te[0]),q=Og(T,0,Te[1]),X=Og(D,Te[0],Te[2]),Y=Og(T,Te[1],Te[3]),K=Te[0]-Z,he=Te[1]-q,re=Te[2]-Te[0]-X,ue=Te[3]-Te[1]-Y}const ce=(Te,de,Se,Ce)=>{const Me=Lg(Te.stretch-Z,X,g,a.left*h),Le=Pg(Te.fixed-K,re,Te.stretch,A),ke=Lg(de.stretch-q,Y,E,a.top*h),Ue=Pg(de.fixed-he,ue,de.stretch,z),Pe=Lg(Se.stretch-Z,X,g,a.left*h),at=Pg(Se.fixed-K,re,Se.stretch,A),mt=Lg(Ce.stretch-q,Y,E,a.top*h),nt=Pg(Ce.fixed-he,ue,Ce.stretch,z),Bt=new Rt(Me,ke),Ot=new Rt(Pe,ke),bt=new Rt(Pe,mt),yt=new Rt(Me,mt),ei=new Rt(Le/v,Ue/v),jt=new Rt(at/v,nt/v),Wt=e*Math.PI/180;if(Wt){const Ki=Math.sin(Wt),zr=Math.cos(Wt),xr=[zr,-Ki,Ki,zr];Bt._matMult(xr),Ot._matMult(xr),yt._matMult(xr),bt._matMult(xr)}const Ti=Te.stretch+Te.fixed,zi=Se.stretch+Se.fixed,Pi=de.stretch+de.fixed,ki=Ce.stretch+Ce.fixed,$i=a.imageSecondary;return{tl:Bt,tr:Ot,bl:yt,br:bt,texPrimary:{x:d.paddedRect.x+Zd+Ti,y:d.paddedRect.y+Zd+Pi,w:zi-Ti,h:ki-Pi},texSecondary:$i?{x:$i.paddedRect.x+Zd+Ti,y:$i.paddedRect.y+Zd+Pi,w:zi-Ti,h:ki-Pi}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ei,pixelOffsetBR:jt,minFontScaleX:re/v/g,minFontScaleY:ue/v/E,isSDF:i}};if(s&&(d.stretchX||d.stretchY)){const Te=Tx(D,B,A),de=Tx(T,N,z);for(let Se=0;Se<Te.length-1;Se++){const Ce=Te[Se],Me=Te[Se+1];for(let Le=0;Le<de.length-1;Le++)l.push(ce(Ce,de[Le],Me,de[Le+1]))}}else l.push(ce({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:S+1},{fixed:0,stretch:R+1}));return l}function Og(a,e,i){let s=0;for(const h of a)s+=Math.max(e,Math.min(i,h[1]))-Math.max(e,Math.min(i,h[0]));return s}function Tx(a,e,i){const s=[{fixed:-1,stretch:0}];for(const[h,l]of a){const d=s[s.length-1];s.push({fixed:h-d.stretch,stretch:d.stretch}),s.push({fixed:h-d.stretch,stretch:d.stretch+(l-h)})}return s.push({fixed:e+Zd,stretch:i}),s}function Lg(a,e,i,s){return a/e*i+s}function Pg(a,e,i,s){return a-e*i/s}function iT(a,e,i,s){const h=e+a.positionedLines[s].lineOffset;return s===0?i+h/2:i+(h+(e+a.positionedLines[s-1].lineOffset))/2}function rT(a,e=1,i=!1){let s=1/0,h=1/0,l=-1/0,d=-1/0;const v=a[0];for(let T=0;T<v.length;T++){const A=v[T];(!T||A.x<s)&&(s=A.x),(!T||A.y<h)&&(h=A.y),(!T||A.x>l)&&(l=A.x),(!T||A.y>d)&&(d=A.y)}const S=Math.min(l-s,d-h);let R=S/2;const g=new zn([],nT);if(S===0)return new Rt(s,h);for(let T=s;T<l;T+=S)for(let A=h;A<d;A+=S)g.push(new nm(T+R,A+R,R,a));let E=function(T){let A=0,z=0,B=0;const N=T[0];for(let Z=0,X=N.length,q=X-1;Z<X;q=Z++){const Y=N[Z],K=N[q],re=Y.x*K.y-K.x*Y.y;z+=(Y.x+K.x)*re,B+=(Y.y+K.y)*re,A+=3*re}return new nm(z/A,B/A,0,T)}(a),D=g.length;for(;g.length;){const T=g.pop();(T.d>E.d||!E.d)&&(E=T,i&&console.log("found best %d after %d probes",Math.round(1e4*T.d)/1e4,D)),T.max-E.d<=e||(R=T.h/2,g.push(new nm(T.p.x-R,T.p.y-R,R,a)),g.push(new nm(T.p.x+R,T.p.y-R,R,a)),g.push(new nm(T.p.x-R,T.p.y+R,R,a)),g.push(new nm(T.p.x+R,T.p.y+R,R,a)),D+=4)}return i&&(console.log(`num probes: ${D}`),console.log(`best distance: ${E.d}`)),E.p}function nT(a,e){return e.max-a.max}class nm{constructor(e,i,s,h){this.p=new Rt(e,i),this.h=s,this.d=function(l,d){let v=!1,S=1/0;for(let R=0;R<d.length;R++){const g=d[R];for(let E=0,D=g.length,T=D-1;E<D;T=E++){const A=g[E],z=g[T];A.y>l.y!=z.y>l.y&&l.x<(z.x-A.x)*(l.y-A.y)/(z.y-A.y)+A.x&&(v=!v),S=Math.min(S,me(l,A,z))}}return(v?1:-1)*Math.sqrt(S)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}}const sv=Number.POSITIVE_INFINITY,aT=Math.sqrt(2);function Sx(a,[e,i]){let s=0,h=0;if(i===sv){e<0&&(e=0);const l=e/aT;switch(a){case"top-right":case"top-left":h=l-7;break;case"bottom-right":case"bottom-left":h=7-l;break;case"bottom":h=7-e;break;case"top":h=e-7}switch(a){case"top-right":case"bottom-right":s=-l;break;case"top-left":case"bottom-left":s=l;break;case"left":s=e;break;case"right":s=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),a){case"top-right":case"top-left":case"top":h=i-7;break;case"bottom-right":case"bottom-left":case"bottom":h=7-i}switch(a){case"top-right":case"bottom-right":case"right":s=-e;break;case"top-left":case"bottom-left":case"left":s=e}}return[s,h]}function ov(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function sT(a,e,i,s,h,l,d,v,S,R,g,E,D,T,A){let z=l.textMaxSize.evaluate(e,{},E);z===void 0?z=d*l.textScaleFactor:z*=l.textScaleFactor;const B=a.layers[0].layout,N=B.get("icon-offset").evaluate(e,{},E),Z=Mx(i.horizontal)||i.vertical,X=D.name==="globe",q=la,Y=d*l.textScaleFactor/q,K=a.tilePixelRatio*z/q,re=(Me=a.overscaling,a.zoom>18&&Me>2&&(Me>>=1),Math.max(zt/(512*Me),1)*B.get("symbol-spacing")),he=B.get("text-padding")*a.tilePixelRatio,ue=B.get("icon-padding")*a.tilePixelRatio,ce=Yi(B.get("text-max-angle")),Te=B.get("text-rotation-alignment")==="map"&&B.get("symbol-placement")!=="point",de=B.get("icon-rotation-alignment")==="map"&&B.get("symbol-placement")!=="point",Se=B.get("symbol-placement"),Ce=re/2;var Me;const Le=B.get("icon-text-fit").evaluate(e,{},E),ke=B.get("icon-text-fit-padding").evaluate(e,{},E),Ue=Le!=="none";let Pe;a.hasAnyIconTextFit===!1&&Ue&&(a.hasAnyIconTextFit=!0),s&&Ue&&(a.allowVerticalPlacement&&i.vertical&&(Pe=Ii(s,i.vertical,Le,ke,N,Y)),Z&&(s=Ii(s,Z,Le,ke,N,Y)));const at=(mt,nt,Bt)=>{if(nt.x<0||nt.x>=zt||nt.y<0||nt.y>=zt)return;let Ot=null;if(X){const{x:bt,y:yt,z:ei}=D.projectTilePoint(nt.x,nt.y,Bt);Ot={anchor:new ur(bt,yt,ei,0,void 0),up:D.upVector(Bt,nt.x,nt.y)}}(function(bt,yt,ei,jt,Wt,Ti,zi,Pi,ki,$i,Ki,zr,xr,Ci,yr,vr,qr,pn,An,mn,ln,vn,Pn,La,Nr,Ks,Ac){const Ul=bt.addToLineVertexArray(yt,jt);let jl,Qd,Nf,Kd,P_,s1,o1,l1=0,c1=0,u1=0,h1=0,jv=-1,qv=-1;const Du={};let f1=ps("");const Jd=ei?ei.anchor:yt,Gv=ki.layout.get("icon-text-fit").evaluate(ln,{},Nr)!=="none";let Hv=0,Zv=0;if(ki._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Hv,Zv]=ki.layout.get("text-offset").evaluate(ln,{},Nr).map(Qo=>Qo*la):(Hv=ki.layout.get("text-radial-offset").evaluate(ln,{},Nr)*la,Zv=sv),bt.allowVerticalPlacement&&Wt.vertical){const Qo=Wt.vertical;if(yr)s1=lv(Qo),Pi&&(o1=lv(Pi));else{const Js=ki.layout.get("text-rotate").evaluate(ln,{},Nr)+90;Nf=kg($i,Jd,yt,Ki,zr,xr,Qo,Ci,Js,vr),Pi&&(Kd=kg($i,Jd,yt,Ki,zr,xr,Pi,pn,Js))}}if(Ti){const Qo=bt.iconSizeData,Js=ki.layout.get("icon-rotate").evaluate(ln,{},Nr),k_=wx(Ti,Js,Pn,Gv,vn.iconScaleFactor),Yv=Pi?wx(Pi,Js,Pn,Gv,vn.iconScaleFactor):void 0;Qd=kg($i,Jd,yt,Ki,zr,xr,Ti,pn,Js,null),l1=4*k_.length;let ep=null;Qo.kind==="source"?(ep=[ls*ki.layout.get("icon-size").evaluate(ln,{},Nr)*vn.iconScaleFactor],ep[0]>Pf&&Ri(`${bt.layerIds[0]}: Value for "icon-size" is >= ${g_}. Reduce your "icon-size".`)):Qo.kind==="composite"&&(ep=[ls*vn.compositeIconSizes[0].evaluate(ln,{},Nr)*vn.iconScaleFactor,ls*vn.compositeIconSizes[1].evaluate(ln,{},Nr)*vn.iconScaleFactor],(ep[0]>Pf||ep[1]>Pf)&&Ri(`${bt.layerIds[0]}: Value for "icon-size" is >= ${g_}. Reduce your "icon-size".`)),bt.addSymbols(bt.icon,k_,ep,mn,An,ln,!1,ei,yt,Ul.lineStartIndex,Ul.lineLength,-1,La,Nr,Ks,Ac),jv=bt.icon.placedSymbolArray.length-1,Yv&&(c1=4*Yv.length,bt.addSymbols(bt.icon,Yv,ep,mn,An,ln,xe.vertical,ei,yt,Ul.lineStartIndex,Ul.lineLength,-1,La,Nr,Ks,Ac),qv=bt.icon.placedSymbolArray.length-1)}for(const Qo in Wt.horizontal){const Js=Wt.horizontal[Qo];jl||(f1=ps(Js.text),yr?P_=lv(Js):jl=kg($i,Jd,yt,Ki,zr,xr,Js,Ci,ki.layout.get("text-rotate").evaluate(ln,{},Nr),vr));const k_=Js.positionedLines.length===1;if(u1+=Ex(bt,ei,yt,Js,zi,ki,yr,ln,vr,Ul,Wt.vertical?xe.horizontal:xe.horizontalOnly,k_?Object.keys(Wt.horizontal):[Qo],Du,jv,vn,La,Nr,Ks),k_)break}Wt.vertical&&(h1+=Ex(bt,ei,yt,Wt.vertical,zi,ki,yr,ln,vr,Ul,xe.vertical,["vertical"],Du,qv,vn,La,Nr,Ks));let Vf=-1;const Xv=(Qo,Js)=>Qo?Math.max(Qo,Js):Js;Vf=Xv(P_,Vf),Vf=Xv(s1,Vf),Vf=Xv(o1,Vf);const NS=Vf>-1?1:0;bt.glyphOffsetArray.length>=65535&&Ri("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ln.sortKey!==void 0&&bt.addToSortKeyRanges(bt.symbolInstances.length,ln.sortKey),bt.symbolInstances.emplaceBack(yt.x,yt.y,Jd.x,Jd.y,Jd.z,Du.right>=0?Du.right:-1,Du.center>=0?Du.center:-1,Du.left>=0?Du.left:-1,Du.vertical>=0?Du.vertical:-1,jv,qv,f1,jl!==void 0?jl:bt.collisionBoxArray.length,jl!==void 0?jl+1:bt.collisionBoxArray.length,Nf!==void 0?Nf:bt.collisionBoxArray.length,Nf!==void 0?Nf+1:bt.collisionBoxArray.length,Qd!==void 0?Qd:bt.collisionBoxArray.length,Qd!==void 0?Qd+1:bt.collisionBoxArray.length,Kd||bt.collisionBoxArray.length,Kd?Kd+1:bt.collisionBoxArray.length,Ki,u1,h1,l1,c1,NS,0,Hv,Zv,Vf,0,Gv?1:0)})(a,nt,Ot,mt,i,s,h,Pe,a.layers[0],a.collisionBoxArray,e.index,e.sourceLayerIndex,a.index,he,Te,S,0,ue,de,N,e,l,R,g,E,T,A)};if(Se==="line")for(const mt of _x(e.geometry,0,0,zt,zt)){const nt=nv(mt,re,ce,i.vertical||Z,s,q,K,a.overscaling,zt);for(const Bt of nt)Z&&oT(a,Z.text,Ce,Bt)||at(mt,Bt,E)}else if(Se==="line-center"){for(const mt of e.geometry)if(mt.length>1){const nt=Cu(mt,ce,i.vertical||Z,s,q,K);nt&&at(mt,nt,E)}}else if(e.type==="Polygon")for(const mt of Qs(e.geometry,0)){const nt=rT(mt,16);at(mt[0],new ur(nt.x,nt.y,0,0,void 0),E)}else if(e.type==="LineString")for(const mt of e.geometry)at(mt,new ur(mt[0].x,mt[0].y,0,0,void 0),E);else if(e.type==="Point")for(const mt of e.geometry)for(const nt of mt)at([nt],new ur(nt.x,nt.y,0,0,void 0),E)}const g_=255,Pf=g_*ls;function Ex(a,e,i,s,h,l,d,v,S,R,g,E,D,T,A,z,B,N){const Z=function(Y,K,re,he,ue,ce,Te,de){const Se=[];if(K.positionedLines.length===0)return Se;const Ce=he.layout.get("text-rotate").evaluate(ce,{})*Math.PI/180,Me=function(at){const mt=at[0],nt=at[1],Bt=mt*nt;return Bt>0?[mt,-nt]:Bt<0?[-mt,nt]:mt===0?[nt,mt]:[nt,-mt]}(re);let Le=Math.abs(K.top-K.bottom);for(const at of K.positionedLines)Le-=at.lineOffset;const ke=K.positionedLines.length,Ue=Le/ke;let Pe=K.top-re[1];for(let at=0;at<ke;++at){const mt=K.positionedLines[at];Pe=iT(K,Ue,Pe,at);for(const nt of mt.positionedGlyphs){if(!nt.rect)continue;const Bt=nt.rect||{};let Ot=se+1,bt=!0,yt=1,ei=0;if(nt.imageName){const mn=Te[ea.build(nt.imageName).getSerializedPrimary()];if(!mn)continue;if(mn.sdf){Ri("SDF images are not supported in formatted text and will be ignored.");continue}bt=!1,yt=mn.pixelRatio,Ot=m_/yt}const jt=(ue||de)&&nt.vertical,Wt=nt.metrics.advance*nt.scale/2,Ti=nt.metrics,zi=nt.rect;if(zi===null)continue;de&&K.verticalizable&&(ei=nt.imageName?Wt-nt.metrics.width*nt.scale/2:0);const Pi=ue?[nt.x+Wt,nt.y]:[0,0];let ki=[0,0],$i=[0,0],Ki=!1;ue||(jt?($i=[nt.x+Wt+Me[0],nt.y+Me[1]-ei],Ki=!0):ki=[nt.x+Wt+re[0],nt.y+re[1]-ei]);const zr=zi.w*nt.scale/(yt*(nt.localGlyph?Tc:1)),xr=zi.h*nt.scale/(yt*(nt.localGlyph?Tc:1));let Ci,yr,vr,qr;if(jt){const mn=nt.y-Pe,ln=new Rt(-Wt,Wt-mn),vn=-Math.PI/2,Pn=new Rt(...$i);Ci=new Rt(-Wt+ki[0],ki[1]),Ci._rotateAround(vn,ln)._add(Pn),Ci.x+=-mn+Wt,Ci.y-=(Ti.left-Ot)*nt.scale;const La=nt.imageName?Ti.advance*nt.scale:la*nt.scale,Nr=String.fromCodePoint(nt.glyph);Rg(Nr)?Ci.x+=(1-Ot)*nt.scale:Hd(Nr)?Ci.x+=La-Ti.height*nt.scale+(-Ot-1)*nt.scale:Ci.x+=nt.imageName||Ti.width+2*Ot===zi.w&&Ti.height+2*Ot===zi.h?(La-xr)/2:(La-(Ti.height+2*Ot)*nt.scale)/2,yr=new Rt(Ci.x,Ci.y-zr),vr=new Rt(Ci.x+xr,Ci.y),qr=new Rt(Ci.x+xr,Ci.y-zr)}else{const mn=(Ti.left-Ot)*nt.scale-Wt+ki[0],ln=(-Ti.top-Ot)*nt.scale+ki[1],vn=mn+zr,Pn=ln+xr;Ci=new Rt(mn,ln),yr=new Rt(vn,ln),vr=new Rt(mn,Pn),qr=new Rt(vn,Pn)}if(Ce){let mn;mn=ue?new Rt(0,0):Ki?new Rt(Me[0],Me[1]):new Rt(re[0],re[1]),Ci._rotateAround(Ce,mn),yr._rotateAround(Ce,mn),vr._rotateAround(Ce,mn),qr._rotateAround(Ce,mn)}const pn=new Rt(0,0),An=new Rt(0,0);Se.push({tl:Ci,tr:yr,bl:vr,br:qr,texPrimary:Bt,texSecondary:void 0,writingMode:K.writingMode,glyphOffset:Pi,sectionIndex:nt.sectionIndex,isSDF:bt,pixelOffsetTL:pn,pixelOffsetBR:An,minFontScaleX:0,minFontScaleY:0})}}return Se}(0,s,S,l,d,v,h,a.allowVerticalPlacement),X=a.textSizeData;let q=null;X.kind==="source"?(q=[ls*l.layout.get("text-size").evaluate(v,{},B)*A.textScaleFactor],q[0]>Pf&&Ri(`${a.layerIds[0]}: Value for "text-size" is >= ${g_}. Reduce your "text-size".`)):X.kind==="composite"&&(q=[ls*A.compositeTextSizes[0].evaluate(v,{},B)*A.textScaleFactor,ls*A.compositeTextSizes[1].evaluate(v,{},B)*A.textScaleFactor],(q[0]>Pf||q[1]>Pf)&&Ri(`${a.layerIds[0]}: Value for "text-size" is >= ${g_}. Reduce your "text-size".`)),a.addSymbols(a.text,Z,q,S,d,v,g,e,i,R.lineStartIndex,R.lineLength,T,z,B,N,!1);for(const Y of E)D[Y]=a.text.placedSymbolArray.length-1;return 4*Z.length}function Mx(a){for(const e in a)return a[e];return null}function kg(a,e,i,s,h,l,d,v,S,R){let g=d.top,E=d.bottom,D=d.left,T=d.right;const A=d.collisionPadding;if(A&&(D-=A[0],g-=A[1],T+=A[2],E+=A[3]),S){const z=new Rt(D,g),B=new Rt(T,g),N=new Rt(D,E),Z=new Rt(T,E),X=Yi(S);let q=new Rt(0,0);R&&(q=new Rt(R[0],R[1])),z._rotateAround(X,q),B._rotateAround(X,q),N._rotateAround(X,q),Z._rotateAround(X,q),D=Math.min(z.x,B.x,N.x,Z.x),T=Math.max(z.x,B.x,N.x,Z.x),g=Math.min(z.y,B.y,N.y,Z.y),E=Math.max(z.y,B.y,N.y,Z.y)}return a.emplaceBack(e.x,e.y,e.z,i.x,i.y,D,g,T,E,v,s,h,l),a.length-1}function lv(a){a.collisionPadding&&(a.top-=a.collisionPadding[1],a.bottom+=a.collisionPadding[3]);const e=a.bottom-a.top;return e>0?Math.max(10,e):null}function oT(a,e,i,s){const h=a.compareText;if(e in h){const l=h[e];for(let d=l.length-1;d>=0;d--)if(s.dist(l[d])<i)return!0}else h[e]=[];return h[e].push(s),!1}function Ax(a,e){const i=a.fovAboveCenter,s=a.elevation?a.elevation.getMinElevationBelowMSL()*e:0,h=(a._camera.position[2]*a.worldSize-s)/Math.cos(a._pitch),l=Math.sin(i)*h/Math.sin(Math.max(Math.PI/2-a._pitch-i,.01));let d=Math.sin(a._pitch)*l+h;const v=h*(1/a._horizonShift);if(!a.elevation||a.elevation.exaggeration()===0){let S=Math.max(a.zoom-17,0);a.isOrthographic&&(S/=10),d*=1+S}return Math.min(1.01*d,v)}function y_(a,e){if(!e.isReprojectedInTileSpace)return{scale:1<<a.z,x:a.x,y:a.y,x2:a.x+1,y2:a.y+1,projection:e};const i=Math.pow(2,-a.z),s=a.x*i,h=(a.x+1)*i,l=a.y*i,d=(a.y+1)*i,v=va(s),S=va(h),R=gn(l),g=gn(d),E=e.project(v,R),D=e.project(S,R),T=e.project(S,g),A=e.project(v,g);let z=Math.min(E.x,D.x,T.x,A.x),B=Math.min(E.y,D.y,T.y,A.y),N=Math.max(E.x,D.x,T.x,A.x),Z=Math.max(E.y,D.y,T.y,A.y);const X=i/16;function q(K,re,he,ue,ce,Te){const de=(he+ce)/2,Se=(ue+Te)/2,Ce=e.project(va(de),gn(Se)),Me=Math.max(0,z-Ce.x,B-Ce.y,Ce.x-N,Ce.y-Z);z=Math.min(z,Ce.x),N=Math.max(N,Ce.x),B=Math.min(B,Ce.y),Z=Math.max(Z,Ce.y),Me>X&&(q(K,Ce,he,ue,de,Se),q(Ce,re,de,Se,ce,Te))}q(E,D,s,l,h,l),q(D,T,h,l,h,d),q(T,A,h,d,s,d),q(A,E,s,d,s,l),z-=X,B-=X,N+=X,Z+=X;const Y=1/Math.max(N-z,Z-B);return{scale:Y,x:z*Y,y:B*Y,x2:N*Y,y2:Z*Y,projection:e}}function Cx(a,{x:e,y:i},s=0){return new Rt(((e-s)*a.scale-a.x)*zt,(i*a.scale-a.y)*zt)}const lT=Ae.mat4.identity(new Float32Array(16));class kf{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new ir(0,0)}projectTilePoint(e,i,s){return{x:e,y:i,z:0}}locationPoint(e,i,s=!0){return e._coordinatePoint(e.locationCoordinate(i),s)}pixelsPerMeter(e,i){return sa(1,e)*i}pixelSpaceConversion(e,i,s){return 1}farthestPixelDistance(e){return Ax(e,e.pixelsPerMeter)}pointCoordinate(e,i,s,h){const l=e.horizonLineFromTop(!1),d=new Rt(i,Math.max(l,s));return e.rayIntersectionCoordinate(e.pointRayIntersection(d,h))}pointCoordinate3D(e,i,s){const h=new Rt(i,s);if(e.elevation)return e.elevation.pointCoordinate(h);{const l=this.pointCoordinate(e,h.x,h.y,0);return[l.x,l.y,l.z]}}isPointAboveHorizon(e,i){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,i.x,i.y);const s=e.horizonLineFromTop();return i.y<s}createInversionMatrix(e,i){return lT}createTileMatrix(e,i,s){let h,l,d;const v=s.canonical,S=Ae.mat4.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const R=y_(v,this);h=1,l=R.x+s.wrap*R.scale,d=R.y,Ae.mat4.scale(S,S,[h/R.scale,h/R.scale,e.pixelsPerMeter/i])}else h=i/e.zoomScale(v.z),l=(v.x+Math.pow(2,v.z)*s.wrap)*h,d=v.y*h;return Ae.mat4.translate(S,S,[l,d,0]),Ae.mat4.scale(S,S,[h/zt,h/zt,1]),S}upVector(e,i,s){return[0,0,1]}upVectorScale(e,i,s){return{metersToTile:1}}}class cT extends kf{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,s]=this.parallels=e.parallels||[29.5,45.5],h=Math.sin(Yi(i));this.n=(h+Math.sin(Yi(s)))/2,this.c=1+h*(2*this.n-h),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:s,c:h,r0:l}=this,d=Yi(e-this.center[0]),v=Yi(i),S=Math.sqrt(h-2*s*Math.sin(v))/s;return{x:S*Math.sin(d*s),y:S*Math.cos(d*s)-l,z:0}}unproject(e,i){const{n:s,c:h,r0:l}=this,d=l+i;let v=Math.atan2(e,Math.abs(d))*Math.sign(d);d*s<0&&(v-=Math.PI*Math.sign(e)*Math.sign(d));const S=Yi(this.center[0])*s;v=us(v,-Math.PI-S,Math.PI-S);const R=Mi(Tn(v/s)+this.center[0],-180,180),g=Math.asin(Mi((h-(e*e+d*d)*s*s)/(2*s),-1,1)),E=Mi(Tn(g),-85.051129,Tr);return new ir(R,E)}}const v_=1.340264,x_=-.081106,b_=893e-6,w_=.003796,Fg=Math.sqrt(3)/2;class uT extends kf{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const s=Math.asin(Fg*Math.sin(i)),h=s*s,l=h*h*h;return{x:.5*(e*Math.cos(s)/(Fg*(v_+3*x_*h+l*(7*b_+9*w_*h)))/Math.PI+.5),y:1-.5*(s*(v_+x_*h+l*(b_+w_*h))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let s=i=(2*(1-i)-1)*Math.PI,h=s*s,l=h*h*h;for(let g,E,D,T=0;T<12&&(E=s*(v_+x_*h+l*(b_+w_*h))-i,D=v_+3*x_*h+l*(7*b_+9*w_*h),g=E/D,s=Mi(s-g,-Math.PI/3,Math.PI/3),h=s*s,l=h*h*h,!(Math.abs(g)<1e-12));++T);const d=Fg*e*(v_+3*x_*h+l*(7*b_+9*w_*h))/Math.cos(s),v=Math.asin(Math.sin(s)/Fg),S=Mi(180*d/Math.PI,-180,180),R=Mi(180*v/Math.PI,-85.051129,Tr);return new ir(S,R)}}class hT extends kf{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const s=360*(e-.5),h=Mi(360*(.5-i),-85.051129,Tr);return new ir(s,h)}}const am=Math.PI/2;function Bg(a){return Math.tan((am+a)/2)}class fT extends kf{constructor(e){super(e),this.center=e.center||[0,30];const[i,s]=this.parallels=e.parallels||[30,30];let h=Yi(i),l=Yi(s);this.southernCenter=h+l<0,this.southernCenter&&(h=-h,l=-l);const d=Math.cos(h),v=Bg(h);this.n=h===l?Math.sin(h):Math.log(d/Math.cos(l))/Math.log(Bg(l)/v),this.f=d*Math.pow(Bg(h),this.n)/this.n}project(e,i){i=Yi(i),this.southernCenter&&(i=-i),e=Yi(e-this.center[0]);const s=1e-6,{n:h,f:l}=this;l>0?i<-am+s&&(i=-am+s):i>am-s&&(i=am-s);const d=l/Math.pow(Bg(i),h);let v=d*Math.sin(h*e),S=l-d*Math.cos(h*e);return v=.5*(v/Math.PI+.5),S=.5*(S/Math.PI+.5),{x:v,y:this.southernCenter?S:1-S,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:s,f:h}=this,l=h-i,d=Math.sign(l),v=Math.sign(s)*Math.sqrt(e*e+l*l);let S=Math.atan2(e,Math.abs(l))*d;l*s<0&&(S-=Math.PI*Math.sign(e)*d);const R=Mi(Tn(S/s)+this.center[0],-180,180),g=Mi(Tn(2*Math.atan(Math.pow(h/v,1/s))-am),-85.051129,Tr);return new ir(R,this.southernCenter?-g:g)}}class Dx extends kf{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:$s(e),y:Is(i),z:0}}unproject(e,i){const s=va(e),h=gn(i);return new ir(s,h)}}const Ix=Yi(Tr);class dT extends kf{project(e,i){const s=(i=Yi(i))*i,h=s*s;return{x:.5*((e=Yi(e))*(.8707-.131979*s+h*(h*(.003971*s-.001529*h)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+s*(.015085+h*(.028874*s-.044475-.005916*h)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let s=i=(2*(1-i)-1)*Math.PI,h=25,l=0,d=s*s;do{d=s*s;const R=d*d;l=(s*(1.007226+d*(.015085+R*(.028874*d-.044475-.005916*R)))-i)/(1.007226+d*(.045255+R*(.259866*d-.311325-.005916*11*R))),s=Mi(s-l,-Ix,Ix)}while(Math.abs(l)>1e-6&&--h>0);d=s*s;const v=Mi(Tn(e/(.8707+d*(d*(d*d*d*(.003971-.001529*d)-.013791)-.131979))),-180,180),S=Tn(s);return new ir(v,S)}}const Rx=Yi(Tr);class pT extends kf{project(e,i){i=Yi(i),e=Yi(e);const s=Math.cos(i),h=2/Math.PI,l=Math.acos(s*Math.cos(e/2)),d=Math.sin(l)/l,v=.5*(e*h+2*s*Math.sin(e/2)/d)||0,S=.5*(i+Math.sin(i)/d)||0;return{x:.5*(v/Math.PI+.5),y:1-.5*(S/Math.PI+1),z:0}}unproject(e,i){let s=e=(2*e-.5)*Math.PI,h=i=(2*(1-i)-1)*Math.PI,l=25;const d=1e-6;let v=0,S=0;do{const R=Math.cos(h),g=Math.sin(h),E=2*g*R,D=g*g,T=R*R,A=Math.cos(s/2),z=Math.sin(s/2),B=2*A*z,N=z*z,Z=1-T*A*A,X=Z?1/Z:0,q=Z?Math.acos(R*A)*Math.sqrt(1/Z):0,Y=.5*(2*q*R*z+2*s/Math.PI)-e,K=.5*(q*g+h)-i,re=.5*X*(T*N+q*R*A*D)+1/Math.PI,he=X*(B*E/4-q*g*z),ue=.125*X*(E*z-q*g*T*B),ce=.5*X*(D*A+q*N*R)+.5,Te=he*ue-ce*re;v=(K*he-Y*ce)/Te,S=(Y*ue-K*re)/Te,s=Mi(s-v,-Math.PI,Math.PI),h=Mi(h-S,-Rx,Rx)}while((Math.abs(v)>d||Math.abs(S)>d)&&--l>0);return new ir(Tn(s),Tn(h))}}class zx extends kf{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Yi(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:s,cosPhi:h}=this;return{x:Yi(e)*h*s+.5,y:-Math.sin(Yi(i))/h*s+.5,z:0}}unproject(e,i){const{scale:s,cosPhi:h}=this,l=-(i-.5)/s,d=Mi(Tn((e-.5)/s)/h,-180,180),v=Math.asin(Mi(l*h,-1,1)),S=Mi(Tn(v),-85.051129,Tr);return new ir(d,S)}}class mT extends Dx{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,s){const h=hr(e,i,s),l=en(Fr(s));return Ae.vec3.transformMat4(h,h,l),{x:h[0],y:h[1],z:h[2]}}locationPoint(e,i){const s=Ll(i.lat,i.lng),h=Ae.vec3.normalize([],s),l=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude,d=sa(1,0)*zt*l;Ae.vec3.scaleAndAdd(s,s,h,d);const v=Ae.mat4.identity(new Float64Array(16));return Ae.mat4.multiply(v,e.pixelMatrix,e.globeMatrix),Ae.vec3.transformMat4(s,s,v),new Rt(s[0],s[1])}pixelsPerMeter(e,i){return sa(1,0)*i}pixelSpaceConversion(e,i,s){const h=sa(1,e)*i,l=di(sa(1,45)*i,h,s);return this.pixelsPerMeter(e,i)/l}createTileMatrix(e,i,s){const h=mr(Fr(s.canonical));return Ae.mat4.multiply(new Float64Array(16),e.globeMatrix,h)}createInversionMatrix(e,i){const{center:s}=e,h=en(Fr(i));return Ae.mat4.rotateY(h,h,Yi(s.lng)),Ae.mat4.rotateX(h,h,Yi(s.lat)),Ae.mat4.scale(h,h,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(h)}pointCoordinate(e,i,s,h){return _i(e,i,s,!0)||new r(0,0)}pointCoordinate3D(e,i,s){const h=this.pointCoordinate(e,i,s,0);return[h.x,h.y,h.z]}isPointAboveHorizon(e,i){return!_i(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=function(h,l){const d=h.cameraToCenterDistance,v=h._centerAltitude*l,S=h._camera,R=h._camera.forward(),g=Ae.vec3.add([],Ae.vec3.scale([],R,-d),[0,0,v]),E=h.worldSize/(2*Math.PI),D=[0,0,-E],T=h.width/h.height,A=Math.tan(h.fovAboveCenter),z=Ae.vec3.scale([],S.up(),A),B=Ae.vec3.scale([],S.right(),A*T),N=Ae.vec3.normalize([],Ae.vec3.add([],Ae.vec3.add([],R,z),B)),Z=[];let X;if(new xi(g,N).closestPointOnSphere(D,E,Z)){const q=Ae.vec3.add([],Z,D),Y=Ae.vec3.sub([],q,g);X=Math.cos(h.fovAboveCenter)*Ae.vec3.length(Y)}else{const q=Ae.vec3.sub([],g,D),Y=Ae.vec3.sub([],D,g);Ae.vec3.normalize(Y,Y);const K=Ae.vec3.length(q)-E;X=Math.sqrt(K*(K+2*E));const re=Math.acos(X/(E+K))-Math.acos(Ae.vec3.dot(R,Y));X*=Math.cos(re)}return 1.01*X}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),s=oa(e.zoom);if(s>0){const h=Ax(e,sa(1,e.center.lat)*e.worldSize),l=e.worldSize/(2*Math.PI),d=Math.max(e.width,e.height)/e.worldSize*Math.PI;return di(i,h+l*(1-Math.cos(d)),Math.pow(s,10))}return i}upVector(e,i,s){return hr(i,s,e,1)}upVectorScale(e){return{metersToTile:mi(Qi(Fr(e)))}}}function Ox(a){const e=a.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(a.name){case"mercator":return new Dx(a);case"equirectangular":return new hT(a);case"naturalEarth":return new dT(a);case"equalEarth":return new uT(a);case"winkelTripel":return new pT(a);case"albers":return i?new zx(a):new cT(a);case"lambertConformalConic":return i?new zx(a):new fT(a);case"globe":return new mT(a)}throw new Error(`Invalid projection name: ${a.name}`)}const _T=Ah.VectorTileFeature.types,gT=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Ng(a,e,i,s,h,l,d,v,S,R,g,E,D){const T=v?Math.min(Pf,Math.round(v[0])):0,A=v?Math.min(Pf,Math.round(v[1])):0;a.emplaceBack(e,i,Math.round(32*s),Math.round(32*h),l,d,(T<<1)+(S?1:0),A,16*R,16*g,256*E,256*D)}function Vg(a,e,i){a.emplaceBack(e,i)}function Ug(a,e,i,s,h,l,d){a.emplaceBack(e,i,s,h,l,d)}function jg(a,e,i,s,h){a.emplaceBack(e,i,s,h),a.emplaceBack(e,i,s,h),a.emplaceBack(e,i,s,h),a.emplaceBack(e,i,s,h)}function yT(a){for(const e of a.sections)if(xl(e.text))return!0;return!1}class cv{constructor(e){this.layoutVertexArray=new hh,this.indexArray=new Ln,this.programConfigurations=e,this.segments=new Xr,this.dynamicLayoutVertexArray=new Cl,this.opacityVertexArray=new wd,this.placedSymbolArray=new Td,this.iconTransitioningVertexArray=new Dl,this.globeExtVertexArray=new df,this.zOffsetVertexArray=new Hs}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,i,s,h,l){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ig.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Su.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,gT,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,Mu.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,h_.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||l)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,Eu.members,!0)),this.opacityVertexBuffer.itemSize=1),(s||h)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Zt(cv,"SymbolBuffers");class uv{constructor(e,i,s){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new s,this.segments=new Xr,this.collisionVertexArray=new uu,this.collisionVertexArrayExt=new Cl}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,qd.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Gd.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Zt(uv,"CollisionBuffers");class qg{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(d=>d.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ae.mat4.identity([]),this.placementViewportMatrix=Ae.mat4.identity([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Jp(this.zoom,i["text-size"]),this.iconSizeData=Jp(this.zoom,i["icon-size"]);const s=this.layers[0].layout,h=s.get("symbol-sort-key"),l=s.get("symbol-z-order");this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=l!=="viewport-y"&&h.constantOr(1)!==void 0,this.sortFeaturesByY=(l==="viewport-y"||l==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=s.get("text-writing-mode").map(d=>xe[d]),this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=s.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new cv(new Ga(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new cv(new Ga(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new Ed,this.lineVertexArray=new Wn,this.symbolInstances=new Sp}calculateGlyphDependencies(e,i,s,h,l){for(const d of e){const v=d.codePointAt(0);if(v===void 0)break;if(i[v]=!0,h&&l&&v<=65535){const S=Au[d];S&&(i[S.charCodeAt(0)]=!0)}}}updateFootprints(e,i){}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const s=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!Pd(this.activeReplacements,s)&&(this.activeReplacements=s,!0)}populate(e,i,s,h){const l=this.layers[0],d=l.layout,v=this.projection.name==="globe",S=d.get("text-font"),R=d.get("text-field"),g=d.get("icon-image"),[E,D]=d.get("icon-size-scale-range"),T=Mi(i.scaleFactor||1,E,D),A=(R.value.kind!=="constant"||R.value.value instanceof Rn&&!R.value.value.isEmpty()||R.value.value.toString().length>0)&&(S.value.kind!=="constant"||S.value.value.length>0),z=g.value.kind!=="constant"||!!g.value.value||Object.keys(g.parameters).length>0,B=d.get("symbol-sort-key");if(this.features=[],!A&&!z)return;const N=i.iconDependencies,Z=i.glyphDependencies,X=i.availableImages,q=new wr(this.zoom);for(const{feature:Y,id:K,index:re,sourceLayerIndex:he}of e){const ue=l._featureFilter.needGeometry,ce=V(Y,ue);if(!l._featureFilter.filter(q,ce,s))continue;if(ue||(ce.geometry=F(Y,s,h)),v&&Y.type!==1&&s.z<=5){const Me=ce.geometry,Le=.98078528056,ke=(Ue,Pe)=>{const at=hr(Ue.x,Ue.y,s,1),mt=hr(Pe.x,Pe.y,s,1);return Ae.vec3.dot(at,mt)<Le};for(let Ue=0;Ue<Me.length;Ue++)Me[Ue]=b(Me[Ue],ke)}let Te,de;if(A){const Me=l.getValueAndResolveTokens("text-field",ce,s,X),Le=Rn.factory(Me);yT(Le)&&(this.hasRTLText=!0),(!this.hasRTLText||au()==="unavailable"||this.hasRTLText&&Pr.isParsed())&&(Te=em(Le,l,ce))}if(z){const Me=l.getValueAndResolveTokens("icon-image",ce,s,X);de=Me instanceof ea?Me:ea.build(Me)}if(!Te&&!de)continue;const Se=this.sortFeaturesByKey?B.evaluate(ce,{},s):void 0,Ce={id:K,text:Te,icon:de,index:re,sourceLayerIndex:he,geometry:ce.geometry,properties:Y.properties,type:_T[Y.type],sortKey:Se};if(this.features.push(Ce),de){const Me=f_(this.iconSizeData,this.layers[0]._unevaluatedLayout._values["icon-size"],s,this.zoom,Ce)*T*this.pixelRatio,Le=de.getPrimary().scaleSelf(Me);if(N[Le.id]=N[Le.id]||[],N[Le.id].push(Le),de.nameSecondary){const ke=de.getSecondary().scaleSelf(Me);N[ke.id]=N[ke.id]||[],N[ke.id].push(ke)}}if(Te){const Me=S.evaluate(ce,{},s).join(","),Le=d.get("text-rotation-alignment")==="map"&&d.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(xe.vertical)>=0;for(const ke of Te.sections)if(ke.image){const Ue=ke.image.getPrimary().scaleSelf(this.pixelRatio);N[Ue.id]=N[Ue.id]||[],N[Ue.id].push(Ue)}else{const Ue=Ur(Te.toString()),Pe=ke.fontStack||Me,at=Z[Pe]=Z[Pe]||{};this.calculateGlyphDependencies(ke.text,at,Le,this.allowVerticalPlacement,Ue)}}}d.get("symbol-placement")==="line"&&(this.features=function(Y){const K={},re={},he=[];let ue=0;function ce(Ce){he.push(Y[Ce]),ue++}function Te(Ce,Me,Le){const ke=re[Ce];return delete re[Ce],re[Me]=ke,he[ke].geometry[0].pop(),he[ke].geometry[0]=he[ke].geometry[0].concat(Le[0]),ke}function de(Ce,Me,Le){const ke=K[Me];return delete K[Me],K[Ce]=ke,he[ke].geometry[0].shift(),he[ke].geometry[0]=Le[0].concat(he[ke].geometry[0]),ke}function Se(Ce,Me,Le){const ke=Le?Me[0][Me[0].length-1]:Me[0][0];return`${Ce}:${ke.x}:${ke.y}`}for(let Ce=0;Ce<Y.length;Ce++){const Me=Y[Ce],Le=Me.geometry,ke=Me.text?Me.text.toString():null;if(!ke){ce(Ce);continue}const Ue=Se(ke,Le),Pe=Se(ke,Le,!0);if(Ue in re&&Pe in K&&re[Ue]!==K[Pe]){const at=de(Ue,Pe,Le),mt=Te(Ue,Pe,he[at].geometry);delete K[Ue],delete re[Pe],re[Se(ke,he[mt].geometry,!0)]=mt,he[at].geometry=null}else Ue in re?Te(Ue,Pe,Le):Pe in K?de(Ue,Pe,Le):(ce(Ce),K[Ue]=ue-1,re[Pe]=ue-1)}return he.filter(Ce=>Ce.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Y,K)=>Y.sortKey-K.sortKey)}update(e,i,s,h,l,d,v){this.text.programConfigurations.updatePaintArrays(e,i,l,s,h,d,v),this.icon.programConfigurations.updatePaintArrays(e,i,l,s,h,d,v)}updateZOffset(){const e=(l,d,v)=>{s+=d,s>l.length&&l.resize(s);for(let S=-d;S<0;S++)l.emplace(S+s,v)},i=(l,d,v)=>{h+=d,h>l.length&&l.resize(h);for(let S=-d;S<0;S++)l.emplace(S+h,v)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let s=0,h=0;for(let l=0;l<this.symbolInstances.length;l++){const d=this.symbolInstances.get(l),{numHorizontalGlyphVertices:v,numVerticalGlyphVertices:S,numIconVertices:R}=d,g=d.zOffset,E=R>0;if((v>0||S>0)&&(e(this.text.zOffsetVertexArray,v,g),e(this.text.zOffsetVertexArray,S,g)),E){const{placedIconSymbolIndex:D,verticalPlacedIconSymbolIndex:T}=d;D>=0&&i(this.icon.zOffsetVertexArray,R,g),T>=0&&i(this.icon.zOffsetVertexArray,d.numVerticalIconVertices,g)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Ox(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const s=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:h,y:l}of i)this.lineVertexArray.emplaceBack(h,l);return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,i,s,h,l,d,v,S,R,g,E,D,T,A,z,B){const N=e.indexArray,Z=e.layoutVertexArray,X=e.globeExtVertexArray,q=e.segments.prepareSegment(4*i.length,Z,N,this.canOverlap?d.sortKey:void 0),Y=this.glyphOffsetArray.length,K=q.vertexLength,re=this.allowVerticalPlacement&&v===xe.vertical?Math.PI/2:0,he=d.text&&d.text.sections;for(let ce=0;ce<i.length;ce++){const{tl:Te,tr:de,bl:Se,br:Ce,texPrimary:Me,texSecondary:Le,pixelOffsetTL:ke,pixelOffsetBR:Ue,minFontScaleX:Pe,minFontScaleY:at,glyphOffset:mt,isSDF:nt,sectionIndex:Bt}=i[ce],Ot=q.vertexLength,bt=mt[1];if(Ng(Z,R.x,R.y,Te.x,bt+Te.y,Me.x,Me.y,s,nt,ke.x,ke.y,Pe,at),Ng(Z,R.x,R.y,de.x,bt+de.y,Me.x+Me.w,Me.y,s,nt,Ue.x,ke.y,Pe,at),Ng(Z,R.x,R.y,Se.x,bt+Se.y,Me.x,Me.y+Me.h,s,nt,ke.x,Ue.y,Pe,at),Ng(Z,R.x,R.y,Ce.x,bt+Ce.y,Me.x+Me.w,Me.y+Me.h,s,nt,Ue.x,Ue.y,Pe,at),S){const{x:yt,y:ei,z:jt}=S.anchor,[Wt,Ti,zi]=S.up;Ug(X,yt,ei,jt,Wt,Ti,zi),Ug(X,yt,ei,jt,Wt,Ti,zi),Ug(X,yt,ei,jt,Wt,Ti,zi),Ug(X,yt,ei,jt,Wt,Ti,zi),jg(e.dynamicLayoutVertexArray,yt,ei,jt,re)}else jg(e.dynamicLayoutVertexArray,R.x,R.y,R.z,re);if(B){const yt=Le||Me;Vg(e.iconTransitioningVertexArray,yt.x,yt.y),Vg(e.iconTransitioningVertexArray,yt.x+yt.w,yt.y),Vg(e.iconTransitioningVertexArray,yt.x,yt.y+yt.h),Vg(e.iconTransitioningVertexArray,yt.x+yt.w,yt.y+yt.h)}N.emplaceBack(Ot,Ot+1,Ot+2),N.emplaceBack(Ot+1,Ot+2,Ot+3),q.vertexLength+=4,q.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(mt[0]),ce!==i.length-1&&Bt===i[ce+1].sectionIndex||e.programConfigurations.populatePaintArrays(Z.length,d,d.index,{},T,A,z,he&&he[Bt])}const ue=S?S.anchor:R;e.placedSymbolArray.emplaceBack(ue.x,ue.y,ue.z,R.x,R.y,Y,this.glyphOffsetArray.length-Y,K,g,E,R.segment,s?s[0]:0,s?s[1]:0,h[0],h[1],v,0,!1,0,D,0)}_commitLayoutVertex(e,i,s,h,l,d,v){e.emplaceBack(i,s,h,l,d,Math.round(v.x),Math.round(v.y))}_addCollisionDebugVertices(e,i,s,h,l,d,v){const S=s.segments.prepareSegment(4,s.layoutVertexArray,s.indexArray),R=S.vertexLength,g=v.tileAnchorX,E=v.tileAnchorY;for(let T=0;T<4;T++)s.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(s.collisionVertexArrayExt,i,e.padding,v.zOffset),this._commitLayoutVertex(s.layoutVertexArray,h,l,d,g,E,new Rt(e.x1,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,h,l,d,g,E,new Rt(e.x2,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,h,l,d,g,E,new Rt(e.x2,e.y2)),this._commitLayoutVertex(s.layoutVertexArray,h,l,d,g,E,new Rt(e.x1,e.y2)),S.vertexLength+=4;const D=s.indexArray;D.emplaceBack(R,R+1),D.emplaceBack(R+1,R+2),D.emplaceBack(R+2,R+3),D.emplaceBack(R+3,R),S.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,s,h,l,d){for(let v=h;v<l;v++){const S=s.get(v),R=this.getSymbolInstanceTextSize(e,d,i,v);this._addCollisionDebugVertices(S,R,this.textCollisionBox,S.projectedAnchorX,S.projectedAnchorY,S.projectedAnchorZ,d)}}_addIconDebugCollisionBoxes(e,i,s,h,l,d){for(let v=h;v<l;v++){const S=s.get(v),R=this.getSymbolInstanceIconSize(e,i,d.placedIconSymbolIndex);this._addCollisionDebugVertices(S,R,this.iconCollisionBox,S.projectedAnchorX,S.projectedAnchorY,S.projectedAnchorZ,d)}}generateCollisionDebugBuffers(e,i,s){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new uv(Il,wc.members,Dl),this.iconCollisionBox=new uv(Il,wc.members,Dl);const h=Lh(this.iconSizeData,e),l=Lh(this.textSizeData,e,s);for(let d=0;d<this.symbolInstances.length;d++){const v=this.symbolInstances.get(d);this._addTextDebugCollisionBoxes(l,e,i,v.textBoxStartIndex,v.textBoxEndIndex,v),this._addTextDebugCollisionBoxes(l,e,i,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v),this._addIconDebugCollisionBoxes(h,e,i,v.iconBoxStartIndex,v.iconBoxEndIndex,v),this._addIconDebugCollisionBoxes(h,e,i,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex,v)}}getSymbolInstanceTextSize(e,i,s,h){const l=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:h),d=Oh(this.textSizeData,e,l)/la;return this.tilePixelRatio*d}getSymbolInstanceIconSize(e,i,s){const h=this.icon.placedSymbolArray.get(s),l=Oh(this.iconSizeData,e,h);return this.tilePixelRatio*l}_commitDebugCollisionVertexUpdate(e,i,s,h){e.emplaceBack(i,-s,-s,h),e.emplaceBack(i,s,-s,h),e.emplaceBack(i,s,s,h),e.emplaceBack(i,-s,s,h)}_updateTextDebugCollisionBoxes(e,i,s,h,l,d,v){for(let S=h;S<l;S++){const R=s.get(S),g=this.getSymbolInstanceTextSize(e,d,i,S);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,g,R.padding,d.zOffset)}}_updateIconDebugCollisionBoxes(e,i,s,h,l,d,v){for(let S=h;S<l;S++){const R=s.get(S),g=this.getSymbolInstanceIconSize(e,i,d.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,g,R.padding,d.zOffset)}}updateCollisionDebugBuffers(e,i,s,h){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const l=Lh(this.iconSizeData,e,h),d=Lh(this.textSizeData,e,s);for(let v=0;v<this.symbolInstances.length;v++){const S=this.symbolInstances.get(v);this._updateTextDebugCollisionBoxes(d,e,i,S.textBoxStartIndex,S.textBoxEndIndex,S,s),this._updateTextDebugCollisionBoxes(d,e,i,S.verticalTextBoxStartIndex,S.verticalTextBoxEndIndex,S,s),this._updateIconDebugCollisionBoxes(l,e,i,S.iconBoxStartIndex,S.iconBoxEndIndex,S,h),this._updateIconDebugCollisionBoxes(l,e,i,S.verticalIconBoxStartIndex,S.verticalIconBoxEndIndex,S,h)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,s,h,l,d,v,S,R){const g={};if(i<s){const{x1:E,y1:D,x2:T,y2:A,padding:z,projectedAnchorX:B,projectedAnchorY:N,projectedAnchorZ:Z,tileAnchorX:X,tileAnchorY:q,featureIndex:Y}=e.get(i);g.textBox={x1:E,y1:D,x2:T,y2:A,padding:z,projectedAnchorX:B,projectedAnchorY:N,projectedAnchorZ:Z,tileAnchorX:X,tileAnchorY:q},g.textFeatureIndex=Y}if(h<l){const{x1:E,y1:D,x2:T,y2:A,padding:z,projectedAnchorX:B,projectedAnchorY:N,projectedAnchorZ:Z,tileAnchorX:X,tileAnchorY:q,featureIndex:Y}=e.get(h);g.verticalTextBox={x1:E,y1:D,x2:T,y2:A,padding:z,projectedAnchorX:B,projectedAnchorY:N,projectedAnchorZ:Z,tileAnchorX:X,tileAnchorY:q},g.verticalTextFeatureIndex=Y}if(d<v){const{x1:E,y1:D,x2:T,y2:A,padding:z,projectedAnchorX:B,projectedAnchorY:N,projectedAnchorZ:Z,tileAnchorX:X,tileAnchorY:q,featureIndex:Y}=e.get(d);g.iconBox={x1:E,y1:D,x2:T,y2:A,padding:z,projectedAnchorX:B,projectedAnchorY:N,projectedAnchorZ:Z,tileAnchorX:X,tileAnchorY:q},g.iconFeatureIndex=Y}if(S<R){const{x1:E,y1:D,x2:T,y2:A,padding:z,projectedAnchorX:B,projectedAnchorY:N,projectedAnchorZ:Z,tileAnchorX:X,tileAnchorY:q,featureIndex:Y}=e.get(S);g.verticalIconBox={x1:E,y1:D,x2:T,y2:A,padding:z,projectedAnchorX:B,projectedAnchorY:N,projectedAnchorZ:Z,tileAnchorX:X,tileAnchorY:q},g.verticalIconFeatureIndex=Y}return g}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const s=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,i){const s=e.placedSymbolArray.get(i),h=s.vertexStartIndex+4*s.numGlyphs;for(let l=s.vertexStartIndex;l<h;l+=4)e.indexArray.emplaceBack(l,l+1,l+2),e.indexArray.emplaceBack(l+1,l+2,l+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),s=Math.cos(e),h=[],l=[],d=[];for(let v=0;v<this.symbolInstances.length;++v){d.push(v);const S=this.symbolInstances.get(v);h.push(0|Math.round(i*S.tileAnchorX+s*S.tileAnchorY)),l.push(S.featureIndex)}return d.sort((v,S)=>h[v]-h[S]||l[S]-l[v]),d}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,i){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===i?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const s=this.symbolInstances.get(i);this.featureSortOrder.push(s.featureIndex);const{rightJustifiedTextSymbolIndex:h,centerJustifiedTextSymbolIndex:l,leftJustifiedTextSymbolIndex:d,verticalPlacedTextSymbolIndex:v,placedIconSymbolIndex:S,verticalPlacedIconSymbolIndex:R}=s;h>=0&&this.addIndicesForPlacedSymbol(this.text,h),l>=0&&l!==h&&this.addIndicesForPlacedSymbol(this.text,l),d>=0&&d!==l&&d!==h&&this.addIndicesForPlacedSymbol(this.text,d),v>=0&&this.addIndicesForPlacedSymbol(this.text,v),S>=0&&this.addIndicesForPlacedSymbol(this.icon,S),R>=0&&this.addIndicesForPlacedSymbol(this.icon,R)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Lx,Px,hv;Zt(qg,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),qg.addDynamicAttributes=jg;class kx{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Fs,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Zt(kx,"FormatSectionOverride",{omit:["defaultValue"]});const fv=()=>hv||(hv={layout:Lx||(Lx=new jr({"symbol-placement":new wt(Ge.layout_symbol["symbol-placement"]),"symbol-spacing":new wt(Ge.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new wt(Ge.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Gt(Ge.layout_symbol["symbol-sort-key"]),"symbol-z-order":new wt(Ge.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new wt(Ge.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new wt(Ge.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new wt(Ge.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new wt(Ge.layout_symbol["icon-ignore-placement"]),"icon-optional":new wt(Ge.layout_symbol["icon-optional"]),"icon-rotation-alignment":new wt(Ge.layout_symbol["icon-rotation-alignment"]),"icon-size":new Gt(Ge.layout_symbol["icon-size"]),"icon-size-scale-range":new wt(Ge.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Gt(Ge.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Gt(Ge.layout_symbol["icon-text-fit-padding"]),"icon-image":new Gt(Ge.layout_symbol["icon-image"]),"icon-rotate":new Gt(Ge.layout_symbol["icon-rotate"]),"icon-padding":new wt(Ge.layout_symbol["icon-padding"]),"icon-keep-upright":new wt(Ge.layout_symbol["icon-keep-upright"]),"icon-offset":new Gt(Ge.layout_symbol["icon-offset"]),"icon-anchor":new Gt(Ge.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new wt(Ge.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new wt(Ge.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new wt(Ge.layout_symbol["text-rotation-alignment"]),"text-field":new Gt(Ge.layout_symbol["text-field"]),"text-font":new Gt(Ge.layout_symbol["text-font"]),"text-size":new Gt(Ge.layout_symbol["text-size"]),"text-size-scale-range":new wt(Ge.layout_symbol["text-size-scale-range"]),"text-max-width":new Gt(Ge.layout_symbol["text-max-width"]),"text-line-height":new Gt(Ge.layout_symbol["text-line-height"]),"text-letter-spacing":new Gt(Ge.layout_symbol["text-letter-spacing"]),"text-justify":new Gt(Ge.layout_symbol["text-justify"]),"text-radial-offset":new Gt(Ge.layout_symbol["text-radial-offset"]),"text-variable-anchor":new wt(Ge.layout_symbol["text-variable-anchor"]),"text-anchor":new Gt(Ge.layout_symbol["text-anchor"]),"text-max-angle":new wt(Ge.layout_symbol["text-max-angle"]),"text-writing-mode":new wt(Ge.layout_symbol["text-writing-mode"]),"text-rotate":new Gt(Ge.layout_symbol["text-rotate"]),"text-padding":new wt(Ge.layout_symbol["text-padding"]),"text-keep-upright":new wt(Ge.layout_symbol["text-keep-upright"]),"text-transform":new Gt(Ge.layout_symbol["text-transform"]),"text-offset":new Gt(Ge.layout_symbol["text-offset"]),"text-allow-overlap":new wt(Ge.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new wt(Ge.layout_symbol["text-ignore-placement"]),"text-optional":new wt(Ge.layout_symbol["text-optional"]),visibility:new wt(Ge.layout_symbol.visibility)})),paint:Px||(Px=new jr({"icon-opacity":new Gt(Ge.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Gt(Ge.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Gt(Ge.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Gt(Ge.paint_symbol["text-emissive-strength"]),"icon-color":new Gt(Ge.paint_symbol["icon-color"]),"icon-halo-color":new Gt(Ge.paint_symbol["icon-halo-color"]),"icon-halo-width":new Gt(Ge.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Gt(Ge.paint_symbol["icon-halo-blur"]),"icon-translate":new wt(Ge.paint_symbol["icon-translate"]),"icon-translate-anchor":new wt(Ge.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Gt(Ge.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Gt(Ge.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Gt(Ge.paint_symbol["text-occlusion-opacity"]),"text-color":new Gt(Ge.paint_symbol["text-color"],{runtimeType:Un,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new Gt(Ge.paint_symbol["text-halo-color"]),"text-halo-width":new Gt(Ge.paint_symbol["text-halo-width"]),"text-halo-blur":new Gt(Ge.paint_symbol["text-halo-blur"]),"text-translate":new wt(Ge.paint_symbol["text-translate"]),"text-translate-anchor":new wt(Ge.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new wt(Ge.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new wt(Ge.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new wt(Ge.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new wt(Ge.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Gt(Ge.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"})}))},hv);class Gg extends _n{constructor(e,i,s,h){super(e,fv(),i,s,h),this._colorAdjustmentMatrix=Ae.mat4.identity([]),this.hasInitialOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const s=this.layout.get("text-writing-mode");if(s){const h=[];for(const l of s)h.indexOf(l)<0&&h.push(l);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,i,s,h){return this._saturation===e&&this._contrast===i&&this._brightnessMin===s&&this._brightnessMax===h||(this._colorAdjustmentMatrix=function(l,d,v,S){l=Pc(l),d=zu(d);const R=Ae.mat4.create(),g=l/3,E=1-2*g,D=[E,g,g,0,g,E,g,0,g,g,E,0,0,0,0,1],T=.5-.5*d,A=S-v;return Ae.mat4.multiply(R,[A,0,0,0,0,A,0,0,0,0,A,0,v,v,v,1],[d,0,0,0,0,d,0,0,0,0,d,0,T,T,T,1]),Ae.mat4.multiply(R,R,D),R}(e,i,s,h),this._saturation=e,this._contrast=i,this._brightnessMin=s,this._brightnessMax=h),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,i,s,h){const l=this.layout.get(e).evaluate(i,{},s,h),d=this._unevaluatedLayout._values[e];return d.isDataDriven()||Jc(d.value)||!l?l:function(v,S){return S.replace(/{([^{}]+)}/g,(R,g)=>g in v?String(v[g]):"")}(i.properties,l)}createBucket(e){return new qg(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of fv().paint.overridableProperties){if(!Gg.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),s=new kx(i),h=new lf(s,i.property.specification,this.scope,this.options);let l=null;l=i.value.kind==="constant"||i.value.kind==="source"?new eu("source",h):new Bo("composite",h,i.value.zoomStops,i.value._interpolationType),this.paint._values[e]=new Ml(i.property,l,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,s){return!(!this.layout||i.isDataDriven()||s.isDataDriven())&&Gg.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const s=e.get("text-field"),h=fv().paint.properties[i];let l=!1;const d=v=>{for(const S of v)if(h.overrides&&h.overrides.hasOverride(S))return void(l=!0)};if(s.value.kind==="constant"&&s.value.value instanceof Rn)d(s.value.value.sections);else if(s.value.kind==="source"){const v=R=>{l||(R instanceof qn&&Hr(R.value)===$a?d(R.value.sections):R instanceof rl?d(R.sections):R.eachChild(v))},S=s.value;S._styleExpression&&v(S._styleExpression.expression)}return l}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,i,s){return{config:new go(this,{zoom:i,lut:s}),overrideFog:!1}}}let Fx,Bx,Nx,Vx;var dv=cr([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function pv(a){switch(a){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function mv(a){switch(a){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class _v{constructor(e,i,s,h){this.context=e,this.format=s,this.useMipmap=h&&h.useMipmap,this.texture=e.gl.createTexture(),this.update(i,{premultiply:h&&h.premultiply})}update(e,i){const s=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,h=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:l}=this,{gl:d}=l,{x:v,y:S}=i&&i.position?i.position:{x:0,y:0},R=v+s,g=S+h;!this.size||this.size[0]===R&&this.size[1]===g||(d.bindTexture(d.TEXTURE_2D,null),d.deleteTexture(this.texture),this.texture=d.createTexture(),this.size=null),d.bindTexture(d.TEXTURE_2D,this.texture),l.pixelStoreUnpackFlipY.set(!1),l.pixelStoreUnpack.set(1),l.pixelStoreUnpackPremultiplyAlpha.set(this.format===d.RGBA8&&(!i||i.premultiply!==!1));const E=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&R>0&&g>0){const D=this.useMipmap?Math.floor(Math.log2(Math.max(R,g)))+1:1;d.texStorage2D(d.TEXTURE_2D,D,this.format,R,g),this.size=[R,g]}if(this.size)if(E)d.texSubImage2D(d.TEXTURE_2D,0,v,S,pv(this.format),mv(this.format),e);else{const D=e.data;D&&d.texSubImage2D(d.TEXTURE_2D,0,v,S,s,h,pv(this.format),mv(this.format),D)}this.useMipmap&&d.generateMipmap(d.TEXTURE_2D)}bind(e,i,s=!1){const{context:h}=this,{gl:l}=h;l.bindTexture(l.TEXTURE_2D,this.texture),e!==this.minFilter&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,e),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,this.useMipmap&&!s?e===l.NEAREST?l.NEAREST_MIPMAP_NEAREST:l.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,i),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(e,i,s,h){const{context:l}=this,{gl:d}=l;d.bindTexture(d.TEXTURE_2D,this.texture),i!==this.magFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,i),this.magFilter=i),e!==this.minFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,this.useMipmap?e===d.NEAREST?d.NEAREST_MIPMAP_NEAREST:d.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),s!==this.wrapS&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,s),this.wrapS=s),h!==this.wrapT&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,h),this.wrapT=h)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Hg{constructor(e,i){this.context=e,this.texture=i}bind(e,i){const{context:s}=this,{gl:h}=s;h.bindTexture(h.TEXTURE_2D,this.texture),e!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,e),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,i),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,i),this.wrapS=i)}}function Zg(a,e,i,s,h,l,d,v){const S=[a,e,1,i,s,1,h,l,1],R=[d,v,1],g=Ae.mat3.adjoint([],S),[E,D,T]=Ae.vec3.transformMat3(R,R,g);return Ae.mat3.multiply(S,S,[E,0,0,0,D,0,0,0,T])}function Ux(a,e,i,s,h,l,d,v){const S=function(R,g,E,D,T,A,z,B){const N=Zg(0,0,1,0,1,1,0,1),Z=Zg(R,g,E,D,T,A,z,B),X=Ae.mat3.adjoint([],N);return Ae.mat3.multiply(Z,Z,X)}(a,e,i,s,h,l,d,v);return[S[2]/S[8]/zt,S[5]/S[8]/zt]}function Xg(a){return[a[0],Math.min(Math.max(a[1],-85.051129),Tr)]}class jx extends Co{constructor(e,i,s,h){super(),this.id=e,this.dispatcher=s,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(h),this.options=i,this._dirty=!1}load(e,i){if(this._loaded=i||!1,this.fire(new ks("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Uh(this.map._requestManager.transformRequest(this.url,sr.Image),(s,h)=>{this._imageRequest=null,this._loaded=!0,s?this.fire(new Mo(s)):h&&(this.image=h instanceof HTMLImageElement?ye.getImageData(h):h,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Hg(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new ks("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Hg||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=e[0][1],s=e[0][1];for(const l of e)l[1]>s&&(s=l[1]),l[1]<i&&(i=l[1]);const h=(s+i)/2;if(h>Tr?this.onNorthPole=!0:h<-85.051129&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const l=e.map(r.fromLngLat);this.tileID=function(d){let v=1/0,S=1/0,R=-1/0,g=-1/0;for(const z of d)v=Math.min(v,z.x),S=Math.min(S,z.y),R=Math.max(R,z.x),g=Math.max(g,z.y);const E=Math.max(R-v,g-S),D=Math.max(0,Math.floor(-Math.log(E)/Math.LN2)),T=Math.pow(2,D);let A=Math.floor((v+R)/2*T);return A>1&&(A-=1),new dt(D,A,Math.floor((S+g)/2*T))}(l),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new ks("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const N in this.tiles){const Z=this.tiles[N];Z.state!=="loaded"&&(Z.state="loaded",Z.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const i=y_(new dt(0,0,0),this.map.transform.projection),s=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(N){const Z=N[1].x-N[0].x,X=N[1].y-N[0].y,q=N[2].x-N[1].x,Y=N[2].y-N[1].y,K=N[3].x-N[2].x,re=N[3].y-N[2].y,he=N[0].x-N[3].x,ue=N[0].y-N[3].y,ce=Z*Y-q*X,Te=q*re-K*Y,de=K*ue-he*re,Se=he*X-Z*ue;return ce>0&&Te>0&&de>0&&Se>0||ce<0&&Te<0&&de<0&&Se<0}(s))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const h=y_(this.tileID,this.map.transform.projection),[l,d,v,S]=this.coordinates.map(N=>{const Z=h.projection.project(N[0],N[1]);return Cx(h,Z)._round()});this.perspectiveTransform=Ux(l.x,l.y,d.x,d.y,v.x,v.y,S.x,S.y);const R=this._boundsArray=new Gs;R.emplaceBack(l.x,l.y,0,0),R.emplaceBack(d.x,d.y,zt,0),R.emplaceBack(S.x,S.y,0,zt),R.emplaceBack(v.x,v.y,zt,zt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(R,dv.members),this.boundsSegments=Xr.simpleSegment(0,0,4,2);const g=[],E=[Xg((D=this.coordinates)[0]),Xg(D[1]),Xg(D[2]),Xg(D[3])];var D;const[T,A,z,B]=function(N){let Z=N[0][0],X=Z,q=N[0][1],Y=q;for(let K=1;K<N.length;K++)N[K][0]<Z?Z=N[K][0]:N[K][0]>X&&(X=N[K][0]),N[K][1]<q?q=N[K][1]:N[K][1]>Y&&(Y=N[K][1]);return[Z,q,X-Z,Y-q]}(E);{const N=new Gs,[Z,X,q,Y]=function(ke){let Ue=ke[0].x,Pe=Ue,at=ke[0].y,mt=at;for(let nt=1;nt<ke.length;nt++)ke[nt].x<Ue?Ue=ke[nt].x:ke[nt].x>Pe&&(Pe=ke[nt].x),ke[nt].y<at?at=ke[nt].y:ke[nt].y>mt&&(mt=ke[nt].y);return[Ue,at,Pe-Ue,mt-at]}(s),K=ke=>[(ke.x-Z)/q,(ke.y-X)/Y],[re,he,ue,ce]=s.map(K),Te=function(ke,Ue,Pe,at,mt,nt,Bt,Ot){const bt=Zg(0,0,1,0,1,1,0,1),yt=Zg(ke,Ue,Pe,at,mt,nt,Bt,Ot),ei=Ae.mat3.adjoint([],yt);return Ae.mat3.multiply(bt,bt,ei)}(re[0],re[1],he[0],he[1],ue[0],ue[1],ce[0],ce[1]);this.elevatedGlobePerspectiveTransform=Ux(re[0],re[1],he[0],he[1],ue[0],ue[1],ce[0],ce[1]);const de=(ke,Ue)=>{g.push(ke.lng);const Pe=Math.round((ke.lng-T)/z*zt),at=Math.round((ke.lat-A)/B*zt),mt=K(Ue),nt=Ae.vec3.transformMat3([],[mt[0],mt[1],1],Te),Bt=Math.round(nt[0]/nt[2]*zt),Ot=Math.round(nt[1]/nt[2]*zt);N.emplaceBack(Pe,at,Bt,Ot)},Se=s[3].x-s[0].x,Ce=s[3].y-s[0].y,Me=s[2].x-s[1].x,Le=s[2].y-s[1].y;for(let ke=0;ke<65;ke++){const Ue=ke/64,Pe=[s[0].x+Ue*Se,s[0].y+Ue*Ce],at=[s[1].x+Ue*Me,s[1].y+Ue*Le],mt=at[0]-Pe[0],nt=at[1]-Pe[1];for(let Bt=0;Bt<65;Bt++){const Ot=Bt/64,bt={x:Pe[0]+mt*Ot,y:Pe[1]+nt*Ot};de(i.projection.unproject(bt.x,bt.y),bt)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(N,dv.members)}{this.maxLongitudeTriangleSize=0;let N=[],Z=new Ln;const X=(q,Y,K)=>{Z.emplaceBack(q,Y,K);const re=g[q],he=g[Y],ue=g[K],ce=Math.min(Math.min(re,he),ue),Te=Math.max(Math.max(re,he),ue)-ce;Te>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Te),N.push(ce+Te/2)};for(let q=0;q<64;q++)for(let Y=0;Y<64;Y++){const K=65*q+Y,re=K+1,he=K+65,ue=he+1;X(K,he,re),X(re,he,ue)}[N,Z]=function(q,Y){const K=Array.from({length:q.length},(ue,ce)=>ce);K.sort((ue,ce)=>q[ue]-q[ce]);const re=[],he=new Ln;for(let ue=0;ue<K.length;ue++){const ce=K[ue];re.push(q[ce]);const Te=3*ce,de=Te+1;he.emplaceBack(Y.uint16[Te],Y.uint16[de],Y.uint16[de+1])}return[re,he]}(N,Z),this.elevatedGlobeTrianglesCenterLongitudes=N,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(Z)}this.elevatedGlobeSegments=Xr.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,z/zt,0,B/zt,0,0,A,T,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const i=this.map.painter.context,s=i.gl;!this._dirty||this.texture instanceof Hg||(this.texture?this.texture.update(this.image):(this.texture=new _v(i,this.image,s.RGBA8),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(i)}loadTile(e,i){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},i(null)):(e.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;const s=this.elevatedGlobeTrianglesCenterLongitudes;let h=(l=e+180)+360*Math.round((s[0]-l)/360);var l;const d=new Xr,v=(E,D)=>{d.segments.push({vertexOffset:0,primitiveOffset:E,vertexLength:i.segments[0].vertexLength,primitiveLength:D,sortKey:void 0,vaos:{}})},S=.51*this.maxLongitudeTriangleSize;if(Math.abs(s[0]-h)<=S){const E=Zl(s,0,s.length,h+S);return E===s.length||v(E,Vh(s,E+1,s.length,h+360-S)-E),d}h<s[0]&&(h+=360);const R=Vh(s,0,s.length,h-S);if(R===s.length)return v(0,s.length),d;v(0,R-0);const g=Zl(s,R+1,s.length,h+S);return g!==s.length&&v(g,s.length-g),d}}const vT=(Math.pow(256,2)-1)/16907520;class qx extends _n{constructor(e,i,s,h){super(e,{layout:Nx||(Nx=new jr({visibility:new wt(Ge.layout_raster.visibility)})),paint:Vx||(Vx=new jr({"raster-opacity":new wt(Ge.paint_raster["raster-opacity"]),"raster-color":new uc(Ge.paint_raster["raster-color"]),"raster-color-mix":new wt(Ge.paint_raster["raster-color-mix"]),"raster-color-range":new wt(Ge.paint_raster["raster-color-range"]),"raster-hue-rotate":new wt(Ge.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new wt(Ge.paint_raster["raster-brightness-min"]),"raster-brightness-max":new wt(Ge.paint_raster["raster-brightness-max"]),"raster-saturation":new wt(Ge.paint_raster["raster-saturation"]),"raster-contrast":new wt(Ge.paint_raster["raster-contrast"]),"raster-resampling":new wt(Ge.paint_raster["raster-resampling"]),"raster-fade-duration":new wt(Ge.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new wt(Ge.paint_raster["raster-emissive-strength"]),"raster-array-band":new wt(Ge.paint_raster["raster-array-band"]),"raster-elevation":new wt(Ge.paint_raster["raster-elevation"]),"raster-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"})}))},i,s,h),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof jx&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const i=this._transitionablePaint._values["raster-color"].value.expression,[s,h]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(s)&&isNaN(h)||s===this._curRampRange[0]&&h===this._curRampRange[1]||(this.colorRamp=wh({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:s,end:h}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[s,h])}}let Gx,Hx,Zx,Xx,Yx;class Wx extends _n{constructor(e,i,s,h){super(e,{layout:Gx||(Gx=new jr({visibility:new wt(Ge["layout_raster-particle"].visibility)})),paint:Hx||(Hx=new jr({"raster-particle-array-band":new wt(Ge["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new wt(Ge["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new uc(Ge["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new wt(Ge["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new wt(Ge["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new wt(Ge["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new wt(Ge["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new wt(Ge["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"})}))},i,s,h),this._updateColorRamp(),this.lastInvalidatedAt=ye.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=wh({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=ye.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class xT extends _n{constructor(e,i){super(e,{},i,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function gv(a,e,i){const s=[0,0,1],h=Ae.quat.identity([]);return Ae.quat.rotateY(h,h,i?-Yi(a)+Math.PI:Yi(a)),Ae.quat.rotateX(h,h,-Yi(e)),Ae.vec3.transformQuat(s,s,h),Ae.vec3.normalize(s,s)}function $x(a,e){const i=Yg(a.projection,a.zoom,a.width,a.height),s=function(l,d,v,S,R){const g=new ir(v.lng-180*Ff,v.lat),E=new ir(v.lng+180*Ff,v.lat),D=l.project(g.lng,g.lat),T=l.project(E.lng,E.lat),A=-Math.atan2(T.y-D.y,T.x-D.x),z=r.fromLngLat(v);z.y=Mi(z.y,-1+Ff,1-Ff);const B=z.toLngLat(),N=l.project(B.lng,B.lat),Z=r.fromLngLat(B);Z.x+=Ff;const X=Z.toLngLat(),q=l.project(X.lng,X.lat),Y=Kx(q.x-N.x,q.y-N.y,A),K=r.fromLngLat(B);K.y+=Ff;const re=K.toLngLat(),he=l.project(re.lng,re.lat),ue=Kx(he.x-N.x,he.y-N.y,A),ce=Math.abs(Y.x)/Math.abs(ue.y),Te=Ae.mat4.identity([]);Ae.mat4.rotateZ(Te,Te,-A*(1-(R?0:S)));const de=Ae.mat4.identity([]);return Ae.mat4.scale(de,de,[1,1-(1-ce)*S,1]),de[4]=-ue.x/ue.y*S,Ae.mat4.rotateZ(de,de,A),Ae.mat4.multiply(de,Te,de),de}(a.projection,0,a.center,i,e),h=Qx(a);return Ae.mat4.scale(s,s,[h,h,1]),s}function Qx(a){const e=a.projection,i=Yg(a.projection,a.zoom,a.width,a.height),s=yv(e,a.center),h=yv(e,ir.convert(e.center));return Math.pow(2,s*i+(1-i)*h)}function Yg(a,e,i,s,h=1/0){const l=a.range;if(!l)return 0;const d=Math.min(h,Math.max(i,s)),v=Math.log(d/1024)/Math.LN2;return ro(l[0]+v,l[1]+v,e)}const Ff=1/4e4;function yv(a,e){const i=Mi(e.lat,-85.051129,Tr),s=new ir(e.lng-180*Ff,i),h=new ir(e.lng+180*Ff,i),l=a.project(s.lng,i),d=a.project(h.lng,i),v=r.fromLngLat(s),S=r.fromLngLat(h),R=d.x-l.x,g=d.y-l.y,E=S.x-v.x,D=S.y-v.y,T=Math.sqrt((E*E+D*D)/(R*R+g*g));return Math.log(T)/Math.LN2}function Kx(a,e,i){const s=Math.cos(i),h=Math.sin(i);return{x:a*s-e*h,y:a*h+e*s}}function Jx(a,e,i){Ae.mat4.identity(a),Ae.mat4.rotateZ(a,a,Yi(e[2])),Ae.mat4.rotateX(a,a,Yi(e[0])),Ae.mat4.rotateY(a,a,Yi(e[1])),Ae.mat4.scale(a,a,i),Ae.mat4.multiply(a,a,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Wg(a,e,i,s,h,l,d,v){const S=[i[0]-e[0],i[1]-e[1],0],R=[s[0]-e[0],s[1]-e[1],0];if(Ae.vec3.length(S)<1e-12||Ae.vec3.length(R)<1e-12)return Ae.quat.identity(a);const g=Ae.vec3.cross([],S,R);Ae.vec3.normalize(g,g),Ae.vec3.subtract(R,s,e),S[2]=(l-h)*v,R[2]=(d-h)*v;const E=S;return Ae.vec3.cross(E,S,R),Ae.vec3.normalize(E,E),Ae.quat.rotationTo(a,g,E)}function vv(a,e,i=!1){const s=oa(e.zoom),h=function(l,d,v){const S=d.worldSize,R=[l[12],l[13],l[14]],g=gn(R[1]/S),E=va(R[0]/S),D=Ae.mat4.identity([]),T=sa(1,g)*S,A=sa(1,0)*S*vc(g,d.zoom),z=1/tn(S);let B=A*z;if(v){const q=Yg(d.projection,d.zoom,d.width,d.height,1024);B=z*d.projection.pixelSpaceConversion(d.center.lat,S,q)}const N=Ll(g,E);Ae.vec3.add(N,N,Ae.vec3.scale([],Ae.vec3.normalize([],N),T*B*R[2]));const Z=function(q){const Y=[q[0],q[1],q[2]];let K=[0,1,0];const re=Ae.vec3.cross([],K,Y);return Ae.vec3.cross(K,Y,re),Ae.vec3.squaredLength(K)===0&&(K=[0,1,0],Ae.vec3.cross(re,Y,K)),Ae.vec3.normalize(re,re),Ae.vec3.normalize(K,K),Ae.vec3.normalize(Y,Y),[re[0],re[1],re[2],0,K[0],K[1],K[2],0,Y[0],Y[1],Y[2],0,q[0],q[1],q[2],1]}(N);Ae.mat4.scale(D,D,[B,B,B*T]),Ae.mat4.translate(D,D,[-R[0],-R[1],-R[2]]);const X=Ae.mat4.multiply([],d.globeMatrix,Z);return Ae.mat4.multiply(X,X,D),Ae.mat4.multiply(X,X,l),X}(a,e,i);if(s>0){const l=function(d,v){const S=v.worldSize,R=sa(1,0)*S*vc(v.center.lat,v.zoom)/tn(S),g=sa(1,v.center.lat)*S,E=Ae.mat4.identity([]);return Ae.mat4.rotateY(E,E,Yi(v.center.lng)),Ae.mat4.rotateX(E,E,Yi(v.center.lat)),Ae.mat4.translate(E,E,[0,0,aa]),Ae.mat4.scale(E,E,[R,R,R*g]),Ae.mat4.translate(E,E,[v.point.x-.5*S,v.point.y-.5*S,0]),Ae.mat4.multiply(E,E,d),Ae.mat4.multiply(E,v.globeMatrix,E)}(a,e);return function(d,v,S){const R=(A,z,B)=>{const N=Ae.vec3.length(A),Z=Ae.vec3.length(z),X=Wr(A,z,B);return Ae.vec3.scale(X,X,1/Ae.vec3.length(X)*di(N,Z,B))},g=R([d[0],d[1],d[2]],[v[0],v[1],v[2]],S),E=R([d[4],d[5],d[6]],[v[4],v[5],v[6]],S),D=R([d[8],d[9],d[10]],[v[8],v[9],v[10]],S),T=Wr([d[12],d[13],d[14]],[v[12],v[13],v[14]],S);return[g[0],g[1],g[2],0,E[0],E[1],E[2],0,D[0],D[1],D[2],0,T[0],T[1],T[2],1]}(h,l,s)}return h}function eb(a,e,i,s){const h=Ut.projectAabbCorners(s,i);let l=Number.MAX_VALUE,d=-1;for(let R=0;R<h.length;++R){const g=h[R];g[0]=(.5*g[0]+.5)*e.width,g[1]=(.5-.5*g[1])*e.height,g[2]<l&&(d=R,l=g[2])}const v=R=>new Rt(h[R][0],h[R][1]);let S;switch(d){case 0:case 6:S=[v(1),v(5),v(4),v(7),v(3),v(2),v(1)];break;case 1:case 7:S=[v(0),v(4),v(5),v(6),v(2),v(3),v(0)];break;case 3:case 5:S=[v(1),v(0),v(4),v(7),v(6),v(2),v(1)];break;default:S=[v(1),v(5),v(6),v(7),v(3),v(0),v(1)]}if($(a,S))return l}const bT=cr([{name:"a_pos_3f",components:3,type:"Float32"}]),wT=cr([{name:"a_color_3f",components:3,type:"Float32"}]),TT=cr([{name:"a_color_4f",components:4,type:"Float32"}]),ST=cr([{name:"a_uv_2f",components:2,type:"Float32"}]),ET=cr([{name:"a_normal_3f",components:3,type:"Float32"}]),MT=cr([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),AT=cr([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),tb={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class $g{constructor(e,i,s,h){this.message=(e?`${e}: `:"")+s,h&&(this.identifier=h),i!=null&&i.__line__&&(this.line=i.__line__)}}function ib(a,e){const i=a.indexOf("://")===-1;try{return new URL(a,i&&e?"http://example.com":void 0),!0}catch{return!1}}class rb{constructor(e,i){this.feature=e,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class nb{constructor(){this.instancedDataArray=new Rl,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class xv{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(e,i){}populate(e,i,s,h){this.tileToMeter=t(s);const l=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:d,id:v,index:S,sourceLayerIndex:R}of e){const g=v??(d.properties&&d.properties.hasOwnProperty("id")?d.properties.id:void 0),E=V(d,l);if(!this.layers[0]._featureFilter.filter(new wr(this.zoom),E,s))continue;const D={id:g,sourceLayerIndex:R,index:S,geometry:l?E.geometry:F(d,s,h),properties:d.properties,type:d.type,patterns:{}},T=this.addFeature(D,D.geometry,E);T&&i.featureIndex.insert(d,D.geometry,S,R,this.index,this.instancesPerModel[T].instancedDataArray.length,zt/32)}this.lookup=null}update(e,i,s,h){for(const l in this.instancesPerModel){const d=this.instancesPerModel[l];for(const v in e)d.idToFeaturesIndex.hasOwnProperty(v)&&(this.evaluate(d.features[d.idToFeaturesIndex[v]],e[v],d,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const i in this.instancesPerModel){const s=this.instancesPerModel[i];for(const h of s.features){const l=this.layers[0],d=h.feature,v=this.canonical,S=l.paint.get("model-rotation").evaluate(d,{},v),R=l.paint.get("model-scale").evaluate(d,{},v),g=l.paint.get("model-translation").evaluate(d,{},v);Ae.vec3.exactEquals(h.rotation,S)&&Ae.vec3.exactEquals(h.scale,R)&&Ae.vec3.exactEquals(h.translation,g)||(this.evaluate(h,h.featureStates,s,!0),e=!0)}}return e}updateReplacement(e,i,s,h){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const l=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(Pd(this.activeReplacements,l))return!1;this.activeReplacements=l;let d=!1;for(const v in this.instancesPerModel){const S=this.instancesPerModel[v],R=S.instancedDataArray;for(const g of S.features){const E=g.instancedDataOffset,D=g.instancedDataCount;for(let T=0;T<D;T++){const A=16*(T+E);let z=R.float32[A+0];const B=z>zt;z=B?z-zt:z;const N=Math.floor(z),Z=R.float32[A+1];let X=!1;for(const q of this.activeReplacements)if(!qp(q,s,tb.Model,h)&&!(q.min.x>N||N>q.max.x||q.min.y>Z||Z>q.max.y)&&(X=vg(Wm(N,Z,e.canonical,q.footprintTileId.canonical),q.footprint),X))break;R.float32[A]=X?z+zt:z,d=d||X!==B}}}return d}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const i in this.instancesPerModel){const s=this.instancesPerModel[i];s.instancedDataArray.length<0||s.instancedDataArray.length===0||(s.instancedDataBuffer?s.instancedDataBuffer.updateData(s.instancedDataArray):s.instancedDataBuffer=e.createVertexBuffer(s.instancedDataArray,MT.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const i in this.instancesPerModel){const s=this.instancesPerModel[i];s.instancedDataArray.length!==0&&s.instancedDataBuffer&&s.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris)for(const i of this.modelUris)e.removeModel(i,"")}addFeature(e,i,s){const h=this.layers[0],l=h.layout.get("model-id").evaluate(s,{},this.canonical);if(!l)return Ri(`modelId is not evaluated for layer ${h.id} and it is not going to get rendered.`),l;ib(l,!1)&&(this.modelUris.includes(l)||this.modelUris.push(l)),this.instancesPerModel[l]||(this.instancesPerModel[l]=new nb);const d=this.instancesPerModel[l],v=d.instancedDataArray,S=new rb(s,v.length);for(const R of i)for(const g of R){if(g.x<0||g.x>=zt||g.y<0||g.y>=zt)continue;const E=(this.lookupDim-1)/zt,D=this.lookupDim*(g.y*E|0)+g.x*E|0;if(this.lookup){if(this.lookup[D]!==0)continue;this.lookup[D]=1}this.instanceCount++;const T=v.length;v.resize(T+1),d.instancesEvaluatedElevation.push(0),v.float32[16*T]=g.x,v.float32[16*T+1]=g.y}return S.instancedDataCount=d.instancedDataArray.length-S.instancedDataOffset,S.instancedDataCount>0&&(e.id&&(d.idToFeaturesIndex[e.id]=d.features.length),d.features.push(S),this.evaluate(S,{},d,!1)),l}getModelUris(){return this.modelUris}evaluate(e,i,s,h){const l=this.layers[0],d=e.feature,v=this.canonical,S=e.rotation=l.paint.get("model-rotation").evaluate(d,i,v),R=e.scale=l.paint.get("model-scale").evaluate(d,i,v),g=e.translation=l.paint.get("model-translation").evaluate(d,i,v),E=l.paint.get("model-color").evaluate(d,i,v);E.a=l.paint.get("model-color-mix-intensity").evaluate(d,i,v);const D=[];this.maxVerticalOffset<g[2]&&(this.maxVerticalOffset=g[2]),this.maxScale=Math.max(Math.max(this.maxScale,R[0]),Math.max(R[1],R[2])),Jx(D,S,R);const T=Math.round(100*E.a)+E.b/1.05;for(let A=0;A<e.instancedDataCount;++A){const z=e.instancedDataOffset+A,B=16*z,N=s.instancedDataArray.float32;let Z=0;h&&(Z=N[B+6]-s.instancesEvaluatedElevation[z]);const X=0|N[B+1];N[B]=(0|N[B])+E.r/1.05,N[B+1]=X+E.g/1.05,N[B+2]=T,N[B+3]=1/(v.z>10?this.tileToMeter:t(v,X)),N[B+4]=g[0],N[B+5]=g[1],N[B+6]=g[2]+Z,N[B+7]=D[0],N[B+8]=D[1],N[B+9]=D[2],N[B+10]=D[4],N[B+11]=D[5],N[B+12]=D[6],N[B+13]=D[8],N[B+14]=D[9],N[B+15]=D[10],s.instancesEvaluatedElevation[z]=g[2]}}}let ab,sb;Zt(xv,"ModelBucket",{omit:["layers"]}),Zt(nb,"PerModelAttributes"),Zt(rb,"ModelFeature");const Xd=64,sm={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function ob(a,e,i,s,h,l,d,v,S,R=!1){const g=i.zoom,E=i.project(s),D=vc(s.lat,g),T=1/D;Ae.mat4.identity(a),Ae.mat4.translate(a,a,[E.x+d[0]*T,E.y+d[1]*T,d[2]]);let A=1,z=1;const B=i.worldSize;if(R){if(i.projection.name==="mercator"){let q=0;i.elevation&&(q=i.elevation.getAtPointOrZero(new r(E.x/B,E.y/B),0));const Y=Ae.vec4.transformMat4([],[E.x,E.y,q,1],i.projMatrix)[3]/i.cameraToCenterDistance;A=Y,z=Y*vc(i.center.lat,g)}else if(i.projection.name==="globe"){const q=vv(a,i),Y=Ae.mat4.multiply([],i.projMatrix,q),K=[0,0,0,1];Ae.vec4.transformMat4(K,K,Y);const re=K[3]/i.cameraToCenterDistance,he=oa(g),ue=i.projection.pixelsPerMeter(s.lat,B)*vc(s.lat,g),ce=i.projection.pixelsPerMeter(i.center.lat,B)*vc(i.center.lat,g);A=re/di(ue,xh(i.center.lat),he),z=re*D/ue,A*=ce,z*=ce}}else A=T;Ae.mat4.scale(a,a,[A,A,z]);const N=[...a],Z=e.orientation,X=[];if(Jx(X,[Z[0]+h[0],Z[1]+h[1],Z[2]+h[2]],l),Ae.mat4.multiply(a,N,X),v&&i.elevation){let q=0;const Y=[];if(S&&i.elevation){q=function(he,ue,ce,Te,de){const Se=ue.elevation;if(!Se)return 0;const Ce=Ut.projectAabbCorners(ce,Te),Me=sa(1,de.lat)*ue.worldSize,Le=function(ei,jt){const Wt=[0,0,1],Ti=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const zi of Ti){const Pi=ei[zi.corners[0]],ki=ei[zi.corners[1]],$i=ei[zi.corners[2]],Ki=[ki[0]-Pi[0],ki[1]-Pi[1],jt*(ki[2]-Pi[2])],zr=Ae.vec3.cross(Ki,Ki,[$i[0]-Pi[0],$i[1]-Pi[1],jt*($i[2]-Pi[2])]);Ae.vec3.normalize(zr,zr),zi.dotProductWithUp=Ae.vec3.dot(zr,Wt)}return Ti.sort((zi,Pi)=>zi.dotProductWithUp-Pi.dotProductWithUp),Ti[0].corners}(Ce,Me),ke=Ce[Le[0]],Ue=Ce[Le[1]],Pe=Ce[Le[2]],at=Ce[Le[3]],mt=Se.getAtPointOrZero(new r(ke[0]/ue.worldSize,ke[1]/ue.worldSize),0),nt=Se.getAtPointOrZero(new r(Ue[0]/ue.worldSize,Ue[1]/ue.worldSize),0),Bt=Se.getAtPointOrZero(new r(Pe[0]/ue.worldSize,Pe[1]/ue.worldSize),0),Ot=Se.getAtPointOrZero(new r(at[0]/ue.worldSize,at[1]/ue.worldSize),0),bt=(mt+Ot)/2,yt=(nt+Bt)/2;return bt>yt?nt<Bt?Wg(he,Ue,at,ke,nt,Ot,mt,Me):Wg(he,Pe,ke,at,Bt,mt,Ot,Me):mt<Ot?Wg(he,ke,Ue,Pe,mt,nt,Bt,Me):Wg(he,at,Pe,Ue,Ot,Bt,nt,Me),Math.max(bt,yt)}(Y,i,e.aabb,a,s);const K=Ae.mat4.fromQuat([],Y),re=Ae.mat4.multiply([],K,X);Ae.mat4.multiply(a,N,re)}else q=i.elevation.getAtPointOrZero(new r(E.x/B,E.y/B),0);q!==0&&(a[14]+=q)}}function T_(a,e,i=!1){a.uploaded||(a.gfxTexture=new _v(e,a.image,i?e.gl.R8:e.gl.RGBA8,{useMipmap:a.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),a.uploaded=!0,a.image=null)}function CT(a,e,i){a.indexBuffer=e.createIndexBuffer(a.indexArray,!1,!0),a.vertexBuffer=e.createVertexBuffer(a.vertexArray,bT.members,!1,!0),a.normalArray&&(a.normalBuffer=e.createVertexBuffer(a.normalArray,ET.members,!1,!0)),a.texcoordArray&&(a.texcoordBuffer=e.createVertexBuffer(a.texcoordArray,ST.members,!1,!0)),a.colorArray&&(a.colorBuffer=e.createVertexBuffer(a.colorArray,(a.colorArray.bytesPerElement===12?wT:TT).members,!1,!0)),a.featureArray&&(a.pbrBuffer=e.createVertexBuffer(a.featureArray,AT.members,!0)),a.segments=Xr.simpleSegment(0,0,a.vertexArray.length,a.indexArray.length);const s=a.material;s.pbrMetallicRoughness.baseColorTexture&&T_(s.pbrMetallicRoughness.baseColorTexture,e),s.pbrMetallicRoughness.metallicRoughnessTexture&&T_(s.pbrMetallicRoughness.metallicRoughnessTexture,e),s.normalTexture&&T_(s.normalTexture,e),s.occlusionTexture&&T_(s.occlusionTexture,e,i),s.emissionTexture&&T_(s.emissionTexture,e)}function bv(a,e,i){if(a.meshes)for(const s of a.meshes)CT(s,e,i);if(a.children)for(const s of a.children)bv(s,e,i)}function Qg(a){if(a.meshes)for(const e of a.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(a.children)for(const e of a.children)Qg(e)}function wv(a){if(a.meshes)for(const i of a.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((e=i.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(a.children)for(const i of a.children)wv(i)}class om{constructor(e,i,s){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=s}static create(e,i,s){const h=s||e.findDEMTileFor(i);if(!h||!h.dem)return;const l=h.dem,d=h.tileID,v=1<<i.canonical.z-d.canonical.z;return new om(h,l.dim/zt/v,[(i.canonical.x/v-d.canonical.x)*l.dim,(i.canonical.y/v-d.canonical.y)*l.dim])}tileCoordToPixel(e,i){const s=i*this._scale+this._offset[1],h=Math.floor(e*this._scale+this._offset[0]),l=Math.floor(s);return new Rt(h,l)}getElevationAt(e,i,s,h){const l=e*this._scale+this._offset[0],d=i*this._scale+this._offset[1],v=Math.floor(l),S=Math.floor(d),R=this._dem;return h=!!h,s?di(di(R.get(v,S,h),R.get(v,S+1,h),d-S),di(R.get(v+1,S,h),R.get(v+1,S+1,h),d-S),l-v):R.get(v,S,h)}getElevationAtPixel(e,i,s){return this._dem.get(e,i,!!s)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*sa(1,e)*this._dem.stride}}const Tv=new Float32Array(262144),Yd=new Uint8Array(262144);function lb(a){let e=0;if(a.meshes)for(const i of a.meshes)e=Math.max(e,i.aabb.max[2]);if(a.children)for(const i of a.children)e=Math.max(e,lb(i));return e}function cb(a,e,i){if(a.meshes)for(const s of a.meshes){if(s.aabb.min[0]===1/0)continue;const h=Ut.applyTransform(s.aabb,a.matrix);i.insert(e,h.min[0],h.min[1],h.max[0],h.max[1])}if(a.children)for(const s of a.children)cb(s,e,i)}const ub=["","wall","door","roof","window","lamp","logo"];class hb{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:lb(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Ut([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const i=new Ut([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const s of this.node.meshes)this.node.lightMeshIndex!==e&&(s.transformedAabb=Ut.applyTransformFast(s.aabb,this.node.matrix),i.encapsulate(s.transformedAabb)),e++;this.aabb=i}return this.aabb}}class Kg{constructor(e,i,s,h,l,d,v){this.id=s,this.layers=e,this.layerIds=this.layers.map(S=>S.fqid),this.stateDependentLayerIds=this.layers.filter(S=>S.isStateDependent()).map(S=>S.id),this.modelTraits|=sm.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,h&&(this.modelTraits|=sm.HasMapboxMeshFeatures),l&&(this.modelTraits|=sm.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=d,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const S of i)this.nodesInfo.push(new hb(S)),cb(S,v.featureIndexArray.length,v.grid),v.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,v.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(e,i){for(const s of this.getNodesInfo()){const h=s.node;h.footprint&&i.push({footprint:h.footprint,id:e})}}update(e){const i=Object.keys(e).length!==0;if(i&&!this.stateDependentLayers.length)return;const s=i?this.stateDependentLayers:this.layers;if(!kn(e,this.states))for(const h of s)this.evaluate(h,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const i=this.getNodesInfo();for(const s of i){const h=s.node;this.uploaded?this.updatePbrBuffer(h):bv(h,e,!0)}for(const s of i)Qg(s.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let i=!1;if(!e.meshes)return i;for(const s of e.meshes)s.pbrBuffer&&(s.pbrBuffer.updateData(s.featureArray),i=!0);return i}needsReEvaluation(e,i,s){const h=e.transform.projectionOptions,l=e.style.getBrightness(),d=this.brightness!==l;if(!this.uploaded||this.dirty||h.name!==this.projection.name||S_(s.paint.get("model-color").value,d)||S_(s.paint.get("model-color-mix-intensity").value,d)||S_(s.paint.get("model-roughness").value,d)||S_(s.paint.get("model-emissive-strength").value,d)||S_(s.paint.get("model-height-based-emissive-strength-multiplier").value,d)){this.projection=h,this.brightness=l;const v=this.getNodesInfo();for(const S of v)S.state=null;return!0}return!1}evaluateScale(e,i){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const s=this.getNodesInfo(),h=this.id.canonical;for(const l of s){const d=l.feature;l.evaluatedScale=i.paint.get("model-scale").evaluate(d,{},h)}}evaluate(e,i){const s=this.getNodesInfo();for(const h of s){if(!h.node.meshes)continue;const l=h.feature,d=i&&i[l.id];if(kn(d,h.state))continue;h.state=structuredClone(d);const v=h.node.meshes&&h.node.meshes[0].featureData,S=h.evaluatedColor[2],R=h.evaluatedRMEA[2],g=this.id.canonical;if(h.hasTranslucentParts=!1,v){for(let E=0;E<ub.length;E++){const D=ub[E];D.length&&(l.properties.part=D);const T=e.paint.get("model-color").evaluate(l,d,g).toRenderColor(null),A=e.paint.get("model-color-mix-intensity").evaluate(l,d,g);h.evaluatedColor[E]=[T.r,T.g,T.b,A],h.evaluatedRMEA[E][0]=e.paint.get("model-roughness").evaluate(l,d,g),h.evaluatedRMEA[E][2]=e.paint.get("model-emissive-strength").evaluate(l,d,g),h.evaluatedRMEA[E][3]=T.a,h.emissionHeightBasedParams[E]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(l,d,g),!h.hasTranslucentParts&&T.a<1&&(h.hasTranslucentParts=!0)}delete l.properties.part,IT(h,S!==h.evaluatedColor[2]||R!==h.evaluatedRMEA[2],this.modelTraits)}else h.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(l,d,g);h.evaluatedScale=e.paint.get("model-scale").evaluate(l,d,g),this.updatePbrBuffer(h.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,s,h){const l=e.findDEMTileFor(s);if(l&&(l.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(l.dem&&l.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=l.tileID.overscaledZ;const d=om.create(e,s,l);if(!d)return;this.modelTraits&sm.HasMapboxMeshFeatures&&this.updateDEM(e,d,s,h);for(const v of this.getNodesInfo()){const S=v.node;if(!S.footprint||!S.footprint.vertices||!S.footprint.vertices.length)continue;const R=S.footprint.vertices;let g=d.getElevationAt(R[0].x,R[0].y,!0,!0);for(let E=1;E<R.length;E++)g=Math.min(g,d.getElevationAt(R[E].x,R[E].y,!0,!0));S.elevation=g}}this.terrainTile=l.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,i,s,h){let l=i._dem._modifiedForSources[h];if(l===void 0&&(i._dem._modifiedForSources[h]=[],l=i._dem._modifiedForSources[h]),l.includes(s.canonical))return;const d=i._dem.dim;l.push(s.canonical);let v=!1;for(const S of this.getNodesInfo()){const R=S.node;if(!R.footprint||!R.footprint.grid)continue;const g=R.footprint.grid,E=i.tileCoordToPixel(g.min.x,g.min.y),D=i.tileCoordToPixel(g.max.x,g.max.y),T=Math.min(Math.min(d-D.y,E.x),Math.min(E.y,d-D.x));if(T<0)continue;const A=Mi(T,2,5);let z=Math.max(0,E.x-A),B=Math.max(0,E.y-A),N=Math.min(D.x+A,d-1),Z=Math.min(D.y+A,d-1);for(let K=B;K<=Z;++K)for(let re=z;re<=N;++re)Yd[K*d+re]=255;let X=0,q=0;for(let K=0;K<g.cellsY;++K)for(let re=0;re<g.cellsX;++re){if(!g.cells[K*g.cellsX+re])continue;const he=i.tileCoordToPixel(g.min.x+re/g.xScale,g.min.y+K/g.yScale),ue=i.tileCoordToPixel(g.min.x+(re+1)/g.xScale,g.min.y+(K+1)/g.yScale);for(let ce=he.y;ce<=Math.min(ue.y+1,d-1);++ce)for(let Te=he.x;Te<=Math.min(ue.x+1,d-1);++Te)Yd[ce*d+Te]===255&&(Yd[ce*d+Te]=0,X+=i.getElevationAtPixel(Te,ce),q++)}const Y=X/q;z=Math.max(1,E.x-A),B=Math.max(1,E.y-A),N=Math.min(D.x+A,d-2),Z=Math.min(D.y+A,d-2),v=!0;for(let K=B;K<=Z;++K)for(let re=z;re<=N;++re)Yd[K*d+re]===0&&(Tv[K*d+re]=i._dem.set(re,K,Y));for(let K=1;K<A;++K){z=Math.max(1,E.x-K),B=Math.max(1,E.y-K),N=Math.min(D.x+K,d-2),Z=Math.min(D.y+K,d-2);for(let re=B;re<=Z;++re)for(let he=z;he<=N;++he){const ue=re*d+he;if(Yd[ue]===255){let ce=0,Te=0,de=-1,Se=-1;for(let Ce=-1;Ce<=1;++Ce)for(let Me=-1;Me<=1;++Me){const Le=(re+Ce)*d+he+Me;if(Yd[Le]>=K)continue;const ke=Tv[Le],Ue=Math.abs(ke);Ue>Te&&(ce=ke,Te=Ue,de=Me,Se=Ce)}if(Te>.1){const Ce=1-(K+.5*Math.abs(de*Se))/A;let Me=i._dem.get(he,re)+ce*Ce;const Le=i._dem.get(he+de,re+Se),ke=i._dem.get(he-de,re-Se,!0);(Me-Le)*(Me-ke)>0&&(Me=(Le+ke)/2),Tv[ue]=i._dem.set(he,re,Me),Yd[ue]=K}}}}}v&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=ye.now())}getNodesInfo(){return this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const i of e)Qg(i.node),wv(i.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const s=i.getReplacementRegionsForTile(e.toUnwrapped()),h=this.getNodesInfo();for(let l=0;l<this.nodesInfo.length;l++){const d=h[l].node;h[l].hiddenByReplacement=!!d.footprint&&!s.find(v=>v.footprint===d.footprint)}}getHeightAtTileCoord(e,i){const s=this.getNodesInfo(),h=[],l=[0,0,0],d=Ae.mat4.identity([]);for(let v=0;v<this.nodesInfo.length;v++){const S=s[v],R=S.node.meshes[0],g=R.transformedAabb;if(e<g.min[0]||i<g.min[1]||e>g.max[0]||i>g.max[1])continue;if(S.node.hidden===!0)return{height:1/0,maxHeight:S.feature.properties.height,hidden:!1,verticalScale:S.evaluatedScale[2]};Ae.mat4.invert(d,S.node.matrix),l[0]=e,l[1]=i,Ae.vec3.transformMat4(l,l,d);const E=(l[0]-R.aabb.min[0])/(R.aabb.max[0]-R.aabb.min[0])*Xd|0,D=Math.min(63,(l[1]-R.aabb.min[1])/(R.aabb.max[1]-R.aabb.min[1])*Xd|0)*Xd+Math.min(63,E),T=R.heightmap[D];if(!(T<0&&S.node.footprint))return S.hiddenByReplacement?void 0:{height:T,maxHeight:S.feature.properties.height,hidden:!1,verticalScale:S.evaluatedScale[2]};if(S.node.footprint.grid.query(new Rt(e,i),new Rt(e,i),h),h.length>0)return{height:void 0,maxHeight:S.feature.properties.height,hidden:S.hiddenByReplacement,verticalScale:S.evaluatedScale[2]}}}}function S_(a,e){return!a.isLightConstant&&e}function DT(a,e,i,s,h,l,d,v){let S=(61440&e|(61440&e)>>4)>>8,R=(3840&e|(3840&e)>>4)>>4,g=240&e|(240&e)>>4;i[3]>0&&(S=di(S,255*i[0],i[3]),R=di(R,255*i[1],i[3]),g=di(g,255*i[2],i[3]));const E=S<<8|R,D=g<<8|Math.floor(255*s[3]),T=function(K){const re=Mi(K,0,2);return Math.min(Math.round(.5*re*255),255)}(s[2])<<8|15*s[0]<<4|15*s[1],A=Mi(h[0],0,1),z=Mi(h[1],0,1),B=Mi(h[2],0,1),N=Mi(h[3],0,1);let Z,X,q,Y;if(A!==z&&d!==l&&z!==A){const K=d-l;X=1/(K*(z-A)),q=-(l+K*A)/(K*(z-A));const re=Mi(h[4],-1,1);Y=Math.pow(10,re),Z=255*B<<8|255*N}else Z=65535,X=0,q=1,Y=1;if(a.emplaceBack(E,D,T,Z,X,q,Y),v){const K=v.length;v.clear();for(let re=0;re<K;re++)v.emplaceBack(E,D,T,Z,X,q,Y)}}function IT(a,e,i){const s=a.node;let h=0;const l=i&sm.HasMeshoptCompression;for(const d of s.meshes){if(s.lights&&s.lightMeshIndex===h||!d.featureData)continue;d.featureArray=new fu,d.featureArray.reserve(d.featureData.length);let v=e;for(const S of d.featureData){const R=l?65535&S:S>>16&65535,g=l?S>>16&65535:65535&S,E=(15&g)<8?15&g:0,D=a.evaluatedRMEA[E],T=a.evaluatedColor[E],A=a.emissionHeightBasedParams[E];let z;if(v&&E===2&&s.lights&&(z=new fu,z.resize(10*s.lights.length)),DT(d.featureArray,R,T,D,A,d.aabb.min[2],d.aabb.max[2],z),z&&v){v=!1;const B=s.meshes[s.lightMeshIndex];B.featureArray=z,B.featureArray._trim()}}d.featureArray._trim(),h++}}function fb(a,e,i,s){const h=1<<a.z;e.lat=gn((s/zt+a.y)/h),e.lng=va((i/zt+a.x)/h)}Zt(Kg,"Tiled3dModelBucket",{omit:["layers"]}),Zt(hb,"Tiled3dModelFeature");const RT={circle:class extends _n{constructor(a,e,i,s){super(a,{layout:gt||(gt=new jr({"circle-sort-key":new Gt(Ge.layout_circle["circle-sort-key"]),"circle-elevation-reference":new wt(Ge.layout_circle["circle-elevation-reference"]),visibility:new wt(Ge.layout_circle.visibility)})),paint:Fe||(Fe=new jr({"circle-radius":new Gt(Ge.paint_circle["circle-radius"]),"circle-color":new Gt(Ge.paint_circle["circle-color"]),"circle-blur":new Gt(Ge.paint_circle["circle-blur"]),"circle-opacity":new Gt(Ge.paint_circle["circle-opacity"]),"circle-translate":new wt(Ge.paint_circle["circle-translate"]),"circle-translate-anchor":new wt(Ge.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new wt(Ge.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new wt(Ge.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Gt(Ge.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Gt(Ge.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Gt(Ge.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new wt(Ge.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s)}createBucket(a){return new J(a)}queryRadius(a){const e=a;return lt("circle-radius",this,e)+lt("circle-stroke-width",this,e)+it(this.paint.get("circle-translate"))}queryIntersectsFeature(a,e,i,s,h,l,d,v){const S=Ke(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),l.angle,a.pixelToTileUnitsFactor),R=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return kl(a,s,l,d,v,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",S,R)}getProgramIds(){return["circle"]}getDefaultProgramParams(a,e,i){const s=Pl(this);return{config:new go(this,{zoom:e,lut:i}),defines:s,overrideFog:!1}}},heatmap:class extends _n{createBucket(a){return new Bm(a)}constructor(a,e,i,s){super(a,{layout:Cp||(Cp=new jr({visibility:new wt(Ge.layout_heatmap.visibility)})),paint:Nm||(Nm=new jr({"heatmap-radius":new Gt(Ge.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Gt(Ge.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new wt(Ge.paint_heatmap["heatmap-intensity"]),"heatmap-color":new uc(Ge.paint_heatmap["heatmap-color"]),"heatmap-opacity":new wt(Ge.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){a==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=wh({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(a){return lt("heatmap-radius",this,a)}queryIntersectsFeature(a,e,i,s,h,l,d,v){const S=this.paint.get("heatmap-radius").evaluate(e,i);return kl(a,s,l,d,v,!0,!0,new Rt(0,0),S)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(a,e,i){return a==="heatmap"?{config:new go(this,{zoom:e,lut:i}),overrideFog:!1}:{}}},hillshade:class extends _n{constructor(a,e,i,s){super(a,{layout:sg||(sg=new jr({visibility:new wt(Ge.layout_hillshade.visibility)})),paint:Fl||(Fl=new jr({"hillshade-illumination-direction":new wt(Ge.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new wt(Ge.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new wt(Ge.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new wt(Ge.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new wt(Ge.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new wt(Ge.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new wt(Ge.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(a,e,i){return{overrideFog:!1}}},fill:class extends _n{constructor(a,e,i,s){super(a,{layout:dg||(dg=new jr({"fill-sort-key":new Gt(Ge.layout_fill["fill-sort-key"]),visibility:new wt(Ge.layout_fill.visibility),"fill-elevation-reference":new wt(Ge.layout_fill["fill-elevation-reference"])})),paint:Bp||(Bp=new jr({"fill-antialias":new wt(Ge.paint_fill["fill-antialias"]),"fill-opacity":new Gt(Ge.paint_fill["fill-opacity"]),"fill-color":new Gt(Ge.paint_fill["fill-color"]),"fill-outline-color":new Gt(Ge.paint_fill["fill-outline-color"]),"fill-translate":new wt(Ge.paint_fill["fill-translate"]),"fill-translate-anchor":new wt(Ge.paint_fill["fill-translate-anchor"]),"fill-pattern":new Gt(Ge.paint_fill["fill-pattern"]),"fill-emissive-strength":new wt(Ge.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Gt(Ge.paint_fill["fill-z-offset"]),"fill-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s)}getProgramIds(){const a=this.paint.get("fill-pattern"),e=a&&a.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(a,e,i){return{config:new go(this,{zoom:e,lut:i}),overrideFog:!1}}recalculate(a,e){super.recalculate(a,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new Fp(a)}queryRadius(){return it(this.paint.get("fill-translate"))}queryIntersectsFeature(a,e,i,s,h,l){return!a.queryGeometry.isAboveHorizon&&ee(Be(a.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),l.angle,a.pixelToTileUnitsFactor),s)}isTileClipped(){return!0}is3D(){return this.paint.get("fill-z-offset").constantOr(1)!==0}},"fill-extrusion":class extends _n{constructor(a,e,i,s){super(a,{layout:Bd||(Bd=new jr({visibility:new wt(Ge["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new wt(Ge["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:Yp||(Yp=new jr({"fill-extrusion-opacity":new wt(Ge["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Gt(Ge["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new wt(Ge["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new wt(Ge["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Gt(Ge["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Gt(Ge["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Gt(Ge["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new wt(Ge["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new wt(Ge["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new wt(Ge["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new wt(Ge["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new wt(Ge["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new wt(Ge["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new wt(Ge["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new wt(Ge["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new wt(Ge["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new wt(Ge["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Gt(Ge["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Gt(Ge["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new wt(Ge["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new wt(Ge["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new wt(Ge["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new wt(Ge["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Gt(Ge["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Gt(Ge["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new wt(Ge["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(a){return new Xp(a)}queryRadius(){return it(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(a,e,i,s,h,l,d,v,S){const R=Ke(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),l.angle,a.pixelToTileUnitsFactor),g=this.paint.get("fill-extrusion-height").evaluate(e,i),E=this.paint.get("fill-extrusion-base").evaluate(e,i),D=[0,0],T=v&&l.elevation,A=l.elevation?l.elevation.exaggeration():1,z=a.tile.getBucket(this);if(T&&z instanceof Xp){const q=z.centroidVertexArray,Y=S+1;Y<q.length&&(D[0]=q.geta_centroid_pos0(Y),D[1]=q.geta_centroid_pos1(Y))}if(D[0]===0&&D[1]===1)return!1;l.projection.name==="globe"&&(s=Of([s],[new Rt(0,0),new Rt(zt,zt)],a.tileID.canonical).map(q=>q.polygon).flat());const B=T?v:null,[N,Z]=function(q,Y,K,re,he,ue,ce,Te,de,Se,Ce){return q.projection.name==="globe"?function(Me,Le,ke,Ue,Pe,at,mt,nt,Bt,Ot,bt){const yt=[],ei=[],jt=Me.projection.upVectorScale(bt,Me.center.lat,Me.worldSize).metersToTile,Wt=[0,0,0,1],Ti=[0,0,0,1],zi=(ki,$i,Ki,zr)=>{ki[0]=$i,ki[1]=Ki,ki[2]=zr,ki[3]=1},Pi=Ih();ke>0&&(ke+=Pi),Ue+=Pi;for(const ki of Le){const $i=[],Ki=[];for(const zr of ki){const xr=zr.x+Pe.x,Ci=zr.y+Pe.y,yr=Me.projection.projectTilePoint(xr,Ci,bt),vr=Me.projection.upVector(bt,zr.x,zr.y);let qr=ke,pn=Ue;if(mt){const An=t_(xr,Ci,ke,Ue,mt,nt,Bt,Ot);qr+=An.base,pn+=An.top}ke!==0?zi(Wt,yr.x+vr[0]*jt*qr,yr.y+vr[1]*jt*qr,yr.z+vr[2]*jt*qr):zi(Wt,yr.x,yr.y,yr.z),zi(Ti,yr.x+vr[0]*jt*pn,yr.y+vr[1]*jt*pn,yr.z+vr[2]*jt*pn),Ae.vec3.transformMat4(Wt,Wt,at),Ae.vec3.transformMat4(Ti,Ti,at),$i.push(new Nl(Wt[0],Wt[1],Wt[2])),Ki.push(new Nl(Ti[0],Ti[1],Ti[2]))}yt.push($i),ei.push(Ki)}return[yt,ei]}(q,Y,K,re,he,ue,ce,Te,de,Se,Ce):ce?function(Me,Le,ke,Ue,Pe,at,mt,nt,Bt){const Ot=[],bt=[],yt=[0,0,0,1];for(const ei of Me){const jt=[],Wt=[];for(const Ti of ei){const zi=Ti.x+Ue.x,Pi=Ti.y+Ue.y,ki=t_(zi,Pi,Le,ke,at,mt,nt,Bt);yt[0]=zi,yt[1]=Pi,yt[2]=ki.base,yt[3]=1,Ae.vec4.transformMat4(yt,yt,Pe),yt[3]=Math.max(yt[3],1e-5);const $i=new Nl(yt[0]/yt[3],yt[1]/yt[3],yt[2]/yt[3]);yt[0]=zi,yt[1]=Pi,yt[2]=ki.top,yt[3]=1,Ae.vec4.transformMat4(yt,yt,Pe),yt[3]=Math.max(yt[3],1e-5);const Ki=new Nl(yt[0]/yt[3],yt[1]/yt[3],yt[2]/yt[3]);jt.push($i),Wt.push(Ki)}Ot.push(jt),bt.push(Wt)}return[Ot,bt]}(Y,K,re,he,ue,ce,Te,de,Se):function(Me,Le,ke,Ue,Pe){const at=[],mt=[],nt=Pe[8]*Le,Bt=Pe[9]*Le,Ot=Pe[10]*Le,bt=Pe[11]*Le,yt=Pe[8]*ke,ei=Pe[9]*ke,jt=Pe[10]*ke,Wt=Pe[11]*ke;for(const Ti of Me){const zi=[],Pi=[];for(const ki of Ti){const $i=ki.x+Ue.x,Ki=ki.y+Ue.y,zr=Pe[0]*$i+Pe[4]*Ki+Pe[12],xr=Pe[1]*$i+Pe[5]*Ki+Pe[13],Ci=Pe[2]*$i+Pe[6]*Ki+Pe[14],yr=Pe[3]*$i+Pe[7]*Ki+Pe[15],vr=zr+nt,qr=xr+Bt,pn=Ci+Ot,An=Math.max(yr+bt,1e-5),mn=zr+yt,ln=xr+ei,vn=Ci+jt,Pn=Math.max(yr+Wt,1e-5);zi.push(new Nl(vr/An,qr/An,pn/An)),Pi.push(new Nl(mn/Pn,ln/Pn,vn/Pn))}at.push(zi),mt.push(Pi)}return[at,mt]}(Y,K,re,he,ue)}(l,s,E,g,R,d,B,D,A,l.center.lat,a.tileID.canonical),X=a.queryGeometry;return function(q,Y,K){let re=1/0;ee(K,Y)&&(re=Nd(K,Y[0]));for(let he=0;he<Y.length;he++){const ue=Y[he],ce=q[he];for(let Te=0;Te<ue.length-1;Te++){const de=ue[Te],Se=[de,ue[Te+1],ce[Te+1],ce[Te],de];$(K,Se)&&(re=Math.min(re,Nd(K,Se)))}}return re!==1/0&&re}(N,Z,X.isPointQuery()?X.screenBounds:X.screenGeometry)}},line:class extends _n{constructor(a,e,i,s){const h=Qp();super(a,h,e,i,s),h.layout&&(this.layout=new cc(h.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(a){if(a==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Qa,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(a,e){super.recalculate(a,e),this.paint._values["line-floorwidth"]=(()=>{if(Tu)return Tu;const i=Qp();return Tu=new u_(i.paint.properties["line-width"].specification),Tu.useIntegerZoom=!0,Tu})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new zh(a)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(a,e,i){const s=jd(this);return{config:new go(this,{zoom:e,lut:i}),defines:s,overrideFog:!1}}queryRadius(a){const e=a,i=Kp(lt("line-width",this,e),lt("line-gap-width",this,e)),s=lt("line-offset",this,e);return i/2+Math.abs(s)+it(this.paint.get("line-translate"))}queryIntersectsFeature(a,e,i,s,h,l){if(a.queryGeometry.isAboveHorizon)return!1;const d=Be(a.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),l.angle,a.pixelToTileUnitsFactor),v=a.pixelToTileUnitsFactor/2*Kp(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),S=this.paint.get("line-offset").evaluate(e,i);return S&&(s=function(R,g){const E=[],D=new Rt(0,0);for(let T=0;T<R.length;T++){const A=R[T],z=[];for(let B=0;B<A.length;B++){const N=A[B],Z=A[B+1],X=B===0?D:N.sub(A[B-1])._unit()._perp(),q=B===A.length-1?D:Z.sub(N)._unit()._perp(),Y=X._add(q)._unit();Y._mult(1/(Y.x*q.x+Y.y*q.y)),z.push(Y._mult(g)._add(N))}E.push(z)}return E}(s,S*a.pixelToTileUnitsFactor)),function(R,g,E){for(let D=0;D<g.length;D++){const T=g[D];if(R.length>=3){for(let A=0;A<T.length;A++)if(_e(R,T[A]))return!0}if(le(R,T,E))return!0}return!1}(d,s,v)}isTileClipped(){return!0}isDraped(a){return!this.hasElevatedBuckets}},symbol:Gg,background:class extends _n{constructor(a,e,i,s){super(a,{layout:Fx||(Fx=new jr({visibility:new wt(Ge.layout_background.visibility)})),paint:Bx||(Bx=new jr({"background-pitch-alignment":new wt(Ge.paint_background["background-pitch-alignment"]),"background-color":new wt(Ge.paint_background["background-color"]),"background-pattern":new wt(Ge.paint_background["background-pattern"]),"background-opacity":new wt(Ge.paint_background["background-opacity"]),"background-emissive-strength":new wt(Ge.paint_background["background-emissive-strength"]),"background-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(a,e,i){return{overrideFog:!1}}is3D(){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:qx,"raster-particle":Wx,sky:class extends _n{constructor(a,e,i,s){super(a,{layout:Zx||(Zx=new jr({visibility:new wt(Ge.layout_sky.visibility)})),paint:Xx||(Xx=new jr({"sky-type":new wt(Ge.paint_sky["sky-type"]),"sky-atmosphere-sun":new wt(Ge.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new wt(Ge.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new wt(Ge.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new wt(Ge.paint_sky["sky-gradient-radius"]),"sky-gradient":new uc(Ge.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new wt(Ge.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new wt(Ge.paint_sky["sky-atmosphere-color"]),"sky-opacity":new wt(Ge.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){a==="sky-gradient"?this._updateColorRamp():a!=="sky-atmosphere-sun"&&a!=="sky-atmosphere-halo-color"&&a!=="sky-atmosphere-color"&&a!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=wh({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(a){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=a.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(a,e){if(this.paint.get("sky-type")==="atmosphere"){const s=this.paint.get("sky-atmosphere-sun"),h=!s,l=a.style.light,d=l.properties.get("position");return h&&l.properties.get("anchor")==="viewport"&&Ri("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?gv(d.azimuthal,90-d.polar,e):gv(s[0],90-s[1],e)}const i=this.paint.get("sky-gradient-center");return gv(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(a){this._skyboxInvalidated=!1,this._lightPosition=a.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const a=this.paint.get("sky-type");return a==="atmosphere"?["skyboxCapture","skybox"]:a==="gradient"?["skyboxGradient"]:null}},slot:class extends _n{constructor(a,e,i,s){super(a,{paint:Yx||(Yx=new jr({}))},e,null)}},model:class extends _n{constructor(a,e,i,s){super(a,{layout:ab||(ab=new jr({visibility:new wt(Ge.layout_model.visibility),"model-id":new Gt(Ge.layout_model["model-id"])})),paint:sb||(sb=new jr({"model-opacity":new Gt(Ge.paint_model["model-opacity"]),"model-rotation":new Gt(Ge.paint_model["model-rotation"]),"model-scale":new Gt(Ge.paint_model["model-scale"]),"model-translation":new Gt(Ge.paint_model["model-translation"]),"model-color":new Gt(Ge.paint_model["model-color"]),"model-color-mix-intensity":new Gt(Ge.paint_model["model-color-mix-intensity"]),"model-type":new wt(Ge.paint_model["model-type"]),"model-cast-shadows":new wt(Ge.paint_model["model-cast-shadows"]),"model-receive-shadows":new wt(Ge.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new wt(Ge.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Gt(Ge.paint_model["model-emissive-strength"]),"model-roughness":new Gt(Ge.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Gt(Ge.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new wt(Ge.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new wt(Ge.paint_model["model-front-cutoff"]),"model-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(a){return new xv(a)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(a){return a instanceof Kg?zt-1:0}queryIntersectsFeature(a,e,i,s,h,l){if(!this.modelManager)return!1;const d=this.modelManager,v=a.tile.getBucket(this);if(!(v&&v instanceof xv))return!1;for(const S in v.instancesPerModel){const R=v.instancesPerModel[S],g=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(R.idToFeaturesIndex.hasOwnProperty(g)){const E=R.features[R.idToFeaturesIndex[g]],D=d.getModel(S,this.scope);if(!D)return!1;let T=Ae.mat4.create();const A=new ir(0,0),z=v.canonical;let B=Number.MAX_VALUE;for(let N=0;N<E.instancedDataCount;++N){const Z=16*(E.instancedDataOffset+N),X=R.instancedDataArray.float32,q=[X[Z+4],X[Z+5],X[Z+6]];fb(z,A,X[Z],0|X[Z+1]),ob(T,D,l,A,E.rotation,E.scale,q,!1,!1,!1),l.projection.name==="globe"&&(T=vv(T,l));const Y=Ae.mat4.multiply([],l.projMatrix,T),K=a.queryGeometry,re=eb(K.isPointQuery()?K.screenBounds:K.screenGeometry,l,Y,D.aabb);re!=null&&(B=Math.min(re,B))}return B!==Number.MAX_VALUE&&B}}return!1}_handleOverridablePaintPropertyUpdate(a,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||a!=="model-color"&&a!=="model-color-mix-intensity"&&a!=="model-rotation"&&a!=="model-scale"&&a!=="model-translation"&&a!=="model-emissive-strength")}_isPropertyZoomDependent(a){const e=this._transitionablePaint._values[a];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof Bo}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends _n{constructor(a,e,i,s){super(a,{layout:jm||(jm=new jr({"clip-layer-types":new wt(Ge.layout_clip["clip-layer-types"]),"clip-layer-scope":new wt(Ge.layout_clip["clip-layer-scope"])})),paint:qm||(qm=new jr({}))},e,i,s)}recalculate(a,e){super.recalculate(a,e)}createBucket(a){return new Np(a)}isTileClipped(){return!0}is3D(){return!0}}};class zT{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class OT{constructor(){this.tasks={},this.taskQueue=[],Oc(["process"],this),this.invoker=new zT(this.process),this.nextId=0}add(e,i){const s=this.nextId++,h=function({type:l,isSymbolTile:d,zoom:v}){return v=v||0,l==="message"?0:l!=="maybePrepare"||d?l!=="parseTile"||d?l==="parseTile"&&d?300-v:l==="maybePrepare"&&d?400-v:500:200-v:100-v}(i);if(h===0){try{e()}finally{}return null}return this.tasks[s]={fn:e,metadata:i,priority:h,id:s},this.taskQueue.push(s),this.invoker.trigger(),{cancel:()=>{delete this.tasks[s]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(s=>!!this.tasks[s]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let h=0;h<this.taskQueue.length;h++){const l=this.tasks[this.taskQueue[h]];l.priority<i&&(i=l.priority,e=h)}if(e===null)return null;const s=this.taskQueue[e];return this.taskQueue.splice(e,1),s}remove(){this.invoker.remove()}}class db{constructor(e,i,s){this.target=e,this.parent=i,this.mapId=s,this.callbacks={},this.cancelCallbacks={},Oc(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new OT}send(e,i,s,h,l=!1,d){const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(s.metadata=d,this.callbacks[v]=s);const S=new Set;return this.target.postMessage({id:v,type:e,hasCallback:!!s,targetMapId:h,mustQueue:l,sourceMapId:this.mapId,data:No(i,S)},S),{cancel:()=>{s&&delete this.callbacks[v],this.target.postMessage({id:v,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}receive(e){const i=e.data,s=i.id;if(s&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const h=this.cancelCallbacks[s];delete this.cancelCallbacks[s],h&&h.cancel()}else if(i.mustQueue||hs()){const h=this.callbacks[s],l=this.scheduler.add(()=>this.processTask(s,i),h&&h.metadata||{type:"message"});l&&(this.cancelCallbacks[s]=l)}else this.processTask(s,i)}processTask(e,i){if(delete this.cancelCallbacks[e],i.type==="<response>"){const s=this.callbacks[e];delete this.callbacks[e],s&&(i.error?s(ja(i.error)):s(null,ja(i.data)))}else{const s=new Set,h=i.hasCallback?(d,v)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:d?No(d):null,data:No(v,s)},s)}:()=>{},l=ja(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,l,h);else if(this.parent.getWorkerSource){const d=i.type.split(".");this.parent.getWorkerSource(i.sourceMapId,d[0],l.source,l.scope)[d[1]](l,h)}else h(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var E_={workerUrl:"",workerClass:null,workerParams:void 0};const Sv="mapboxgl_preloaded_worker_pool";class Wd{constructor(){this.active={}}acquire(e,i=Wd.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<i;)this.workers.push(E_.workerClass!=null?new E_.workerClass:new self.Worker(E_.workerUrl,E_.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Sv]}numActive(){return Object.keys(this.active).length}}Wd.workerCount=2;class lm{constructor(e,i,s="Worker",h=Wd.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=el();const l=this.workerPool.acquire(this.id,h);for(let d=0;d<l.length;d++){const v=new lm.Actor(l[d],i,this.id);v.name=`${s} ${d}`,this.actors.push(v)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,i,s){wo(this.actors,(h,l)=>{h.send(e,i,l)},s=s||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}let M_,Ev;function Jg(){return M_||(M_=new Wd),M_}lm.Actor=db;const Mv=new nr(0,0,0);var Av=(a=>(a[a.PATH_RULE_UNSPECIFIED=0]="PATH_RULE_UNSPECIFIED",a[a.PATH_RULE_NON_ZERO=1]="PATH_RULE_NON_ZERO",a[a.PATH_RULE_EVEN_ODD=2]="PATH_RULE_EVEN_ODD",a))(Av||{}),ey=(a=>(a[a.LINE_CAP_UNSPECIFIED=0]="LINE_CAP_UNSPECIFIED",a[a.LINE_CAP_BUTT=1]="LINE_CAP_BUTT",a[a.LINE_CAP_ROUND=2]="LINE_CAP_ROUND",a[a.LINE_CAP_SQUARE=3]="LINE_CAP_SQUARE",a))(ey||{}),A_=(a=>(a[a.LINE_JOIN_UNSPECIFIED=0]="LINE_JOIN_UNSPECIFIED",a[a.LINE_JOIN_MITER=1]="LINE_JOIN_MITER",a[a.LINE_JOIN_MITER_CLIP=2]="LINE_JOIN_MITER_CLIP",a[a.LINE_JOIN_ROUND=3]="LINE_JOIN_ROUND",a[a.LINE_JOIN_BEVEL=4]="LINE_JOIN_BEVEL",a))(A_||{}),pb=(a=>(a[a.PAINT_ORDER_UNSPECIFIED=0]="PAINT_ORDER_UNSPECIFIED",a[a.PAINT_ORDER_FILL_AND_STROKE=1]="PAINT_ORDER_FILL_AND_STROKE",a[a.PAINT_ORDER_STROKE_AND_FILL=2]="PAINT_ORDER_STROKE_AND_FILL",a))(pb||{}),cm=(a=>(a[a.PATH_COMMAND_UNSPECIFIED=0]="PATH_COMMAND_UNSPECIFIED",a[a.PATH_COMMAND_MOVE=1]="PATH_COMMAND_MOVE",a[a.PATH_COMMAND_LINE=2]="PATH_COMMAND_LINE",a[a.PATH_COMMAND_QUAD=3]="PATH_COMMAND_QUAD",a[a.PATH_COMMAND_CUBIC=4]="PATH_COMMAND_CUBIC",a[a.PATH_COMMAND_CLOSE=5]="PATH_COMMAND_CLOSE",a))(cm||{}),mb=(a=>(a[a.MASK_TYPE_UNSPECIFIED=0]="MASK_TYPE_UNSPECIFIED",a[a.MASK_TYPE_LUMINANCE=1]="MASK_TYPE_LUMINANCE",a[a.MASK_TYPE_ALPHA=2]="MASK_TYPE_ALPHA",a))(mb||{});function LT(a,e,i){a===1&&e.icons.push(function(s,h){return function(l){if(l.usvg_tree.height||(l.usvg_tree.height=l.usvg_tree.width),!l.metadata)return l;const{metadata:d}=l;if(d.content_area){const{content_area:v}=d;v.top==null&&(v.top=v.left),v.width==null&&(v.width=l.usvg_tree.width),v.height==null&&(v.height=v.width)}return d.stretch_x&&d.stretch_x.length&&_b(d,"x"),d.stretch_y&&d.stretch_y.length&&_b(d,"y"),l}(s.readFields(PT,{name:void 0},h))}(i,i.readVarint()+i.pos))}function _b(a,e){const i=[],s=a[`stretch_${e}`];let h=null;for(let l=0;l<s.length;l++)h===null?h=i.length===0?s[0]:i[i.length-1][1]+s[l]:(i.push([h,h+s[l]]),h=null);a[`stretch_${e}_areas`]=i}function PT(a,e,i){a===1?e.name=i.readString():a===2?e.metadata=function(s,h){return s.readFields(kT,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},h)}(i,i.readVarint()+i.pos):a===3&&(e.usvg_tree=function(s,h){return s.readFields(NT,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},h)}(i,i.readVarint()+i.pos),e.data="usvg_tree")}function kT(a,e,i){a===1?e.stretch_x=i.readPackedVarint():a===2?e.stretch_y=i.readPackedVarint():a===3?e.content_area=function(s,h){return s.readFields(FT,{left:0},h)}(i,i.readVarint()+i.pos):a===4&&e.variables.push(function(s,h){return s.readFields(BT,{name:void 0},h)}(i,i.readVarint()+i.pos))}function FT(a,e,i){a===1?e.left=i.readVarint():a===2?e.width=i.readVarint():a===3?e.top=i.readVarint():a===4&&(e.height=i.readVarint())}function BT(a,e,i){a===1?e.name=i.readString():a===2&&(e.rgb_color=ry(i.readVarint()),e.value="rgb_color")}function NT(a,e,i){a===1?e.width=e.height=i.readVarint():a===2?e.height=i.readVarint():a===3?e.children.push(ty(i,i.readVarint()+i.pos)):a===4?e.linear_gradients.push(function(s,h){return s.readFields(ZT,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},h)}(i,i.readVarint()+i.pos)):a===5?e.radial_gradients.push(function(s,h){return s.readFields(YT,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},h)}(i,i.readVarint()+i.pos)):a===7?e.clip_paths.push(function(s,h){return s.readFields(WT,{children:[]},h)}(i,i.readVarint()+i.pos)):a===8&&e.masks.push(function(s,h){const l=s.readFields($T,{left:0,width:20,mask_type:1,children:[]},h);return l.height==null&&(l.height=l.width),l.top==null&&(l.top=l.left),l}(i,i.readVarint()+i.pos))}function ty(a,e){return a.readFields(VT,{},e)}function VT(a,e,i){a===1?(e.group=function(s,h){return s.readFields(UT,{opacity:255,children:[]},h)}(i,i.readVarint()+i.pos),e.node="group"):a===2&&(e.path=function(s,h){return s.readFields(qT,{paint_order:1,commands:[],step:1,diffs:[],rule:1},h)}(i,i.readVarint()+i.pos),e.node="path")}function UT(a,e,i){a===1?e.transform=iy(i,i.readVarint()+i.pos):a===2?e.opacity=i.readVarint():a===5?e.clip_path_idx=i.readVarint():a===6?e.mask_idx=i.readVarint():a===7&&e.children.push(ty(i,i.readVarint()+i.pos))}function iy(a,e){return a.readFields(jT,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function jT(a,e,i){a===1?e.sx=i.readFloat():a===2?e.ky=i.readFloat():a===3?e.kx=i.readFloat():a===4?e.sy=i.readFloat():a===5?e.tx=i.readFloat():a===6&&(e.ty=i.readFloat())}function qT(a,e,i){a===1?e.fill=function(s,h){return s.readFields(GT,{rgb_color:Mv,paint:"rgb_color",opacity:255},h)}(i,i.readVarint()+i.pos):a===2?e.stroke=function(s,h){return s.readFields(HT,{rgb_color:Mv,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},h)}(i,i.readVarint()+i.pos):a===3?e.paint_order=i.readVarint():a===5?i.readPackedVarint(e.commands):a===6?e.step=i.readFloat():a===7?i.readPackedSVarint(e.diffs):a===8&&(e.rule=i.readVarint())}function GT(a,e,i){a===1?(e.rgb_color=ry(i.readVarint()),e.paint="rgb_color"):a===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):a===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):a===5&&(e.opacity=i.readVarint())}function ry(a){return new nr((a>>16&255)/255,(a>>8&255)/255,(255&a)/255,1)}function HT(a,e,i){a===1?(e.rgb_color=ry(i.readVarint()),e.paint="rgb_color"):a===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):a===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):a===5?i.readPackedFloat(e.dasharray):a===6?e.dashoffset=i.readFloat():a===7?e.miterlimit=i.readFloat():a===8?e.opacity=i.readVarint():a===9?e.width=i.readFloat():a===10?e.linecap=i.readVarint():a===11&&(e.linejoin=i.readVarint())}function ZT(a,e,i){a===1?e.transform=iy(i,i.readVarint()+i.pos):a===2?e.spread_method=i.readVarint():a===3?e.stops.push(gb(i,i.readVarint()+i.pos)):a===4?e.x1=i.readFloat():a===5?e.y1=i.readFloat():a===6?e.x2=i.readFloat():a===7&&(e.y2=i.readFloat())}function gb(a,e){return a.readFields(XT,{offset:0,opacity:255,rgb_color:Mv},e)}function XT(a,e,i){a===1?e.offset=i.readFloat():a===2?e.opacity=i.readVarint():a===3&&(e.rgb_color=ry(i.readVarint()))}function YT(a,e,i){a===1?e.transform=iy(i,i.readVarint()+i.pos):a===2?e.spread_method=i.readVarint():a===3?e.stops.push(gb(i,i.readVarint()+i.pos)):a===4?e.cx=i.readFloat():a===5?e.cy=i.readFloat():a===6?e.r=i.readFloat():a===7?e.fx=i.readFloat():a===8?e.fy=i.readFloat():a===9&&(e.fr=i.readFloat())}function WT(a,e,i){a===1?e.transform=iy(i,i.readVarint()+i.pos):a===2?e.clip_path_idx=i.readVarint():a===3&&e.children.push(ty(i,i.readVarint()+i.pos))}function $T(a,e,i){a===1?e.left=e.top=i.readFloat():a===2?e.width=e.height=i.readFloat():a===3?e.top=i.readFloat():a===4?e.height=i.readFloat():a===5?e.mask_type=i.readVarint():a===6?e.mask_idx=i.readVarint():a===7&&e.children.push(ty(i,i.readVarint()+i.pos))}class QT{static calculate(e,i){const s=new Map,h=new Map;if(Object.keys(e).length===0)return s;i.forEach(l=>{h.set(l.name,l.rgb_color||new nr(0,0,0))});for(const[l,d]of Object.entries(e))h.has(l)?s.set(h.get(l).toStringPremultipliedAlpha(),d):console.warn(`Ignoring unknown image variable "${l}"`);return s}}function um(a,e=255,i){const s=e/255,h=a.toStringPremultipliedAlpha(),l=i.has(h)?i.get(h).clone():a.clone();return l.a=s,l.toString()}function C_(a,e){if(!oe()){const i=document.createElement("canvas");return i.width=a,i.height=e,i}return new OffscreenCanvas(a,e)}function KT(a,e){const i=QT.calculate(e.params,a.metadata?a.metadata.variables:[]),s=a.usvg_tree,h=s.width,l=s.height,d=e.transform?e.transform:new DOMMatrix,v=Math.max(1,Math.round(h*d.a)),S=Math.max(1,Math.round(l*d.d)),R=new DOMMatrix([v/h,0,0,S/l,0,0]),g=C_(v,S).getContext("2d");return Cv(g,R,s,s,i),g.getImageData(0,0,v,S)}function Cv(a,e,i,s,h){for(const l of s.children)yb(a,e,i,l,h)}function yb(a,e,i,s,h){s.group?(a.save(),function(l,d,v,S,R){const g=S.mask_idx!=null?v.masks[S.mask_idx]:null,E=S.clip_path_idx!=null?v.clip_paths[S.clip_path_idx]:null;if(S.transform&&(d=ny(S.transform).preMultiplySelf(d)),!function(A,z,B){return A.opacity!==255||z||B}(S,E!=null,g!=null))return void Cv(l,d,v,S,R);const D=C_(l.canvas.width,l.canvas.height),T=D.getContext("2d");Cv(T,d,v,S,R),E&&Eb(T,d,v,E),g&&Mb(T,d,v,g,R),l.globalAlpha=S.opacity/255,l.drawImage(D,0,0)}(a,e,i,s.group,h),a.restore()):s.path&&(a.save(),function(l,d,v,S,R){const g=Ab(S);l.setTransform(d),S.paint_order===pb.PAINT_ORDER_FILL_AND_STROKE?(vb(l,v,S,g,R),bb(l,v,S,g,R)):(bb(l,v,S,g,R),vb(l,v,S,g,R))}(a,e,i,s.path,h),a.restore())}function vb(a,e,i,s,h){const l=i.fill;if(!l)return;const d=l.opacity/255;switch(l.paint){case"rgb_color":a.fillStyle=um(l.rgb_color,l.opacity,h);break;case"linear_gradient_idx":a.fillStyle=wb(a,e.linear_gradients[l.linear_gradient_idx],d,h);break;case"radial_gradient_idx":a.fillStyle=Tb(a,e.radial_gradients[l.radial_gradient_idx],d,h)}a.fill(s,xb(i))}function xb(a){return a.rule===Av.PATH_RULE_NON_ZERO?"nonzero":a.rule===Av.PATH_RULE_EVEN_ODD?"evenodd":void 0}function bb(a,e,i,s,h){const l=i.stroke;if(!l)return;a.lineWidth=l.width,a.miterLimit=l.miterlimit,a.setLineDash(l.dasharray),a.lineDashOffset=l.dashoffset;const d=l.opacity/255;switch(l.paint){case"rgb_color":a.strokeStyle=um(l.rgb_color,l.opacity,h);break;case"linear_gradient_idx":a.strokeStyle=wb(a,e.linear_gradients[l.linear_gradient_idx],d,h);break;case"radial_gradient_idx":a.strokeStyle=Tb(a,e.radial_gradients[l.radial_gradient_idx],d,h)}switch(l.linejoin){case A_.LINE_JOIN_MITER_CLIP:case A_.LINE_JOIN_MITER:a.lineJoin="miter";break;case A_.LINE_JOIN_ROUND:a.lineJoin="round";break;case A_.LINE_JOIN_BEVEL:a.lineJoin="bevel"}switch(l.linecap){case ey.LINE_CAP_BUTT:a.lineCap="butt";break;case ey.LINE_CAP_ROUND:a.lineCap="round";break;case ey.LINE_CAP_SQUARE:a.lineCap="square"}a.stroke(s)}function wb(a,e,i,s){if(e.stops.length===1){const D=e.stops[0];return um(D.rgb_color,D.opacity*i,s)}const h=ny(e.transform),{x1:l,y1:d,x2:v,y2:S}=e,R=h.transformPoint(new DOMPoint(l,d)),g=h.transformPoint(new DOMPoint(v,S)),E=a.createLinearGradient(R.x,R.y,g.x,g.y);for(const D of e.stops)E.addColorStop(D.offset,um(D.rgb_color,D.opacity*i,s));return E}function Tb(a,e,i,s){if(e.stops.length===1){const D=e.stops[0];return um(D.rgb_color,D.opacity*i,s)}const h=ny(e.transform),{fx:l,fy:d,cx:v,cy:S}=e,R=h.transformPoint(new DOMPoint(l,d)),g=h.transformPoint(new DOMPoint(v,S)),E=a.createRadialGradient(R.x,R.y,0,g.x,g.y,e.r*((h.a+h.d)/2));for(const D of e.stops)E.addColorStop(D.offset,um(D.rgb_color,D.opacity*i,s));return E}function Sb(a,e,i,s){const h=s.transform?ny(s.transform).preMultiplySelf(e):e,l=C_(a.canvas.width,a.canvas.height),d=l.getContext("2d");for(const S of s.children)if(S.group)Sb(d,h,i,S.group);else if(S.path){const R=S.path,g=new Path2D;g.addPath(Ab(R),h),d.fill(g,xb(R))}const v=s.clip_path_idx!=null?i.clip_paths[s.clip_path_idx]:null;v&&Eb(d,h,i,v),a.globalCompositeOperation="source-over",a.drawImage(l,0,0)}function Eb(a,e,i,s){const h=C_(a.canvas.width,a.canvas.height);Sb(h.getContext("2d"),e,i,s),a.globalCompositeOperation="destination-in",a.drawImage(h,0,0)}function Mb(a,e,i,s,h){if(s.children.length===0)return;const l=s.mask_idx!=null?i.masks[s.mask_idx]:null;l&&Mb(a,e,i,l,h);const d=a.canvas.width,v=a.canvas.height,S=C_(d,v),R=S.getContext("2d"),g=s.width,E=s.height,D=s.left,T=s.top,A=new Path2D,z=new Path2D;z.rect(D,T,g,E),A.addPath(z,e),R.clip(A);for(const Z of s.children)yb(R,e,i,Z,h);const B=R.getImageData(0,0,d,v),N=B.data;if(s.mask_type===mb.MASK_TYPE_LUMINANCE)for(let Z=0;Z<N.length;Z+=4)N[Z+3]=N[Z+3]/255*(.2126*N[Z]+.7152*N[Z+1]+.0722*N[Z+2]);R.putImageData(B,0,0),a.globalCompositeOperation="destination-in",a.drawImage(S,0,0)}function ny(a){return a?new DOMMatrix([a.sx,a.ky,a.kx,a.sy,a.tx,a.ty]):new DOMMatrix}function Ab(a){const e=new Path2D,i=a.step;let s=a.diffs[0]*i,h=a.diffs[1]*i;e.moveTo(s,h);for(let l=0,d=2;l<a.commands.length;l++)switch(a.commands[l]){case cm.PATH_COMMAND_MOVE:s+=a.diffs[d++]*i,h+=a.diffs[d++]*i,e.moveTo(s,h);break;case cm.PATH_COMMAND_LINE:s+=a.diffs[d++]*i,h+=a.diffs[d++]*i,e.lineTo(s,h);break;case cm.PATH_COMMAND_QUAD:{const v=s+a.diffs[d++]*i,S=h+a.diffs[d++]*i;s=v+a.diffs[d++]*i,h=S+a.diffs[d++]*i,e.quadraticCurveTo(v,S,s,h);break}case cm.PATH_COMMAND_CUBIC:{const v=s+a.diffs[d++]*i,S=h+a.diffs[d++]*i,R=v+a.diffs[d++]*i,g=S+a.diffs[d++]*i;s=R+a.diffs[d++]*i,h=g+a.diffs[d++]*i,e.bezierCurveTo(v,S,R,g,s,h);break}case cm.PATH_COMMAND_CLOSE:e.closePath()}return e}class Dv{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const i=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,i),i}put(e,i){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,i)}delete(e){this.cache.delete(e)}}class Iv{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new Qn(e,e.data)}getFromCache(e,i,s){return this.cacheMap.has(s)||this.cacheMap.set(s,new Dv(150)),this.cacheMap.get(s).get(es(e.serialize(),i))}setInCache(e,i,s,h){this.cacheDependenciesMap.has(h)||this.cacheDependenciesMap.set(h,new Map),this.cacheMap.has(h)||this.cacheMap.set(h,new Dv(150));const l=this.cacheDependenciesMap.get(h);l.get(es(e.id,s))||l.set(es(e.id,s),new Set);const d=this.cacheMap.get(h),v=e.serialize();l.get(es(e.id,s)).add(v),d.put(es(e.serialize(),s),i)}removeImagesFromCacheByIds(e,i,s=""){if(!this.cacheMap.has(s)||!this.cacheDependenciesMap.has(s))return;const h=this.cacheMap.get(s),l=this.cacheDependenciesMap.get(s);for(const d of e)if(l.has(es(d,i))){for(const v of l.get(es(d,i)))h.delete(v);l.delete(es(d,i))}}rasterize(e,i,s,h,l=KT){const d=this.getFromCache(e,s,h);if(d)return d.clone();const v=l(i.icon,e.options),S=Iv._getImage(v);return this.setInCache(e,S,s,h),S.clone()}}class Cb{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const s=this.toIdx(e,i);return{min:this.minimums[s],max:this.maximums[s]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function Db(a,e,i,s){let h=0,l=Number.MAX_VALUE;for(let d=0;d<3;d++)if(Math.abs(s[d])<1e-15){if(i[d]<a[d]||i[d]>e[d])return null}else{const v=1/s[d];let S=(a[d]-i[d])*v,R=(e[d]-i[d])*v;if(S>R){const g=S;S=R,R=g}if(S>h&&(h=S),R<l&&(l=R),h>l)return null}return h}function Ib(a,e,i,s,h,l,d,v,S,R,g){const E=s-a,D=h-e,T=l-i,A=d-a,z=v-e,B=S-i,N=g[1]*B-g[2]*z,Z=g[2]*A-g[0]*B,X=g[0]*z-g[1]*A,q=E*N+D*Z+T*X;if(Math.abs(q)<1e-15)return null;const Y=1/q,K=R[0]-a,re=R[1]-e,he=R[2]-i,ue=(K*N+re*Z+he*X)*Y;if(ue<0||ue>1)return null;const ce=re*T-he*D,Te=he*E-K*T,de=K*D-re*E,Se=(g[0]*ce+g[1]*Te+g[2]*de)*Y;return Se<0||ue+Se>1?null:(A*ce+z*Te+B*de)*Y}function Rb(a,e,i){return(a-e)/(i-e)}function zb(a,e,i,s,h,l,d,v,S){const R=1<<i,g=l-s,E=d-h,D=(a+1)/R*g+s,T=(e+0)/R*E+h,A=(e+1)/R*E+h;v[0]=(a+0)/R*g+s,v[1]=T,S[0]=D,S[1]=A}class Ob{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(l){const d=Math.ceil(Math.log2(l.dim/8)),v=[];let S=Math.ceil(Math.pow(2,d));const R=1/S,g=(T,A,z,B,N)=>{const Z=B?1:0,X=(T+1)*z-Z,q=A*z,Y=(A+1)*z-Z;N[0]=T*z,N[1]=q,N[2]=X,N[3]=Y};let E=new Cb(S);const D=[];for(let T=0;T<S*S;T++){g(T%S,Math.floor(T/S),R,!1,D);const A=Bf(D[0],D[1],l),z=Bf(D[2],D[1],l),B=Bf(D[2],D[3],l),N=Bf(D[0],D[3],l);E.minimums.push(Math.min(A,z,B,N)),E.maximums.push(Math.max(A,z,B,N)),E.leaves.push(1)}for(v.push(E),S/=2;S>=1;S/=2){const T=v[v.length-1];E=new Cb(S);for(let A=0;A<S*S;A++){g(A%S,Math.floor(A/S),2,!0,D);const z=T.getElevation(D[0],D[1]),B=T.getElevation(D[2],D[1]),N=T.getElevation(D[2],D[3]),Z=T.getElevation(D[0],D[3]),X=T.isLeaf(D[0],D[1]),q=T.isLeaf(D[2],D[1]),Y=T.isLeaf(D[2],D[3]),K=T.isLeaf(D[0],D[3]),re=Math.min(z.min,B.min,N.min,Z.min),he=Math.max(z.max,B.max,N.max,Z.max),ue=X&&q&&Y&&K;E.maximums.push(he),E.minimums.push(re),E.leaves.push(he-re<=5&&ue?1:0)}v.push(E)}return v}(this.dem),s=i.length-1,h=i[s];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(i,0,0,s,0)}raycastRoot(e,i,s,h,l,d,v=1){return Db([e,i,-100],[s,h,this.maximums[0]*v],l,d)}raycast(e,i,s,h,l,d,v=1){if(!this.nodeCount)return null;const S=this.raycastRoot(e,i,s,h,l,d,v);if(S==null)return null;const R=[],g=[],E=[],D=[],T=[{idx:0,t:S,nodex:0,nodey:0,depth:0}];for(;T.length>0;){const{idx:A,t:z,nodex:B,nodey:N,depth:Z}=T.pop();if(this.leaves[A]){zb(B,N,Z,e,i,s,h,E,D);const q=1<<Z,Y=(B+0)/q,K=(B+1)/q,re=(N+0)/q,he=(N+1)/q,ue=Bf(Y,re,this.dem)*v,ce=Bf(K,re,this.dem)*v,Te=Bf(K,he,this.dem)*v,de=Bf(Y,he,this.dem)*v,Se=Ib(E[0],E[1],ue,D[0],E[1],ce,D[0],D[1],Te,l,d),Ce=Ib(D[0],D[1],Te,E[0],D[1],de,E[0],E[1],ue,l,d),Me=Math.min(Se!==null?Se:Number.MAX_VALUE,Ce!==null?Ce:Number.MAX_VALUE);if(Me!==Number.MAX_VALUE)return Me;{const Le=Ae.vec3.scaleAndAdd([],l,d,z);if(Lb(ue,ce,de,Te,Rb(Le[0],E[0],D[0]),Rb(Le[1],E[1],D[1]))>=Le[2])return z}continue}let X=0;for(let q=0;q<this._siblingOffset.length;q++){zb((B<<1)+this._siblingOffset[q][0],(N<<1)+this._siblingOffset[q][1],Z+1,e,i,s,h,E,D),E[2]=-100,D[2]=this.maximums[this.childOffsets[A]+q]*v;const Y=Db(E,D,l,d);if(Y!=null){const K=Y;R[q]=K;let re=!1;for(let he=0;he<X&&!re;he++)K>=R[g[he]]&&(g.splice(he,0,q),re=!0);re||(g[X]=q),X++}}for(let q=0;q<X;q++){const Y=g[q];T.push({idx:this.childOffsets[A]+Y,t:R[Y],nodex:(B<<1)+this._siblingOffset[Y][0],nodey:(N<<1)+this._siblingOffset[Y][1],depth:Z+1})}}return null}_addNode(e,i,s){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(s),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,s,h,l){if(e[h].isLeaf(i,s)===1)return;this.childOffsets[l]||(this.childOffsets[l]=this.nodeCount);const d=h-1,v=e[d];let S=0,R=0;for(let g=0;g<this._siblingOffset.length;g++){const E=2*i+this._siblingOffset[g][0],D=2*s+this._siblingOffset[g][1],T=v.getElevation(E,D),A=v.isLeaf(E,D),z=this._addNode(T.min,T.max,A);A&&(S|=1<<g),R||(R=z)}for(let g=0;g<this._siblingOffset.length;g++)S&1<<g||this._construct(e,2*i+this._siblingOffset[g][0],2*s+this._siblingOffset[g][1],d,R+g)}}function Lb(a,e,i,s,h,l){return di(di(a,i,l),di(e,s,l),h)}function Bf(a,e,i){const s=i.dim,h=Mi(a*s-.5,0,s-1),l=Mi(e*s-.5,0,s-1),d=Math.floor(h),v=Math.floor(l),S=Math.min(d+1,s-1),R=Math.min(v+1,s-1);return Lb(i.get(d,v),i.get(S,v),i.get(d,R),i.get(S,R),h-d,l-v)}const JT={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function eS(a,e,i){return(256*a*256+256*e+i)/10-1e4}function tS(a,e,i){return 256*a+e+i/256-32768}class ay{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,s,h=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(s&&s!=="mapbox"&&s!=="terrarium")return void Ri(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const l=this.dim=i.height-2,d=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=h,this._modifiedForSources={},!h){for(let S=0;S<l;S++)d[this._idx(-1,S)]=d[this._idx(0,S)],d[this._idx(l,S)]=d[this._idx(l-1,S)],d[this._idx(S,-1)]=d[this._idx(S,0)],d[this._idx(S,l)]=d[this._idx(S,l-1)];d[this._idx(-1,-1)]=d[this._idx(0,0)],d[this._idx(l,-1)]=d[this._idx(l-1,0)],d[this._idx(-1,l)]=d[this._idx(0,l-1)],d[this._idx(l,l)]=d[this._idx(l-1,l-1)]}const v=s==="terrarium"?tS:eS;for(let S=0;S<d.length;++S){const R=4*S;this.floatView[S]=v(this.pixels[R],this.pixels[R+1],this.pixels[R+2])}this._timestamp=ye.now()}_buildQuadTree(){this._tree=new Ob(this)}get(e,i,s=!1){s&&(e=Mi(e,-1,this.dim),i=Mi(i,-1,this.dim));const h=this._idx(e,i);return this.floatView[h]}set(e,i,s){const h=this._idx(e,i),l=this.floatView[h];return this.floatView[h]=s,s-l}static getUnpackVector(e){return JT[e]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const s=[0,0,0,0],h=ay.getUnpackVector(i);let l=Math.floor((e+h[3])/h[2]);return s[2]=l%256,l=Math.floor(l/256),s[1]=l%256,l=Math.floor(l/256),s[0]=l,s}getPixels(){return new Vm({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let h=i*this.dim,l=i*this.dim+this.dim,d=s*this.dim,v=s*this.dim+this.dim;switch(i){case-1:h=l-1;break;case 1:l=h+1}switch(s){case-1:d=v-1;break;case 1:v=d+1}const S=-i*this.dim,R=-s*this.dim;for(let g=d;g<v;g++)for(let E=h;E<l;E++){const D=4*this._idx(E,g),T=4*this._idx(E+S,g+R);this.pixels[D+0]=e.pixels[T+0],this.pixels[D+1]=e.pixels[T+1],this.pixels[D+2]=e.pixels[T+2],this.pixels[D+3]=e.pixels[T+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function iS(a,e,i){a===1?e.headerLength=i.readFixed32():a===2?e.x=i.readVarint():a===3?e.y=i.readVarint():a===4?e.z=i.readVarint():a===5&&e.layers.push(function(s,h){return s.readFields(oS,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},h)}(i,i.readVarint()+i.pos))}function rS(a,e,i){a===1?(e.delta_filter=function(s,h){return s.readFields(nS,{blockSize:0},h)}(i,i.readVarint()+i.pos),e.filter="delta_filter"):a===2?(i.readVarint(),e.filter="zigzag_filter"):a===3?(i.readVarint(),e.filter="bitshuffle_filter"):a===4&&(i.readVarint(),e.filter="byteshuffle_filter")}function nS(a,e,i){a===1&&(e.blockSize=i.readVarint())}function aS(a,e,i){a===1?(i.readVarint(),e.codec="gzip_data"):a===2?(i.readVarint(),e.codec="jpeg_image"):a===3?(i.readVarint(),e.codec="webp_image"):a===4&&(i.readVarint(),e.codec="png_image")}function sS(a,e,i){let s=0,h=0;a===1?e.firstByte=i.readFixed64():a===2?e.lastByte=i.readFixed64():a===3?e.filters.push(function(l,d){return l.readFields(rS,{},d)}(i,i.readVarint()+i.pos)):a===4?e.codec=function(l,d){return l.readFields(aS,{},d)}(i,i.readVarint()+i.pos):a===5?h=i.readFloat():a===6?s=i.readFloat():a===7?e.bands.push(i.readString()):a===8?e.offset=i.readDouble():a===9&&(e.scale=i.readDouble()),e.offset===0&&(e.offset=h),e.scale===0&&(e.scale=s)}function oS(a,e,i){a===1?e.version=i.readVarint():a===2?e.name=i.readString():a===3?e.units=i.readString():a===4?e.tileSize=i.readVarint():a===5?e.buffer=i.readVarint():a===6?e.pixelFormat=i.readVarint():a===7&&e.dataIndex.push(function(s,h){return s.readFields(sS,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},h)}(i,i.readVarint()+i.pos))}function lS(a,e,i){if(a===2)(function(s,h,l){s.readFields(cS,l,h)})(i,i.readVarint()+i.pos,e);else if(a===3)throw new Error("Not implemented")}function cS(a,e,i){if(a===1){let s=0;const h=i.readVarint()+i.pos;for(;i.pos<h;)e[s++]=i.readVarint()}}function uS(a,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let i=e[3];for(let s=2;s>=1;s--){const h=s===1?1:0,l=s===2?1:0;for(let d=0;d<e[0];d++){const v=e[1]*d;for(let S=h;S<e[1];S++){const R=e[2]*(S+v);for(let g=l;g<e[2];g++){const E=e[3]*(g+R);for(let D=0;D<e[3];D++){const T=E+D;a[T]+=a[T-i]}}}}i*=e[s]}return a}function hS(a){for(let e=0,i=a.length;e<i;e++)a[e]=a[e]>>>1^-(1&a[e]);return a}function fS(a,e){switch(e){case"uint32":return a;case"uint16":for(let i=0;i<a.length;i+=2){const s=a[i],h=a[i+1];a[i]=(240&s)>>4|(61440&s)>>8|(240&h)<<4|61440&h,a[i+1]=15&s|(3840&s)>>4|(15&h)<<8|(3840&h)<<4}return a;case"uint8":for(let i=0;i<a.length;i+=4){const s=a[i],h=a[i+1],l=a[i+2],d=a[i+3];a[i+0]=(192&s)>>6|(192&h)>>4|(192&l)>>2|192&d,a[i+1]=(48&s)>>4|(48&h)>>2|48&l|(48&d)<<2,a[i+2]=(12&s)>>2|12&h|(12&l)<<2|(12&d)<<4,a[i+3]=3&s|(3&h)<<2|(3&l)<<4|(3&d)<<6}return a;default:throw new Error(`Invalid pixel format, "${e}"`)}}Zt(ay,"DEMData"),Zt(Ob,"DemMinMaxQuadTree",{omit:["dem"]});var $o=Uint8Array,D_=Uint16Array,dS=Int32Array,Pb=new $o([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),kb=new $o([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),pS=new $o([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Fb=function(a,e){for(var i=new D_(31),s=0;s<31;++s)i[s]=e+=1<<a[s-1];var h=new dS(i[30]);for(s=1;s<30;++s)for(var l=i[s];l<i[s+1];++l)h[l]=l-i[s]<<5|s;return{b:i,r:h}},Bb=Fb(Pb,2),Nb=Bb.b,mS=Bb.r;Nb[28]=258,mS[258]=28;for(var _S=Fb(kb,0).b,Vb=new D_(32768),Mn=0;Mn<32768;++Mn){var hm=(43690&Mn)>>1|(21845&Mn)<<1;Vb[Mn]=((65280&(hm=(61680&(hm=(52428&hm)>>2|(13107&hm)<<2))>>4|(3855&hm)<<4))>>8|(255&hm)<<8)>>1}var I_=function(a,e,i){for(var s=a.length,h=0,l=new D_(e);h<s;++h)a[h]&&++l[a[h]-1];var d,v=new D_(e);for(h=1;h<e;++h)v[h]=v[h-1]+l[h-1]<<1;d=new D_(1<<e);var S=15-e;for(h=0;h<s;++h)if(a[h])for(var R=h<<4|a[h],g=e-a[h],E=v[a[h]-1]++<<g,D=E|(1<<g)-1;E<=D;++E)d[Vb[E]>>S]=R;return d},R_=new $o(288);for(Mn=0;Mn<144;++Mn)R_[Mn]=8;for(Mn=144;Mn<256;++Mn)R_[Mn]=9;for(Mn=256;Mn<280;++Mn)R_[Mn]=7;for(Mn=280;Mn<288;++Mn)R_[Mn]=8;var Ub=new $o(32);for(Mn=0;Mn<32;++Mn)Ub[Mn]=5;var gS=I_(R_,9),yS=I_(Ub,5),Rv=function(a){for(var e=a[0],i=1;i<a.length;++i)a[i]>e&&(e=a[i]);return e},Sc=function(a,e,i){var s=e/8|0;return(a[s]|a[s+1]<<8)>>(7&e)&i},zv=function(a,e){var i=e/8|0;return(a[i]|a[i+1]<<8|a[i+2]<<16)>>(7&e)},vS=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Ec=function(a,e,i){var s=new Error(e||vS[a]);if(s.code=a,Error.captureStackTrace&&Error.captureStackTrace(s,Ec),!i)throw s;return s},xS=new $o(0),bS=typeof TextDecoder<"u"&&new TextDecoder;try{bS.decode(xS,{stream:!0})}catch{}const wS={gzip_data:"gzip"};class Vl extends Error{constructor(e){super(e),this.name="MRTError"}}const TS={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},jb={uint32:1,uint16:2,uint8:4},SS={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let Ov;class Lv{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const i=this.layers[e];if(!i)throw new Vl(`Layer '${e}' not found`);return i}getHeaderLength(e){const i=new Uint8Array(e),s=new DataView(e);if(i[0]!==13)throw new Vl("File is not a valid MRT.");return s.getUint32(1,!0)}parseHeader(e){const i=new Uint8Array(e),s=this.getHeaderLength(e);if(i.length<s)throw new Vl(`Expected header with length >= ${s} but got buffer of length ${i.length}`);const h=function(l,d){return l.readFields(iS,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new Ov(i.subarray(0,s)));if(!isNaN(this.x)&&(this.x!==h.x||this.y!==h.y||this.z!==h.z))throw new Vl(`Invalid attempt to parse header ${h.z}/${h.x}/${h.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=h.x,this.y=h.y,this.z=h.z;for(const l of h.layers)this.layers[l.name]=new ES(l,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const i=[],s=this.getLayer(e.layerName);for(let h of e.blockIndices){const l=s.dataIndex[h],d=l.firstByte-e.firstByte,v=l.lastByte-e.firstByte;if(s._blocksInProgress.has(h))continue;const S={layerName:s.name,firstByte:d,lastByte:v,pixelFormat:s.pixelFormat,blockIndex:h,blockShape:[l.bands.length].concat(s.bandShape),buffer:s.buffer,codec:l.codec.codec,filters:l.filters.map(R=>R.filter)};s._blocksInProgress.add(h),i.push(S)}return new qb(i,()=>{i.forEach(h=>s._blocksInProgress.delete(h.blockIndex))},(h,l)=>{if(i.forEach(d=>s._blocksInProgress.delete(d.blockIndex)),h)throw h;l.forEach(d=>{this.getLayer(d.layerName).processDecodedData(d)})})}}class ES{constructor({version:e,name:i,units:s,tileSize:h,pixelFormat:l,buffer:d,dataIndex:v},S){if(this.version=e,this.version!==1)throw new Vl(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=i,this.units=s,this.tileSize=h,this.buffer=d,this.pixelFormat=TS[l],this.dataIndex=v,this.bandShape=[h+2*d,h+2*d,jb[this.pixelFormat]],this._decodedBlocks=new Dv(S?S.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return jb[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){const i=e.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.put(i,e.data)}getBlockForBand(e){let i=0;switch(typeof e){case"string":for(const[s,h]of this.dataIndex.entries()){for(const[l,d]of h.bands.entries())if(d===e)return{bandIndex:i+l,blockIndex:s,blockBandIndex:l};i+=h.bands.length}break;case"number":for(const[s,h]of this.dataIndex.entries()){if(e>=i&&e<i+h.bands.length)return{bandIndex:e,blockIndex:s,blockBandIndex:e-i};i+=h.bands.length}break;default:throw new Vl(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new Vl(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let i=1/0,s=-1/0;const h=[],l=new Set;for(const d of e){const{blockIndex:v}=this.getBlockForBand(d);if(v<0)throw new Vl(`Invalid band: ${JSON.stringify(d)}`);const S=this.dataIndex[v];h.includes(v)||h.push(v),l.add(v),i=Math.min(i,S.firstByte),s=Math.max(s,S.lastByte)}if(l.size>this.cacheSize)throw new Vl(`Number of blocks to decode (${l.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:i,lastByte:s,blockIndices:h}}hasBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0}hasDataForBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(e){const{blockIndex:i,blockBandIndex:s}=this.getBlockForBand(e),h=this._decodedBlocks.get(i.toString());if(!h)throw new Vl(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const l=this.dataIndex[i],d=this.bandShape.reduce((R,g)=>R*g,1),v=s*d,S=h.subarray(v,v+d);return{data:S,bytes:new Uint8Array(S.buffer).subarray(S.byteOffset,S.byteOffset+S.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:l.offset,scale:l.scale}}}Lv.setPbf=function(a){Ov=a};class qb{constructor(e,i,s){this.tasks=e,this._onCancel=i,this._onComplete=s,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,i){this._finalized||(this._onComplete(e,i),this._finalized=!0)}}Lv.performDecoding=function(a,e){const i=new Uint8Array(a);return Promise.all(e.tasks.map(s=>{const{layerName:h,firstByte:l,lastByte:d,pixelFormat:v,blockShape:S,blockIndex:R,filters:g,codec:E}=s,D=i.subarray(l,d+1),T=new Uint32Array(S[0]*S[1]*S[2]);let A;if(E!=="gzip_data")throw new Vl(`Unhandled codec: ${E}`);return A=function(z,B){if(!globalThis.DecompressionStream&&B==="gzip_data")return Promise.resolve(((q=function(re){re[0]==31&&re[1]==139&&re[2]==8||Ec(6,"invalid gzip data");var he=re[3],ue=10;4&he&&(ue+=2+(re[10]|re[11]<<8));for(var ce=(he>>3&1)+(he>>4&1);ce>0;ce-=!re[ue++]);return ue+(2&he)}(X=z))+8>X.length&&Ec(6,"invalid gzip data"),function(re,he,ue,ce){var Te=re.length;if(!Te||he.f&&!he.l)return ue||new $o(0);var de=!ue,Se=de||he.i!=2,Ce=he.i;de&&(ue=new $o(3*Te));var Me,Le,ke=function(Nf){var Kd=ue.length;if(Nf>Kd){var P_=new $o(Math.max(2*Kd,Nf));P_.set(ue),ue=P_}},Ue=he.f||0,Pe=he.p||0,at=he.b||0,mt=he.l,nt=he.d,Bt=he.m,Ot=he.n,bt=8*Te;do{if(!mt){Ue=Sc(re,Pe,1);var yt=Sc(re,Pe+1,3);if(Pe+=3,!yt){var ei=re[(Ci=4+((Pe+7)/8|0))-4]|re[Ci-3]<<8,jt=Ci+ei;if(jt>Te){Ce&&Ec(0);break}Se&&ke(at+ei),ue.set(re.subarray(Ci,jt),at),he.b=at+=ei,he.p=Pe=8*jt,he.f=Ue;continue}if(yt==1)mt=gS,nt=yS,Bt=9,Ot=5;else if(yt==2){var Wt=Sc(re,Pe,31)+257,Ti=Sc(re,Pe+10,15)+4,zi=Wt+Sc(re,Pe+5,31)+1;Pe+=14;for(var Pi=new $o(zi),ki=new $o(19),$i=0;$i<Ti;++$i)ki[pS[$i]]=Sc(re,Pe+3*$i,7);Pe+=3*Ti;var Ki=Rv(ki),zr=(1<<Ki)-1,xr=I_(ki,Ki);for($i=0;$i<zi;){var Ci,yr=xr[Sc(re,Pe,zr)];if(Pe+=15&yr,(Ci=yr>>4)<16)Pi[$i++]=Ci;else{var vr=0,qr=0;for(Ci==16?(qr=3+Sc(re,Pe,3),Pe+=2,vr=Pi[$i-1]):Ci==17?(qr=3+Sc(re,Pe,7),Pe+=3):Ci==18&&(qr=11+Sc(re,Pe,127),Pe+=7);qr--;)Pi[$i++]=vr}}var pn=Pi.subarray(0,Wt),An=Pi.subarray(Wt);Bt=Rv(pn),Ot=Rv(An),mt=I_(pn,Bt),nt=I_(An,Ot)}else Ec(1);if(Pe>bt){Ce&&Ec(0);break}}Se&&ke(at+131072);for(var mn=(1<<Bt)-1,ln=(1<<Ot)-1,vn=Pe;;vn=Pe){var Pn=(vr=mt[zv(re,Pe)&mn])>>4;if((Pe+=15&vr)>bt){Ce&&Ec(0);break}if(vr||Ec(2),Pn<256)ue[at++]=Pn;else{if(Pn==256){vn=Pe,mt=null;break}var La=Pn-254;Pn>264&&(La=Sc(re,Pe,(1<<(Ac=Pb[$i=Pn-257]))-1)+Nb[$i],Pe+=Ac);var Nr=nt[zv(re,Pe)&ln],Ks=Nr>>4;if(Nr||Ec(3),Pe+=15&Nr,An=_S[Ks],Ks>3){var Ac=kb[Ks];An+=zv(re,Pe)&(1<<Ac)-1,Pe+=Ac}if(Pe>bt){Ce&&Ec(0);break}Se&&ke(at+131072);var Ul=at+La;if(at<An){var jl=0-An,Qd=Math.min(An,Ul);for(jl+at<0&&Ec(3);at<Qd;++at)ue[at]=(void 0)[jl+at]}for(;at<Ul;++at)ue[at]=ue[at-An]}}he.l=mt,he.p=vn,he.b=at,he.f=Ue,mt&&(Ue=1,he.m=Bt,he.d=nt,he.n=Ot)}while(!Ue);return at!=ue.length&&de?(Me=ue,((Le=at)==null||Le>Me.length)&&(Le=Me.length),new $o(Me.subarray(0,Le))):ue.subarray(0,at)}(X.subarray(q,-8),{i:2},new $o(((N=X)[(Z=N.length)-4]|N[Z-3]<<8|N[Z-2]<<16|N[Z-1]<<24)>>>0))));var N,Z,X,q;const Y=wS[B];if(!Y)throw new Error(`Unhandled codec: ${B}`);const K=new globalThis.DecompressionStream(Y);return new Response(new Blob([z]).stream().pipeThrough(K)).arrayBuffer().then(re=>new Uint8Array(re))}(D,E).then(z=>(function(B,N){B.readFields(lS,N)}(new Ov(z),T),new SS[v](T.buffer))),A.then(z=>{for(let B=g.length-1;B>=0;B--)switch(g[B]){case"delta_filter":uS(z,S);break;case"zigzag_filter":hS(z);break;case"bitshuffle_filter":fS(z,v);break;default:throw new Vl(`Unhandled filter "${g[B]}"`)}return{layerName:h,blockIndex:R,data:z}}).catch(z=>{throw z})}))},Zt(qb,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});let z_,Pv,Mc,fm,kv,dm=null;function Gb(){return hs()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:Pv||Jr.DRACO_URL}function Hb(){if(hs()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(fm)return fm;const a=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return fm=WebAssembly.validate(a)?Jr.MESHOPT_SIMD_URL:Jr.MESHOPT_URL,fm}const sy={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},MS={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},O_={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function Zb(a,e,i){const s=i.json.bufferViews.length,h=i.buffers.length;e.bufferView=s,i.json.bufferViews[s]={buffer:h,byteLength:a.byteLength},i.buffers[h]=a}const Fv="KHR_draco_mesh_compression";function AS(a,e){const i=a.extensions&&a.extensions[Fv];if(!i)return;const s=new Mc.Decoder,h=$b(e,i.bufferView),l=new Mc.Mesh;if(!s.DecodeArrayToMesh(h,h.byteLength,l))throw new Error("Failed to decode Draco mesh");const d=e.json.accessors[a.indices],v=sy[d.componentType],S=d.count*v.BYTES_PER_ELEMENT,R=Mc._malloc(S);v===Uint16Array?s.GetTrianglesUInt16Array(l,S,R):s.GetTrianglesUInt32Array(l,S,R),Zb(Mc.memory.buffer.slice(R,R+S),d,e),Mc._free(R);for(const g of Object.keys(i.attributes)){const E=s.GetAttributeByUniqueId(l,i.attributes[g]),D=e.json.accessors[a.attributes[g]],T=MS[D.componentType],A=D.count*O_[D.type]*sy[D.componentType].BYTES_PER_ELEMENT,z=Mc._malloc(A);s.GetAttributeDataArrayForAllPoints(l,E,Mc[T],A,z),Zb(Mc.memory.buffer.slice(z,z+A),D,e),Mc._free(z)}s.destroy(),l.destroy(),delete a.extensions[Fv]}const oy="EXT_meshopt_compression";function CS(a,e){if(!a.extensions||!a.extensions[oy])return;const i=a.extensions[oy],s=new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),h=new Uint8Array(i.count*i.byteStride);kv.decodeGltfBuffer(h,i.count,i.byteStride,s,i.mode,i.filter),a.buffer=e.buffers.length,a.byteOffset=0,e.buffers[a.buffer]=h.buffer,delete a.extensions[oy]}const Xb=1179937895,Yb=new TextDecoder("utf8");function Wb(a,e){return new URL(a,e).href}function DS(a,e,i,s){return fetch(Wb(a.uri,s)).then(h=>h.arrayBuffer()).then(h=>{e.buffers[i]=h})}function $b(a,e){const i=a.json.bufferViews[e];return new Uint8Array(a.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function IS(a,e,i,s){if(a.uri){const h=Wb(a.uri,s);return fetch(h).then(l=>l.blob()).then(l=>createImageBitmap(l)).then(l=>{e.images[i]=l})}if(a.bufferView!==void 0){const h=$b(e,a.bufferView),l=new Blob([h],{type:a.mimeType});return createImageBitmap(l).then(d=>{e.images[i]=d})}}function Qb(a,e=0,i){const s={json:null,images:[],buffers:[]};if(new Uint32Array(a,e,1)[0]===Xb){const g=new Uint32Array(a,e);let E=2;const D=(g[E++]>>2)-3,T=g[E++]>>2;if(E++,s.json=JSON.parse(Yb.decode(g.subarray(E,E+T))),E+=T,E<D){const A=g[E++];E++;const z=e+(E<<2);s.buffers[0]=a.slice(z,z+A)}}else s.json=JSON.parse(Yb.decode(new Uint8Array(a,e)));const{buffers:h,images:l,meshes:d,extensionsUsed:v,bufferViews:S}=s.json;let R=Promise.resolve();if(h){const g=[];for(let E=0;E<h.length;E++){const D=h[E];D.uri?g.push(DS(D,s,E,i)):s.buffers[E]||(s.buffers[E]=null)}R=Promise.all(g)}return R.then(()=>{const g=[],E=v&&v.includes(Fv),D=v&&v.includes(oy);if(E&&g.push(function(){if(!Mc)return z_??(z_=function(T){let A,z=null;function B(){A=new Uint8Array(z.buffer)}function N(){throw new Error("Unexpected Draco error.")}const Z={a:{a:N,d:function(X,q,Y){return A.copyWithin(X,q,q+Y)},c:function(X){const q=A.length,Y=Math.max(X>>>0,Math.ceil(1.2*q)),K=Math.ceil((Y-q)/65536);try{return z.grow(K),B(),!0}catch{return!1}},b:N}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(T,Z):T.then(X=>X.arrayBuffer()).then(X=>WebAssembly.instantiate(X,Z))).then(X=>{const{Rb:q,Qb:Y,P:K,T:re,X:he,Ja:ue,La:ce,Qa:Te,Va:de,Wa:Se,eb:Ce,jb:Me,f:Le,e:ke,yb:Ue,zb:Pe,Ab:at,Bb:mt,Db:nt,Gb:Bt}=X.instance.exports;z=ke;const Ot=(()=>{let bt=0,yt=0,ei=0,jt=0;return Wt=>{ei&&(q(jt),q(bt),yt+=ei,ei=bt=0),bt||(yt+=128,bt=Y(yt));const Ti=Wt.length+7&-8;let zi=bt;Ti>=yt&&(ei=Ti,zi=jt=Y(Ti));for(let Pi=0;Pi<Wt.length;Pi++)A[zi+Pi]=Wt[Pi];return zi}})();return B(),Le(),{memory:ke,_free:q,_malloc:Y,Mesh:class{constructor(){this.ptr=K()}destroy(){re(this.ptr)}},Decoder:class{constructor(){this.ptr=ue()}destroy(){Me(this.ptr)}DecodeArrayToMesh(bt,yt,ei){const jt=Ot(bt),Wt=ce(this.ptr,jt,yt,ei.ptr);return!!he(Wt)}GetAttributeByUniqueId(bt,yt){return{ptr:Te(this.ptr,bt.ptr,yt)}}GetTrianglesUInt16Array(bt,yt,ei){de(this.ptr,bt.ptr,yt,ei)}GetTrianglesUInt32Array(bt,yt,ei){Se(this.ptr,bt.ptr,yt,ei)}GetAttributeDataArrayForAllPoints(bt,yt,ei,jt,Wt){Ce(this.ptr,bt.ptr,yt.ptr,ei,jt,Wt)}},DT_INT8:Ue(),DT_UINT8:Pe(),DT_INT16:at(),DT_UINT16:mt(),DT_UINT32:nt(),DT_FLOAT32:Bt()}})}(fetch(Gb())),z_.then(T=>{Mc=T,z_=void 0}))}()),D&&g.push(function(){if(kv)return;const T=function(A){let z;const B=WebAssembly.instantiateStreaming(A,{}).then(X=>{z=X.instance,z.exports.__wasm_call_ctors()}),N={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Z={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:B,supported:!0,decodeGltfBuffer(X,q,Y,K,re,he){(function(ue,ce,Te,de,Se,Ce,Me){const Le=ue.exports.sbrk,ke=de+3&-4,Ue=Le(ke*Se),Pe=Le(Ce.length),at=new Uint8Array(ue.exports.memory.buffer);at.set(Ce,Pe);const mt=ce(Ue,de,Se,Pe,Ce.length);if(mt===0&&Me&&Me(Ue,ke,Se),Te.set(at.subarray(Ue,Ue+de*Se)),Le(Ue-Le(0)),mt!==0)throw new Error(`Malformed buffer data: ${mt}`)})(z,z.exports[Z[re]],X,q,Y,K,z.exports[N[he]])}}}(fetch(Hb()));return T.ready.then(()=>{kv=T})}()),l)for(let T=0;T<l.length;T++)g.push(IS(l[T],s,T,i));return(g.length?Promise.all(g):Promise.resolve()).then(()=>{if(E&&d)for(const{primitives:T}of d)for(const A of T)AS(A,s);if(D&&d&&S)for(const T of S)CS(T,s);return s})})}function $d(a,e){const i=a.json.bufferViews[e.bufferView],s=sy[e.componentType];return new s(a.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*(i.byteStride&&i.byteStride!==O_[e.type]*s.BYTES_PER_ELEMENT?i.byteStride/s.BYTES_PER_ELEMENT:O_[e.type]))}function Bv(a,e,i,s){const h=sy[e.componentType],l=function(g){switch(g){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(h),d=a.json.bufferViews[e.bufferView],v=d.byteStride?d.byteStride/h.BYTES_PER_ELEMENT:O_[e.type],S=i.float32,R=S.length/i.capacity;for(let g=0,E=0;g<e.count*v;g+=v,E+=R)for(let D=0;D<R;D++)S[E+D]=s[g+D]*l;i._trim()}function RS(a,e,i){const s=a.indices,h=a.attributes,l={};l.indexArray=new Ln;const d=e.json.accessors[s],v=d.count/3;l.indexArray.reserve(v);const S=$d(e,d);for(let D=0;D<v;D++)l.indexArray.emplaceBack(S[3*D],S[3*D+1],S[3*D+2]);l.indexArray._trim(),l.vertexArray=new po;const R=e.json.accessors[h.POSITION];l.vertexArray.reserve(R.count);const g=$d(e,R);for(let D=0;D<R.count;D++)l.vertexArray.emplaceBack(g[3*D],g[3*D+1],g[3*D+2]);if(l.vertexArray._trim(),l.aabb=new Ut(R.min,R.max),l.centroid=function(D,T){const A=[0,0,0],z=D.length;if(z>0){for(let B=0;B<z;B++){const N=3*D[B];A[0]+=T[N],A[1]+=T[N+1],A[2]+=T[N+2]}A[0]/=z,A[1]/=z,A[2]/=z}return A}(S,g),h.COLOR_0!==void 0){const D=e.json.accessors[h.COLOR_0],T=O_[D.type],A=$d(e,D);l.colorArray=T===3?new po:new Cl,l.colorArray.resize(D.count),Bv(e,D,l.colorArray,A)}if(h.NORMAL!==void 0){l.normalArray=new po;const D=e.json.accessors[h.NORMAL];l.normalArray.resize(D.count);const T=$d(e,D);Bv(e,D,l.normalArray,T)}if(h.TEXCOORD_0!==void 0&&i.length>0){l.texcoordArray=new fc;const D=e.json.accessors[h.TEXCOORD_0];l.texcoordArray.resize(D.count);const T=$d(e,D);Bv(e,D,l.texcoordArray,T)}if(h._FEATURE_ID_RGBA4444!==void 0){const D=e.json.accessors[h._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(l.featureData=$d(e,D))}h._FEATURE_RGBA4444!==void 0&&(l.featureData=new Uint32Array($d(e,e.json.accessors[h._FEATURE_RGBA4444]).buffer));const E=a.material;return l.material=function(D,T){const{emissiveFactor:A=[0,0,0],alphaMode:z="OPAQUE",alphaCutoff:B=.5,normalTexture:N,occlusionTexture:Z,emissiveTexture:X,doubleSided:q}=D,{baseColorFactor:Y=[1,1,1,1],metallicFactor:K=1,roughnessFactor:re=1,baseColorTexture:he,metallicRoughnessTexture:ue}=D.pbrMetallicRoughness||{},ce=Z?T[Z.index]:void 0;if(Z&&Z.extensions&&Z.extensions.KHR_texture_transform&&ce){const Te=Z.extensions.KHR_texture_transform;ce.offsetScale=[Te.offset[0],Te.offset[1],Te.scale[0],Te.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new nr(...Y),metallicFactor:K,roughnessFactor:re,baseColorTexture:he?T[he.index]:void 0,metallicRoughnessTexture:ue?T[ue.index]:void 0},doubleSided:q,emissiveFactor:A,alphaMode:z,alphaCutoff:B,normalTexture:N?T[N.index]:void 0,occlusionTexture:ce,emissionTexture:X?T[X.index]:void 0,defined:D.defined===void 0}}(E!==void 0?e.json.materials[E]:{defined:!1},i),l}function Kb(a,e,i){const{matrix:s,rotation:h,translation:l,scale:d,mesh:v,extras:S,children:R}=a,g={};if(g.matrix=s||Ae.mat4.fromRotationTranslationScale([],h||[0,0,0,1],l||[0,0,0],d||[1,1,1]),v!==void 0){g.meshes=i[v];const E=g.anchor=[0,0];for(const D of g.meshes){const{min:T,max:A}=D.aabb;E[0]+=T[0]+A[0],E[1]+=T[1]+A[1]}E[0]=Math.floor(E[0]/g.meshes.length/2),E[1]=Math.floor(E[1]/g.meshes.length/2)}if(S&&(S.id&&(g.id=S.id),S.lights&&(g.lights=function(E){if(!E.length)return[];const D=function(N){const Z=atob(N),X=new Uint8Array(Z.length);for(let q=0;q<Z.length;q++)X[q]=Z.codePointAt(q);return X}(E),T=[],A=D.length/24,z=new Uint16Array(D.buffer),B=new Float32Array(D.buffer);for(let N=0;N<A;N++){const Z=z[2*N*6]/30,X=z[2*N*6+1]/30,q=z[2*N*6+10]/100,Y=B[6*N+1],K=B[6*N+2],re=B[6*N+3],he=B[6*N+4],ue=re-Y,ce=he-K,Te=Math.hypot(ue,ce);T.push({pos:[Y+.5*ue,K+.5*ce,X],normal:[ce/Te,-ue/Te,0],width:Te,height:Z,depth:q,points:[Y,K,re,he]})}return T}(S.lights))),R){const E=[];for(const D of R)E.push(Kb(e.json.nodes[D],e,i));g.children=E}return g}function zS(a){if(a.vertices.length===0||a.indices.length===0)return null;const e=new Gm(a.vertices,a.indices,8,256),[i,s]=[e.min.clone(),e.max.clone()];return{vertices:a.vertices,indices:a.indices,grid:e,min:i,max:s}}function OS(a){if(!a.extras||!a.extras.ground)return null;const e=a.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const i=e[0];if(!i||!Array.isArray(i)||i.length===0)return null;const s=[];for(const d of i){if(!Array.isArray(d)||d.length!==2)continue;const v=d[0],S=d[1];typeof v=="number"&&typeof S=="number"&&s.push(new Rt(v,S))}if(s.length<3)return null;s.length>1&&s[s.length-1].equals(s[0])&&s.pop();let h=0;for(let d=0;d<s.length;d++){const v=s[d],S=s[(d+1)%s.length],R=s[(d+2)%s.length];h+=(v.x-S.x)*(R.y-S.y)-(R.x-S.x)*(v.y-S.y)}h>0&&s.reverse();const l=Dd(s.flatMap(d=>[d.x,d.y]),[]);return l.length===0?null:{vertices:s,indices:l}}function LS(a,e){const i=[],s=[];let h=0;const l=[];for(const d of a){h=i.length;const v=d.vertexArray.float32,S=d.indexArray.uint16;for(let R=0;R<d.vertexArray.length;R++)l[0]=v[3*R+0],l[1]=v[3*R+1],l[2]=v[3*R+2],Ae.vec3.transformMat4(l,l,e),i.push(new Rt(l[0],l[1]));for(let R=0;R<3*d.indexArray.length;R++)s.push(S[R]+h)}if(s.length%3!=0)return null;for(let d=0;d<s.length;d+=3){const v=i[s[d+0]],S=i[s[d+1]],R=i[s[d+2]];(v.x-S.x)*(R.y-S.y)-(R.x-S.x)*(v.y-S.y)>0&&([s[d+1],s[d+2]]=[s[d+2],s[d+1]])}return{vertices:i,indices:s}}function Jb(a){const e=function(S,R){const g=[],E=WebGL2RenderingContext;if(S.json.textures)for(const D of S.json.textures){const T={magFilter:E.LINEAR,minFilter:E.NEAREST,wrapS:E.REPEAT,wrapT:E.REPEAT};D.sampler!==void 0&&Object.assign(T,S.json.samplers[D.sampler]),g.push({image:R[D.source],sampler:T,uploaded:!1})}return g}(a,a.images),i=function(S,R){const g=[];for(const E of S.json.meshes){const D=[];for(const T of E.primitives)D.push(RS(T,S,R));g.push(D)}return g}(a,e),{scenes:s,scene:h,nodes:l}=a.json,d=s?s[h||0].nodes:l,v=[];for(const S of d)v.push(Kb(l[S],a,i));return function(S,R,g){const E={},D=new Set;for(let T=0;T<S.length;T++){const A=g[R[T]];if(!A.extras)continue;const z=A.extras["mapbox:footprint:version"],B=A.extras["mapbox:footprint:id"];(z||B)&&D.add(T),z==="1.0.0"&&B&&(E[B]=T)}for(let T=0;T<S.length;T++){if(D.has(T))continue;const A=S[T],z=g[R[T]];if(!z.extras)continue;let B=null;A.id in E&&(B=LS(S[E[A.id]].meshes,A.matrix)),B||(B=OS(z)),B&&(A.footprint=zS(B))}if(D.size>0){const T=Array.from(D.values()).sort((A,z)=>A-z);for(let A=T.length-1;A>=0;A--)S.splice(T[A],1)}}(v,d,a.json.nodes),v}function PS(a){a.heightmap=new Float32Array(4096),a.heightmap.fill(-1);const e=a.vertexArray.float32,i=a.aabb.min[0]-1,s=a.aabb.min[1]-1,h=Xd/(a.aabb.max[0]-i+2),l=Xd/(a.aabb.max[1]-s+2);for(let d=0;d<e.length;d+=3){const v=e[d+2],S=(e[d+0]-i)*h|0,R=(e[d+1]-s)*l|0;v>a.heightmap[R*Xd+S]&&(a.heightmap[R*Xd+S]=v)}}function kS(a,e){const i={};i.indexArray=new Ln,i.indexArray.reserve(4*a.length),i.vertexArray=new po,i.vertexArray.reserve(10*a.length),i.colorArray=new Cl,i.vertexArray.reserve(10*a.length);let s=0;for(const d of a){const v=Math.min(10,Math.max(4,1.3*d.height))*e,S=[-d.normal[1],d.normal[0],0],R=Math.min(.29,.1*d.width/d.depth),g=d.width-2*d.depth*e*(R+.01),E=Ae.vec3.scaleAndAdd([],d.pos,S,g/2),D=Ae.vec3.scaleAndAdd([],d.pos,S,-g/2),T=[E[0],E[1],E[2]+d.height],A=[D[0],D[1],D[2]+d.height],z=Ae.vec3.scaleAndAdd([],d.normal,S,R);Ae.vec3.scale(z,z,v);const B=Ae.vec3.scaleAndAdd([],d.normal,S,-R);Ae.vec3.scale(B,B,v),Ae.vec3.add(z,E,z),Ae.vec3.add(B,D,B),E[2]+=.1,D[2]+=.1,i.vertexArray.emplaceBack(z[0],z[1],z[2]),i.vertexArray.emplaceBack(B[0],B[1],B[2]),i.vertexArray.emplaceBack(E[0],E[1],E[2]),i.vertexArray.emplaceBack(D[0],D[1],D[2]),i.vertexArray.emplaceBack(T[0],T[1],T[2]),i.vertexArray.emplaceBack(A[0],A[1],A[2]),i.vertexArray.emplaceBack(E[0],E[1],E[2]),i.vertexArray.emplaceBack(D[0],D[1],D[2]),i.vertexArray.emplaceBack(z[0],z[1],z[2]),i.vertexArray.emplaceBack(B[0],B[1],B[2]);const N=g/v/2;i.colorArray.emplaceBack(-N-R,-1,N,.8),i.colorArray.emplaceBack(N+R,-1,N,.8),i.colorArray.emplaceBack(-N,0,N,1.3),i.colorArray.emplaceBack(N,0,N,1.3),i.colorArray.emplaceBack(N+R,-.8,N,.7),i.colorArray.emplaceBack(N+R,-.8,N,.7),i.colorArray.emplaceBack(0,0,N,1.3),i.colorArray.emplaceBack(0,0,N,1.3),i.colorArray.emplaceBack(N+R,-1.2,N,.8),i.colorArray.emplaceBack(N+R,-1.2,N,.8),i.indexArray.emplaceBack(6+s,4+s,8+s),i.indexArray.emplaceBack(7+s,9+s,5+s),i.indexArray.emplaceBack(0+s,1+s,2+s),i.indexArray.emplaceBack(1+s,3+s,2+s),s+=10}const h={defined:!0,emissiveFactor:[0,0,0]},l={};return l.baseColorFactor=nr.white,h.pbrMetallicRoughness=l,i.material=h,i.aabb=new Ut([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}class e1{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const s=e[i];this._stringToNumber[s]=i,this._numberToString[i]=s}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const FS=["id","tile","layer","source","sourceLayer","state"];class pm{constructor(e,i,s,h,l){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=s,this._y=h,this.properties=e.properties,this.id=l}clone(){const e=new pm(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const i of FS)this[i]!==void 0&&(e[i]=this[i]);return e}}class t1{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new lc(zt,16,0),this.featureIndexArray=new du,this.promoteId=i,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,i,s,h,l,d=0,v=0){const S=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,h,l,d);const R=this.grid;for(let g=0;g<i.length;g++){const E=i[g],D=[1/0,1/0,-1/0,-1/0];for(let T=0;T<E.length;T++){const A=E[T];D[0]=Math.min(D[0],A.x),D[1]=Math.min(D[1],A.y),D[2]=Math.max(D[2],A.x),D[3]=Math.max(D[3],A.y)}v!==0&&(D[0]-=v,D[1]-=v,D[2]+=v,D[3]+=v),D[0]<zt&&D[1]<zt&&D[2]>=0&&D[3]>=0&&R.insert(S,D[0],D[1],D[2],D[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Ah.VectorTile(new f(this.rawTileData)).layers,this.sourceLayerCoder=new e1(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i){const{tilespaceGeometry:s,transform:h,tileTransform:l,pixelPosMatrix:d,availableImages:v}=i;this.loadVTLayers(),this.serializedLayersCache.clear();const S=s.bufferedTilespaceBounds,R=this.grid.query(S.min.x,S.min.y,S.max.x,S.max.y,(T,A,z,B)=>Ee(s.bufferedTilespaceGeometry,T,A,z,B));R.sort(BS);let g=null;h.elevation&&R.length>0&&(g=om.create(h.elevation,this.tileID));const E={};let D;for(let T=0;T<R.length;T++){const A=R[T];if(A===D)continue;D=A;const z=this.featureIndexArray.get(A);let B=null;this.is3DTile?this.loadMatchingModelFeature(E,z,e,s,h):this.loadMatchingFeature(E,z,e,v,(N,Z,X,q=0)=>(B||(B=F(N,this.tileID.canonical,l)),Z.queryIntersectsFeature(s,N,X,B,this.z,h,d,g,q)))}return E}loadMatchingFeature(e,i,s,h,l){const{featureIndex:d,bucketIndex:v,sourceLayerIndex:S,layoutVertexArrayOffset:R}=i,g=this.bucketLayerIDs[v],E=s.layers,D=Object.keys(E);if(D.length&&!function(N,Z){for(let X=0;X<N.length;X++)if(Z.indexOf(N[X])>=0)return!0;return!1}(D,g))return;const T=s.sourceCache,A=this.sourceLayerCoder.decode(S),z=this.vtLayers[A].feature(d),B=this.getId(z,A);for(let N=0;N<g.length;N++){const Z=g[N];if(!E[Z])continue;const{styleLayer:X,targets:q}=E[Z];let Y={};B!==void 0&&(Y=T.getFeatureState(X.sourceLayer,B));const K=!l||l(z,X,Y,R);if(!K)continue;const re=new pm(z,this.z,this.x,this.y,B);re.tile=this.tileID.canonical,re.state=Y;let he=this.serializedLayersCache.get(Z);he||(he=X.serialize(),he.id=Z,this.serializedLayersCache.set(Z,he)),re.source=he.source,re.sourceLayer=he["source-layer"],re.layer=Fn({},he),re.layer.paint=i1(he.paint,X.paint,z,Y,h),re.layer.layout=i1(he.layout,X.layout,z,Y,h);let ue=!1;for(const ce of q){this.updateFeatureProperties(re,ce);const{filter:Te}=ce;if(Te){if(z.properties=re.properties,Te.needGeometry){const de=V(z,!0);if(!Te.filter(new wr(this.tileID.overscaledZ),de,this.tileID.canonical))continue}else if(!Te.filter(new wr(this.tileID.overscaledZ),z))continue}ue=!0,ce.targetId&&this.addFeatureVariant(re,ce)}ue&&this.appendToResult(e,Z,d,re,K)}}loadMatchingModelFeature(e,i,s,h,l){const d=this.bucketLayerIDs[0][0],v=s.layers;if(!v[d])return;const{styleLayer:S,targets:R}=v[d];if(S.type!=="model")return;const g=h.tile,E=i.featureIndex,D=g.getBucket(S);if(!(D&&D instanceof Kg))return;const T=function(he,ue,ce,Te){const de=he.getNodesInfo()[ue];if(de.hiddenByReplacement||!de.node.meshes)return;let Se=Number.MAX_VALUE;const Ce=de.node,Me=ce.tile,Le=Te.calculatePosMatrix(Me.tileID.toUnwrapped(),Te.worldSize),ke=de.evaluatedScale;let Ue=0;Te.elevation&&Ce.elevation&&(Ue=Ce.elevation*Te.elevation.exaggeration()),Ae.mat4.translate(Le,Le,[(Ce.anchor?Ce.anchor[0]:0)*(ke[0]-1),(Ce.anchor?Ce.anchor[1]:0)*(ke[1]-1),Ue]),Ae.mat4.scale(Le,Le,ke);const Pe=ce.queryGeometry,at=Pe.isPointQuery()?Pe.screenBounds:Pe.screenGeometry,mt=function(Bt){const Ot=Ae.mat4.multiply([],Le,Bt.matrix);Ae.mat4.multiply(Ot,Te.expandedFarZProjMatrix,Ot);for(let bt=0;bt<Bt.meshes.length;++bt){const yt=Bt.meshes[bt];if(bt===Bt.lightMeshIndex)continue;const ei=eb(at,Te,Ot,yt.aabb);ei!=null&&(Se=Math.min(ei,Se))}if(Bt.children)for(const bt of Bt.children)mt(bt)};if(mt(Ce),Se===Number.MAX_VALUE)return;const nt=new ir(0,0);return fb(Me.tileID.canonical,nt,de.node.anchor[0],de.node.anchor[1]),{intersectionZ:Se,position:nt,feature:de.feature}}(D,E,h,l);if(!T)return;const{z:A,x:z,y:B}=g.tileID.canonical,{feature:N,intersectionZ:Z,position:X}=T;let q={};N.id!==void 0&&(q=s.sourceCache.getFeatureState(S.sourceLayer,N.id));const Y=new pm({},A,z,B,N.id);Y.tile=this.tileID.canonical,Y.state=q,Y.properties=N.properties,Y.geometry={type:"Point",coordinates:[X.lng,X.lat]};let K=this.serializedLayersCache.get(d);K||(K=S.serialize(),K.id=d,this.serializedLayersCache.set(d,K)),Y.source=K.source,Y.sourceLayer=K["source-layer"],Y.layer=Fn({},K);let re=!1;for(const he of R){this.updateFeatureProperties(Y,he);const{filter:ue}=he;if(ue){if(N.properties=Y.properties,ue.needGeometry){if(!ue.filter(new wr(this.tileID.overscaledZ),N,this.tileID.canonical))continue}else if(!ue.filter(new wr(this.tileID.overscaledZ),N))continue}re=!0,he.targetId&&this.addFeatureVariant(Y,he)}re&&this.appendToResult(e,d,E,Y,Z)}updateFeatureProperties(e,i,s){if(i.properties){const h={};for(const l in i.properties){const d=i.properties[l].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,s);d!=null&&(h[l]=d)}e.properties=h}}addFeatureVariant(e,i,s){const h={target:i.target,namespace:i.namespace,uniqueFeatureID:i.uniqueFeatureID};i.properties&&(h.properties=e.properties),e.variants=e.variants||{},e.variants[i.targetId]=e.variants[i.targetId]||[],e.variants[i.targetId].push(h)}appendToResult(e,i,s,h,l){let d=e[i];d===void 0&&(d=e[i]=[]),d.push({featureIndex:s,feature:h,intersectionZ:l})}lookupSymbolFeatures(e,i,s,h,l){const d={};this.loadVTLayers();for(const v of e)this.loadMatchingFeature(d,{bucketIndex:i,sourceLayerIndex:s,featureIndex:v,layoutVertexArrayOffset:0},h,l);return d}loadFeature(e){const{featureIndex:i,sourceLayerIndex:s}=e;this.loadVTLayers();const h=this.sourceLayerCoder.decode(s),l=this.vtFeatures[h];if(l[i])return l[i];const d=this.vtLayers[h].feature(i);return l[i]=d,d}hasLayer(e){for(const i of this.bucketLayerIDs)for(const s of i)if(e===s)return!0;return!1}getId(e,i){let s=e.id;if(this.promoteId){const h=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[i];if(h!=null)if(Array.isArray(h)){if(!this.promoteIdExpression){const l=fn(h);if(l.result!=="success"){const d=l.value.map(v=>`${v.key}: ${v.message}`).join(", ");return void Ri(`Failed to create expression for promoteId: ${d}`)}this.promoteIdExpression=l.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new id),s=this.promoteIdExpression.evaluate({zoom:0},e)}else s=e.properties[h];typeof s=="boolean"&&(s=Number(s))}return s}}function i1(a,e,i,s,h){return Kn(a,(l,d)=>{const v=e instanceof cc?e.get(d):null;return v&&v.evaluate?v.evaluate(i,s,h):v})}function BS(a,e){return e-a}Zt(t1,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const r1=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Nv{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,s]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=s>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const l=r1[15&s];if(!l)throw new Error("Unrecognized array type.");const[d]=new Uint16Array(e,2,1),[v]=new Uint32Array(e,4,1);return new Nv(v,d,l,e)}constructor(e,i=64,s=Float64Array,h){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=s,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const l=r1.indexOf(this.ArrayType),d=2*e*this.ArrayType.BYTES_PER_ELEMENT,v=e*this.IndexArrayType.BYTES_PER_ELEMENT,S=(8-v%8)%8;if(l<0)throw new Error(`Unexpected typed array class: ${s}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+v+S,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+d+v+S),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+v+S,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+l]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const s=this._pos>>1;return this.ids[s]=s,this.coords[this._pos++]=e,this.coords[this._pos++]=i,s}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Vv(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,s,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:l,coords:d,nodeSize:v}=this,S=[0,l.length-1,0],R=[];for(;S.length;){const g=S.pop()||0,E=S.pop()||0,D=S.pop()||0;if(E-D<=v){for(let B=D;B<=E;B++){const N=d[2*B],Z=d[2*B+1];N>=e&&N<=s&&Z>=i&&Z<=h&&R.push(l[B])}continue}const T=D+E>>1,A=d[2*T],z=d[2*T+1];A>=e&&A<=s&&z>=i&&z<=h&&R.push(l[T]),(g===0?e<=A:i<=z)&&(S.push(D),S.push(T-1),S.push(1-g)),(g===0?s>=A:h>=z)&&(S.push(T+1),S.push(E),S.push(1-g))}return R}within(e,i,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:l,nodeSize:d}=this,v=[0,h.length-1,0],S=[],R=s*s;for(;v.length;){const g=v.pop()||0,E=v.pop()||0,D=v.pop()||0;if(E-D<=d){for(let B=D;B<=E;B++)a1(l[2*B],l[2*B+1],e,i)<=R&&S.push(h[B]);continue}const T=D+E>>1,A=l[2*T],z=l[2*T+1];a1(A,z,e,i)<=R&&S.push(h[T]),(g===0?e-s<=A:i-s<=z)&&(v.push(D),v.push(T-1),v.push(1-g)),(g===0?e+s>=A:i+s>=z)&&(v.push(T+1),v.push(E),v.push(1-g))}return S}}function Vv(a,e,i,s,h,l){if(h-s<=i)return;const d=s+h>>1;n1(a,e,d,s,h,l),Vv(a,e,i,s,d-1,1-l),Vv(a,e,i,d+1,h,1-l)}function n1(a,e,i,s,h,l){for(;h>s;){if(h-s>600){const R=h-s+1,g=i-s+1,E=Math.log(R),D=.5*Math.exp(2*E/3),T=.5*Math.sqrt(E*D*(R-D)/R)*(g-R/2<0?-1:1);n1(a,e,i,Math.max(s,Math.floor(i-g*D/R+T)),Math.min(h,Math.floor(i+(R-g)*D/R+T)),l)}const d=e[2*i+l];let v=s,S=h;for(L_(a,e,s,i),e[2*h+l]>d&&L_(a,e,s,h);v<S;){for(L_(a,e,v,S),v++,S--;e[2*v+l]<d;)v++;for(;e[2*S+l]>d;)S--}e[2*s+l]===d?L_(a,e,s,S):(S++,L_(a,e,S,h)),S<=i&&(s=S+1),i<=S&&(h=S-1)}}function L_(a,e,i,s){Uv(a,i,s),Uv(e,2*i,2*s),Uv(e,2*i+1,2*s+1)}function Uv(a,e,i){const s=a[e];a[e]=a[i],a[i]=s}function a1(a,e,i,s){const h=a-i,l=e-s;return h*h+l*l}n.$=md,n.A=ea,n.B=2,n.C=__,n.D=lm,n.E=Co,n.F=gx,n.G=class extends $g{},n.H=Vs,n.I=Iv,n.J=Fu,n.K=uf,n.L=ga,n.M=Qc,n.N=Kc,n.O=Jc,n.P=Rt,n.Q=sh,n.R=sr,n.S=tu,n.T=_v,n.U=fn,n.V=$g,n.W=Hc,n.X=ia,n.Y=Ql,n.Z=Aa,n._=ms,n.a=function(a){return Jr.API_CDN_URL_REGEX.test(a)},n.a$=pm,n.a0=ws,n.a1=sf,n.a2=function(a){const e=a.value;let i=[];if(!e)return i;const s=Vs(e);return s!=="string"?(i=i.concat([new $g(a.key,e,`string expected, "${s}" found`)]),i):(ib(e,!0)||(i=i.concat([new $g(a.key,e,`invalid url "${e}"`)])),i)},n.a3=Ge,n.a4=su,n.a5=jr,n.a6=wt,n.a7=class{constructor(a){this.specification=a}possiblyEvaluate(a,e){return ha(a.expression.evaluate(e))}interpolate(a,e,i){return{x:di(a.x,e.x,i),y:di(a.y,e.y,i),z:di(a.z,e.z,i),azimuthal:di(a.azimuthal,e.azimuthal,i),polar:di(a.polar,e.polar,i)}}},n.a8=wr,n.a9=Bo,n.aA=Is,n.aB=class{constructor(a){this.entries={},this.scheduler=a}request(a,e,i,s){const h=this.entries[a]=this.entries[a]||{callbacks:[]};if(h.result){const[l,d]=h.result;return this.scheduler?this.scheduler.add(()=>{s(l,d)},e):s(l,d),()=>{}}return h.callbacks.push(s),h.cancel||(h.cancel=i((l,d)=>{h.result=[l,d];for(const v of h.callbacks)this.scheduler?this.scheduler.add(()=>{v(l,d)},e):v(l,d);setTimeout(()=>delete this.entries[a],3e3)})),()=>{h.result||(h.callbacks=h.callbacks.filter(l=>l!==s),h.callbacks.length||(h.cancel(),delete this.entries[a]))}}},n.aC=es,n.aD=function(a,e,i){const s=JSON.stringify(a.request);return a.data&&(this.deduped.entries[s]={result:[null,a.data]}),this.deduped.request(s,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom},h=>{const l=Gr(a.request,(d,v,S,R)=>{d?h(d):v&&h(null,{vectorTile:i?void 0:new Ah.VectorTile(new f(v)),rawData:v,cacheControl:S,expires:R})});return()=>{l.cancel(),h()}},e)},n.aE=function(a){Jt++,Jt>Ze&&(a.getActor().send("enforceCacheSizeLimit",Oe),Jt=0)},n.aF=function(a){return a<=1?1:Math.pow(2,Math.floor(Math.log(a)/Math.LN2))},n.aG=vt,n.aH=qx,n.aI=Wx,n.aJ=jx,n.aK=function(a,e){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let s=0;s<a.length;s++){const h=document.createElement("source");$r(a[s])||(i.crossOrigin="Anonymous"),h.src=a[s],i.appendChild(h)}return{cancel:()=>{}}},n.aL=Hg,n.aM=function(a){return fetch(a).then(e=>e.arrayBuffer()).then(e=>Qb(e,0,a))},n.aN=Jb,n.aO=class{constructor(a,e,i,s){this.id=a,this.position=e!=null?new ir(e[0],e[1]):new ir(0,0),this.orientation=i??[0,0,0],this.nodes=s,this.uploaded=!1,this.aabb=new Ut([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(a,e){if(Ae.mat4.multiply(a.matrix,e,a.matrix),a.meshes)for(const i of a.meshes){const s=Ut.applyTransformFast(i.aabb,a.matrix);this.aabb.encapsulate(s)}if(a.children)for(const i of a.children)this._applyTransformations(i,a.matrix)}computeBoundsAndApplyParent(){const a=Ae.mat4.identity([]);for(const e of this.nodes)this._applyTransformations(e,a)}computeModelMatrix(a,e,i,s,h,l,d=!1){ob(this.matrix,this,a.transform,this.position,e,i,s,h,l,d)}upload(a){if(!this.uploaded){for(const e of this.nodes)bv(e,a);for(const e of this.nodes)Qg(e);this.uploaded=!0}}destroy(){for(const a of this.nodes)wv(a)}},n.aP=Oc,n.aQ=y_,n.aR=va,n.aS=gn,n.aT=Gs,n.aU=Ln,n.aV=el,n.aW=yf,n.aX=qg,n.aY=function(){Pr.isLoading()||Pr.isLoaded()||au()!=="deferred"||na()},n.aZ=_d,n.a_=V,n.aa=r,n.ab=Ae,n.ac=ro,n.ad=cc,n.ae=oa,n.af=di,n.ag=zt,n.ah=Xl,n.ai=Yi,n.aj=nr,n.ak=class{constructor(a){this.specification=a}possiblyEvaluate(a,e){return function([i,s]){const h=ha([1,i,s]);return{x:h.x,y:h.y,z:h.z}}(a.expression.evaluate(e))}interpolate(a,e,i){return{x:di(a.x,e.x,i),y:di(a.y,e.y,i),z:di(a.z,e.z,i)}}},n.al=function(a,e,i=0,s=!0){const h=new Rt(i,i),l=a.sub(h),d=e.add(h),v=[l,new Rt(d.x,l.y),d,new Rt(l.x,d.y)];return s&&v.push(l.clone()),v},n.am=function(a,e){const i=[];for(let s=0;s<a.length;s++){const h=us(s-1,-1,a.length-1),l=us(s+1,-1,a.length-1),d=a[s],v=a[l],S=a[h].sub(d).unit(),R=v.sub(d).unit(),g=R.angleWithSep(S.x,S.y),E=S.add(R).unit().mult(-1*e/Math.sin(g/2));i.push(d.add(E))}return i},n.an=Cx,n.ao=Ee,n.ap=function(a,e,i=0){return Ae.vec3.fromValues(((e.x-i)*a.scale-a.x)*zt,(e.y*a.scale-a.y)*zt,vo(e.z,e.y))},n.aq=xi,n.ar=s_,n.as=function(a){let e=1/0,i=1/0,s=-1/0,h=-1/0;for(const l of a)e=Math.min(e,l.x),i=Math.min(i,l.y),s=Math.max(s,l.x),h=Math.max(h,l.y);return{min:new Rt(e,i),max:new Rt(s,h)}},n.at=$s,n.au=_e,n.av=p,n.aw=Mi,n.ax=aa,n.ay=function(a,e){const i={};for(let s=0;s<e.length;s++){const h=e[s];h in a&&(i[h]=a[h])}return i},n.az=Xo,n.b=function(a){return Jr.API_FONTS_REGEX.test(a)},n.b$=Yg,n.b0=fs,n.b1=zh,n.b2=Fp,n.b3=F,n.b4=fo,n.b5=Go,n.b6=ri,n.b7=Xr,n.b8=Dd,n.b9=dv,n.bA=vg,n.bB=ov,n.bC=Sx,n.bD=rt,n.bE=Nv,n.bF=us,n.bG=ao,n.bH=sa,n.bI=function(a,e,i){a[4*e+0]=i[0],a[4*e+1]=i[1],a[4*e+2]=i[2],a[4*e+3]=i[3]},n.bJ=yh,n.bK=ts,n.bL=zl,n.bM=Qr,n.bN=_c,n.bO=ir,n.bP=Ox,n.bQ=ct,n.bR=rr,n.bS=Qx,n.bT=dt,n.bU=sn,n.bV=function(a,e,i,s,h,l,d,v,S){if(S.name==="globe")return sn(a,e,new dt(i,s,h),!1);const R=y_({z:i,x:s,y:h},S);return new Ut([(l+R.x/R.scale)*e,e*(R.y/R.scale),d],[(l+R.x2/R.scale)*e,e*(R.y2/R.scale),v])},n.bW=function(a,e,i){let s=0;for(let h=0;h<2;++h)a[h]>0&&(s+=(a[h]-0)*(a[h]-0)),e[h]<0&&(s+=(0-e[h])*(0-e[h]));return s},n.bX=Tr,n.bY=Zo,n.bZ=function(a){const e=Ae.mat4.identity(new Float64Array(16));Ae.mat4.multiply(e,a.pixelMatrix,a.globeMatrix);const i=[0,da,0],s=[0,pa,0];return Ae.vec3.transformMat4(i,i,e),Ae.vec3.transformMat4(s,s,e),[i[0]>0&&i[0]<=a.width&&i[1]>0&&i[1]<=a.height&&!$n(a,new ir(a.center.lat,90)),s[0]>0&&s[0]<=a.width&&s[1]>0&&s[1]<=a.height&&!$n(a,new ir(a.center.lat,-90))]},n.b_=function(a,e){const{scale:i}=a.tileTransform,s=i*zt/(a.tileSize*Math.pow(2,e.zoom-a.tileID.overscaledZ+a.tileID.canonical.z));return Ae.mat2.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[s,s])},n.ba=function(a,e){const i=oa(e.zoom);if(i===0)return Fr(a);const s=Ji(a),h=fr(s),l=$s(s.getWest())*e.worldSize,d=$s(s.getEast())*e.worldSize,v=Is(s.getNorth())*e.worldSize,S=Is(s.getSouth())*e.worldSize,R=[l,v,0],g=[d,v,0],E=[l,S,0],D=[d,S,0],T=Ae.mat4.invert([],e.globeMatrix);return Ae.vec3.transformMat4(R,R,T),Ae.vec3.transformMat4(g,g,T),Ae.vec3.transformMat4(E,E,T),Ae.vec3.transformMat4(D,D,T),h[0]=Wr(h[0],E,i),h[1]=Wr(h[1],D,i),h[2]=Wr(h[2],g,i),h[3]=Wr(h[3],R,i),Ut.fromPoints(h)},n.bb=en,n.bc=hr,n.bd=Wr,n.be=hc,n.bf=oi,n.bg=Lv,n.bh=f,n.bi=Gr,n.bj=function(a){const e=[];for(const i in a)e.push(a[i]);return e},n.bk=function(a,e){const i=[];for(const s in a)s in e||i.push(s);return i},n.bl=wo,n.bm=["type","source","source-layer","minzoom","maxzoom","filter","layout"],n.bn=kn,n.bo=function(a,e){const{x:i,y:s}=a.point,h=xa(i,s,a.worldSize/a._pixelsPerMercatorPixel,0,0);return Ae.mat4.multiply(h,h,mr(Fr(e)))},n.bp=Lh,n.bq=xe,n.br=Oh,n.bs=function(a,e,i,s,h){const l=5*e+2;a.float32[l+0]=i,a.float32[l+1]=s,a.float32[l+2]=h},n.bt=jg,n.bu=_x,n.bv=$,n.bw=la,n.bx=qp,n.by=tb,n.bz=Wm,n.c=Lu,n.c$=(a,e,i,s,h,l,d,v)=>{const S=a.transform,R=S.pitch<15?o_(.07,.7,Mi((14-S.zoom)/5,0,1)):.07,g=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:l_(a,e,i,s),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:S.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:h,u_width_scale:l,u_floor_width_scale:d,u_image:0,u_tile_units_to_pixels:$p(e,S),u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:v,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toRenderColor(g?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:R,u_tile_to_meter:t(e.tileID.canonical,0)}},n.c0=$x,n.c1=function(a){const e=$x(a,!0);return Ae.mat2.invert([],[e[0],e[1],e[4],e[5]])},n.c2=bi,n.c3=function(a){const{x:e,y:i}=a.point,{lng:s,lat:h}=a._center;return xa(e,i,a.worldSize,s,h)},n.c4=Tn,n.c5=Ct,n.c6=rs,n.c7=function(a){const e=Math.round((a+45+360)%360/90)%4;return ka[e]},n.c8=45,n.c9=vh,n.cA=class extends Cs{constructor(a){super(a),this.current=wf}set(a,e,i){if(this.fetchUniformLocation(a,e)){for(let s=0;s<9;s++)if(i[s]!==this.current[s]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},n.cB=io,n.cC=function(a,e,i){const s=oa(i.zoom),h=a.style.map._antialias,l=a.terrain&&a.terrain.exaggeration()>0;return s===0&&!h&&!l},n.cD=function(a){const e=a.pixelsPerMeter,i=e/sa(1,a.center.lat),s=Ae.mat4.identity(new Float64Array(16));return Ae.mat4.translate(s,s,[a.point.x,a.point.y,0]),Ae.mat4.scale(s,s,[i,i,e]),Float32Array.from(s)},n.cE=Ji,n.cF=function(a){const e=Tr-5;a=Mi(a,-80.051129,e)/e*90;const i=Math.pow(Math.abs(Math.sin(Yi(a))),3);return Math.round(i*(gu.length-1))},n.cG=function(a,e,i,s){const h=e.getNorth(),l=e.getSouth(),d=e.getWest(),v=e.getEast(),S=1<<a.z,R=v-d,g=h-l,E=R/Ol,D=-g/gu[i],T=[0,E,0,D,0,0,h,d,0];if(a.z>0){const A=180/s;Ae.mat3.multiply(T,T,[A/R+1,0,0,0,A/g+1,0,-.5*A/E,.5*A/D,1])}return T[2]=S,T[5]=a.x,T[8]=a.y,T},n.cH=Fr,n.cI=function(a,e,i){const s=Ae.mat4.identity(new Float64Array(16)),h=(e/(1<<a)-.5)*Math.PI*2;return Ae.mat4.rotateY(s,i.globeMatrix,h),Float32Array.from(s)},n.cJ=class{isDataAvailableAtPoint(a){const e=this._source();if(this.isUsingMockSource()||!e||a.y<0||a.y>1)return!1;const i=e.getSource().maxzoom,s=1<<i,h=Math.floor(a.x),l=Math.floor((a.x-h)*s),d=Math.floor(a.y*s),v=this.findDEMTileFor(new vt(i,h,i,l,d));return!(!v||!v.dem)}getAtPointOrZero(a,e=0){return this.getAtPoint(a,e)||0}getAtPoint(a,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const s=this._source();if(!s||a.y<0||a.y>1)return e;const h=s.getSource().maxzoom,l=1<<h,d=Math.floor(a.x),v=a.x-d,S=new vt(h,d,h,Math.floor(v*l),Math.floor(a.y*l)),R=this.findDEMTileFor(S);if(!R||!R.dem)return e;const g=R.dem,E=1<<R.tileID.canonical.z,D=(v*E-R.tileID.canonical.x)*g.dim,T=(a.y*E-R.tileID.canonical.y)*g.dim,A=Math.floor(D),z=Math.floor(T);return(i?this.exaggeration():1)*di(di(g.get(A,z),g.get(A,z+1),T-z),di(g.get(A+1,z),g.get(A+1,z+1),T-z),D-A)}getAtTileOffset(a,e,i){const s=1<<a.canonical.z;return this.getAtPointOrZero(new r(a.wrap+(a.canonical.x+e/zt)/s,(a.canonical.y+i/zt)/s))}getAtTileOffsetFunc(a,e,i,s){return h=>{const l=this.getAtTileOffset(a,h.x,h.y),d=s.upVector(a.canonical,h.x,h.y),v=s.upVectorScale(a.canonical,e,i).metersToTile;return Ae.vec3.scale(d,d,l*v),d}}getForTilePoints(a,e,i,s){if(this.isUsingMockSource())return!1;const h=om.create(this,a,s);return!!h&&(e.forEach(l=>{l[2]=this.exaggeration()*h.getElevationAt(l[0],l[1],i)}),!0)}getMinMaxForTile(a){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(a);if(!e||!e.dem)return null;const i=e.dem.tree,s=e.tileID,h=1<<a.canonical.z-s.canonical.z;let l=a.canonical.x/h-s.canonical.x,d=a.canonical.y/h-s.canonical.y,v=0;for(let S=0;S<a.canonical.z-s.canonical.z&&!i.leaves[v];S++){l*=2,d*=2;const R=2*Math.floor(d)+Math.floor(l);v=i.childOffsets[v]+R,l%=1,d%=1}return{min:this.exaggeration()*i.minimums[v],max:this.exaggeration()*i.maximums[v]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(a,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(a){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(a){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const a=this.visibleDemTiles;if(a.length===0)return null;let e=!1,i=Number.MAX_VALUE,s=Number.MIN_VALUE;for(const h of a){const l=this.getMinMaxForTile(h.tileID);l&&(i=Math.min(i,l.min),s=Math.max(s,l.max),e=!0)}return e?{min:i,max:s}:null}},n.cK=Vm,n.cL=mi,n.cM=function(a,e){return[Math.pow(a[0],2.2)*e,Math.pow(a[1],2.2)*e,Math.pow(a[2],2.2)*e]},n.cN=Ha,n.cO=Pc,n.cP=zu,n.cQ=256,n.cR=function(a,e){const i=[0,0,0],s=en(Fr(e.canonical));return Ae.vec3.transformMat4(i,i,s),Ae.vec3.transformMat4(i,i,a),i},n.cS=a=>({u_camera_to_center_distance:new Qr(a),u_extrude_scale:new Ho(a),u_device_pixel_ratio:new Qr(a),u_matrix:new yh(a),u_inv_rot_matrix:new yh(a),u_merc_center:new ts(a),u_tile_id:new zl(a),u_zoom_transition:new Qr(a),u_up_dir:new zl(a),u_emissive_strength:new Qr(a)}),n.cT=a=>({u_matrix:new yh(a),u_pixels_to_tile_units:new Ho(a),u_device_pixel_ratio:new Qr(a),u_width_scale:new Qr(a),u_floor_width_scale:new Qr(a),u_units_to_pixels:new ts(a),u_dash_image:new _c(a),u_gradient_image:new _c(a),u_image_height:new Qr(a),u_texsize:new ts(a),u_tile_units_to_pixels:new Qr(a),u_alpha_discard_threshold:new Qr(a),u_trim_offset:new ts(a),u_trim_fade_range:new ts(a),u_trim_color:new mu(a),u_emissive_strength:new Qr(a),u_zbias_factor:new Qr(a),u_tile_to_meter:new Qr(a)}),n.cU=a=>({u_matrix:new yh(a),u_texsize:new ts(a),u_pixels_to_tile_units:new Ho(a),u_device_pixel_ratio:new Qr(a),u_width_scale:new Qr(a),u_floor_width_scale:new Qr(a),u_image:new _c(a),u_units_to_pixels:new ts(a),u_tile_units_to_pixels:new Qr(a),u_alpha_discard_threshold:new Qr(a),u_trim_offset:new ts(a),u_trim_fade_range:new ts(a),u_trim_color:new mu(a),u_emissive_strength:new Qr(a),u_zbias_factor:new Qr(a),u_tile_to_meter:new Qr(a)}),n.cV=fh,n.cW=iv,n.cX=rv,n.cY=Pl,n.cZ=(a,e,i,s,h,l)=>{const d=a.transform,v=d.projection.name==="globe";let S;if(l.paint.get("circle-pitch-alignment")==="map")if(v){const g=Ha(d.zoom,e.canonical)*d._pixelsPerMercatorPixel;S=Float32Array.from([g,0,0,g])}else S=d.calculatePixelsToTileUnitsMatrix(i);else S=new Float32Array([d.pixelsToGLUnits[0],0,0,d.pixelsToGLUnits[1]]);const R={u_camera_to_center_distance:a.transform.getCameraToCenterDistance(d.projection),u_matrix:a.translatePosMatrix(e.projMatrix,i,l.paint.get("circle-translate"),l.paint.get("circle-translate-anchor")),u_device_pixel_ratio:ye.devicePixelRatio,u_extrude_scale:S,u_inv_rot_matrix:Yo,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:l.paint.get("circle-emissive-strength")};if(v){R.u_inv_rot_matrix=s,R.u_merc_center=h,R.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],R.u_zoom_transition=oa(d.zoom);const g=h[0]*zt,E=h[1]*zt;R.u_up_dir=d.projection.upVector(new dt(0,0,0),g,E)}return R},n.c_=jd,n.ca=mu,n.cb=function(a,e,i){const s=Math.sqrt(a*a+e*e+i*i),h=s>0?Math.acos(i/s)*Jo:0;let l=a!==0||e!==0?Math.atan2(-e,-a)*Jo+90:0;return l<0&&(l+=360),[s,l,h]},n.cc=t,n.cd=Ut,n.ce=ha,n.cf=function(a){return[Math.pow(a[0],1/2.2),Math.pow(a[1],1/2.2),Math.pow(a[2],1/2.2)]},n.cg=function(a,e){return a.readFields(LT,{icons:[]},e)},n.ch=function(a){return a({pluginStatus:Da,pluginURL:jo}),bl.on("pluginStateChange",a),a},n.ci=Jg,n.cj=rm,n.ck=av,n.cl=Wa,n.cm=pd,n.cn=De,n.co=ps,n.cp=In,n.cq=function(a){const e=a.indexOf(lh);return e>=0?a.slice(0,e):a},n.cr=function(a){return a.indexOf(lh)>=0},n.cs=function(a){const e=a.indexOf(lh);return e>=0?a.slice(e+1):""},n.ct=function(a){const e=[],i=a.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),a.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},n.cu=function(a,e,i,s){return a.type==="custom"?new xT(a,e):new RT[a.type](a,e,i,s)},n.cv=Lc,n.cw=class extends pm{constructor(a,e){super(a._vectorTileFeature,a._z,a._x,a._y,a.id),a.state&&(this.state=Object.assign({},a.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=a.source,this.sourceLayer=a.sourceLayer,this.layer=a.layer)}toJSON(){const a=super.toJSON();return a.target=this.target,a.namespace=this.namespace,a}},n.cx=bl,n.cy=an,n.cz=_o,n.d=function(a){return Jr.API_TILEJSON_REGEX.test(a)},n.d$=t1,n.d0=(a,e,i,s,h,l,d,v,S)=>{const R=a.transform,g=R.calculatePixelsToTileUnitsMatrix(e),E=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none",D=R.pitch<15?o_(.07,.7,Mi((14-R.zoom)/5,0,1)):.07;return{u_matrix:l_(a,e,i,s),u_pixels_to_tile_units:g,u_device_pixel_ratio:l,u_width_scale:d,u_floor_width_scale:v,u_units_to_pixels:[1/R.pixelsToGLUnits[0],1/R.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:h,u_texsize:Dg(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:$p(e,a.transform),u_alpha_discard_threshold:0,u_trim_offset:S,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toRenderColor(E?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:D,u_tile_to_meter:t(e.tileID.canonical,0)}},n.d1=zc,n.d2=wh,n.d3=Ih,n.d4=Vt,n.d5=Xp,n.d6=ma,n.d7=450,n.d8=7,n.d9=vT,n.dA=Hl,n.dB=c,n.dC=Ll,n.dD=function([a,e,i]){const s=Math.hypot(a,e,i),h=Math.atan2(a,i),l=.5*Math.PI-Math.acos(-e/s);return new ir(Tn(h),Tn(l))},n.dE=yv,n.dF=function(a){const e=a.navigator?a.navigator.userAgent:null;return!!function(i){if(So==null){const s=i.navigator?i.navigator.userAgent:null;So=!!i.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return So}(a)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},n.dG=function(a,e){Oe=a,Ze=e},n.dH=$n,n.dI=as,n.dJ=function(a){const e=[0,0,0],i=Ae.mat4.identity(new Float64Array(16));return Ae.mat4.multiply(i,a.pixelMatrix,a.globeMatrix),Ae.vec3.transformMat4(e,e,i),new Rt(e[0],e[1])},n.dK=function(a,e,i=!1){if(Da===rh||Da===dn||Da===nh)throw new Error("setRTLTextPlugin cannot be called multiple times.");jo=ye.resolveURL(a),Da=rh,Ts=e,ah(),i||na()},n.dL=au,n.dM=function(){Jg().acquire(Sv)},n.dN=function(){const a=M_;a&&(a.isPreloaded()&&a.numActive()===1?(a.release(Sv),M_=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},n.dO=Wd,n.dP=function(a){const e=At();if(!e)return;const i=e.delete(Ve);a&&i.catch(a).then(()=>a())},n.dQ=E_,n.dR=Gb,n.dS=function(a){Pv=ye.resolveURL(a),dm||(dm=new lm(Jg(),new Co)),dm.broadcast("setDracoUrl",Pv)},n.dT=Hb,n.dU=function(a){fm=ye.resolveURL(a),dm||(dm=new lm(Jg(),new Co)),dm.broadcast("setMeshoptUrl",fm)},n.dV=Zt,n.dW=xc,n.dX=Tc,n.dY=Ah,n.dZ=class{constructor(a,e){this.pos=a,this.dir=e}intersectsPlane(a,e,i){const s=Ae.vec2.dot(e,this.dir);if(Math.abs(s)<1e-6)return!1;const h=((a[0]-this.pos[0])*e[0]+(a[1]-this.pos[1])*e[1])/s;return i[0]=this.pos[0]+this.dir[0]*h,i[1]=this.pos[1]+this.dir[1]*h,!0}},n.d_=e1,n.da=cr,n.db=gf,n.dc=256,n.dd=mr,n.de=po,n.df=Ia,n.dg=mo,n.dh=function(a,e,i,s,h){return Mi((a-e)/(i-e)*(h-s)+s,s,h)},n.di=gl,n.dj=vc,n.dk=class{constructor(a,e,i,s){this.context=a,this.format=s,this.size=i,this.texture=a.gl.createTexture();const[h,l,d]=this.size,{gl:v}=a;v.bindTexture(v.TEXTURE_3D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(!1),v.texImage3D(v.TEXTURE_3D,0,this.format,h,l,d,0,pv(this.format),mv(this.format),e.data)}bind(a,e){const{context:i}=this,{gl:s}=i;s.bindTexture(s.TEXTURE_3D,this.texture),a!==this.minFilter&&(s.texParameteri(s.TEXTURE_3D,s.TEXTURE_MAG_FILTER,a),s.texParameteri(s.TEXTURE_3D,s.TEXTURE_MIN_FILTER,a),this.minFilter=a),e!==this.wrapS&&(s.texParameteri(s.TEXTURE_3D,s.TEXTURE_WRAP_S,e),s.texParameteri(s.TEXTURE_3D,s.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:a}=this.context;a.deleteTexture(this.texture),this.texture=null}},n.dl=vv,n.dm=[1,1,1],n.dn=om,n.dp=sm,n.dq=Dl,n.dr=fc,n.ds=Ws,n.dt=hu,n.du=As,n.dv=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Rt(1/0,1/0),max:new Rt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(a,e=!1){const i=Hp(new Rt(0,0),new Rt(zt,zt),a),s=[];if(e&&!Gp(i,this._globalClipBounds))return s;for(const h of this._activeRegions){if(h.hiddenByOverlap||!Gp(i,h))continue;const l=Hy(h.min,h.max,a);s.push({min:l.min,max:l.max,sourceId:this._sourceIds[h.priority],footprint:h.footprint,footprintTileId:h.tileId,order:h.order,clipMask:h.clipMask,clipScope:h.clipScope})}return s}setSources(a){this._setSources(a.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const i=[];for(const s of e.cache.getVisibleCoordinates()){const h=e.cache.getTile(s).buckets[e.layer];h&&h.updateFootprints(s.toUnwrapped(),i)}return i},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(a){const e=a.getFootprints();if(e.length===0)return;const i=a.getOrder(),s=a.getClipMask(),h=a.getClipScope();for(const l of e){if(!l.footprint)continue;const d=Hp(l.footprint.min,l.footprint.max,l.id);this._activeRegions.push({min:d.min,max:d.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:l.id,footprint:l.footprint,order:i,clipMask:s,clipScope:h})}this._sourceIds.push(a.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,i)=>e.priority-i.priority||Ch(e.min,i.min)||Ch(e.max,i.max)||e.order-i.order||e.clipMask-i.clipMask||function(s,h){const l=(d,v)=>d+v;return s.length-h.length||s.reduce(l,"").localeCompare(h.reduce(l,""))}(e.clipScope,i.clipScope));let a=this._activeRegions.length!==this._prevRegions.length;if(!a){let e=0;for(;!a&&e!==this._activeRegions.length;){const i=this._activeRegions[e],s=this._prevRegions[e];a=i.priority!==s.priority||!Xm(i,s)||i.order!==s.order||i.clipMask!==s.clipMask||!kn(i.clipScope,s.clipScope),++e}}if(a){++this._updateTime;for(const i of this._activeRegions)i.order!==If&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,i.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,i.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,i.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,i.max.y));const e=i=>{const s=this._activeRegions;if(i>=s.length)return i;const h=s[i].priority;for(;i<s.length&&s[i].priority===h;)++i;return i};if(this._sourceIds.length>1){let i=0,s=e(i);for(;i!==s;){let h=i;const l=i;for(;h!==s;){const d=this._activeRegions[h];d.hiddenByOverlap=!1;for(let v=0;v<l;v++){const S=this._activeRegions[v];if(!S.hiddenByOverlap&&d.order===If&&Gp(d,S)&&(d.hiddenByOverlap=yg(d.footprint,d.tileId,S.footprint,S.tileId),d.hiddenByOverlap))break}++h}i=s,s=e(i)}}}}_setSources(a){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=a.length-1;e>=0;e--)this._addSource(a[e]);this._computeReplacement()}},n.dw=class{constructor(a){this._createGrid(a),this._createPoles(a)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const a of this._poleSegments)a.destroy();for(const a of this._gridSegments)a.withSkirts.destroy(),a.withoutSkirts.destroy()}_fillGridMeshWithLods(a,e){const i=new fo,s=new Ln,h=[],l=a+1+2,d=e[0]+1,v=e[0]+1+(1+e.length),S=(R,g,E)=>{let D=R===l-1?R-2:R===0?R:R-1;return D+=E?24575:0,[D,g]};for(let R=0;R<l;++R)i.emplaceBack(...S(R,0,!0));for(let R=0;R<d;++R)for(let g=0;g<l;++g)i.emplaceBack(...S(g,R,(g===0||g===l-1)&&!0));for(let R=0;R<e.length;++R){const g=e[R];for(let E=0;E<l;++E)i.emplaceBack(...S(E,g,!0))}for(let R=0;R<e.length;++R){const g=s.length,E=e[R]+1+2,D=new Ln;for(let z=0;z<E-1;z++){const B=z===E-2,N=B?l*(v-e.length+R-z):l;for(let Z=0;Z<l-1;Z++){const X=z*l+Z;z===0||B||Z===0||Z===l-2?(D.emplaceBack(X+1,X,X+N),D.emplaceBack(X+N,X+N+1,X+1)):(s.emplaceBack(X+1,X,X+N),s.emplaceBack(X+N,X+N+1,X+1))}}const T=Xr.simpleSegment(0,g,i.length,s.length-g);for(let z=0;z<D.uint16.length;z+=3)s.emplaceBack(D.uint16[z],D.uint16[z+1],D.uint16[z+2]);const A=Xr.simpleSegment(0,g,i.length,s.length-g);h.push({withoutSkirts:T,withSkirts:A})}return{vertices:i,indices:s,segments:h}}_createGrid(a){const e=this._fillGridMeshWithLods(Ol,gu);this._gridSegments=e.segments,this._gridBuffer=a.createVertexBuffer(e.vertices,ri.members),this._gridIndexBuffer=a.createIndexBuffer(e.indices,!0)}_createPoles(a){const e=new Ln;for(let d=0;d<=Ol;d++)e.emplaceBack(0,d+1,d+2);this._poleIndexBuffer=a.createIndexBuffer(e,!0);const i=new Ia,s=new Ia,h=new Ia,l=new Ia;this._poleSegments=[];for(let d=0,v=0;d<rs;d++){const S=360/(1<<d);i.emplaceBack(0,-aa,0,.5,0),s.emplaceBack(0,-aa,0,.5,1),h.emplaceBack(0,-aa,0,.5,.5),l.emplaceBack(0,-aa,0,.5,.5);for(let R=0;R<=Ol;R++){let g=R/Ol,E=0;const D=di(0,S,g),[T,A,z]=gc(ss,Za,D,aa);i.emplaceBack(T,A,z,g,E),s.emplaceBack(T,A,z,g,1-E);const B=Yi(D);g=.5+.5*Math.sin(B),E=.5+.5*Math.cos(B),h.emplaceBack(T,A,z,g,E),l.emplaceBack(T,A,z,g,1-E)}this._poleSegments.push(Xr.simpleSegment(v,0,66,64)),v+=66}this._poleNorthVertexBuffer=a.createVertexBuffer(i,ui,!1),this._poleSouthVertexBuffer=a.createVertexBuffer(s,ui,!1),this._texturedPoleNorthVertexBuffer=a.createVertexBuffer(h,ui,!1),this._texturedPoleSouthVertexBuffer=a.createVertexBuffer(l,ui,!1)}getGridBuffers(a,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[a].withSkirts:this._gridSegments[a].withoutSkirts]}getPoleBuffers(a,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[a]]}},n.dx=If,n.dy=Gl,n.dz=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},n.e=Jr,n.e0=Ud,n.e1=Kn,n.e2=Bs,n.e3=yx,n.e4=function(a,e,i,s,h,l,d,v,S,R,g=1,E,D){a.createArrays(),a.tilePixelRatio=zt/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;const T=a.layers[0].layout,A=a.layers[0]._unevaluatedLayout._values,z={};z.scaleFactor=g,z.textSizeScaleRange=T.get("text-size-scale-range"),z.iconSizeScaleRange=T.get("icon-size-scale-range");const[B,N]=z.textSizeScaleRange,[Z,X]=z.iconSizeScaleRange;if(z.textScaleFactor=Mi(z.scaleFactor,B,N),z.iconScaleFactor=Mi(z.scaleFactor,Z,X),a.textSizeData.kind==="composite"){const{minZoom:re,maxZoom:he}=a.textSizeData;z.compositeTextSizes=[A["text-size"].possiblyEvaluate(new wr(re),v),A["text-size"].possiblyEvaluate(new wr(he),v)]}if(a.iconSizeData.kind==="composite"){const{minZoom:re,maxZoom:he}=a.iconSizeData;z.compositeIconSizes=[A["icon-size"].possiblyEvaluate(new wr(re),v),A["icon-size"].possiblyEvaluate(new wr(he),v)]}z.layoutTextSize=A["text-size"].possiblyEvaluate(new wr(S+1),v),z.layoutIconSize=A["icon-size"].possiblyEvaluate(new wr(S+1),v),z.textMaxSize=A["text-size"].possiblyEvaluate(new wr(18),v);const q=T.get("text-rotation-alignment")==="map"&&T.get("symbol-placement")!=="point",Y=T.get("text-size");let K=!1;for(const re of a.features)if(re.icon&&re.icon.nameSecondary){K=!0;break}for(const re of a.features){const he=T.get("text-font").evaluate(re,{},v).join(","),ue=Y.evaluate(re,{},v)*z.textScaleFactor,ce=z.layoutTextSize.evaluate(re,{},v)*z.textScaleFactor,Te=(z.layoutIconSize.evaluate(re,{},v),{horizontal:{},vertical:void 0}),de=re.text;let Se,Ce=[0,0];if(de){const ke=de.toString(),Ue=T.get("text-letter-spacing").evaluate(re,{},v)*la,Pe=T.get("text-line-height").evaluate(re,{},v)*la,at=On(ke)?Ue:0,mt=T.get("text-anchor").evaluate(re,{},v),nt=T.get("text-variable-anchor");if(!nt){const ei=T.get("text-radial-offset").evaluate(re,{},v);Ce=ei?Sx(mt,[ei*la,sv]):T.get("text-offset").evaluate(re,{},v).map(jt=>jt*la)}let Bt=q?"center":T.get("text-justify").evaluate(re,{},v);const Ot=T.get("symbol-placement")==="point",bt=Ot?T.get("text-max-width").evaluate(re,{},v)*la:1/0,yt=ei=>{a.allowVerticalPlacement&&Ur(ke)&&(Te.vertical=Pt(de,e,i,h,he,bt,Pe,mt,ei,at,Ce,xe.vertical,!0,ce,ue))};if(!q&&nt){const ei=Bt==="auto"?nt.map(Wt=>ov(Wt)):[Bt];let jt=!1;for(let Wt=0;Wt<ei.length;Wt++){const Ti=ei[Wt];if(!Te.horizontal[Ti])if(jt)Te.horizontal[Ti]=Te.horizontal[0];else{const zi=Pt(de,e,i,h,he,bt,Pe,"center",Ti,at,Ce,xe.horizontal,!1,ce,ue);zi&&(Te.horizontal[Ti]=zi,jt=zi.positionedLines.length===1)}}yt("left")}else{if(Bt==="auto"&&(Bt=ov(mt)),Ot||T.get("text-writing-mode").indexOf("horizontal")>=0||!Ur(ke)){const ei=Pt(de,e,i,h,he,bt,Pe,mt,Bt,at,Ce,xe.horizontal,!1,ce,ue);ei&&(Te.horizontal[Bt]=ei)}yt(Ot?"left":Bt)}}let Me=!1;if(re.icon&&re.icon.namePrimary){const ke=f_(a.iconSizeData,A["icon-size"],v,a.zoom,re)*z.iconScaleFactor*E,Ue=re.icon.getPrimary().scaleSelf(ke).serialize(),Pe=s[Ue];Pe&&(Se=Ht(h[Ue],re.icon.nameSecondary?h[re.icon.getSecondary().scaleSelf(ke).serialize()]:void 0,T.get("icon-offset").evaluate(re,{},v),T.get("icon-anchor").evaluate(re,{},v)),Me=Pe.sdf,a.sdfIcons===void 0?a.sdfIcons=Pe.sdf:a.sdfIcons!==Pe.sdf&&Ri("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Pe.pixelRatio!==a.pixelRatio||T.get("icon-rotate").constantOr(1)!==0)&&(a.iconsNeedLinear=!0))}const Le=Mx(Te.horizontal)||Te.vertical;a.iconsInText||(a.iconsInText=!!Le&&Le.iconsInText),(Le||Se)&&sT(a,re,Te,Se,s,z,ce,0,Ce,Me,d,v,R,D,K)}l&&a.generateCollisionDebugBuffers(S,a.collisionBoxArray,z.textScaleFactor)},n.e5=ay,n.e6=Pa,n.e7=Zm,n.e8=o,n.e9=ae,n.ea=function(a){let e=0;if(new Uint32Array(a,0,1)[0]!==Xb){const i=new Uint32Array(a,0,7),[,,s,h,l,d]=i;e=i.byteLength+h+l+d+l,(s!==a.byteLength||e>=a.byteLength)&&Ri("Invalid b3dm header information.")}return Qb(a,e)},n.eb=function(a,e){const i=Jb(a);for(const s of i){for(const h of s.meshes)PS(h);s.lights&&(s.lightMeshIndex=s.meshes.length,s.meshes.push(kS(s.lights,e)))}return i},n.ec=Kg,n.ed=db,n.ee=Pr,n.ef=function(a){Dt(),Xe!=null&&Xe.then(e=>{e.keys().then(i=>{for(let s=0;s<i.length-a;s++)e.delete(i[s])})})},n.f=function(a){return a.indexOf("mapbox:")===0},n.g=function(a,e){return an(Fn(a,{method:"GET"}),e)},n.h=Ou,n.i=function(a){return Jr.API_STYLE_REGEX.test(a)&&!Lu(a)},n.j=function(a){return decodeURIComponent(atob(a).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},n.k=function(a){return btoa(encodeURIComponent(a).replace(/%([0-9A-F]{2})/g,(e,i)=>String.fromCharCode(+("0x"+i))))},n.l=Fn,n.m=fi,n.n=function(a,e){return an(Fn(a,{type:"json"}),e)},n.o=Uh,n.p=function(a,e){return an(Fn(a,{method:"POST"}),e)},n.q=ye,n.r=Qn,n.s=function(a){try{const e=self[a];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},n.t=oe,n.u=function(){return function a(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)}()},n.v=function(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)},n.w=Ri,n.x=function(){return Ev||(Ev=new Wd),Ev},n.y=Mo,n.z=ks}),j(["./shared"],function(n){function ae(We){const Q=We?We.url.toString():void 0;return Q?performance.getEntriesByName(Q):[]}function ne(We){if(typeof We=="number"||typeof We=="boolean"||typeof We=="string"||We==null)return JSON.stringify(We);if(Array.isArray(We)){let ie="[";for(const oe of We)ie+=`${ne(oe)},`;return`${ie}]`}let Q="{";for(const ie of Object.keys(We).sort())Q+=`${ie}:${ne(We[ie])},`;return`${Q}}`}function ge(We){let Q="";for(const ie of n.bm)(We.type!=="model"||ie!=="minzoom"&&ie!=="maxzoom")&&(Q+=`/${ne(We[ie])}`);return Q}class Ie{constructor(Q){this.keyCache={},this._layers={},this._layerConfigs={},Q&&this.replace(Q)}replace(Q,ie){this._layerConfigs={},this._layers={},this.update(Q,[],ie)}update(Q,ie,oe){this._options=oe;for(const we of Q)this._layerConfigs[we.id]=we,(this._layers[we.id]=n.cu(we,this.scope,null,this._options)).compileFilter(oe),this.keyCache[we.id]&&delete this.keyCache[we.id];for(const we of ie)delete this.keyCache[we],delete this._layerConfigs[we],delete this._layers[we];this.familiesBySource={};const ye=function(we,De){const Ve={};for(let Ze=0;Ze<we.length;Ze++){const He=we[Ze];let Xe=De&&De[He.id];!Xe&&(Xe=ge(He),He.type==="line"&&He.paint)&&function At(Dt){return typeof Dt=="string"&&Dt==="line-progress"||(Array.isArray(Dt)?Dt.some(At):!(!Dt||typeof Dt!="object")&&Object.values(Dt).some(At))}(He.paint["line-width"])&&(Xe+=`/${ne(He.paint["line-width"])}`),De&&(De[He.id]=Xe);let ht=Ve[Xe];ht||(ht=Ve[Xe]=[]),ht.push(He)}const Oe=[];for(const Ze in Ve)Oe.push(Ve[Ze]);return Oe}(n.bj(this._layerConfigs),this.keyCache);for(const we of ye){const De=we.map(ht=>this._layers[ht.id]),Ve=De[0];if(Ve.visibility==="none")continue;const Oe=Ve.source||"";let Ze=this.familiesBySource[Oe];Ze||(Ze=this.familiesBySource[Oe]={});const He=Ve.sourceLayer||"_geojsonTileLayer";let Xe=Ze[He];Xe||(Xe=Ze[He]=[]),Xe.push(De)}}}const Re=1*n.dX;class je{constructor(Q){const ie={},oe=[];for(const Ve in Q){const Oe=Q[Ve],Ze=ie[Ve]={};for(const He in Oe.glyphs){const Xe=Oe.glyphs[+He];if(!Xe||Xe.bitmap.width===0||Xe.bitmap.height===0)continue;const ht=Xe.metrics.localGlyph?Re:1,At={x:0,y:0,w:Xe.bitmap.width+2*ht,h:Xe.bitmap.height+2*ht};oe.push(At),Ze[He]=At}}const{w:ye,h:we}=n.F(oe),De=new n.dW({width:ye||1,height:we||1});for(const Ve in Q){const Oe=Q[Ve];for(const Ze in Oe.glyphs){const He=Oe.glyphs[+Ze];if(!He||He.bitmap.width===0||He.bitmap.height===0)continue;const Xe=ie[Ve][Ze],ht=He.metrics.localGlyph?Re:1;n.dW.copy(He.bitmap,De,{x:0,y:0},{x:Xe.x+ht,y:Xe.y+ht},He.bitmap)}}this.image=De,this.positions=ie}}n.dV(je,"GlyphAtlas");const Qe="3d_elevation_id",tt="hd_road_elevation";class pt{constructor(){this._valid=!1}reset(Q){return this.feature=Q,this._valid=!0,this._geometry=Q.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(Q,ie){return this._valid&&Q(ie(this._geometry)),this}require(Q,ie,oe){return this.get(Q,!0,ie,oe)}optional(Q,ie,oe){return this.get(Q,!1,ie,oe)}success(){return this._valid}get(Q,ie,oe,ye){const we=this.feature.properties.hasOwnProperty(Q)?+this.feature.properties[Q]:void 0;return this._valid&&we!==void 0?oe(ye?ye(we):we):ie&&(this._valid=!1),this}}class $e{constructor(Q,ie){this.featureFunc=Q,this.vertexFunc=ie}parseFeature(Q,ie,oe){return this.featureFunc(Q,ie,oe)}parseVertex(Q,ie,oe){return this.vertexFunc(Q,ie,oe)}}const Et=new $e((We,Q,ie)=>We.reset(Q).require(Qe,oe=>{ie.id=oe}).optional("fixed_height_relative",oe=>{ie.constantHeight=oe},Mt.decodeRelativeHeight).geometry(oe=>{ie.bounds=oe},Mt.computeBounds).success(),(We,Q,ie)=>We.reset(Q).require(Qe,oe=>{ie.id=oe}).require("elevation_idx",oe=>{ie.idx=oe}).require("extent",oe=>{ie.extent=oe}).require("height_relative",oe=>{ie.height=oe},Mt.decodeRelativeHeight).geometry(oe=>{ie.position=oe},Mt.getPoint).success()),Tt=new $e((We,Q,ie)=>We.reset(Q).require(Qe,oe=>{ie.id=oe}).optional("fixed_height",oe=>{ie.constantHeight=oe},Mt.decodeMetricHeight).geometry(oe=>{ie.bounds=oe},Mt.computeBounds).success(),(We,Q,ie)=>We.reset(Q).require(Qe,oe=>{ie.id=oe}).require("elevation_idx",oe=>{ie.idx=oe}).require("extent",oe=>{ie.extent=oe}).require("height",oe=>{ie.height=oe},Mt.decodeMetricHeight).geometry(oe=>{ie.position=oe},Mt.getPoint).success());class Mt{static computeBounds(Q){const ie=new n.P(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),oe=new n.P(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const ye of Q[0])ie.x>ye.x&&(ie.x=ye.x),ie.y>ye.y&&(ie.y=ye.y),oe.x<ye.x&&(oe.x=ye.x),oe.y<ye.y&&(oe.y=ye.y);return{min:ie,max:oe}}static getPoint(Q){return n.ab.vec2.fromValues(Q[0][0].x,Q[0][0].y)}static decodeRelativeHeight(Q){return 1e-4*Q*5}static decodeMetricHeight(Q){return 1e-4*Q}static parse(Q){const ie=[],oe=[],ye=Q.length,we=new pt;for(let Ve=0;Ve<ye;Ve++){const Oe=Q.feature(Ve),Ze=Oe.properties.hasOwnProperty("version")?String(Oe.properties.version):void 0,He=(De=Ze)?De==="1.0.1"?Tt:void 0:Et;if(He===void 0){n.w(`Unknown elevation feature version number ${Ze||"(unknown)"}`);continue}const Xe=Oe.properties.hasOwnProperty("type")?Oe.properties.type:void 0;if(Xe){if(n.dY.VectorTileFeature.types[Oe.type]==="Point"&&Xe==="curve_point"){const ht={};He.parseVertex(we,Oe,ht)&&ie.push(ht)}else if(n.dY.VectorTileFeature.types[Oe.type]==="Polygon"&&Xe==="curve_meta"){const ht={};He.parseFeature(we,Oe,ht)&&oe.push(ht)}}}var De;return{vertices:ie,features:oe}}}class Ft{constructor(Q,ie,oe,ye,we,De){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=Q,this.heightRange={min:oe,max:oe},this.safeArea=ie,this.constantHeight=oe,this.constantHeight==null&&(this.constantHeight!=null||ye.length!==0)){this.vertices=ye,this.edges=we,this.edges=this.edges.filter(Ve=>Ve.a<this.vertices.length&&Ve.b<this.vertices.length&&!n.ab.vec2.exactEquals(this.vertices[Ve.a].position,this.vertices[Ve.b].position)),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const Ve of this.vertices)this.vertexProps.push({dir:n.ab.vec2.fromValues(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,Ve.height),this.heightRange.max=Math.max(this.heightRange.max,Ve.height);for(const Ve of this.edges){const Oe=this.vertices[Ve.a].position,Ze=this.vertices[Ve.b].position,He=n.ab.vec2.subtract(n.ab.vec2.create(),Ze,Oe),Xe=n.ab.vec2.length(He),ht=n.ab.vec2.scale(n.ab.vec2.create(),He,1/Xe);this.edgeProps.push({vec:He,dir:ht,len:Xe});const At=this.vertexProps[Ve.a].dir,Dt=this.vertexProps[Ve.b].dir;n.ab.vec2.add(At,At,ht),n.ab.vec2.add(Dt,Dt,ht)}for(const Ve of this.vertexProps)Ve.dir[0]===0&&Ve.dir[1]===0||n.ab.vec2.normalize(Ve.dir,Ve.dir);this.tessellate(De)}}pointElevation(Q){if(this.constantHeight!=null)return this.constantHeight;const ie=this.getClosestEdge(Q);if(ie==null)return 0;const[oe,ye]=ie;return(1-(we=ye))*this.vertices[this.edges[oe].a].height+we*this.vertices[this.edges[oe].b].height;var we}getClosestEdge(Q){if(this.edges.length===0)return;let ie=0,oe=Number.POSITIVE_INFINITY,ye=0;const we=n.ab.vec2.fromValues(Q.x,Q.y);for(let De=0;De<this.edges.length;De++){const Ve=this.edges[De],Oe=this.edgeProps[De].dir,Ze=new n.dZ(we,this.edgeProps[De].dir),He=this.vertices[Ve.a].position,Xe=this.vertices[Ve.b].position,ht=n.ab.vec2.create(),At=n.ab.vec2.create(),Dt=Ze.intersectsPlane(He,this.vertexProps[Ve.a].dir,ht),Jt=Ze.intersectsPlane(Xe,this.vertexProps[Ve.b].dir,At);if(!Dt||!Jt)continue;const fi=n.ab.vec2.subtract(n.ab.vec2.create(),At,ht),pi=n.ab.vec2.subtract(n.ab.vec2.create(),we,ht),si=n.ab.vec2.dot(fi,fi),ji=si>0?n.ab.vec2.dot(pi,fi)/si:0,qi=n.aw(ji,0,1),Ni=Math.abs((ji-qi)*this.edgeProps[De].len),tr=n.ab.vec2.subtract(n.ab.vec2.create(),we,He),sr=Ni+Math.abs(n.ab.vec2.dot(tr,n.ab.vec2.fromValues(Oe[1],-Oe[0])));sr<oe&&(ie=De,oe=sr,ye=qi)}return[ie,ye]}tessellate(Q){for(let ie=this.edges.length-1;ie>=0;--ie){const oe=this.edges[ie].a,ye=this.edges[ie].b,{position:we,height:De,extent:Ve}=this.vertices[oe],{position:Oe,height:Ze,extent:He}=this.vertices[ye],Xe=this.vertexProps[oe].dir,ht=this.vertexProps[ye].dir,At=n.ab.vec3.fromValues(we[0]/Q,we[1]/Q,De),Dt=n.ab.vec3.fromValues(Oe[0]/Q,Oe[1]/Q,Ze),Jt=n.ab.vec3.fromValues(Xe[1],-Xe[0],0);n.ab.vec3.scale(Jt,Jt,Ve);const fi=n.ab.vec3.fromValues(ht[1],-ht[0],0);if(n.ab.vec3.scale(fi,fi,He),this.distSqLines(n.ab.vec3.fromValues(At[0]+.5*Jt[0],At[1]+.5*Jt[1],At[2]+.5*Jt[2]),n.ab.vec3.fromValues(Dt[0]-.5*fi[0],Dt[1]-.5*fi[1],Dt[2]-.5*fi[2]),n.ab.vec3.fromValues(At[0]-.5*Jt[0],At[1]-.5*Jt[1],At[2]-.5*Jt[2]),n.ab.vec3.fromValues(Dt[0]+.5*fi[0],Dt[1]+.5*fi[1],Dt[2]+.5*fi[2]))<=.05*.05)continue;const pi=this.vertices.length,si=n.ab.vec2.add(n.ab.vec2.create(),we,Oe);this.vertices.push({position:n.ab.vec2.scale(si,si,.5),height:.5*(De+Ze),extent:.5*(Ve+He)});const ji=n.ab.vec2.add(n.ab.vec2.create(),Xe,ht);this.vertexProps.push({dir:n.ab.vec2.normalize(ji,ji)}),this.edges.splice(ie,1),this.edgeProps.splice(ie,1),this.edges.push({a:oe,b:pi}),this.edges.push({a:pi,b:ye});const qi=n.ab.vec2.subtract(n.ab.vec2.create(),this.vertices[pi].position,we),Ni=n.ab.vec2.length(qi),tr={vec:qi,dir:n.ab.vec2.scale(n.ab.vec2.create(),qi,1/Ni),len:Ni};this.edgeProps.push(tr),this.edgeProps.push(tr)}}distSqLines(Q,ie,oe,ye){const we=n.ab.vec3.subtract(n.ab.vec3.create(),ie,Q),De=n.ab.vec3.subtract(n.ab.vec3.create(),ye,oe),Ve=n.ab.vec3.subtract(n.ab.vec3.create(),Q,oe),Oe=n.ab.vec3.dot(we,we),Ze=n.ab.vec3.dot(we,De),He=n.ab.vec3.dot(we,Ve),Xe=n.ab.vec3.dot(De,De),ht=n.ab.vec3.dot(De,Ve),At=Oe*Xe-Ze*Ze;if(At===0){const si=n.ab.vec3.dot(Ve,De)/n.ab.vec3.dot(De,De),ji=n.ab.vec3.lerp(n.ab.vec3.create(),oe,ye,si);return n.ab.vec3.squaredDistance(ji,Q)}const Dt=(Ze*ht-He*Xe)/At,Jt=(Oe*ht-Ze*He)/At,fi=n.ab.vec3.lerp(n.ab.vec3.create(),Q,ie,Dt),pi=n.ab.vec3.lerp(n.ab.vec3.create(),oe,ye,Jt);return n.ab.vec3.squaredDistance(fi,pi)}}class ni{static parseFrom(Q,ie){const oe=Mt.parse(Q);if(!oe)return[];let{vertices:ye,features:we}=oe;const De=1/n.cc(ie);we.sort((He,Xe)=>He.id-Xe.id),ye.sort((He,Xe)=>He.id-Xe.id||He.idx-Xe.idx),ye=ye.filter((He,Xe,ht)=>Xe===ht.findIndex(At=>At.id===He.id&&At.idx===He.idx));const Ve=new Array;let Oe=0;const Ze=ye.length;for(const He of we){if(He.constantHeight){Ve.push(new Ft(He.id,He.bounds,He.constantHeight));continue}for(;Oe!==Ze&&ye[Oe].id<He.id;)Oe++;if(Oe===Ze||ye[Oe].id!==He.id)continue;const Xe=new Array,ht=new Array,At=Oe;for(;Oe!==Ze&&ye[Oe].id===He.id;){const Dt=ye[Oe];if(Xe.push({position:Dt.position,height:Dt.height,extent:Dt.extent}),Oe!==At&&ye[Oe-1].idx===Dt.idx-1){const Jt=Oe-At;ht.push({a:Jt-1,b:Jt})}Oe++}Ve.push(new Ft(He.id,He.bounds,void 0,Xe,ht,De))}return Ve}}n.dV(Ft,"ElevationFeature");class qt{constructor(Q){this.tileID=new n.aG(Q.tileID.overscaledZ,Q.tileID.wrap,Q.tileID.canonical.z,Q.tileID.canonical.x,Q.tileID.canonical.y),this.tileZoom=Q.tileZoom,this.uid=Q.uid,this.zoom=Q.zoom,this.lut=Q.lut,this.canonical=Q.tileID.canonical,this.pixelRatio=Q.pixelRatio,this.tileSize=Q.tileSize,this.source=Q.source,this.scope=Q.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Q.showCollisionBoxes,this.collectResourceTiming=!!Q.request&&Q.request.collectResourceTiming,this.promoteId=Q.promoteId,this.isSymbolTile=Q.isSymbolTile,this.tileTransform=n.aQ(Q.tileID.canonical,Q.projection),this.projection=Q.projection,this.worldview=Q.worldview,this.localizableLayerIds=Q.localizableLayerIds,this.brightness=Q.brightness,this.extraShadowCaster=!!Q.extraShadowCaster,this.tessellationStep=Q.tessellationStep,this.scaleFactor=Q.scaleFactor}parse(Q,ie,oe,ye,we){this.status="parsing",this.data=Q,this.collisionBoxArray=new n.aW;const De=new n.d_(Object.keys(Q.layers).sort()),Ve=new n.d$(this.tileID,this.promoteId);Ve.bucketLayerIDs=[];const Oe={},Ze=new n.e0(256,256),He={featureIndex:Ve,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:Ze,availableImages:oe,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},Xe=ie.familiesBySource[this.source];for(const si in Xe){const ji=Q.layers[si];if(!ji)continue;let qi=!1,Ni=!1,tr=!1;for(const an of Xe[si])an[0].type==="symbol"?qi=!0:Ni=!0,an[0].is3D()&&an[0].type!=="model"&&(tr=!0);if(this.extraShadowCaster&&!tr||this.isSymbolTile===!0&&!qi||this.isSymbolTile===!1&&!Ni)continue;ji.version===1&&n.w(`Vector tile source "${this.source}" layer "${si}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const sr=De.encode(si),un=[];let Wa=!1;for(let an=0,Gr=0;an<ji.length;an++){const $r=ji.feature(an),Fc=Ve.getId($r,si);if(this.localizableLayerIds&&this.localizableLayerIds.has(si)){const Eo=$r.properties?$r.properties.worldview:null;if(this.worldview&&typeof Eo=="string")if(Eo==="all")$r.properties.$localized=!0;else{if(!Eo.split(",").includes(this.worldview))continue;$r.properties.$localized=!0,$r.properties.worldview=this.worldview}}!Wa&&$r.properties&&$r.properties.hasOwnProperty(Qe)&&(Wa=!0),un.push({feature:$r,id:Fc,index:Gr,sourceLayerIndex:sr}),Gr++}Wa&&Q.layers.hasOwnProperty(tt)&&(He.elevationFeatures=ni.parseFrom(Q.layers[tt],this.canonical));for(const an of Xe[si]){const Gr=an[0];(!this.extraShadowCaster||Gr.is3D()&&Gr.type!=="model")&&(this.isSymbolTile!==void 0&&Gr.type==="symbol"!==this.isSymbolTile||Gr.minzoom&&this.zoom<Math.floor(Gr.minzoom)||Gr.maxzoom&&this.zoom>=Gr.maxzoom||Gr.visibility!=="none"&&(Fi(an,this.zoom,He.brightness,oe),(Oe[Gr.id]=Gr.createBucket({index:Ve.bucketLayerIDs.length,layers:an,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:sr,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(un,He,this.tileID.canonical,this.tileTransform),Ve.bucketLayerIDs.push(an.map($r=>n.aC($r.id,$r.scope)))))}}let ht,At,Dt,Jt;Ze.trim();const fi={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},pi=()=>{if(ht)return this.status="done",we(ht);if(this.extraShadowCaster)this.status="done",we(null,{buckets:n.bj(Oe).filter(si=>!si.isEmpty()),featureIndex:Ve,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:He.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(At&&Dt&&Jt){const si=new je(At),ji=new n.e3(Dt,Jt,this.lut);for(const qi in Oe){const Ni=Oe[qi];Ni instanceof n.aX?(Fi(Ni.layers,this.zoom,He.brightness,oe),n.e4(Ni,At,si.positions,Dt,ji.iconPositions,this.showCollisionBoxes,oe,this.tileID.canonical,this.tileZoom,this.projection,this.scaleFactor,this.pixelRatio,this.brightness)):Ni.hasPattern&&(Ni instanceof n.b1||Ni instanceof n.b2||Ni instanceof n.d5)&&(Fi(Ni.layers,this.zoom,He.brightness,oe),Ni.addFeatures(He,this.tileID.canonical,ji.patternPositions,oe,this.tileTransform,this.brightness))}this.status="done",we(null,{buckets:n.bj(Oe).filter(qi=>!qi.isEmpty()),featureIndex:Ve,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:si.image,lineAtlas:Ze,imageAtlas:ji,brightness:He.brightness})}};if(!this.extraShadowCaster){const si=n.e1(He.glyphDependencies,Ni=>Object.keys(Ni).map(Number));Object.keys(si).length?ye.send("getGlyphs",{uid:this.uid,stacks:si,scope:this.scope},(Ni,tr)=>{ht||(ht=Ni,At=tr,pi())},void 0,!1,fi):At={};const ji=Object.keys(He.iconDependencies);ji.length?ye.send("getImages",{icons:ji,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Ni,tr)=>{if(ht)return;ht=Ni;const sr={};Object.values(tr).some(un=>un.usvg)?this.rasterize(ye,sr,tr,He.iconDependencies,()=>{Dt=sr,pi()}):(this.fillImageMap(sr,He.iconDependencies,tr),Dt=sr,pi())},void 0,!1,fi):Dt={};const qi=Object.keys(He.patternDependencies);qi.length?ye.send("getImages",{icons:qi,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Ni,tr)=>{if(!ht){ht=Ni;const sr={};Object.values(tr).some(un=>un.usvg)?this.rasterize(ye,sr,tr,He.patternDependencies,()=>{Jt=sr,pi()}):(this.fillImageMap(sr,He.patternDependencies,tr),Jt=sr,pi())}},void 0,!1,fi):Jt={}}pi()}fillImageMap(Q,ie,oe){for(const ye in oe){const we=ie[ye]||[];for(const De of we)oe[De.id].usvg||(Q[De.serialize()]=oe[De.id])}}getImageTaskQueue(Q,ie,oe){const ye={};for(const we in ie){const De=oe[we]||[];for(const Ve of De){const Oe=Ve.serialize();ie[Ve.id].usvg?ye[Oe]||(ye[Oe]=Ve):Q[Oe]=ie[Ve.id]}}return ye}rasterize(Q,ie,oe,ye,we){const De=this.getImageTaskQueue(ie,oe,ye);this.rasterizeTask=Q.send("rasterizeImages",{scope:this.scope,imageTasks:De},(Ve,Oe)=>{if(!Ve)for(const Ze in Oe){const{id:He}=n.e2.deserializeFromString(Ze);ie[Ze]=Object.assign({},oe[He],{data:Oe[Ze]})}we()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function Fi(We,Q,ie,oe){const ye=new n.a8(Q,{brightness:ie});for(const we of We)we.recalculate(ye,oe)}class ai extends n.E{constructor(Q,ie,oe,ye,we,De){super(),this.actor=Q,this.layerIndex=ie,this.availableImages=oe,this.loadVectorData=we||n.aD,this.loading={},this.loaded={},this.deduped=new n.aB(Q.scheduler),this.isSpriteLoaded=ye,this.scheduler=Q.scheduler,this.brightness=De}loadTile(Q,ie){const oe=Q.uid,ye=Q&&Q.request,we=ye&&ye.collectResourceTiming,De=this.loading[oe]=new qt(Q);De.abort=this.loadVectorData(Q,(Ve,Oe)=>{const Ze=!this.loading[oe];if(delete this.loading[oe],De.cancelRasterize(),Ze||Ve||!Oe)return De.status="done",Ze||(this.loaded[oe]=De),ie(Ve);const He=Oe.rawData,Xe={};Oe.expires&&(Xe.expires=Oe.expires),Oe.cacheControl&&(Xe.cacheControl=Oe.cacheControl),De.vectorTile=Oe.vectorTile||new n.dY.VectorTile(new n.bh(He));const ht=()=>{De.parse(De.vectorTile,this.layerIndex,this.availableImages,this.actor,(At,Dt)=>{if(At||!Dt)return ie(At);const Jt={};if(we){const fi=ae(ye);fi.length>0&&(Jt.resourceTiming=JSON.parse(JSON.stringify(fi)))}ie(null,n.l({rawTileData:He.slice(0)},Dt,Xe,Jt))})};this.isSpriteLoaded?ht():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(ht,{type:"parseTile",isSymbolTile:Q.isSymbolTile,zoom:Q.tileZoom}):ht()}),this.loaded=this.loaded||{},this.loaded[oe]=De})}reloadTile(Q,ie){const oe=this.loaded,ye=Q.uid;if(oe&&oe[ye]){const we=oe[ye];we.scaleFactor=Q.scaleFactor,we.showCollisionBoxes=Q.showCollisionBoxes,we.projection=Q.projection,we.brightness=Q.brightness,we.tileTransform=n.aQ(Q.tileID.canonical,Q.projection),we.extraShadowCaster=Q.extraShadowCaster,we.lut=Q.lut;const De=(Ve,Oe)=>{const Ze=we.reloadCallback;Ze&&(delete we.reloadCallback,we.parse(we.vectorTile,this.layerIndex,this.availableImages,this.actor,Ze)),ie(Ve,Oe)};we.status==="parsing"?we.reloadCallback=De:we.status==="done"&&(we.vectorTile?we.parse(we.vectorTile,this.layerIndex,this.availableImages,this.actor,De):De())}else ie(null,void 0)}abortTile(Q,ie){const oe=Q.uid,ye=this.loading[oe];ye&&(ye.abort&&ye.abort(),delete this.loading[oe]),ie()}removeTile(Q,ie){const oe=this.loaded,ye=Q.uid;oe&&oe[ye]&&delete oe[ye],ie()}}class kt{loadTile(Q,ie){const{uid:oe,encoding:ye,rawImageData:we,padding:De}=Q,Ve=ImageBitmap&&we instanceof ImageBitmap?this.getImageData(we,De):we;ie(null,new n.e5(oe,Ve,ye,De<1))}getImageData(Q,ie){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Q.width,Q.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=Q.width,this.offscreenCanvas.height=Q.height,this.offscreenCanvasContext.drawImage(Q,0,0,Q.width,Q.height);const oe=this.offscreenCanvasContext.getImageData(-ie,-ie,Q.width+2*ie,Q.height+2*ie);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),oe}}n.bg.setPbf(n.bh);class li{decodeRasterArray({task:Q,buffer:ie},oe){n.bg.performDecoding(ie,Q).then(ye=>{oe(null,ye)},ye=>{oe(ye)})}}const bn=n.dY.VectorTileFeature.prototype.toGeoJSON;class Dr{constructor(Q){this._feature=Q,this.extent=n.ag,this.type=Q.type,this.properties=Q.tags,"id"in Q&&!isNaN(Q.id)&&(this.id=parseInt(Q.id,10))}loadGeometry(){if(this._feature.type===1){const Q=[];for(const ie of this._feature.geometry)Q.push([new n.P(ie[0],ie[1])]);return Q}{const Q=[];for(const ie of this._feature.geometry){const oe=[];for(const ye of ie)oe.push(new n.P(ye[0],ye[1]));Q.push(oe)}return Q}}toGeoJSON(Q,ie,oe){return bn.call(this,Q,ie,oe)}}class wn{constructor(Q){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=n.ag,this.length=Q.length,this._features=Q}feature(Q){return new Dr(this._features[Q])}}const gi=64/4096,ii=128;class Xi{constructor(){this.features=new Map}clear(){this.features.clear()}load(Q=[],ie){for(const oe of Q){const ye=oe.id;if(ye==null)continue;let we=this.features.get(ye);we&&this.updateCache(we,ie),oe.geometry?(we=ti(oe),this.updateCache(we,ie),this.features.set(ye,we)):this.features.delete(ye),this.updateCache(we,ie)}}updateCache(Q,ie){for(const{canonical:oe,uid:ye}of Object.values(ie)){const{z:we,x:De,y:Ve}=oe;Bi(Q,Math.pow(2,we),De,Ve)&&delete ie[ye]}}getTile(Q,ie,oe){const ye=Math.pow(2,Q),we=[];for(const De of this.features.values())Bi(De,ye,ie,oe)&&we.push(Nt(De,ye,ie,oe));return{features:we}}getFeatures(){return[...this.features.values()]}}function Bi({minX:We,minY:Q,maxX:ie,maxY:oe},ye,we,De){return We<(we+1+gi)/ye&&Q<(De+1+gi)/ye&&ie>(we-gi)/ye&&oe>(De-gi)/ye}function ti(We){const{id:Q,geometry:ie,properties:oe}=We;if(!ie)return;if(ie.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:ye,coordinates:we}=ie,De={id:Q,type:1,geometry:[],tags:oe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Ve=De.geometry;if(ye==="Point")et(we,Ve,De);else if(ye==="MultiPoint")for(const Oe of we)et(Oe,Ve,De);else if(ye==="LineString")De.type=2,Kt(we,Ve,De);else if(ye==="MultiLineString")De.type=2,Di(we,Ve,De);else if(ye==="Polygon")De.type=3,Di(we,Ve,De,!0);else{if(ye!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");De.type=3;for(const Oe of we)Di(Oe,Ve,De,!0)}return De}function et([We,Q],ie,oe){const ye=n.at(We);let we=n.aA(Q);we=we<0?0:we>1?1:we,ie.push(ye,we),oe.minX=Math.min(oe.minX,ye),oe.minY=Math.min(oe.minY,we),oe.maxX=Math.max(oe.maxX,ye),oe.maxY=Math.max(oe.maxY,we)}function Kt(We,Q,ie,oe=!1,ye=!1){const we=[];for(const De of We)et(De,we,ie);Q.push(we),oe&&function(De,Ve){let Oe=0;for(let Ze=0,He=De.length,Xe=He-2;Ze<He;Xe=Ze,Ze+=2)Oe+=(De[Ze]-De[Xe])*(De[Ze+1]+De[Xe+1]);if(Oe>0===Ve)for(let Ze=0,He=De.length;Ze<He/2;Ze+=2){const Xe=De[Ze],ht=De[Ze+1];De[Ze]=De[He-2-Ze],De[Ze+1]=De[He-1-Ze],De[He-2-Ze]=Xe,De[He-1-Ze]=ht}}(we,ye)}function Di(We,Q,ie,oe=!1){for(let ye=0;ye<We.length;ye++)Kt(We[ye],Q,ie,oe,ye===0)}function Nt(We,Q,ie,oe){const{id:ye,type:we,geometry:De,tags:Ve}=We,Oe=[];if(we===1)(function(Ze,He,Xe,ht,At){for(let Dt=0;Dt<Ze.length;Dt+=2){const Jt=Math.round(n.ag*(Ze[Dt+0]*He-Xe)),fi=Math.round(n.ag*(Ze[Dt+1]*He-ht));At.push([Jt,fi])}})(De,Q,ie,oe,Oe);else for(const Ze of De)wi(Ze,Q,ie,oe,Oe);return{id:ye,type:we,geometry:Oe,tags:Ve}}function wi(We,Q,ie,oe,ye){const De=n.ag+ii;let Ve;for(let Oe=0;Oe<We.length-2;Oe+=2){let Ze=Math.round(n.ag*(We[Oe+0]*Q-ie)),He=Math.round(n.ag*(We[Oe+1]*Q-oe)),Xe=Math.round(n.ag*(We[Oe+2]*Q-ie)),ht=Math.round(n.ag*(We[Oe+3]*Q-oe));const At=Xe-Ze,Dt=ht-He;Ze<-128&&Xe<-128||(Ze<-128?(He+=Math.round(Dt*((-128-Ze)/At)),Ze=-128):Xe<-128&&(ht=He+Math.round(Dt*((-128-Ze)/At)),Xe=-128),He<-128&&ht<-128||(He<-128?(Ze+=Math.round(At*((-128-He)/Dt)),He=-128):ht<-128&&(Xe=Ze+Math.round(At*((-128-He)/Dt)),ht=-128),Ze>=De&&Xe>=De||(Ze>=De?(He+=Math.round(Dt*((De-Ze)/At)),Ze=De):Xe>=De&&(ht=He+Math.round(Dt*((De-Ze)/At)),Xe=De),He>=De&&ht>=De||(He>=De?(Ze+=Math.round(At*((De-He)/Dt)),He=De):ht>=De&&(Xe=Ze+Math.round(At*((De-He)/Dt)),ht=De),Ve&&Ze===Ve[Ve.length-1][0]&&He===Ve[Ve.length-1][1]||(Ve=[[Ze,He]],ye.push(Ve)),Ve.push([Xe,ht])))))}}var _r,lr,Cn,gr={exports:{}},nn=function(){if(Cn)return gr.exports;Cn=1;var We=n.e8(),Q=function(){if(lr)return _r;lr=1;var He=n.e6(),Xe=n.e7().VectorTileFeature;function ht(Dt,Jt){this.options=Jt||{},this.features=Dt,this.length=Dt.length}function At(Dt,Jt){this.id=typeof Dt.id=="number"?Dt.id:void 0,this.type=Dt.type,this.rawGeometry=Dt.type===1?[Dt.geometry]:Dt.geometry,this.properties=Dt.tags,this.extent=Jt||4096}return _r=ht,ht.prototype.feature=function(Dt){return new At(this.features[Dt],this.options.extent)},At.prototype.loadGeometry=function(){var Dt=this.rawGeometry;this.geometry=[];for(var Jt=0;Jt<Dt.length;Jt++){for(var fi=Dt[Jt],pi=[],si=0;si<fi.length;si++)pi.push(new He(fi[si][0],fi[si][1]));this.geometry.push(pi)}return this.geometry},At.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Dt=this.geometry,Jt=1/0,fi=-1/0,pi=1/0,si=-1/0,ji=0;ji<Dt.length;ji++)for(var qi=Dt[ji],Ni=0;Ni<qi.length;Ni++){var tr=qi[Ni];Jt=Math.min(Jt,tr.x),fi=Math.max(fi,tr.x),pi=Math.min(pi,tr.y),si=Math.max(si,tr.y)}return[Jt,pi,fi,si]},At.prototype.toGeoJSON=Xe.prototype.toGeoJSON,_r}();function ie(He){var Xe=new We;return function(ht,At){for(var Dt in ht.layers)At.writeMessage(3,oe,ht.layers[Dt])}(He,Xe),Xe.finish()}function oe(He,Xe){var ht;Xe.writeVarintField(15,He.version||1),Xe.writeStringField(1,He.name||""),Xe.writeVarintField(5,He.extent||4096);var At={keys:[],values:[],keycache:{},valuecache:{}};for(ht=0;ht<He.length;ht++)At.feature=He.feature(ht),Xe.writeMessage(2,ye,At);var Dt=At.keys;for(ht=0;ht<Dt.length;ht++)Xe.writeStringField(3,Dt[ht]);var Jt=At.values;for(ht=0;ht<Jt.length;ht++)Xe.writeMessage(4,Ze,Jt[ht])}function ye(He,Xe){var ht=He.feature;ht.id!==void 0&&Xe.writeVarintField(1,ht.id),Xe.writeMessage(2,we,He),Xe.writeVarintField(3,ht.type),Xe.writeMessage(4,Oe,ht)}function we(He,Xe){var ht=He.feature,At=He.keys,Dt=He.values,Jt=He.keycache,fi=He.valuecache;for(var pi in ht.properties){var si=ht.properties[pi],ji=Jt[pi];if(si!==null){ji===void 0&&(At.push(pi),Jt[pi]=ji=At.length-1),Xe.writeVarint(ji);var qi=typeof si;qi!=="string"&&qi!=="boolean"&&qi!=="number"&&(si=JSON.stringify(si));var Ni=qi+":"+si,tr=fi[Ni];tr===void 0&&(Dt.push(si),fi[Ni]=tr=Dt.length-1),Xe.writeVarint(tr)}}}function De(He,Xe){return(Xe<<3)+(7&He)}function Ve(He){return He<<1^He>>31}function Oe(He,Xe){for(var ht=He.loadGeometry(),At=He.type,Dt=0,Jt=0,fi=ht.length,pi=0;pi<fi;pi++){var si=ht[pi],ji=1;At===1&&(ji=si.length),Xe.writeVarint(De(1,ji));for(var qi=At===3?si.length-1:si.length,Ni=0;Ni<qi;Ni++){Ni===1&&At!==1&&Xe.writeVarint(De(2,qi-1));var tr=si[Ni].x-Dt,sr=si[Ni].y-Jt;Xe.writeVarint(Ve(tr)),Xe.writeVarint(Ve(sr)),Dt+=tr,Jt+=sr}At===3&&Xe.writeVarint(De(7,1))}}function Ze(He,Xe){var ht=typeof He;ht==="string"?Xe.writeStringField(1,He):ht==="boolean"?Xe.writeBooleanField(7,He):ht==="number"&&(He%1!=0?Xe.writeDoubleField(3,He):He<0?Xe.writeSVarintField(6,He):Xe.writeVarintField(5,He))}return gr.exports=ie,gr.exports.fromVectorTileJs=ie,gr.exports.fromGeojsonVt=function(He,Xe){Xe=Xe||{};var ht={};for(var At in He)ht[At]=new Q(He[At].features,Xe),ht[At].name=At,ht[At].version=Xe.version,ht[At].extent=Xe.extent;return ie({layers:ht})},gr.exports.GeoJSONWrapper=Q,gr.exports}(),Ae=n.e9(nn);const Ea={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:We=>We},to=Math.fround||(Pa=new Float32Array(1),We=>(Pa[0]=+We,Pa[0]));var Pa;const Rt=3,kn=5,Dn=6;class Jo{constructor(Q){this.options=Object.assign(Object.create(Ea),Q),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Q){const{log:ie,minZoom:oe,maxZoom:ye}=this.options;ie&&console.time("total time");const we=`prepare ${Q.length} points`;ie&&console.time(we),this.points=Q;const De=[];for(let Oe=0;Oe<Q.length;Oe++){const Ze=Q[Oe];if(!Ze.geometry)continue;const[He,Xe]=Ze.geometry.coordinates,ht=to(ka(He)),At=to(io(Xe));De.push(ht,At,1/0,Oe,-1,1),this.options.reduce&&De.push(0)}let Ve=this.trees[ye+1]=this._createTree(De);ie&&console.timeEnd(we);for(let Oe=ye;Oe>=oe;Oe--){const Ze=+Date.now();Ve=this.trees[Oe]=this._createTree(this._cluster(Ve,Oe)),ie&&console.log("z%d: %d clusters in %dms",Oe,Ve.numItems,+Date.now()-Ze)}return ie&&console.timeEnd("total time"),this}getClusters(Q,ie){let oe=((Q[0]+180)%360+360)%360-180;const ye=Math.max(-90,Math.min(90,Q[1]));let we=Q[2]===180?180:((Q[2]+180)%360+360)%360-180;const De=Math.max(-90,Math.min(90,Q[3]));if(Q[2]-Q[0]>=360)oe=-180,we=180;else if(oe>we){const Xe=this.getClusters([oe,ye,180,De],ie),ht=this.getClusters([-180,ye,we,De],ie);return Xe.concat(ht)}const Ve=this.trees[this._limitZoom(ie)],Oe=Ve.range(ka(oe),io(De),ka(we),io(ye)),Ze=Ve.data,He=[];for(const Xe of Oe){const ht=this.stride*Xe;He.push(Ze[ht+kn]>1?Yi(Ze,ht,this.clusterProps):this.points[Ze[ht+Rt]])}return He}getChildren(Q){const ie=this._getOriginId(Q),oe=this._getOriginZoom(Q),ye="No cluster with the specified id.",we=this.trees[oe];if(!we)throw new Error(ye);const De=we.data;if(ie*this.stride>=De.length)throw new Error(ye);const Ve=this.options.radius/(this.options.extent*Math.pow(2,oe-1)),Oe=we.within(De[ie*this.stride],De[ie*this.stride+1],Ve),Ze=[];for(const He of Oe){const Xe=He*this.stride;De[Xe+4]===Q&&Ze.push(De[Xe+kn]>1?Yi(De,Xe,this.clusterProps):this.points[De[Xe+Rt]])}if(Ze.length===0)throw new Error(ye);return Ze}getLeaves(Q,ie,oe){const ye=[];return this._appendLeaves(ye,Q,ie=ie||10,oe=oe||0,0),ye}getTile(Q,ie,oe){const ye=this.trees[this._limitZoom(Q)],we=Math.pow(2,Q),{extent:De,radius:Ve}=this.options,Oe=Ve/De,Ze=(oe-Oe)/we,He=(oe+1+Oe)/we,Xe={features:[]};return this._addTileFeatures(ye.range((ie-Oe)/we,Ze,(ie+1+Oe)/we,He),ye.data,ie,oe,we,Xe),ie===0&&this._addTileFeatures(ye.range(1-Oe/we,Ze,1,He),ye.data,we,oe,we,Xe),ie===we-1&&this._addTileFeatures(ye.range(0,Ze,Oe/we,He),ye.data,-1,oe,we,Xe),Xe.features.length?Xe:null}getClusterExpansionZoom(Q){let ie=this._getOriginZoom(Q)-1;for(;ie<=this.options.maxZoom;){const oe=this.getChildren(Q);if(ie++,oe.length!==1)break;Q=oe[0].properties.cluster_id}return ie}_appendLeaves(Q,ie,oe,ye,we){const De=this.getChildren(ie);for(const Ve of De){const Oe=Ve.properties;if(Oe&&Oe.cluster?we+Oe.point_count<=ye?we+=Oe.point_count:we=this._appendLeaves(Q,Oe.cluster_id,oe,ye,we):we<ye?we++:Q.push(Ve),Q.length===oe)break}return we}_createTree(Q){const ie=new n.bE(Q.length/this.stride|0,this.options.nodeSize,Float32Array);for(let oe=0;oe<Q.length;oe+=this.stride)ie.add(Q[oe],Q[oe+1]);return ie.finish(),ie.data=Q,ie}_addTileFeatures(Q,ie,oe,ye,we,De){for(const Ve of Q){const Oe=Ve*this.stride,Ze=ie[Oe+kn]>1;let He,Xe,ht;if(Ze)He=Tn(ie,Oe,this.clusterProps),Xe=ie[Oe],ht=ie[Oe+1];else{const Jt=this.points[ie[Oe+Rt]];He=Jt.properties;const[fi,pi]=Jt.geometry.coordinates;Xe=ka(fi),ht=io(pi)}const At={type:1,geometry:[[Math.round(this.options.extent*(Xe*we-oe)),Math.round(this.options.extent*(ht*we-ye))]],tags:He};let Dt;Dt=Ze||this.options.generateId?ie[Oe+Rt]:this.points[ie[Oe+Rt]].id,Dt!==void 0&&(At.id=Dt),De.features.push(At)}}_limitZoom(Q){return Math.max(this.options.minZoom,Math.min(Math.floor(+Q),this.options.maxZoom+1))}_cluster(Q,ie){const{radius:oe,extent:ye,reduce:we,minPoints:De}=this.options,Ve=oe/(ye*Math.pow(2,ie)),Oe=Q.data,Ze=[],He=this.stride;for(let Xe=0;Xe<Oe.length;Xe+=He){if(Oe[Xe+2]<=ie)continue;Oe[Xe+2]=ie;const ht=Oe[Xe],At=Oe[Xe+1],Dt=Q.within(Oe[Xe],Oe[Xe+1],Ve),Jt=Oe[Xe+kn];let fi=Jt;for(const pi of Dt){const si=pi*He;Oe[si+2]>ie&&(fi+=Oe[si+kn])}if(fi>Jt&&fi>=De){let pi,si=ht*Jt,ji=At*Jt,qi=-1;const Ni=(Xe/He<<5)+(ie+1)+this.points.length;for(const tr of Dt){const sr=tr*He;if(Oe[sr+2]<=ie)continue;Oe[sr+2]=ie;const un=Oe[sr+kn];si+=Oe[sr]*un,ji+=Oe[sr+1]*un,Oe[sr+4]=Ni,we&&(pi||(pi=this._map(Oe,Xe,!0),qi=this.clusterProps.length,this.clusterProps.push(pi)),we(pi,this._map(Oe,sr)))}Oe[Xe+4]=Ni,Ze.push(si/fi,ji/fi,1/0,Ni,-1,fi),we&&Ze.push(qi)}else{for(let pi=0;pi<He;pi++)Ze.push(Oe[Xe+pi]);if(fi>1)for(const pi of Dt){const si=pi*He;if(!(Oe[si+2]<=ie)){Oe[si+2]=ie;for(let ji=0;ji<He;ji++)Ze.push(Oe[si+ji])}}}}return Ze}_getOriginId(Q){return Q-this.points.length>>5}_getOriginZoom(Q){return(Q-this.points.length)%32}_map(Q,ie,oe){if(Q[ie+kn]>1){const De=this.clusterProps[Q[ie+Dn]];return oe?Object.assign({},De):De}const ye=this.points[Q[ie+Rt]].properties,we=this.options.map(ye);return oe&&we===ye?Object.assign({},we):we}}function Yi(We,Q,ie){return{type:"Feature",id:We[Q+Rt],properties:Tn(We,Q,ie),geometry:{type:"Point",coordinates:[(oe=We[Q],360*(oe-.5)),Gl(We[Q+1])]}};var oe}function Tn(We,Q,ie){const oe=We[Q+kn],ye=oe>=1e4?`${Math.round(oe/1e3)}k`:oe>=1e3?Math.round(oe/100)/10+"k":oe,we=We[Q+Dn],De=we===-1?{}:Object.assign({},ie[we]);return Object.assign(De,{cluster:!0,cluster_id:We[Q+Rt],point_count:oe,point_count_abbreviated:ye})}function ka(We){return We/360+.5}function io(We){const Q=Math.sin(We*Math.PI/180),ie=.5-.25*Math.log((1+Q)/(1-Q))/Math.PI;return ie<0?0:ie>1?1:ie}function Gl(We){const Q=(180-360*We)*Math.PI/180;return 360*Math.atan(Math.exp(Q))/Math.PI-90}function Hl(We,Q,ie,oe){let ye=oe;const we=Q+(ie-Q>>1);let De,Ve=ie-Q;const Oe=We[Q],Ze=We[Q+1],He=We[ie],Xe=We[ie+1];for(let ht=Q+3;ht<ie;ht+=3){const At=Mi(We[ht],We[ht+1],Oe,Ze,He,Xe);if(At>ye)De=ht,ye=At;else if(At===ye){const Dt=Math.abs(ht-we);Dt<Ve&&(De=ht,Ve=Dt)}}ye>oe&&(De-Q>3&&Hl(We,Q,De,oe),We[De+2]=ye,ie-De>3&&Hl(We,De,ie,oe))}function Mi(We,Q,ie,oe,ye,we){let De=ye-ie,Ve=we-oe;if(De!==0||Ve!==0){const Oe=((We-ie)*De+(Q-oe)*Ve)/(De*De+Ve*Ve);Oe>1?(ie=ye,oe=we):Oe>0&&(ie+=De*Oe,oe+=Ve*Oe)}return De=We-ie,Ve=Q-oe,De*De+Ve*Ve}function ro(We,Q,ie,oe){const ye={id:We??null,type:Q,geometry:ie,tags:oe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(Q==="Point"||Q==="MultiPoint"||Q==="LineString")us(ye,ie);else if(Q==="Polygon")us(ye,ie[0]);else if(Q==="MultiLineString")for(const we of ie)us(ye,we);else if(Q==="MultiPolygon")for(const we of ie)us(ye,we[0]);return ye}function us(We,Q){for(let ie=0;ie<Q.length;ie+=3)We.minX=Math.min(We.minX,Q[ie]),We.minY=Math.min(We.minY,Q[ie+1]),We.maxX=Math.max(We.maxX,Q[ie]),We.maxY=Math.max(We.maxY,Q[ie+1])}function wo(We,Q,ie,oe){if(!Q.geometry)return;const ye=Q.geometry.coordinates;if(ye&&ye.length===0)return;const we=Q.geometry.type,De=Math.pow(ie.tolerance/((1<<ie.maxZoom)*ie.extent),2);let Ve=[],Oe=Q.id;if(ie.promoteId?Oe=Q.properties[ie.promoteId]:ie.generateId&&(Oe=oe||0),we==="Point")Fn(ye,Ve);else if(we==="MultiPoint")for(const Ze of ye)Fn(Ze,Ve);else if(we==="LineString")To(ye,Ve,De,!1);else if(we==="MultiLineString"){if(ie.lineMetrics){for(const Ze of ye)Ve=[],To(Ze,Ve,De,!1),We.push(ro(Oe,"LineString",Ve,Q.properties));return}el(ye,Ve,De,!1)}else if(we==="Polygon")el(ye,Ve,De,!0);else{if(we!=="MultiPolygon"){if(we==="GeometryCollection"){for(const Ze of Q.geometry.geometries)wo(We,{id:Oe,geometry:Ze,properties:Q.properties},ie,oe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Ze of ye){const He=[];el(Ze,He,De,!0),Ve.push(He)}}We.push(ro(Oe,we,Ve,Q.properties))}function Fn(We,Q){Q.push(zc(We[0]),Oc(We[1]),0)}function To(We,Q,ie,oe){let ye,we,De=0;for(let Oe=0;Oe<We.length;Oe++){const Ze=zc(We[Oe][0]),He=Oc(We[Oe][1]);Q.push(Ze,He,0),Oe>0&&(De+=oe?(ye*He-Ze*we)/2:Math.sqrt(Math.pow(Ze-ye,2)+Math.pow(He-we,2))),ye=Ze,we=He}const Ve=Q.length-3;Q[2]=1,Hl(Q,0,Ve,ie),Q[Ve+2]=1,Q.size=Math.abs(De),Q.start=0,Q.end=Q.size}function el(We,Q,ie,oe){for(let ye=0;ye<We.length;ye++){const we=[];To(We[ye],we,ie,oe),Q.push(we)}}function zc(We){return We/360+.5}function Oc(We){const Q=Math.sin(We*Math.PI/180),ie=.5-.25*Math.log((1+Q)/(1-Q))/Math.PI;return ie<0?0:ie>1?1:ie}function Bn(We,Q,ie,oe,ye,we,De,Ve){if(oe/=Q,we>=(ie/=Q)&&De<oe)return We;if(De<ie||we>=oe)return null;const Oe=[];for(const Ze of We){const He=Ze.geometry;let Xe=Ze.type;const ht=ye===0?Ze.minX:Ze.minY,At=ye===0?Ze.maxX:Ze.maxY;if(ht>=ie&&At<oe){Oe.push(Ze);continue}if(At<ie||ht>=oe)continue;let Dt=[];if(Xe==="Point"||Xe==="MultiPoint")Kn(He,Dt,ie,oe,ye);else if(Xe==="LineString")Lc(He,Dt,ie,oe,ye,!1,Ve.lineMetrics);else if(Xe==="MultiLineString")Nn(He,Dt,ie,oe,ye,!1);else if(Xe==="Polygon")Nn(He,Dt,ie,oe,ye,!0);else if(Xe==="MultiPolygon")for(const Jt of He){const fi=[];Nn(Jt,fi,ie,oe,ye,!0),fi.length&&Dt.push(fi)}if(Dt.length){if(Ve.lineMetrics&&Xe==="LineString"){for(const Jt of Dt)Oe.push(ro(Ze.id,Xe,Jt,Ze.tags));continue}Xe!=="LineString"&&Xe!=="MultiLineString"||(Dt.length===1?(Xe="LineString",Dt=Dt[0]):Xe="MultiLineString"),Xe!=="Point"&&Xe!=="MultiPoint"||(Xe=Dt.length===3?"Point":"MultiPoint"),Oe.push(ro(Ze.id,Xe,Dt,Ze.tags))}}return Oe.length?Oe:null}function Kn(We,Q,ie,oe,ye){for(let we=0;we<We.length;we+=3){const De=We[we+ye];De>=ie&&De<=oe&&Ri(Q,We[we],We[we+1],We[we+2])}}function Lc(We,Q,ie,oe,ye,we,De){let Ve=In(We);const Oe=ye===0?no:Nh;let Ze,He,Xe=We.start;for(let fi=0;fi<We.length-3;fi+=3){const pi=We[fi],si=We[fi+1],ji=We[fi+2],qi=We[fi+3],Ni=We[fi+4],tr=ye===0?pi:si,sr=ye===0?qi:Ni;let un=!1;De&&(Ze=Math.sqrt(Math.pow(pi-qi,2)+Math.pow(si-Ni,2))),tr<ie?sr>ie&&(He=Oe(Ve,pi,si,qi,Ni,ie),De&&(Ve.start=Xe+Ze*He)):tr>oe?sr<oe&&(He=Oe(Ve,pi,si,qi,Ni,oe),De&&(Ve.start=Xe+Ze*He)):Ri(Ve,pi,si,ji),sr<ie&&tr>=ie&&(He=Oe(Ve,pi,si,qi,Ni,ie),un=!0),sr>oe&&tr<=oe&&(He=Oe(Ve,pi,si,qi,Ni,oe),un=!0),!we&&un&&(De&&(Ve.end=Xe+Ze*He),Q.push(Ve),Ve=In(We)),De&&(Xe+=Ze)}let ht=We.length-3;const At=We[ht],Dt=We[ht+1],Jt=ye===0?At:Dt;Jt>=ie&&Jt<=oe&&Ri(Ve,At,Dt,We[ht+2]),ht=Ve.length-3,we&&ht>=3&&(Ve[ht]!==Ve[0]||Ve[ht+1]!==Ve[1])&&Ri(Ve,Ve[0],Ve[1],Ve[2]),Ve.length&&Q.push(Ve)}function In(We){const Q=[];return Q.size=We.size,Q.start=We.start,Q.end=We.end,Q}function Nn(We,Q,ie,oe,ye,we){for(const De of We)Lc(De,Q,ie,oe,ye,we,!1)}function Ri(We,Q,ie,oe){We.push(Q,ie,oe)}function no(We,Q,ie,oe,ye,we){const De=(we-Q)/(oe-Q);return Ri(We,we,ie+(ye-ie)*De,1),De}function Nh(We,Q,ie,oe,ye,we){const De=(we-ie)/(ye-ie);return Ri(We,Q+(oe-Q)*De,we,1),De}function ha(We,Q){const ie=[];for(let oe=0;oe<We.length;oe++){const ye=We[oe],we=ye.type;let De;if(we==="Point"||we==="MultiPoint"||we==="LineString")De=hs(ye.geometry,Q);else if(we==="MultiLineString"||we==="Polygon"){De=[];for(const Ve of ye.geometry)De.push(hs(Ve,Q))}else if(we==="MultiPolygon"){De=[];for(const Ve of ye.geometry){const Oe=[];for(const Ze of Ve)Oe.push(hs(Ze,Q));De.push(Oe)}}ie.push(ro(ye.id,we,De,ye.tags))}return ie}function hs(We,Q){const ie=[];ie.size=We.size,We.start!==void 0&&(ie.start=We.start,ie.end=We.end);for(let oe=0;oe<We.length;oe+=3)ie.push(We[oe]+Q,We[oe+1],We[oe+2]);return ie}function fs(We,Q){if(We.transformed)return We;const ie=1<<We.z,oe=We.x,ye=We.y;for(const we of We.features){const De=we.geometry,Ve=we.type;if(we.geometry=[],Ve===1)for(let Oe=0;Oe<De.length;Oe+=2)we.geometry.push(So(De[Oe],De[Oe+1],Q,ie,oe,ye));else for(let Oe=0;Oe<De.length;Oe++){const Ze=[];for(let He=0;He<De[Oe].length;He+=2)Ze.push(So(De[Oe][He],De[Oe][He+1],Q,ie,oe,ye));we.geometry.push(Ze)}}return We.transformed=!0,We}function So(We,Q,ie,oe,ye,we){return[Math.round(ie*(We*oe-ye)),Math.round(ie*(Q*oe-we))]}function ao(We,Q,ie,oe,ye){const we=Q===ye.maxZoom?0:ye.tolerance/((1<<Q)*ye.extent),De={features:[],numPoints:0,numSimplified:0,numFeatures:We.length,source:null,x:ie,y:oe,z:Q,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ve of We)Vh(De,Ve,we,ye);return De}function Vh(We,Q,ie,oe){const ye=Q.geometry,we=Q.type,De=[];if(We.minX=Math.min(We.minX,Q.minX),We.minY=Math.min(We.minY,Q.minY),We.maxX=Math.max(We.maxX,Q.maxX),We.maxY=Math.max(We.maxY,Q.maxY),we==="Point"||we==="MultiPoint")for(let Ve=0;Ve<ye.length;Ve+=3)De.push(ye[Ve],ye[Ve+1]),We.numPoints++,We.numSimplified++;else if(we==="LineString")Zl(De,ye,We,ie,!1,!1);else if(we==="MultiLineString"||we==="Polygon")for(let Ve=0;Ve<ye.length;Ve++)Zl(De,ye[Ve],We,ie,we==="Polygon",Ve===0);else if(we==="MultiPolygon")for(let Ve=0;Ve<ye.length;Ve++){const Oe=ye[Ve];for(let Ze=0;Ze<Oe.length;Ze++)Zl(De,Oe[Ze],We,ie,!0,Ze===0)}if(De.length){let Ve=Q.tags||null;if(we==="LineString"&&oe.lineMetrics){Ve={};for(const Ze in Q.tags)Ve[Ze]=Q.tags[Ze];Ve.mapbox_clip_start=ye.start/ye.size,Ve.mapbox_clip_end=ye.end/ye.size}const Oe={geometry:De,type:we==="Polygon"||we==="MultiPolygon"?3:we==="LineString"||we==="MultiLineString"?2:1,tags:Ve};Q.id!==null&&(Oe.id=Q.id),We.features.push(Oe)}}function Zl(We,Q,ie,oe,ye,we){const De=oe*oe;if(oe>0&&Q.size<(ye?De:oe))return void(ie.numPoints+=Q.length/3);const Ve=[];for(let Oe=0;Oe<Q.length;Oe+=3)(oe===0||Q[Oe+2]>De)&&(ie.numSimplified++,Ve.push(Q[Oe],Q[Oe+1])),ie.numPoints++;ye&&function(Oe,Ze){let He=0;for(let Xe=0,ht=Oe.length,At=ht-2;Xe<ht;At=Xe,Xe+=2)He+=(Oe[Xe]-Oe[At])*(Oe[Xe+1]+Oe[At+1]);if(He>0===Ze)for(let Xe=0,ht=Oe.length;Xe<ht/2;Xe+=2){const At=Oe[Xe],Dt=Oe[Xe+1];Oe[Xe]=Oe[ht-2-Xe],Oe[Xe+1]=Oe[ht-1-Xe],Oe[ht-2-Xe]=At,Oe[ht-1-Xe]=Dt}}(Ve,we),We.push(Ve)}const zu={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Pc{constructor(Q,ie){const oe=(ie=this.options=function(we,De){for(const Ve in De)we[Ve]=De[Ve];return we}(Object.create(zu),ie)).debug;if(oe&&console.time("preprocess data"),ie.maxZoom<0||ie.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ie.promoteId&&ie.generateId)throw new Error("promoteId and generateId cannot be used together.");let ye=function(we,De){const Ve=[];if(we.type==="FeatureCollection")for(let Oe=0;Oe<we.features.length;Oe++)wo(Ve,we.features[Oe],De,Oe);else wo(Ve,we.type==="Feature"?we:{geometry:we},De);return Ve}(Q,ie);this.tiles={},this.tileCoords=[],oe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ie.indexMaxZoom,ie.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ye=function(we,De){const Ve=De.buffer/De.extent;let Oe=we;const Ze=Bn(we,1,-1-Ve,Ve,0,-1,2,De),He=Bn(we,1,1-Ve,2+Ve,0,-1,2,De);return(Ze||He)&&(Oe=Bn(we,1,-Ve,1+Ve,0,-1,2,De)||[],Ze&&(Oe=ha(Ze,1).concat(Oe)),He&&(Oe=Oe.concat(ha(He,-1)))),Oe}(ye,ie),ye.length&&this.splitTile(ye,0,0,0),oe&&(ye.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(Q,ie,oe,ye,we,De,Ve){const Oe=[Q,ie,oe,ye],Ze=this.options,He=Ze.debug;for(;Oe.length;){ye=Oe.pop(),oe=Oe.pop(),ie=Oe.pop(),Q=Oe.pop();const Xe=1<<ie,ht=Jr(ie,oe,ye);let At=this.tiles[ht];if(!At&&(He>1&&console.time("creation"),At=this.tiles[ht]=ao(Q,ie,oe,ye,Ze),this.tileCoords.push({z:ie,x:oe,y:ye}),He)){He>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ie,oe,ye,At.numFeatures,At.numPoints,At.numSimplified),console.timeEnd("creation"));const un=`z${ie}`;this.stats[un]=(this.stats[un]||0)+1,this.total++}if(At.source=Q,we==null){if(ie===Ze.indexMaxZoom||At.numPoints<=Ze.indexMaxPoints)continue}else{if(ie===Ze.maxZoom||ie===we)continue;if(we!=null){const un=we-ie;if(oe!==De>>un||ye!==Ve>>un)continue}}if(At.source=null,Q.length===0)continue;He>1&&console.time("clipping");const Dt=.5*Ze.buffer/Ze.extent,Jt=.5-Dt,fi=.5+Dt,pi=1+Dt;let si=null,ji=null,qi=null,Ni=null,tr=Bn(Q,Xe,oe-Dt,oe+fi,0,At.minX,At.maxX,Ze),sr=Bn(Q,Xe,oe+Jt,oe+pi,0,At.minX,At.maxX,Ze);Q=null,tr&&(si=Bn(tr,Xe,ye-Dt,ye+fi,1,At.minY,At.maxY,Ze),ji=Bn(tr,Xe,ye+Jt,ye+pi,1,At.minY,At.maxY,Ze),tr=null),sr&&(qi=Bn(sr,Xe,ye-Dt,ye+fi,1,At.minY,At.maxY,Ze),Ni=Bn(sr,Xe,ye+Jt,ye+pi,1,At.minY,At.maxY,Ze),sr=null),He>1&&console.timeEnd("clipping"),Oe.push(si||[],ie+1,2*oe,2*ye),Oe.push(ji||[],ie+1,2*oe,2*ye+1),Oe.push(qi||[],ie+1,2*oe+1,2*ye),Oe.push(Ni||[],ie+1,2*oe+1,2*ye+1)}}getTile(Q,ie,oe){Q=+Q,ie=+ie,oe=+oe;const ye=this.options,{extent:we,debug:De}=ye;if(Q<0||Q>24)return null;const Ve=1<<Q,Oe=Jr(Q,ie=ie+Ve&Ve-1,oe);if(this.tiles[Oe])return fs(this.tiles[Oe],we);De>1&&console.log("drilling down to z%d-%d-%d",Q,ie,oe);let Ze,He=Q,Xe=ie,ht=oe;for(;!Ze&&He>0;)He--,Xe>>=1,ht>>=1,Ze=this.tiles[Jr(He,Xe,ht)];return Ze&&Ze.source?(De>1&&(console.log("found parent tile z%d-%d-%d",He,Xe,ht),console.time("drilling down")),this.splitTile(Ze.source,He,Xe,ht,Q,ie,oe),De>1&&console.timeEnd("drilling down"),this.tiles[Oe]?fs(this.tiles[Oe],we):null):null}}function Jr(We,Q,ie){return 32*((1<<We)*ie+Q)+We}function Ou(We,Q){const ie=We.tileID.canonical;if(!this._geoJSONIndex)return void Q(null,null);const oe=this._geoJSONIndex.getTile(ie.z,ie.x,ie.y);if(!oe)return void Q(null,null);const ye=new wn(oe.features);let we=Ae(ye);we.byteOffset===0&&we.byteLength===we.buffer.byteLength||(we=new Uint8Array(we)),Q(null,{vectorTile:ye,rawData:we.buffer})}class Lu extends ai{constructor(Q,ie,oe,ye,we,De){super(Q,ie,oe,ye,Ou,De),we&&(this.loadGeoJSON=we),this._dynamicIndex=new Xi}loadData(Q,ie){const oe=Q&&Q.request,ye=oe&&oe.collectResourceTiming;this.loadGeoJSON(Q,(we,De)=>{if(we||!De)return ie(we);if(typeof De!="object")return ie(new Error(`Input data given to '${Q.source}' is not a valid GeoJSON object.`));{try{if(Q.filter){const Oe=n.U(Q.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Oe.result==="error")throw new Error(Oe.value.map(Ze=>`${Ze.key}: ${Ze.message}`).join(", "));De.features=De.features.filter(Ze=>Oe.value.evaluate({zoom:0},Ze))}Q.dynamic?(De.type==="Feature"&&(De={type:"FeatureCollection",features:[De]}),Q.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(De.features,this.loaded),Q.cluster&&(De.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=Q.cluster?new Jo(function({superclusterOptions:Oe,clusterProperties:Ze}){if(!Ze||!Oe)return Oe;const He={},Xe={},ht={accumulated:null,zoom:0},At={properties:null},Dt=Object.keys(Ze);for(const Jt of Dt){const[fi,pi]=Ze[Jt],si=n.U(pi),ji=n.U(typeof fi=="string"?[fi,["accumulated"],["get",Jt]]:fi);He[Jt]=si.value,Xe[Jt]=ji.value}return Oe.map=Jt=>{At.properties=Jt;const fi={};for(const pi of Dt)fi[pi]=He[pi].evaluate(ht,At);return fi},Oe.reduce=(Jt,fi)=>{At.properties=fi;for(const pi of Dt)ht.accumulated=Jt[pi],Jt[pi]=Xe[pi].evaluate(ht,At)},Oe}(Q)).load(De.features):Q.dynamic?this._dynamicIndex:function(Oe,Ze){return new Pc(Oe,Ze)}(De,Q.geojsonVtOptions)}catch(Oe){return ie(Oe)}const Ve={};if(ye){const Oe=ae(oe);Oe&&(Ve.resourceTiming={},Ve.resourceTiming[Q.source]=JSON.parse(JSON.stringify(Oe)))}ie(null,Ve)}})}reloadTile(Q,ie){const oe=this.loaded;return oe&&oe[Q.uid]?Q.partial?ie(null,void 0):super.reloadTile(Q,ie):this.loadTile(Q,ie)}loadGeoJSON(Q,ie){if(Q.request)n.n(Q.request,ie);else{if(typeof Q.data!="string")return ie(new Error(`Input data given to '${Q.source}' is not a valid GeoJSON object.`));try{return ie(null,JSON.parse(Q.data))}catch{return ie(new Error(`Input data given to '${Q.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(Q,ie){try{ie(null,this._geoJSONIndex.getClusterExpansionZoom(Q.clusterId))}catch(oe){ie(oe)}}getClusterChildren(Q,ie){try{ie(null,this._geoJSONIndex.getChildren(Q.clusterId))}catch(oe){ie(oe)}}getClusterLeaves(Q,ie){try{ie(null,this._geoJSONIndex.getLeaves(Q.clusterId,Q.limit,Q.offset))}catch(oe){ie(oe)}}}class kc{constructor(Q,ie){this.tileID=new n.aG(Q.tileID.overscaledZ,Q.tileID.wrap,Q.tileID.canonical.z,Q.tileID.canonical.x,Q.tileID.canonical.y),this.tileZoom=Q.tileZoom,this.uid=Q.uid,this.zoom=Q.zoom,this.canonical=Q.tileID.canonical,this.pixelRatio=Q.pixelRatio,this.tileSize=Q.tileSize,this.source=Q.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=Q.projection,this.brightness=ie}parse(Q,ie,oe,ye){this.status="parsing";const we=new n.aG(oe.tileID.overscaledZ,oe.tileID.wrap,oe.tileID.canonical.z,oe.tileID.canonical.x,oe.tileID.canonical.y),De=[],Ve=ie.familiesBySource[oe.source],Oe=new n.d$(we,oe.promoteId);return Oe.bucketLayerIDs=[],Oe.is3DTile=!0,n.ea(Q).then(Ze=>{if(!Ze)return ye(new Error("Could not parse tile"));const He=n.eb(Ze,1/n.cc(oe.tileID.canonical)),Xe=Ze.json.extensionsUsed&&Ze.json.extensionsUsed.includes("MAPBOX_mesh_features")||Ze.json.asset.extras&&Ze.json.asset.extras.MAPBOX_mesh_features,ht=Ze.json.extensionsUsed&&Ze.json.extensionsUsed.includes("EXT_meshopt_compression"),At=new n.a8(this.zoom,{brightness:this.brightness});for(const Dt in Ve)for(const Jt of Ve[Dt]){const fi=Jt[0];Oe.bucketLayerIDs.push(Jt.map(si=>n.aC(si.id,si.scope))),fi.recalculate(At,[]);const pi=new n.ec(Jt,He,we,Xe,ht,this.brightness,Oe);Xe||(pi.needsUpload=!0),De.push(pi),pi.evaluate(fi)}this.status="done",ye(null,{buckets:De,featureIndex:Oe,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(Ze=>ye(new Error(Ze.message)))}}class Vn{constructor(Q,ie,oe,ye,we,De){this.actor=Q,this.layerIndex=ie,this.availableImages=oe,this.brightness=De,this.loading={},this.loaded={}}loadTile(Q,ie){const oe=Q.uid,ye=this.loading[oe]=new kc(Q,this.brightness);n.bi(Q.request,(we,De)=>{const Ve=!this.loading[oe];return delete this.loading[oe],Ve||we?(ye.status="done",Ve||(this.loaded[oe]=ye),ie(we)):De&&De.byteLength!==0?void ye.parse(De,this.layerIndex,Q,(Oe,Ze)=>{ye.status="done",this.loaded=this.loaded||{},this.loaded[oe]=ye,Oe||!Ze?ie(Oe):ie(null,Ze)}):(ye.status="done",this.loaded[oe]=ye,ie())})}reloadTile(Q,ie){const oe=this.loaded,ye=Q.uid;if(oe&&oe[ye]){const we=oe[ye];we.projection=Q.projection,we.brightness=Q.brightness;const De=(Ve,Oe)=>{we.reloadCallback&&(delete we.reloadCallback,this.loadTile(Q,ie)),ie(Ve,Oe)};we.status==="parsing"?we.reloadCallback=De:we.status==="done"&&this.loadTile(Q,ie)}}abortTile(Q,ie){const oe=Q.uid;this.loading[oe]&&delete this.loading[oe],ie()}removeTile(Q,ie){const oe=this.loaded,ye=Q.uid;oe&&oe[ye]&&delete oe[ye],ie()}}class Ls{constructor(Q){this.self=Q,this.actor=new n.ed(Q,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.imageRasterizer=new n.I,this.projections={},this.defaultProjection=n.bP({name:"mercator"}),this.workerSourceTypes={vector:ai,geojson:Lu,"batched-model":Vn},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(ie,oe)=>{if(this.workerSourceTypes[ie])throw new Error(`Worker source with name "${ie}" already registered.`);this.workerSourceTypes[ie]=oe},this.self.registerRTLTextPlugin=ie=>{if(n.ee.isParsed())throw new Error("RTL text plugin already registered.");n.ee.applyArabicShaping=ie.applyArabicShaping,n.ee.processBidirectionalText=ie.processBidirectionalText,n.ee.processStyledBidirectionalText=ie.processStyledBidirectionalText}}clearCaches(Q,ie,oe){delete this.layerIndexes[Q],delete this.availableImages[Q],delete this.workerSources[Q],delete this.demWorkerSources[Q],delete this.rasterArrayWorkerSource,oe()}checkIfReady(Q,ie,oe){oe()}setReferrer(Q,ie){this.referrer=ie}spriteLoaded(Q,{scope:ie,isLoaded:oe}){if(this.isSpriteLoaded[Q]||(this.isSpriteLoaded[Q]={}),this.isSpriteLoaded[Q][ie]=oe,this.workerSources[Q]&&this.workerSources[Q][ie])for(const ye in this.workerSources[Q][ie]){const we=this.workerSources[Q][ie][ye];for(const De in we){const Ve=we[De];Ve instanceof ai&&(Ve.isSpriteLoaded=oe,Ve.fire(new n.z("isSpriteLoaded")))}}}setImages(Q,{scope:ie,images:oe},ye){if(this.availableImages[Q]||(this.availableImages[Q]={}),this.availableImages[Q][ie]=oe,this.workerSources[Q]&&this.workerSources[Q][ie]){for(const we in this.workerSources[Q][ie]){const De=this.workerSources[Q][ie][we];for(const Ve in De)De[Ve].availableImages=oe}ye()}else ye()}setProjection(Q,ie){this.projections[Q]=n.bP(ie)}setBrightness(Q,ie,oe){this.brightness=ie,oe()}setLayers(Q,ie,oe){this.getLayerIndex(Q,ie.scope).replace(ie.layers,ie.options),oe()}updateLayers(Q,ie,oe){this.getLayerIndex(Q,ie.scope).update(ie.layers,ie.removedIds,ie.options),oe()}loadTile(Q,ie,oe){ie.projection=this.projections[Q]||this.defaultProjection,this.getWorkerSource(Q,ie.type,ie.source,ie.scope).loadTile(ie,oe)}loadDEMTile(Q,ie,oe){this.getDEMWorkerSource(Q,ie.source,ie.scope).loadTile(ie,oe)}decodeRasterArray(Q,ie,oe){this.getRasterArrayWorkerSource().decodeRasterArray(ie,oe)}reloadTile(Q,ie,oe){ie.projection=this.projections[Q]||this.defaultProjection,this.getWorkerSource(Q,ie.type,ie.source,ie.scope).reloadTile(ie,oe)}abortTile(Q,ie,oe){this.getWorkerSource(Q,ie.type,ie.source,ie.scope).abortTile(ie,oe)}removeTile(Q,ie,oe){this.getWorkerSource(Q,ie.type,ie.source,ie.scope).removeTile(ie,oe)}removeSource(Q,ie,oe){if(!(this.workerSources[Q]&&this.workerSources[Q][ie.scope]&&this.workerSources[Q][ie.scope][ie.type]&&this.workerSources[Q][ie.scope][ie.type][ie.source]))return;const ye=this.workerSources[Q][ie.scope][ie.type][ie.source];delete this.workerSources[Q][ie.scope][ie.type][ie.source],ye.removeSource!==void 0?ye.removeSource(ie,oe):oe()}loadWorkerSource(Q,ie,oe){try{this.self.importScripts(ie.url),oe()}catch(ye){oe(ye.toString())}}syncRTLPluginState(Q,ie,oe){try{n.ee.setState(ie);const ye=n.ee.getPluginURL();if(n.ee.isLoaded()&&!n.ee.isParsed()&&ye!=null){this.self.importScripts(ye);const we=n.ee.isParsed();oe(we?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ye}`),we)}}catch(ye){oe(ye.toString())}}setDracoUrl(Q,ie){this.dracoUrl=ie}getAvailableImages(Q,ie){this.availableImages[Q]||(this.availableImages[Q]={});let oe=this.availableImages[Q][ie];return oe||(oe=[]),oe}getLayerIndex(Q,ie){this.layerIndexes[Q]||(this.layerIndexes[Q]={});let oe=this.layerIndexes[Q][ie];return oe||(oe=this.layerIndexes[Q][ie]=new Ie,oe.scope=ie),oe}getWorkerSource(Q,ie,oe,ye){return this.workerSources[Q]||(this.workerSources[Q]={}),this.workerSources[Q][ye]||(this.workerSources[Q][ye]={}),this.workerSources[Q][ye][ie]||(this.workerSources[Q][ye][ie]={}),this.isSpriteLoaded[Q]||(this.isSpriteLoaded[Q]={}),this.workerSources[Q][ye][ie][oe]||(this.workerSources[Q][ye][ie][oe]=new this.workerSourceTypes[ie]({send:(we,De,Ve,Oe,Ze,He)=>{this.actor.send(we,De,Ve,Q,Ze,He)},scheduler:this.actor.scheduler},this.getLayerIndex(Q,ye),this.getAvailableImages(Q,ye),this.isSpriteLoaded[Q][ye],void 0,this.brightness)),this.workerSources[Q][ye][ie][oe]}rasterizeImages(Q,ie,oe){const{imageTasks:ye,scope:we}=ie,De={};for(const Ve in ye){const{image:Oe,imageIdWithOptions:Ze}=ye[Ve];De[Ve]=this.imageRasterizer.rasterize(Ze,Oe,we,Q)}oe(void 0,De)}removeRasterizedImages(Q,ie,oe){const{imageIds:ye,scope:we}=ie;this.imageRasterizer.removeImagesFromCacheByIds(ye,we,Q),oe()}getDEMWorkerSource(Q,ie,oe){return this.demWorkerSources[Q]||(this.demWorkerSources[Q]={}),this.demWorkerSources[Q][oe]||(this.demWorkerSources[Q][oe]={}),this.demWorkerSources[Q][oe][ie]||(this.demWorkerSources[Q][oe][ie]=new kt),this.demWorkerSources[Q][oe][ie]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new li),this.rasterArrayWorkerSource}enforceCacheSizeLimit(Q,ie){n.ef(ie)}getWorkerPerformanceMetrics(Q,ie,oe){oe(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Ls(self)),Ls}),j(["./shared"],function(n){var ae="3.10.0";const ne={create:"create",load:"load",fullLoad:"fullLoad"},ge={mark(c){performance.mark(c)},measure(c,t,r){performance.measure(c,t,r)}};function Ie(c){const t=c.name.split("?")[0];return n.a(t)&&t.includes("mapbox-gl.js")?"javascript":n.a(t)&&t.includes("mapbox-gl.css")?"css":n.b(t)?"fontRange":n.c(t)?"sprite":n.i(t)?"style":n.d(t)?"tilejson":"other"}var Re,je={},Qe=function(){if(Re)return je;function c(u){return!t(u)}function t(u){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var _,b,C=new Blob([""],{type:"text/javascript"}),O=URL.createObjectURL(C);try{b=new Worker(O),_=!0}catch{_=!1}return b&&b.terminate(),URL.revokeObjectURL(O),_}()?function(){var _=document.createElement("canvas");_.width=_.height=1;var b=_.getContext("2d");if(!b)return!1;var C=b.getImageData(0,0,1,1);return C&&C.width===_.width}()?(r[p=u&&u.failIfMajorPerformanceCaveat]===void 0&&(r[p]=function(_){var b,C=function(O){var P=document.createElement("canvas"),F=Object.create(c.webGLContextAttributes);return F.failIfMajorPerformanceCaveat=O,P.getContext("webgl2",F)}(_);if(!C)return!1;try{b=C.createShader(C.VERTEX_SHADER)}catch{return!1}return!(!b||C.isContextLost())&&(C.shaderSource(b,"void main() {}"),C.compileShader(b),C.getShaderParameter(b,C.COMPILE_STATUS)===!0)}(p)),r[p]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var p}Re=1,je.supported=c,je.notSupportedReason=t;var r={};return c.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},je}();function tt(c,t,r){const u=document.createElement(c);return t!=null&&(u.className=t),r&&r.appendChild(u),u}function pt(c,t,r){const u=document.createElementNS("http://www.w3.org/2000/svg",c);for(const p of Object.keys(t))u.setAttributeNS(null,p,String(t[p]));return r&&r.appendChild(u),u}const $e=typeof document<"u"?document.documentElement&&document.documentElement.style:null,Et=$e&&$e.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Tt;function Mt(){$e&&Et&&(Tt=$e[Et],$e[Et]="none")}function Ft(){$e&&Et&&($e[Et]=Tt)}function ni(c){c.preventDefault(),c.stopPropagation(),window.removeEventListener("click",ni,!0)}function qt(){window.addEventListener("click",ni,!0),window.setTimeout(()=>{window.removeEventListener("click",ni,!0)},0)}function Fi(c,t){const r=c.getBoundingClientRect();return li(c,r,t)}function ai(c,t){const r=c.getBoundingClientRect(),u=[];for(let p=0;p<t.length;p++)u.push(li(c,r,t[p]));return u}function kt(c){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&c.button===2&&c.ctrlKey?0:c.button}function li(c,t,r){const u=c.offsetWidth===t.width?1:c.offsetWidth/t.width;return new n.P((r.clientX-t.left)*u,(r.clientY-t.top)*u)}const bn="01",Dr="NO_ACCESS_TOKEN";class wn{constructor(t,r,u){this._transformRequestFn=t,this._customAccessToken=r,this._silenceAuthErrors=!!u,this._createSkuToken()}_createSkuToken(){const t=function(){let r="";for(let u=0;u<10;u++)r+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",bn,r].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,r){return this._transformRequestFn&&this._transformRequestFn(t,r)||{url:t}}normalizeStyleURL(t,r){if(!n.f(t))return t;const u=ii(t);return u.params.push(`sdk=js-${ae}`),u.path=`/styles/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||r)}normalizeGlyphsURL(t,r){if(!n.f(t))return t;const u=ii(t);return u.path=`/fonts/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||r)}normalizeModelURL(t,r){if(!n.f(t))return t;const u=ii(t);return u.path=`/models/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||r)}normalizeSourceURL(t,r,u,p){if(!n.f(t))return t;const _=ii(t);return _.path=`/v4/${_.authority}.json`,_.params.push("secure"),u&&_.params.push(`language=${u}`),p&&_.params.push(`worldview=${p}`),this._makeAPIURL(_,this._customAccessToken||r)}normalizeIconsetURL(t,r){const u=ii(t);return n.f(t)?(u.path=`/styles/v1${u.path}/iconset.pbf`,this._makeAPIURL(u,this._customAccessToken||r)):Xi(u)}normalizeSpriteURL(t,r,u,p){const _=ii(t);return n.f(t)?(_.path=`/styles/v1${_.path}/sprite${r}${u}`,this._makeAPIURL(_,this._customAccessToken||p)):(_.path+=`${r}${u}`,Xi(_))}normalizeTileURL(t,r,u){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!n.f(t))return t;const p=ii(t);p.path=p.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${r||u&&p.authority!=="raster"&&u===512?"@2x":""}${n.m.supported?".webp":"$1"}`),p.authority==="raster"?p.path=`/${n.e.RASTER_URL_PREFIX}${p.path}`:p.authority==="rasterarrays"?p.path=`/${n.e.RASTERARRAYS_URL_PREFIX}${p.path}`:p.authority==="3dtiles"?p.path=`/${n.e.TILES3D_URL_PREFIX}${p.path}`:(p.path=p.path.replace(/^.+\/v4\//,"/"),p.path=`/${n.e.TILE_URL_VERSION}${p.path}`);const _=this._customAccessToken||function(b){for(const C of b){const O=C.match(/^access_token=(.*)$/);if(O)return O[1]}return null}(p.params)||n.e.ACCESS_TOKEN;return n.e.REQUIRE_ACCESS_TOKEN&&_&&this._skuToken&&p.params.push(`sku=${this._skuToken}`),this._makeAPIURL(p,_)}canonicalizeTileURL(t,r){const u=ii(t);if(!u.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!u.path.match(/\.[\w]+$/))return t;let p="mapbox://";u.path.match(/^\/raster\/v1\//)?p+=`raster/${u.path.replace(`/${n.e.RASTER_URL_PREFIX}/`,"")}`:u.path.match(/^\/rasterarrays\/v1\//)?p+=`rasterarrays/${u.path.replace(`/${n.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:p+=`tiles/${u.path.replace(`/${n.e.TILE_URL_VERSION}/`,"")}`;let _=u.params;return r&&(_=_.filter(b=>!b.match(/^access_token=/))),_.length&&(p+=`?${_.join("&")}`),p}canonicalizeTileset(t,r){const u=!!r&&n.f(r),p=[];for(const _ of t.tiles||[])n.h(_)?p.push(this.canonicalizeTileURL(_,u)):p.push(_);return p}_makeAPIURL(t,r){const u="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",p=ii(n.e.API_URL);if(t.protocol=p.protocol,t.authority=p.authority,t.protocol==="http"){const _=t.params.indexOf("secure");_>=0&&t.params.splice(_,1)}if(p.path!=="/"&&(t.path=`${p.path}${t.path}`),!n.e.REQUIRE_ACCESS_TOKEN)return Xi(t);if(r=r||n.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!r)throw new Error(`An API access token is required to use Mapbox GL. ${u}`);if(r[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${u}`)}return t.params=t.params.filter(_=>_.indexOf("access_token")===-1),t.params.push(`access_token=${r||""}`),Xi(t)}}const gi=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ii(c){const t=c.match(gi);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function Xi(c){const t=c.params.length?`?${c.params.join("&")}`:"";return`${c.protocol}://${c.authority}${c.path}${t}`}const Bi="mapbox.eventData";function ti(c){if(!c)return null;const t=c.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(n.j(t[1]))}catch{return null}}class et{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const r=ti(n.e.ACCESS_TOKEN);let u="";return u=r&&r.u?n.k(r.u):n.e.ACCESS_TOKEN||"",t?`${Bi}.${t}:${u}`:`${Bi}:${u}`}fetchEventData(){const t=n.s("localStorage"),r=this.getStorageKey(),u=this.getStorageKey("uuid");if(t)try{const p=localStorage.getItem(r);p&&(this.eventData=JSON.parse(p));const _=localStorage.getItem(u);_&&(this.anonId=_)}catch{n.w("Unable to read from LocalStorage")}}saveEventData(){const t=n.s("localStorage"),r=this.getStorageKey(),u=this.getStorageKey("uuid"),p=this.anonId;if(t&&p)try{localStorage.setItem(u,p),Object.keys(this.eventData).length>=1&&localStorage.setItem(r,JSON.stringify(this.eventData))}catch{n.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,r,u,p){if(!n.e.EVENTS_URL)return;const _=ii(n.e.EVENTS_URL);_.params.push(`access_token=${p||n.e.ACCESS_TOKEN||""}`);const b={event:this.type,created:new Date(t).toISOString()},C=r?n.l(b,r):b,O={url:Xi(_),headers:{"Content-Type":"text/plain"},body:JSON.stringify([C])};this.pendingRequest=n.p(O,P=>{this.pendingRequest=null,u(P),this.saveEventData(),this.processRequests(p)})}queueRequest(t,r){this.queue.push(t),this.processRequests(r)}}const Kt=new class extends et{constructor(c){super("appUserTurnstile"),this._customAccessToken=c}postTurnstileEvent(c,t){n.e.EVENTS_URL&&n.e.ACCESS_TOKEN&&Array.isArray(c)&&c.some(r=>n.f(r)||n.h(r))&&this.queueRequest(Date.now(),t)}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=ti(n.e.ACCESS_TOKEN),r=t?t.u:n.e.ACCESS_TOKEN;let u=r!==this.eventData.tokenU;n.v(this.anonId)||(this.anonId=n.u(),u=!0);const p=this.queue.shift();if(this.eventData.lastSuccess){const _=new Date(this.eventData.lastSuccess),b=new Date(p),C=(p-this.eventData.lastSuccess)/864e5;u=u||C>=1||C<-1||_.getDate()!==b.getDate()}else u=!0;u?this.postEvent(p,{sdkIdentifier:"mapbox-gl-js",sdkVersion:ae,skuId:bn,"enabled.telemetry":!1,userId:this.anonId},_=>{_||(this.eventData.lastSuccess=p,this.eventData.tokenU=r)},c):this.processRequests()}},Di=Kt.postTurnstileEvent.bind(Kt),Nt=new class extends et{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(c,t,r,u){this.skuToken=t,this.errorCb=u,n.e.EVENTS_URL&&(r||n.e.ACCESS_TOKEN?this.queueRequest({id:c,timestamp:Date.now()},r):this.errorCb(new Error(Dr)))}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:r}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),n.v(this.anonId)||(this.anonId=n.u()),this.postEvent(r,{sdkIdentifier:"mapbox-gl-js",sdkVersion:ae,skuId:bn,skuToken:this.skuToken,userId:this.anonId},u=>{u?this.errorCb(u):t&&(this.success[t]=!0)},c))}remove(){this.errorCb=null}},wi=Nt.postMapLoadEvent.bind(Nt),_r=new class extends et{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(c){let t=this.mapInstanceIdMap.get(c);return t||(t=n.u(),this.mapInstanceIdMap.set(c,t)),t}getEventId(c){const t=this.eventIdPerMapInstanceMap.get(c)||0;return this.eventIdPerMapInstanceMap.set(c,t+1),t}postStyleLoadEvent(c,t){const{map:r,style:u,importedStyles:p}=t;if(!n.e.EVENTS_URL||!c&&!n.e.ACCESS_TOKEN)return;const _=this.getMapInstanceId(r),b={mapInstanceId:_,eventId:this.getEventId(_),style:u};p.length&&(b.importedStyles=p),this.queueRequest({timestamp:Date.now(),payload:b},c)}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:r}=this.queue.shift();this.postEvent(t,r,()=>{},c)}},lr=_r.postStyleLoadEvent.bind(_r),Cn=new class extends et{constructor(){super("gljs.performance")}postPerformanceEvent(c,t){n.e.EVENTS_URL&&(c||n.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},c)}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:r}=this.queue.shift(),u=function(p){const _=performance.getEntriesByType("resource"),b=performance.getEntriesByType("mark"),C=function(H){const J={};if(H){for(const $ in H)if($!=="other")for(const te of H[$]){const ee=`${$}ResolveRangeMin`,le=`${$}ResolveRangeMax`,pe=`${$}RequestCount`,fe=`${$}RequestCachedCount`;J[ee]=Math.min(J[ee]||1/0,te.startTime),J[le]=Math.max(J[le]||-1/0,te.responseEnd);const be=me=>{J[me]===void 0&&(J[me]=0),++J[me]};te.transferSize!==void 0&&te.transferSize===0&&be(fe),be(pe)}}return J}(function(H,J){const $={};if(H)for(const te of H){const ee=J(te);$[ee]===void 0&&($[ee]=[]),$[ee].push(te)}return $}(_,Ie)),O=window.devicePixelRatio,P=navigator.connection||navigator.mozConnection||navigator.webkitConnection,F=P?P.effectiveType:void 0,V={counters:[],metadata:[],attributes:[]},U=(H,J,$)=>{$!=null&&H.push({name:J,value:$.toString()})};for(const H in C)U(V.counters,H,C[H]);if(p.interactionRange[0]!==1/0&&p.interactionRange[1]!==-1/0&&(U(V.counters,"interactionRangeMin",p.interactionRange[0]),U(V.counters,"interactionRangeMax",p.interactionRange[1])),b)for(const H of Object.keys(ne)){const J=ne[H],$=b.find(te=>te.name===J);$&&U(V.counters,J,$.startTime)}return U(V.counters,"visibilityHidden",p.visibilityHidden),U(V.attributes,"style",function(H){if(H)for(const J of H){const $=J.name.split("?")[0];if(n.i($)){const te=$.split("/").slice(-2);if(te.length===2)return`mapbox://styles/${te[0]}/${te[1]}`}}}(_)),U(V.attributes,"terrainEnabled",p.terrainEnabled?"true":"false"),U(V.attributes,"fogEnabled",p.fogEnabled?"true":"false"),U(V.attributes,"projection",p.projection),U(V.attributes,"zoom",p.zoom),U(V.metadata,"devicePixelRatio",O),U(V.metadata,"connectionEffectiveType",F),U(V.metadata,"navigatorUserAgent",navigator.userAgent),U(V.metadata,"screenWidth",window.screen.width),U(V.metadata,"screenHeight",window.screen.height),U(V.metadata,"windowWidth",window.innerWidth),U(V.metadata,"windowHeight",window.innerHeight),U(V.metadata,"mapWidth",p.width/O),U(V.metadata,"mapHeight",p.height/O),U(V.metadata,"webglRenderer",p.renderer),U(V.metadata,"webglVendor",p.vendor),U(V.metadata,"sdkVersion",ae),U(V.metadata,"sdkIdentifier","mapbox-gl-js"),V}(r);for(const p of u.metadata);for(const p of u.counters);for(const p of u.attributes);this.postEvent(t,u,()=>{},c)}},gr=Cn.postPerformanceEvent.bind(Cn),nn=new class extends et{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(c,t,r,u){if(!n.e.API_URL||!n.e.SESSION_PATH)return;const p=ii(n.e.API_URL+n.e.SESSION_PATH);p.params.push(`sku=${t||""}`),p.params.push(`access_token=${u||n.e.ACCESS_TOKEN||""}`);const _={url:Xi(p),headers:{"Content-Type":"text/plain"}};this.pendingRequest=n.g(_,b=>{this.pendingRequest=null,r(b),this.saveEventData(),this.processRequests(u)})}getSessionAPI(c,t,r,u){this.skuToken=t,this.errorCb=u,n.e.SESSION_PATH&&n.e.API_URL&&(r||n.e.ACCESS_TOKEN?this.queueRequest({id:c,timestamp:Date.now()},r):this.errorCb(new Error(Dr)))}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:r}=this.queue.shift();t&&this.success[t]||this.getSession(r,this.skuToken,u=>{u?this.errorCb(u):t&&(this.success[t]=!0)},c)}remove(){this.errorCb=null}},Ae=nn.getSessionAPI.bind(nn),Ea=new Set;function to(c,t){t?Ea.add(c):Ea.delete(c)}class Pa{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,r){this._updatedSourceCaches[t]=r,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const r=t.scope;this._updatedLayers[r]=this._updatedLayers[r]||new Set,this._updatedLayers[r].add(t.id),this.setDirty()}removeLayer(t){const r=t.scope;this._removedLayers[r]=this._removedLayers[r]||{},this._updatedLayers[r]=this._updatedLayers[r]||new Set,this._removedLayers[r][t.id]=t,this._updatedLayers[r].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const r in this._updatedLayers)t[r]=t[r]||{},t[r].updatedIds=Array.from(this._updatedLayers[r].values());for(const r in this._removedLayers)t[r]=t[r]||{},t[r].removedIds=Object.keys(this._removedLayers[r]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(t){this._updatedImages.add(t),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}function Rt(c){const{userImage:t}=c;return!!(t&&t.render&&t.render())&&(c.data.replace(new Uint8Array(t.data.buffer)),!0)}class kn extends n.E{constructor(t){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0,this.spriteFormat=t,t!=="raster"&&n.t()&&(this.imageRasterizerDispatcher=new n.D(n.x(),this,"Image Rasterizer Worker",1))}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new n.I),this._imageRasterizer}createScope(t){this.images[t]={},this.loaded[t]=!1,this.updatedImages[t]={},this.patterns[t]={},this.callbackDispatchedThisFrame[t]={},this.atlasImage[t]=new n.r({width:1,height:1})}isLoaded(){for(const t in this.loaded)if(!this.loaded[t])return!1;return!0}setLoaded(t,r){if(this.loaded[r]!==t&&(this.loaded[r]=t,t)){for(const{ids:u,callback:p}of this.requestors)this._notify(u,r,p);this.requestors=[]}}hasImage(t,r){return!!this.getImage(t,r)}getImage(t,r){return this.images[r][t]}addImage(t,r,u){this._validate(t,u)&&(this.images[r][t]=u)}_validate(t,r){let u=!0;return this._validateStretch(r.stretchX,r.data&&r.data.width)||(this.fire(new n.y(new Error(`Image "${t}" has invalid "stretchX" value`))),u=!1),this._validateStretch(r.stretchY,r.data&&r.data.height)||(this.fire(new n.y(new Error(`Image "${t}" has invalid "stretchY" value`))),u=!1),this._validateContent(r.content,r)||(this.fire(new n.y(new Error(`Image "${t}" has invalid "content" value`))),u=!1),u}_validateStretch(t,r){if(!t)return!0;let u=0;for(const p of t){if(p[0]<u||p[1]<p[0]||r<p[1])return!1;u=p[1]}return!0}_validateContent(t,r){return t?t.length!==4||!r.usvg&&(t[0]<0||r.data.width<t[0]||t[1]<0||r.data.height<t[1]||t[2]<0||r.data.width<t[2]||t[3]<0||r.data.height<t[3])?!1:!(t[2]<t[0]||t[3]<t[1]):!0}updateImage(t,r,u){u.version=this.images[r][t].version+1,this.images[r][t]=u,this.updatedImages[r][t]=!0,this.removeFromImageRasterizerCache(t,r)}removeFromImageRasterizerCache(t,r){this.spriteFormat!=="raster"&&(n.t()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[t],scope:r}):this.imageRasterizer.removeImagesFromCacheByIds([t],r))}removeImage(t,r){const u=this.images[r][t];delete this.images[r][t],delete this.patterns[r][t],this.removeFromImageRasterizerCache(t,r),u.userImage&&u.userImage.onRemove&&u.userImage.onRemove()}listImages(t){return Object.keys(this.images[t])}getImages(t,r,u){let p=!0;const _=!!this.loaded[r];if(!_)for(const b of t)this.images[r][b]||(p=!1);_||p?this._notify(t,r,u):this.requestors.push({ids:t,scope:r,callback:u})}rasterizeImages({scope:t,imageTasks:r},u){const p={};for(const _ in r){const b=r[_],C=this.getImage(b.id,t);C&&(p[_]={image:C,imageIdWithOptions:b})}n.t()?this.imageRasterizerDispatcher.getActor().send("rasterizeImages",{imageTasks:p,scope:t},u):this.rasterizeImagesInMainThread({imageTasks:p,scope:t},u)}rasterizeImagesInMainThread(t,r){const{imageTasks:u,scope:p}=t,_={};for(const b in u){const{image:C,imageIdWithOptions:O}=u[b];_[b]=this.imageRasterizer.rasterize(O,C,p,"")}r(void 0,_)}getUpdatedImages(t){return this.updatedImages[t]}_notify(t,r,u){const p={};for(const _ of t){this.images[r][_]||this.fire(new n.z("styleimagemissing",{id:_}));const b=this.images[r][_];b?p[_]={data:b.usvg?null:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,usvg:b.usvg,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:!!(b.userImage&&b.userImage.render)}:n.w(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}u(null,p)}getPixelSize(t){const{width:r,height:u}=this.atlasImage[t];return{width:r,height:u}}getPattern(t,r,u){const p=this.patterns[r][t],_=this.getImage(t,r);if(!_)return null;if(p&&p.position.version===_.version)return p.position;if(p)p.position.version=_.version;else{_.usvg&&!_.data&&(_.data=this.imageRasterizer.rasterize(n.A.from(t).getPrimary(),_,r,""));const b={w:_.data.width+2*n.B,h:_.data.height+2*n.B,x:0,y:0},C=new n.C(b,_,n.B);this.patterns[r][t]={bin:b,position:C}}return this._updatePatternAtlas(r,u),this.patterns[r][t].position}bind(t,r){const u=t.gl;let p=this.atlasTexture[r];p?this.dirty&&(p.update(this.atlasImage[r]),this.dirty=!1):(p=new n.T(t,this.atlasImage[r],u.RGBA8),this.atlasTexture[r]=p),p.bind(u.LINEAR,u.CLAMP_TO_EDGE)}_updatePatternAtlas(t,r){const u=[];for(const C in this.patterns[t])u.push(this.patterns[t][C].bin);const{w:p,h:_}=n.F(u),b=this.atlasImage[t];b.resize({width:p||1,height:_||1});for(const C in this.patterns[t]){const{bin:O,position:P}=this.patterns[t][C];let F=P.padding;const V=O.x+F,U=O.y+F,H=this.images[t][C].data,J=H.width,$=H.height;F=F>1?F-1:F,n.r.copy(H,b,{x:0,y:0},{x:V,y:U},{width:J,height:$},r),n.r.copy(H,b,{x:0,y:$-F},{x:V,y:U-F},{width:J,height:F},r),n.r.copy(H,b,{x:0,y:0},{x:V,y:U+$},{width:J,height:F},r),n.r.copy(H,b,{x:J-F,y:0},{x:V-F,y:U},{width:F,height:$},r),n.r.copy(H,b,{x:0,y:0},{x:V+J,y:U},{width:F,height:$},r),n.r.copy(H,b,{x:J-F,y:$-F},{x:V-F,y:U-F},{width:F,height:F},r),n.r.copy(H,b,{x:0,y:$-F},{x:V+J,y:U-F},{width:F,height:F},r),n.r.copy(H,b,{x:0,y:0},{x:V+J,y:U+$},{width:F,height:F},r),n.r.copy(H,b,{x:J-F,y:0},{x:V-F,y:U+$},{width:F,height:F},r)}this.dirty=!0}beginFrame(){for(const t in this.images)this.callbackDispatchedThisFrame[t]={}}dispatchRenderCallbacks(t,r){for(const u of t){if(this.callbackDispatchedThisFrame[r][u])continue;this.callbackDispatchedThisFrame[r][u]=!0;const p=this.images[r][u];Rt(p)&&this.updateImage(u,r,p)}}}function Dn(c){const t=c.key,r=c.value,u=c.valueSpec||{},p=c.objectElementValidators||{},_=c.style,b=c.styleSpec;let C=[];const O=n.H(r);if(O!=="object")return[new n.V(t,r,`object expected, ${O} found`)];for(const P in r){const F=P.split(".")[0];let V;p[F]?V=p[F]:u[F]?V=Ri:p["*"]?V=p["*"]:u["*"]&&(V=Ri),V?C=C.concat(V({key:(t&&`${t}.`)+P,value:r[P],valueSpec:u[F]||u["*"],style:_,styleSpec:b,object:r,objectKey:P},r)):C.push(new n.G(t,r[P],`unknown property "${P}"`))}for(const P in u)p[P]||u[P].required&&u[P].default===void 0&&r[P]===void 0&&C.push(new n.V(t,r,`missing required property "${P}"`));return C}function Jo(c){const t=c.value,r=c.valueSpec,u=c.style,p=c.styleSpec,_=c.key,b=c.arrayElementValidator||Ri;if(n.H(t)!=="array")return[new n.V(_,t,`array expected, ${n.H(t)} found`)];if(r.length&&t.length!==r.length)return[new n.V(_,t,`array length ${r.length} expected, length ${t.length} found`)];if(r["min-length"]&&t.length<r["min-length"])return[new n.V(_,t,`array length at least ${r["min-length"]} expected, length ${t.length} found`)];let C={type:r.value,values:r.values,minimum:r.minimum,maximum:r.maximum,function:void 0};p.$version<7&&(C.function=r.function),n.H(r.value)==="object"&&(C=r.value);let O=[];for(let P=0;P<t.length;P++)O=O.concat(b({array:t,arrayIndex:P,value:t[P],valueSpec:C,style:u,styleSpec:p,key:`${_}[${P}]`},!0));return O}function Yi(c){const t=c.key,r=c.value,u=c.valueSpec;let p=n.H(r);if(p==="number"&&r!=r&&(p="NaN"),p!=="number")return[new n.V(t,r,`number expected, ${p} found`)];if("minimum"in u){let _=u.minimum;if(n.H(u.minimum)==="array"&&(_=u.minimum[c.arrayIndex]),r<_)return[new n.V(t,r,`${r} is less than the minimum value ${_}`)]}if("maximum"in u){let _=u.maximum;if(n.H(u.maximum)==="array"&&(_=u.maximum[c.arrayIndex]),r>_)return[new n.V(t,r,`${r} is greater than the maximum value ${_}`)]}return[]}function Tn(c){const t=c.valueSpec,r=n.K(c.value.type);let u,p,_,b={};const C=r!=="categorical"&&c.value.property===void 0,O=!C,P=n.H(c.value.stops)==="array"&&n.H(c.value.stops[0])==="array"&&n.H(c.value.stops[0][0])==="object",F=Dn({key:c.key,value:c.value,valueSpec:c.styleSpec.function,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{stops:function(H){if(r==="identity")return[new n.V(H.key,H.value,'identity function may not have a "stops" property')];let J=[];const $=H.value;return J=J.concat(Jo({key:H.key,value:$,valueSpec:H.valueSpec,style:H.style,styleSpec:H.styleSpec,arrayElementValidator:V})),n.H($)==="array"&&$.length===0&&J.push(new n.V(H.key,$,"array must have at least one stop")),J},default:function(H){return Ri({key:H.key,value:H.value,valueSpec:t,style:H.style,styleSpec:H.styleSpec})}}});return r==="identity"&&C&&F.push(new n.V(c.key,c.value,'missing required property "property"')),r==="identity"||c.value.stops||F.push(new n.V(c.key,c.value,'missing required property "stops"')),r==="exponential"&&c.valueSpec.expression&&!n.L(c.valueSpec)&&F.push(new n.V(c.key,c.value,"exponential functions not supported")),c.styleSpec.$version>=8&&(O&&!n.M(c.valueSpec)?F.push(new n.V(c.key,c.value,"property functions not supported")):C&&!n.N(c.valueSpec)&&F.push(new n.V(c.key,c.value,"zoom functions not supported"))),r!=="categorical"&&!P||c.value.property!==void 0||F.push(new n.V(c.key,c.value,'"property" property is required')),F;function V(H){let J=[];const $=H.value,te=H.key;if(n.H($)!=="array")return[new n.V(te,$,`array expected, ${n.H($)} found`)];if($.length!==2)return[new n.V(te,$,`array length 2 expected, length ${$.length} found`)];if(P){if(n.H($[0])!=="object")return[new n.V(te,$,`object expected, ${n.H($[0])} found`)];if($[0].zoom===void 0)return[new n.V(te,$,"object stop key must have zoom")];if($[0].value===void 0)return[new n.V(te,$,"object stop key must have value")];const ee=n.K($[0].zoom);if(typeof ee!="number")return[new n.V(te,$[0].zoom,"stop zoom values must be numbers")];if(_&&_>ee)return[new n.V(te,$[0].zoom,"stop zoom values must appear in ascending order")];ee!==_&&(_=ee,p=void 0,b={}),J=J.concat(Dn({key:`${te}[0]`,value:$[0],valueSpec:{zoom:{}},style:H.style,styleSpec:H.styleSpec,objectElementValidators:{zoom:Yi,value:U}}))}else J=J.concat(U({key:`${te}[0]`,value:$[0],style:H.style,styleSpec:H.styleSpec},$));return n.O(n.Q($[1]))?J.concat([new n.V(`${te}[1]`,$[1],"expressions are not allowed in function stops.")]):J.concat(Ri({key:`${te}[1]`,value:$[1],valueSpec:t,style:H.style,styleSpec:H.styleSpec}))}function U(H,J){const $=n.H(H.value),te=n.K(H.value),ee=H.value!==null?H.value:J;if(u){if($!==u)return[new n.V(H.key,ee,`${$} stop domain type must match previous stop domain type ${u}`)]}else u=$;if($!=="number"&&$!=="string"&&$!=="boolean"&&typeof te!="number"&&typeof te!="string"&&typeof te!="boolean")return[new n.V(H.key,ee,"stop domain value must be a number, string, or boolean")];if($!=="number"&&r!=="categorical"){let le=`number expected, ${$} found`;return n.M(t)&&r===void 0&&(le+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new n.V(H.key,ee,le)]}return r!=="categorical"||$!=="number"||typeof te=="number"&&isFinite(te)&&Math.floor(te)===te?r!=="categorical"&&$==="number"&&typeof te=="number"&&typeof p=="number"&&p!==void 0&&te<p?[new n.V(H.key,ee,"stop domain values must appear in ascending order")]:(p=te,r==="categorical"&&te in b?[new n.V(H.key,ee,"stop domain values must be unique")]:(b[te]=!0,[])):[new n.V(H.key,ee,`integer expected, found ${String(te)}`)]}}function ka(c){const t=(c.expressionContext==="property"?n.S:n.U)(n.Q(c.value),c.valueSpec);if(t.result==="error")return t.value.map(u=>new n.V(`${c.key}${u.key}`,c.value,u.message));const r=t.value.expression||t.value._styleExpression.expression;if(c.expressionContext==="property"&&c.propertyKey==="text-font"&&!r.outputDefined())return[new n.V(c.key,c.value,`Invalid data expression for "${c.propertyKey}". Output values must be contained as literals within the expression.`)];if(c.expressionContext==="property"&&c.propertyType==="layout"&&!n.W(r))return[new n.V(c.key,c.value,'"feature-state" data expressions are not supported with layout properties.')];if(c.expressionContext==="filter")return io(r,c);if(c.expressionContext&&c.expressionContext.indexOf("cluster")===0){if(!n.X(r,["zoom","feature-state"]))return[new n.V(c.key,c.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(c.expressionContext==="cluster-initial"&&!n.Y(r))return[new n.V(c.key,c.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function io(c,t){const r=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const p of t.valueSpec.expression.parameters)r.delete(p);if(r.size===0)return[];const u=[];return c instanceof n.Z&&r.has(c.name)?[new n.V(t.key,t.value,`["${c.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(c.eachChild(p=>{u.push(...io(p,t))}),u)}function Gl(c){const t=c.key,r=c.value,u=c.valueSpec,p=[];return Array.isArray(u.values)?u.values.indexOf(n.K(r))===-1&&p.push(new n.V(t,r,`expected one of [${u.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(u.values).indexOf(n.K(r))===-1&&p.push(new n.V(t,r,`expected one of [${Object.keys(u.values).join(", ")}], ${JSON.stringify(r)} found`)),p}function Hl(c){return n.$(n.Q(c.value))?ka(n.J({},c,{expressionContext:"filter",valueSpec:c.styleSpec[`filter_${c.layerType||"fill"}`]})):Mi(c)}function Mi(c){const t=c.value,r=c.key;if(n.H(t)!=="array")return[new n.V(r,t,`array expected, ${n.H(t)} found`)];const u=c.styleSpec;let p,_=[];if(t.length<1)return[new n.V(r,t,"filter array must have at least 1 element")];switch(_=_.concat(Gl({key:`${r}[0]`,value:t[0],valueSpec:u.filter_operator,style:c.style,styleSpec:c.styleSpec})),n.K(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&n.K(t[1])==="$type"&&_.push(new n.V(r,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&_.push(new n.V(r,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(p=n.H(t[1]),p!=="string"&&_.push(new n.V(`${r}[1]`,t[1],`string expected, ${p} found`)));for(let b=2;b<t.length;b++)p=n.H(t[b]),n.K(t[1])==="$type"?_=_.concat(Gl({key:`${r}[${b}]`,value:t[b],valueSpec:u.geometry_type,style:c.style,styleSpec:c.styleSpec})):p!=="string"&&p!=="number"&&p!=="boolean"&&_.push(new n.V(`${r}[${b}]`,t[b],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let b=1;b<t.length;b++)_=_.concat(Mi({key:`${r}[${b}]`,value:t[b],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":p=n.H(t[1]),t.length!==2?_.push(new n.V(r,t,`filter array for "${t[0]}" operator must have 2 elements`)):p!=="string"&&_.push(new n.V(`${r}[1]`,t[1],`string expected, ${p} found`))}return _}function ro(c,t){const r=c.key,u=c.style,p=c.layer,_=c.styleSpec,b=c.value,C=c.objectKey,O=_[`${t}_${c.layerType}`];if(!O)return[];const P=C.match(/^(.*)-use-theme$/);if(t==="paint"&&P&&O[P[1]])return n.O(b)?[].concat(Ri({key:c.key,value:b,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:u,styleSpec:_,expressionContext:"property",propertyType:t,propertyKey:C})):Ri({key:r,value:b,valueSpec:{type:"string"},style:u,styleSpec:_});const F=C.match(/^(.*)-transition$/);if(t==="paint"&&F&&O[F[1]]&&O[F[1]].transition)return Ri({key:r,value:b,valueSpec:_.transition,style:u,styleSpec:_});const V=c.valueSpec||O[C];if(!V)return[new n.G(r,b,`unknown property "${C}"`)];let U;if(n.H(b)==="string"&&n.M(V)&&!V.tokens&&(U=/^{([^}]+)}$/.exec(b))){const J=`\`{ "type": "identity", "property": ${U?JSON.stringify(U[1]):'"_"'} }\``;return[new n.V(r,b,`"${C}" does not support interpolation syntax
Use an identity property function instead: ${J}.`)]}const H=[];if(c.layerType==="symbol")C!=="text-field"||!u||u.glyphs||u.imports||H.push(new n.V(r,b,'use of "text-field" requires a style "glyphs" property')),C==="text-font"&&n.a0(n.Q(b))&&n.K(b.type)==="identity"&&H.push(new n.V(r,b,'"text-font" does not support identity functions'));else if(c.layerType==="model"&&t==="paint"&&p&&p.layout&&p.layout.hasOwnProperty("model-id")&&n.M(V)&&(n.a1(V)||n.N(V))){const J=n.S(n.Q(b),V),$=J.value.expression||J.value._styleExpression.expression;$&&!n.X($,["measure-light"])&&(C==="model-emissive-strength"&&n.Y($)&&n.W($)||H.push(new n.V(r,b,`${C} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return H.concat(Ri({key:c.key,value:b,valueSpec:V,style:u,styleSpec:_,expressionContext:"property",propertyType:t,propertyKey:C}))}function us(c){return ro(c,"paint")}function wo(c){return ro(c,"layout")}function Fn(c){let t=[];const r=c.value,u=c.key,p=c.style,_=c.styleSpec;r.type||r.ref||t.push(new n.V(u,r,'either "type" or "ref" is required'));let b=n.K(r.type);const C=n.K(r.ref);if(r.id){const O=n.K(r.id);for(let P=0;P<c.arrayIndex;P++){const F=p.layers[P];n.K(F.id)===O&&t.push(new n.V(u,r.id,`duplicate layer id "${r.id}", previously used at line ${F.id.__line__}`))}}if("ref"in r){let O;["type","source","source-layer","filter","layout"].forEach(P=>{P in r&&t.push(new n.V(u,r[P],`"${P}" is prohibited for ref layers`))}),p.layers.forEach(P=>{n.K(P.id)===C&&(O=P)}),O?O.ref?t.push(new n.V(u,r.ref,"ref cannot reference another ref layer")):b=n.K(O.type):typeof C=="string"&&t.push(new n.V(u,r.ref,`ref layer "${C}" not found`))}else if(b!=="background"&&b!=="sky"&&b!=="slot")if(r.source){const O=p.sources&&p.sources[r.source],P=O&&n.K(O.type);O?P==="vector"&&b==="raster"?t.push(new n.V(u,r.source,`layer "${r.id}" requires a raster source`)):P==="raster"&&b!=="raster"?t.push(new n.V(u,r.source,`layer "${r.id}" requires a vector source`)):P!=="vector"||r["source-layer"]?P==="raster-dem"&&b!=="hillshade"?t.push(new n.V(u,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):P!=="raster-array"||["raster","raster-particle"].includes(b)?b!=="line"||!r.paint||!r.paint["line-gradient"]&&!r.paint["line-trim-offset"]||P==="geojson"&&O.lineMetrics?b==="raster-particle"&&P!=="raster-array"&&t.push(new n.V(u,r.source,`layer "${r.id}" requires a 'raster-array' source.`)):t.push(new n.V(u,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new n.V(u,r.source,"raster-array source can only be used with layer type 'raster'.")):t.push(new n.V(u,r,`layer "${r.id}" must specify a "source-layer"`)):t.push(new n.V(u,r.source,`source "${r.source}" not found`))}else t.push(new n.V(u,r,'missing required property "source"'));return t=t.concat(Dn({key:u,value:r,valueSpec:_.layer,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Ri({key:`${u}.type`,value:r.type,valueSpec:_.layer.type,style:c.style,styleSpec:c.styleSpec,object:r,objectKey:"type"}),filter:O=>Hl(n.J({layerType:b},O)),layout:O=>Dn({layer:r,key:O.key,value:O.value,valueSpec:{},style:O.style,styleSpec:O.styleSpec,objectElementValidators:{"*":P=>wo(n.J({layerType:b},P))}}),paint:O=>Dn({layer:r,key:O.key,value:O.value,valueSpec:{},style:O.style,styleSpec:O.styleSpec,objectElementValidators:{"*":P=>us(n.J({layerType:b,layer:r},P))}})}})),t}function To(c){const t=c.value,r=c.key,u=n.H(t);return u!=="string"?[new n.V(r,t,`string expected, ${u} found`)]:[]}const el={promoteId:function c({key:t,value:r}){if(n.H(r)==="string")return To({key:t,value:r});if(Array.isArray(r)){const u=[],p=n.Q(r),_=n.U(p);return _.result==="error"&&_.value.forEach(b=>{u.push(new n.V(`${t}${b.key}`,null,`${b.message}`))}),n.X(_.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||u.push(new n.V(`${t}`,null,"promoteId expression should be only feature dependent")),u}{const u=[];for(const p in r)u.push(...c({key:`${t}.${p}`,value:r[p]}));return u}}};function zc(c){const t=c.value,r=c.key,u=c.styleSpec,p=c.style;if(!t.type)return[new n.V(r,t,'"type" is required')];const _=n.K(t.type);let b=[];switch(["vector","raster","raster-dem","raster-array"].includes(_)&&(t.url||t.tiles||b.push(new n.G(r,t,'Either "url" or "tiles" is required.'))),_){case"vector":case"raster":case"raster-dem":case"raster-array":return b=b.concat(Dn({key:r,value:t,valueSpec:u[`source_${_.replace("-","_")}`],style:c.style,styleSpec:u,objectElementValidators:el})),b;case"geojson":if(b=Dn({key:r,value:t,valueSpec:u.source_geojson,style:p,styleSpec:u,objectElementValidators:el}),t.cluster)for(const C in t.clusterProperties){const[O,P]=t.clusterProperties[C],F=typeof O=="string"?[O,["accumulated"],["get",C]]:O;b.push(...ka({key:`${r}.${C}.map`,value:P,expressionContext:"cluster-map"})),b.push(...ka({key:`${r}.${C}.reduce`,value:F,expressionContext:"cluster-reduce"}))}return b;case"video":return Dn({key:r,value:t,valueSpec:u.source_video,style:p,styleSpec:u});case"image":return Dn({key:r,value:t,valueSpec:u.source_image,style:p,styleSpec:u});case"canvas":return[new n.V(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Gl({key:`${r}.type`,value:t.type,valueSpec:{values:Oc(u)}})}}function Oc(c){return c.source.reduce((t,r)=>{const u=c[r];return u.type.type==="enum"&&(t=t.concat(Object.keys(u.type.values))),t},[])}function Bn(c){const t=c.value,r=c.styleSpec,u=r.light,p=c.style;let _=[];const b=n.H(t);if(t===void 0)return _;if(b!=="object")return _=_.concat([new n.V("light",t,`object expected, ${b} found`)]),_;for(const C in t){const O=C.match(/^(.*)-transition$/),P=C.match(/^(.*)-use-theme$/);_=_.concat(P&&u[P[1]]?Ri({key:C,value:t[C],valueSpec:{type:"string"},style:p,styleSpec:r}):O&&u[O[1]]&&u[O[1]].transition?Ri({key:C,value:t[C],valueSpec:r.transition,style:p,styleSpec:r}):u[C]?Ri({key:C,value:t[C],valueSpec:u[C],style:p,styleSpec:r}):[new n.V(C,t[C],`unknown property "${C}"`)])}return _}function Kn(c){const t=c.value;let r=[];if(!t)return r;const u=n.H(t);if(u!=="object")return r=r.concat([new n.V("light-3d",t,`object expected, ${u} found`)]),r;const p=c.styleSpec,_=p["light-3d"],b=c.key,C=c.style,O=c.style.lights;for(const V of["type","id"])if(!(V in t))return r=r.concat([new n.V("light-3d",t,`missing property ${V} on light`)]),r;if(t.type&&O)for(let V=0;V<c.arrayIndex;V++){const U=n.K(t.type),H=O[V];n.K(H.type)===U&&r.push(new n.V(b,t.id,`duplicate light type "${t.type}", previously defined at line ${H.id.__line__}`))}const P=`properties_light_${t.type}`;if(!(P in p))return r=r.concat([new n.V("light-3d",t,`Invalid light type ${t.type}`)]),r;const F=p[P];for(const V in t)if(V==="properties"){const U=t[V],H=n.H(U);if(H!=="object")return r=r.concat([new n.V("properties",U,`object expected, ${H} found`)]),r;for(const J in U)r=r.concat(F[J]?Ri({key:J,value:U[J],valueSpec:F[J],style:C,styleSpec:p}):[new n.G(c.key,U[J],`unknown property "${J}"`)])}else{const U=V.match(/^(.*)-transition$/),H=V.match(/^(.*)-use-theme$/);r=r.concat(H&&_[H[1]]?Ri({key:V,value:t[V],valueSpec:{type:"string"},style:C,styleSpec:p}):U&&_[U[1]]&&_[U[1]].transition?Ri({key:V,value:t[V],valueSpec:p.transition,style:C,styleSpec:p}):_[V]?Ri({key:V,value:t[V],valueSpec:_[V],style:C,styleSpec:p}):[new n.G(V,t[V],`unknown property "${V}"`)])}return r}function Lc(c){const t=c.value,r=c.key,u=c.style,p=c.styleSpec,_=p.terrain;let b=[];const C=n.H(t);if(t===void 0||C==="null")return b;if(C!=="object")return b=b.concat([new n.V("terrain",t,`object expected, ${C} found`)]),b;for(const O in t){const P=O.match(/^(.*)-transition$/),F=O.match(/^(.*)-use-theme$/);b=b.concat(F&&_[F[1]]?Ri({key:O,value:t[O],valueSpec:{type:"string"},style:u,styleSpec:p}):P&&_[P[1]]&&_[P[1]].transition?Ri({key:O,value:t[O],valueSpec:p.transition,style:u,styleSpec:p}):_[O]?Ri({key:O,value:t[O],valueSpec:_[O],style:u,styleSpec:p}):[new n.G(O,t[O],`unknown property "${O}"`)])}if(t.source){const O=u.sources&&u.sources[t.source],P=O&&n.K(O.type);O?P!=="raster-dem"&&b.push(new n.V(r,t.source,`terrain cannot be used with a source of type ${String(P)}, it only be used with a "raster-dem" source type`)):b.push(new n.V(r,t.source,`source "${t.source}" not found`))}else b.push(new n.V(r,t,'terrain is missing required property "source"'));return b}function In(c){const t=c.value,r=c.style,u=c.styleSpec,p=u.fog;let _=[];const b=n.H(t);if(t===void 0)return _;if(b!=="object")return _=_.concat([new n.V("fog",t,`object expected, ${b} found`)]),_;for(const C in t){const O=C.match(/^(.*)-transition$/),P=C.match(/^(.*)-use-theme$/);_=_.concat(P&&p[P[1]]?Ri({key:C,value:t[C],valueSpec:{type:"string"},style:r,styleSpec:u}):O&&p[O[1]]&&p[O[1]].transition?Ri({key:C,value:t[C],valueSpec:u.transition,style:r,styleSpec:u}):p[C]?Ri({key:C,value:t[C],valueSpec:p[C],style:r,styleSpec:u}):[new n.G(C,t[C],`unknown property "${C}"`)])}return _}const Nn={"*":()=>[],array:Jo,boolean:function(c){const t=c.value,r=c.key,u=n.H(t);return u!=="boolean"?[new n.V(r,t,`boolean expected, ${u} found`)]:[]},number:Yi,color:function(c){const t=c.key,r=c.value,u=n.H(r);return u!=="string"?[new n.V(t,r,`color expected, ${u} found`)]:n._.parseCSSColor(r)===null?[new n.V(t,r,`color expected, "${r}" found`)]:[]},enum:Gl,filter:Hl,function:Tn,layer:Fn,object:Dn,source:zc,model:n.a2,light:Bn,"light-3d":Kn,terrain:Lc,fog:In,string:To,formatted:function(c){return To(c).length===0?[]:ka(c)},resolvedImage:function(c){return To(c).length===0?[]:ka(c)},projection:function(c){const t=c.value,r=c.styleSpec,u=r.projection,p=c.style;let _=[];const b=n.H(t);if(b==="object")for(const C in t)_=_.concat(Ri({key:C,value:t[C],valueSpec:u[C],style:p,styleSpec:r}));else b!=="string"&&(_=_.concat([new n.V("projection",t,`object or string expected, ${b} found`)]));return _},import:function(c){const{value:t,styleSpec:r}=c,{data:u,...p}=t;Object.defineProperty(p,"__line__",{value:t.__line__,enumerable:!1});let _=Dn(n.J({},c,{value:p,valueSpec:r.import}));return n.K(p.id)===""&&_.push(new n.V(`${c.key}.id`,p,"import id can't be an empty string")),u&&(_=_.concat(Nh(u,r,{key:`${c.key}.data`}))),_}};function Ri(c,t=!1){const r=c.value,u=c.valueSpec,p=c.styleSpec;if(u.expression&&n.a0(n.K(r)))return Tn(c);if(u.expression&&n.O(n.Q(r)))return ka(c);if(u.type&&Nn[u.type]){const _=Nn[u.type](c);return t===!0&&_.length>0&&n.H(c.value)==="array"?ka(c):_}return Dn(n.J({},c,{valueSpec:u.type?p[u.type]:u}))}function no(c){const t=c.value,r=c.key,u=To(c);return u.length||(t.indexOf("{fontstack}")===-1&&u.push(new n.V(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&u.push(new n.V(r,t,'"glyphs" url must include a "{range}" token'))),u}function Nh(c,t=n.a3,r={}){return Ri({key:r.key||"",value:c,valueSpec:t.$root,styleSpec:t,style:c,objectElementValidators:{glyphs:no,"*":()=>[]}})}function ha(c,t=n.a3){return Vn(Nh(c,t))}const hs=c=>Vn(zc(c)),fs=c=>Vn(Bn(c)),So=c=>Vn(Kn(c)),ao=c=>Vn(Lc(c)),Vh=c=>Vn(In(c)),Zl=c=>Vn(function(t){const r=t.value,u=t.style,p=t.styleSpec,_=p.snow;let b=[];const C=n.H(r);if(r===void 0)return b;if(C!=="object")return b=b.concat([new n.V("snow",r,`object expected, ${C} found`)]),b;for(const O in r){const P=O.match(/^(.*)-transition$/);b=b.concat(P&&_[P[1]]&&_[P[1]].transition?Ri({key:O,value:r[O],valueSpec:p.transition,style:u,styleSpec:p}):_[O]?Ri({key:O,value:r[O],valueSpec:_[O],style:u,styleSpec:p}):[new n.G(O,r[O],`unknown property "${O}"`)])}return b}(c)),zu=c=>Vn(function(t){const r=t.value,u=t.style,p=t.styleSpec,_=p.rain;let b=[];const C=n.H(r);if(r===void 0)return b;if(C!=="object")return b=b.concat([new n.V("rain",r,`object expected, ${C} found`)]),b;for(const O in r){const P=O.match(/^(.*)-transition$/);b=b.concat(P&&_[P[1]]&&_[P[1]].transition?Ri({key:O,value:r[O],valueSpec:p.transition,style:u,styleSpec:p}):_[O]?Ri({key:O,value:r[O],valueSpec:_[O],style:u,styleSpec:p}):[new n.G(O,r[O],`unknown property "${O}"`)])}return b}(c)),Pc=c=>Vn(Fn(c)),Jr=c=>Vn(Hl(c)),Ou=c=>Vn(us(c)),Lu=c=>Vn(wo(c)),kc=c=>Vn(n.a2(c));function Vn(c){return c.slice().sort((t,r)=>t.line&&r.line?t.line-r.line:0)}function Ls(c,t){let r=!1;if(t&&t.length)for(const u of t)u instanceof n.G?n.w(u.message):(c.fire(new n.y(new Error(u.message))),r=!0);return r}let We;class Q extends n.E{constructor(t,r="flat"){super(),this._transitionable=new n.a4(We||(We=new n.a5({anchor:new n.a6(n.a3.light.anchor),position:new n.a7(n.a3.light.position),color:new n.a6(n.a3.light.color),intensity:new n.a6(n.a3.light.intensity)}))),this.setLight(t,r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,r,u={}){this._validate(fs,t,u)||(this._transitionable.setTransitionOrValue(t),this.id=r)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,r,u){return(!u||u.validate!==!1)&&Ls(this,t.call(ha,n.l({value:r,style:{glyphs:!0,sprite:!0},styleSpec:n.a3})))}}let ie=class extends n.E{constructor(c,t,r,u){super(),this.scope=r,this._transitionable=new n.a4(new n.a5({source:new n.a6(n.a3.terrain.source),exaggeration:new n.a6(n.a3.terrain.exaggeration)}),r,u),this._transitionable.setTransitionOrValue(c,u),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t}get(){return this._transitionable.serialize()}set(c,t){this._transitionable.setTransitionOrValue(c,t)}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}getExaggeration(c){return this._transitioning.possiblyEvaluate(new n.a8(c)).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const c=this._transitionable._values.exaggeration;if(!c)return null;const t=c.value.expression;if(!t)return null;let r=-1,u=-1,p=1;for(const _ of t.zoomStops)p=t.evaluate(new n.a8(_)),p>.01?(r=_,u=-1):u=_;return p<.01&&r>0&&u>r?[r,u]:null}isZoomDependent(){const c=this._transitionable._values.exaggeration;return c!=null&&c.value!=null&&c.value.expression!=null&&c.value.expression instanceof n.a9}};const oe=45,ye=65,we=.05;function De(c,t,r,u){const p=n.ac(oe,ye,r),[_,b]=Ve(c,u);let C=1-Math.min(1,Math.exp((t-_)/(b-_)*-6));return C*=C*C,C=Math.min(1,1.00747*C),C*p*c.alpha}function Ve(c,t){const r=.5/Math.tan(.5*t);return[c.range[0]+r,c.range[1]+r]}function Oe(c,t,r,u,p){const _=n.ab.vec3.transformMat4([],[t,r,u],p.mercatorFogMatrix);return De(c,n.ab.vec3.length(_),p.pitch,p._fov)}function Ze(c,t,r,u,p,_,b){const C=[[r,u,0],[p,u,0],[p,_,0],[r,_,0]];let O=Number.MAX_VALUE,P=-Number.MAX_VALUE;for(const F of C){const V=n.ab.vec3.transformMat4([],F,t),U=n.ab.vec3.length(V);O=Math.min(O,U),P=Math.max(P,U)}return[De(c,O,b.pitch,b._fov),De(c,P,b.pitch,b._fov)]}class He extends n.E{constructor(t,r,u,p){super();const _=new n.a5({range:new n.a6(n.a3.fog.range),color:new n.a6(n.a3.fog.color),"color-use-theme":new n.a6({type:"string","property-type":"data-constant",default:"default"}),"high-color":new n.a6(n.a3.fog["high-color"]),"high-color-use-theme":new n.a6({type:"string","property-type":"data-constant",default:"default"}),"space-color":new n.a6(n.a3.fog["space-color"]),"space-color-use-theme":new n.a6({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new n.a6(n.a3.fog["horizon-blend"]),"star-intensity":new n.a6(n.a3.fog["star-intensity"]),"vertical-range":new n.a6(n.a3.fog["vertical-range"])});this._transitionable=new n.a4(_,u,new Map(p)),this.set(t,p),this._transitioning=this._transitionable.untransitioned(),this._transform=r,this.properties=new n.ad(_),this.scope=u}get state(){const t=this._transform,r=t.projection.name==="globe",u=n.ae(t.zoom),p=this.properties.get("range"),_=[.5,3];return{range:r?[n.af(_[0],p[0],u),n.af(_[1],p[1],u)]:p,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,r,u={}){if(this._validate(Vh,t,u))return;const p=n.l({},t);for(const _ of Object.keys(n.a3.fog))p[_]===void 0&&(p[_]=n.a3.fog[_].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,r)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const r=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:n.ac(oe,ye,t))*r.a}getOpacityAtLatLng(t,r){return this._transform.projection.supportsFog?function(u,p,_){const b=n.aa.fromLngLat(p),C=_.elevation?_.elevation.getAtPointOrZero(b):0;return Oe(u,b.x,b.y,C,_)}(this.state,t,r):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const r=this._transform.calculateFogTileMatrix(t.toUnwrapped());return Ze(this.state,r,0,0,n.ag,n.ag,this._transform)}getOpacityForBounds(t,r,u,p,_){return this._transform.projection.supportsFog?Ze(this.state,t,r,u,p,_,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?Ve(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const r=[4,5,6,7];for(const u of r){const p=t.points[u];let _;if(p[2]>=0)_=p;else{const b=t.points[u-4];_=n.ah(b,p,b[2]/(b[2]-p[2]))}if(Oe(this.state,_[0],_[1],0,this._transform)>=we)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,r,u){return(!u||u.validate!==!1)&&Ls(this,t.call(ha,n.l({value:r,style:{glyphs:!0,sprite:!0},styleSpec:n.a3})))}}let Xe,ht,At,Dt,Jt=class extends n.E{constructor(c,t,r,u){super();const p=Xe||(Xe=new n.a5({density:new n.a6(n.a3.snow.density),intensity:new n.a6(n.a3.snow.intensity),color:new n.a6(n.a3.snow.color),opacity:new n.a6(n.a3.snow.opacity),vignette:new n.a6(n.a3.snow.vignette),"vignette-color":new n.a6(n.a3.snow["vignette-color"]),"center-thinning":new n.a6(n.a3.snow["center-thinning"]),direction:new n.a6(n.a3.snow.direction),"flake-size":new n.a6(n.a3.snow["flake-size"])}));this._transitionable=new n.a4(p,r,new Map(u)),this.set(c,u),this._transitioning=this._transitionable.untransitioned(),this.properties=new n.ad(p),this.scope=r}get state(){const c=this.properties.get("opacity"),t=this.properties.get("color"),r=this.properties.get("direction"),u=n.ai(r[0]),p=-Math.max(n.ai(r[1]),.01),_=[Math.cos(u)*Math.cos(p),Math.sin(u)*Math.cos(p),Math.sin(p)],b=this.properties.get("vignette"),C=this.properties.get("vignette-color");return C.a=b,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new n.aj(t.r,t.g,t.b,t.a*c),direction:_,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:C}}get(){return this._transitionable.serialize()}set(c,t,r={}){if(this._validate(Zl,c,r))return;const u=n.l({},c);for(const p of Object.keys(n.a3.snow))u[p]===void 0&&(u[p]=n.a3.snow[p].default);this._options=u,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(c){this._transitionable.setTransitionOrValue(this._options,new Map(c))}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,t,r){return(!r||r.validate!==!1)&&Ls(this,c.call(ha,n.l({value:t,style:{glyphs:!0,sprite:!0},styleSpec:n.a3})))}},fi=class extends n.E{constructor(c,t,r,u){super();const p=ht||(ht=new n.a5({density:new n.a6(n.a3.rain.density),intensity:new n.a6(n.a3.rain.intensity),color:new n.a6(n.a3.rain.color),opacity:new n.a6(n.a3.rain.opacity),vignette:new n.a6(n.a3.rain.vignette),"vignette-color":new n.a6(n.a3.rain["vignette-color"]),"center-thinning":new n.a6(n.a3.rain["center-thinning"]),direction:new n.a6(n.a3.rain.direction),"droplet-size":new n.a6(n.a3.rain["droplet-size"]),"distortion-strength":new n.a6(n.a3.rain["distortion-strength"])}));this._transitionable=new n.a4(p,r,new Map(u)),this.set(c,u),this._transitioning=this._transitionable.untransitioned(),this.properties=new n.ad(p),this.scope=r}get state(){const c=this.properties.get("opacity"),t=this.properties.get("color"),r=this.properties.get("direction"),u=n.ai(r[0]),p=-Math.max(n.ai(r[1]),.01),_=[Math.cos(u)*Math.cos(p),Math.sin(u)*Math.cos(p),Math.sin(p)],b=this.properties.get("vignette-color");return b.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new n.aj(t.r,t.g,t.b,t.a*c),direction:_,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:b}}get(){return this._transitionable.serialize()}set(c,t,r={}){if(this._validate(zu,c,r))return;const u=n.l({},c);for(const p of Object.keys(n.a3.rain))u[p]===void 0&&(u[p]=n.a3.rain[p].default);this._options=u,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(c){this._transitionable.setTransitionOrValue(this._options,new Map(c))}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,t,r){return(!r||r.validate!==!1)&&Ls(this,c.call(ha,n.l({value:t,style:{glyphs:!0,sprite:!0},styleSpec:n.a3})))}};class pi extends n.E{constructor(t,r,u,p){super(),this.scope=u,this._options=t,this.properties=new n.ad(r),this._transitionable=new n.a4(r,u,new Map(p)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,r){this._options=t,this._transitionable.setTransitionOrValue(t.properties,r)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class si{constructor(t,r,u,p){this.screenBounds=t,this.cameraPoint=r,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=u,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,p)}static createFromScreenPoints(t,r){let u,p;if(t instanceof n.P||typeof t[0]=="number"){const _=n.P.convert(t);u=[_],p=r.isPointAboveHorizon(_)}else{const _=n.P.convert(t[0]),b=n.P.convert(t[1]);u=[_,b],p=n.al(_,b).every(C=>r.isPointAboveHorizon(C))}return new si(u,r.getCameraPoint(),p,r)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return n.al(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const r=this.screenBounds[0],u=this.screenBounds.length===1?this.screenBounds[0].add(new n.P(1,1)):this.screenBounds[1],p=n.al(r,u,0,!1);return this.cameraPoint.y>u.y&&(this.cameraPoint.x>r.x&&this.cameraPoint.x<u.x?p.splice(3,0,this.cameraPoint):this.cameraPoint.x>=u.x?p[2]=this.cameraPoint:this.cameraPoint.x<=r.x&&(p[3]=this.cameraPoint)),n.am(p,t)}bufferedCameraGeometryGlobe(t){const r=this.screenBounds[0],u=this.screenBounds.length===1?this.screenBounds[0].add(new n.P(1,1)):this.screenBounds[1],p=n.al(r,u,t),_=this.cameraPoint.clone();switch(3*((_.y>r.y)+(_.y>u.y))+((_.x>r.x)+(_.x>u.x))){case 0:p[0]=_,p[4]=_.clone();break;case 1:p.splice(1,0,_);break;case 2:p[1]=_;break;case 3:p.splice(4,0,_);break;case 5:p.splice(2,0,_);break;case 6:p[3]=_;break;case 7:p.splice(3,0,_);break;case 8:p[2]=_}return p}containsTile(t,r,u,p=0){const _=t.queryPadding/r._pixelsPerMercatorPixel+1,b=u?this._bufferedCameraMercator(_,r):this._bufferedScreenMercator(_,r);let C=t.tileID.wrap+(b.unwrapped?p:0);const O=b.polygon.map(te=>n.an(t.tileTransform,te,C));if(!n.ao(O,0,0,n.ag,n.ag))return;C=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?p:0);const P=this.screenGeometryMercator.polygon.map(te=>n.ap(t.tileTransform,te,C)),F=P.map(te=>new n.P(te[0],te[1])),V=r.getFreeCameraOptions().position||new n.aa(0,0,0),U=n.ap(t.tileTransform,V,C),H=P.map(te=>{const ee=n.ab.vec3.sub(te,te,U);return n.ab.vec3.normalize(ee,ee),new n.aq(U,ee)}),J=n.ar(t,1,r.zoom)*r._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:F,tilespaceRays:H,bufferedTilespaceGeometry:O,bufferedTilespaceBounds:($=n.as(O),$.min.x=n.aw($.min.x,0,n.ag),$.min.y=n.aw($.min.y,0,n.ag),$.max.x=n.aw($.max.x,0,n.ag),$.max.y=n.aw($.max.y,0,n.ag),$),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:J};var $}_bufferedScreenMercator(t,r){const u=Ni(t);if(this._screenRaycastCache[u])return this._screenRaycastCache[u];{let p;return p=r.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),r):{polygon:this.bufferedScreenGeometry(t).map(_=>r.pointCoordinate3D(_)),unwrapped:!0},this._screenRaycastCache[u]=p,p}}_bufferedCameraMercator(t,r){const u=Ni(t);if(this._cameraRaycastCache[u])return this._cameraRaycastCache[u];{let p;return p=r.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),r):{polygon:this.bufferedCameraGeometry(t).map(_=>r.pointCoordinate3D(_)),unwrapped:!0},this._cameraRaycastCache[u]=p,p}}_projectAndResample(t,r){const u=function(_,b){const C=n.ab.mat4.multiply([],b.pixelMatrix,b.globeMatrix),O=[0,-n.ax,0,1],P=[0,n.ax,0,1],F=[0,0,0,1];n.ab.vec4.transformMat4(O,O,C),n.ab.vec4.transformMat4(P,P,C),n.ab.vec4.transformMat4(F,F,C);const V=new n.P(O[0]/O[3],O[1]/O[3]),U=new n.P(P[0]/P[3],P[1]/P[3]),H=n.au(_,V)&&O[3]<F[3],J=n.au(_,U)&&P[3]<F[3];if(!H&&!J)return null;const $=function(ve,_e,Ee){for(let ze=1;ze<ve.length;ze++){const Ye=qi(_e.pointCoordinate3D(ve[ze-1]).x),qe=qi(_e.pointCoordinate3D(ve[ze]).x);if(Ee<0){if(Ye<qe)return{idx:ze,t:-Ye/(qe-1-Ye)}}else if(qe<Ye)return{idx:ze,t:(1-Ye)/(qe+1-Ye)}}return null}(_,b,H?-1:1);if(!$)return null;const{idx:te,t:ee}=$;let le=te>1?ji(_.slice(0,te),b):[],pe=te<_.length?ji(_.slice(te),b):[];le=le.map(ve=>new n.P(qi(ve.x),ve.y)),pe=pe.map(ve=>new n.P(qi(ve.x),ve.y));const fe=[...le];fe.length===0&&fe.push(pe[pe.length-1]);const be=n.af(fe[fe.length-1].y,(pe.length===0?le[0]:pe[0]).y,ee);let me;return me=H?[new n.P(0,be),new n.P(0,0),new n.P(1,0),new n.P(1,be)]:[new n.P(1,be),new n.P(1,1),new n.P(0,1),new n.P(0,be)],fe.push(...me),pe.length===0?fe.push(le[0]):fe.push(...pe),{polygon:fe.map(ve=>new n.aa(ve.x,ve.y)),unwrapped:!1}}(t,r);if(u)return u;const p=function(_,b){let C=!1,O=-1/0,P=0;for(let V=0;V<_.length-1;V++)_[V].x>O&&(O=_[V].x,P=V);for(let V=0;V<_.length-1;V++){const U=(P+V)%(_.length-1),H=_[U],J=_[U+1];Math.abs(H.x-J.x)>.5&&(H.x<J.x?(H.x+=1,U===0&&(_[_.length-1].x+=1)):(J.x+=1,U+1===_.length-1&&(_[0].x+=1)),C=!0)}const F=n.at(b.center.lng);return C&&F<Math.abs(F-1)&&_.forEach(V=>{V.x-=1}),{polygon:_,unwrapped:C}}(ji(t,r).map(_=>new n.P(qi(_.x),_.y)),r);return{polygon:p.polygon.map(_=>new n.aa(_.x,_.y)),unwrapped:p.unwrapped}}}function ji(c,t){return n.av(c,r=>{const u=t.pointCoordinate3D(r);r.x=u.x,r.y=u.y},1/256)}function qi(c){return c<0?1+c%1:c%1}function Ni(c){return 100*c|0}function tr(c,t,r,u,p){const _=function(C,O){if(C)return p(C);if(O){if(c.url&&O.tiles&&c.tiles&&delete c.tiles,O.variants){if(!Array.isArray(O.variants))return p(new Error("variants must be an array"));for(const F of O.variants){if(F==null||typeof F!="object"||F.constructor!==Object)return p(new Error("variant must be an object"));if(!Array.isArray(F.capabilities))return p(new Error("capabilities must be an array"));if(F.capabilities.length===1&&F.capabilities[0]==="meshopt"){O=n.l(O,F);break}}}const P=n.ay(n.l({},O,c),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);P.tiles=t.canonicalizeTileset(P,c.url),p(null,P)}},b=function(C,O,P){if(!C)return null;if(!O&&!P)return C;P=P||C.worldview_default;const F=Object.values(C.language||{});if(F.length===0)return null;const V=Object.values(C.worldview||{});if(V.length===0)return null;const U=F.every(J=>J===O),H=V.every(J=>J===P);return U&&H?C:O in(C.language_options||{})||P in(C.worldview_options||{})?null:C.language_options&&C.worldview_options?C:null}(c.data,r,u);return b?n.q.frame(()=>_(null,b)):c.url?n.n(t.transformRequest(t.normalizeSourceURL(c.url,null,r,u),n.R.Source),_):n.q.frame(()=>{const{data:C,...O}=c;_(null,O)})}class sr{constructor(t,r,u){this.bounds=n.az.convert(this.validateBounds(t)),this.minzoom=r||0,this.maxzoom=u||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const r=Math.pow(2,t.z),u=Math.floor(n.at(this.bounds.getWest())*r),p=Math.floor(n.aA(this.bounds.getNorth())*r),_=Math.ceil(n.at(this.bounds.getEast())*r),b=Math.ceil(n.aA(this.bounds.getSouth())*r);return t.x>=u&&t.x<_&&t.y>=p&&t.y<b}}class un extends n.E{constructor(t,r,u,p){if(super(),this.id=t,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,n.l(this,n.ay(r,["url","scheme","tileSize","promoteId"])),this._options=n.l({type:"vector"},r),this._collectResourceTiming=!!r.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p),this._tileWorkers={},this._deduped=new n.aB}load(t){this._loaded=!1,this.fire(new n.z("dataloading",{dataType:"source"}));const r=Array.isArray(this.map._language)?this.map._language.join():this.map._language,u=this.map.getWorldview();this._tileJSONRequest=tr(this._options,this.map._requestManager,r,u,(p,_)=>{if(this._tileJSONRequest=null,this._loaded=!0,p)r&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${r}`),u&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${u}`),this.fire(new n.y(p));else if(_){if(n.l(this,_),this.hasWorldviews=!!_.worldview_options,_.worldview_default&&(this.worldviewDefault=_.worldview_default),_.vector_layers){this.vectorLayers=_.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const b of _.vector_layers)this.vectorLayerIds.push(b.id),_.worldview&&_.worldview[b.source]&&this.localizableLayerIds.add(b.id)}_.bounds&&(this.tileBounds=new sr(_.bounds,this.minzoom,this.maxzoom)),Di(_.tiles,this.map._requestManager._customAccessToken),this.fire(new n.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.z("data",{dataType:"source",sourceDataType:"content"}))}t&&t(p)})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=n.aC(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return n.l({},this._options)}loadTile(t,r){const u=t.tileID.canonical.url(this.tiles,this.scheme),p=this.map._requestManager.normalizeTileURL(u),_=this.map._requestManager.transformRequest(p,n.R.Tile),b=this.map.style?this.map.style.getLut(this.scope):null,C=b?{image:b.image.clone()}:null,O={request:_,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:C,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:n.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor()};if(this.hasWorldviews&&n.f(u)&&(O.worldview=this.map.getWorldview()||this.worldviewDefault,O.localizableLayerIds=this.localizableLayerIds),O.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=r:t.request=t.actor.send("reloadTile",O,P.bind(this));else if(t.actor=this._tileWorkers[p]=this._tileWorkers[p]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",O,P.bind(this),void 0,!0);else{const F=n.aD.call({deduped:this._deduped},O,(V,U)=>{V||!U?P.call(this,V):(O.data={cacheControl:U.cacheControl,expires:U.expires,rawData:U.rawData.slice(0)},t.actor&&t.actor.send("loadTile",O,P.bind(this),void 0,!0))},!0);t.request={cancel:F}}function P(F,V){return delete t.request,t.aborted?r(null):F&&F.status!==404?r(F):(V&&V.resourceTiming&&(t.resourceTiming=V.resourceTiming),this.map._refreshExpiredTiles&&V&&t.setExpiryData(V),t.loadVectorData(V,this.map.painter),n.aE(this.dispatcher),r(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,r){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Wa extends n.E{constructor(t,r,u,p){super(),this.id=t,this.dispatcher=u,this.setEventedParent(p),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=n.l({type:"raster"},r),n.l(this,n.ay(r,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new n.z("dataloading",{dataType:"source"})),this._tileJSONRequest=tr(this._options,this.map._requestManager,null,null,(r,u)=>{this._tileJSONRequest=null,this._loaded=!0,r?this.fire(new n.y(r)):u&&(n.l(this,u),u.raster_layers&&(this.rasterLayers=u.raster_layers,this.rasterLayerIds=this.rasterLayers.map(p=>p.id)),u.bounds&&(this.tileBounds=new sr(u.bounds,this.minzoom,this.maxzoom)),Di(u.tiles),this.fire(new n.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.z("data",{dataType:"source",sourceDataType:"content"}))),t&&t(r)})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=n.aC(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return n.l({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,r){const u=n.q.devicePixelRatio>=2,p=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),u,this.tileSize);t.request=n.o(this.map._requestManager.transformRequest(p,n.R.Tile),(_,b,C,O)=>(delete t.request,t.aborted?(t.state="unloaded",r(null)):_?(t.state="errored",r(_)):b?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:C,expires:O}),t.setTexture(b,this.map.painter),t.state="loaded",n.aE(this.dispatcher),void r(null)):r(null)))}abortTile(t,r){t.request&&(t.request.cancel(),delete t.request),r&&r()}unloadTile(t,r){t.texture&&t.texture instanceof n.T?(t.destroy(!0),t.texture&&t.texture instanceof n.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),r&&r()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class an extends Wa{constructor(t,r,u,p){super(t,r,u,p),this.type="raster-array",this.maxzoom=22,this._options=n.l({type:"raster-array"},r)}triggerRepaint(t){const r=this.map.painter._terrain,u=this.map.style.getSourceCache(this.id);r&&r.enabled&&u&&r._clearRenderCacheForTile(u.id,t.tileID),this.map.triggerRepaint()}loadTile(t,r){const u=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),p=this.map._requestManager.transformRequest(u,n.R.Tile);t.requestParams=p,t.actor||(t.actor=this.dispatcher.getActor()),t.request=t.fetchHeader(void 0,(_,b,C,O)=>{if(delete t.request,t.aborted)return t.state="unloaded",r(null);if(_)return _.code===20?void 0:(t.state="errored",r(_));this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:C,expires:O}),t.state="empty",r(null)})}unloadTile(t,r){const u=t.texture;u&&u instanceof n.T?(t.destroy(!0),this.map.painter.saveTileTexture(u)):(t.destroy(),t.flushQueues(),t._isHeaderLoaded=!1,delete t._mrt,delete t.textureDescriptor),t.fbo&&(t.fbo.destroy(),delete t.fbo),delete t.request,delete t.requestParams,delete t.neighboringTiles,t.state="unloaded"}prepareTile(t,r,u){t._isHeaderLoaded&&(t.state!=="empty"&&(t.state="reloading"),t.fetchBand(r,u,(p,_)=>{if(p)return t.state="errored",this.fire(new n.y(p)),void this.triggerRepaint(t);_&&(t.setTexture(_,this.map.painter),t.state="loaded",this.triggerRepaint(t))}))}getInitialBand(t){if(!this.rasterLayers)return 0;const r=this.rasterLayers.find(({id:_})=>_===t),u=r&&r.fields,p=u&&u.bands&&u.bands;return p?p[0]:0}getTextureDescriptor(t,r,u){if(!t)return;const p=r.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!p)return;let _=null;r instanceof n.aH?_=r.paint.get("raster-array-band"):r instanceof n.aI&&(_=r.paint.get("raster-particle-array-band"));const b=_||this.getInitialBand(p);if(b!=null)if(t.textureDescriptor){if(!t.updateNeeded(p,b)||u)return Object.assign({},t.textureDescriptor,{texture:t.texture})}else this.prepareTile(t,p,b)}}const Gr={vector:un,raster:Wa,"raster-dem":class extends Wa{constructor(c,t,r,u){super(c,t,r,u),this.type="raster-dem",this.maxzoom=22,this._options=n.l({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(c,t){const r=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function u(p,_){p&&(c.state="errored",t(p)),_&&(c.dem=_,c.dem.onDeserialize(),c.needsHillshadePrepare=!0,c.needsDEMTextureUpload=!0,c.state="loaded",t(null))}c.request=n.o(this.map._requestManager.transformRequest(r,n.R.Tile),(function(p,_,b,C){if(delete c.request,c.aborted)c.state="unloaded",t(null);else if(p)c.state="errored",t(p);else if(_){this.map._refreshExpiredTiles&&c.setExpiryData({cacheControl:b,expires:C});const O=ImageBitmap&&_ instanceof ImageBitmap&&n.t(),P=1-(_.width-n.aF(_.width))/2;P<1||c.neighboringTiles||(c.neighboringTiles=this._getNeighboringTiles(c.tileID));const F=O?_:n.q.getImageData(_,P),V={uid:c.uid,coord:c.tileID,source:this.id,scope:this.scope,rawImageData:F,encoding:this.encoding,padding:P};c.actor&&c.state!=="expired"||(c.actor=this.dispatcher.getActor(),c.actor.send("loadDEMTile",V,u.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(c){const t=c.canonical,r=Math.pow(2,t.z),u=(t.x-1+r)%r,p=t.x===0?c.wrap-1:c.wrap,_=(t.x+1+r)%r,b=t.x+1===r?c.wrap+1:c.wrap,C={};return C[new n.aG(c.overscaledZ,p,t.z,u,t.y).key]={backfilled:!1},C[new n.aG(c.overscaledZ,b,t.z,_,t.y).key]={backfilled:!1},t.y>0&&(C[new n.aG(c.overscaledZ,p,t.z,u,t.y-1).key]={backfilled:!1},C[new n.aG(c.overscaledZ,c.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},C[new n.aG(c.overscaledZ,b,t.z,_,t.y-1).key]={backfilled:!1}),t.y+1<r&&(C[new n.aG(c.overscaledZ,p,t.z,u,t.y+1).key]={backfilled:!1},C[new n.aG(c.overscaledZ,c.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},C[new n.aG(c.overscaledZ,b,t.z,_,t.y+1).key]={backfilled:!1}),C}},"raster-array":an,geojson:class extends n.E{constructor(c,t,r,u){super(),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=r.getActor(),this.setEventedParent(u),this._data=t.data,this._options=n.l({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.minzoom!==void 0&&(this.minzoom=t.minzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const p=n.ag/this.tileSize;this.workerOptions=n.l({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*p,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*p,extent:n.ag,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:n.ag,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*p,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter,dynamic:t.dynamic},t.workerOptions)}onAdd(c){this.map=c,this.setData(this._data)}setData(c){return this._data=c,this._updateWorkerData(),this}updateData(c){if(!this._options.dynamic)return this.fire(new n.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof c!="string"&&(c.type==="Feature"&&(c={type:"FeatureCollection",features:[c]}),c.type!=="FeatureCollection"))return this.fire(new n.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof c!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const t=new Map;for(const r of this._data.features)t.set(r.id,r);for(const r of c.features)t.set(r.id,r);this._data.features=[...t.values()]}else this._data=c;return this._updateWorkerData(!0),this}getClusterExpansionZoom(c,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:c,source:this.id,scope:this.scope},t),this}getClusterChildren(c,t){return this.actor.send("geojson.getClusterChildren",{clusterId:c,source:this.id,scope:this.scope},t),this}getClusterLeaves(c,t,r,u){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:c,limit:t,offset:r},u),this}_updateWorkerData(c=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new n.z("dataloading",{dataType:"source"})),this._loaded=!1;const t=n.l({append:c},this.workerOptions);t.scope=this.scope;const r=this._data;typeof r=="string"?(t.request=this.map._requestManager.transformRequest(n.q.resolveURL(r),n.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(r),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,(u,p)=>{if(this._loaded=!0,this._pendingLoad=null,u)this.fire(new n.y(u));else{const _={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&p&&p.resourceTiming&&p.resourceTiming[this.id]&&(_.resourceTiming=p.resourceTiming[this.id]),c&&(this._partialReload=!0),this.fire(new n.z("data",_)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(c),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const c=n.aC(this.id,this.scope);this.map.style.clearSource(c),this._updateWorkerData()}loadTile(c,t){const r=c.actor?"reloadTile":"loadTile";c.actor=this.actor;const u=this.map.style?this.map.style.getLut(this.scope):null,p=u?{image:u.image.clone()}:null,_=this._partialReload,b={type:this.type,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:p,scope:this.scope,pixelRatio:n.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,scaleFactor:this.map.getScaleFactor(),partial:_};c.request=this.actor.send(r,b,(C,O)=>_&&!O?(c.state="loaded",t(null)):(delete c.request,c.destroy(),c.aborted?t(null):C?t(C):(c.loadVectorData(O,this.map.painter,r==="reloadTile"),t(null))),void 0,r==="loadTile")}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.aborted=!0}unloadTile(c,t){this.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id,scope:this.scope}),c.destroy()}onRemove(c){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return n.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends n.aJ{constructor(c,t,r,u){super(c,t,r,u),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const c=this.options;this.urls=[];for(const t of c.urls)this.urls.push(this.map._requestManager.transformRequest(t,n.R.Source).url);n.aK(this.urls,(t,r)=>{this._loaded=!0,t?this.fire(new n.y(t)):r&&(this.video=r,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(c){if(this.video){const t=this.video.seekable;c<t.start(0)||c>t.end(0)?this.fire(new n.y(new n.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=c}}getVideo(){return this.video}onAdd(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const c=this.map.painter.context,t=c.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new n.T(c,this.video,t.RGBA8),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(c)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:n.aJ,model:class extends n.E{constructor(c,t,r,u){super(),this.id=c,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){const c=[];for(const t in this._options.models){const r=this._options.models[t],u=n.aM(this.map._requestManager.transformRequest(r.uri,n.R.Model).url).then(p=>{if(!p)return;const _=n.aN(p),b=new n.aO(t,r.position,r.orientation,_);b.computeBoundsAndApplyParent(),this.models.push(b)}).catch(p=>{this.fire(new n.y(new Error(`Could not load model ${t} from ${r.uri}: ${p.message}`)))});c.push(u)}return Promise.allSettled(c).then(()=>{this._loaded=!0,this.fire(new n.z("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(t=>{this.fire(new n.y(new Error(`Could not load models: ${t.message}`)))})}onAdd(c){this.map=c,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(c,t){}serialize(){return{type:"model"}}},"batched-model":class extends n.E{constructor(c,t,r,u){super(),this.type="batched-model",this.id=c,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=r,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(u)}onAdd(c){this.map=c,this.load()}reload(){this.cancelTileJSONRequest();const c=n.aC(this.id,this.scope);this.load(()=>this.map.style.clearSource(c))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(c){this._loaded=!1,this.fire(new n.z("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,r=this.map.getWorldview();this._tileJSONRequest=tr(this._options,this.map._requestManager,t,r,(u,p)=>{this._tileJSONRequest=null,this._loaded=!0,u?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),r&&r.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${r}`),this.fire(new n.y(u))):p&&(n.l(this,p),p.bounds&&(this.tileBounds=new sr(p.bounds,this.minzoom,this.maxzoom)),Di(p.tiles,this.map._requestManager._customAccessToken),this.fire(new n.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.z("data",{dataType:"source",sourceDataType:"content"}))),c&&c(u)})}hasTransition(){return!1}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}loaded(){return this._loaded}loadTile(c,t){const r=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),u={request:this.map._requestManager.transformRequest(r,n.R.Tile),data:void 0,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:c.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,lut:null,maxZoom:null,promoteId:null,pixelRatio:null,scaleFactor:null};if(c.actor&&c.state!=="expired")if(c.state==="loading")c.reloadCallback=t;else{if(c.buckets){const _=Object.values(c.buckets);for(const b of _)b.dirty=!0;return void(c.state="loaded")}c.request=c.actor.send("reloadTile",u,p.bind(this))}else c.actor=this.dispatcher.getActor(),c.request=c.actor.send("loadTile",u,p.bind(this),void 0,!0);function p(_,b){return c.aborted?t(null):_&&_.status!==404?t(_):(this.map._refreshExpiredTiles&&b&&c.setExpiryData(b),c.loadModelData(b,this.map.painter),c.state="loaded",void t(null))}}serialize(){return n.l({},this._options)}},canvas:class extends n.aJ{constructor(c,t,r,u){super(c,t,r,u),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(p=>!Array.isArray(p)||p.length!==2||p.some(_=>typeof _!="number"))||this.fire(new n.y(new n.V(`sources.${c}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new n.y(new n.V(`sources.${c}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new n.y(new n.V(`sources.${c}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof HTMLCanvasElement||this.fire(new n.y(new n.V(`sources.${c}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new n.y(new n.V(`sources.${c}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new n.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()}onRemove(c){this.pause()}prepare(){let c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?!c&&!this._playing||this.texture instanceof n.aL||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new n.T(t,this.canvas,t.gl.RGBA8,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const c of[this.canvas.width,this.canvas.height])if(isNaN(c)||c<=0)return!0;return!1}},custom:class extends n.E{constructor(c,t,r,u){super(),this.id=c,this.type="custom",this._dataType="raster",this._dispatcher=r,this._implementation=t,this.setEventedParent(u),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new n.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new n.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new sr(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),n.l(this,n.ay(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return n.ay(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new n.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(c){this.map=c,this._loaded=!1,this.fire(new n.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(c),this.load()}onRemove(c){this._implementation.onRemove&&this._implementation.onRemove(c)}hasTile(c){if(this._implementation.hasTile){const{x:t,y:r,z:u}=c.canonical;return this._implementation.hasTile({x:t,y:r,z:u})}return!this.tileBounds||this.tileBounds.contains(c.canonical)}loadTile(c,t){const{x:r,y:u,z:p}=c.tileID.canonical,_=new AbortController;c.request=Promise.resolve(this._implementation.loadTile({x:r,y:u,z:p},{signal:_.signal})).then((function(b){return delete c.request,c.aborted?(c.state="unloaded",t(null)):b===void 0?(c.state="errored",t(null)):b===null?(this.loadTileData(c,{width:this.tileSize,height:this.tileSize,data:null}),c.state="loaded",t(null)):function(C){return C instanceof ImageData||C instanceof HTMLCanvasElement||C instanceof ImageBitmap||C instanceof HTMLImageElement}(b)?(this.loadTileData(c,b),c.state="loaded",void t(null)):(c.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(b=>{b.code!==20&&(c.state="errored",t(b))}),c.request.cancel=()=>_.abort()}loadTileData(c,t){c.setTexture(t,this.map.painter)}unloadTile(c,t){if(c.texture&&c.texture instanceof n.T?(c.destroy(!0),c.texture&&c.texture instanceof n.T&&this.map.painter.saveTileTexture(c.texture)):c.destroy(),this._implementation.unloadTile){const{x:r,y:u,z:p}=c.tileID.canonical;this._implementation.unloadTile({x:r,y:u,z:p})}t&&t()}abortTile(c,t){c.request&&c.request.cancel&&(c.request.cancel(),delete c.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(c=>({x:c.canonical.x,y:c.canonical.y,z:c.canonical.z}))}_clearTiles(){const c=n.aC(this.id,this.scope);this.map.style.clearSource(c)}_update(){this.fire(new n.z("data",{dataType:"source",sourceDataType:"content"}))}}},$r=function(c,t,r,u){const p=new Gr[t.type](c,t,r,u);if(p.id!==c)throw new Error(`Expected Source id to be ${c} instead of ${p.id}`);return n.aP(["load","abort","unload","serialize","prepare"],p),p};function Fc(c,t,r=""){return`${r}:${t.id||""}:${t.layer.id}:${function(u){if("layerId"in u)return`layer:${u.layerId}`;{const{featuresetId:p,importId:_}=u;return`featureset:${p}${_?`:import:${_}`:""}`}}(c.target)}`}function Eo(c,t,r,u=""){if(c.uniqueFeatureID){const p=Fc(c,t,u);if(r.has(p))return!0;r.add(p)}return!1}function tl(c,t,r,u,p=!1){const _=t.sourceCache.transform,b=t.sourceCache.tilesIn(c,t.has3DLayers,p);b.sort($f);const C=[];for(const O of b){const P=O.tile.queryRenderedFeatures(t,O,r,u,_,p);Object.keys(P).length&&C.push({wrappedTileID:O.tile.tileID.wrapped().key,queryResults:P})}return C.length===0?{}:function(O){const P={},F={};for(const V of O){const U=V.queryResults,H=V.wrappedTileID,J=F[H]=F[H]||{};for(const $ in U){const te=U[$],ee=J[$]=J[$]||{},le=P[$]=P[$]||[];for(const pe of te)ee[pe.featureIndex]||(ee[pe.featureIndex]=!0,le.push(pe))}}return P}(C)}function Uh(c,t,r,u,p){const _={},b=u.queryRenderedSymbols(c),C=[];for(const O of Object.keys(b).map(Number))C.push(p[O]);C.sort($f);for(const O of C){const P=O.featureIndex.lookupSymbolFeatures(b[O.bucketInstanceId],O.bucketIndex,O.sourceLayerIndex,t,r);for(const F in P){const V=_[F]=_[F]||[],U=P[F];U.sort((H,J)=>{const $=O.featureSortOrder;if($){const te=$.indexOf(H.featureIndex);return $.indexOf(J.featureIndex)-te}return J.featureIndex-H.featureIndex});for(const H of U)V.push(H)}}return _}function Pu(c,t){const r=c.getRenderableIds().map(_=>c.getTileByID(_)),u=[],p={};for(let _=0;_<r.length;_++){const b=r[_],C=b.tileID.canonical.key;p[C]||(p[C]=!0,b.querySourceFeatures(u,t))}return u}function $f(c,t){const r=c.tileID,u=t.tileID;return r.overscaledZ-u.overscaledZ||r.canonical.y-u.canonical.y||r.wrap-u.wrap||r.canonical.x-u.canonical.x}function Fa(c,t){const r={};if(!t)return r;for(const u of c){const p=u.layerIds.map(_=>t.getLayer(_)).filter(Boolean);if(p.length!==0){u.layers=p,u.stateDependentLayerIds&&(u.stateDependentLayers=u.stateDependentLayerIds.map(_=>p.filter(b=>b.id===_)[0]));for(const _ of p)r[_.fqid]=u}}return r}const Jn=32,ds=33,Ps=new Uint16Array(8184);for(let c=0;c<2046;c++){let t=c+2,r=0,u=0,p=0,_=0,b=0,C=0;for(1&t?p=_=b=Jn:r=u=C=Jn;(t>>=1)>1;){const P=r+p>>1,F=u+_>>1;1&t?(p=r,_=u,r=b,u=C):(r=p,u=_,p=b,_=C),b=P,C=F}const O=4*c;Ps[O+0]=r,Ps[O+1]=u,Ps[O+2]=p,Ps[O+3]=_}const Ma=new Uint16Array(2178),ps=new Uint8Array(1089),ks=new Uint16Array(1089);function Mo(c){return c===0?-.03125:c===32?.03125:0}const Qf={type:2,extent:n.ag,loadGeometry:()=>[[new n.P(0,0),new n.P(n.ag+1,0),new n.P(n.ag+1,n.ag+1),new n.P(0,n.ag+1),new n.P(0,0)]]};class Ao{constructor(t,r,u,p,_){this.tileID=t,this.uid=n.aV(),this.uses=0,this.tileSize=r,this.tileZoom=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=_,p&&p.style&&(this._lastUpdatedBrightness=p.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",p&&p.transform&&(this.projection=p.transform.projection)}registerFadeDuration(t){const r=t+this.timeAdded;r<n.q.now()||this.fadeEndTime&&r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=n.aQ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,r,u){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=Fa(t.buckets,r.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const _=this.buckets[p];if(_ instanceof n.aX){if(this.hasSymbolBuckets=!0,!u)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const _=this.buckets[p];if(_ instanceof n.aX&&_.hasRTLText){this.hasRTLText=!0,n.aY();break}}this.queryPadding=0;for(const p in this.buckets){const _=this.buckets[p],b=r.style.getOwnLayer(p);if(!b)continue;const C=b.queryRadius(_);this.queryPadding=Math.max(this.queryPadding,C)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new n.aW}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(t,r,u){t&&(t.resourceTiming&&(this.resourceTiming=t.resourceTiming),this.buckets=Object.assign({},this.buckets,Fa(t.buckets,r.style)),t.featureIndex&&(this.latestFeatureIndex=t.featureIndex))}getBucket(t){return this.buckets[t.fqid]}upload(t){for(const p in this.buckets){const _=this.buckets[p];_.uploadPending()&&_.upload(t)}const r=t.gl,u=this.imageAtlas;if(u&&!u.uploaded){const p=!!Object.keys(u.patternPositions).length;this.imageAtlasTexture=new n.T(t,u.image,r.RGBA8,{useMipmap:p}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new n.T(t,this.glyphAtlasImage,r.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new n.T(t,this.lineAtlas.image,r.R8),this.lineAtlas.uploaded=!0)}prepare(t,r,u){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,u),!r||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const p=r.style.getBrightness();(this._lastUpdatedBrightness||p)&&(this._lastUpdatedBrightness&&p&&Math.abs(this._lastUpdatedBrightness-p)<.001||(this.updateBuckets(r,this._lastUpdatedBrightness!==p),this._lastUpdatedBrightness=p))}queryRenderedFeatures(t,r,u,p,_,b){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const C=function(O,P){const F=n.ab.mat4.fromScaling([],[.5*O.width,.5*-O.height,1]);return n.ab.mat4.translate(F,F,[1,-1,0]),n.ab.mat4.multiply(F,F,O.calculateProjMatrix(P.toUnwrapped())),Float32Array.from(F)}(_,this.tileID);return this.latestFeatureIndex.query(t,{tilespaceGeometry:r,pixelPosMatrix:C,transform:p,availableImages:u,tileTransform:this.tileTransform})}querySourceFeatures(t,r){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const p=u.loadVTLayers(),_=r?r.sourceLayer:"",b=p._geojsonTileLayer||p[_];if(!b)return;const C=n.aZ(r&&r.filter),{z:O,x:P,y:F}=this.tileID.canonical,V={z:O,x:P,y:F};for(let U=0;U<b.length;U++){const H=b.feature(U);if(C.needGeometry){const te=n.a_(H,!0);if(!C.filter(new n.a8(this.tileID.overscaledZ),te,this.tileID.canonical))continue}else if(!C.filter(new n.a8(this.tileID.overscaledZ),H))continue;const J=u.getId(H,_),$=new n.a$(H,O,P,F,J);$.tile=V,t.push($)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const r=this.expirationTime;if(t.cacheControl){const u=n.b0(t.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const u=Date.now();let p=!1;if(this.expirationTime>u)p=!1;else if(r)if(this.expirationTime<r)p=!0;else{const _=this.expirationTime-r;_?this.expirationTime=u+Math.max(_,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(t){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&t&&this.updateBuckets(t)}updateBuckets(t,r){if(!this.latestFeatureIndex||!t.style)return;const u=this.latestFeatureIndex.loadVTLayers(),p=t.style.listImages(),_=t.style.getBrightness();for(const b in this.buckets){if(!t.style.hasLayer(b))continue;const C=this.buckets[b],O=C.layers[0],P=O.sourceLayer||"_geojsonTileLayer",F=u[P],V=t.style.getLayerSourceCache(O);let U={};V&&(U=V._state.getState(P,void 0));const H=this.imageAtlas&&this.imageAtlas.patternPositions||{},J=Object.keys(U).length>0&&!r;J&&!C.stateDependentLayers.length&&!r||C.update(U,F,p,H,J?C.stateDependentLayers:C.layers,r,_),(C instanceof n.b1||C instanceof n.b2)&&t._terrain&&t._terrain.enabled&&V&&C.programConfigurations.needsUpload&&t._terrain._clearRenderCacheForTile(V.id,this.tileID);const $=t&&t.style&&t.style.getOwnLayer(b);$&&(this.queryPadding=Math.max(this.queryPadding,$.queryRadius(C)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<n.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=n.q.now()+t}setTexture(t,r){const u=r.context,p=u.gl;this.texture=this.texture||r.getTileTexture(t.width),this.texture&&this.texture instanceof n.T?this.texture.update(t):(this.texture=new n.T(u,t,p.RGBA8,{useMipmap:!0}),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE))}setDependencies(t,r){const u={};for(const p of r)u[p]=!0;this.dependencies[t]=u}hasDependency(t,r){for(const u of t){const p=this.dependencies[u];if(p){for(const _ of r)if(p[_])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,r){if(!r||r.name==="mercator"||this._tileDebugBuffer)return;const u=n.b3(Qf,this.tileID.canonical,this.tileTransform)[0],p=new n.b4,_=new n.b5;for(let b=0;b<u.length;b++){const{x:C,y:O}=u[b];p.emplaceBack(C,O),_.emplaceBack(b)}_.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(_),this._tileDebugBuffer=t.createVertexBuffer(p,n.b6.members),this._tileDebugSegments=n.b7.simpleSegment(0,0,p.length,_.length)}_makeTileBoundsBuffers(t,r){if(this._tileBoundsBuffer||!r||r.name==="mercator")return;const u=n.b3(Qf,this.tileID.canonical,this.tileTransform)[0];let p,_;if(this.isRaster){const b=function(C,O){const P=n.aQ(C,O),F=Math.pow(2,C.z);for(let te=0;te<ds;te++)for(let ee=0;ee<ds;ee++){const le=n.aR((C.x+(ee+Mo(ee))/Jn)/F),pe=n.aS((C.y+(te+Mo(te))/Jn)/F),fe=O.project(le,pe),be=te*ds+ee;Ma[2*be+0]=Math.round((fe.x*P.scale-P.x)*n.ag),Ma[2*be+1]=Math.round((fe.y*P.scale-P.y)*n.ag)}ps.fill(0),ks.fill(0);for(let te=2045;te>=0;te--){const ee=4*te,le=Ps[ee+0],pe=Ps[ee+1],fe=Ps[ee+2],be=Ps[ee+3],me=le+fe>>1,ve=pe+be>>1,_e=me+ve-pe,Ee=ve+le-me,ze=pe*ds+le,Ye=be*ds+fe,qe=ve*ds+me,lt=Math.hypot((Ma[2*ze+0]+Ma[2*Ye+0])/2-Ma[2*qe+0],(Ma[2*ze+1]+Ma[2*Ye+1])/2-Ma[2*qe+1])>=16;ps[qe]=ps[qe]||(lt?1:0),te<1022&&(ps[qe]=ps[qe]||ps[(pe+Ee>>1)*ds+(le+_e>>1)]||ps[(be+Ee>>1)*ds+(fe+_e>>1)])}const V=new n.aT,U=new n.aU;let H=0;function J(te,ee){const le=ee*ds+te;return ks[le]===0&&(V.emplaceBack(Ma[2*le+0],Ma[2*le+1],te*n.ag/Jn,ee*n.ag/Jn),ks[le]=++H),ks[le]-1}function $(te,ee,le,pe,fe,be){const me=te+le>>1,ve=ee+pe>>1;if(Math.abs(te-fe)+Math.abs(ee-be)>1&&ps[ve*ds+me])$(fe,be,te,ee,me,ve),$(le,pe,fe,be,me,ve);else{const _e=J(te,ee),Ee=J(le,pe),ze=J(fe,be);U.emplaceBack(_e,Ee,ze)}}return $(0,0,Jn,Jn,Jn,0),$(Jn,Jn,0,0,0,Jn),{vertices:V,indices:U}}(this.tileID.canonical,r);p=b.vertices,_=b.indices}else{p=new n.aT,_=new n.aU;for(const{x:C,y:O}of u)p.emplaceBack(C,O,0,0);const b=n.b8(p.int16,void 0,4);for(let C=0;C<b.length;C+=3)_.emplaceBack(b[C],b[C+1],b[C+2])}this._tileBoundsBuffer=t.createVertexBuffer(p,n.b9.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(_),this._tileBoundsSegments=n.b7.simpleSegment(0,0,p.length,_.length)}_makeGlobeTileDebugBuffers(t,r){const u=r.projection;if(!u||u.name!=="globe"||r.freezeTileCoverage)return;const p=this.tileID.canonical,_=n.ba(p,r),b=n.bb(_),C=n.ae(r.zoom);let O;C>0&&(O=n.ab.mat4.invert(new Float64Array(16),r.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,p,r,b,O,C),this._makeGlobeTileDebugTextBuffer(t,p,r,b,O,C)}_globePoint(t,r,u,p,_,b,C){let O=n.bc(t,r,u);if(b){const P=1<<u.z,F=n.at(p.center.lng),V=n.aA(p.center.lat),U=(u.x+.5)/P-F;let H=0;U>.5?H=-1:U<-.5&&(H=1);let J=(t/n.ag+u.x)/P+H,$=(r/n.ag+u.y)/P;J=(J-F)*p._pixelsPerMercatorPixel+F,$=($-V)*p._pixelsPerMercatorPixel+V;const te=[J*p.worldSize,$*p.worldSize,0];n.ab.vec3.transformMat4(te,te,b),O=n.bd(O,te,C)}return n.ab.vec3.transformMat4(O,O,_)}_makeGlobeTileDebugBorderBuffer(t,r,u,p,_,b){const C=new n.b4,O=new n.b5,P=new n.be,F=(U,H,J,$,te)=>{const ee=(J-U)/(te-1),le=($-H)/(te-1),pe=C.length;for(let fe=0;fe<te;fe++){const be=U+fe*ee,me=H+fe*le;C.emplaceBack(be,me);const ve=this._globePoint(be,me,r,u,p,_,b);P.emplaceBack(ve[0],ve[1],ve[2]),O.emplaceBack(pe+fe)}},V=n.ag;F(0,0,V,0,16),F(V,0,V,V,16),F(V,V,0,V,16),F(0,V,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(O),this._tileDebugBuffer=t.createVertexBuffer(C,n.b6.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(P,n.bf.members),this._tileDebugSegments=n.b7.simpleSegment(0,0,C.length,O.length)}_makeGlobeTileDebugTextBuffer(t,r,u,p,_,b){const C=n.ag/4,O=new n.b4,P=new n.aU,F=new n.be,V=25;P.reserve(32),O.reserve(V),F.reserve(V);const U=(H,J)=>V*H+J;for(let H=0;H<V;H++){const J=H*C;for(let $=0;$<V;$++){const te=$*C;O.emplaceBack(te,J);const ee=this._globePoint(te,J,r,u,p,_,b);F.emplaceBack(ee[0],ee[1],ee[2])}}for(let H=0;H<4;H++)for(let J=0;J<4;J++){const $=U(H,J),te=U(H,J+1),ee=U(H+1,J),le=U(H+1,J+1);P.emplaceBack($,te,ee),P.emplaceBack(ee,te,le)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(P),this._tileDebugTextBuffer=t.createVertexBuffer(O,n.b6.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(F,n.bf.members),this._tileDebugTextSegments=n.b7.simpleSegment(0,0,V,32)}destroy(t=!1){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof n.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}n.bg.setPbf(n.bh);class Co extends Ao{constructor(t,r,u,p,_){super(t,r,u,p,_),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(t,r){const u=r.context,p=u.gl;this.texture=this.texture||r.getTileTexture(t.width),this.texture&&this.texture instanceof n.T?this.texture.update(t,{premultiply:!1}):this.texture=new n.T(u,t,p.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(t=16384,r){const u=this._mrt=new n.bg(30),p=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=n.bi(p,(_,b,C,O)=>{if(_)r(_);else try{const P=u.getHeaderLength(b);if(P>t)return void(this.request=this.fetchHeader(P,r));u.parseHeader(b),this._isHeaderLoaded=!0;let F=0;for(const V of Object.values(u.layers))F=Math.max(F,V.dataIndex[V.dataIndex.length-1].last_byte);b.byteLength>=F&&(this.entireBuffer=b),r(null,this.entireBuffer||b,C,O)}catch(P){r(P)}}),this.request}fetchBand(t,r,u){const p=this._mrt;if(!this._isHeaderLoaded||!p)return void u(new Error("Tile header is not ready"));const _=this.actor;if(!_)return void u(new Error("Can't fetch tile band without an actor"));let b;const C=(V,U)=>{b.complete(V,U),V?u(V):(this.updateTextureDescriptor(t,r),u(null,this.textureDescriptor&&this.textureDescriptor.img))},O=(V,U)=>{if(V)return u(V);const H=_.send("decodeRasterArray",{buffer:U,task:b},C,void 0,!0);this._workQueue.push(()=>{H&&H.cancel(),b.cancel()})},P=p.getLayer(t);if(!P)return void u(new Error(`Unknown sourceLayer "${t}"`));if(P.hasDataForBand(r))return this.updateTextureDescriptor(t,r),void u(null,this.textureDescriptor?this.textureDescriptor.img:null);const F=P.getDataRange([r]);if(b=p.createDecodingTask(F),!b||b.tasks.length)if(this.flushQueues(),this.entireBuffer)O(null,this.entireBuffer.slice(F.firstByte,F.lastByte+1));else{const V=Object.assign({},this.requestParams,{headers:{Range:`bytes=${F.firstByte}-${F.lastByte}`}}),U=n.bi(V,O);this._fetchQueue.push(()=>{U.cancel(),b.cancel()})}else u(null)}updateNeeded(t,r){return(!this.textureDescriptor||this.textureDescriptor.band!==r||this.textureDescriptor.layer!==t)&&this.state!=="errored"}updateTextureDescriptor(t,r){if(!this._mrt)return;const u=this._mrt.getLayer(t);if(!u||!u.hasBand(r)||!u.hasDataForBand(r))return;const{bytes:p,tileSize:_,buffer:b,offset:C,scale:O}=u.getBandView(r),P=_+2*b,F={data:p,width:P,height:P},V=this.texture;V&&V instanceof n.T&&V.update(F,{premultiply:!1}),this.textureDescriptor={layer:t,band:r,img:F,buffer:b,offset:C,tileSize:_,format:u.pixelFormat,mix:[O,256*O,65536*O,16777216*O]}}}class jh{constructor(t,r){this.max=t,this.onRemove=r,this.reset()}reset(){for(const t in this.data)for(const r of this.data[t])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(t,r,u){const p=t.wrapped().key;this.data[p]===void 0&&(this.data[p]=[]);const _={value:r,timeout:void 0};if(u!==void 0&&(_.timeout=setTimeout(()=>{this.remove(t,_)},u)),this.data[p].push(_),this.order.push(p),this.order.length>this.max){const b=this._getAndRemoveByKey(this.order[0]);b&&this.onRemove(b)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const r=this.data[t].shift();return r.timeout&&clearTimeout(r.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),r.value}getByKey(t){const r=this.data[t];return r?r[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,r){if(!this.has(t))return this;const u=t.wrapped().key,p=r===void 0?0:this.data[u].indexOf(r),_=this.data[u][p];return this.data[u].splice(p,1),_.timeout&&clearTimeout(_.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(_.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(t){const r=[];for(const u in this.data)for(const p of this.data[u])t(p.value)||r.push(p);for(const u of r)this.remove(u.value.tileID,u)}}class Kf{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,r,u){const p=String(r);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][p]=this.stateChanges[t][p]||{},n.l(this.stateChanges[t][p],u),this.deletedStates[t]===null){this.deletedStates[t]={};for(const _ in this.state[t])_!==p&&(this.deletedStates[t][_]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][p]===null){this.deletedStates[t][p]={};for(const _ in this.state[t][p])u[_]||(this.deletedStates[t][p][_]=null)}else for(const _ in u)this.deletedStates[t]&&this.deletedStates[t][p]&&this.deletedStates[t][p][_]===null&&delete this.deletedStates[t][p][_]}removeFeatureState(t,r,u){if(this.deletedStates[t]===null)return;const p=String(r);if(this.deletedStates[t]=this.deletedStates[t]||{},u&&r!==void 0)this.deletedStates[t][p]!==null&&(this.deletedStates[t][p]=this.deletedStates[t][p]||{},this.deletedStates[t][p][u]=null);else if(r!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][p])for(u in this.deletedStates[t][p]={},this.stateChanges[t][p])this.deletedStates[t][p][u]=null;else this.deletedStates[t][p]=null;else this.deletedStates[t]=null}getState(t,r){const u=this.state[t]||{},p=this.stateChanges[t]||{},_=this.deletedStates[t];if(_===null)return{};if(r!==void 0){const C=String(r),O=n.l({},u[C],p[C]);if(_){const P=_[r];if(P===null)return{};for(const F in P)delete O[F]}return O}const b=n.l({},u,p);if(_)for(const C in _)delete b[C];return b}initializeTileState(t,r){t.refreshFeatureState(r)}coalesceChanges(t,r){const u={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const _={};for(const b in this.stateChanges[p])this.state[p][b]||(this.state[p][b]={}),n.l(this.state[p][b],this.stateChanges[p][b]),_[b]=this.state[p][b];u[p]=_}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const _={};if(this.deletedStates[p]===null)for(const b in this.state[p])_[b]={},this.state[p][b]={};else for(const b in this.deletedStates[p]){if(this.deletedStates[p][b]===null)this.state[p][b]={};else if(this.state[p][b])for(const C of Object.keys(this.deletedStates[p][b]))delete this.state[p][b][C];_[b]=this.state[p][b]}u[p]=u[p]||{},n.l(u[p],_)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(const p in t)t[p].refreshFeatureState(r)}}class ms extends n.E{constructor(t,r,u){super(),this.id=t,this._onlySymbols=u,r.on("data",p=>{p.dataType==="source"&&p.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&p.dataType==="source"&&p.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),r.on("error",()=>{this._sourceErrored=!0}),this._source=r,this._tiles={},this._cache=new jh(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=r.minTileCacheSize,this._maxTileCacheSize=r.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Kf,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles){const r=this._tiles[t];if(r.state!=="loaded"&&r.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,r){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,r)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const u=this._tiles[r];u.upload(t),u.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return n.bj(this._tiles).map(t=>t.tileID).sort(nr).map(t=>t.key)}getRenderableIds(t,r){const u=[];for(const p in this._tiles)this._isIdRenderable(+p,t,r)&&u.push(this._tiles[p]);return t?u.sort((p,_)=>{const b=p.tileID,C=_.tileID,O=new n.P(b.canonical.x,b.canonical.y)._rotate(this.transform.angle),P=new n.P(C.canonical.x,C.canonical.y)._rotate(this.transform.angle);return b.overscaledZ-C.overscaledZ||P.y-O.y||P.x-O.x}).map(p=>p.tileID.key):u.map(p=>p.tileID).sort(nr).map(p=>p.key)}hasRenderableParent(t){const r=this.findLoadedParent(t,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(t,r,u){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(r||!this._tiles[t].holdingForFade())&&(u||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,r){const u=this._tiles[t];u&&(u.state!=="loading"&&(u.state=r),this._loadTile(u,this._tileLoaded.bind(this,u,t,r)))}_tileLoaded(t,r,u,p){if(p)if(t.state="errored",p.status!==404)this._source.fire(new n.y(p,{tile:t}));else{if(this._source.fire(new n.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const _=this.map.painter.terrain;this.update(this.transform,_.getScaledDemTileSize(),!0),_.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=n.q.now(),u==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(r,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new n.z("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const r=this.getRenderableIds();for(let p=0;p<r.length;p++){const _=r[p];if(t.neighboringTiles&&t.neighboringTiles[_]){const b=this.getTileByID(_);u(t,b),u(b,t)}}function u(p,_){if(!p.dem||p.dem.borderReady)return;p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0;let b=_.tileID.canonical.x-p.tileID.canonical.x;const C=_.tileID.canonical.y-p.tileID.canonical.y,O=Math.pow(2,p.tileID.canonical.z),P=_.tileID.key;b===0&&C===0||Math.abs(C)>1||(Math.abs(b)>1&&(Math.abs(b+O)===1?b+=O:Math.abs(b-O)===1&&(b-=O)),_.dem&&p.dem&&(p.dem.backfillBorder(_.dem,b,C),p.neighboringTiles&&p.neighboringTiles[P]&&(p.neighboringTiles[P].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,r,u,p){for(const _ in this._tiles){let b=this._tiles[_];if(p[_]||!b.hasData()||b.tileID.overscaledZ<=r||b.tileID.overscaledZ>u)continue;let C=b.tileID;for(;b&&b.tileID.overscaledZ>r+1;){const P=b.tileID.scaledTo(b.tileID.overscaledZ-1);b=this._tiles[P.key],b&&b.hasData()&&(C=P)}let O=C;for(;O.overscaledZ>r;)if(O=O.scaledTo(O.overscaledZ-1),t[O.key]){p[C.key]=C;break}}}findLoadedParent(t,r){if(t.key in this._loadedParentTiles){const u=this._loadedParentTiles[t.key];return u&&u.tileID.overscaledZ>=r?u:null}for(let u=t.overscaledZ-1;u>=r;u--){const p=t.scaledTo(u),_=this._getLoadedTile(p);if(_)return _}}_getLoadedTile(t){const r=this._tiles[t.key];return r&&r.hasData()?r:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,r){r=r||this._source.tileSize;const u=Math.ceil(t.width/r)+1,p=Math.ceil(t.height/r)+1,_=Math.floor(u*p*5),b=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,_):_,C=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,b):b;this._cache.setMaxSize(C)}handleWrapJump(t){const r=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,r){const u={};for(const p in this._tiles){const _=this._tiles[p];_.tileID=_.tileID.unwrapTo(_.tileID.wrap+r),u[_.tileID.key]=_}this._tiles=u;for(const p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(const p in this._tiles)this._setTileReloadTimer(+p,this._tiles[p])}}update(t,r,u,p){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!u)return;this.updateCacheSize(t,r),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const _=this._source.type==="batched-model";let b,C=this._source.maxzoom;const O=this.map&&this.map.painter?this.map.painter._terrain:null;if(O&&O.sourceCache===this&&O.attenuationRange()){const V=O.attenuationRange()[0],U=Math.floor(V)-Math.log2(O.getDemUpscale());C>U&&(C=U)}if(this.used||this.usedForTerrain){if(this._source.tileID)b=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(V=>new n.aG(V.canonical.z,V.wrap,V.canonical.z,V.canonical.x,V.canonical.y));else if(this.tileCoverLift!==0){const V=t.clone();V.tileCoverLift=this.tileCoverLift,b=V.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:C,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:_}),this._source.minzoom<=1&&t.projection.name==="globe"&&(b.push(new n.aG(1,0,1,0,0)),b.push(new n.aG(1,0,1,1,0)),b.push(new n.aG(1,0,1,0,1)),b.push(new n.aG(1,0,1,1,1)))}else if(b=t.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:C,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:_}),this._source.hasTile){const V=this._source.hasTile.bind(this._source);b=b.filter(U=>V(U))}}else b=[];if(b.length>0&&this.castsShadows&&p&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!ku(this._source.type)){const V=t.coveringZoomLevel({tileSize:r||this._source.tileSize,roundZoom:this._source.roundZoom&&!u}),U=Math.min(V,this._source.maxzoom);if(_){const H=t.extendTileCover(b,U);for(const J of H)b.push(J)}else{const H=t.extendTileCover(b,U,p);for(const J of H)this._shadowCasterTiles[J.key]=!0,b.push(J)}}const P=this._updateRetainedTiles(b);if(ku(this._source.type)&&b.length!==0){const V={},U={},H=Object.keys(P);for(const $ of H){const te=P[$],ee=this._tiles[$];if(!ee||ee.fadeEndTime&&ee.fadeEndTime<=n.q.now())continue;const le=this.findLoadedParent(te,Math.max(te.overscaledZ-ms.maxOverzooming,this._source.minzoom));le&&(this._addTile(le.tileID),V[le.tileID.key]=le.tileID),U[$]=te}const J=b[b.length-1].overscaledZ;for(const $ in this._tiles){const te=this._tiles[$];if(P[$]||!te.hasData())continue;let ee=te.tileID;for(;ee.overscaledZ>J;){ee=ee.scaledTo(ee.overscaledZ-1);const le=this._tiles[ee.key];if(le&&le.hasData()&&U[ee.key]){P[$]=te.tileID;break}}}for(const $ in V)P[$]||(this._coveredTiles[$]=!0,P[$]=V[$])}for(const V in P)this._tiles[V].clearFadeHold();const F=n.bk(this._tiles,P);for(const V of F){const U=this._tiles[V];U.hasSymbolBuckets&&!U.holdingForFade()?U.setHoldDuration(this.map._fadeDuration):U.hasSymbolBuckets&&!U.symbolFadeFinished()||this._removeTile(+V)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const r={};if(t.length===0)return r;const u={},p=t.reduce((P,F)=>Math.min(P,F.overscaledZ),1/0),_=t[0].overscaledZ,b=Math.max(_-ms.maxOverzooming,this._source.minzoom),C=Math.max(_+ms.maxUnderzooming,this._source.minzoom),O={};for(const P of t){const F=this._addTile(P);r[P.key]=P,F.hasData()||p<this._source.maxzoom&&(O[P.key]=P)}this._retainLoadedChildren(O,p,C,r);for(const P of t){let F=this._tiles[P.key];if(F.hasData())continue;if(P.canonical.z>=this._source.maxzoom){const U=P.children(this._source.maxzoom)[0],H=this.getTile(U);if(H&&H.hasData()){r[U.key]=U;continue}}else{const U=P.children(this._source.maxzoom);if(r[U[0].key]&&r[U[1].key]&&r[U[2].key]&&r[U[3].key])continue}let V=F.wasRequested();for(let U=P.overscaledZ-1;U>=b;--U){const H=P.scaledTo(U);if(u[H.key]||(u[H.key]=!0,F=this.getTile(H),!F&&V&&(F=this._addTile(H)),F&&(r[H.key]=H,V=F.wasRequested(),F.hasData())))break}}return r}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const r=[];let u,p=this._tiles[t].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){u=this._loadedParentTiles[p.key];break}r.push(p.key);const _=p.scaledTo(p.overscaledZ-1);if(u=this._getLoadedTile(_),u)break;p=_}for(const _ of r)this._loadedParentTiles[_]=u}}_addTile(t){let r=this._tiles[t.key];if(r)return r.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),r;r=this._cache.getAndRemove(t),r&&(this._setTileReloadTimer(t.key,r),r.tileID=t,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,r)));const u=!!r;if(!u){const p=this.map?this.map.painter:null,_=this._source.tileSize*t.overscaleFactor();r=this._source.type==="raster-array"?new Co(t,_,this.transform.tileZoom,p,this._isRaster):new Ao(t,_,this.transform.tileZoom,p,this._isRaster),this._loadTile(r,this._tileLoaded.bind(this,r,t.key,r.state))}return r?(r.uses++,this._tiles[t.key]=r,u||this._source.fire(new n.z("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r):null}_setTileReloadTimer(t,r){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const u=r.getExpiryTimeout();u&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},u))}_removeTile(t){const r=this._tiles[t];r&&(r.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),r.uses>0||(r.hasData()&&r.state!=="reloading"||r.state==="empty"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,r,u){const p=[],_=this.transform;if(!_)return p;const b=_.projection.name==="globe",C=n.at(_.center.lng);for(const O in this._tiles){const P=this._tiles[O];if(u&&P.clearQueryDebugViz(),P.holdingForFade())continue;let F;if(b){const V=P.tileID.canonical;if(V.z===0){const U=[Math.abs(n.aw(C,...di(V,-1))-C),Math.abs(n.aw(C,...di(V,1))-C)];F=[0,2*U.indexOf(Math.min(...U))-1]}else{const U=[Math.abs(n.aw(C,...di(V,-1))-C),Math.abs(n.aw(C,...di(V,0))-C),Math.abs(n.aw(C,...di(V,1))-C)];F=[U.indexOf(Math.min(...U))-1]}}else F=[0];for(const V of F){const U=t.containsTile(P,_,r,V);U&&p.push(U)}}return p}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,r){const u=this.getRenderableIds(t,r).map(_=>this._tiles[_].tileID),p=this.transform.projection.name==="globe";for(const _ of u)_.projMatrix=this.transform.calculateProjMatrix(_.toUnwrapped()),_.expandedProjMatrix=p?this.transform.calculateProjMatrix(_.toUnwrapped(),!1,!0):_.projMatrix;return u}sortCoordinatesByDistance(t){const r=t.slice(),u=this.transform._camera.position,p=this.transform._camera.forward(),_={};for(const b of r){const C=1/(1<<b.canonical.z);_[b.key]=((b.canonical.x+.5)*C+b.wrap-u[0])*p[0]+((b.canonical.y+.5)*C-u[1])*p[1]-u[2]*p[2]}return r.sort((b,C)=>_[b.key]-_[C.key]),r}hasTransition(){if(this._source.hasTransition())return!0;if(ku(this._source.type))for(const t in this._tiles){const r=this._tiles[t];if(r.fadeEndTime!==void 0&&r.fadeEndTime>=n.q.now())return!0}return!1}setFeatureState(t,r,u){this._state.updateState(t=t||"_geojsonTileLayer",r,u)}removeFeatureState(t,r,u){this._state.removeFeatureState(t=t||"_geojsonTileLayer",r,u)}getFeatureState(t,r){return this._state.getState(t=t||"_geojsonTileLayer",r)}setDependencies(t,r,u){const p=this._tiles[t];p&&p.setDependencies(r,u)}reloadTilesForDependencies(t,r){for(const u in this._tiles)this._tiles[u].hasDependency(t,r)&&this._reloadTile(+u,"reloading");this._cache.filter(u=>!u.hasDependency(t,r))}_preloadTiles(t,r){if(!this._sourceLoaded){const O=()=>{this._sourceLoaded&&(this._source.off("data",O),this._preloadTiles(t,r))};return void this._source.on("data",O)}const u=new Map,p=Array.isArray(t)?t:[t],_=this.map.painter.terrain,b=this.usedForTerrain&&_?_.getScaledDemTileSize():this._source.tileSize;for(const O of p){const P=O.coveringTiles({tileSize:b,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const F of P)u.set(F.key,F);this.usedForTerrain&&O.updateElevation(!1)}const C=Array.from(u.values());n.bl(C,(O,P)=>{const F=new Ao(O,this._source.tileSize*O.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(F,V=>{this._source.type==="raster-dem"&&F.dem&&this._backfillDEM(F),P(V,F)})},r)}}function nr(c,t){const r=Math.abs(2*c.wrap)-+(c.wrap<0),u=Math.abs(2*t.wrap)-+(t.wrap<0);return c.overscaledZ-t.overscaledZ||u-r||t.canonical.y-c.canonical.y||t.canonical.x-c.canonical.x}function ku(c){return c==="raster"||c==="image"||c==="video"||c==="custom"}function di(c,t){const r=1<<c.z;return[c.x/r+t,(c.x+1)/r+t]}ms.maxOverzooming=10,ms.maxUnderzooming=3;class Xl{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const t=!1,r=!1;for(const u in this.style._mergedLayers){const p=this.style._mergedLayers[u];if(p.type==="fill-extrusion")this.layers.push({layer:p,visible:t,visibilityChanged:r});else if(p.type==="model"){const _=this.style.getLayerSource(p);_&&_.type==="batched-model"&&this.layers.push({layer:p,visible:t,visibilityChanged:r})}}}onNewFrame(t){this.layersGotHidden=!1;for(const r of this.layers){const u=r.layer;let p=!1;u.type==="fill-extrusion"?p=!u.isHidden(t)&&u.paint.get("fill-extrusion-opacity")>0:u.type==="model"&&(p=!u.isHidden(t)&&u.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!p&&r.visible,r.visible=p}}updateZOffset(t,r){this.currentBuildingBuckets=[];for(const p of this.layers){const _=p.layer,b=this.style.getLayerSourceCache(_);let C=1;_.type==="fill-extrusion"&&(C=p.visible?_.paint.get("fill-extrusion-vertical-scale"):0);let O=b?b.getTile(r):null;if(!O&&b&&r.canonical.z>b.getSource().minzoom){let P=r.scaledTo(Math.min(b.getSource().maxzoom,r.overscaledZ-1));for(;P.overscaledZ>=b.getSource().minzoom&&(O=b.getTile(P),!O&&P.overscaledZ!==0);)P=P.scaledTo(P.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:O?O.getBucket(_):null,tileID:O?O.tileID:r,verticalScale:C})}t.hasAnyZOffset=!1;let u=!1;for(let p=0;p<t.symbolInstances.length;p++){const _=t.symbolInstances.get(p),b=_.zOffset,C=this._getHeightAtTileOffset(r,_.tileAnchorX,_.tileAnchorY);_.zOffset=C!==Number.NEGATIVE_INFINITY?C:b,u||b===_.zOffset||(u=!0),t.hasAnyZOffset||_.zOffset===0||(t.hasAnyZOffset=!0)}u&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,r,u,p){let _=r,b=u;if(t.canonical.z!==p.canonical.z){const C=p.canonical,O=1/(1<<t.canonical.z-C.z);_=(r+t.canonical.x*n.ag)*O-C.x*n.ag|0,b=(u+t.canonical.y*n.ag)*O-C.y*n.ag|0}return{tileX:_,tileY:b}}_getHeightAtTileOffset(t,r,u){let p,_;for(let b=0;b<this.layers.length;++b){if(this.layers[b].layer.type!=="fill-extrusion")continue;const{bucket:C,tileID:O,verticalScale:P}=this.currentBuildingBuckets[b];if(!C)continue;const{tileX:F,tileY:V}=this._mapCoordToOverlappingTile(t,r,u,O),U=C.getHeightAtTileCoord(F,V);U&&U.height!==void 0&&(U.hidden?p=U.height:_=Math.max(U.height*P,_||0))}if(_!==void 0)return _;for(let b=0;b<this.layers.length;++b){const C=this.layers[b];if(C.layer.type!=="model"||!C.visible)continue;const{bucket:O,tileID:P}=this.currentBuildingBuckets[b];if(!O)continue;const{tileX:F,tileY:V}=this._mapCoordToOverlappingTile(t,r,u,P),U=O.getHeightAtTileCoord(F,V);if(U&&!U.hidden)return U.height===void 0&&p!==void 0?Math.min(U.maxHeight,p)*U.verticalScale:U.height?U.height*U.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Do(c,t){const r={};for(const u in c)u!=="ref"&&(r[u]=c[u]);return n.bm.forEach(u=>{u in t&&(r[u]=t[u])}),r}function Fu(c){c=c.slice();const t=Object.create(null);for(let r=0;r<c.length;r++)t[c[r].id]=c[r];for(let r=0;r<c.length;r++)"ref"in c[r]&&(c[r]=Do(c[r],t[c[r].ref]));return c}const Vi={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function Bu(c,t,r){r.push({command:Vi.addSource,args:[c,t[c]]})}function Fs(c,t,r){t.push({command:Vi.removeSource,args:[c]}),r[c]=!0}function Qt(c,t,r,u){Fs(c,r,u),Bu(c,t,r)}function or(c,t,r){let u;for(u in c[r])if(c[r].hasOwnProperty(u)&&u!=="data"&&!n.bn(c[r][u],t[r][u]))return!1;for(u in t[r])if(t[r].hasOwnProperty(u)&&u!=="data"&&!n.bn(c[r][u],t[r][u]))return!1;return!0}function Hi(c,t,r,u,p,_){let b;for(b in t=t||{},c=c||{})c.hasOwnProperty(b)&&(n.bn(c[b],t[b])||r.push({command:_,args:[u,b,t[b],p]}));for(b in t)t.hasOwnProperty(b)&&!c.hasOwnProperty(b)&&(n.bn(c[b],t[b])||r.push({command:_,args:[u,b,t[b],p]}))}function Un(c){return c.id}function _s(c,t){return c[t.id]=t,c}class ar{constructor(t,r){this.reset(t,r)}reset(t,r){this.points=t||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(r||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=n.aw(t,0,1);let r=1,u=this._distances[r];const p=t*this.paddedLength+this.padding;for(;u<p&&r<this._distances.length;)u=this._distances[++r];const _=r-1,b=this._distances[_],C=u-b,O=C>0?(p-b)/C:0;return this.points[_].mult(1-O).add(this.points[r].mult(O))}}class il{constructor(t,r,u){const p=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(t/u),this.yCellCount=Math.ceil(r/u);for(let b=0;b<this.xCellCount*this.yCellCount;b++)p.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=r,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/r,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,r,u,p,_){this._forEachCell(r,u,p,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(r),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(_)}insertCircle(t,r,u,p){this._forEachCell(r-p,u-p,r+p,u+p,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(r),this.circles.push(u),this.circles.push(p)}_insertBoxCell(t,r,u,p,_,b){this.boxCells[_].push(b)}_insertCircleCell(t,r,u,p,_,b){this.circleCells[_].push(b)}_query(t,r,u,p,_,b){if(u<0||t>this.width||p<0||r>this.height)return!_&&[];const C=[];if(t<=0&&r<=0&&this.width<=u&&this.height<=p){if(_)return!0;for(let O=0;O<this.boxKeys.length;O++)C.push({key:this.boxKeys[O],x1:this.bboxes[4*O],y1:this.bboxes[4*O+1],x2:this.bboxes[4*O+2],y2:this.bboxes[4*O+3]});for(let O=0;O<this.circleKeys.length;O++){const P=this.circles[3*O],F=this.circles[3*O+1],V=this.circles[3*O+2];C.push({key:this.circleKeys[O],x1:P-V,y1:F-V,x2:P+V,y2:F+V})}return b?C.filter(b):C}return this._forEachCell(t,r,u,p,this._queryCell,C,{hitTest:_,seenUids:{box:{},circle:{}}},b),_?C.length>0:C}_queryCircle(t,r,u,p,_){const b=t-u,C=t+u,O=r-u,P=r+u;if(C<0||b>this.width||P<0||O>this.height)return!p&&[];const F=[];return this._forEachCell(b,O,C,P,this._queryCellCircle,F,{hitTest:p,circle:{x:t,y:r,radius:u},seenUids:{box:{},circle:{}}},_),p?F.length>0:F}query(t,r,u,p,_){return this._query(t,r,u,p,!1,_)}hitTest(t,r,u,p,_){return this._query(t,r,u,p,!0,_)}hitTestCircle(t,r,u,p){return this._queryCircle(t,r,u,!0,p)}_queryCell(t,r,u,p,_,b,C,O){const P=C.seenUids,F=this.boxCells[_];if(F!==null){const U=this.bboxes;for(const H of F)if(!P.box[H]){P.box[H]=!0;const J=4*H;if(t<=U[J+2]&&r<=U[J+3]&&u>=U[J+0]&&p>=U[J+1]&&(!O||O(this.boxKeys[H]))){if(C.hitTest)return b.push(!0),!0;b.push({key:this.boxKeys[H],x1:U[J],y1:U[J+1],x2:U[J+2],y2:U[J+3]})}}}const V=this.circleCells[_];if(V!==null){const U=this.circles;for(const H of V)if(!P.circle[H]){P.circle[H]=!0;const J=3*H;if(this._circleAndRectCollide(U[J],U[J+1],U[J+2],t,r,u,p)&&(!O||O(this.circleKeys[H]))){if(C.hitTest)return b.push(!0),!0;{const $=U[J],te=U[J+1],ee=U[J+2];b.push({key:this.circleKeys[H],x1:$-ee,y1:te-ee,x2:$+ee,y2:te+ee})}}}}}_queryCellCircle(t,r,u,p,_,b,C,O){const P=C.circle,F=C.seenUids,V=this.boxCells[_];if(V!==null){const H=this.bboxes;for(const J of V)if(!F.box[J]){F.box[J]=!0;const $=4*J;if(this._circleAndRectCollide(P.x,P.y,P.radius,H[$+0],H[$+1],H[$+2],H[$+3])&&(!O||O(this.boxKeys[J])))return b.push(!0),!0}}const U=this.circleCells[_];if(U!==null){const H=this.circles;for(const J of U)if(!F.circle[J]){F.circle[J]=!0;const $=3*J;if(this._circlesCollide(H[$],H[$+1],H[$+2],P.x,P.y,P.radius)&&(!O||O(this.circleKeys[J])))return b.push(!0),!0}}}_forEachCell(t,r,u,p,_,b,C,O){const P=this._convertToXCellCoord(t),F=this._convertToYCellCoord(r),V=this._convertToXCellCoord(u),U=this._convertToYCellCoord(p);for(let H=P;H<=V;H++)for(let J=F;J<=U;J++)if(_.call(this,t,r,u,p,this.xCellCount*J+H,b,C,O))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,r,u,p,_,b){const C=p-t,O=_-r,P=u+b;return P*P>C*C+O*O}_circleAndRectCollide(t,r,u,p,_,b,C){const O=(b-p)/2,P=Math.abs(t-(p+O));if(P>O+u)return!1;const F=(C-_)/2,V=Math.abs(r-(_+F));if(V>F+u)return!1;if(P<=O||V<=F)return!0;const U=P-O,H=V-F;return U*U+H*H<=u*u}}const $a={unknown:0,flipRequired:1,flipNotRequired:2},Bc=Math.tan(85*Math.PI/180);function Or(c,t,r,u,p,_,b){const C=n.ab.mat4.create();if(r)if(_.name==="globe"){const O=n.bo(p,t);n.ab.mat4.multiply(C,C,O)}else{const O=n.ab.mat2.invert([],b);C[0]=O[0],C[1]=O[1],C[4]=O[2],C[5]=O[3],u||n.ab.mat4.rotateZ(C,C,p.angle)}else n.ab.mat4.multiply(C,p.labelPlaneMatrix,c);return C}function Lr(c,t,r,u,p,_,b){const C=Or(c,t,r,u,p,_,b);return _.name==="globe"&&r||(C[2]=C[6]=C[10]=C[14]=0),C}function Nc(c,t,r,u,p,_,b){if(r){if(_.name==="globe"){const C=Or(c,t,r,u,p,_,b);return n.ab.mat4.invert(C,C),n.ab.mat4.multiply(C,c,C),C}{const C=n.ab.mat4.clone(c),O=n.ab.mat4.identity([]);return O[0]=b[0],O[1]=b[1],O[4]=b[2],O[5]=b[3],n.ab.mat4.multiply(C,C,O),u||n.ab.mat4.rotateZ(C,C,-p.angle),C}}return p.glCoordMatrix}function jn(c,t,r,u){const p=[c,t,r,1];r?n.ab.vec4.transformMat4(p,p,u):gs(p,p,u);const _=p[3];return p[0]/=_,p[1]/=_,p[2]/=_,p}function qh(c,t){return Math.min(.5+c/t*.5,1.5)}function Yl(c,t){const r=c[0]/c[3],u=c[1]/c[3];return r>=-t[0]&&r<=t[0]&&u>=-t[1]&&u<=t[1]}function Vc(c,t,r,u,p,_,b,C,O,P){const F=r.transform,V=u?c.textSizeData:c.iconSizeData,U=n.bp(V,r.transform.zoom),H=F.projection.name==="globe",J=[256/r.width*2+1,256/r.height*2+1],$=u?c.text.dynamicLayoutVertexArray:c.icon.dynamicLayoutVertexArray;$.clear();let te=null;H&&(te=u?c.text.globeExtVertexArray:c.icon.globeExtVertexArray);const ee=c.lineVertexArray,le=u?c.text.placedSymbolArray:c.icon.placedSymbolArray,pe=r.transform.width/r.transform.height;let fe,be=!1;for(let me=0;me<le.length;me++){const ve=le.get(me),{numGlyphs:_e,writingMode:Ee}=ve;if(Ee!==n.bq.vertical||be||fe===n.bq.horizontal||(be=!0),fe=Ee,(ve.hidden||Ee===n.bq.vertical)&&!be){Hr(_e,$);continue}be=!1;const ze=new n.P(ve.tileAnchorX,ve.tileAnchorY);let{x:Ye,y:qe,z:lt}=F.projection.projectTilePoint(ze.x,ze.y,P.canonical);if(O){const[ct,vt,Ct]=O(ze);Ye+=ct,qe+=vt,lt+=Ct}const it=[Ye,qe,lt,1];if(n.ab.vec4.transformMat4(it,it,t),!Yl(it,J)){Hr(_e,$);continue}const Be=it[3],Ke=qh(r.transform.getCameraToCenterDistance(F.projection),Be),gt=n.br(V,U,ve),Fe=b?gt/Ke:gt*Ke,st=jn(Ye,qe,lt,p);if(st[3]<=0){Hr(_e,$);continue}let Je={};const St=b?null:O,dt=Bs(ve,Fe,!1,C,t,p,_,c.glyphOffsetArray,ee,$,te,st,ze,Je,pe,St,F.projection,P,b);be=dt.useVertical,St&&dt.needsFlipping&&(Je={}),(dt.notEnoughRoom||be||dt.needsFlipping&&Bs(ve,Fe,!0,C,t,p,_,c.glyphOffsetArray,ee,$,te,st,ze,Je,pe,St,F.projection,P,b).notEnoughRoom)&&Hr(_e,$)}u?(c.text.dynamicLayoutVertexBuffer.updateData($),te&&c.text.globeExtVertexBuffer&&c.text.globeExtVertexBuffer.updateData(te)):(c.icon.dynamicLayoutVertexBuffer.updateData($),te&&c.icon.globeExtVertexBuffer&&c.icon.globeExtVertexBuffer.updateData(te))}function Io(c,t,r,u,p,_,b,C,O,P,F,V,U,H,J,$){const{lineStartIndex:te,glyphStartIndex:ee,segment:le}=C,pe=ee+C.numGlyphs,fe=te+C.lineLength,be=t.getoffsetX(ee),me=t.getoffsetX(pe-1),ve=Ro(c*be,r,u,p,_,b,le,te,fe,O,P,F,V,U,!0,H,J,$);if(!ve)return null;const _e=Ro(c*me,r,u,p,_,b,le,te,fe,O,P,F,V,U,!0,H,J,$);return _e?{first:ve,last:_e}:null}function Rn(c,t,r,u){return c===n.bq.horizontal&&Math.abs(u)>Math.abs(r)?{useVertical:!0}:c===n.bq.vertical?u>0?{needsFlipping:!0}:null:t!==$a.unknown&&function(p,_){return p===0||Math.abs(_/p)>Bc}(r,u)?t===$a.flipRequired?{needsFlipping:!0}:null:r<0?{needsFlipping:!0}:null}function Bs(c,t,r,u,p,_,b,C,O,P,F,V,U,H,J,$,te,ee,le){const pe=t/24,fe=c.lineOffsetX*pe,be=c.lineOffsetY*pe,{lineStartIndex:me,glyphStartIndex:ve,numGlyphs:_e,segment:Ee,writingMode:ze,flipState:Ye}=c,qe=me+c.lineLength,lt=it=>{if(F){const[Fe,st,Je]=it.up,St=P.length;n.bs(F,St+0,Fe,st,Je),n.bs(F,St+1,Fe,st,Je),n.bs(F,St+2,Fe,st,Je),n.bs(F,St+3,Fe,st,Je)}const[Be,Ke,gt]=it.point;n.bt(P,Be,Ke,gt,it.angle)};if(_e>1){const it=Io(pe,C,fe,be,r,V,U,c,O,_,H,$,!1,te,ee,le);if(!it)return{notEnoughRoom:!0};if(u&&!r){let[Be,Ke,gt]=it.first.point,[Fe,st,Je]=it.last.point;[Be,Ke]=jn(Be,Ke,gt,b),[Fe,st]=jn(Fe,st,Je,b);const St=Rn(ze,Ye,(Fe-Be)*J,st-Ke);if(c.flipState=St&&St.needsFlipping?$a.flipRequired:$a.flipNotRequired,St)return St}lt(it.first);for(let Be=ve+1;Be<ve+_e-1;Be++){const Ke=Ro(pe*C.getoffsetX(Be),fe,be,r,V,U,Ee,me,qe,O,_,H,$,!1,!1,te,ee,le);if(!Ke)return P.length-=4*(Be-ve),{notEnoughRoom:!0};lt(Ke)}lt(it.last)}else{if(u&&!r){const Be=jn(U.x,U.y,0,p),Ke=me+Ee+1,gt=new n.P(O.getx(Ke),O.gety(Ke)),Fe=jn(gt.x,gt.y,0,p),st=Fe[3]>0?Fe:Jf(U,gt,Be,1,p,void 0,te,ee.canonical),Je=Rn(ze,Ye,(st[0]-Be[0])*J,st[1]-Be[1]);if(c.flipState=Je&&Je.needsFlipping?$a.flipRequired:$a.flipNotRequired,Je)return Je}const it=Ro(pe*C.getoffsetX(ve),fe,be,r,V,U,Ee,me,qe,O,_,H,$,!1,!1,te,ee,le);if(!it)return{notEnoughRoom:!0};lt(it)}return{}}function ea(c,t,r,u,p){const{x:_,y:b,z:C}=u.projectTilePoint(c.x,c.y,t);if(!p)return jn(_,b,C,r);const[O,P,F]=p(c);return jn(_+O,b+P,C+F,r)}function Jf(c,t,r,u,p,_,b,C){const O=ea(c.sub(t)._unit()._add(c),C,p,b,_);return n.ab.vec3.sub(O,r,O),n.ab.vec3.normalize(O,O),n.ab.vec3.scaleAndAdd(O,r,O,u)}function Ro(c,t,r,u,p,_,b,C,O,P,F,V,U,H,J,$,te,ee){const le=u?c-t:c+t;let pe=le>0?1:-1,fe=0;u&&(pe*=-1,fe=Math.PI),pe<0&&(fe+=Math.PI);let be=C+b+(pe>0?0:1)|0,me=p,ve=p,_e=0,Ee=0;const ze=Math.abs(le),Ye=[],qe=[];let lt=_,it=lt;const Be=()=>Jf(it,lt,ve,ze-_e+1,F,U,$,te.canonical);for(;_e+Ee<=ze;){if(be+=pe,be<C||be>=O)return null;if(ve=me,it=lt,Ye.push(ve),H&&qe.push(it),lt=new n.P(P.getx(be),P.gety(be)),me=V[be],!me){const vt=ea(lt,te.canonical,F,$,U);me=vt[3]>0?V[be]=vt:Be()}_e+=Ee,Ee=n.ab.vec3.distance(ve,me)}J&&U&&(V[be]&&(me=Be(),Ee=n.ab.vec3.distance(ve,me)),V[be]=me);const Ke=(ze-_e)/Ee,gt=lt.sub(it)._mult(Ke)._add(it),Fe=n.ab.vec3.sub([],me,ve),st=n.ab.vec3.scaleAndAdd([],ve,Fe,Ke);let Je=[0,0,1],St=Fe[0],dt=Fe[1];if(ee&&(Je=$.upVector(te.canonical,gt.x,gt.y),Je[0]!==0||Je[1]!==0||Je[2]!==1)){const vt=[Je[2],0,-Je[0]],Ct=n.ab.vec3.cross([],Je,vt);n.ab.vec3.normalize(vt,vt),n.ab.vec3.normalize(Ct,Ct),St=n.ab.vec3.dot(Fe,vt),dt=n.ab.vec3.dot(Fe,Ct)}if(r){const vt=n.ab.vec3.cross([],Je,Fe);n.ab.vec3.normalize(vt,vt),n.ab.vec3.scaleAndAdd(st,st,vt,r*pe)}const ct=fe+Math.atan2(dt,St);return Ye.push(st),H&&qe.push(gt),{point:st,angle:ct,path:Ye,tilePath:qe,up:Je}}function Hr(c,t){const r=t.length,u=r+4*c;t.resize(u),t.float32.fill(-1/0,4*r,4*u)}function gs(c,t,r){const u=t[0],p=t[1];return c[0]=r[0]*u+r[4]*p+r[12],c[1]=r[1]*u+r[5]*p+r[13],c[3]=r[3]*u+r[7]*p+r[15],c}const qn=100;class hn{constructor(t,r,u=new il(t.width+200,t.height+200,25),p=new il(t.width+200,t.height+200,25)){this.transform=t,this.grid=u,this.ignoredGrid=p,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+qn,this.screenBottomBoundary=t.height+qn,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=r}placeCollisionBox(t,r,u,p,_,b,C,O){let P=u.projectedAnchorX,F=u.projectedAnchorY,V=u.projectedAnchorZ;const U=u.elevation,H=u.tileID,J=t.getProjection();if(U&&H){const[me,ve,_e]=J.upVector(H.canonical,u.tileAnchorX,u.tileAnchorY),Ee=J.upVectorScale(H.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;P+=me*U*Ee,F+=ve*U*Ee,V+=_e*U*Ee}const $=this.projectAndGetPerspectiveRatio(C,P,F,V,u.tileID,J.name==="globe"||!!U||this.transform.pitch>0,J),te=b*$.perspectiveRatio,ee=(u.x1*r+p.x-u.padding)*te+$.point.x,le=(u.y1*r+p.y-u.padding)*te+$.point.y,pe=(u.x2*r+p.x+u.padding)*te+$.point.x,fe=(u.y2*r+p.y+u.padding)*te+$.point.y,be=$.perspectiveRatio<=.55||$.occluded;return!this.isInsideGrid(ee,le,pe,fe)||!_&&this.grid.hitTest(ee,le,pe,fe,O)||be?{box:[],offscreen:!1,occluded:$.occluded}:{box:[ee,le,pe,fe],offscreen:this.isOffscreen(ee,le,pe,fe),occluded:!1}}placeCollisionCircles(t,r,u,p,_,b,C,O,P,F,V,U,H,J,$){const te=[],ee=this.transform.elevation,le=t.getProjection(),pe=ee?ee.getAtTileOffsetFunc($,this.transform.center.lat,this.transform.worldSize,le):null,fe=new n.P(u.tileAnchorX,u.tileAnchorY);let{x:be,y:me,z:ve}=le.projectTilePoint(fe.x,fe.y,$.canonical);if(pe){const[gt,Fe,st]=pe(fe);be+=gt,me+=Fe,ve+=st}const _e=le.name==="globe",Ee=this.projectAndGetPerspectiveRatio(C,be,me,ve,$,_e||!!ee||this.transform.pitch>0,le),{perspectiveRatio:ze}=Ee,Ye=(V?b/ze:b*ze)/n.bw,qe=jn(be,me,ve,O),lt=Ee.signedDistanceFromCamera>0?Io(Ye,_,u.lineOffsetX*Ye,u.lineOffsetY*Ye,!1,qe,fe,u,p,O,{},ee&&!V?pe:null,V&&!!ee,le,$,V):null;let it=!1,Be=!1,Ke=!0;if(lt&&!Ee.occluded){const gt=.5*H*ze+J,Fe=new n.P(-100,-100),st=new n.P(this.screenRightBoundary,this.screenBottomBoundary),Je=new ar,{first:St,last:dt}=lt,ct=St.path.length;let vt=[];for(let Yt=ct-1;Yt>=1;Yt--)vt.push(St.path[Yt]);for(let Yt=1;Yt<dt.path.length;Yt++)vt.push(dt.path[Yt]);const Ct=2.5*gt;P&&(vt=vt.map(([Yt,ui,oi],ri)=>(pe&&!_e&&(oi=pe(ri<ct-1?St.tilePath[ct-1-ri]:dt.tilePath[ri-ct+2])[2]),jn(Yt,ui,oi,P))),vt.some(Yt=>Yt[3]<=0)&&(vt=[]));let Vt=[];if(vt.length>0){let Yt=1/0,ui=-1/0,oi=1/0,ri=-1/0;for(const xi of vt)Yt=Math.min(Yt,xi[0]),oi=Math.min(oi,xi[1]),ui=Math.max(ui,xi[0]),ri=Math.max(ri,xi[1]);ui>=Fe.x&&Yt<=st.x&&ri>=Fe.y&&oi<=st.y&&(Vt=[vt.map(xi=>new n.P(xi[0],xi[1]))],(Yt<Fe.x||ui>st.x||oi<Fe.y||ri>st.y)&&(Vt=n.bu(Vt,Fe.x,Fe.y,st.x,st.y)))}for(const Yt of Vt){Je.reset(Yt,.25*gt);let ui=0;ui=Je.length<=.5*gt?1:Math.ceil(Je.paddedLength/Ct)+1;for(let oi=0;oi<ui;oi++){const ri=oi/Math.max(ui-1,1),xi=Je.lerp(ri),bi=xi.x+qn,pr=xi.y+qn;te.push(bi,pr,gt,0);const Yr=bi-gt,Cr=pr-gt,Ai=bi+gt,rr=pr+gt;if(Ke=Ke&&this.isOffscreen(Yr,Cr,Ai,rr),Be=Be||this.isInsideGrid(Yr,Cr,Ai,rr),!r&&this.grid.hitTestCircle(bi,pr,gt,U)&&(it=!0,!F))return{circles:[],offscreen:!1,collisionDetected:it,occluded:!1}}}}return{circles:!F&&it||!Be?[]:te,offscreen:Ke,collisionDetected:it,occluded:Ee.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const r=[];let u=1/0,p=1/0,_=-1/0,b=-1/0;for(const F of t){const V=new n.P(F.x+qn,F.y+qn);u=Math.min(u,V.x),p=Math.min(p,V.y),_=Math.max(_,V.x),b=Math.max(b,V.y),r.push(V)}const C=this.grid.query(u,p,_,b).concat(this.ignoredGrid.query(u,p,_,b)),O={},P={};for(const F of C){const V=F.key;if(O[V.bucketInstanceId]===void 0&&(O[V.bucketInstanceId]={}),O[V.bucketInstanceId][V.featureIndex])continue;const U=[new n.P(F.x1,F.y1),new n.P(F.x2,F.y1),new n.P(F.x2,F.y2),new n.P(F.x1,F.y2)];n.bv(r,U)&&(O[V.bucketInstanceId][V.featureIndex]=!0,P[V.bucketInstanceId]===void 0&&(P[V.bucketInstanceId]=[]),P[V.bucketInstanceId].push(V.featureIndex))}return P}insertCollisionBox(t,r,u,p,_){(r?this.ignoredGrid:this.grid).insert({bucketInstanceId:u,featureIndex:p,collisionGroupID:_},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,r,u,p,_){const b=r?this.ignoredGrid:this.grid,C={bucketInstanceId:u,featureIndex:p,collisionGroupID:_};for(let O=0;O<t.length;O+=4)b.insertCircle(C,t[O],t[O+1],t[O+2])}projectAndGetPerspectiveRatio(t,r,u,p,_,b,C){const O=[r,u,p,1];let P=!1;p||this.transform.pitch>0?(n.ab.vec4.transformMat4(O,O,t),this.fogState&&_&&C.name!=="globe"&&(P=function(U,H,J,$,te,ee){const le=ee.calculateFogTileMatrix(te),pe=[H,J,$];return n.ab.vec3.transformMat4(pe,pe,le),De(U,n.ab.vec3.length(pe),ee.pitch,ee._fov)}(this.fogState,r,u,p,_.toUnwrapped(),this.transform)>.9)):gs(O,O,t);const F=O[3];return{point:new n.P((O[0]/F+1)/2*this.transform.width+qn,(-O[1]/F+1)/2*this.transform.height+qn),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(C)/F*.5,1.5),signedDistanceFromCamera:F,occluded:b&&O[2]>F||P}}isOffscreen(t,r,u,p){return u<qn||t>=this.screenRightBoundary||p<qn||r>this.screenBottomBoundary}isInsideGrid(t,r,u,p){return u>=0&&t<this.gridRightBoundary&&p>=0&&r<this.gridBottomBoundary}getViewportMatrix(){const t=n.ab.mat4.identity([]);return n.ab.mat4.translate(t,t,[-100,-100,0]),t}}function Nu(c,t,r){const u=t.createTileMatrix(c,c.worldSize,r.toUnwrapped());return n.ab.mat4.multiply(new Float32Array(16),c.projMatrix,u)}function Ns(c,t,r){if(t.projection.name===r.projection.name)return c.projMatrix;const u=r.clone();return u.setProjection(t.projection),Nu(u,t.getProjection(),c)}function rl(c,t,r){return t.name===r.projection.name?c.projMatrix:Nu(r,t,c)}class Vu{constructor(t,r,u,p){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?r:-r))):p&&u?1:0,this.placed=u}isHidden(){return this.opacity===0&&!this.placed}}class Vs{constructor(t,r,u,p,_,b=!1){this.text=new Vu(t?t.text:null,r,u,_),this.icon=new Vu(t?t.icon:null,r,p,_),this.clipped=b}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ed{constructor(t,r,u,p=!1){this.text=t,this.icon=r,this.skipFade=u,this.clipped=p}}class zo{constructor(){this.invProjMatrix=n.ab.mat4.create(),this.viewportMatrix=n.ab.mat4.create(),this.circles=[]}}class td{constructor(t,r,u,p,_){this.bucketInstanceId=t,this.featureIndex=r,this.sourceLayerIndex=u,this.bucketIndex=p,this.tileID=_}}class id{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const r=++this.maxGroupID;this.collisionGroups[t]={ID:r,predicate:u=>u.collisionGroupID===r}}return this.collisionGroups[t]}}function Aa(c,t,r,u,p){const{horizontalAlign:_,verticalAlign:b}=n.bD(c),C=-(_-.5)*t,O=-(b-.5)*r,P=n.bC(c,u);return new n.P(C+P[0]*p,O+P[1]*p)}function rd(c,t,r,u,p){const _=new n.P(c,t);return r&&_._rotate(u?p:-p),_}class Uu{constructor(t,r,u,p,_,b){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new hn(this.transform,_),this.buildingIndex=b,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=r,this.retainedQueryData={},this.collisionGroups=new id(u),this.collisionCircleArrays={},this.prevPlacement=p,p&&(p.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,r,u,p,_=1){const b=u.getBucket(r),C=u.latestFeatureIndex;if(!b||!C||r.fqid!==b.layerIds[0])return;const O=b.layers[0].layout,P=b.layers[0].paint,F=u.collisionBoxArray,V=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),U=u.tileSize/n.ag,H=u.tileID.toUnwrapped();this.transform.setProjection(b.projection);const J=($=u.tileID,te=b.getProjection(),ee=this.transform,te.name===this.projection?ee.calculateProjMatrix($.toUnwrapped()):Nu(ee,te,$));var $,te,ee;const le=O.get("text-pitch-alignment")==="map",pe=O.get("text-rotation-alignment")==="map";r.compileFilter(r.options);const fe=r.dynamicFilter(),be=r.dynamicFilterNeedsFeature(),me=this.transform.calculatePixelsToTileUnitsMatrix(u),ve=Lr(J,u.tileID.canonical,le,pe,this.transform,b.getProjection(),me);let _e=null;if(le){const gt=Nc(J,u.tileID.canonical,le,pe,this.transform,b.getProjection(),me);_e=n.ab.mat4.multiply([],this.transform.labelPlaneMatrix,gt)}let Ee=null;fe&&u.latestFeatureIndex&&(Ee={unwrappedTileID:H,dynamicFilter:fe,dynamicFilterNeedsFeature:be}),this.retainedQueryData[b.bucketInstanceId]=new td(b.bucketInstanceId,C,b.sourceLayerIndex,b.index,u.tileID);const[ze,Ye]=b.layers[0].layout.get("text-size-scale-range"),qe=n.aw(_,ze,Ye),[lt,it]=O.get("icon-size-scale-range"),Be=n.aw(_,lt,it),Ke={bucket:b,layout:O,paint:P,posMatrix:J,textLabelPlaneMatrix:ve,labelToScreenMatrix:_e,clippingData:Ee,scale:V,textPixelRatio:U,holdingForFade:u.holdingForFade(),collisionBoxArray:F,partiallyEvaluatedTextSize:n.bp(b.textSizeData,this.transform.zoom,qe),partiallyEvaluatedIconSize:n.bp(b.iconSizeData,this.transform.zoom,Be),collisionGroup:this.collisionGroups.get(b.sourceID),latestFeatureIndex:u.latestFeatureIndex};if(p)for(const gt of b.sortKeyRanges){const{sortKey:Fe,symbolInstanceStart:st,symbolInstanceEnd:Je}=gt;t.push({sortKey:Fe,symbolInstanceStart:st,symbolInstanceEnd:Je,parameters:Ke})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:Ke})}attemptAnchorPlacement(t,r,u,p,_,b,C,O,P,F,V,U,H,J,$,te,ee,le){const{textOffset0:pe,textOffset1:fe,crossTileID:be}=U,me=[pe,fe],ve=Aa(t,u,p,me,_),_e=this.collisionIndex.placeCollisionBox(J,_,r,rd(ve.x,ve.y,b,C,this.transform.angle),V,O,P,F.predicate);if(te){const Ee=J.getSymbolInstanceIconSize(le,this.transform.zoom,U.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(J,Ee,te,rd(ve.x,ve.y,b,C,this.transform.angle),V,O,P,F.predicate).box.length===0)return}if(_e.box.length>0){let Ee;return this.prevPlacement&&this.prevPlacement.variableOffsets[be]&&this.prevPlacement.placements[be]&&this.prevPlacement.placements[be].text&&(Ee=this.prevPlacement.variableOffsets[be].anchor),this.variableOffsets[be]={textOffset:me,width:u,height:p,anchor:t,textScale:_,prevAnchor:Ee},this.markUsedJustification(J,t,U,$),J.allowVerticalPlacement&&(this.markUsedOrientation(J,$,U),this.placedOrientations[be]=$),{shift:ve,placedGlyphBoxes:_e}}}placeLayerBucketPart(t,r,u,p,_=1){const{bucket:b,layout:C,paint:O,posMatrix:P,textLabelPlaneMatrix:F,labelToScreenMatrix:V,clippingData:U,textPixelRatio:H,holdingForFade:J,collisionBoxArray:$,partiallyEvaluatedTextSize:te,partiallyEvaluatedIconSize:ee,collisionGroup:le,latestFeatureIndex:pe}=t.parameters,fe=C.get("text-optional"),be=C.get("icon-optional"),me=C.get("text-allow-overlap"),ve=C.get("icon-allow-overlap"),_e=C.get("text-rotation-alignment")==="map",Ee=C.get("text-pitch-alignment")==="map",ze=C.get("symbol-z-elevate"),Ye=O.get("symbol-z-offset"),qe=C.get("symbol-elevation-reference")==="sea",[lt,it]=C.get("text-size-scale-range"),[Be,Ke]=C.get("icon-size-scale-range"),gt=n.aw(_,lt,it),Fe=n.aw(_,Be,Ke);this.transform.setProjection(b.projection);let st=me&&(ve||!b.hasIconData()||be),Je=ve&&(me||!b.hasTextData()||fe);const St=!Ye.isConstant();!b.collisionArrays&&$&&b.deserializeCollisionBoxes($),u&&p&&b.updateCollisionDebugBuffers(this.transform.zoom,$,gt,Fe);const dt=(ct,vt,Ct)=>{const{crossTileID:Vt,numVerticalGlyphVertices:Yt}=ct;let ui=null;if(U&&U.dynamicFilterNeedsFeature||St){const fr=this.retainedQueryData[b.bucketInstanceId];ui=pe.loadFeature({featureIndex:ct.featureIndex,bucketIndex:fr.bucketIndex,sourceLayerIndex:fr.sourceLayerIndex,layoutVertexArrayOffset:0})}if(U&&!(0,U.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},ui,this.retainedQueryData[b.bucketInstanceId].tileID.canonical,new n.P(ct.tileAnchorX,ct.tileAnchorY),this.transform.calculateDistanceTileData(U.unwrappedTileID)))return this.placements[Vt]=new ed(!1,!1,!1,!0),void r.add(Vt);const oi=Ye.evaluate(ui,{});if(r.has(Vt))return;if(J)return void(this.placements[Vt]=new ed(!1,!1,!1));let ri=!1,xi=!1,bi=!0,pr=!1,Yr=!1,Cr=null,Ai={box:null,offscreen:null,occluded:null},rr={box:null},Ut=null,mi=null,hi=null,_i=0,Zi=0,Ir=0;Ct.textFeatureIndex?_i=Ct.textFeatureIndex:ct.useRuntimeCollisionCircles&&(_i=ct.featureIndex),Ct.verticalTextFeatureIndex&&(Zi=Ct.verticalTextFeatureIndex);const Fr=fr=>{fr.tileID=this.retainedQueryData[b.bucketInstanceId].tileID;const hr=this.transform.elevation;fr.elevation=qe?oi:oi+(hr?hr.getAtTileOffset(fr.tileID,fr.tileAnchorX,fr.tileAnchorY):0),fr.elevation+=ct.zOffset},Wr=Ct.textBox;if(Wr){Fr(Wr);const fr=Qi=>{let Sr=n.bq.horizontal;if(b.allowVerticalPlacement&&!Qi&&this.prevPlacement){const en=this.prevPlacement.placedOrientations[Vt];en&&(this.placedOrientations[Vt]=en,Sr=en,this.markUsedOrientation(b,Sr,ct))}return Sr},hr=(Qi,Sr)=>{if(b.allowVerticalPlacement&&Yt>0&&Ct.verticalTextBox){for(const en of b.writingModes)if(en===n.bq.vertical?(Ai=Sr(),rr=Ai):Ai=Qi(),Ai&&Ai.box&&Ai.box.length)break}else Ai=Qi()};if(C.get("text-variable-anchor")){let Qi=C.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Vt]){const mr=this.prevPlacement.variableOffsets[Vt];Qi.indexOf(mr.anchor)>0&&(Qi=Qi.filter(tn=>tn!==mr.anchor),Qi.unshift(mr.anchor))}const Sr=(mr,tn,Ha)=>{const xa=b.getSymbolInstanceTextSize(te,ct,this.transform.zoom,vt),oa=(mr.x2-mr.x1)*xa+2*mr.padding,as=(mr.y2-mr.y1)*xa+2*mr.padding,$n=ct.hasIconTextFit&&!ve?tn:null;$n&&Fr($n);let ba={box:[],offscreen:!1,occluded:!1};const ss=me?2*Qi.length:Qi.length;for(let Za=0;Za<ss;++Za){const Yo=this.attemptAnchorPlacement(Qi[Za%Qi.length],mr,oa,as,xa,_e,Ee,H,P,le,Za>=Qi.length,ct,vt,b,Ha,$n,te,ee);if(Yo&&(ba=Yo.placedGlyphBoxes,ba&&ba.box&&ba.box.length)){ri=!0,Cr=Yo.shift;break}}return ba};hr(()=>Sr(Wr,Ct.iconBox,n.bq.horizontal),()=>{const mr=Ct.verticalTextBox;return mr&&Fr(mr),b.allowVerticalPlacement&&!(Ai&&Ai.box&&Ai.box.length)&&Yt>0&&mr?Sr(mr,Ct.verticalIconBox,n.bq.vertical):{box:null,offscreen:null,occluded:null}}),Ai&&(ri=Ai.box,bi=Ai.offscreen,pr=Ai.occluded);const en=fr(!(!Ai||!Ai.box));if(!ri&&this.prevPlacement){const mr=this.prevPlacement.variableOffsets[Vt];mr&&(this.variableOffsets[Vt]=mr,this.markUsedJustification(b,mr.anchor,ct,en))}}else{const Qi=(Sr,en)=>{const mr=b.getSymbolInstanceTextSize(te,ct,this.transform.zoom,vt,_),tn=this.collisionIndex.placeCollisionBox(b,mr,Sr,new n.P(0,0),me,H,P,le.predicate);return tn&&tn.box&&tn.box.length&&(this.markUsedOrientation(b,en,ct),this.placedOrientations[Vt]=en),tn};hr(()=>Qi(Wr,n.bq.horizontal),()=>{const Sr=Ct.verticalTextBox;return b.allowVerticalPlacement&&Yt>0&&Sr?(Fr(Sr),Qi(Sr,n.bq.vertical)):{box:null,offscreen:null,occluded:null}}),fr(!!(Ai&&Ai.box&&Ai.box.length))}}if(Ut=Ai,ri=Ut&&Ut.box&&Ut.box.length>0,bi=Ut&&Ut.offscreen,pr=Ut&&Ut.occluded,ct.useRuntimeCollisionCircles){const fr=b.text.placedSymbolArray.get(ct.centerJustifiedTextSymbolIndex>=0?ct.centerJustifiedTextSymbolIndex:ct.verticalPlacedTextSymbolIndex),hr=n.br(b.textSizeData,te,fr),Qi=C.get("text-padding");mi=this.collisionIndex.placeCollisionCircles(b,me,fr,b.lineVertexArray,b.glyphOffsetArray,hr,P,F,V,u,Ee,le.predicate,ct.collisionCircleDiameter*hr/n.bw,Qi,this.retainedQueryData[b.bucketInstanceId].tileID),ri=me||mi.circles.length>0&&!mi.collisionDetected,bi=bi&&mi.offscreen,pr=mi.occluded}if(Ct.iconFeatureIndex&&(Ir=Ct.iconFeatureIndex),Ct.iconBox){const fr=hr=>{Fr(hr);const Qi=ct.hasIconTextFit&&Cr?rd(Cr.x,Cr.y,_e,Ee,this.transform.angle):new n.P(0,0),Sr=b.getSymbolInstanceIconSize(ee,this.transform.zoom,ct.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(b,Sr,hr,Qi,ve,H,P,le.predicate)};rr&&rr.box&&rr.box.length&&Ct.verticalIconBox?(hi=fr(Ct.verticalIconBox),xi=hi.box.length>0):(hi=fr(Ct.iconBox),xi=hi.box.length>0),bi=bi&&hi.offscreen,Yr=hi.occluded}const Oa=fe||ct.numHorizontalGlyphVertices===0&&Yt===0,sn=be||ct.numIconVertices===0;if(Oa||sn?sn?Oa||(xi=xi&&ri):ri=xi&&ri:xi=ri=xi&&ri,ri&&Ut&&Ut.box&&this.collisionIndex.insertCollisionBox(Ut.box,C.get("text-ignore-placement"),b.bucketInstanceId,rr&&rr.box&&Zi?Zi:_i,le.ID),xi&&hi&&this.collisionIndex.insertCollisionBox(hi.box,C.get("icon-ignore-placement"),b.bucketInstanceId,Ir,le.ID),mi&&(ri&&this.collisionIndex.insertCollisionCircles(mi.circles,C.get("text-ignore-placement"),b.bucketInstanceId,_i,le.ID),u)){const fr=b.bucketInstanceId;let hr=this.collisionCircleArrays[fr];hr===void 0&&(hr=this.collisionCircleArrays[fr]=new zo);for(let Qi=0;Qi<mi.circles.length;Qi+=4)hr.circles.push(mi.circles[Qi+0]),hr.circles.push(mi.circles[Qi+1]),hr.circles.push(mi.circles[Qi+2]),hr.circles.push(mi.collisionDetected?1:0)}const Ji=b.projection.name!=="globe";st=st&&(Ji||!pr),Je=Je&&(Ji||!Yr),this.placements[Vt]=new ed(ri||st,xi||Je,bi||b.justReloaded),r.add(Vt)};if(ze&&this.buildingIndex&&(this.buildingIndex.updateZOffset(b,this.retainedQueryData[b.bucketInstanceId].tileID),b.updateZOffset()),b.sortFeaturesByY){const ct=b.getSortedSymbolIndexes(this.transform.angle);for(let vt=ct.length-1;vt>=0;--vt){const Ct=ct[vt];dt(b.symbolInstances.get(Ct),Ct,b.collisionArrays[Ct])}b.hasAnyZOffset&&n.w(`${b.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(b.hasAnyZOffset){const ct=b.getSortedIndexesByZOffset();for(let vt=0;vt<ct.length;++vt){const Ct=ct[vt];dt(b.symbolInstances.get(Ct),Ct,b.collisionArrays[Ct])}}else for(let ct=t.symbolInstanceStart;ct<t.symbolInstanceEnd;ct++)dt(b.symbolInstances.get(ct),ct,b.collisionArrays[ct]);if(u&&b.bucketInstanceId in this.collisionCircleArrays){const ct=this.collisionCircleArrays[b.bucketInstanceId];n.ab.mat4.invert(ct.invProjMatrix,P),ct.viewportMatrix=this.collisionIndex.getViewportMatrix()}b.justReloaded=!1}markUsedJustification(t,r,u,p){const{leftJustifiedTextSymbolIndex:_,centerJustifiedTextSymbolIndex:b,rightJustifiedTextSymbolIndex:C,verticalPlacedTextSymbolIndex:O,crossTileID:P}=u,F=n.bB(r),V=p===n.bq.vertical?O:F==="left"?_:F==="center"?b:F==="right"?C:-1;_>=0&&(t.text.placedSymbolArray.get(_).crossTileID=V>=0&&_!==V?0:P),b>=0&&(t.text.placedSymbolArray.get(b).crossTileID=V>=0&&b!==V?0:P),C>=0&&(t.text.placedSymbolArray.get(C).crossTileID=V>=0&&C!==V?0:P),O>=0&&(t.text.placedSymbolArray.get(O).crossTileID=V>=0&&O!==V?0:P)}markUsedOrientation(t,r,u){const p=r===n.bq.horizontal||r===n.bq.horizontalOnly?r:0,_=r===n.bq.vertical?r:0,{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:C,rightJustifiedTextSymbolIndex:O,verticalPlacedTextSymbolIndex:P}=u,F=t.text.placedSymbolArray;b>=0&&(F.get(b).placedOrientation=p),C>=0&&(F.get(C).placedOrientation=p),O>=0&&(F.get(O).placedOrientation=p),P>=0&&(F.get(P).placedOrientation=_)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const r=this.prevPlacement;let u=!1;this.prevZoomAdjustment=r?r.zoomAdjustment(this.transform.zoom):0;const p=r?r.symbolFadeChange(t):1,_=r?r.opacities:{},b=r?r.variableOffsets:{},C=r?r.placedOrientations:{};for(const O in this.placements){const P=this.placements[O],F=_[O];F?(this.opacities[O]=new Vs(F,p,P.text,P.icon,null,P.clipped),u=u||P.text!==F.text.placed||P.icon!==F.icon.placed):(this.opacities[O]=new Vs(null,p,P.text,P.icon,P.skipFade,P.clipped),u=u||P.text||P.icon)}for(const O in _){const P=_[O];if(!this.opacities[O]){const F=new Vs(P,p,!1,!1);F.isHidden()||(this.opacities[O]=F,u=u||P.text.placed||P.icon.placed)}}for(const O in b)this.variableOffsets[O]||!this.opacities[O]||this.opacities[O].isHidden()||(this.variableOffsets[O]=b[O]);for(const O in C)this.placedOrientations[O]||!this.opacities[O]||this.opacities[O].isHidden()||(this.placedOrientations[O]=C[O]);u?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=r?r.lastPlacementChangeTime:t)}updateLayerOpacities(t,r,u,p){const _=new Set;for(const b of r){const C=b.getBucket(t);C&&b.latestFeatureIndex&&t.fqid===C.layerIds[0]&&(this.updateBucketOpacities(C,_,b,b.collisionBoxArray,u,p,b.tileID,t.scope),C.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(C,b.tileID),C.updateZOffset()))}}updateBucketOpacities(t,r,u,p,_,b,C,O){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const P=t.layers[0].layout,F=t.layers[0].paint,V=!!t.layers[0].dynamicFilter(),U=new Vs(null,0,!1,!1,!0),H=P.get("text-allow-overlap"),J=P.get("icon-allow-overlap"),$=P.get("text-variable-anchor"),te=P.get("text-rotation-alignment")==="map",ee=P.get("text-pitch-alignment")==="map",le=F.get("symbol-z-offset"),pe=P.get("symbol-elevation-reference")==="sea",fe=!le.isConstant(),be=new Vs(null,0,H&&(J||!t.hasIconData()||P.get("icon-optional")),J&&(H||!t.hasTextData()||P.get("text-optional")),!0);!t.collisionArrays&&p&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(p);const me=(_e,Ee,ze)=>{for(let Ye=0;Ye<Ee/4;Ye++)_e.opacityVertexArray.emplaceBack(ze)};let ve=0;b&&t.updateReplacement(C,b);for(let _e=0;_e<t.symbolInstances.length;_e++){const Ee=t.symbolInstances.get(_e),{numHorizontalGlyphVertices:ze,numVerticalGlyphVertices:Ye,crossTileID:qe,numIconVertices:lt,tileAnchorX:it,tileAnchorY:Be}=Ee;let Ke=null;const gt=this.retainedQueryData[t.bucketInstanceId];fe&&Ee&&gt&&(Ke=u.latestFeatureIndex.loadFeature({featureIndex:Ee.featureIndex,bucketIndex:gt.bucketIndex,sourceLayerIndex:gt.sourceLayerIndex,layoutVertexArrayOffset:0}));const Fe=le.evaluate(Ke,{}),st=r.has(qe);let Je=this.opacities[qe];st?Je=U:Je||(Je=be,this.opacities[qe]=Je),r.add(qe);const St=ze>0||Ye>0,dt=lt>0,ct=this.placedOrientations[qe],vt=ct===n.bq.vertical,Ct=ct===n.bq.horizontal||ct===n.bq.horizontalOnly;!St&&!dt||Je.isHidden()||ve++;let Vt=!1;if((St||dt)&&b)for(const Yt of t.activeReplacements){if(n.bx(Yt,_,n.by.Symbol,O)||Yt.min.x>it||it>Yt.max.x||Yt.min.y>Be||Be>Yt.max.y)continue;const ui=n.bz(it,Be,C.canonical,Yt.footprintTileId.canonical);if(Vt=n.bA(ui,Yt.footprint),Vt)break}if(St){const Yt=Vt?Us:nd(Je.text);me(t.text,ze,vt?Us:Yt),me(t.text,Ye,Ct?Us:Yt);const ui=Je.text.isHidden(),{leftJustifiedTextSymbolIndex:oi,centerJustifiedTextSymbolIndex:ri,rightJustifiedTextSymbolIndex:xi,verticalPlacedTextSymbolIndex:bi}=Ee,pr=t.text.placedSymbolArray,Yr=ui||vt?1:0;oi>=0&&(pr.get(oi).hidden=Yr),ri>=0&&(pr.get(ri).hidden=Yr),xi>=0&&(pr.get(xi).hidden=Yr),bi>=0&&(pr.get(bi).hidden=ui||Ct?1:0);const Cr=this.variableOffsets[qe];Cr&&this.markUsedJustification(t,Cr.anchor,Ee,ct);const Ai=this.placedOrientations[qe];Ai&&(this.markUsedJustification(t,"left",Ee,Ai),this.markUsedOrientation(t,Ai,Ee))}if(dt){const Yt=Vt?Us:nd(Je.icon),{placedIconSymbolIndex:ui,verticalPlacedIconSymbolIndex:oi}=Ee,ri=t.icon.placedSymbolArray,xi=Je.icon.isHidden()?1:0;ui>=0&&(me(t.icon,lt,vt?Us:Yt),ri.get(ui).hidden=xi),oi>=0&&(me(t.icon,Ee.numVerticalIconVertices,Ct?Us:Yt),ri.get(oi).hidden=xi)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Yt=t.collisionArrays[_e];if(Yt){let ui=new n.P(0,0),oi=!0;if(Yt.textBox||Yt.verticalTextBox){if($){const xi=this.variableOffsets[qe];xi?(ui=Aa(xi.anchor,xi.width,xi.height,xi.textOffset,xi.textScale),te&&ui._rotate(ee?this.transform.angle:-this.transform.angle)):oi=!1}V&&(oi=!Je.clipped),Yt.textBox&&ju(t.textCollisionBox.collisionVertexArray,Je.text.placed,!oi||vt,Fe,pe,ui.x,ui.y),Yt.verticalTextBox&&ju(t.textCollisionBox.collisionVertexArray,Je.text.placed,!oi||Ct,Fe,pe,ui.x,ui.y)}const ri=oi&&!!(!Ct&&Yt.verticalIconBox);Yt.iconBox&&ju(t.iconCollisionBox.collisionVertexArray,Je.icon.placed,ri,Fe,pe,Ee.hasIconTextFit?ui.x:0,Ee.hasIconTextFit?ui.y:0),Yt.verticalIconBox&&ju(t.iconCollisionBox.collisionVertexArray,Je.icon.placed,!ri,Fe,pe,Ee.hasIconTextFit?ui.x:0,Ee.hasIconTextFit?ui.y:0)}}}if(t.fullyClipped=ve===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const _e=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=_e.invProjMatrix,t.placementViewportMatrix=_e.viewportMatrix,t.collisionCircleArray=_e.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,r){const u=this.zoomAtLastRecencyCheck===r?1-this.zoomAdjustment(r):1;return this.zoomAtLastRecencyCheck=r,this.commitTime+this.fadeDuration*u>t}setStale(){this.stale=!0}}function ju(c,t,r,u,p,_,b){c.emplaceBack(t?1:0,r?1:0,_||0,b||0,u,p?1:0),c.emplaceBack(t?1:0,r?1:0,_||0,b||0,u,p?1:0),c.emplaceBack(t?1:0,r?1:0,_||0,b||0,u,p?1:0),c.emplaceBack(t?1:0,r?1:0,_||0,b||0,u,p?1:0)}const qu=Math.pow(2,25),Lm=Math.pow(2,24),Pm=Math.pow(2,17),Gu=Math.pow(2,16),Hu=Math.pow(2,9),km=Math.pow(2,8),Uc=Math.pow(2,1);function nd(c){if(c.opacity===0&&!c.placed)return 0;if(c.opacity===1&&c.placed)return 4294967295;const t=c.placed?1:0,r=Math.floor(127*c.opacity);return r*qu+t*Lm+r*Pm+t*Gu+r*Hu+t*km+r*Uc+t}const Us=0;class ys{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,r,u,p,_,b){const C=this._bucketParts;for(;this._currentTileIndex<t.length;)if(r.getBucketParts(C,p,t[this._currentTileIndex],this._sortAcrossTiles,b),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,C.sort((O,P)=>O.sortKey-P.sortKey));this._currentPartIndex<C.length;){const O=C[this._currentPartIndex];if(r.placeLayerBucketPart(O,this._seenCrossTileIDs,u,O.symbolInstanceStart===0,b),this._currentPartIndex++,_())return!0}return!1}}class Fm{constructor(t,r,u,p,_,b,C,O,P){this.placement=new Uu(t,_,b,C,O,P),this._currentPlacementIndex=r.length-1,this._forceFullPlacement=u,this._showCollisionBoxes=p,this._done=!1}isDone(){return this._done}continuePlacement(t,r,u,p,_){const b=n.q.now(),C=()=>{const O=n.q.now()-b;return!this._forceFullPlacement&&O>2};for(;this._currentPlacementIndex>=0;){const O=r[t[this._currentPlacementIndex]],P=this.placement.collisionIndex.transform.zoom;if(O.type==="symbol"&&(!O.minzoom||O.minzoom<=P)&&(!O.maxzoom||O.maxzoom>P)){const F=O,V=F.layout.get("symbol-z-elevate"),U=F.layout.get("symbol-sort-key").constantOr(1)!==void 0,H=F.layout.get("symbol-z-order"),J=H==="viewport-y"||H==="auto"&&!(H!=="viewport-y"&&U),$=F.layout.get("text-allow-overlap")||F.layout.get("icon-allow-overlap")||F.layout.get("text-ignore-placement")||F.layout.get("icon-ignore-placement"),te=J&&$,ee=this._inProgressLayer=this._inProgressLayer||new ys(F),le=n.aC(O.source,O.scope);if(ee.continuePlacement(V||te?p[le]:u[le],this.placement,this._showCollisionBoxes,O,C,_))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Gh=512/n.ag/2;class up{constructor(t,r,u){this.tileID=t,this.bucketInstanceId=u,this.index=new n.bE(r.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const p=t.canonical.x*n.ag,_=t.canonical.y*n.ag;for(let b=0;b<r.length;b++){const{key:C,crossTileID:O,tileAnchorX:P,tileAnchorY:F}=r.get(b),V=Math.floor((p+P)*Gh),U=Math.floor((_+F)*Gh);this.index.add(V,U),this.keys.push(C),this.crossTileIDs.push(O)}this.index.finish()}findMatches(t,r,u){const p=this.tileID.canonical.z<r.canonical.z?1:Math.pow(2,this.tileID.canonical.z-r.canonical.z),_=Gh/Math.pow(2,r.canonical.z-this.tileID.canonical.z),b=r.canonical.x*n.ag,C=r.canonical.y*n.ag;for(let O=0;O<t.length;O++){const P=t.get(O);if(P.crossTileID)continue;const{key:F,tileAnchorX:V,tileAnchorY:U}=P,H=Math.floor((b+V)*_),J=Math.floor((C+U)*_),$=this.index.range(H-p,J-p,H+p,J+p);for(const te of $){const ee=this.crossTileIDs[te];if(this.keys[te]===F&&!u.has(ee)){u.add(ee),P.crossTileID=ee;break}}}}}class ad{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class hp{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const r=Math.round((t-this.lng)/360);if(r!==0)for(const u in this.indexes){const p=this.indexes[u],_={};for(const b in p){const C=p[b];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+r),_[C.tileID.key]=C}this.indexes[u]=_}this.lng=t}addBucket(t,r,u){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===r.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let _=0;_<r.symbolInstances.length;_++)r.symbolInstances.get(_).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const p=this.usedCrossTileIDs[t.overscaledZ];for(const _ in this.indexes){const b=this.indexes[_];if(Number(_)>t.overscaledZ)for(const C in b){const O=b[C];O.tileID.isChildOf(t)&&O.findMatches(r.symbolInstances,t,p)}else{const C=b[t.scaledTo(Number(_)).key];C&&C.findMatches(r.symbolInstances,t,p)}}for(let _=0;_<r.symbolInstances.length;_++){const b=r.symbolInstances.get(_);b.crossTileID||(b.crossTileID=u.generate(),p.add(b.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new up(t,r.symbolInstances,r.bucketInstanceId),!0}removeBucketCrossTileIDs(t,r){for(const u of r.crossTileIDs)this.usedCrossTileIDs[t].delete(u)}removeStaleBuckets(t){let r=!1;for(const u in this.indexes){const p=this.indexes[u];for(const _ in p)t[p[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,p[_]),delete p[_],r=!0)}return r}}class Hh{constructor(){this.layerIndexes={},this.crossTileIDs=new ad,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,r,u,p){let _=this.layerIndexes[t.fqid];_===void 0&&(_=this.layerIndexes[t.fqid]=new hp);let b=!1;const C={};p.name!=="globe"&&_.handleWrapJump(u);for(const O of r){const P=O.getBucket(t);P&&t.fqid===P.layerIds[0]&&(P.bucketInstanceId||(P.bucketInstanceId=++this.maxBucketInstanceId),_.addBucket(O.tileID,P,this.crossTileIDs)&&(b=!0),C[P.bucketInstanceId]=!0)}return _.removeStaleBuckets(C)&&(b=!0),b}pruneUnusedLayers(t){const r={};t.forEach(u=>{r[u]=!0});for(const u in this.layerIndexes)r[u]||delete this.layerIndexes[u]}}const vs=771;class Ui{constructor(t,r,u,p){this.blendFunction=t,this.blendColor=r,this.mask=u,this.blendEquation=p}}Ui.Replace=[1,0,1,0],Ui.disabled=new Ui(Ui.Replace,n.aj.transparent,[!1,!1,!1,!1]),Ui.unblended=new Ui(Ui.Replace,n.aj.transparent,[!0,!0,!0,!0]),Ui.alphaBlended=new Ui([1,vs,1,vs],n.aj.transparent,[!0,!0,!0,!0]),Ui.alphaBlendedNonPremultiplied=new Ui([770,vs,770,vs],n.aj.transparent,[!0,!0,!0,!0]),Ui.multiply=new Ui([774,0,774,0],n.aj.transparent,[!0,!0,!0,!0]);class ci{constructor(t,r,u){this.func=t,this.mask=r,this.range=u}}ci.ReadOnly=!1,ci.ReadWrite=!0,ci.disabled=new ci(519,ci.ReadOnly,[0,1]);const Zh=7680;class vi{constructor(t,r,u,p,_,b){this.test=t,this.ref=r,this.mask=u,this.fail=p,this.depthFail=_,this.pass=b}}vi.disabled=new vi({func:519,mask:0},0,0,Zh,Zh,Zh);const Wl=1029,nl=2305;class yi{constructor(t,r,u){this.enable=t,this.mode=r,this.frontFace=u}}function jc(c,t){const r=n.bG(c,3);n.ab.mat4.fromQuat(c,t),n.bI(c,3,r)}function so(c,t){const r=n.ab.quat.identity([]);return n.ab.quat.rotateZ(r,r,-t),n.ab.quat.rotateX(r,r,-c),r}function Xh(c,t){const r=[c[0],c[1],0],u=[t[0],t[1],0];if(n.ab.vec3.length(r)>=1e-15){const b=n.ab.vec3.normalize([],r);n.ab.vec3.scale(u,b,n.ab.vec3.dot(u,b)),t[0]=u[0],t[1]=u[1]}const p=n.ab.vec3.cross([],t,c);if(n.ab.vec3.len(p)<1e-15)return null;const _=Math.atan2(-p[1],p[0]);return so(Math.atan2(Math.sqrt(c[0]*c[0]+c[1]*c[1]),-c[2]),_)}yi.disabled=new yi(!1,Wl,nl),yi.backCCW=new yi(!0,Wl,nl),yi.backCW=new yi(!0,Wl,2304),yi.frontCW=new yi(!0,1028,2304),yi.frontCCW=new yi(!0,1028,nl);class Zu{constructor(t,r){this.position=t,this.orientation=r}get position(){return this._position}set position(t){if(t){const r=t instanceof n.aa?t:new n.aa(t[0],t[1],t[2]);this._renderWorldCopies&&(r.x=n.bF(r.x,0,1)),this._position=r}else this._position=null}lookAtPoint(t,r){if(this.orientation=null,!this.position)return;const u=this.position,p=this._elevation?this._elevation.getAtPointOrZero(n.aa.fromLngLat(t)):0,_=n.aa.fromLngLat(t,p),b=[_.x-u.x,_.y-u.y,_.z-u.z];r||(r=[0,0,1]),r[2]=Math.abs(r[2]),this.orientation=Xh(b,r)}setPitchBearing(t,r){this.orientation=so(n.ai(t),n.ai(-r))}}class fa{constructor(t,r){this._transform=n.ab.mat4.identity([]),this.orientation=r,this.position=t}get mercatorPosition(){const t=this.position;return new n.aa(t[0],t[1],t[2])}get position(){const t=n.bG(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var r;t&&n.bI(this._transform,3,[(r=t)[0],r[1],r[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||n.ab.quat.identity([]),t&&jc(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),r=this.right();return{bearing:Math.atan2(-r[1],r[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,r){this._orientation=so(t,r),jc(this._transform,this._orientation)}forward(){const t=n.bG(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=n.bG(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=n.bG(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,r){const u=new Float64Array(16);return n.ab.mat4.invert(u,this.getWorldToCamera(t,r)),u}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,r,u){const p=this.position;n.ab.vec3.scale(p,p,-t);const _=new Float64Array(16);return n.ab.mat4.fromScaling(_,[u,u,u]),n.ab.mat4.translate(_,_,p),_[10]*=r,_}getWorldToCamera(t,r){const u=new Float64Array(16),p=new Float64Array(4),_=this.position;return n.ab.quat.conjugate(p,this._orientation),n.ab.vec3.scale(_,_,-t),n.ab.mat4.fromQuat(u,p),n.ab.mat4.translate(u,u,_),u[1]*=-1,u[5]*=-1,u[9]*=-1,u[13]*=-1,u[8]*=r,u[9]*=r,u[10]*=r,u[11]*=r,u}getCameraToClipPerspective(t,r,u,p){const _=new Float64Array(16);return n.ab.mat4.perspective(_,t,r,u,p),_}getCameraToClipOrthographic(t,r,u,p,_,b){const C=new Float64Array(16);return n.ab.mat4.ortho(C,t,r,u,p,_,b),C}getDistanceToElevation(t,r=!1){const u=t===0?0:n.bH(t,r?n.aS(this.position[1]):this.position[1]),p=this.forward();return(u-this.position[2])/p[2]}clone(){return new fa([...this.position],[...this.orientation])}}const zn={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class zt{constructor(t=0,r=0,u=0,p=0){if(isNaN(t)||t<0||isNaN(r)||r<0||isNaN(u)||u<0||isNaN(p)||p<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=r,this.left=u,this.right=p}interpolate(t,r,u){return r.top!=null&&t.top!=null&&(this.top=n.af(t.top,r.top,u)),r.bottom!=null&&t.bottom!=null&&(this.bottom=n.af(t.bottom,r.bottom,u)),r.left!=null&&t.left!=null&&(this.left=n.af(t.left,r.left,u)),r.right!=null&&t.right!=null&&(this.right=n.af(t.right,r.right,u)),this}getCenter(t,r){const u=n.aw((this.left+t-this.right)/2,0,t),p=n.aw((this.top+r-this.bottom)/2,0,r);return new n.P(u,p)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new zt(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Yh=(c,t,r)=>(1-r)*c+r*t,Xu=c=>c*c*c*c*c;class Yu{constructor(t,r,u,p,_,b,C){this.tileSize=512,this._renderWorldCopies=_===void 0||_,this._minZoom=t||0,this._maxZoom=r||22,this._minPitch=u??0,this._maxPitch=p??60,this.setProjection(b),this.setMaxBounds(C),this.width=0,this.height=0,this._center=new n.bO(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new zt,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new fa,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const t=new Yu(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,r=!1){const u=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||u)&&this._updateCameraOnTerrain(),(t||u)&&this._constrainCamera(r),this._calcMatrices()}getProjection(){return n.ay(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const r=this.projection?this.getProjection():void 0;this.projection=n.bP(this.projectionOptions);const u=this.getProjection(),p=!n.bn(r,u);return p&&this._calcMatrices(),this.mercatorFromTransition=!1,p}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=n.bP({name:"mercator"});const r=t!==this.projection.name;return r&&this._calcMatrices(),r}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return n.bH(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new n.P(this.width,this.height)}get bearing(){return n.bF(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const r=-t*Math.PI/180;this.angle!==r&&(this._unmodified=!1,this.angle=r,this._calcMatrices(),this.rotationMatrix=n.ab.mat2.create(),n.ab.mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const r=n.aw(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==r&&(this._unmodified=!1,this._pitch=r,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=n.ai(t),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const r=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==r&&(this._unmodified=!1,this._setZoom(r),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,r=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!r||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const u=this._elevation;r||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&u.exaggeration()&&this._centerAltitudeValidForExaggeration!==u.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*u.exaggeration(),this._centerAltitudeValidForExaggeration=u.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=u.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,r=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],u=this.horizonLineFromTop();let p=0,_=0;for(let b=0;b<r.length;b++){const C=new n.P(r[b][0]*this.width,u+r[b][1]*(this.height-u)),O=t.pointCoordinate(C);if(!O)continue;const P=1/Math.hypot(O[0]-this._camera.position[0],O[1]-this._camera.position[1]);p+=O[3]*P,_+=P}return _===0?NaN:p/_}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,r=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),u=this.pixelsPerMeter/this.worldSize*r,p=this._mercatorZfromZoom(t),_=this._mercatorZfromZoom(this._maxZoom),b=Math.max(p-u,_);this._setZoom(this._zoomFromMercatorZ(b))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const r=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let u;u=t.z<this._camera.position[2]?[r.x,r.y,r.z]:[t.x,t.y,t.z];const p=n.ab.vec3.length(n.ab.vec3.sub([],this._camera.position,u));return n.aw(this._zoomFromMercatorZ(p),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let r=!1;if(t.orientation&&!n.ab.quat.exactEquals(t.orientation,this._camera.orientation)&&(r=this._setCameraOrientation(t.orientation)),t.position){const u=[t.position.x,t.position.y,t.position.z];n.ab.vec3.exactEquals(u,this._camera.position)||(this._setCameraPosition(u),r=!0)}r&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,r=new Zu;return r.position=new n.aa(t[0],t[1],t[2]),r.orientation=this._camera.orientation,r._elevation=this.elevation,r._renderWorldCopies=this.renderWorldCopies,r}_setCameraOrientation(t){if(!n.ab.quat.length(t))return!1;n.ab.quat.normalize(t,t);const r=n.ab.vec3.transformQuat([],[0,0,-1],t),u=n.ab.vec3.transformQuat([],[0,-1,0],t);if(u[2]<0)return!1;const p=Xh(r,u);return!!p&&(this._camera.orientation=p,!0)}_setCameraPosition(t){const r=this.zoomScale(this.minZoom)*this.tileSize,u=this.zoomScale(this.maxZoom)*this.tileSize,p=this.cameraToCenterDistance;t[2]=n.aw(t[2],p/u,p/r),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,r,u){this._unmodified=!1,this._edgeInsets.interpolate(t,r,u),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const r=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,r)}getVisibleUnwrappedCoordinates(t){const r=[new n.bQ(0,t)];if(this.renderWorldCopies){const u=this.pointCoordinate(new n.P(0,0)),p=this.pointCoordinate(new n.P(this.width,0)),_=this.pointCoordinate(new n.P(this.width,this.height)),b=this.pointCoordinate(new n.P(0,this.height)),C=Math.floor(Math.min(u.x,p.x,_.x,b.x)),O=Math.floor(Math.max(u.x,p.x,_.x,b.x)),P=1;for(let F=C-P;F<=O+P;F++)F!==0&&r.push(new n.bQ(F,t))}return r}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,r,u){let p=[];const _=u!==void 0,b=!_;if(b&&this.zoom<r||_&&u[0]===0&&u[1]===0)return p;const C=new Set,O=(F,V,U,H,J)=>{const $=n.c5(V,F,U,H,J);C.has($)||(p.push(new n.aG(F,V,U,H,J)),C.add($))};for(let F=0;F<t.length;F++){const V=t[F];if(b&&V.canonical.z!==r)continue;const U=V.canonical,H=V.overscaledZ,J=V.wrap,$=1<<U.z,te=U.x+1<$,ee=U.x>0,le=U.y+1<$,pe=U.y>0,fe=V.wrap-(ee?0:1),be=V.wrap+(te?0:1),me=ee?U.x-1:$-1,ve=te?U.x+1:0;if(_)u[0]<0?(O(H,be,U.z,ve,U.y),u[1]<0&&le&&(O(H,J,U.z,U.x,U.y+1),O(H,be,U.z,ve,U.y+1)),u[1]>0&&pe&&(O(H,J,U.z,U.x,U.y-1),O(H,be,U.z,ve,U.y-1))):u[0]>0?(O(H,fe,U.z,me,U.y),u[1]<0&&le&&(O(H,J,U.z,U.x,U.y+1),O(H,fe,U.z,me,U.y+1)),u[1]>0&&pe&&(O(H,J,U.z,U.x,U.y-1),O(H,fe,U.z,me,U.y-1))):u[1]<0&&le?O(H,J,U.z,U.x,U.y+1):pe&&O(H,J,U.z,U.x,U.y-1);else{const _e=V.visibleQuadrants;1&_e&&(O(H,fe,U.z,me,U.y),pe&&(O(H,J,U.z,U.x,U.y-1),O(H,fe,U.z,me,U.y-1))),2&_e&&(O(H,be,U.z,ve,U.y),pe&&(O(H,J,U.z,U.x,U.y-1),O(H,be,U.z,ve,U.y-1))),4&_e&&(O(H,fe,U.z,me,U.y),le&&(O(H,J,U.z,U.x,U.y+1),O(H,fe,U.z,me,U.y+1))),8&_e&&(O(H,be,U.z,ve,U.y),le&&(O(H,J,U.z,U.x,U.y+1),O(H,be,U.z,ve,U.y+1)))}}const P=[];for(const F of p)p.some(V=>F.isChildOf(V))||P.push(F);if(p=P.filter(F=>!t.some(V=>!!(F.overscaledZ<r&&V.isChildOf(F))||F.equals(V)||F.isChildOf(V))),b){const F=1<<r,V=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),U=[F*V.x,F*V.y],H=4,J=H*H;p=p.filter($=>{const te=$.canonical.x+.5-U[0],ee=$.canonical.y+.5-U[1];return te*te+ee*ee<J})}return p}coveringTiles(t){let r=this.coveringZoomLevel(t);const u=r,p=this.elevation&&this.elevation.exaggeration(),_=p&&!t.isTerrainDEM,b=this.projection.name==="mercator";if(t.minzoom!==void 0&&r<t.minzoom)return[];t.maxzoom!==void 0&&r>t.maxzoom&&(r=t.maxzoom);const C=this.locationCoordinate(this.center),O=this.center.lat,P=1<<r,F=[P*C.x,P*C.y,0],V=this.projection.name==="globe",U=!V,H=n.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,r,U),J=V?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),$=P*n.bH(1,this.center.lat),te=this._camera.position[2]/n.bH(1,this.center.lat),ee=[P*J.x,P*J.y,te*(U?1:$)],le=V||p,pe=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),fe=this.isLODDisabled(!0)?r:0;let be;if(this._elevation&&t.isTerrainDEM)be=1e4*this._elevation.exaggeration();else if(this._elevation){const Fe=this._elevation.getMinMaxForVisibleTiles();be=Fe?Fe.max:this._centerAltitude}else be=this._centerAltitude;const me=t.isTerrainDEM?-be:this._elevation?this._elevation.getMinElevationBelowMSL():0,ve=this.projection.isReprojectedInTileSpace?n.bS(this):1,_e=Fe=>{const Je=new n.aa(Fe.x+25e-6,Fe.y,Fe.z),St=new n.aa(Fe.x,Fe.y+25e-6,Fe.z),dt=Fe.toLngLat(),ct=Je.toLngLat(),vt=St.toLngLat(),Ct=this.locationCoordinate(dt),Vt=this.locationCoordinate(ct),Yt=this.locationCoordinate(vt),ui=Math.hypot(Vt.x-Ct.x,Vt.y-Ct.y),oi=Math.hypot(Yt.x-Ct.x,Yt.y-Ct.y);return Math.sqrt(ui*oi)*ve/25e-6},Ee=Fe=>{const st=be,Je=me;return{aabb:n.bV(this,P,0,0,0,Fe,Je,st,this.projection),zoom:0,x:0,y:0,minZ:Je,maxZ:st,wrap:Fe,fullyVisible:!1}},ze=[];let Ye=[];const qe=r,lt=t.reparseOverscaled?u:r,it=(te-this._centerAltitude)*$,Be=Fe=>{if(!this._elevation||!Fe.tileID||!b)return;const st=this._elevation.getMinMaxForTile(Fe.tileID),Je=Fe.aabb;st?(Je.min[2]=st.min,Je.max[2]=st.max,Je.center[2]=(Je.min[2]+Je.max[2])/2):(Fe.shouldSplit=gt(Fe),Fe.shouldSplit||(Je.min[2]=Je.max[2]=Je.center[2]=this._centerAltitude))},Ke=(Fe,st)=>{if(.707*st<Fe)return 1;const Je=st/Fe;return Je/(1.4144271570014144+(Math.pow(1.1,Je-1.4144271570014144+1)-1)/(1.1-1)-1)},gt=Fe=>{if(Fe.zoom<fe)return!0;if(Fe.zoom===qe)return!1;if(Fe.shouldSplit!=null)return Fe.shouldSplit;const st=Fe.aabb.distanceX(ee),Je=Fe.aabb.distanceY(ee);let St=it,dt=1;if(V){St=Fe.aabb.distanceZ(ee);const oi=Math.pow(2,Fe.zoom),ri=n.aS((Fe.y+1)/oi),xi=n.aS(Fe.y/oi),bi=Math.min(Math.max(O,ri),xi),pr=n.c9(bi)/n.c9(O);if(dt=bi===O?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,pr/this._mercatorScaleRatio),this.zoom<=n.c6&&Fe.zoom===qe-1&&pr>=.9)return!0}else if(_&&(St=Fe.aabb.distanceZ(ee)*$),this.projection.isReprojectedInTileSpace&&u<=5){const oi=Math.pow(2,Fe.zoom),ri=_e(new n.aa((Fe.x+.5)/oi,(Fe.y+.5)/oi));dt=ri>.85?1:ri}if(!b){const oi=Math.sqrt(st*st+Je*Je+St*St);let ri=(1<<qe-Fe.zoom)*pe*dt;return ri*=Ke(Math.max(St,it),oi),oi<ri}let ct=Number.MAX_VALUE,vt=0;const Ct=Fe.aabb.getCorners(),Vt=[];for(const oi of Ct){n.ab.vec3.sub(Vt,oi,ee),V||(_?Vt[2]*=$:Vt[2]=it);const ri=n.ab.vec3.dot(Vt,this._camera.forward());ri<ct&&(ct=ri,vt=Math.abs(Vt[2]))}let Yt=(1<<qe-Fe.zoom)*pe*dt;if(Yt*=Ke(Math.max(vt,it),ct),ct<Yt)return!0;const ui=Fe.aabb.closestPoint(F);return ui[0]===F[0]&&ui[1]===F[1]};if(this.renderWorldCopies)for(let Fe=1;Fe<=3;Fe++)ze.push(Ee(-Fe)),ze.push(Ee(Fe));for(ze.push(Ee(0));ze.length>0;){const Fe=ze.pop(),st=Fe.x,Je=Fe.y;let St=Fe.fullyVisible;const dt=()=>this.projection.name==="globe"&&(Fe.y===0||Fe.y===(1<<Fe.zoom)-1);if(!St){let ct=le?Fe.aabb.intersects(H):Fe.aabb.intersectsFlat(H);if(ct===0&&dt()){const vt=new n.bT(Fe.zoom,st,Je);ct=n.bU(this,P,vt,!0).intersects(H)}if(ct===0)continue;St=ct===2}if(Fe.zoom!==qe&&gt(Fe))for(let ct=0;ct<4;ct++){const vt=(st<<1)+ct%2,Ct=(Je<<1)+(ct>>1),Vt={aabb:b?Fe.aabb.quadrant(ct):n.bV(this,P,Fe.zoom+1,vt,Ct,Fe.wrap,Fe.minZ,Fe.maxZ,this.projection),zoom:Fe.zoom+1,x:vt,y:Ct,wrap:Fe.wrap,fullyVisible:St,tileID:void 0,shouldSplit:void 0,minZ:Fe.minZ,maxZ:Fe.maxZ};_&&!V&&(Vt.tileID=new n.aG(Fe.zoom+1===qe?lt:Fe.zoom+1,Fe.wrap,Fe.zoom+1,vt,Ct),Be(Vt)),ze.push(Vt)}else{const ct=Fe.zoom===qe?lt:Fe.zoom;if(t.minzoom&&t.minzoom>ct)continue;let vt=0;if(!St){let ui=le?Fe.aabb.intersectsPrecise(H):Fe.aabb.intersectsPreciseFlat(H);if(ui===0&&dt()){const oi=new n.bT(Fe.zoom,st,Je);ui=n.bU(this,P,oi,!0).intersectsPrecise(H)}if(ui===0)continue;if(t.calculateQuadrantVisibility)if(H.containsPoint(Fe.aabb.center))vt=15;else for(let oi=0;oi<4;oi++)Fe.aabb.quadrant(oi).intersects(H)!==0&&(vt|=1<<oi)}const Ct=F[0]-(.5+st+(Fe.wrap<<Fe.zoom))*(1<<r-Fe.zoom),Vt=F[1]-.5-Je,Yt=Fe.tileID?Fe.tileID:new n.aG(ct,Fe.wrap,Fe.zoom,st,Je);t.calculateQuadrantVisibility&&(Yt.visibleQuadrants=vt),Ye.push({tileID:Yt,distanceSq:Ct*Ct+Vt*Vt})}}if(this.fogCullDistSq){const Fe=this.fogCullDistSq,st=this.horizonLineFromTop();Ye=Ye.filter(Je=>{const St=[0,0,0,1],dt=[n.ag,n.ag,0,1],ct=this.calculateFogTileMatrix(Je.tileID.toUnwrapped());n.ab.vec4.transformMat4(St,St,ct),n.ab.vec4.transformMat4(dt,dt,ct);const vt=n.ab.vec4.min([],St,dt),Ct=n.ab.vec4.max([],St,dt),Vt=n.bW(vt,Ct);if(Vt===0)return!0;let Yt=!1;const ui=this._elevation;if(ui&&Vt>Fe&&st!==0){const oi=this.calculateProjMatrix(Je.tileID.toUnwrapped());let ri;t.isTerrainDEM||(ri=ui.getMinMaxForTile(Je.tileID)),ri||(ri={min:me,max:be});const xi=n.c7(this.rotation),bi=[xi[0]*n.ag,xi[1]*n.ag,ri.max];n.ab.vec3.transformMat4(bi,bi,oi),Yt=(1-bi[1])*this.height*.5<st}return Vt<Fe||Yt})}return Ye.sort((Fe,st)=>Fe.distanceSq-st.distanceSq).map(Fe=>Fe.tileID)}resize(t,r){this.width=t,this.height=r,this.pixelsToGLUnits=[2/t,-2/r],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const r=n.aw(t.lat,-n.bX,n.bX),u=this.projection.project(t.lng,r);return new n.P(u.x*this.worldSize,u.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/n.bH(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,r){let u,p;const _=this.centerPoint;if(this.projection.name==="globe"){const C=this.worldSize;u=(r.x-_.x)/C,p=(r.y-_.y)/C}else{const C=this.pointCoordinate(r),O=this.pointCoordinate(_);u=C.x-O.x,p=C.y-O.y}const b=this.locationCoordinate(t);this.setLocation(new n.aa(b.x-u,b.y-p))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t){return this.projection.locationPoint(this,t)}locationPoint3D(t){return this.projection.locationPoint(this,t,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t){return this.coordinateLocation(this.pointCoordinate3D(t))}locationCoordinate(t,r){const u=r?n.bH(r,t.lat):void 0,p=this.projection.project(t.lng,t.lat);return new n.aa(p.x,p.y,u)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,r){const u=r??this._centerAltitude,p=[t.x,t.y,0,1],_=[t.x,t.y,1,1];n.ab.vec4.transformMat4(p,p,this.pixelMatrixInverse),n.ab.vec4.transformMat4(_,_,this.pixelMatrixInverse);const b=_[3];n.ab.vec4.scale(p,p,1/p[3]),n.ab.vec4.scale(_,_,1/b);const C=p[2],O=_[2];return{p0:p,p1:_,t:C===O?0:(u-C)/(O-C)}}screenPointToMercatorRay(t){const r=[t.x,t.y,0,1],u=[t.x,t.y,1,1];return n.ab.vec4.transformMat4(r,r,this.pixelMatrixInverse),n.ab.vec4.transformMat4(u,u,this.pixelMatrixInverse),n.ab.vec4.scale(r,r,1/r[3]),n.ab.vec4.scale(u,u,1/u[3]),r[2]=n.bH(r[2],this._center.lat)*this.worldSize,u[2]=n.bH(u[2],this._center.lat)*this.worldSize,n.ab.vec4.scale(r,r,1/this.worldSize),n.ab.vec4.scale(u,u,1/this.worldSize),new n.aq([r[0],r[1],r[2]],n.ab.vec3.normalize([],n.ab.vec3.sub([],u,r)))}rayIntersectionCoordinate(t){const{p0:r,p1:u,t:p}=t,_=n.bH(r[2],this._center.lat),b=n.bH(u[2],this._center.lat);return new n.aa(n.af(r[0],u[0],p)/this.worldSize,n.af(r[1],u[1],p)/this.worldSize,n.af(_,b,p))}pointCoordinate(t,r=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,r)}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);let r=this.projection.pointCoordinate3D(this,t.x,t.y);if(r)return new n.aa(r[0],r[1],r[2]);let u=0,p=this.horizonLineFromTop();if(t.y>p)return this.pointCoordinate(t);const _=.02*p,b=t.clone();for(let C=0;C<10&&p-u>_;C++){b.y=n.af(u,p,.66);const O=this.projection.pointCoordinate3D(this,b.x,b.y);O?(p=b.y,r=O):u=b.y}return r?new n.aa(r[0],r[1],r[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=n.bY)return!this.isPointAboveHorizon(t);const r=this.pointCoordinate(t);return r.y>=0&&r.y<=1}_coordinatePoint(t,r){const u=r&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,p=[t.x*this.worldSize,t.y*this.worldSize,u+t.toAltitude(),1];return n.ab.vec4.transformMat4(p,p,this.pixelMatrix),p[3]>0?new n.P(p[0]/p[3],p[1]/p[3]):new n.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:r}=this._edgeInsets,u=this.height-this._edgeInsets.bottom,p=this.width-this._edgeInsets.right,_=this.pointLocation3D(new n.P(r,t)),b=this.pointLocation3D(new n.P(p,t)),C=this.pointLocation3D(new n.P(p,u)),O=this.pointLocation3D(new n.P(r,u));let P=Math.min(_.lng,b.lng,C.lng,O.lng),F=Math.max(_.lng,b.lng,C.lng,O.lng),V=Math.min(_.lat,b.lat,C.lat,O.lat),U=Math.max(_.lat,b.lat,C.lat,O.lat);const H=Math.pow(2,-this.zoom)/16*270,J=this.projection.name==="globe"?1:4,$=(te,ee,le,pe,fe)=>{const be=(te+le)/2,me=(ee+pe)/2,ve=new n.P(be,me),{lng:_e,lat:Ee}=this.pointLocation3D(ve),ze=Math.max(0,P-_e,V-Ee,_e-F,Ee-U);P=Math.min(P,_e),F=Math.max(F,_e),V=Math.min(V,Ee),U=Math.max(U,Ee),(fe<J||ze>H)&&($(te,ee,be,me,fe+1),$(be,me,le,pe,fe+1))};if($(r,t,p,t,1),$(p,t,p,u,1),$(p,u,r,u,1),$(r,u,r,t,1),this.projection.name==="globe"){const[te,ee]=n.bZ(this);te?(U=90,F=180,P=-180):ee&&(V=-90,F=180,P=-180)}return new n.az(new n.bO(P,V),new n.bO(F,U))}_getBoundsRectangular(t,r){const{top:u,left:p}=this._edgeInsets,_=this.height-this._edgeInsets.bottom,b=this.width-this._edgeInsets.right,C=new n.P(p,u),O=new n.P(b,u),P=new n.P(b,_),F=new n.P(p,_);let V=this.pointCoordinate(C,t),U=this.pointCoordinate(O,t);const H=this.pointCoordinate(P,r),J=this.pointCoordinate(F,r),$=(te,ee)=>(ee.y-te.y)/(ee.x-te.x);return V.y>1&&U.y>=0?V=new n.aa((1-J.y)/$(J,V)+J.x,1):V.y<0&&U.y<=1&&(V=new n.aa(-J.y/$(J,V)+J.x,0)),U.y>1&&V.y>=0?U=new n.aa((1-H.y)/$(H,U)+H.x,1):U.y<0&&V.y<=1&&(U=new n.aa(-H.y/$(H,U)+H.x,0)),new n.az().extend(this.coordinateLocation(V)).extend(this.coordinateLocation(U)).extend(this.coordinateLocation(J)).extend(this.coordinateLocation(H))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const r=t.visibleDemTiles.reduce((u,p)=>{if(p.dem){const _=p.dem.tree;u.min=Math.min(u.min,_.minimums[0]),u.max=Math.max(u.max,_.maximums[0])}return u},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(r.min*t.exaggeration(),r.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const r=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,u=this.height/2-r*(1-this._horizonShift);return t?Math.max(0,u):u}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-n.bX,this.maxLat=n.bX,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=n.at(this.minLng)*this.tileSize,this.worldMaxX=n.at(this.maxLng)*this.tileSize,this.worldMinY=n.aA(this.maxLat)*this.tileSize,this.worldMaxY=n.aA(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,r){return this.projection.createTileMatrix(this,r,t)}calculateDistanceTileData(t){const r=t.key,u=this._distanceTileDataCache;if(u[r])return u[r];const p=t.canonical,_=1/this.height,b=this.cameraWorldSize,C=b/this.zoomScale(p.z),O=(p.x+Math.pow(2,p.z)*t.wrap)*C,P=p.y*C,F=this.point;F.x*=b/this.worldSize,F.y*=b/this.worldSize;const V=this.angle,U=Math.sin(-V),H=-Math.cos(-V);return u[r]={bearing:[U,H],center:[(F.x-O)*_,(F.y-P)*_],scale:C/n.ag*_},u[r]}calculateFogTileMatrix(t){const r=t.key,u=this._fogTileMatrixCache;if(u[r])return u[r];const p=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return n.ab.mat4.multiply(p,this.worldToFogMatrix,p),u[r]=new Float32Array(p),u[r]}calculateProjMatrix(t,r=!1,u=!1){const p=t.key;let _;if(_=u?this._expandedProjMatrixCache:r?this._alignedProjMatrixCache:this._projMatrixCache,_[p])return _[p];const b=this.calculatePosMatrix(t,this.worldSize);let C;return C=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:u?this.expandedFarZProjMatrix:r?this.alignedProjMatrix:this.projMatrix,n.ab.mat4.multiply(b,C,b),_[p]=new Float32Array(b),_[p]}calculatePixelsToTileUnitsMatrix(t){const r=t.tileID.key,u=this._pixelsToTileUnitsCache;if(u[r])return u[r];const p=n.b_(t,this);return u[r]=p,u[r]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const t=1/this.worldSize,r=n.ab.mat4.fromScaling([],[t,t,t]);return n.ab.mat4.multiply(r,r,this.globeMatrix),r}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const t=this._elevation;this._updateCameraState();const r=n.bH(1,this._center.lat)*this.worldSize,u=this._computeCameraPosition(r),p=this._camera.forward(),_=n.bH(1,this._center.lat);u[2]/=_,p[2]/=_,n.ab.vec3.normalize(p,p);const b=t.raycast(u,p,t.exaggeration());if(b){const C=n.ab.vec3.scaleAndAdd([],u,p,b),O=new n.aa(C[0],C[1],n.bH(C[2],n.aS(C[1]))),P=(O.z+n.ab.vec3.length([O.x-u[0],O.y-u[1],O.z-u[2]*_]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(P),this._centerAltitude=O.toAltitude(),this._center=this.coordinateLocation(O),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const r=this._elevation,u=n.bH(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(u),_=r.getAtPointOrZero(new n.aa(...p)),b=this.pixelsPerMeter/this.worldSize*_,C=this._minimumHeightOverTerrain(),O=p[2]-b;if(O<=C)if(O<0||t){const P=this.locationCoordinate(this._center,this._centerAltitude),F=[p[0],p[1],P.z-p[2]],V=n.ab.vec3.length(F);F[2]-=(C-O)/this._pixelsPerMercatorPixel;const U=n.ab.vec3.length(F);if(U===0)return;n.ab.vec3.scale(F,F,V/U*this._pixelsPerMercatorPixel),this._camera.position=[p[0],p[1],P.z*this._pixelsPerMercatorPixel-F[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const U=this.center;return U.lat=n.aw(U.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(U.lng=n.aw(U.lng,this.minLng,this.maxLng)),this.center=U,void(this._constraining=!1)}const r=this._unmodified,{x:u,y:p}=this.point;let _=0,b=u,C=p;const O=this.width/2,P=this.height/2,F=this.worldMinY*this.scale,V=this.worldMaxY*this.scale;if(p-P<F&&(C=F+P),p+P>V&&(C=V-P),V-F<this.height&&(_=Math.max(_,this.height/(V-F)),C=(V+F)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const U=this.worldMinX*this.scale,H=this.worldMaxX*this.scale,J=this.worldSize/2-(U+H)/2;b=(u+J+this.worldSize)%this.worldSize-J,b-O<U&&(b=U+O),b+O>H&&(b=H-O),H-U<this.width&&(_=Math.max(_,this.width/(H-U)),b=(H+U)/2)}b===u&&C===p||(this.center=this.unproject(new n.P(b,C))),_&&(this.zoom+=this.scaleZoom(_)),this._constrainCamera(),this._unmodified=r,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,r=this.projection.name==="globe",u=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=n.bH(1,this.center.lat)/n.bH(1,n.c8));const p=n.b$(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,p),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const _=this.projection.zAxisUnit==="meters"?u:1,b=this._camera.getWorldToCamera(this.worldSize,_);let C;const O=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(O[8]=2*-t.x/this.width,O[9]=2*t.y/this.height,this.isOrthographic){let Ee=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),ze=Ee*this.aspect,Ye=-ze,qe=-Ee;ze-=t.x,Ye-=t.x,Ee+=t.y,qe+=t.y,C=this._camera.getCameraToClipOrthographic(Ye,ze,qe,Ee,this._nearZ,this._farZ),((lt,it,Be,Ke)=>{for(let gt=0;gt<16;gt++)lt[gt]=Yh(it[gt],Be[gt],Ke)})(C,C,O,Xu(this.pitch>=15?1:this.pitch/15))}else C=O;const P=n.ab.mat4.mul([],O,b);let F=n.ab.mat4.mul([],C,b);if(this.projection.isReprojectedInTileSpace){const Ee=this.locationCoordinate(this.center),ze=n.ab.mat4.identity([]);n.ab.mat4.translate(ze,ze,[Ee.x*this.worldSize,Ee.y*this.worldSize,0]),n.ab.mat4.multiply(ze,ze,n.c0(this)),n.ab.mat4.translate(ze,ze,[-Ee.x*this.worldSize,-Ee.y*this.worldSize,0]),n.ab.mat4.multiply(F,F,ze),n.ab.mat4.multiply(P,P,ze),this.inverseAdjustmentMatrix=n.c1(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=n.ab.mat4.scale([],F,[this.worldSize,this.worldSize,this.worldSize/_,1]),this.projMatrix=F,this.invProjMatrix=n.ab.mat4.invert(new Float64Array(16),this.projMatrix),r){const Ee=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Ee[8]=2*-t.x/this.width,Ee[9]=2*t.y/this.height,this.expandedFarZProjMatrix=n.ab.mat4.mul([],Ee,b)}else this.expandedFarZProjMatrix=this.projMatrix;const V=n.ab.mat4.invert([],C);this.frustumCorners=n.c2.fromInvProjectionMatrix(V,this.horizonLineFromTop(),this.height),this.cameraFrustum=n.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!r);const U=new Float32Array(16);n.ab.mat4.identity(U),n.ab.mat4.scale(U,U,[1,-1,1]),n.ab.mat4.rotateX(U,U,this._pitch),n.ab.mat4.rotateZ(U,U,this.angle);const H=n.ab.mat4.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=n.ab.mat4.clone(H);const J=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;H[8]=2*-t.x/this.width,H[9]=2*(t.y+J)/this.height,this.skyboxMatrix=n.ab.mat4.multiply(U,H,U);const $=this.point,te=$.x,ee=$.y,le=this.width%2/2,pe=this.height%2/2,fe=Math.cos(this.angle),be=Math.sin(this.angle),me=te-Math.round(te)+fe*le+be*pe,ve=ee-Math.round(ee)+fe*pe+be*le,_e=new Float64Array(F);if(n.ab.mat4.translate(_e,_e,[me>.5?me-1:me,ve>.5?ve-1:ve,0]),this.alignedProjMatrix=_e,F=n.ab.mat4.create(),n.ab.mat4.scale(F,F,[this.width/2,-this.height/2,1]),n.ab.mat4.translate(F,F,[1,-1,0]),this.labelPlaneMatrix=F,F=n.ab.mat4.create(),n.ab.mat4.scale(F,F,[1,-1,1]),n.ab.mat4.translate(F,F,[-1,-1,0]),n.ab.mat4.scale(F,F,[2/this.width,2/this.height,1]),this.glCoordMatrix=F,this.pixelMatrix=n.ab.mat4.multiply(new Float64Array(16),this.labelPlaneMatrix,P),this._calcFogMatrices(),this._distanceTileDataCache={},F=n.ab.mat4.invert(new Float64Array(16),this.pixelMatrix),!F)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=F,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=n.c3(this);const Ee=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=n.ab.vec3.transformMat4(Ee,Ee,b),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=F;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,r=this.cameraPixelsPerMeter,u=this._camera.position,p=1/this.height/this._pixelsPerMercatorPixel,_=[t,t,r];n.ab.vec3.scale(_,_,p),n.ab.vec3.scale(u,u,-1),n.ab.vec3.multiply(u,u,_);const b=n.ab.mat4.create();n.ab.mat4.translate(b,b,u),n.ab.mat4.scale(b,b,_),this.mercatorFogMatrix=b,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,r,p)}_computeCameraPosition(t){const r=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,u=this._camera.forward(),p=this.point,_=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*r-t/this.worldSize*this._centerAltitude;return[p.x/this.worldSize-u[0]*_,p.y/this.worldSize-u[1]*_,t/this.worldSize*this._centerAltitude-u[2]*_]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const r=this._maxCameraBoundsDistance()*Math.cos(this._pitch),u=this._camera.position[2],p=t[2];let _=1;this.projection.wrap&&(this.center=this.center.wrap()),p>0&&(_=Math.min((r-u)/p,1)),this._camera.position=n.ab.vec3.scaleAndAdd([],this._camera.position,t,_),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,r=this._camera.forward(),{pitch:u,bearing:p}=this._camera.getPitchBearing(),_=n.bH(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,b=this._mercatorZfromZoom(this._maxZoom)*Math.cos(n.ai(this._maxPitch)),C=Math.max((t[2]-_)/Math.cos(u),b),O=this._zoomFromMercatorZ(C);n.ab.vec3.scaleAndAdd(t,t,r,C),this._pitch=n.aw(u,n.ai(this.minPitch),n.ai(this.maxPitch)),this.angle=n.bF(p,-Math.PI,Math.PI),this._setZoom(n.aw(O,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new n.aa(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}zoomFromMercatorZAdjusted(t){let r=0,u=n.bY,p=0,_=1/0;for(;u-r>1e-6&&u>r;){const b=r+.5*(u-r),C=this.tileSize*Math.pow(2,b),O=this.getCameraToCenterDistance(this.projection,b,C),P=this.scaleZoom(O/(t*this.tileSize)),F=Math.abs(b-P);F<_&&(_=F,p=b),b<P?r=b:u=b}return p}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(n.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,r){const u=Math.min(t.x,r.x),p=Math.max(t.x,r.x),_=Math.min(t.y,r.y),b=Math.max(t.y,r.y);if(_<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const C=[new n.P(u,_),new n.P(p,b),new n.P(u,b),new n.P(p,_)],O=this.renderWorldCopies?-3:0,P=this.renderWorldCopies?4:1;for(const F of C){const V=this.pointRayIntersection(F);if(V.t<0)return!0;const U=this.rayIntersectionCoordinate(V);if(U.x<O||U.y<0||U.x>P||U.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+n.c4(this.fovAboveCenter)>88||this.anyCornerOffEdge(new n.P(0,0),new n.P(this.width,this.height))}zoomDeltaToMovement(t,r){const u=n.ab.vec3.length(n.ab.vec3.sub([],this._camera.position,t)),p=this._zoomFromMercatorZ(u)+r;return u-this._mercatorZfromZoom(p)}getCameraPoint(){if(this.projection.name==="globe"){const t=function([r,u,p],_){const b=[r,u,p,1];n.ab.vec4.transformMat4(b,b,_);const C=b[3]=Math.max(b[3],1e-6);return b[0]/=C,b[1]/=C,b[2]/=C,b}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new n.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new n.P(0,t))}}getCameraToCenterDistance(t,r=this.zoom,u=this.worldSize){const p=n.b$(t,r,this.width,this.height,1024),_=t.pixelSpaceConversion(this.center.lat,u,p);let b=.5/Math.tan(.5*this._fov)*this.height*_;return this.isOrthographic&&(b=Yh(1,b,Xu(this.pitch>=15?1:this.pitch/15))),b}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&n.ab.mat4.multiply(t,t,this.globeMatrix),t}getFrustum(t){return n.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}const al=(c,t)=>{if(t>0&&c.terrain&&n.w("Cutoff is currently disabled on terrain"),t<=0||c.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const r=c.transform,u=Math.max(Math.abs(r._zoom-(c.minCutoffZoom-1)),1),p=r.isLODDisabled(!1)?n.ac(60,45,r.pitch):n.ac(30,15,r.pitch),_=r._farZ-r._nearZ,b=t*r.height,C=((1-(O=p))*r.cameraToCenterDistance+O*(r._farZ+b))*u;var O;return{shouldRenderCutoff:p<1,uniformValues:{u_cutoff_params:[r._nearZ,r._farZ,(C-r._nearZ)/_,(C-b-r._nearZ)/_]}}},Gn={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class Oo{constructor(t,r){this.aabb=t,this.lastCascade=r}}class sd{add(t,r){const u=this.receivers[t.key];u!==void 0?(u.aabb.min[0]=Math.min(u.aabb.min[0],r.min[0]),u.aabb.min[1]=Math.min(u.aabb.min[1],r.min[1]),u.aabb.min[2]=Math.min(u.aabb.min[2],r.min[2]),u.aabb.max[0]=Math.max(u.aabb.max[0],r.max[0]),u.aabb.max[1]=Math.max(u.aabb.max[1],r.max[1]),u.aabb.max[2]=Math.max(u.aabb.max[2],r.max[2])):this.receivers[t.key]=new Oo(r,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,r,u){const p=n.cd.fromPoints(t.points);let _=0;for(const b in this.receivers){const C=this.receivers[b];if(!C||!p.intersectsAabb(C.aabb))continue;C.aabb.min=p.closestPoint(C.aabb.min),C.aabb.max=p.closestPoint(C.aabb.max);const O=C.aabb.getCorners();for(let P=0;P<u.length;P++){let F=!0;for(const V of O){const U=[V[0]*r,V[1]*r,V[2]];if(n.ab.vec3.transformMat4(U,U,u[P].matrix),U[0]<-1||U[0]>1||U[1]<-1||U[1]>1){F=!1;break}}if(C.lastCascade=P,_=Math.max(_,P),F)break}}return _+1}}class Hn{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new sd,this._depthMode=new ci(t.context.gl.LEQUAL,ci.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,t.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),t.tp.registerParameter(Gn,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),t.tp.registerParameter(Gn,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),t.tp.registerParameter(Gn,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),t.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,r){const u=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!r||!r.properties)return;const p=r.properties.get("shadow-intensity");if(!r.shadowsEnabled()||p<=0||(this._shadowLayerCount=u.style.order.reduce((J,$)=>{const te=u.style._mergedLayers[$];return J+(te.hasShadowPass()&&!te.isHidden(t.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const _=u.context,b=Gn.shadowMapResolution,C=Gn.shadowMapResolution;if(this._cascades.length===0||Gn.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let J=0;J<Gn.cascadeCount;++J){const $=u._shadowMapDebug,te=_.gl,ee=_.createFramebuffer(b,C,$,"texture"),le=new n.T(_,{width:b,height:C,data:null},te.DEPTH_COMPONENT16);if(ee.depthAttachment.set(le.texture),$){const pe=new n.T(_,{width:b,height:C,data:null},te.RGBA8);ee.colorAttachment.set(pe.texture)}this._cascades.push({framebuffer:ee,texture:le,matrix:[],far:0,boundingSphereRadius:0,frustum:new n.bR,scale:0})}}this.shadowDirection=sl(r);let O=0;if(t.elevation){const J=t.elevation,$=[1e4,-1e4];J.visibleDemTiles.filter(te=>te.dem).forEach(te=>{const ee=te.dem.tree;$[0]=Math.min($[0],ee.minimums[0]),$[1]=Math.max($[1],ee.maximums[0])}),$[0]!==1e4&&(O=($[1]-$[0])*J.exaggeration())}const P=1.5*t.cameraToCenterDistance,F=3*P,V=new Float64Array(16);for(let J=0;J<this._cascades.length;++J){const $=this._cascades[J];let te=t.height/50,ee=1;Gn.cascadeCount===1?ee=F:J===0?ee=P:(te=P,ee=F);const[le,pe]=fp(t,this.shadowDirection,te,ee,Gn.shadowMapResolution,O);$.scale=t.scale,$.matrix=le,$.boundingSphereRadius=pe,n.ab.mat4.invert(V,$.matrix),$.frustum=n.bR.fromInvProjectionMatrix(V,1,0,!0),$.far=ee}const U=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[U].far,this._cascades[U].far],this._uniformValues.u_shadow_intensity=p,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Gn.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Gn.shadowMapResolution,this._uniformValues.u_shadowmap_0=zn.ShadowMap0,this._uniformValues.u_shadowmap_1=zn.ShadowMap0+1,this._groundShadowTiles=u.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const H=u.transform.elevation;for(const J of this._groundShadowTiles){let $={min:0,max:0};if(H){const te=H.getMinMaxForTile(J);te&&($=te)}this.addShadowReceiver(J.toUnwrapped(),$.min,$.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(t,r){if(!this.enabled)return;const u=this.painter,p=u.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(u.transform.getFrustum(0),u.transform.worldSize,this._cascades),p.viewport.set([0,0,Gn.shadowMapResolution,Gn.shadowMapResolution]);for(let _=0;_<this._numCascadesToRender;++_){u.currentShadowCascade=_,p.bindFramebuffer.set(this._cascades[_].framebuffer.framebuffer),p.clear({color:n.aj.white,depth:1});for(const b of t.order){const C=t._mergedLayers[b];if(!C.hasShadowPass()||C.isHidden(u.transform.zoom))continue;const O=t.getLayerSourceCache(C),P=O?r[O.id]:void 0;(C.type==="model"||P&&P.length)&&u.renderLayer(u,O,C,P)}}u.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const t=this.painter,r=t.style,u=t.context,p=r.directionalLight,_=r.ambientLight;if(!p||!_)return;const b=[],C=al(t,t.longestCutoffRange);C.shouldRenderCutoff&&b.push("RENDER_CUTOFF"),b.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&b.push("NORMAL_OFFSET");const O=Wh(r,p,_),P=new ci(u.gl.LEQUAL,ci.ReadOnly,t.depthRangeFor3D);for(const F of this._groundShadowTiles){const V=F.toUnwrapped(),U=t.isTileAffectedByFog(F),H=t.getOrCreateProgram("groundShadow",{defines:b,overrideFog:U});this.setupShadows(V,H),t.uploadCommonUniforms(u,H,V,null,C);const J={u_matrix:t.transform.calculateProjMatrix(V),u_ground_shadow_factor:O};H.draw(t,u.gl.TRIANGLES,P,vi.disabled,Ui.multiply,yi.disabled,J,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,{},t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Ui.unblended:Ui.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const r=this.painter.transform,u=r.calculatePosMatrix(t,r.worldSize);return n.ab.mat4.multiply(u,this._cascades[this.painter.currentShadowCascade].matrix,u),Float32Array.from(u)}calculateShadowPassMatrixFromMatrix(t){return n.ab.mat4.multiply(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,r,u,p=0){if(!this.enabled)return;const _=this.painter.transform,b=this.painter.context,C=b.gl,O=this._uniformValues,P=new Float64Array(16),F=_.calculatePosMatrix(t,_.worldSize);for(let V=0;V<this._cascades.length;V++)n.ab.mat4.multiply(P,this._cascades[V].matrix,F),O[V===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(P),b.activeTexture.set(C.TEXTURE0+zn.ShadowMap0+V),this._cascades[V].texture.bind(C.NEAREST,C.CLAMP_TO_EDGE);if(this.useNormalOffset=!!u,this.useNormalOffset){const V=n.cc(t.canonical),U=2/_.tileSize*n.ag/Gn.shadowMapResolution,H=U*this._cascades[0].boundingSphereRadius,J=U*this._cascades[this._cascades.length-1].boundingSphereRadius,$=(u==="vector-tile"?1:3)/Math.pow(2,p-t.canonical.z-(1-_.zoom+Math.floor(_.zoom)));O.u_shadow_normal_offset=[V,H*$,J*$],O.u_shadow_bias=[6e-5,.0012,.012]}else O.u_shadow_bias=[36e-5,.0012,.012];r.setShadowUniformValues(b,O)}setupShadowsFromMatrix(t,r,u=!1){if(!this.enabled)return;const p=this.painter.context,_=p.gl,b=this._uniformValues,C=new Float64Array(16);for(let O=0;O<Gn.cascadeCount;O++)n.ab.mat4.multiply(C,this._cascades[O].matrix,t),b[O===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(C),p.activeTexture.set(_.TEXTURE0+zn.ShadowMap0+O),this._cascades[O].texture.bind(_.NEAREST,_.CLAMP_TO_EDGE);if(this.useNormalOffset=u,u){const O=Gn.normalOffset;b.u_shadow_normal_offset=[1,O,O],b.u_shadow_bias=[6e-5,.0012,.012]}else b.u_shadow_bias=[36e-5,.0012,.012];r.setShadowUniformValues(p,b)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,r,u,p){if(p[2]>=0)return{};const _=function(O,P,F){const V=F/(1<<O.canonical.z);return new n.cd([O.canonical.x*V+O.wrap*F,O.canonical.y*V+O.wrap*F,0],[(O.canonical.x+1)*V+O.wrap*F,(O.canonical.y+1)*V+O.wrap*F,P])}(t,r,u).getCorners(),b=r/-p[2];p[0]<0?(n.ab.vec3.add(_[0],_[0],[p[0]*b,0,0]),n.ab.vec3.add(_[3],_[3],[p[0]*b,0,0])):p[0]>0&&(n.ab.vec3.add(_[1],_[1],[p[0]*b,0,0]),n.ab.vec3.add(_[2],_[2],[p[0]*b,0,0])),p[1]<0?(n.ab.vec3.add(_[0],_[0],[0,p[1]*b,0]),n.ab.vec3.add(_[1],_[1],[0,p[1]*b,0])):p[1]>0&&(n.ab.vec3.add(_[2],_[2],[0,p[1]*b,0]),n.ab.vec3.add(_[3],_[3],[0,p[1]*b,0]));const C={};return C.vertices=_,C.planes=[js(_[1],_[0],_[4]),js(_[2],_[1],_[5]),js(_[3],_[2],_[6]),js(_[0],_[3],_[7])],C}addShadowReceiver(t,r,u){this._receivers.add(t,n.cd.fromTileIdAndHeight(t,r,u))}getMaxCascadeForTile(t){const r=this._receivers.get(t);return r&&r.lastCascade?r.lastCascade:0}}function js(c,t,r){const u=n.ab.vec3.sub([],r,t),p=n.ab.vec3.sub([],c,t),_=n.ab.vec3.cross([],u,p),b=n.ab.vec3.length(_);return b===0?[0,0,1,0]:(n.ab.vec3.scale(_,_,1/b),[_[0],_[1],_[2],-n.ab.vec3.dot(_,t)])}function sl(c){const t=c.properties.get("direction"),r=n.cb(t.x,t.y,t.z);r[2]=n.aw(r[2],0,75);const u=n.ce([r[0],r[1],r[2]]);return n.ab.vec3.fromValues(u.x,u.y,u.z)}function Wh(c,t,r){const u=t.properties.get("color-use-theme")==="none",p=t.properties.get("color"),_=t.properties.get("intensity"),b=t.properties.get("direction"),C=[b.x,b.y,b.z],O=r.properties.get("color-use-theme")==="none",P=r.properties.get("color"),F=r.properties.get("intensity"),V=Math.max(n.ab.vec3.dot([0,0,1],C),0),U=[0,0,0];n.ab.vec3.scale(U,P.toRenderColor(O?null:c.getLut(t.scope)).toArray01Linear().slice(0,3),F);const H=[0,0,0];return n.ab.vec3.scale(H,p.toRenderColor(u?null:c.getLut(r.scope)).toArray01Linear().slice(0,3),V*_),n.cf([U[0]>0?U[0]/(U[0]+H[0]):0,U[1]>0?U[1]/(U[1]+H[1]):0,U[2]>0?U[2]/(U[2]+H[2]):0])}function fp(c,t,r,u,p,_){const b=c.zoom,C=c.scale,O=c.worldSize,P=1/O,F=c.aspect,V=Math.sqrt(1+F*F)*Math.tan(.5*c.fovX),U=V*V,H=u-r,J=u+r;let $,te;U>H/J?($=u,te=u*V):($=.5*J*(1+U),te=.5*Math.sqrt(H*H+2*(u*u+r*r)*U+J*J*U*U));const ee=c.projection.pixelsPerMeter(c.center.lat,O),le=c._camera.getCameraToWorldMercator(),pe=[0,0,-$*P];n.ab.vec3.transformMat4(pe,pe,le);let fe=te*P;const be=c._edgeInsets;if(!(be.left===0&&be.top===0&&be.right===0&&be.bottom===0||be.left===be.right&&be.top===be.bottom)){const St=c._camera.getWorldToCamera(c.worldSize,c.projection.zAxisUnit==="meters"?ee:1),dt=c._camera.getCameraToClipPerspective(c._fov,c.width/c.height,r,u);dt[8]=2*-c.centerOffset.x/c.width,dt[9]=2*c.centerOffset.y/c.height;const ct=new Float64Array(16);n.ab.mat4.mul(ct,dt,St);const vt=new Float64Array(16);n.ab.mat4.invert(vt,ct);const Ct=n.bR.fromInvProjectionMatrix(vt,O,b,!0);for(const Vt of Ct.points){const Yt=((me=Vt)[0]/=C,me[1]/=C,me[2]=n.bH(me[2],c._center.lat),me);fe=Math.max(fe,n.ab.vec3.len(n.ab.vec3.subtract([],pe,Yt)))}}var me;fe*=p/(p-1);const ve=Math.acos(t[2]),_e=Math.atan2(-t[0],-t[1]),Ee=new fa;Ee.position=pe,Ee.setPitchBearing(ve,_e);const ze=Ee.getWorldToCamera(O,ee),Ye=fe*O,qe=Math.min(c._mercatorZfromZoom(17)*O*-2,-2*Ye),lt=Ee.getCameraToClipOrthographic(-Ye,Ye,-Ye,Ye,qe,(Ye+_*ee)/t[2]),it=new Float64Array(16);n.ab.mat4.multiply(it,lt,ze);const Be=n.ab.vec3.fromValues(Math.floor(1e6*pe[0])/1e6*O,Math.floor(1e6*pe[1])/1e6*O,0),Ke=.5*p,gt=[0,0,0];n.ab.vec3.transformMat4(gt,Be,it),n.ab.vec3.scale(gt,gt,Ke);const Fe=[Math.floor(gt[0]),Math.floor(gt[1]),Math.floor(gt[2])],st=[0,0,0];n.ab.vec3.sub(st,gt,Fe),n.ab.vec3.scale(st,st,-1/Ke);const Je=new Float64Array(16);return n.ab.mat4.identity(Je),n.ab.mat4.translate(Je,Je,st),n.ab.mat4.multiply(it,Je,it),[it,Ye]}class $h extends n.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.modelUris={"":{}},this.numModelsLoading={}}loadModel(t,r){return n.aM(this.requestManager.transformRequest(r,n.R.Model).url).then(u=>{if(!u)return;const p=n.aN(u),_=new n.aO(t,void 0,void 0,p);return _.computeBoundsAndApplyParent(),_}).catch(u=>{if(u&&u.status===404)return null;this.fire(new n.y(new Error(`Could not load model ${t} from ${r}: ${u.message}`)))})}load(t,r,u={keepNumReferences:!1}){this.models[r]||(this.models[r]={});const p=Object.keys(t);this.numModelsLoading[r]=(this.numModelsLoading[r]||0)+p.length;const _=[];for(const b of p)_.push(this.loadModel(b,t[b]));Promise.allSettled(_).then(b=>{for(let C=0;C<b.length;C++){const{status:O,value:P}=b[C];if(O==="fulfilled"&&P){const F=this.models[r][p[C]];this.models[r][p[C]]={model:P,numReferences:u.keepNumReferences&&F?F.numReferences:1}}}this.numModelsLoading[r]-=p.length,this.fire(new n.z("data",{dataType:"style"}))}).catch(b=>{this.fire(new n.y(new Error(`Could not load models: ${b.message}`)))})}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,r){return!!this.getModel(t,r)}getModel(t,r){return this.models[r]||(this.models[r]={}),this.models[r][t]?this.models[r][t].model:void 0}addModel(t,r,u){this.models[u]||(this.models[u]={}),this.modelUris[u]||(this.modelUris[u]={}),this.hasModel(t,u)&&this.models[u][t].numReferences++,this.modelUris[u][t]=this.requestManager.normalizeModelURL(r),this.load({[t]:this.modelUris[u][t]},u)}addModels(t,r){this.models[r]||(this.models[r]={}),this.modelUris[r]||(this.modelUris[r]={});const u=this.modelUris[r];for(const p in t)this.models[r][p]={},u[p]=this.requestManager.normalizeModelURL(t[p]);this.load(u,r,{keepNumReferences:!0})}reloadModels(t){this.load(this.modelUris[t],t)}addModelsFromBucket(t,r){this.models[r]||(this.models[r]={}),this.modelUris[r]||(this.modelUris[r]={});const u={};for(const p of t)this.hasModel(p,r)?this.models[r][p].numReferences++:(this.modelUris[r][p]=this.requestManager.normalizeModelURL(p),u[p]=this.modelUris[r][p]);this.load(u,r)}removeModel(t,r){if(this.models[r]&&this.models[r][t]&&(this.models[r][t].numReferences--,this.models[r][t].numReferences===0)){const u=this.models[r][t].model;delete this.models[r][t],delete this.modelUris[r][t],u.destroy()}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,r){this.models[r]||(this.models[r]={});for(const u in this.models[r])this.models[r][u].model&&this.models[r][u].model.upload(t.context)}}const od=new n.a5({data:new n.a6(n.a3.colorTheme.data)}),dp={"mbx-indoor-active-floorplans":{default:["literal",[]]},"mbx-indoor-underground":{default:["literal",!1]},"mbx-indoor-loaded-levels":{default:["literal",[]]},"mbx-indoor-level-height":{default:["literal",{}]},"mbx-indoor-level-base":{default:["literal",{}]},"mbx-indoor-level-selected":{default:["literal",{}]},"mbx-indoor-level-overlapped":{default:["literal",{}]}};function ld(c){return c=c||{},Object.assign(c,dp)}class ol extends n.E{constructor(t){super(),this.mergeFloors=!0,this._scope=void 0,this._queryFeatureSetId=void 0,this._buildingEntryFeatureSetId=void 0,this._selectedFloorplan=void 0,this._indoorData=void 0,this._selectedLevel=void 0,this._floorplanStates={},n.aP(["_onLoad","_onMove","_checkFloorplanVisible"],this),this._map=t,this._checkFloorplanVisible(!0),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=void 0}_onLoad(){this._map.style.forEachFragmentStyle(t=>{t.stylesheet.indoor&&(this._queryFeatureSetId?this.fire(new n.y(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._queryFeatureSetId=t.stylesheet.indoor.floorplanFeaturesetId,this._buildingEntryFeatureSetId=t.stylesheet.indoor.buildingFeaturesetId,this._scope=t.scope))}),this._queryFeatureSetId&&this._buildingEntryFeatureSetId&&this._map.addInteraction("mbx-indoor-buildingclick",{type:"click",target:{featuresetId:this._buildingEntryFeatureSetId,importId:this._scope},handler:t=>(t.feature&&t.feature.properties.floorplan&&this.selectFloorplan(t.feature.properties.floorplan),!0)}),this._checkFloorplanVisible(!0)}_onMove(){this._checkFloorplanVisible(!1)}_checkFloorplanVisible(t){if(!this._queryFeatureSetId||!this._map.isStyleLoaded()||this._map.transform.zoom<13)return;this._indoorData&&!function(b,C){const[O,P]=b,{center:F,radius:V}=C,[U,H]=F,J=Math.abs(O-U);return Math.sqrt((J>180?360-J:J)**2+(P-H)**2)<=V}([this._map.getCenter().lng,this._map.getCenter().lat],this._indoorData.circumCircle)&&(this._indoorData=void 0,this._selectedFloorplan=void 0,this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[]]),this.fire(new n.z("floorplangone")));const r={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},u=new n.P(this._map.transform.width/2,this._map.transform.height/2),p=[new n.P(0,0),new n.P(this._map.transform.width,this._map.transform.height)],_=this._map.queryRenderedFeatures(t?p:u,r);_.length>0&&(this._selectedFloorplan&&_[0].properties.id===this._selectedFloorplan.properties.id||(this._selectedFloorplan=_[0],this._floorplanSelected(!1)))}_floorplanSelected(t){this._indoorData=JSON.parse(this._selectedFloorplan.properties["indoor-data"]),this._indoorData.id=this._selectedFloorplan.properties.id,this._indoorData.circumCircle=function(_){const[[b,C],[O,P]]=_,F=(O-b+360)%360,V=F>180?360-F:F;return{center:[(b+V/2+360)%360,(C+P)/2],radius:Math.sqrt(V**2+(P-C)**2)/2}}(this._indoorData.extent),this._floorplanStates[this._indoorData.id]||(this._floorplanStates[this._indoorData.id]={});const r=this._floorplanStates[this._indoorData.id].selectedBuilding,u=this._floorplanStates[this._indoorData.id].selectedLevel;let p;if(this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",this._indoorData.floorplanIDs),this._selectedLevel)for(const _ of this._indoorData.levels)_.id===this._selectedLevel.id&&(p=_.id);if(this.fire(new n.z("floorplanselected",{buildings:this._indoorData.buildings,levels:this._indoorData.levels,selectedLevelId:p})),r){const _=this._indoorData.buildings.find(b=>b.id===r);this._buildingSelected(_,!1)}else this._indoorData.buildings.length>0&&this._buildingSelected(this._indoorData.buildings[0],!1);if(u){const _=this._indoorData.levels.find(b=>b.id===u);this._updateLevels(_,t)}else t&&this._indoorData["default-levels"].length>0&&this.selectLevel(this._indoorData["default-levels"][0])}_buildingSelected(t,r){r&&t&&t.extent&&this._map.fitBounds(t.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),this._floorplanStates[this._indoorData.id].selectedBuilding=t?t.id:void 0;const u=this._indoorData.levels.filter(p=>t.levels.includes(p.id));this.fire(new n.z("buildingselected",{buildingId:t.id,levels:u}))}_levelSelected(t){if(t==="overview")this._updateLevels(void 0,!0);else{const r=this._indoorData.levels.find(u=>u.id===t);this._updateLevels(r,!0)}this.fire(new n.z("levelselected",{levelId:t==="overview"?void 0:t}))}_updateLevels(t,r){if(!t)return this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",[]]),this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._floorplanStates[this._indoorData.id].selectedLevel=void 0,void(r&&this._indoorData.extent&&this._map.fitBounds(this._indoorData.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}));function u(P){const F=P.indexOf("/floor/");if(F===-1)return P;const V=F+7,U=P.indexOf("/",V);return U===-1?P.slice(V):P.slice(V,U)}this._selectedLevel=t,this._floorplanStates[this._indoorData.id].selectedLevel=t?t.id:void 0;const p=[],_={},b={},C={},O={};for(const P of this._indoorData.levels)if(p.push(P.id),_[P.id]=P.height,b[P.id]=P.base,t){if(this.mergeFloors){const F=u(t.id),V=u(P.id);C[P.id]=V===F?"true":"false"}else C[P.id]=P.id===t.id?"true":"false";O[P.id]=P.base<t.base?"true":"false"}else O[P.id]=!0;if(this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",p]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-height",["literal",_]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-base",["literal",b]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",C]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-overlapped",["literal",O]),t&&(this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!!t.isUnderground),r&&t.extent)){const P=this._map.cameraForBounds(t.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),F=this._map.getZoom(),V=P.zoom?Math.abs(F-P.zoom):0;this._map.fitBounds(t.extent,V>=1?{pitch:this._map.getPitch(),bearing:this._map.getBearing()}:{pitch:this._map.getPitch(),bearing:this._map.getBearing(),zoom:F})}}selectFloorplan(t){const r={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},u=[new n.P(0,0),new n.P(this._map.transform.width,this._map.transform.height)],p=this._map.queryRenderedFeatures(u,r);if(p.length>0){for(const _ of p)if(JSON.parse(_.properties["indoor-data"]).floorplanIDs.includes(t)){this._selectedFloorplan=_,this._floorplanSelected(!0);break}}}selectBuilding(t){const r=this._indoorData.buildings.find(u=>u.id===t);this._buildingSelected(r,!0)}selectLevel(t){this._levelSelected(t)}}function cd(c){if(!c.metadata||!c.metadata.content_area)return;const t=n.q.devicePixelRatio,{left:r,top:u,width:p,height:_}=c.metadata.content_area,b=r*t,C=u*t;return[b,C,b+p*t,C+_*t]}function qc(c){if(c)return c.map(([t,r])=>[t*n.q.devicePixelRatio,r*n.q.devicePixelRatio])}const Lo=(c,t)=>Ls(c,t&&t.filter(r=>r.identifier!=="source.canvas")),pp=n.ay(Vi,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport"]),ll=n.ay(Vi,["setCenter","setZoom","setBearing","setPitch"]),cl=new Set(["background","sky","slot","custom"]),$l={version:8,layers:[],sources:{}},ud={duration:300,delay:0};class ta extends n.E{constructor(t,r={}){super(),this.map=t,this.scope=r.scope||"",this.globalId=null,this.fragments=[],this.importDepth=r.importDepth||0,this.importsCache=r.importsCache||new Map,this.resolvedImports=r.resolvedImports||new Set,this.transition=n.l({},ud),this._buildingIndex=new Xl(this),this.crossTileSymbolIndex=new Hh,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=r.styleChanges||new Pa,this.dispatcher=r.dispatcher?r.dispatcher:new n.D(n.ci(),this),r.imageManager?this.imageManager=r.imageManager:(this.imageManager=new kn(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=r.glyphManager?r.glyphManager:new n.cj(t._requestManager,r.localFontFamily?n.ck.all:r.localIdeographFontFamily?n.ck.ideographs:n.ck.none,r.localFontFamily||r.localIdeographFontFamily),r.modelManager?this.modelManager=r.modelManager:(this.modelManager=new $h(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=r.configOptions?r.configOptions:new Map,this._configDependentLayers=r.configDependentLayers?r.configDependentLayers:new Set,this._config=r.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:r.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=r.initialConfig,this.dispatcher.broadcast("setReferrer",n.cl());const u=this;this._rtlTextPluginCallback=ta.registerForPluginStateChange(p=>{u.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:p.pluginStatus,pluginURL:p.pluginURL},(_,b)=>{if(n.cm(_),b&&b.every(C=>C))for(const C in u._sourceCaches){const O=u._sourceCaches[C],P=O.getSource().type;P!=="vector"&&P!=="geojson"||O.reload()}})}),this.on("data",p=>{if(p.dataType!=="source"||p.sourceDataType!=="metadata")return;const _=this.getOwnSource(p.sourceId);if(_&&_.vectorLayerIds)for(const b in this._layers){const C=this._layers[b];C.source===_.id&&this._validateLayer(C)}})}load(t){return t?(typeof t=="string"?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(t){if(!t)return null;if(typeof t=="string"){if(n.f(t))return t;const r=n.cn(t);if(!r.startsWith("http"))try{return new URL(r,location.href).toString()}catch{return r}return r}return`json://${n.co(JSON.stringify(t))}`}_diffStyle(t,r,u){this.globalId=this._getGlobalId(t);const p=(_,b)=>{try{b(null,this.setState(_,u))}catch(C){b(C,!1)}};if(typeof t=="string"){const _=this.map._requestManager.normalizeStyleURL(t),b=this.map._requestManager.transformRequest(_,n.R.Style);n.n(b,(C,O)=>{C?this.fire(new n.y(C)):O&&p(O,r)})}else typeof t=="object"&&p(t,r)}loadURL(t,r={}){this.fire(new n.z("dataloading",{dataType:"style"}));const u=typeof r.validate=="boolean"?r.validate:!n.f(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,r.accessToken),this.resolvedImports.add(t);const p=this.importsCache.get(t);if(p)return this._load(p,u);const _=this.map._requestManager.transformRequest(t,n.R.Style);this._request=n.n(_,(b,C)=>{if(this._request=null,b)this.fire(new n.y(b));else if(C)return this.importsCache.set(t,C),this._load(C,u)})}loadJSON(t,r={}){this.fire(new n.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=n.q.frame(()=>{this._request=null,this._load(t,r.validate!==!1)})}loadEmpty(){this.fire(new n.z("dataloading",{dataType:"style"})),this._load($l,!1)}_loadImports(t,r,u){if(this.importDepth>=4)return n.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const p=[];for(const _ of t){const b=this._createFragmentStyle(_),C=new Promise(F=>{b.once("style.import.load",F),b.once("error",F)}).then(()=>this.mergeAll());if(p.push(C),this.resolvedImports.has(_.url)){b.loadEmpty();continue}const O=_.data||this.importsCache.get(_.url);O?(b.loadJSON(O,{validate:r}),this._isInternalStyle(O)&&(b.globalId=null)):_.url?b.loadURL(_.url,{validate:r}):b.loadEmpty();const P={style:b,id:_.id,config:_.config};if(u){const F=this.fragments.findIndex(({id:V})=>V===u);this.fragments=this.fragments.slice(0,F).concat(P).concat(this.fragments.slice(F))}else this.fragments.push(P)}return Promise.allSettled(p)}getImportGlobalIds(t=this,r=new Set){for(const u of t.fragments)u.style.globalId&&r.add(u.style.globalId),this.getImportGlobalIds(u.style,r);return[...r.values()]}_createFragmentStyle(t){const r=this.scope?n.aC(t.id,this.scope):t.id;let u;const p=this._initialConfig&&this._initialConfig[r];(t.config||p)&&(u=n.l({},t.config,p));const _=new ta(this.map,{scope:r,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:u,configOptions:this.options,colorThemeOverride:t["color-theme"],configDependentLayers:this._configDependentLayers});return _.setEventedParent(this.map,{style:_}),_}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&t.fragment!==!1)}_load(t,r){const u=t.indoor?ld(t.schema):t.schema;if(this._isInternalStyle(t)){const b=n.l({},$l,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(b,r)}if(this.updateConfig(this._config,u),r&&Lo(this,ha(t)))return;this._loaded=!0,this.stylesheet=n.cp(t);const p=()=>{for(const P in t.sources)this.addSource(P,t.sources[P],{validate:!1,isInitialLoad:!0});t.sprite?this._loadIconset(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(t.glyphs,this.scope);const b=Fu(this.stylesheet.layers);if(this._order=b.map(P=>P.id),this.stylesheet.light&&n.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const P=this.stylesheet.lights[0];this.light=new Q(P.properties,P.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Q(this.stylesheet.light)),this._layers={};for(const P of b){const F=n.cu(P,this.scope,this._styleColorTheme.lut,this.options);F.configDependencies.size!==0&&this._configDependentLayers.add(F.fqid),F.setEventedParent(this,{layer:{id:F.id}}),this._layers[F.id]=F;const V=this.getOwnLayerSourceCache(F),U=!!this.directionalLight&&this.directionalLight.shadowsEnabled();V&&F.canCastShadows()&&U&&(V.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const C=this.stylesheet.terrain;C&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(C,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new n.z("data",{dataType:"style"}));const O=this.isRootStyle();t.imports?this._loadImports(t.imports,r).then(()=>{this._reloadImports(),this.fire(new n.z(O?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new n.z(O?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const _=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(_){const b=this._evaluateColorThemeData(_);this._loadColorTheme(b).then(()=>{p()}).catch(C=>{n.w(`Couldn't load color theme from the stylesheet: ${C}`),p()})}else this._styleColorTheme.lut=null,p()}isRootStyle(){return this.importDepth===0}mergeAll(){let t,r,u,p,_,b,C,O,P,F;const V={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(U=>{if(U.stylesheet){if(U.light!=null&&(t=U.light),U.stylesheet.lights)for(const H of U.stylesheet.lights)H.type==="ambient"&&U.ambientLight!=null&&(r=U.ambientLight),H.type==="directional"&&U.directionalLight!=null&&(u=U.directionalLight);p=this._prioritizeTerrain(p,U.terrain,U.stylesheet.terrain),U.stylesheet.fog&&U.fog!=null&&(_=U.fog),U.stylesheet.snow&&U.snow!=null&&(b=U.snow),U.stylesheet.rain&&U.rain!=null&&(C=U.rain),U.stylesheet.camera!=null&&(F=U.stylesheet.camera),U.stylesheet.projection!=null&&(O=U.stylesheet.projection),U.stylesheet.transition!=null&&(P=U.stylesheet.transition),V[U.scope]=U._styleColorTheme}}),this.light=t,this.ambientLight=r,this.directionalLight=u,this.fog=_,this.snow=b,this.rain=C,this._styleColorThemeForScope=V,p===null?delete this.terrain:this.terrain=p,this.camera=F||{"camera-projection":"perspective"},this.projection=O||{name:"mercator"},this.transition=n.l({},ud,P),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(t){const r=u=>{for(const p of u.fragments)r(p.style);t(u)};r(this)}_prioritizeTerrain(t,r,u){const p=t&&t.drapeRenderMode===0;return u===null?r&&r.drapeRenderMode===0?r:p?t:null:r!=null&&(!t||p||r&&r.drapeRenderMode===1)?r:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(r=>{t=this._prioritizeTerrain(t,r.terrain,r.stylesheet.terrain)}),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle(r=>{r.stylesheet.projection!=null&&(t=r.stylesheet.projection)}),this.projection=t||{name:"mercator"}}mergeSources(){const t={},r={},u={};this.forEachFragmentStyle(p=>{for(const _ in p._sourceCaches){const b=n.aC(_,p.scope);t[b]=p._sourceCaches[_]}for(const _ in p._otherSourceCaches){const b=n.aC(_,p.scope);r[b]=p._otherSourceCaches[_]}for(const _ in p._symbolSourceCaches){const b=n.aC(_,p.scope);u[b]=p._symbolSourceCaches[_]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=r,this._mergedSymbolSourceCaches=u}mergeLayers(){const t={},r=[],u={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(_=>{for(const b of _._order){const C=_._layers[b];if(C.type==="slot"){const O=n.cq(b);if(t[O])continue;t[O]=[]}C.slot&&t[C.slot]?t[C.slot].push(C):r.push(C)}}),this._mergedOrder=[];const p=(_=[])=>{for(const b of _)if(b.type==="slot"){const C=n.cq(b.id);t[C]&&p(t[C]),this._mergedSlots.push(C)}else{const C=n.aC(b.id,b.scope);this._mergedOrder.push(C),u[C]=b,b.is3D()&&(this._has3DLayers=!0),b.type==="circle"&&(this._hasCircleLayers=!0),b.type==="symbol"&&(this._hasSymbolLayers=!0),b.type==="clip"&&(this._clipLayerPresent=!0)}};p(r),this._mergedOrder.sort((_,b)=>{const C=u[_],O=u[b];return C.hasInitialOcclusionOpacityProperties?O.is3D()?1:0:C.is3D()&&O.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=u,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=n.l({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?function(r,u,p){const _=n.l({},u);for(const C of Object.keys(n.a3.colorTheme))_[C]===void 0&&(_[C]=n.a3.colorTheme[C].default);const b=new n.a4(od,r,new Map(p));return b.setTransitionOrValue(_,p),b.untransitioned().possiblyEvaluate(new n.a8(0))}(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const r=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((u,p)=>{const _="data:image/png;base64,";if(!t||t.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void u();let b=t;b.startsWith(_)||(b=_+b);const C="mapbox-reserved-lut",O=new Image;O.src=b,O.onerror=()=>{this._styleColorTheme.lutLoading=!1,p(new Error("Failed to load image data"))},O.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==r)return void u();this._styleColorTheme.lutLoading=!1;const{width:P,height:F,data:V}=n.q.getImageData(O);if(F>32)return void p(new Error("The height of the image must be less than or equal to 32 pixels."));if(P!==F*F)return void p(new Error("The width of the image must be equal to the height squared."));this.getImage(C)&&this.removeImage(C),this.addImage(C,{data:new n.r({width:P,height:F},V),pixelRatio:1,sdf:!1,usvg:!1,version:0});const U=this.imageManager.getImage(C,this.scope);U?(this._styleColorTheme.lut={image:U.data,data:t},u()):p(new Error("Missing LUT image."))}})}getLut(t){const r=this._styleColorThemeForScope[t];return r?r.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(r,u,p){let _,b,C;const O=n.q.devicePixelRatio>1?"@2x":"";let P=n.n(u.transformRequest(u.normalizeSpriteURL(r,O,".json"),n.R.SpriteJSON),(U,H)=>{P=null,C||(C=U,_=H,V())}),F=n.o(u.transformRequest(u.normalizeSpriteURL(r,O,".png"),n.R.SpriteImage),(U,H)=>{F=null,C||(C=U,b=H,V())});function V(){if(C)p(C);else if(_&&b){const U=n.q.getImageData(b),H={};for(const J in _){const{width:$,height:te,x:ee,y:le,sdf:pe,pixelRatio:fe,stretchX:be,stretchY:me,content:ve}=_[J],_e=new n.r({width:$,height:te});n.r.copy(U,_e,{x:ee,y:le},{x:0,y:0},{width:$,height:te},null),H[J]={data:_e,pixelRatio:fe,sdf:pe,stretchX:be,stretchY:me,content:ve,usvg:!1}}p(null,H)}}return{cancel(){P&&(P.cancel(),P=null),F&&(F.cancel(),F=null)}}}(t,this.map._requestManager,(r,u)=>{if(this._spriteRequest=null,r)this.fire(new n.y(r));else if(u)for(const p in u)this.imageManager.addImage(p,this.scope,u[p]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new n.z("data",{dataType:"style"}))})}_loadIconset(t){if(!n.f(t)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(t);const r=this.map._spriteFormat==="auto";var u,p;this._spriteRequest=(p=(_,b)=>{if(this._spriteRequest=null,_)r?this._loadSprite(t):this.fire(new n.y(_));else if(b)for(const C in b)this.imageManager.addImage(C,this.scope,b[C]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new n.z("data",{dataType:"style"}))},n.bi((u=this.map._requestManager).transformRequest(u.normalizeIconsetURL(t),n.R.Iconset),(_,b)=>{if(_)return void p(_);const C={},O=n.cg(new n.bh(b));for(const P of O.icons){const F={version:1,pixelRatio:n.q.devicePixelRatio,content:cd(P),stretchX:P.metadata?qc(P.metadata.stretch_x_areas):void 0,stretchY:P.metadata?qc(P.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:P};C[P.name]=F}p(null,C)}))}_validateLayer(t){const r=this.getOwnSource(t.source);if(!r)return;const u=t.sourceLayer;u&&(r.type==="geojson"||r.vectorLayerIds&&r.vectorLayerIds.indexOf(u)===-1)&&this.fire(new n.y(new Error(`Source layer "${u}" does not exist on source "${r.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((t,r)=>{const u=this.fragments[r];return u&&u.style&&(t.data=u.style.serialize()),t})}_serializeSources(){const t={};for(const r in this._sourceCaches){const u=this._sourceCaches[r].getSource();t[u.id]||(t[u.id]=u.serialize())}return t}_serializeLayers(t){const r=[];for(const u of t){const p=this._layers[u];p&&p.type!=="custom"&&r.push(p.serialize())}return r}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(t){return t?this.order:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const r=this.getOwnLayer(t);if(r)return r;this.fire(new n.y(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const r=this.getOwnSource(t);if(r)return r;this.fire(new n.y(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(t,r){const u=this.map.painter;if(u)for(let p=t.minzoom||0;p<(t.maxzoom||25.5);p++){const _=t.getProgramIds();if(_)for(const b of _){const C=t.getDefaultProgramParams(b,r.zoom,this._styleColorTheme.lut);C&&(u.style=this,this.fog&&(u._fogVisible=!0,C.overrideFog=!0,u.getOrCreateProgram(b,C)),u._fogVisible=!1,C.overrideFog=!1,u.getOrCreateProgram(b,C),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(C.overrideRtt=!0,u.getOrCreateProgram(b,C)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const r=this.calculateLightsBrightness();t.brightness=r||0,r!==this._brightness&&(this._brightness=r,this.dispatcher.broadcast("setBrightness",r));const u=this._changes.isDirty();let p=!1;if(this._changes.isDirty()){const b=this._changes.getLayerUpdatesByScope();for(const C in b){const{updatedIds:O,removedIds:P}=b[C];(O||P)&&(this._updateWorkerLayers(C,O,P),p=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this.snow&&this.snow.updateTransitions(t),this.rain&&this.rain.updateTransitions(t),this._changes.reset()}const _={};for(const b in this._mergedSourceCaches){const C=this._mergedSourceCaches[b];_[b]=C.used,C.used=!1,C.tileCoverLift=0}for(const b of this._mergedOrder){const C=this._mergedLayers[b];if(C.recalculate(t,this._availableImages),!C.isHidden(t.zoom)){const O=this.getLayerSourceCache(C);O&&(O.used=!0,O.tileCoverLift=Math.max(O.tileCoverLift,C.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(C,t)}):this.precompilePrograms(C,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&p&&this.mergeLayers();for(const b in _){const C=this._mergedSourceCaches[b];_[b]!==C.used&&C.getSource().fire(new n.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:C.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.snow&&this.snow.recalculate(t),this.rain&&this.rain.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),u&&this.fire(new n.z("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=this._changes.getUpdatedImages();if(t.length){for(const r in this._sourceCaches)this._sourceCaches[r].reloadTilesForDependencies(["icons","patterns"],t);this._changes.resetUpdatedImages()}}_updateWorkerLayers(t,r,u){const p=this.getFragmentStyle(t);p&&this.dispatcher.broadcast("updateLayers",{layers:r?p._serializeLayers(r):[],scope:t,removedIds:u||[],options:p.options})}setState(t,r){if(this._checkLoaded(),Lo(this,ha(t)))return!1;(t=n.cp(t)).layers=Fu(t.layers);const u=function(b,C){if(!b)return[{command:Vi.setStyle,args:[C]}];let O=[];try{if(!n.bn(b.version,C.version))return[{command:Vi.setStyle,args:[C]}];if(n.bn(b.center,C.center)||O.push({command:Vi.setCenter,args:[C.center]}),n.bn(b.zoom,C.zoom)||O.push({command:Vi.setZoom,args:[C.zoom]}),n.bn(b.bearing,C.bearing)||O.push({command:Vi.setBearing,args:[C.bearing]}),n.bn(b.pitch,C.pitch)||O.push({command:Vi.setPitch,args:[C.pitch]}),n.bn(b.sprite,C.sprite)||O.push({command:Vi.setSprite,args:[C.sprite]}),n.bn(b.glyphs,C.glyphs)||O.push({command:Vi.setGlyphs,args:[C.glyphs]}),n.bn(b.imports,C.imports)||function(H=[],J=[],$){J=J||[];const te=(H=H||[]).map(Un),ee=J.map(Un),le=H.reduce(_s,{}),pe=J.reduce(_s,{}),fe=te.slice();let be,me,ve,_e;for(be=0,me=0;be<te.length;be++)ve=te[be],pe.hasOwnProperty(ve)?me++:($.push({command:Vi.removeImport,args:[ve]}),fe.splice(fe.indexOf(ve,me),1));for(be=0,me=0;be<ee.length;be++)ve=ee[ee.length-1-be],fe[fe.length-1-be]!==ve&&(le.hasOwnProperty(ve)?($.push({command:Vi.removeImport,args:[ve]}),fe.splice(fe.lastIndexOf(ve,fe.length-me),1)):me++,_e=fe[fe.length-be],$.push({command:Vi.addImport,args:[pe[ve],_e]}),fe.splice(fe.length-be,0,ve));for(const Ee of J){const ze=le[Ee.id];ze&&!n.bn(ze,Ee)&&$.push({command:Vi.updateImport,args:[Ee.id,Ee]})}}(b.imports,C.imports,O),n.bn(b.transition,C.transition)||O.push({command:Vi.setTransition,args:[C.transition]}),n.bn(b.light,C.light)||O.push({command:Vi.setLight,args:[C.light]}),n.bn(b.fog,C.fog)||O.push({command:Vi.setFog,args:[C.fog]}),n.bn(b.snow,C.snow)||O.push({command:Vi.setSnow,args:[C.snow]}),n.bn(b.rain,C.rain)||O.push({command:Vi.setRain,args:[C.rain]}),n.bn(b.projection,C.projection)||O.push({command:Vi.setProjection,args:[C.projection]}),n.bn(b.lights,C.lights)||O.push({command:Vi.setLights,args:[C.lights]}),n.bn(b.camera,C.camera)||O.push({command:Vi.setCamera,args:[C.camera]}),!n.bn(b["color-theme"],C["color-theme"]))return[{command:Vi.setStyle,args:[C]}];const P={},F=[];(function(H,J,$,te){let ee;for(ee in J=J||{},H=H||{})H.hasOwnProperty(ee)&&(J.hasOwnProperty(ee)||Fs(ee,$,te));for(ee in J){if(!J.hasOwnProperty(ee))continue;const le=J[ee];H.hasOwnProperty(ee)?n.bn(H[ee],le)||(H[ee].type==="geojson"&&le.type==="geojson"&&or(H,J,ee)?$.push({command:Vi.setGeoJSONSourceData,args:[ee,le.data]}):Qt(ee,J,$,te)):Bu(ee,J,$)}})(b.sources,C.sources,F,P);const V=[];b.layers&&b.layers.forEach(H=>{H.source&&P[H.source]?O.push({command:Vi.removeLayer,args:[H.id]}):V.push(H)});let U=b.terrain;U&&P[U.source]&&(O.push({command:Vi.setTerrain,args:[void 0]}),U=void 0),O=O.concat(F),n.bn(U,C.terrain)||O.push({command:Vi.setTerrain,args:[C.terrain]}),function(H,J,$){J=J||[];const te=(H=H||[]).map(Un),ee=J.map(Un),le=H.reduce(_s,{}),pe=J.reduce(_s,{}),fe=te.slice(),be=Object.create(null);let me,ve,_e,Ee,ze,Ye,qe;for(me=0,ve=0;me<te.length;me++)_e=te[me],pe.hasOwnProperty(_e)?ve++:($.push({command:Vi.removeLayer,args:[_e]}),fe.splice(fe.indexOf(_e,ve),1));for(me=0,ve=0;me<ee.length;me++)_e=ee[ee.length-1-me],fe[fe.length-1-me]!==_e&&(le.hasOwnProperty(_e)?($.push({command:Vi.removeLayer,args:[_e]}),fe.splice(fe.lastIndexOf(_e,fe.length-ve),1)):ve++,Ye=fe[fe.length-me],$.push({command:Vi.addLayer,args:[pe[_e],Ye]}),fe.splice(fe.length-me,0,_e),be[_e]=!0);for(me=0;me<ee.length;me++)if(_e=ee[me],Ee=le[_e],ze=pe[_e],!be[_e]&&!n.bn(Ee,ze))if(n.bn(Ee.source,ze.source)&&n.bn(Ee["source-layer"],ze["source-layer"])&&n.bn(Ee.type,ze.type)){for(qe in Hi(Ee.layout,ze.layout,$,_e,null,Vi.setLayoutProperty),Hi(Ee.paint,ze.paint,$,_e,null,Vi.setPaintProperty),n.bn(Ee.slot,ze.slot)||$.push({command:Vi.setSlot,args:[_e,ze.slot]}),n.bn(Ee.filter,ze.filter)||$.push({command:Vi.setFilter,args:[_e,ze.filter]}),n.bn(Ee.minzoom,ze.minzoom)&&n.bn(Ee.maxzoom,ze.maxzoom)||$.push({command:Vi.setLayerZoomRange,args:[_e,ze.minzoom,ze.maxzoom]}),Ee)Ee.hasOwnProperty(qe)&&qe!=="layout"&&qe!=="paint"&&qe!=="filter"&&qe!=="metadata"&&qe!=="minzoom"&&qe!=="maxzoom"&&qe!=="slot"&&(qe.indexOf("paint.")===0?Hi(Ee[qe],ze[qe],$,_e,qe.slice(6),Vi.setPaintProperty):n.bn(Ee[qe],ze[qe])||$.push({command:Vi.setLayerProperty,args:[_e,qe,ze[qe]]}));for(qe in ze)ze.hasOwnProperty(qe)&&!Ee.hasOwnProperty(qe)&&qe!=="layout"&&qe!=="paint"&&qe!=="filter"&&qe!=="metadata"&&qe!=="minzoom"&&qe!=="maxzoom"&&qe!=="slot"&&(qe.indexOf("paint.")===0?Hi(Ee[qe],ze[qe],$,_e,qe.slice(6),Vi.setPaintProperty):n.bn(Ee[qe],ze[qe])||$.push({command:Vi.setLayerProperty,args:[_e,qe,ze[qe]]}))}else $.push({command:Vi.removeLayer,args:[_e]}),Ye=fe[fe.lastIndexOf(_e)+1],$.push({command:Vi.addLayer,args:[ze,Ye]})}(V,C.layers,O)}catch(P){console.warn("Unable to compute style diff:",P),O=[{command:Vi.setStyle,args:[C]}]}return O}(this.serialize(),t).filter(b=>!(b.command in ll));if(u.length===0)return!1;const p=u.filter(b=>!(b.command in pp));if(p.length>0)throw new Error(`Unimplemented: ${p.map(b=>b.command).join(", ")}.`);const _=[];return u.forEach(b=>{_.push(this[b.command].apply(this,b.args))}),r&&Promise.all(_).then(r),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(t,r){return this.getImage(t)?this.fire(new n.y(new Error("An image with this name already exists."))):(this.imageManager.addImage(t,this.scope,r),this._afterImageUpdated(t),this)}updateImage(t,r,u=!1){this.imageManager.updateImage(t,this.scope,r),u&&this._afterImageUpdated(t)}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._afterImageUpdated(t),this):this.fire(new n.y(new Error("No image with this name exists.")))}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(t),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new n.z("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(t,r,u={}){return this._checkLoaded(),this._validate(kc,`models.${t}`,r,null,u)||(this.modelManager.addModel(t,r,this.scope),this._changes.setDirty()),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope),this):this.fire(new n.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,r,u={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!r.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(r).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(r.type)>=0&&this._validate(hs,`sources.${t}`,r,null,u))return;this.map&&this.map._collectResourceTiming&&(r.collectResourceTiming=!0);const p=$r(t,r,this.dispatcher,this);p.scope=this.scope,p.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(p.id),source:p.serialize(),sourceId:p.id}));const _=b=>{const C=(b?"symbol:":"other:")+p.id,O=n.aC(C,this.scope),P=this._sourceCaches[C]=new ms(O,p,b);(b?this._symbolSourceCaches:this._otherSourceCaches)[p.id]=P,P.onAdd(this.map)};_(!1),r.type!=="vector"&&r.type!=="geojson"||_(!0),p.onAdd&&p.onAdd(this.map),u.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const r=this.getOwnSource(t);if(!r)throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===t)return this.fire(new n.y(new Error(`Source "${t}" cannot be removed while layer "${p}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new n.y(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));const u=this.getOwnSourceCaches(t);for(const p of u){const _=n.cq(p.id);delete this._sourceCaches[_],this._changes.discardSourceCacheUpdate(p.id),p.fire(new n.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:p.getSource().id})),p.setEventedParent(null),p.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),r.setEventedParent(null),r.onRemove&&r.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,r){this._checkLoaded(),this.getOwnSource(t).setData(r),this._changes.setDirty()}getOwnSource(t){const r=this.getOwnSourceCache(t);return r&&r.getSource()}getOwnSources(){const t=[];for(const r in this._otherSourceCaches){const u=this.getOwnSourceCache(r);u&&t.push(u.getSource())}return t}areTilesLoaded(){const t=this._mergedSourceCaches;for(const r in t){const u=t[r]._tiles;for(const p in u){const _=u[p];if(_.state!=="loaded"&&_.state!=="errored")return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const r=this._getTransitionParameters();for(const p of t){if(this._validate(So,"lights",p))return;switch(p.type){case"ambient":if(this.ambientLight){const _=this.ambientLight;_.set(p),_.updateTransitions(r)}else this.ambientLight=new pi(p,At||(At=new n.a5({color:new n.a6(n.a3.properties_light_ambient.color),"color-use-theme":new n.a6({type:"string",default:"default","property-type":"data-constant"}),intensity:new n.a6(n.a3.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const _=this.directionalLight;_.set(p),_.updateTransitions(r)}else this.directionalLight=new pi(p,Dt||(Dt=new n.a5({direction:new n.ak(n.a3.properties_light_directional.direction),color:new n.a6(n.a3.properties_light_directional.color),"color-use-theme":new n.a6({type:"string",default:"default","property-type":"data-constant"}),intensity:new n.a6(n.a3.properties_light_directional.intensity),"cast-shadows":new n.a6(n.a3.properties_light_directional["cast-shadows"]),"shadow-quality":new n.a6(n.a3.properties_light_directional["shadow-quality"]),"shadow-intensity":new n.a6(n.a3.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const u=new n.a8(this.z||0,r);this.ambientLight&&this.ambientLight.recalculate(u),this.directionalLight&&this.directionalLight.recalculate(u),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,r=this.ambientLight;if(!t||!r)return;const u=U=>.2126*(U[0]<=.03928?U[0]/12.92:Math.pow((U[0]+.055)/1.055,2.4))+.7152*(U[1]<=.03928?U[1]/12.92:Math.pow((U[1]+.055)/1.055,2.4))+.0722*(U[2]<=.03928?U[2]/12.92:Math.pow((U[2]+.055)/1.055,2.4)),p=t.properties.get("color").toRenderColor(null).toArray01(),_=t.properties.get("intensity"),b=t.properties.get("direction"),C=1-n.cb(b.x,b.y,b.z)[2]/90,O=u(p)*_*C,P=r.properties.get("color").toRenderColor(null).toArray01(),F=r.properties.get("intensity"),V=u(P)*F;return Number(((O+V)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(!t)return this;if(n.cr(t)){const r=n.cs(t),u=this.fragments.find(({id:_})=>_===r);if(!u)throw new Error(`Style import '${t}' not found`);const p=n.cq(t);return u.style.getFragmentStyle(p)}{const r=this.fragments.find(({id:u})=>u===t);return r?r.style:void 0}}setFeaturesetSelectors(t){if(!t)return;const r={},u=(p,_="")=>`${p}::${_}`;this._featuresetSelectors={};for(const p in t){const _=this._featuresetSelectors[p]=[];for(const b of t[p].selectors){if(b.featureNamespace){const O=this.getOwnLayer(b.layer);if(!O){n.w(`Layer is undefined for selector: ${b.layer}`);continue}const P=u(O.source,O.sourceLayer);if(P in r&&r[P]!==b.featureNamespace){n.w(`"featureNamespace ${b.featureNamespace} of featureset ${p}'s selector is not associated to the same source, skip this selector`);continue}r[P]=b.featureNamespace}let C;if(b.properties)for(const O in b.properties){const P=n.U(b.properties[O]);P.result==="success"&&(C=C||{},C[O]=P.value)}_.push({layerId:b.layer,namespace:b.featureNamespace,properties:C,uniqueFeatureID:b._uniqueFeatureID})}}}getFeaturesetDescriptors(t){const r=this.getFragmentStyle(t);if(!r||!r.stylesheet.featuresets)return[];const u=[];for(const p in r.stylesheet.featuresets)u.push({featuresetId:p,importId:r.scope?r.scope:void 0});return u}getFeaturesetLayers(t,r){const u=this.getFragmentStyle(r),p=u.stylesheet.featuresets;if(!p||!p[t])return this.fire(new n.y(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried.`))),[];const _=[];for(const b of p[t].selectors){const C=u.getOwnLayer(b.layer);C&&_.push(C)}return _}getConfigProperty(t,r){const u=this.getFragmentStyle(t);if(!u)return null;const p=n.aC(r,u.scope),_=u.options.get(p),b=_?_.value||_.default:null;return b?b.serialize():null}setConfigProperty(t,r,u){const p=this.getFragmentStyle(t);if(!p)return;const _=p.stylesheet.indoor?ld(p.stylesheet.schema):p.stylesheet.schema;if(!_||!_[r])return;const b=n.U(u);if(b.result!=="success")return void Lo(this,b.value);const C=b.value.expression,O=n.aC(r,p.scope),P=p.options.get(O);if(!P)return;let F;const{minValue:V,maxValue:U,stepValue:H,type:J,values:$}=_[r],te=n.U(_[r].default);te.result==="success"&&(F=te.value.expression),F?(this.options.set(O,Object.assign({},P,{value:C,default:F,minValue:V,maxValue:U,stepValue:H,type:J,values:$})),this.updateConfigDependencies(r)):this.fire(new n.y(new Error(`No schema defined for the config option "${r}" in the "${t}" fragment.`)))}getConfig(t){const r=this.getFragmentStyle(t);if(!r)return null;const u=r.stylesheet.schema;if(!u)return null;const p={};for(const _ in u){const b=n.aC(_,r.scope),C=r.options.get(b),O=C?C.value||C.default:null;p[_]=O?O.serialize():null}return p}setConfig(t,r){const u=this.getFragmentStyle(t);u&&(u.updateConfig(r,u.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){const r=this.getFragmentStyle(t);return r?r.stylesheet.schema:null}setSchema(t,r){const u=this.getFragmentStyle(t);u&&(u.stylesheet.schema=r,u.updateConfig(u._config,r),this.updateConfigDependencies())}updateConfig(t,r){if(this._config=t,t||r)if(r)for(const u in r){let p,_;const b=n.U(r[u].default);if(b.result==="success"&&(p=b.value.expression),t&&t[u]!==void 0){const U=n.U(t[u]);U.result==="success"&&(_=U.value.expression)}const{minValue:C,maxValue:O,stepValue:P,type:F,values:V}=r[u];if(p){const U=n.aC(u,this.scope);this.options.set(U,{default:p,value:_,minValue:C,maxValue:O,stepValue:P,type:F,values:V})}else this.fire(new n.y(new Error(`No schema defined for config option "${u}".`)))}else this.fire(new n.y(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(t){for(const r of this._configDependentLayers){const u=this.getLayer(r);if(u){if(t&&!u.configDependencies.has(t))continue;u.possiblyEvaluateVisibility(),this._updateLayer(u)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(r=>{const u=r._styleColorTheme.colorThemeOverride?r._styleColorTheme.colorThemeOverride:r._styleColorTheme.colorTheme;if(u){const p=r._evaluateColorThemeData(u);(!r._styleColorTheme.lut&&p!==""||r._styleColorTheme.lut&&p!==r._styleColorTheme.lut.data)&&r.setColorTheme(u)}}),this._changes.setDirty()}addLayer(t,r,u={}){this._checkLoaded();const p=t.id;if(this._layers[p])return void this.fire(new n.y(new Error(`Layer with id "${p}" already exists on this map`)));let _;if(t.type==="custom"){if(Lo(this,n.ct(t)))return;_=n.cu(t,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof t.source=="object"&&(this.addSource(p,t.source),t=n.cp(t),t=n.l(t,{source:p})),this._validate(Pc,`layers.${p}`,t,{arrayIndex:-1},u))return;_=n.cu(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(_),_.setEventedParent(this,{layer:{id:p}})}_.configDependencies.size!==0&&this._configDependentLayers.add(_.fqid);let b=this._order.length;if(r){const F=this._order.indexOf(r);if(F===-1)return void this.fire(new n.y(new Error(`Layer with id "${r}" does not exist on this map.`)));_.slot===this._layers[r].slot?b=F:n.w(`Layer with id "${r}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(b,0,p),this._layerOrderChanged=!0,this._layers[p]=_;const C=this.getOwnLayerSourceCache(_),O=!!this.directionalLight&&this.directionalLight.shadowsEnabled();C&&_.canCastShadows()&&O&&(C.castsShadows=!0);const P=this._changes.getRemovedLayer(_);if(P&&_.source&&C&&_.type!=="custom"){this._changes.discardLayerRemoval(_);const F=n.aC(_.source,_.scope);P.type!==_.type?this._changes.updateSourceCache(F,"clear"):(this._changes.updateSourceCache(F,"reload"),C.pause())}this._updateLayer(_),_.onAdd&&_.onAdd(this.map),_.scope=this.scope,this.mergeLayers()}moveLayer(t,r){this._checkLoaded();const u=this._checkLayer(t);if(!u||t===r)return;const p=this._order.indexOf(t);this._order.splice(p,1);let _=this._order.length;if(r){const b=this._order.indexOf(r);if(b===-1)return void this.fire(new n.y(new Error(`Layer with id "${r}" does not exist on this map.`)));u.slot===this._layers[r].slot?_=b:n.w(`Layer with id "${r}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(_,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const r=this._checkLayer(t);if(!r)return;r.setEventedParent(null);const u=this._order.indexOf(t);this._order.splice(u,1),delete this._layers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(r.fqid),this._changes.removeLayer(r);const p=this.getOwnLayerSourceCache(r);if(p&&p.castsShadows){let _=!1;for(const b in this._layers)if(this._layers[b].source===r.source&&this._layers[b].canCastShadows()){_=!0;break}p.castsShadows=_}r.onRemove&&r.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const r in this._layers)if(this._layers[r].type===t)return!0;return!1}setLayerZoomRange(t,r,u){this._checkLoaded();const p=this._checkLayer(t);p&&(p.minzoom===r&&p.maxzoom===u||(r!=null&&(p.minzoom=r),u!=null&&(p.maxzoom=u),this._updateLayer(p)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,r){this._checkLoaded();const u=this._checkLayer(t);u&&u.slot!==r&&(u.slot=r,this._updateLayer(u))}setFilter(t,r,u={}){this._checkLoaded();const p=this._checkLayer(t);if(p&&!n.bn(p.filter,r))return r==null?(p.filter=void 0,void this._updateLayer(p)):void(this._validate(Jr,`layers.${p.id}.filter`,r,{layerType:p.type},u)||(p.filter=n.cp(r),this._updateLayer(p)))}getFilter(t){const r=this._checkLayer(t);if(r)return n.cp(r.filter)}setLayoutProperty(t,r,u,p={}){this._checkLoaded();const _=this._checkLayer(t);if(_&&!n.bn(_.getLayoutProperty(r),u)){if(u!=null&&(!p||p.validate!==!1)&&Lo(_,Lu.call(ha,{key:`layers.${t}.layout.${r}`,layerType:_.type,objectKey:r,value:u,styleSpec:n.a3,style:{glyphs:!0,sprite:!0}})))return;_.setLayoutProperty(r,u),_.configDependencies.size!==0&&this._configDependentLayers.add(_.fqid),this._updateLayer(_)}}getLayoutProperty(t,r){const u=this._checkLayer(t);if(u)return u.getLayoutProperty(r)}setPaintProperty(t,r,u,p={}){this._checkLoaded();const _=this._checkLayer(t);if(!_||n.bn(_.getPaintProperty(r),u)||u!=null&&(!p||p.validate!==!1)&&Lo(_,Ou.call(ha,{key:`layers.${t}.paint.${r}`,layerType:_.type,objectKey:r,value:u,styleSpec:n.a3})))return;const b=_.setPaintProperty(r,u);_.configDependencies.size!==0&&this._configDependentLayers.add(_.fqid),b&&this._updateLayer(_),this._changes.updatePaintProperties(_)}getPaintProperty(t,r){const u=this._checkLayer(t);if(u)return u.getPaintProperty(r)}setFeatureState(t,r){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:O,importId:P}=t.target,F=this.getFragmentStyle(P),V=F.getFeaturesetLayers(O);for(const{source:U,sourceLayer:H}of V)F.setFeatureState({id:t.id,source:U,sourceLayer:H},r)}else if("layerId"in t.target){const{layerId:O}=t.target,P=this.getLayer(O);this.setFeatureState({id:t.id,source:P.source,sourceLayer:P.sourceLayer},r)}return}const u=t.source,p=t.sourceLayer,_=this._checkSource(u);if(!_)return;const b=_.type;if(b==="geojson"&&p)return void this.fire(new n.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(b==="vector"&&!p)return void this.fire(new n.y(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new n.y(new Error("The feature id parameter must be provided.")));const C=this.getOwnSourceCaches(u);for(const O of C)O.setFeatureState(p,t.id,r)}removeFeatureState(t,r){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:O,importId:P}=t.target,F=this.getFragmentStyle(P),V=F.getFeaturesetLayers(O);for(const{source:U,sourceLayer:H}of V)F.removeFeatureState({id:t.id,source:U,sourceLayer:H},r)}else if("layerId"in t.target){const{layerId:O}=t.target,P=this.getLayer(O);this.removeFeatureState({id:t.id,source:P.source,sourceLayer:P.sourceLayer},r)}return}const u=t.source,p=this._checkSource(u);if(!p)return;const _=p.type,b=_==="vector"?t.sourceLayer:void 0;if(_==="vector"&&!b)return void this.fire(new n.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(r&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new n.y(new Error("A feature id is required to remove its specific state property.")));const C=this.getOwnSourceCaches(u);for(const O of C)O.removeFeatureState(b,t.id,r)}getFeatureState(t){if(this._checkLoaded(),"target"in t){let _;if("featuresetId"in t.target){const{featuresetId:b,importId:C}=t.target,O=this.getFragmentStyle(C),P=O.getFeaturesetLayers(b);for(const{source:F,sourceLayer:V}of P){const U=O.getFeatureState({id:t.id,source:F,sourceLayer:V});if(U&&!_)_=U;else if(!n.bn(_,U))return void this.fire(new n.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t.target){const{layerId:b}=t.target,C=this.getLayer(b);_=this.getFeatureState({id:t.id,source:C.source,sourceLayer:C.sourceLayer})}return _}const r=t.source,u=t.sourceLayer,p=this._checkSource(r);if(p){if(p.type!=="vector"||u)return t.id===void 0&&this.fire(new n.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(r)[0].getFeatureState(u,t.id);this.fire(new n.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=n.l({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return n.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),r=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return n.cv({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:r,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},u=>u!==void 0)}_updateFilteredLayers(t){for(const r of Object.values(this._mergedLayers))t(r)&&this._updateLayer(r)}_updateLayer(t){this._changes.updateLayer(t);const r=this.getLayerSourceCache(t),u=n.aC(t.source,t.scope),p=this._changes.getUpdatedSourceCaches();t.source&&!p[u]&&r&&r.getSource().type!=="raster"&&(this._changes.updateSourceCache(u,"reload"),r.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const r=C=>this._mergedLayers[C].is3D(),u=this.order,p={},_=[];for(let C=u.length-1;C>=0;C--){const O=u[C];if(r(O)){p[O]=C;for(const P of t){const F=P[O];if(F)for(const V of F)_.push(V)}}}_.sort((C,O)=>O.intersectionZ-C.intersectionZ);const b=[];for(let C=u.length-1;C>=0;C--){const O=u[C];if(r(O))for(let P=_.length-1;P>=0;P--){const F=_[P].feature;if(F.layer&&p[F.layer.id]<C)break;b.push(F),_.pop()}else for(const P of t){const F=P[O];if(F)for(const V of F)b.push(V.feature)}}return b}queryRenderedFeatures(t,r,u){let p;r&&!Array.isArray(r)&&r.filter&&(this._validate(Jr,"queryRenderedFeatures.filter",r.filter,null,r),p=n.aZ(r.filter));const _={},b=F=>{if(cl.has(F.type))return;const V=this.getOwnLayerSourceCache(F),U=_[V.id]=_[V.id]||{sourceCache:V,layers:{},has3DLayers:!1};F.is3D()&&(U.has3DLayers=!0),U.layers[F.fqid]=U.layers[F.fqid]||{styleLayer:F,targets:[]},U.layers[F.fqid].targets.push({filter:p})};if(r&&r.layers){if(!Array.isArray(r.layers))return this.fire(new n.y(new Error("parameters.layers must be an Array."))),[];for(const F of r.layers){const V=this._layers[F];if(!V)return this.fire(new n.y(new Error(`The layer '${F}' does not exist in the map's style and cannot be queried for features.`))),[];b(V)}}else for(const F in this._layers)b(this._layers[F]);const C=this._queryRenderedFeatures(t,_,u),O=this._flattenAndSortRenderedFeatures(C),P=[];for(const F of O)n.cs(F.layer.id)===this.scope&&P.push(F);return P}queryRenderedFeatureset(t,r,u){let p;r&&!Array.isArray(r)&&r.filter&&(this._validate(Jr,"queryRenderedFeatures.filter",r.filter,null,r),p=n.aZ(r.filter));const _="mock",b=[];if(r&&r.target)b.push(Object.assign({},r,{targetId:_,filter:p}));else{const F=this.getFeaturesetDescriptors();for(const V of F)b.push({targetId:_,filter:p,target:V});for(const{style:V}of this.fragments){const U=V.getFeaturesetDescriptors();for(const H of U)b.push({targetId:_,filter:p,target:H})}}const C=this.queryRenderedTargets(t,b,u),O=[],P=new Set;for(const F of C)for(const V of F.variants[_])Eo(V,F,P)||O.push(new n.cw(F,V));return O}queryRenderedTargets(t,r,u){const p={},_=(C,O,P,F)=>{const V=p[O.id]=p[O.id]||{sourceCache:O,layers:{},has3DLayers:!1};if(V.layers[C.fqid]=V.layers[C.fqid]||{styleLayer:C,targets:[]},C.is3D()&&(V.has3DLayers=!0),!F)return P.uniqueFeatureID=!1,void V.layers[C.fqid].targets.push(P);V.layers[C.fqid].targets.push(Object.assign({},P,{namespace:F.namespace,properties:F.properties,uniqueFeatureID:F.uniqueFeatureID}))};for(const C of r)if("featuresetId"in C.target){const{featuresetId:O,importId:P}=C.target,F=this.getFragmentStyle(P);if(!F||!F._featuresetSelectors)continue;const V=F._featuresetSelectors[O];if(!V){this.fire(new n.y(new Error(`The featureset '${O}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const U of V){const H=F.getOwnLayer(U.layerId);H&&!cl.has(H.type)&&_(H,F.getOwnLayerSourceCache(H),C,U)}}else if("layerId"in C.target){const{layerId:O}=C.target,P=this.getLayer(O);if(!P||cl.has(P.type))continue;_(P,this.getLayerSourceCache(P),C)}const b=this._queryRenderedFeatures(t,p,u);return this._flattenAndSortRenderedFeatures(b)}_queryRenderedFeatures(t,r,u){const p=[],_=!!this.map._showQueryGeometry,b=si.createFromScreenPoints(t,u);for(const C in r){const O=tl(b,r[C],this._availableImages,u,_);Object.keys(O).length&&p.push(O)}if(this.placement)for(const C in r){if(!r[C].sourceCache._onlySymbols)continue;const O=Uh(b.screenGeometry,r[C],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData);Object.keys(O).length&&p.push(O)}return p}querySourceFeatures(t,r){const u=r&&r.filter;u&&this._validate(Jr,"querySourceFeatures.filter",u,null,r);let p=[];const _=this.getOwnSourceCaches(t);for(const b of _)p=p.concat(Pu(b,r));return p}addSourceType(t,r,u){return ta.getSourceType(t)?u(new Error(`A source type called "${t}" already exists.`)):(ta.setSourceType(t,r),r.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:r.workerSourceURL},u):u(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,r,u={}){this._checkLoaded();const p=this.light.getLight();let _=!1;for(const C in t)if(!n.bn(t[C],p[C])){_=!0;break}if(!_)return;const b=this._getTransitionParameters();this.light.setLight(t,r,u),this.light.updateTransitions(b)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=n.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&n.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,r=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),r===0&&delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let u=t;const p=t.source==null;if(r===1){if(this.disableElevatedTerrain)return;if(typeof u.source=="object"){const C="terrain-dem-src";this.addSource(C,u.source),u=n.cp(u),u=n.l(u,{source:C})}const _=n.l({},u),b={};if(this.terrain&&p){_.source=this.terrain.get().source;const C=this.terrain?this.getFragmentStyle(this.terrain.scope):null;C&&(b.style=C.serialize())}if(this._validate(ao,"terrain",_,b))return}if(!this.terrain||this.terrain.scope!==this.scope&&!p||this.terrain&&r!==this.terrain.drapeRenderMode){if(!u)return;this._createTerrain(u,r),this.fire(new n.z("data",{dataType:"style"}))}else{const _=this.terrain,b=_.get();for(const C of Object.keys(n.a3.terrain))!u.hasOwnProperty(C)&&n.a3.terrain[C].default&&(u[C]=n.a3.terrain[C].default);for(const C in t)if(!n.bn(t[C],b[C])){_.set(t,this.options),this.stylesheet.terrain=t;const O=this._getTransitionParameters({duration:0});_.updateTransitions(O),this.fire(new n.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const r=this.fog=new He(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=r.get();const u=this._getTransitionParameters({duration:0});r.updateTransitions(u)}_createSnow(t){const r=this.snow=new Jt(t,this.map.transform,this.scope,this.options);this.stylesheet.snow=r.get();const u=this._getTransitionParameters({duration:0});r.updateTransitions(u)}_createRain(t){const r=this.rain=new fi(t,this.map.transform,this.scope,this.options);this.stylesheet.rain=r.get();const u=this._getTransitionParameters({duration:0});r.updateTransitions(u)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const r=this.fog;if(!n.bn(r.get(),t)){r.set(t,this.options),this.stylesheet.fog=r.get();const u=this._getTransitionParameters({duration:0});r.updateTransitions(u)}}else this._createFog(t);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(t){if(this._checkLoaded(),!t)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const r=this.snow;if(!n.bn(r.get(),t)){r.set(t,this.options),this.stylesheet.snow=r.get();const u=this._getTransitionParameters({duration:0});r.updateTransitions(u)}}else this._createSnow(t);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(t){if(this._checkLoaded(),!t)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const r=this.rain;if(!n.bn(r.get(),t)){r.set(t,this.options),this.stylesheet.rain=r.get();const u=this._getTransitionParameters({duration:0});r.updateTransitions(u)}}else this._createRain(t);this._markersNeedUpdate=!0}_reloadColorTheme(){const t=()=>{for(const p in this._layers)this._layers[p].lut=this._styleColorTheme.lut;for(const p in this._sourceCaches)this._sourceCaches[p].clearTiles()},r=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!r)return this._styleColorTheme.lut=null,void t();const u=this._evaluateColorThemeData(r);this._loadColorTheme(u).then(()=>{this.fire(new n.z("colorthemeset")),t()}).catch(p=>{n.w(`Couldn't set color theme: ${p}`)})}setColorTheme(t){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&n.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=t,this._reloadColorTheme()}setImportColorTheme(t,r){const u=this.getFragmentStyle(t);u&&(u._styleColorTheme.colorThemeOverride=r,u._reloadColorTheme())}_getTransitionParameters(t){return{now:n.q.now(),transition:n.l(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],r=[];for(const u of this._mergedOrder)this.isLayerDraped(this._mergedLayers[u])?t.push(u):r.push(u);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...r)}_createTerrain(t,r){const u=this.terrain=new ie(t,r,this.scope,this.options);r===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const p=this._getTransitionParameters({duration:0});u.updateTransitions(p)}_force3DLayerUpdate(){for(const t in this._layers){const r=this._layers[t];r.type==="fill-extrusion"&&this._updateLayer(r)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const r=this._layers[t];r.type==="symbol"&&this._updateLayer(r)}}_validate(t,r,u,p,_={}){if(_&&_.validate===!1)return!1;const b=n.l({},this.serialize());return Lo(this,t.call(ha,n.l({key:r,style:b,value:u,styleSpec:n.a3},p)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),n.cx.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(t){const r=this.getSourceCaches(t);for(const u of r)u.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}reloadSource(t){const r=this.getSourceCaches(t);for(const u of r)u.resume(),u.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(t=>{t.modelManager.reloadModels(t.scope)})}updateSources(t){let r;this.directionalLight&&(r=sl(this.directionalLight));for(const u in this._mergedSourceCaches)this._mergedSourceCaches[u].update(t,void 0,void 0,r)}_generateCollisionBoxes(){for(const t in this._sourceCaches){const r=this._sourceCaches[t];r.resume(),r.reload()}}_updatePlacement(t,r,u,p,_,b,C=!1){let O=!1,P=!1;const F={},V={};for(const U of this._mergedOrder){const H=this._mergedLayers[U];if(H.type!=="symbol")continue;const J=n.aC(H.source,H.scope);let $=F[J];if(!$){const ee=this.getLayerSourceCache(H);if(!ee)continue;const le=ee.getRenderableIds(!0).map(pe=>ee.getTileByID(pe));V[J]=le.slice(),$=F[J]=le.sort((pe,fe)=>fe.tileID.overscaledZ-pe.tileID.overscaledZ||(pe.tileID.isLessThan(fe.tileID)?-1:1))}const te=this.crossTileSymbolIndex.addLayer(H,$,r.center.lng,r.projection);O=O||te}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),C=C||this._layerOrderChanged||p===0,this._layerOrderChanged&&this.fire(new n.z("neworder")),(C||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(n.q.now(),r.zoom))&&(this.pauseablePlacement=new Fm(r,this._mergedOrder,C,u,p,_,this.placement,this.fog&&r.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,F,V,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(n.q.now()),P=!0),O&&this.pauseablePlacement.placement.setStale()),P||O){this._buildingIndex.onNewFrame(r.zoom);for(let U=0;U<this._mergedOrder.length;U++){const H=this._mergedLayers[this._mergedOrder[U]];if(H.type!=="symbol")continue;const J=this.isLayerClipped(H);this.placement.updateLayerOpacities(H,F[n.aC(H.source,H.scope)],U,J?b:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(n.q.now())}}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t,r){this._checkLoaded();const u=this.stylesheet.imports=this.stylesheet.imports||[];if(u.findIndex(({id:_})=>_===t.id)!==-1)return void this.fire(new n.y(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!r)return u.push(t),this._loadImports([t],!0);const p=u.findIndex(({id:_})=>_===r);return p===-1&&this.fire(new n.y(new Error(`Import with id "${r}" does not exist on this map.`))),this.stylesheet.imports=u.slice(0,p).concat(t).concat(u.slice(p)),this._loadImports([t],!0,r)}updateImport(t,r){this._checkLoaded();const u=this.stylesheet.imports||[],p=this.getImportIndex(t);return p===-1?this:typeof r=="string"?(this.setImportUrl(t,r),this):(r.url&&r.url!==u[p].url&&this.setImportUrl(t,r.url),n.bn(r.config,u[p].config)||this.setImportConfig(t,r.config,r.data.schema),n.bn(r.data,u[p].data)||this.setImportData(t,r.data),this)}moveImport(t,r){this._checkLoaded();let u=this.stylesheet.imports||[];const p=this.getImportIndex(t);if(p===-1)return this;const _=this.getImportIndex(r);if(_===-1)return this;const b=u[p],C=this.fragments[p];return u=u.filter(({id:O})=>O!==t),this.fragments=this.fragments.filter(({id:O})=>O!==t),this.stylesheet.imports=u.slice(0,_).concat(b).concat(u.slice(_)),this.fragments=this.fragments.slice(0,_).concat(C).concat(this.fragments.slice(_)),this.mergeLayers(),this}setImportUrl(t,r){this._checkLoaded();const u=this.stylesheet.imports||[],p=this.getImportIndex(t);if(p===-1)return this;u[p].url=r;const _=this.fragments[p];return _.style=this._createFragmentStyle(u[p]),_.style.on("style.import.load",()=>this.mergeAll()),_.style.loadURL(r),this}setImportData(t,r){this._checkLoaded();const u=this.getImportIndex(t),p=this.stylesheet.imports||[];return u===-1?this:r?(this.fragments[u].style.setState(r),this._reloadImports(),this):(delete p[u].data,this.setImportUrl(t,p[u].url))}setImportConfig(t,r,u){this._checkLoaded();const p=this.getImportIndex(t),_=this.stylesheet.imports||[];if(p===-1)return this;r?_[p].config=r:delete _[p].config;const b=this.fragments[p];u&&b.style.stylesheet&&(b.style.stylesheet.schema=u);const C=b.style.stylesheet&&b.style.stylesheet.schema;return b.config=r,b.style.updateConfig(r,C),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const r=this.stylesheet.imports||[],u=this.getImportIndex(t);u!==-1&&(r.splice(u,1),this.fragments[u].style._remove(),this.fragments.splice(u,1),this._reloadImports())}getImportIndex(t){const r=(this.stylesheet.imports||[]).findIndex(u=>u.id===t);return r===-1&&this.fire(new n.y(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),r}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const r in this._mergedOtherSourceCaches){const u=this._mergedOtherSourceCaches[r];u&&t.push(u.getSource())}return t}getSource(t,r){const u=this.getSourceCache(t,r);return u&&u.getSource()}getLayerSource(t){const r=this.getLayerSourceCache(t);return r&&r.getSource()}getSourceCache(t,r){const u=n.aC(t,r);return this._mergedOtherSourceCaches[u]}getLayerSourceCache(t){const r=n.aC(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[r]:this._mergedOtherSourceCaches[r]}getSourceCaches(t){if(t==null)return Object.values(this._mergedSourceCaches);const r=[];return this._mergedOtherSourceCaches[t]&&r.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&r.push(this._mergedSymbolSourceCaches[t]),r}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const r in t){const u=t[r];u==="reload"?this.reloadSource(r):u==="clear"&&this.clearSource(r)}}updateLayers(t){const r=this._changes.getUpdatedPaintProperties();for(const u of r){const p=this.getLayer(u);p&&p.updateTransitions(t)}}getImages(t,r,u){this.imageManager.getImages(r.icons,r.scope,u),this._updateTilesForChangedImages();const p=_=>{_&&_.setDependencies(r.tileID.key,r.type,r.icons)};p(this._otherSourceCaches[r.source]),p(this._symbolSourceCaches[r.source])}rasterizeImages(t,r,u){this.imageManager.rasterizeImages(r,u)}getGlyphs(t,r,u){this.glyphManager.getGlyphs(r.stacks,r.scope,u)}getResource(t,r,u){return n.cy(r,u)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const r=[];return this._otherSourceCaches[t]&&r.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&r.push(this._symbolSourceCaches[t]),r}_isSourceCacheLoaded(t){const r=this.getOwnSourceCaches(t);return r.length===0?(this.fire(new n.y(new Error(`There is no source with ID '${t}'`))),!1):r.every(u=>u.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,r){if(!this._clipLayerPresent&&t.type!=="fill-extrusion")return!1;const u=t.type==="fill-extrusion"&&t.sourceLayer==="building";if(t.is3D()){if(u||r&&r.type==="batched-model"||t.type==="model")return!0}else if(t.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(t=>{t.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}ta.getSourceType=function(c){return Gr[c]},ta.setSourceType=function(c,t){Gr[c]=t},ta.registerForPluginStateChange=n.ch;var Wu=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Gc=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,$u=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,ul="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Qh=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,hd=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,hl=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Ql=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Hc=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Ca=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,ia=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef TEXTURE_GATHER
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz/=light_view_pos0.w;vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const xs=[];pl(Wu,xs),pl($u,xs),pl(Gc,xs);const fl={"_prelude_fog.vertex.glsl":hd,"_prelude_terrain.vertex.glsl":Qh,"_prelude_shadow.vertex.glsl":Ca,"_prelude_fog.fragment.glsl":hl,"_prelude_shadow.fragment.glsl":ia,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Ql,"_prelude_raster_particle.glsl":Hc},dl={};Wi("",Qh),Wi(hl,hd),Wi(ia,Ca),Wi(Ql,""),Wi(Hc,"");const Kl=Wi(Gc,$u),Jl=Wu;var Qa={background:Wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Wi("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Wi(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Wi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Wi("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Wi("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Wi("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:Wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Wi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Wi(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Wi(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Wi(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:Wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:Wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Wi("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Wi("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Wi(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Wi(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+(u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#else
z+=u_pitch_with_map ? (u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#endif
}`),terrainRaster:Wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Wi("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Wi(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,ul),skyboxGradient:Wi(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,ul),skyboxCapture:Wi(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Wi(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Wi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Wi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Wi(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:Wi("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:Wi("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:Wi("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Wi("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function pl(c,t){const r=c.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let u of r)if(u=u.trim(),u[0]==="#"&&u.includes("if")&&!u.includes("endif")){u=u.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const p=u.split(" ");for(const _ of p)t.includes(_)||t.push(_)}}function Wi(c,t){const r=/#include\s+"([^"]+)"/g,u=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let p=t.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);p&&(p=p.map(P=>{const F=P.split(" ");return F[F.length-1]}),p=[...new Set(p)]);const _={},b=[],C=[];if(c=c.replace(r,(P,F)=>(C.push(F),"")),(t=t.replace(r,(P,F)=>(b.push(F),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let O=[...xs];pl(c,O),pl(t,O);for(const P of[...b,...C])fl[P]||console.error(`Undefined include: ${P}`),dl[P]||(dl[P]=[],pl(fl[P],dl[P])),O=[...O,...dl[P]];return{fragmentSource:c=c.replace(u,(P,F,V,U,H)=>(_[H]=!0,F==="define"?`
#ifndef HAS_UNIFORM_u_${H}
in ${V} ${U} ${H};
#else
uniform ${V} ${U} u_${H};
#endif
`:F==="initialize"?`
#ifdef HAS_UNIFORM_u_${H}
    ${V} ${U} ${H} = u_${H};
#endif
`:F==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${H}
    in ${V} ${U} ${H};
#endif
`:F==="initialize-attribute"?"":void 0)),vertexSource:t=t.replace(u,(P,F,V,U,H)=>{const J=U==="float"?"vec2":U,$=H.match(/color/)?"color":J;return F==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${H}
in ${V} ${U} a_${H};
#endif
`:_[H]?F==="define"?`
#ifndef HAS_UNIFORM_u_${H}
uniform lowp float u_${H}_t;
in ${V} ${J} a_${H};
out ${V} ${U} ${H};
#else
uniform ${V} ${U} u_${H};
#endif
`:F==="initialize"?$==="vec4"?`
#ifndef HAS_UNIFORM_u_${H}
    ${H} = a_${H};
#else
    ${V} ${U} ${H} = u_${H};
#endif
`:`
#ifndef HAS_UNIFORM_u_${H}
    ${H} = unpack_mix_${$}(a_${H}, u_${H}_t);
#else
    ${V} ${U} ${H} = u_${H};
#endif
`:F==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${H}
    in ${V} ${U} a_${H};
    out ${V} ${U} ${H};
#endif
`:F==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${H}
    ${H} = a_${H};
#endif
`:void 0:F==="define"?`
#ifndef HAS_UNIFORM_u_${H}
uniform lowp float u_${H}_t;
in ${V} ${J} a_${H};
#else
uniform ${V} ${U} u_${H};
#endif
`:F==="define-instanced"?$==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${H}0;
in vec4 a_${H}1;
in vec4 a_${H}2;
in vec4 a_${H}3;
#else
uniform ${V} ${U} u_${H};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${V} ${J} a_${H};
#else
uniform ${V} ${U} u_${H};
#endif
`:F==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${H}
    ${V} ${U} ${H} = a_${H};
#endif
`:$==="vec4"?`
#ifndef HAS_UNIFORM_u_${H}
    ${V} ${U} ${H} = a_${H};
#else
    ${V} ${U} ${H} = u_${H};
#endif
`:`
#ifndef HAS_UNIFORM_u_${H}
    ${V} ${U} ${H} = unpack_mix_${$}(a_${H}, u_${H}_t);
#else
    ${V} ${U} ${H} = u_${H};
#endif
`}),staticAttributes:p,usedDefines:O,vertexIncludes:b,fragmentIncludes:C}}class ec{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,r,u,p,_,b,C,O){this.context=t;let P=this.boundPaintVertexBuffers.length!==p.length;for(let V=0;!P&&V<p.length;V++)this.boundPaintVertexBuffers[V]!==p[V]&&(P=!0);let F=this.boundDynamicVertexBuffers.length!==C.length;for(let V=0;!F&&V<C.length;V++)this.boundDynamicVertexBuffers[V]!==C[V]&&(F=!0);if(!this.vao||this.boundProgram!==r||this.boundLayoutVertexBuffer!==u||P||F||this.boundIndexBuffer!==_||this.boundVertexOffset!==b)this.freshBind(r,u,p,_,b,C,O);else{t.bindVertexArrayOES.set(this.vao);for(const V of C)V&&(V.bind(),O&&V.instanceCount&&V.setVertexAttribDivisor(t.gl,r,O));_&&_.dynamicDraw&&_.bind()}}freshBind(t,r,u,p,_,b,C){const O=t.numAttributes,P=this.context,F=P.gl;this.vao&&this.destroy(),this.vao=P.gl.createVertexArray(),P.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=r,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=p,this.boundVertexOffset=_,this.boundDynamicVertexBuffers=b,r.enableAttributes(F,t),r.bind(),r.setVertexAttribPointers(F,t,_);for(const V of u)V.enableAttributes(F,t),V.bind(),V.setVertexAttribPointers(F,t,_);for(const V of b)V&&(V.enableAttributes(F,t),V.bind(),V.setVertexAttribPointers(F,t,_),C&&V.instanceCount&&V.setVertexAttribDivisor(F,t,C));p&&p.bind(),P.currentNumAttributes=O}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function tc(c,t){const r=Math.pow(2,t.canonical.z),u=t.canonical.y;return[new n.aa(0,u/r).toLngLat().lat,new n.aa(0,(u+1)/r).toLngLat().lat]}function Ka(c,t,r,u,p,_,b){const C=c.context,O=C.gl,P=r.hillshadeFBO;if(!P)return;c.prepareDrawTile();const F=c.isTileAffectedByFog(t),V=c.getOrCreateProgram("hillshade",{overrideFog:F});C.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,P.colorAttachment.get());const U=((te,ee,le,pe)=>{const fe=le.paint.get("hillshade-shadow-color"),be=le.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",me=le.paint.get("hillshade-highlight-color"),ve=le.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",_e=le.paint.get("hillshade-accent-color"),Ee=le.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",ze=le.paint.get("hillshade-emissive-strength");let Ye=n.ai(le.paint.get("hillshade-illumination-direction"));if(le.paint.get("hillshade-illumination-anchor")==="viewport")Ye-=te.transform.angle;else if(te.style&&te.style.enable3dLights()&&te.style.directionalLight){const lt=te.style.directionalLight.properties.get("direction"),it=n.cb(lt.x,lt.y,lt.z);Ye=n.ai(it[1])}const qe=!te.options.moving;return{u_matrix:pe||te.transform.calculateProjMatrix(ee.tileID.toUnwrapped(),qe),u_image:0,u_latrange:tc(0,ee.tileID),u_light:[le.paint.get("hillshade-exaggeration"),Ye],u_shadow:fe.toRenderColor(be?null:le.lut),u_highlight:me.toRenderColor(ve?null:le.lut),u_emissive_strength:ze,u_accent:_e.toRenderColor(Ee?null:le.lut)}})(c,r,u,c.terrain?t.projMatrix:null);c.uploadCommonUniforms(C,V,t.toUnwrapped());const{tileBoundsBuffer:H,tileBoundsIndexBuffer:J,tileBoundsSegments:$}=c.getTileBoundsBuffers(r);V.draw(c,O.TRIANGLES,p,_,b,yi.disabled,U,u.id,H,J,$)}function ic(c,t,r){if(!t.needsDEMTextureUpload)return;const u=c.context,p=u.gl;u.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||c.getTileTexture(r.stride);const _=r.getPixels();t.demTexture?t.demTexture.update(_,{premultiply:!1}):t.demTexture=new n.T(u,_,p.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function Zc(c,t,r){const u=c.context,p=u.gl;if(!t.dem)return;const _=t.dem;if(u.activeTexture.set(p.TEXTURE1),ic(c,t,_),!t.demTexture)return;t.demTexture.bind(p.NEAREST,p.CLAMP_TO_EDGE);const b=_.dim;u.activeTexture.set(p.TEXTURE0);let C=t.hillshadeFBO;if(!C){const U=new n.T(u,{width:b,height:b,data:null},p.RGBA8);U.bind(p.LINEAR,p.CLAMP_TO_EDGE),C=t.hillshadeFBO=u.createFramebuffer(b,b,!0,"renderbuffer"),C.colorAttachment.set(U.texture)}u.bindFramebuffer.set(C.framebuffer),u.viewport.set([0,0,b,b]);const{tileBoundsBuffer:O,tileBoundsIndexBuffer:P,tileBoundsSegments:F}=c.getMercatorTileBoundsBuffers(),V=[];c.linearFloatFilteringSupported()&&V.push("TERRAIN_DEM_FLOAT_FORMAT"),c.getOrCreateProgram("hillshadePrepare",{defines:V}).draw(c,p.TRIANGLES,ci.disabled,vi.disabled,Ui.unblended,yi.disabled,((U,H)=>{const J=H.stride,$=n.ab.mat4.create();return n.ab.mat4.ortho($,0,n.ag,-n.ag,0,0,1),n.ab.mat4.translate($,$,[0,-n.ag,0]),{u_matrix:$,u_image:1,u_dimension:[J,J],u_zoom:U.overscaledZ}})(t.tileID,_),r.id,O,P,F),t.needsHillshadePrepare=!1}class Er{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Xc extends Er{getDefault(){return n.aj.transparent}set(t){const r=this.current;(t.r!==r.r||t.g!==r.g||t.b!==r.b||t.a!==r.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Ba extends Er{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Na extends Er{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Po extends Er{getDefault(){return[!0,!0,!0,!0]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class oo extends Er{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class lo extends Er{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class rc extends Er{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const r=this.current;(t.func!==r.func||t.ref!==r.ref||t.mask!==r.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Yc extends Er{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class nc extends Er{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),this.current=t,this.dirty=!1}}class Kh extends Er{getDefault(){return[0,1]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Zr extends Er{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),this.current=t,this.dirty=!1}}class Zn extends Er{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Mr extends Er{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.BLEND):r.disable(r.BLEND),this.current=t,this.dirty=!1}}class Va extends Er{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class bs extends Er{getDefault(){return n.aj.transparent}set(t){const r=this.current;(t.r!==r.r||t.g!==r.g||t.b!==r.b||t.a!==r.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Qu extends Er{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class co extends Er{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),this.current=t,this.dirty=!1}}class Jh extends Er{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class ef extends Er{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let ml=class extends Er{getDefault(){return null}set(c){(c!==this.current||this.dirty)&&(this.gl.useProgram(c),this.current=c,this.dirty=!1)}};class Wc extends Er{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class $c extends Er{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class uo extends Er{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindFramebuffer(r.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class mp extends Er{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindRenderbuffer(r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class fd extends Er{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindTexture(r.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class _p extends Er{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindBuffer(r.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class tf extends Er{getDefault(){return null}set(t){const r=this.gl;r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class gp extends Er{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class Ku extends Er{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class rf extends Er{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class _l extends Er{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class gl extends Er{constructor(t,r){super(t),this.context=t,this.parent=r}getDefault(){return null}}class ko extends gl{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class ac extends gl{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,this.attachment(),r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Ju extends gl{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,this.attachment(),r.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class dd extends ac{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const nf=(c,t,r)=>({u_matrix:c,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:r}),Ua=(c,t,r,u,p,_,b,C,O,P,F,V,U,H,J,$)=>({u_proj_matrix:Float32Array.from(c),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(u),u_merc_matrix:r,u_zoom_transition:p,u_merc_center:_,u_image0:0,u_frustum_tl:b,u_frustum_tr:C,u_frustum_br:O,u_frustum_bl:P,u_globe_pos:F,u_globe_radius:V,u_viewport:U,u_grid_matrix:$?Float32Array.from($):new Float32Array(9),u_skirt_height:H,u_far_z_cutoff:J});function af(c,t){return c!=null&&t!=null&&!(!c.hasData()||!t.hasData())&&c.demTexture!=null&&t.demTexture!=null&&c.tileID.key!==t.tileID.key}const ra=new class{constructor(){this.operations={}}newMorphing(c,t,r,u,p){if(c in this.operations){const _=this.operations[c];_.to.tileID.key!==r.tileID.key&&(_.queued=r)}else this.operations[c]={startTime:u,phase:0,duration:p,from:t,to:r,queued:null}}getMorphValuesForProxy(c){if(!(c in this.operations))return null;const t=this.operations[c];return{from:t.from,to:t.to,phase:t.phase}}update(c){for(const t in this.operations){const r=this.operations[t];for(r.phase=(c-r.startTime)/r.duration;r.phase>=1||!this._validOp(r);)if(!this._nextOp(r,c)){delete this.operations[t];break}}}_nextOp(c,t){return!!c.queued&&(c.from=c.to,c.to=c.queued,c.queued=null,c.phase=0,c.startTime=t,!0)}_validOp(c){return c.from.hasData()&&c.to.hasData()}},sc={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Qc(c,t,r){if(t===0)return 0;const u=t<1&&r===514?.25/t:1;return 6*Math.pow(1.5,22-c)*Math.max(t,1)*u}function sf(c,t){const r=1<<c.z;return!t&&(c.x===0||c.x===r-1)||c.y===0||c.y===r-1}const Kc=c=>({u_matrix:c});function ga(c,t,r,u,p){if(p>0){const _=n.q.now(),b=(_-c.timeAdded)/p,C=t?(_-t.timeAdded)/p:-1,O=r.getSource(),P=u.coveringZoomLevel({tileSize:O.tileSize,roundZoom:O.roundZoom}),F=!t||Math.abs(t.tileID.overscaledZ-P)>Math.abs(c.tileID.overscaledZ-P),V=F&&c.refreshedUponExpiration?1:n.aw(F?b:1-C,0,1);return c.refreshedUponExpiration&&b>=1&&(c.refreshedUponExpiration=!1),t?{opacity:1,mix:1-V}:{opacity:V,mix:0}}return{opacity:1,mix:0}}class ws extends ms{constructor(t){const r={type:"raster-dem",maxzoom:t.transform.maxZoom},u=new n.D(n.ci(),null),p=$r("mock-dem",r,u,t.style);super("mock-dem",p,!1),p.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,r){t.state="loaded",r(null)}}class yl extends ms{constructor(t){const r=$r("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new n.D(n.ci(),null),t.style);super("proxy",r,!1),r.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,r,u){if(t.freezeTileCoverage)return;this.transform=t;const p=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((_,b)=>{if(_[b.key]="",!this._tiles[b.key]){const C=new Ao(b,this._source.tileSize*b.overscaleFactor(),t.tileZoom);C.state="loaded",this._tiles[b.key]=C}return _},{});for(const _ in this._tiles)_ in p||(this.freeFBO(_),this._tiles[_].unloadVectorData(),delete this._tiles[_])}freeFBO(t){const r=this.proxyCachedFBO[t];if(r!==void 0){const u=Object.values(r);this.renderCachePool.push(...u),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class of extends n.aG{constructor(t,r,u){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=r,this.projMatrix=u}}class Ja extends n.cJ{constructor(t,r){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[u,p,_]=function(O){const P=new n.b4,F=new n.aU,V=131;P.reserve(17161),F.reserve(33800);const U=n.ag/128,H=n.ag+U/2,J=H+U;for(let te=-U;te<J;te+=U)for(let ee=-U;ee<J;ee+=U){const le=ee<0||ee>H||te<0||te>H?24575:0,pe=n.aw(Math.round(ee),0,n.ag),fe=n.aw(Math.round(te),0,n.ag);P.emplaceBack(pe+le,fe)}const $=(te,ee)=>{const le=ee*V+te;F.emplaceBack(le+1,le,le+V),F.emplaceBack(le+V,le+V+1,le+1)};for(let te=1;te<129;te++)for(let ee=1;ee<129;ee++)$(ee,te);return[0,129].forEach(te=>{for(let ee=0;ee<130;ee++)$(ee,te),$(te,ee)}),[P,F,32768]}(),b=t.context;this.gridBuffer=b.createVertexBuffer(u,n.b6.members),this.gridIndexBuffer=b.createIndexBuffer(p),this.gridSegments=n.b7.simpleSegment(0,0,u.length,p.length),this.gridNoSkirtSegments=n.b7.simpleSegment(0,0,u.length,_),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new yl(r.map),this.orthoMatrix=n.ab.mat4.create(),n.ab.mat4.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,n.ag,0,n.ag,0,1);const C=b.gl;this._overlapStencilMode=new vi({func:C.GEQUAL,mask:255},0,255,C.KEEP,C.KEEP,C.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=r,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new ws(r.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,r,u){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const p=t.terrain.properties,_=t.terrain.drapeRenderMode===0,b=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=n.q.now();const C=t.terrain&&t.terrain.scope,O=p.get("source"),P=_?this._mockSourceCache:t.getSourceCache(O,C);if(!P)return void n.w(`Couldn't find terrain source "${O}".`);if(this.sourceCache=P,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=b?this.calculateExaggeration(r):p.get("exaggeration"),!r.projection.requiresDraping&&b&&this._exaggeration===0)return void this._disable();this.enabled=!0;const F=()=>{this.sourceCache.used&&n.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const V=this.getScaledDemTileSize();this.sourceCache.update(r,V,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,F(),this._initializing=!0),F(),r.updateElevation(!0,u),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(r),this._emptyDEMTextureDirty=!0,this._previousZoom=r.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);const r=this._previousCameraAltitude,u=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=u;const p=r!=null?u-r:Number.MAX_VALUE;if(Math.abs(p)<2)return this._exaggeration;const _=t.zoom,b=this._style.terrain;if(!this._previousUpdateTimestamp)return b.getExaggeration(_);let C=_-this._previousZoom;const O=this._previousUpdateTimestamp;let P=_;this._evaluationZoom!=null&&(P=this._evaluationZoom,Math.abs(_-P)>.5&&(C=.5*(_-P+C)),C*p<0&&(P+=C)),this._evaluationZoom=P;const F=b.getExaggeration(P),V=F===b.getExaggeration(Math.max(0,P-.1));if(V&&Math.abs(F-this._exaggeration)<.01)return F;let U=Math.min(.1,.00375*(this._updateTimestamp-O));return(V||F<.1||Math.abs(C)<1e-4)&&(U=Math.min(.2,4*U)),n.af(this._exaggeration,F,U)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.coord&&t.dataType==="source"?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const r=this.proxySourceCache,u=this.painter.transform;this._initializing&&(this._initializing=u._centerAltitude===0&&this.getAtPointOrZero(n.aa.fromLngLat(u.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const p=this.proxyCoords=r.getIds().map(O=>{const P=r.getTileByID(O).tileID;return P.projMatrix=u.calculateProjMatrix(P.toUnwrapped()),P});(function(O,P){const F=P.transform.pointCoordinate(P.transform.getCameraPoint()),V=new n.P(F.x,F.y);O.sort((U,H)=>{if(H.overscaledZ-U.overscaledZ)return H.overscaledZ-U.overscaledZ;const J=new n.P(U.canonical.x+(1<<U.canonical.z)*U.wrap,U.canonical.y),$=new n.P(H.canonical.x+(1<<H.canonical.z)*H.wrap,H.canonical.y),te=V.mult(1<<U.canonical.z);return te.x-=.5,te.y-=.5,te.distSqr(J)-te.distSqr($)})})(p,this.painter);const _=this.proxyToSource||{};this.proxyToSource={},p.forEach(O=>{this.proxyToSource[O.key]={}}),this.terrainTileForTile={};const b=this._style._mergedSourceCaches;for(const O in b){const P=b[O];if(!P.used||(P!==this.sourceCache&&this.resetTileLookupCache(P.id),this._setupProxiedCoordsForOrtho(P,t[O],_),P.usedForTerrain))continue;const F=t[O];P.getSource().reparseOverscaled&&this._assignTerrainTiles(F)}this.proxiedCoords[r.id]=p.map(O=>new of(O,O.key,this.orthoMatrix)),this._assignTerrainTiles(p),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(_),this.renderingToTexture=!1;const C={};this._visibleDemTiles=[];for(const O of this.proxyCoords){const P=this.terrainTileForTile[O.key];if(!P)continue;const F=P.tileID.key;F in C||(this._visibleDemTiles.push(P),C[F]=F)}}_assignTerrainTiles(t){this._initializing||t.forEach(r=>{if(this.terrainTileForTile[r.key])return;const u=this._findTileCoveringTileID(r,this.sourceCache);u&&(this.terrainTileForTile[r.key]=u)})}_prepareDEMTextures(){const t=this.painter.context,r=t.gl;for(const u in this.terrainTileForTile){const p=this.terrainTileForTile[u],_=p.dem;!_||p.demTexture&&!p.needsDEMTextureUpload||(t.activeTexture.set(r.TEXTURE1),ic(this.painter,p,_))}}_prepareDemTileUniforms(t,r,u,p){if(!r||r.demTexture==null)return!1;const _=t.tileID.canonical,b=Math.pow(2,r.tileID.canonical.z-_.z),C=p||"";return u[`u_dem_tl${C}`]=[_.x*b%1,_.y*b%1],u[`u_dem_scale${C}`]=b,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0;const r=this._visibleDemTiles.reduce((u,p)=>{if(!p.dem)return u;const _=p.dem.tree.minimums[0];return _>0&&t++,u+_},0);return t?r/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,r=t.gl;t.activeTexture.set(r.TEXTURE2);const u=this._getLoadedAreaMinimum(),p=new n.cK({width:1,height:1},new Float32Array([u]));this._emptyDEMTextureDirty=!1;let _=this._emptyDEMTexture;return _?_.update(p,{premultiply:!1}):_=this._emptyDEMTexture=new n.T(t,p,r.R32F,{premultiply:!1}),_}setupElevationDraw(t,r,u){const p=this.painter.context,_=p.gl,b={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};b.u_exaggeration=this.exaggeration();let C=null,O=null,P=1;if(u&&u.morphing&&this._useVertexMorphing){const H=u.morphing.srcDemTile,J=u.morphing.dstDemTile;P=u.morphing.phase,H&&J&&(this._prepareDemTileUniforms(t,H,b,"_prev")&&(O=H),this._prepareDemTileUniforms(t,J,b)&&(C=J))}const F=H=>H&&H.demTexture&&this.painter.linearFloatFilteringSupported()?_.LINEAR:_.NEAREST;let V=null;var U;if(this.enabled?O&&C?(V=C.demTexture,p.activeTexture.set(_.TEXTURE4),O.demTexture.bind(F(O),_.CLAMP_TO_EDGE),b.u_dem_lerp=P):(C=this.terrainTileForTile[t.tileID.key],V=this._prepareDemTileUniforms(t,C,b)?C.demTexture:this.emptyDEMTexture):V=this.emptyDEMTexture,p.activeTexture.set(_.TEXTURE2),V&&(b.u_dem_size=(U=V).size[0]===1?1:U.size[0]-2,V.bind(F(C),_.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(u&&u.useDepthForOcclusion,r,b),u&&u.useMeterToDem&&C){const H=(1<<C.tileID.canonical.z)*n.bH(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;b.u_meter_to_dem=H}if(u&&u.labelPlaneMatrixInv&&(b.u_label_plane_matrix_inv=u.labelPlaneMatrixInv),r.setTerrainUniformValues(p,b),this.painter.transform.projection.name==="globe"){const H=this.globeUniformValues(this.painter.transform,t.tileID.canonical,u&&u.useDenormalizedUpVectorScale);r.setGlobeUniformValues(p,H)}}globeUniformValues(t,r,u){const p=t.projection;return{u_tile_tl_up:p.upVector(r,0,0),u_tile_tr_up:p.upVector(r,n.ag,0),u_tile_br_up:p.upVector(r,n.ag,n.ag),u_tile_bl_up:p.upVector(r,0,n.ag),u_tile_up_scale:u?n.cL(1):p.upVectorScale(r,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const r=this.painter,u=this.painter.context;t.length!==0&&(u.bindFramebuffer.set(null),u.viewport.set([0,0,r.width,r.height]),r.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(p,_,b,C,O){if(p.transform.projection.name==="globe")(function(P,F,V,U,H){const J=P.context,$=J.gl;let te,ee;const le=P.transform,pe=n.cC(P,J,le),fe=(lt,it)=>{if(ee===it)return;const Be=[sc[it],"PROJECTION_GLOBE_VIEW"];pe&&Be.push("CUSTOM_ANTIALIASING");const Ke=P.isTileAffectedByFog(lt);te=P.getOrCreateProgram("globeRaster",{defines:Be,overrideFog:Ke}),ee=it},be=P.colorModeForRenderPass(),me=new ci($.LEQUAL,ci.ReadWrite,P.depthRangeFor3D);ra.update(H);const ve=n.cD(le),_e=[n.at(le.center.lng),n.aA(le.center.lat)],Ee=P.globeSharedBuffers,ze=[le.width*n.q.devicePixelRatio,le.height*n.q.devicePixelRatio],Ye=Float32Array.from(le.globeMatrix),qe={useDenormalizedUpVectorScale:!0};{const lt=P.transform,it=Qc(lt.zoom,F.exaggeration(),F.sourceCache._source.tileSize);ee=-1;const Be=$.TRIANGLES;for(const Ke of U){const gt=V.getTile(Ke),Fe=vi.disabled,st=F.prevTerrainTileForTile[Ke.key],Je=F.terrainTileForTile[Ke.key];af(st,Je)&&ra.newMorphing(Ke.key,st,Je,H,250),J.activeTexture.set($.TEXTURE0),gt.texture&&gt.texture.bind($.LINEAR,$.CLAMP_TO_EDGE);const St=ra.getMorphValuesForProxy(Ke.key),dt=St?1:0;St&&n.J(qe,{morphing:{srcDemTile:St.from,dstDemTile:St.to,phase:n.cB(St.phase)}});const ct=n.cE(Ke.canonical),vt=n.cF(ct.getCenter().lat),Ct=n.cG(Ke.canonical,ct,vt,lt.worldSize/lt._pixelsPerMercatorPixel),Vt=n.bb(n.cH(Ke.canonical)),Yt=Ua(lt.expandedFarZProjMatrix,Ye,ve,Vt,n.ae(lt.zoom),_e,lt.frustumCorners.TL,lt.frustumCorners.TR,lt.frustumCorners.BR,lt.frustumCorners.BL,lt.globeCenterInViewSpace,lt.globeRadius,ze,it,lt._farZ,Ct);if(fe(Ke,dt),te&&(F.setupElevationDraw(gt,te,qe),P.uploadCommonUniforms(J,te,Ke.toUnwrapped()),Ee)){const[ui,oi,ri]=Ee.getGridBuffers(vt,it!==0);te.draw(P,Be,me,Fe,be,yi.backCCW,Yt,"globe_raster",ui,oi,ri)}}}if(Ee&&(P.renderDefaultNorthPole||P.renderDefaultSouthPole)){const lt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];pe&&lt.push("CUSTOM_ANTIALIASING"),te=P.getOrCreateProgram("globeRaster",{defines:lt});for(const it of U){const{x:Be,y:Ke,z:gt}=it.canonical,Fe=Ke===0,st=Ke===(1<<gt)-1,[Je,St,dt,ct]=Ee.getPoleBuffers(gt,!1);if(ct&&(Fe||st)){const vt=V.getTile(it);J.activeTexture.set($.TEXTURE0),vt.texture&&vt.texture.bind($.LINEAR,$.CLAMP_TO_EDGE);let Ct=n.cI(gt,Be,le);const Vt=n.bb(n.cH(it.canonical)),Yt=(ui,oi)=>ui.draw(P,$.TRIANGLES,me,vi.disabled,be,yi.disabled,Ua(le.expandedFarZProjMatrix,Ct,Ct,Vt,0,_e,le.frustumCorners.TL,le.frustumCorners.TR,le.frustumCorners.BR,le.frustumCorners.BL,le.globeCenterInViewSpace,le.globeRadius,ze,0,le._farZ),"globe_pole_raster",oi,dt,ct);F.setupElevationDraw(vt,te,qe),P.uploadCommonUniforms(J,te,it.toUnwrapped()),Fe&&P.renderDefaultNorthPole&&Yt(te,Je),st&&P.renderDefaultSouthPole&&(Ct=n.ab.mat4.scale(n.ab.mat4.create(),Ct,[1,-1,1]),Yt(te,St))}}}})(p,_,b,C,O);else{const P=p.context,F=P.gl;let V,U;const H=p.shadowRenderer,J=al(p,p.longestCutoffRange),$=be=>{if(U===be)return;const me=[];me.push(sc[be]),J.shouldRenderCutoff&&me.push("RENDER_CUTOFF"),H&&(me.push("RENDER_SHADOWS","DEPTH_TEXTURE"),H.useNormalOffset&&me.push("NORMAL_OFFSET")),V=p.getOrCreateProgram("terrainRaster",{defines:me}),U=be},te=p.colorModeForRenderPass(),ee=new ci(F.LEQUAL,ci.ReadWrite,p.depthRangeFor3D);ra.update(O);const le=p.transform,pe=Qc(le.zoom,_.exaggeration(),_.sourceCache._source.tileSize);let fe=[0,0,0];if(H){const be=p.style.directionalLight,me=p.style.ambientLight;be&&me&&(fe=Wh(p.style,be,me))}{U=-1;const be=F.TRIANGLES,[me,ve]=[_.gridIndexBuffer,_.gridSegments];for(const _e of C){const Ee=b.getTile(_e),ze=vi.disabled,Ye=_.prevTerrainTileForTile[_e.key],qe=_.terrainTileForTile[_e.key];af(Ye,qe)&&ra.newMorphing(_e.key,Ye,qe,O,250),P.activeTexture.set(F.TEXTURE0),Ee.texture&&Ee.texture.bind(F.LINEAR,F.CLAMP_TO_EDGE);const lt=ra.getMorphValuesForProxy(_e.key),it=lt?1:0;let Be;lt&&(Be={morphing:{srcDemTile:lt.from,dstDemTile:lt.to,phase:n.cB(lt.phase)}});const Ke=nf(_e.projMatrix,sf(_e.canonical,le.renderWorldCopies)?pe/10:pe,fe);if($(it),!V)continue;_.setupElevationDraw(Ee,V,Be);const gt=_e.toUnwrapped();H&&H.setupShadows(gt,V),p.uploadCommonUniforms(P,V,gt,null,J),V.draw(p,be,ee,ze,te,yi.backCCW,Ke,"terrain_raster",_.gridBuffer,me,ve)}}}}(r,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,r.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const r=this.painter,u=this.painter.context,p=this.proxySourceCache,_=this.proxiedCoords[p.id],b=this._drapedRenderBatches.shift(),C=r.style.order,O=[];let P=0;for(const F of _){const V=p.getTileByID(F.proxyTileKey),U=p.proxyCachedFBO[F.key]?p.proxyCachedFBO[F.key][t]:void 0,H=U!==void 0?p.renderCache[U]:this.pool[P++],J=U!==void 0;if(V.texture=H.tex,J&&!H.dirty){O.push(V.tileID);continue}let $;u.bindFramebuffer.set(H.fb.framebuffer),this.renderedToTile=!1,H.dirty&&(u.clear({color:n.aj.transparent,stencil:0}),H.dirty=!1);for(let te=b.start;te<=b.end;++te){const ee=r.style._mergedLayers[C[te]];if(ee.isHidden(r.transform.zoom))continue;const le=r.style.getLayerSourceCache(ee),pe=le?this.proxyToSource[F.key][le.id]:[F];if(!pe)continue;const fe=pe;u.viewport.set([0,0,H.fb.width,H.fb.height]),$!==(le?le.id:null)&&(this._setupStencil(H,pe,ee,le),$=le?le.id:null),r.renderLayer(r,le,ee,fe)}if(this._drapedRenderBatches.length===0)for(const te of this._pendingGroundEffectLayers){const ee=r.style._mergedLayers[C[te]];if(ee.isHidden(r.transform.zoom))continue;const le=r.style.getLayerSourceCache(ee),pe=le?this.proxyToSource[F.key][le.id]:[F];if(!pe)continue;const fe=pe;u.viewport.set([0,0,H.fb.width,H.fb.height]),$!==(le?le.id:null)&&(this._setupStencil(H,pe,ee,le),$=le?le.id:null),r.renderLayer(r,le,ee,fe)}this.renderedToTile?(H.dirty=!0,O.push(V.tileID)):J||--P,P===5&&(P=0,this.renderToBackBuffer(O))}return this.renderToBackBuffer(O),this.renderingToTexture=!1,u.bindFramebuffer.set(null),u.viewport.set([0,0,r.width,r.height]),b.end+1}postRender(){}isLayerOrderingCorrect(t){const r=t.order.length;let u=-1,p=r;for(let _=0;_<r;++_)this._style.isLayerDraped(t._mergedLayers[t.order[_]])?u=Math.max(u,_):p=Math.min(p,_);return p>u}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(r=>r.dem).forEach(r=>{t=Math.min(t,r.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,r,u){if(!this._visibleDemTiles)return null;const p=this._visibleDemTiles.filter(_=>_.dem).map(_=>{const b=_.tileID,C=1<<b.overscaledZ,{x:O,y:P}=b.canonical,F=O/C,V=(O+1)/C,U=P/C,H=(P+1)/C;return{minx:F,miny:U,maxx:V,maxy:H,t:_.dem.tree.raycastRoot(F,U,V,H,t,r,u),tile:_}});p.sort((_,b)=>(_.t!==null?_.t:Number.MAX_VALUE)-(b.t!==null?b.t:Number.MAX_VALUE));for(const _ of p){if(_.t==null)return null;const b=_.tile.dem.tree.raycast(_.minx,_.miny,_.maxx,_.maxy,t,r,u);if(b!=null)return b}return null}_createFBO(){const t=this.painter.context,r=t.gl,u=this.drapeBufferSize;t.activeTexture.set(r.TEXTURE0);const p=new n.T(t,{width:u[0],height:u[1],data:null},r.RGBA8);p.bind(r.LINEAR,r.CLAMP_TO_EDGE);const _=t.createFramebuffer(u[0],u[1],!0,null);return _.colorAttachment.set(p.texture),_.depthAttachment=new dd(t,_.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,u[0],u[1]),this._stencilRef=0,_.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):_.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&r.texParameterf(r.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:_,tex:p,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const r=this._style._mergedLayers[t],u=r.isHidden(this.painter.transform.zoom);return r.type==="hillshade"||r.type==="custom"?!u&&r.shouldRedrape():!u&&r.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(const u of this._style.getSources())if(u instanceof un){t=!0;break}if(!t)return;const r={};for(let u=0;u<this._style.order.length;++u){const p=this._style._mergedLayers[this._style.order[u]],_=this._style.getLayerSourceCache(p);if(_&&!r[_.id]&&!p.isHidden(this.painter.transform.zoom)&&p.type==="line"&&p.widthExpression()instanceof n.a9){r[_.id]=!0;for(const b of this.proxyCoords){const C=this.proxyToSource[b.key][_.id];if(C)for(const O of C)this._clearRenderCacheForTile(_.id,O)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const u in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[u]._source instanceof Wa){t=!0;break}if(!t)return;const r={};for(let u=0;u<this._style.order.length;++u){const p=this._style._mergedLayers[this._style.order[u]],_=this._style.getLayerSourceCache(p);if(!_||r[_.id]||p.isHidden(this.painter.transform.zoom)||p.type!=="raster")continue;const b=p.paint.get("raster-fade-duration");for(const C of this.proxyCoords){const O=this.proxyToSource[C.key][_.id];if(O)for(const P of O){const F=ga(_.getTile(P),_.findLoadedParent(P,0),_,this.painter.transform,b);(F.opacity!==1||F.mix!==0)&&this._clearRenderCacheForTile(_.id,P)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const t=this._style.order,r=t.length;if(r===0)return;const u=[];this._pendingGroundEffectLayers=[];let p,_=0,b=this._style._mergedLayers[t[_]];for(;!this._style.isLayerDraped(b)&&b.isHidden(this.painter.transform.zoom)&&++_<r;)b=this._style._mergedLayers[t[_]];for(;_<r;++_){const C=this._style._mergedLayers[t[_]];C.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(C)?p===void 0&&(p=_):(C.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(_),p!==void 0&&(u.push({start:p,end:_-1}),p=void 0)))}if(p!==void 0&&u.push({start:p,end:_-1}),u.length!==0){const C=u[u.length-1];this._pendingGroundEffectLayers.every(O=>O>C.end)||n.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=u}_setupRenderCache(t){const r=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,r.renderCache.length>r.renderCachePool.length){const b=Object.values(r.proxyCachedFBO);r.proxyCachedFBO={};for(let C=0;C<b.length;++C){const O=Object.values(b[C]);r.renderCachePool.push(...O)}}return}this._clearRasterLayersFromRenderCache();const u=this.proxyCoords,p=this._tilesDirty;for(let b=u.length-1;b>=0;b--){const C=u[b];if(r.getTileByID(C.key),r.proxyCachedFBO[C.key]!==void 0){const O=t[C.key],P=this.proxyToSource[C.key];let F=0;for(const V in P){const U=P[V],H=O[V];if(!H||H.length!==U.length||U.some((J,$)=>J!==H[$]||p[V]&&p[V].hasOwnProperty(J.key))){F=-1;break}++F}for(const V in r.proxyCachedFBO[C.key])r.renderCache[r.proxyCachedFBO[C.key][V]].dirty=F<0||F!==Object.values(O).length}}const _=[...this._drapedRenderBatches];_.sort((b,C)=>C.end-C.start-(b.end-b.start));for(const b of _)for(const C of u){if(r.proxyCachedFBO[C.key])continue;let O=r.renderCachePool.pop();O===void 0&&r.renderCache.length<50&&(O=r.renderCache.length,r.renderCache.push(this._createFBO())),O!==void 0&&(r.proxyCachedFBO[C.key]={},r.proxyCachedFBO[C.key][b.start]=O,r.renderCache[O].dirty=!0)}this._tilesDirty={}}_setupStencil(t,r,u,p){if(!p||!this._sourceTilesOverlap[p.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const _=this.painter.context,b=_.gl;if(r.length<=1)return void(this._overlapStencilType=!1);let C;if(u.isTileClipped())C=r.length,this._overlapStencilMode.test={func:b.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(r[0].overscaledZ>r[r.length-1].overscaledZ))return void(this._overlapStencilType=!1);C=1,this._overlapStencilMode.test={func:b.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+C>255&&(_.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=C,this._overlapStencilMode.ref=this._stencilRef,u.isTileClipped()&&this._renderTileClippingMasks(r,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):vi.disabled}_renderTileClippingMasks(t,r){const u=this.painter,p=this.painter.context,_=p.gl;u._tileClippingMaskIDs={},p.setColorMode(Ui.disabled),p.setDepthMode(ci.disabled);const b=u.getOrCreateProgram("clippingMask");for(const C of t){const O=u._tileClippingMaskIDs[C.key]=--r;b.draw(u,_.TRIANGLES,ci.disabled,new vi({func:_.ALWAYS,mask:0},O,255,_.KEEP,_.KEEP,_.REPLACE),Ui.disabled,yi.disabled,Kc(C.projMatrix),"$clipping",u.tileExtentBuffer,u.quadTriangleIndexBuffer,u.tileExtentSegments)}}pointCoordinate(t){const r=this.painter.transform;if(t.x<0||t.x>r.width||t.y<0||t.y>r.height)return null;const u=[t.x,t.y,1,1];n.ab.vec4.transformMat4(u,u,r.pixelMatrixInverse),n.ab.vec4.scale(u,u,1/u[3]),u[0]/=r.worldSize,u[1]/=r.worldSize;const p=r._camera.position,_=n.bH(1,r.center.lat),b=[p[0],p[1],p[2]/_,0],C=n.ab.vec3.subtract([],u.slice(0,3),b);n.ab.vec3.normalize(C,C);const O=this.raycast(b,C,this._exaggeration);return O!==null&&O?(n.ab.vec3.scaleAndAdd(b,b,C,O),b[3]=b[2],b[2]*=_,b):null}_setupProxiedCoordsForOrtho(t,r,u){if(t.getSource()instanceof n.aJ)return this._setupProxiedCoordsForImageSource(t,r,u);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const p=this.proxiedCoords[t.id]=[],_=this.proxyCoords;for(let O=0;O<_.length;O++){const P=_[O],F=this._findTileCoveringTileID(P,t);if(F){const V=this._createProxiedId(P,F,u[P.key]&&u[P.key][t.id]);p.push(V),this.proxyToSource[P.key][t.id]=[V]}}let b=!1;const C=new Set;for(let O=0;O<r.length;O++){const P=t.getTile(r[O]);if(!P||!P.hasData())continue;const F=this._findTileCoveringTileID(P.tileID,this.proxySourceCache);if(F&&F.tileID.canonical.z!==P.tileID.canonical.z){const V=this.proxyToSource[F.tileID.key][t.id],U=this._createProxiedId(F.tileID,P,u[F.tileID.key]&&u[F.tileID.key][t.id]);V?V.splice(V.length-1,0,U):this.proxyToSource[F.tileID.key][t.id]=[U];const H=this.proxyToSource[F.tileID.key][t.id];C.has(H)||C.add(H),p.push(U),b=!0}}if(this._sourceTilesOverlap[t.id]=b,b&&this._debugParams.sortTilesHiZFirst)for(const O of C)O.sort((P,F)=>F.overscaledZ-P.overscaledZ)}_setupProxiedCoordsForImageSource(t,r,u){if(!t.getSource().loaded())return;const p=this.proxiedCoords[t.id]=[],_=this.proxyCoords,b=t.getSource(),C=b.tileID;if(!C)return;const O=new n.P(C.x,C.y)._div(1<<C.z),P=b.coordinates.map(n.aa.fromLngLat).reduce((V,U)=>(V.min.x=Math.min(V.min.x,U.x-O.x),V.min.y=Math.min(V.min.y,U.y-O.y),V.max.x=Math.max(V.max.x,U.x-O.x),V.max.y=Math.max(V.max.y,U.y-O.y),V),{min:new n.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new n.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),F=(V,U)=>{const H=V.wrap+V.canonical.x/(1<<V.canonical.z),J=V.canonical.y/(1<<V.canonical.z),$=n.ag/(1<<V.canonical.z),te=U.wrap+U.canonical.x/(1<<U.canonical.z),ee=U.canonical.y/(1<<U.canonical.z);return H+$<te+P.min.x||H>te+P.max.x||J+$<ee+P.min.y||J>ee+P.max.y};for(let V=0;V<_.length;V++){const U=_[V];for(let H=0;H<r.length;H++){const J=t.getTile(r[H]);if(!J||!J.hasData()||F(U,J.tileID))continue;const $=this._createProxiedId(U,J,u[U.key]&&u[U.key][t.id]),te=this.proxyToSource[U.key][t.id];te?te.push($):this.proxyToSource[U.key][t.id]=[$],p.push($)}}}_createProxiedId(t,r,u){let p=this.orthoMatrix;if(u){const _=u.find(b=>b.key===r.tileID.key);if(_)return _}if(r.tileID.key!==t.key){const _=t.canonical.z-r.tileID.canonical.z;let b,C,O;p=n.ab.mat4.create();const P=r.tileID.wrap-t.wrap<<t.overscaledZ;_>0?(b=n.ag>>_,C=b*((r.tileID.canonical.x<<_)-t.canonical.x+P),O=b*((r.tileID.canonical.y<<_)-t.canonical.y)):(b=n.ag<<-_,C=n.ag*(r.tileID.canonical.x-(t.canonical.x+P<<-_)),O=n.ag*(r.tileID.canonical.y-(t.canonical.y<<-_))),n.ab.mat4.ortho(p,0,b,0,b,0,1),n.ab.mat4.translate(p,p,[C,O,0])}return new of(r.tileID,t.key,p)}_findTileCoveringTileID(t,r){let u=r.getTile(t);if(u&&u.hasData())return u;const p=this._findCoveringTileCache[r.id],_=p[t.key];if(u=_?r.getTileByID(_):null,u&&u.hasData()||_===null)return u;let b=u?u.tileID:t,C=b.overscaledZ;const O=r.getSource().minzoom,P=[];if(!_){const V=r.getSource().maxzoom;if(t.canonical.z>=V){const U=t.canonical.z-V;r.getSource().reparseOverscaled?(C=Math.max(t.canonical.z+2,r.transform.tileZoom),b=new n.aG(C,t.wrap,V,t.canonical.x>>U,t.canonical.y>>U)):U!==0&&(C=V,b=new n.aG(C,t.wrap,V,t.canonical.x>>U,t.canonical.y>>U))}b.key!==t.key&&(P.push(b.key),u=r.getTile(b))}const F=V=>{P.forEach(U=>{p[U]=V}),P.length=0};for(C-=1;C>=O&&(!u||!u.hasData());C--){u&&F(u.tileID.key);const V=b.calculateScaledKey(C);if(u=r.getTileByID(V),u&&u.hasData())break;const U=p[V];if(U===null)break;U===void 0?P.push(V):u=r.getTileByID(U)}return F(u?u.tileID.key:null),u&&u.hasData()?u:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,r){let u=this._tilesDirty[t];u||(u=this._tilesDirty[t]={}),u[r.key]=!0}}function Fo(c,t,r){const u=function(C,O,P){const F=n.ab.vec3.dot(O,C),V=n.ab.vec3.dot(P,[.2126,.7152,.0722]),U=(J,$,te)=>(1-te)*J+te*$,H=U(1-.3*Math.min(V,1),1,Math.min(F+1,1));return U(.92,1,Math.asin(n.aw(O[2],-1,1))/Math.PI+.5)*H}(c,[0,0,1],t),p=[0,0,0];n.ab.vec3.scale(p,r.slice(0,3),u);const _=[0,0,0];n.ab.vec3.scale(_,t.slice(0,3),c[2]);const b=[0,0,0];return n.ab.vec3.add(b,p,_),n.cf(b)}const Xn=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],eh=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","model","symbol"];class yp{static cacheKey(t,r,u,p){let _=`${r}${p?p.cacheKey:""}`;for(const b of u)t.usedDefines.includes(b)&&(_+=`/${b}`);return _}constructor(t,r,u,p,_,b){const C=t.gl;this.program=C.createProgram(),this.configuration=p,this.name=r,this.fixedDefines=[...b];const O=p?p.getBinderAttributes():[],P=(u.staticAttributes||[]).concat(O);let F=p?p.defines():[];F=F.concat(b.map(te=>`#define ${te}`));const V=`#version 300 es
`;let U=V+F.concat("precision mediump float;",Jl,Kl.fragmentSource).join(`
`);for(const te of u.fragmentIncludes)U+=`
${fl[te]}`;U+=`
${u.fragmentSource}`;let H=V+F.concat("precision highp float;",Jl,Kl.vertexSource).join(`
`);for(const te of u.vertexIncludes)H+=`
${fl[te]}`;this.forceManualRenderingForInstanceIDShaders=t.forceManualRenderingForInstanceIDShaders&&u.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(H+=`
uniform int u_instanceID;
`),H+=`
${u.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(H=H.replaceAll("gl_InstanceID","u_instanceID"));const J=C.createShader(C.FRAGMENT_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);C.shaderSource(J,U),C.compileShader(J),C.attachShader(this.program,J);const $=C.createShader(C.VERTEX_SHADER);if(C.isContextLost())this.failedToCreate=!0;else{C.shaderSource($,H),C.compileShader($),C.attachShader(this.program,$),this.attributes={},this.numAttributes=P.length;for(let te=0;te<this.numAttributes;te++)if(P[te]){const ee=P[te].startsWith("a_")?P[te]:`a_${P[te]}`;C.bindAttribLocation(this.program,te,ee),this.attributes[ee]=te}C.linkProgram(this.program),C.deleteShader($),C.deleteShader(J),this.fixedUniforms=_(t),this.binderUniforms=p?p.getUniforms(t):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(te=>({u_instanceID:new n.bN(te)}))(t)),(b.includes("TERRAIN")||r.indexOf("symbol")!==-1||r.indexOf("circle")!==-1)&&(this.terrainUniforms=(te=>({u_dem:new n.bN(te),u_dem_prev:new n.bN(te),u_dem_tl:new n.bK(te),u_dem_scale:new n.bM(te),u_dem_tl_prev:new n.bK(te),u_dem_scale_prev:new n.bM(te),u_dem_size:new n.bM(te),u_dem_lerp:new n.bM(te),u_exaggeration:new n.bM(te),u_depth:new n.bN(te),u_depth_size_inv:new n.bK(te),u_depth_range_unpack:new n.bK(te),u_occluder_half_size:new n.bM(te),u_occlusion_depth_offset:new n.bM(te),u_meter_to_dem:new n.bM(te),u_label_plane_matrix_inv:new n.bJ(te)}))(t)),b.includes("GLOBE")&&(this.globeUniforms=(te=>({u_tile_tl_up:new n.bL(te),u_tile_tr_up:new n.bL(te),u_tile_br_up:new n.bL(te),u_tile_bl_up:new n.bL(te),u_tile_up_scale:new n.bM(te)}))(t)),b.includes("FOG")&&(this.fogUniforms=(te=>({u_fog_matrix:new n.bJ(te),u_fog_range:new n.bK(te),u_fog_color:new n.ca(te),u_fog_horizon_blend:new n.bM(te),u_fog_vertical_limit:new n.bK(te),u_fog_temporal_offset:new n.bM(te),u_frustum_tl:new n.bL(te),u_frustum_tr:new n.bL(te),u_frustum_br:new n.bL(te),u_frustum_bl:new n.bL(te),u_globe_pos:new n.bL(te),u_globe_radius:new n.bM(te),u_globe_transition:new n.bM(te),u_is_globe:new n.bN(te),u_viewport:new n.bK(te)}))(t)),b.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(te=>({u_cutoff_params:new n.ca(te)}))(t)),b.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(te=>({u_lighting_ambient_color:new n.bL(te),u_lighting_directional_dir:new n.bL(te),u_lighting_directional_color:new n.bL(te),u_ground_radiance:new n.bL(te)}))(t)),b.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(te=>({u_light_matrix_0:new n.bJ(te),u_light_matrix_1:new n.bJ(te),u_fade_range:new n.bK(te),u_shadow_normal_offset:new n.bL(te),u_shadow_intensity:new n.bM(te),u_shadow_texel_size:new n.bM(te),u_shadow_map_resolution:new n.bM(te),u_shadow_direction:new n.bL(te),u_shadow_bias:new n.bL(te),u_shadowmap_0:new n.bN(te),u_shadowmap_1:new n.bN(te)}))(t))}}setTerrainUniformValues(t,r){if(!this.terrainUniforms)return;const u=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in r)u[p]&&u[p].set(this.program,p,r[p])}}setGlobeUniformValues(t,r){if(!this.globeUniforms)return;const u=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in r)u[p]&&u[p].set(this.program,p,r[p])}}setFogUniformValues(t,r){if(!this.fogUniforms)return;const u=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in r)u[p].set(this.program,p,r[p])}}setCutoffUniformValues(t,r){if(!this.cutoffUniforms)return;const u=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in r)u[p].set(this.program,p,r[p])}}setLightsUniformValues(t,r){if(!this.lightsUniforms)return;const u=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in r)u[p].set(this.program,p,r[p])}}setShadowUniformValues(t,r){if(this.failedToCreate||!this.shadowUniforms)return;const u=this.shadowUniforms;t.program.set(this.program);for(const p in r)u[p].set(this.program,p,r[p])}_drawDebugWireframe(t,r,u,p,_,b,C,O,P,F){const V=t.options.wireframe;if(V.terrain===!1&&V.layers2D===!1&&V.layers3D===!1)return;const U=t.context;if(!(!(!V.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!V.layers2D||t._terrain&&t._terrain.renderingToTexture||!Xn.includes(this.name))||!(!V.layers3D||!eh.includes(this.name))))return;const H=U.gl,J=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,_,U);if(!J)return;const $=[...this.fixedDefines];$.push("DEBUG_WIREFRAME");const te=t.getOrCreateProgram(this.name,{config:this.configuration,defines:$});U.program.set(te.program);const ee=(fe,be,me)=>{if(be[fe]&&me[fe])for(const ve in be[fe])me[fe][ve]&&me[fe][ve].set(me.program,ve,be[fe][ve].current)};P&&P.setUniforms(te.program,U,te.binderUniforms,C,{zoom:O}),ee("fixedUniforms",this,te),ee("terrainUniforms",this,te),ee("globeUniforms",this,te),ee("fogUniforms",this,te),ee("lightsUniforms",this,te),ee("shadowUniforms",this,te),J.bind(),U.setColorMode(new Ui([H.ONE,H.ONE_MINUS_SRC_ALPHA,H.ZERO,H.ONE],n.aj.transparent,[!0,!0,!0,!1])),U.setDepthMode(new ci(r.func===H.LESS?H.LEQUAL:r.func,ci.ReadOnly,r.range)),U.setStencilMode(vi.disabled);const le=3*b.primitiveLength*2,pe=3*b.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const fe=F||1;for(let be=0;be<fe;++be)te.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",be),H.drawElements(H.LINES,le,H.UNSIGNED_SHORT,pe)}else F&&F>1?H.drawElementsInstanced(H.LINES,le,H.UNSIGNED_SHORT,pe,F):H.drawElements(H.LINES,le,H.UNSIGNED_SHORT,pe);_.bind(),U.program.set(this.program),U.setDepthMode(r),U.setStencilMode(u),U.setColorMode(p)}checkUniforms(t,r,u){if(this.fixedDefines.includes(r)){for(const p of Object.keys(u))if(!u[p].initialized)throw new Error(`Program '${this.name}', from draw '${t}': uniform ${p} not set but required by ${r} being defined`)}}draw(t,r,u,p,_,b,C,O,P,F,V,U,H,J,$,te){const ee=t.context,le=ee.gl;if(this.failedToCreate)return;ee.program.set(this.program),ee.setDepthMode(u),ee.setStencilMode(p),ee.setColorMode(_),ee.setCullFace(b);for(const be of Object.keys(this.fixedUniforms))this.fixedUniforms[be].set(this.program,be,C[be]);J&&J.setUniforms(this.program,ee,this.binderUniforms,U,{zoom:H});const pe={[le.POINTS]:1,[le.LINES]:2,[le.TRIANGLES]:3,[le.LINE_STRIP]:1}[r];this.checkUniforms(O,"RENDER_SHADOWS",this.shadowUniforms);const fe=te&&te>0?1:void 0;for(const be of V.get()){const me=be.vaos||(be.vaos={});if((me[O]||(me[O]=new ec)).bind(ee,this,P,J?J.getPaintVertexBuffers():[],F,be.vertexOffset,$||[],fe),this.forceManualRenderingForInstanceIDShaders){const ve=te||1;for(let _e=0;_e<ve;++_e)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",_e),F?le.drawElements(r,be.primitiveLength*pe,le.UNSIGNED_SHORT,be.primitiveOffset*pe*2):le.drawArrays(r,be.vertexOffset,be.vertexLength)}else te&&te>1?le.drawElementsInstanced(r,be.primitiveLength*pe,le.UNSIGNED_SHORT,be.primitiveOffset*pe*2,te):F?le.drawElements(r,be.primitiveLength*pe,le.UNSIGNED_SHORT,be.primitiveOffset*pe*2):le.drawArrays(r,be.vertexOffset,be.vertexLength);r===le.TRIANGLES&&F&&this._drawDebugWireframe(t,u,p,_,F,be,U,H,J,te)}}}function lf(c,t){const r=Math.pow(2,t.tileID.overscaledZ),u=t.tileSize*Math.pow(2,c.transform.tileZoom)/r,p=u*(t.tileID.canonical.x+t.tileID.wrap*r),_=u*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/n.ar(t,1,c.transform.tileZoom),u_pixel_coord_upper:[p>>16,_>>16],u_pixel_coord_lower:[65535&p,65535&_]}}const Jc={terrain:0,flat:1},fn=n.ab.mat4.create(),eu=(c,t,r,u,p,_,b,C,O,P,F,V,U,H,J,$,te,ee)=>{const le=t.style.light,pe=le.properties.get("position"),fe=[pe.x,pe.y,pe.z],be=n.ab.mat3.create();le.properties.get("anchor")==="viewport"&&(n.ab.mat3.fromRotation(be,-t.transform.angle),n.ab.vec3.transformMat3(fe,fe,be));const me=le.properties.get("color"),ve=t.transform,_e={u_matrix:c,u_lightpos:fe,u_lightintensity:le.properties.get("intensity"),u_lightcolor:[me.r,me.g,me.b],u_vertical_gradient:+r,u_opacity:u,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:fn,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Jc[P],u_base_type:Jc[F],u_ao:p,u_edge_radius:_,u_width_scale:b,u_flood_light_color:J,u_vertical_scale:$,u_flood_light_intensity:te,u_ground_shadow_factor:ee};return ve.projection.name==="globe"&&(_e.u_tile_id=[C.canonical.x,C.canonical.y,1<<C.canonical.z],_e.u_zoom_transition=V,_e.u_inv_rot_matrix=H,_e.u_merc_center=U,_e.u_up_dir=ve.projection.upVector(new n.bT(0,0,0),U[0]*n.ag,U[1]*n.ag),_e.u_height_lift=O),_e},Bo=(c,t,r,u,p,_)=>({u_matrix:c,u_edge_radius:t,u_width_scale:r,u_vertical_scale:u,u_height_type:Jc[p],u_base_type:Jc[_]}),tu=(c,t,r,u,p,_,b,C,O,P,F,V,U,H,J,$,te)=>{const ee=eu(c,t,r,u,p,_,b,C,P,F,V,U,H,J,$,te,1,[0,0,0]),le={u_height_factor:-Math.pow(2,C.overscaledZ)/O.tileSize/8};return n.l(ee,lf(t,O),le)},oc=(c,t)=>({u_matrix:c,u_emissive_strength:t}),ho=(c,t,r,u)=>n.l(oc(c,t),lf(r,u)),vl=(c,t,r)=>({u_matrix:c,u_world:r,u_emissive_strength:t}),vp=(c,t,r,u,p)=>n.l(ho(c,t,r,u),{u_world:p}),xp=(c,t,r,u)=>{const p=n.ag/r.tileSize;return{u_matrix:c,u_camera_to_center_distance:t.getCameraToCenterDistance(u),u_extrude_scale:[t.pixelsToGLUnits[0]/p,t.pixelsToGLUnits[1]/p]}},lc=(c,t,r=1)=>({u_matrix:c,u_color:t.toRenderColor(null),u_overlay:0,u_overlay_scale:r}),th=n.ab.mat4.create(),Zt=(c,t,r,u,p,_,b)=>{const C=c.transform,O=C.projection.name==="globe",P=O?n.cN(C.zoom,t.canonical)*C._pixelsPerMercatorPixel:n.ar(r,1,_),F={u_matrix:t.projMatrix,u_extrude_scale:P,u_intensity:b,u_inv_rot_matrix:th,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(O){F.u_inv_rot_matrix=u,F.u_merc_center=p,F.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],F.u_zoom_transition=n.ae(C.zoom);const V=p[0]*n.ag,U=p[1]*n.ag;F.u_up_dir=C.projection.upVector(new n.bT(0,0,0),V,U)}return F};function ih(c,[t,r,u,p],[_,b]){if(_===b)return[0,0,0,0];const C=255*(c-1)/(c*(b-_));return[t*C,r*C,u*C,p*C]}function iu(c,t,[r,u]){return r===u?0:.5/c+(t-r)*(c-1)/(c*(u-r))}const No=(c,t,r,u,p,_,b,C,O,P,F,V,U,H,J,$,te,ee,le,pe,fe)=>({u_matrix:c,u_normalize_matrix:t,u_globe_matrix:r,u_merc_matrix:u,u_grid_matrix:p,u_tl_parent:_,u_scale_parent:P,u_fade_t:F.mix,u_opacity:F.opacity*V.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:V.paint.get("raster-brightness-min"),u_brightness_high:V.paint.get("raster-brightness-max"),u_saturation_factor:n.cO(V.paint.get("raster-saturation")),u_contrast_factor:n.cP(V.paint.get("raster-contrast")),u_spin_weights:ja(V.paint.get("raster-hue-rotate")),u_perspective_transform:U,u_raster_elevation:H,u_zoom_transition:b,u_merc_center:C,u_cutoff_params:O,u_colorization_mix:ih(n.cQ,$,ee),u_colorization_offset:iu(n.cQ,te,ee),u_color_ramp:J,u_texture_offset:[pe/(le+2*pe),le/(le+2*pe)],u_texture_res:[le+2*pe,le+2*pe],u_emissive_strength:fe});function ja(c){c*=Math.PI/180;const t=Math.sin(c),r=Math.cos(c);return[(2*r+1)/3,(-Math.sqrt(3)*t-r+1)/3,(Math.sqrt(3)*t-r+1)/3]}const It=.05,Ur=(c,t,r,u,p,_,b,C,O,P,F,V)=>({u_matrix:c,u_normalize_matrix:t,u_globe_matrix:r,u_merc_matrix:u,u_grid_matrix:p,u_tl_parent:_,u_scale_parent:P,u_fade_t:F.mix,u_opacity:F.opacity,u_image0:0,u_image1:1,u_raster_elevation:V,u_zoom_transition:b,u_merc_center:C,u_cutoff_params:O}),On=(c,t,r,u,p,_,b,C,O,P)=>({u_particle_texture:c,u_particle_texture_side_len:t,u_tile_offset:r,u_velocity:u,u_color_ramp:_,u_velocity_res:p,u_max_speed:b,u_uv_offset:C,u_data_scale:[255*O[0],255*O[1]],u_data_offset:P,u_particle_pos_scale:1.1,u_particle_pos_offset:[It,It]}),cf=(c,t,r,u,p,_,b,C,O,P)=>({u_particle_texture:c,u_particle_texture_side_len:t,u_velocity:r,u_velocity_res:u,u_max_speed:p,u_speed_factor:_,u_reset_rate:b,u_rand_seed:Math.random(),u_uv_offset:C,u_data_scale:[255*O[0],255*O[1]],u_data_offset:P,u_particle_pos_scale:1.1,u_particle_pos_offset:[It,It]}),Vo=n.ab.mat4.create(),Uo=(c,t,r,u,p,_,b,C,O,P,F,V,U,H,J,$,te,ee,le,pe,fe,be)=>{const me=p.transform,ve={u_is_size_zoom_constant:+(c==="constant"||c==="source"),u_is_size_feature_constant:+(c==="constant"||c==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:me.getCameraToCenterDistance(le),u_rotate_symbol:+r,u_aspect_ratio:me.width/me.height,u_fade_change:p.options.fadeDuration?p.symbolFadeChange:1,u_matrix:_,u_label_plane_matrix:b,u_coord_matrix:C,u_is_text:+P,u_elevation_from_sea:O?1:0,u_pitch_with_map:+u,u_texsize:F,u_texsize_icon:V,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Vo,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Vo,u_up_vector:[0,-1,0],u_color_adj_mat:pe,u_icon_transition:fe||0,u_gamma_scale:u?p.transform.getCameraToCenterDistance(le)*Math.cos(p.terrain?0:p.transform._pitch):1,u_device_pixel_ratio:n.q.devicePixelRatio,u_is_halo:1,u_scale_factor:be||1};return le.name==="globe"&&(ve.u_tile_id=[H.canonical.x,H.canonical.y,1<<H.canonical.z],ve.u_zoom_transition=J,ve.u_inv_rot_matrix=te,ve.u_merc_center=$,ve.u_camera_forward=me._camera.forward(),ve.u_ecef_origin=n.cR(me.globeMatrix,H.toUnwrapped()),ve.u_tile_matrix=Float32Array.from(me.globeMatrix),ve.u_up_vector=ee),ve},ru=(c,t,r,u)=>({u_matrix:c,u_emissive_strength:t,u_opacity:r,u_color:u}),nu=(c,t,r,u,p,_,b,C,O)=>n.l(function(P,F,V,U,H,J){const{width:$,height:te}=U.imageManager.getPixelSize(F),ee=Math.pow(2,J.tileID.overscaledZ),le=J.tileSize*Math.pow(2,U.transform.tileZoom)/ee,pe=le*(J.tileID.canonical.x+J.tileID.wrap*ee),fe=le*J.tileID.canonical.y;return{u_image:0,u_pattern_tl:V.tl,u_pattern_br:V.br,u_texsize:[$,te],u_pattern_size:V.displaySize,u_pattern_units_to_pixels:H?[U.transform.width,-1*U.transform.height]:[1/n.ar(J,1,U.transform.tileZoom),1/n.ar(J,1,U.transform.tileZoom)],u_pixel_coord_upper:[pe>>16,fe>>16],u_pixel_coord_lower:[65535&pe,65535&fe]}}(0,_,b,u,C,O),{u_matrix:c,u_emissive_strength:t,u_opacity:r}),xl=new Float32Array(n.ab.mat4.identity([])),rh=(c,t,r,u,p,_,b,C,O,P,F,V,U,H=[0,0,0],J)=>{const $=p.style.light,te=$.properties.get("position"),ee=[-te.x,-te.y,te.z],le=n.ab.mat3.create();$.properties.get("anchor")==="viewport"&&(n.ab.mat3.fromRotation(le,-p.transform.angle),n.ab.vec3.transformMat3(ee,ee,le));const pe=F.alphaMode==="MASK",fe=$.properties.get("color").toRenderColor(null),be=U.paint.get("model-ambient-occlusion-intensity"),me=U.paint.get("model-color").constantOr(n.aj.white).toRenderColor(null),ve=U.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:c,u_lighting_matrix:t,u_normal_matrix:r,u_node_matrix:u||xl,u_lightpos:ee,u_lightintensity:$.properties.get("intensity"),u_lightcolor:[fe.r,fe.g,fe.b],u_camera_pos:H,u_opacity:_,u_baseTextureIsAlpha:0,u_alphaMask:+pe,u_alphaCutoff:F.alphaCutoff,u_baseColorFactor:[b.r,b.g,b.b,b.a],u_emissiveFactor:[C[0],C[1],C[2],1],u_metallicFactor:O,u_roughnessFactor:P,u_baseColorTexture:zn.BaseColor,u_metallicRoughnessTexture:zn.MetallicRoughness,u_normalTexture:zn.Normal,u_occlusionTexture:zn.Occlusion,u_emissionTexture:zn.Emission,u_lutTexture:zn.LUT,u_color_mix:[me.r,me.g,me.b,ve],u_aoIntensity:be,u_emissive_strength:V,u_occlusionTextureTransform:J||[0,0,0,0]}},dn=(c,t=xl,r=xl)=>({u_matrix:c,u_instance:t,u_node_matrix:r}),nh={fillExtrusion:c=>({u_matrix:new n.bJ(c),u_lightpos:new n.bL(c),u_lightintensity:new n.bM(c),u_lightcolor:new n.bL(c),u_vertical_gradient:new n.bM(c),u_opacity:new n.bM(c),u_edge_radius:new n.bM(c),u_width_scale:new n.bM(c),u_ao:new n.bK(c),u_height_type:new n.bN(c),u_base_type:new n.bN(c),u_tile_id:new n.bL(c),u_zoom_transition:new n.bM(c),u_inv_rot_matrix:new n.bJ(c),u_merc_center:new n.bK(c),u_up_dir:new n.bL(c),u_height_lift:new n.bM(c),u_flood_light_color:new n.bL(c),u_vertical_scale:new n.bM(c),u_flood_light_intensity:new n.bM(c),u_ground_shadow_factor:new n.bL(c)}),fillExtrusionDepth:c=>({u_matrix:new n.bJ(c),u_edge_radius:new n.bM(c),u_width_scale:new n.bM(c),u_vertical_scale:new n.bM(c),u_height_type:new n.bN(c),u_base_type:new n.bN(c)}),fillExtrusionPattern:c=>({u_matrix:new n.bJ(c),u_lightpos:new n.bL(c),u_lightintensity:new n.bM(c),u_lightcolor:new n.bL(c),u_vertical_gradient:new n.bM(c),u_height_factor:new n.bM(c),u_edge_radius:new n.bM(c),u_width_scale:new n.bM(c),u_ao:new n.bK(c),u_height_type:new n.bN(c),u_base_type:new n.bN(c),u_tile_id:new n.bL(c),u_zoom_transition:new n.bM(c),u_inv_rot_matrix:new n.bJ(c),u_merc_center:new n.bK(c),u_up_dir:new n.bL(c),u_height_lift:new n.bM(c),u_image:new n.bN(c),u_texsize:new n.bK(c),u_pixel_coord_upper:new n.bK(c),u_pixel_coord_lower:new n.bK(c),u_tile_units_to_pixels:new n.bM(c),u_opacity:new n.bM(c)}),fillExtrusionGroundEffect:c=>({u_matrix:new n.bJ(c),u_opacity:new n.bM(c),u_ao_pass:new n.bM(c),u_meter_to_tile:new n.bM(c),u_ao:new n.bK(c),u_flood_light_intensity:new n.bM(c),u_flood_light_color:new n.bL(c),u_attenuation:new n.bM(c),u_edge_radius:new n.bM(c),u_fb:new n.bN(c),u_fb_size:new n.bM(c),u_dynamic_offset:new n.bM(c)}),fill:c=>({u_matrix:new n.bJ(c),u_emissive_strength:new n.bM(c)}),fillPattern:c=>({u_matrix:new n.bJ(c),u_emissive_strength:new n.bM(c),u_image:new n.bN(c),u_texsize:new n.bK(c),u_pixel_coord_upper:new n.bK(c),u_pixel_coord_lower:new n.bK(c),u_tile_units_to_pixels:new n.bM(c)}),fillOutline:c=>({u_matrix:new n.bJ(c),u_emissive_strength:new n.bM(c),u_world:new n.bK(c)}),fillOutlinePattern:c=>({u_matrix:new n.bJ(c),u_emissive_strength:new n.bM(c),u_world:new n.bK(c),u_image:new n.bN(c),u_texsize:new n.bK(c),u_pixel_coord_upper:new n.bK(c),u_pixel_coord_lower:new n.bK(c),u_tile_units_to_pixels:new n.bM(c)}),circle:n.cS,collisionBox:c=>({u_matrix:new n.bJ(c),u_camera_to_center_distance:new n.bM(c),u_extrude_scale:new n.bK(c)}),collisionCircle:c=>({u_matrix:new n.bJ(c),u_inv_matrix:new n.bJ(c),u_camera_to_center_distance:new n.bM(c),u_viewport_size:new n.bK(c)}),debug:c=>({u_color:new n.cz(c),u_matrix:new n.bJ(c),u_overlay:new n.bN(c),u_overlay_scale:new n.bM(c)}),clippingMask:c=>({u_matrix:new n.bJ(c)}),heatmap:c=>({u_extrude_scale:new n.bM(c),u_intensity:new n.bM(c),u_matrix:new n.bJ(c),u_inv_rot_matrix:new n.bJ(c),u_merc_center:new n.bK(c),u_tile_id:new n.bL(c),u_zoom_transition:new n.bM(c),u_up_dir:new n.bL(c)}),heatmapTexture:c=>({u_image:new n.bN(c),u_color_ramp:new n.bN(c),u_opacity:new n.bM(c)}),hillshade:c=>({u_matrix:new n.bJ(c),u_image:new n.bN(c),u_latrange:new n.bK(c),u_light:new n.bK(c),u_shadow:new n.cz(c),u_highlight:new n.cz(c),u_emissive_strength:new n.bM(c),u_accent:new n.cz(c)}),hillshadePrepare:c=>({u_matrix:new n.bJ(c),u_image:new n.bN(c),u_dimension:new n.bK(c),u_zoom:new n.bM(c)}),line:n.cT,linePattern:n.cU,raster:c=>({u_matrix:new n.bJ(c),u_normalize_matrix:new n.bJ(c),u_globe_matrix:new n.bJ(c),u_merc_matrix:new n.bJ(c),u_grid_matrix:new n.cA(c),u_tl_parent:new n.bK(c),u_scale_parent:new n.bM(c),u_fade_t:new n.bM(c),u_opacity:new n.bM(c),u_image0:new n.bN(c),u_image1:new n.bN(c),u_brightness_low:new n.bM(c),u_brightness_high:new n.bM(c),u_saturation_factor:new n.bM(c),u_contrast_factor:new n.bM(c),u_spin_weights:new n.bL(c),u_perspective_transform:new n.bK(c),u_raster_elevation:new n.bM(c),u_zoom_transition:new n.bM(c),u_merc_center:new n.bK(c),u_cutoff_params:new n.ca(c),u_colorization_mix:new n.ca(c),u_colorization_offset:new n.bM(c),u_color_ramp:new n.bN(c),u_texture_offset:new n.bK(c),u_texture_res:new n.bK(c),u_emissive_strength:new n.bM(c)}),rasterParticle:c=>({u_matrix:new n.bJ(c),u_normalize_matrix:new n.bJ(c),u_globe_matrix:new n.bJ(c),u_merc_matrix:new n.bJ(c),u_grid_matrix:new n.cA(c),u_tl_parent:new n.bK(c),u_scale_parent:new n.bM(c),u_fade_t:new n.bM(c),u_opacity:new n.bM(c),u_image0:new n.bN(c),u_image1:new n.bN(c),u_raster_elevation:new n.bM(c),u_zoom_transition:new n.bM(c),u_merc_center:new n.bK(c),u_cutoff_params:new n.ca(c)}),rasterParticleTexture:c=>({u_texture:new n.bN(c),u_opacity:new n.bM(c)}),rasterParticleDraw:c=>({u_particle_texture:new n.bN(c),u_particle_texture_side_len:new n.bM(c),u_tile_offset:new n.bK(c),u_velocity:new n.bN(c),u_color_ramp:new n.bN(c),u_velocity_res:new n.bK(c),u_max_speed:new n.bM(c),u_uv_offset:new n.bK(c),u_data_scale:new n.bK(c),u_data_offset:new n.bM(c),u_particle_pos_scale:new n.bM(c),u_particle_pos_offset:new n.bK(c)}),rasterParticleUpdate:c=>({u_particle_texture:new n.bN(c),u_particle_texture_side_len:new n.bM(c),u_velocity:new n.bN(c),u_velocity_res:new n.bK(c),u_max_speed:new n.bM(c),u_speed_factor:new n.bM(c),u_reset_rate:new n.bM(c),u_rand_seed:new n.bM(c),u_uv_offset:new n.bK(c),u_data_scale:new n.bK(c),u_data_offset:new n.bM(c),u_particle_pos_scale:new n.bM(c),u_particle_pos_offset:new n.bK(c)}),symbol:c=>({u_is_size_zoom_constant:new n.bN(c),u_is_size_feature_constant:new n.bN(c),u_size_t:new n.bM(c),u_size:new n.bM(c),u_camera_to_center_distance:new n.bM(c),u_rotate_symbol:new n.bN(c),u_aspect_ratio:new n.bM(c),u_fade_change:new n.bM(c),u_matrix:new n.bJ(c),u_label_plane_matrix:new n.bJ(c),u_coord_matrix:new n.bJ(c),u_is_text:new n.bN(c),u_elevation_from_sea:new n.bN(c),u_pitch_with_map:new n.bN(c),u_texsize:new n.bK(c),u_texsize_icon:new n.bK(c),u_texture:new n.bN(c),u_texture_icon:new n.bN(c),u_gamma_scale:new n.bM(c),u_device_pixel_ratio:new n.bM(c),u_tile_id:new n.bL(c),u_zoom_transition:new n.bM(c),u_inv_rot_matrix:new n.bJ(c),u_merc_center:new n.bK(c),u_camera_forward:new n.bL(c),u_tile_matrix:new n.bJ(c),u_up_vector:new n.bL(c),u_ecef_origin:new n.bL(c),u_is_halo:new n.bN(c),u_icon_transition:new n.bM(c),u_color_adj_mat:new n.bJ(c),u_scale_factor:new n.bM(c)}),background:c=>({u_matrix:new n.bJ(c),u_emissive_strength:new n.bM(c),u_opacity:new n.bM(c),u_color:new n.cz(c)}),backgroundPattern:c=>({u_matrix:new n.bJ(c),u_emissive_strength:new n.bM(c),u_opacity:new n.bM(c),u_image:new n.bN(c),u_pattern_tl:new n.bK(c),u_pattern_br:new n.bK(c),u_texsize:new n.bK(c),u_pattern_size:new n.bK(c),u_pixel_coord_upper:new n.bK(c),u_pixel_coord_lower:new n.bK(c),u_pattern_units_to_pixels:new n.bK(c)}),terrainRaster:c=>({u_matrix:new n.bJ(c),u_image0:new n.bN(c),u_skirt_height:new n.bM(c),u_ground_shadow_factor:new n.bL(c)}),skybox:c=>({u_matrix:new n.bJ(c),u_sun_direction:new n.bL(c),u_cubemap:new n.bN(c),u_opacity:new n.bM(c),u_temporal_offset:new n.bM(c)}),skyboxGradient:c=>({u_matrix:new n.bJ(c),u_color_ramp:new n.bN(c),u_center_direction:new n.bL(c),u_radius:new n.bM(c),u_opacity:new n.bM(c),u_temporal_offset:new n.bM(c)}),skyboxCapture:c=>({u_matrix_3f:new n.cA(c),u_sun_direction:new n.bL(c),u_sun_intensity:new n.bM(c),u_color_tint_r:new n.ca(c),u_color_tint_m:new n.ca(c),u_luminance:new n.bM(c)}),globeRaster:c=>({u_proj_matrix:new n.bJ(c),u_globe_matrix:new n.bJ(c),u_normalize_matrix:new n.bJ(c),u_merc_matrix:new n.bJ(c),u_zoom_transition:new n.bM(c),u_merc_center:new n.bK(c),u_image0:new n.bN(c),u_grid_matrix:new n.cA(c),u_skirt_height:new n.bM(c),u_far_z_cutoff:new n.bM(c),u_frustum_tl:new n.bL(c),u_frustum_tr:new n.bL(c),u_frustum_br:new n.bL(c),u_frustum_bl:new n.bL(c),u_globe_pos:new n.bL(c),u_globe_radius:new n.bM(c),u_viewport:new n.bK(c)}),globeAtmosphere:c=>({u_frustum_tl:new n.bL(c),u_frustum_tr:new n.bL(c),u_frustum_br:new n.bL(c),u_frustum_bl:new n.bL(c),u_horizon:new n.bM(c),u_transition:new n.bM(c),u_fadeout_range:new n.bM(c),u_color:new n.ca(c),u_high_color:new n.ca(c),u_space_color:new n.ca(c),u_temporal_offset:new n.bM(c),u_horizon_angle:new n.bM(c)}),model:c=>({u_matrix:new n.bJ(c),u_lighting_matrix:new n.bJ(c),u_normal_matrix:new n.bJ(c),u_node_matrix:new n.bJ(c),u_lightpos:new n.bL(c),u_lightintensity:new n.bM(c),u_lightcolor:new n.bL(c),u_camera_pos:new n.bL(c),u_opacity:new n.bM(c),u_baseColorFactor:new n.ca(c),u_emissiveFactor:new n.ca(c),u_metallicFactor:new n.bM(c),u_roughnessFactor:new n.bM(c),u_baseTextureIsAlpha:new n.bN(c),u_alphaMask:new n.bN(c),u_alphaCutoff:new n.bM(c),u_baseColorTexture:new n.bN(c),u_metallicRoughnessTexture:new n.bN(c),u_normalTexture:new n.bN(c),u_occlusionTexture:new n.bN(c),u_emissionTexture:new n.bN(c),u_lutTexture:new n.bN(c),u_color_mix:new n.ca(c),u_aoIntensity:new n.bM(c),u_emissive_strength:new n.bM(c),u_occlusionTextureTransform:new n.ca(c)}),modelDepth:c=>({u_matrix:new n.bJ(c),u_instance:new n.bJ(c),u_node_matrix:new n.bJ(c)}),groundShadow:c=>({u_matrix:new n.bJ(c),u_ground_shadow_factor:new n.bL(c)}),stars:c=>({u_matrix:new n.bJ(c),u_up:new n.bL(c),u_right:new n.bL(c),u_intensity_multiplier:new n.bM(c)}),snowParticle:c=>({u_modelview:new n.bJ(c),u_projection:new n.bJ(c),u_time:new n.bM(c),u_cam_pos:new n.bL(c),u_velocityConeAperture:new n.bM(c),u_velocity:new n.bM(c),u_horizontalOscillationRadius:new n.bM(c),u_horizontalOscillationRate:new n.bM(c),u_boxSize:new n.bM(c),u_billboardSize:new n.bM(c),u_simpleShapeParameters:new n.bK(c),u_screenSize:new n.bK(c),u_thinningCenterPos:new n.bK(c),u_thinningShape:new n.bL(c),u_thinningAffectedRatio:new n.bM(c),u_thinningParticleOffset:new n.bM(c),u_particleColor:new n.ca(c),u_direction:new n.bL(c)}),rainParticle:c=>({u_modelview:new n.bJ(c),u_projection:new n.bJ(c),u_time:new n.bM(c),u_cam_pos:new n.bL(c),u_texScreen:new n.bN(c),u_velocityConeAperture:new n.bM(c),u_velocity:new n.bM(c),u_boxSize:new n.bM(c),u_rainDropletSize:new n.bK(c),u_distortionStrength:new n.bM(c),u_rainDirection:new n.bL(c),u_color:new n.ca(c),u_screenSize:new n.bK(c),u_thinningCenterPos:new n.bK(c),u_thinningShape:new n.bL(c),u_thinningAffectedRatio:new n.bM(c),u_thinningParticleOffset:new n.bM(c),u_shapeDirectionalPower:new n.bM(c),u_shapeNormalPower:new n.bM(c),u_mode:new n.bM(c)}),vignette:c=>({u_vignetteShape:new n.bL(c),u_vignetteColor:new n.ca(c)}),occlusion:c=>({u_matrix:new n.bJ(c),u_anchorPos:new n.bL(c),u_screenSizePx:new n.bK(c),u_occluderSizePx:new n.bK(c),u_color:new n.ca(c)})};class Ts{constructor(t,r,u,p){this.id=Ts.uniqueIdxCounter,Ts.uniqueIdxCounter++,this.context=t;const _=t.gl;this.buffer=_.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||p||r.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=Ts.uniqueIdxCounter,Ts.uniqueIdxCounter++;const r=this.context.gl;this.context.unbindVAO(),this.bind(),r.bufferSubData(r.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Ts.uniqueIdxCounter=0;const Da={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class jo{constructor(t,r,u,p,_,b){this.length=r.length,this.attributes=u,this.itemSize=r.bytesPerElement,this.dynamicDraw=p,this.instanceCount=b,this.context=t;const C=t.gl;this.buffer=C.createBuffer(),t.bindVertexBuffer.set(this.buffer),C.bufferData(C.ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||_||r.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const r=this.context.gl;this.bind(),r.bufferSubData(r.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,r){for(let u=0;u<this.attributes.length;u++){const p=r.attributes[this.attributes[u].name];p!==void 0&&t.enableVertexAttribArray(p)}}setVertexAttribPointers(t,r,u){for(let p=0;p<this.attributes.length;p++){const _=this.attributes[p],b=r.attributes[_.name];b!==void 0&&t.vertexAttribPointer(b,_.components,t[Da[_.type]],!1,this.itemSize,_.offset+this.itemSize*(u||0))}}setVertexAttribDivisor(t,r,u){for(let p=0;p<this.attributes.length;p++){const _=r.attributes[this.attributes[p].name];_!==void 0&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(_,u)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class pd{constructor(t,r,u,p,_){this.context=t,this.width=r,this.height=u;const b=this.framebuffer=t.gl.createFramebuffer();p&&(this.colorAttachment=new ko(t,b)),_&&(this.depthAttachmentType=_,this.depthAttachment=_==="renderbuffer"?new ac(t,b):new Ju(t,b))}destroy(){const t=this.context.gl;if(this.colorAttachment){const r=this.colorAttachment.get();r&&t.deleteTexture(r)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const r=this.depthAttachment.get();r&&t.deleteRenderbuffer(r)}else{const r=this.depthAttachment.get();r&&t.deleteTexture(r)}t.deleteFramebuffer(this.framebuffer)}}class ah{constructor(t,r){this.gl=t,this.clearColor=new Xc(this),this.clearDepth=new Ba(this),this.clearStencil=new Na(this),this.colorMask=new Po(this),this.depthMask=new oo(this),this.stencilMask=new lo(this),this.stencilFunc=new rc(this),this.stencilOp=new Yc(this),this.stencilTest=new nc(this),this.depthRange=new Kh(this),this.depthTest=new Zr(this),this.depthFunc=new Zn(this),this.blend=new Mr(this),this.blendFunc=new Va(this),this.blendColor=new bs(this),this.blendEquation=new Qu(this),this.cullFace=new co(this),this.cullFaceSide=new Jh(this),this.frontFace=new ef(this),this.program=new ml(this),this.activeTexture=new Wc(this),this.viewport=new $c(this),this.bindFramebuffer=new uo(this),this.bindRenderbuffer=new mp(this),this.bindTexture=new fd(this),this.bindVertexBuffer=new _p(this),this.bindElementBuffer=new tf(this),this.bindVertexArrayOES=new gp(this),this.pixelStoreUnpack=new Ku(this),this.pixelStoreUnpackPremultiplyAlpha=new rf(this),this.pixelStoreUnpackFlipY=new _l(this),this.options=r?Object.assign({},r):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=r&&!!r.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxPointSize=t.getParameter(t.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,r,u){return new Ts(this,t,r,u)}createVertexBuffer(t,r,u,p,_){return new jo(this,t,r,u,p,_)}createRenderbuffer(t,r,u){const p=this.gl,_=p.createRenderbuffer();return this.bindRenderbuffer.set(_),p.renderbufferStorage(p.RENDERBUFFER,t,r,u),this.bindRenderbuffer.set(null),_}createFramebuffer(t,r,u,p){return new pd(this,t,r,u,p)}clear({color:t,depth:r,stencil:u,colorMask:p}){const _=this.gl;let b=0;t&&(b|=_.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set(p||[!0,!0,!0,!0])),r!==void 0&&(b|=_.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(r),this.depthMask.set(!0)),u!==void 0&&(b|=_.STENCIL_BUFFER_BIT,this.clearStencil.set(u),this.stencilMask.set(255)),_.clear(b)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){n.bn(t.blendFunction,Ui.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let bl;function au(c,t,r,u,p,_,b){const C=c.context,O=C.gl,P=c.transform,F=c.getOrCreateProgram("collisionBox"),V=[];let U=0,H=0;for(let fe=0;fe<u.length;fe++){const be=u[fe],me=t.getTile(be),ve=me.getBucket(r);if(!ve)continue;const _e=Ns(be,ve,P);let Ee=_e;p[0]===0&&p[1]===0||(Ee=c.translatePosMatrix(_e,me,p,_));const ze=b?ve.textCollisionBox:ve.iconCollisionBox,Ye=ve.collisionCircleArray;if(Ye.length>0){const qe=n.ab.mat4.create(),lt=Ee;n.ab.mat4.mul(qe,ve.placementInvProjMatrix,P.glCoordMatrix),n.ab.mat4.mul(qe,qe,ve.placementViewportMatrix),V.push({circleArray:Ye,circleOffset:H,transform:lt,invTransform:qe,projection:ve.getProjection()}),U+=Ye.length/4,H=U}ze&&(c.terrain&&c.terrain.setupElevationDraw(me,F),F.draw(c,O.LINES,ci.disabled,vi.disabled,c.colorModeForRenderPass(),yi.disabled,xp(Ee,P,me,ve.getProjection()),r.id,ze.layoutVertexBuffer,ze.indexBuffer,ze.segments,null,P.zoom,null,[ze.collisionVertexBuffer,ze.collisionVertexBufferExt]))}if(!b||!V.length)return;const J=c.getOrCreateProgram("collisionCircle"),$=new n.cV;$.resize(4*U),$._trim();let te=0;for(const fe of V)for(let be=0;be<fe.circleArray.length/4;be++){const me=4*be,ve=fe.circleArray[me+0],_e=fe.circleArray[me+1],Ee=fe.circleArray[me+2],ze=fe.circleArray[me+3];$.emplace(te++,ve,_e,Ee,ze,0),$.emplace(te++,ve,_e,Ee,ze,1),$.emplace(te++,ve,_e,Ee,ze,2),$.emplace(te++,ve,_e,Ee,ze,3)}(!bl||bl.length<2*U)&&(bl=function(fe){const be=2*fe,me=new n.aU;me.resize(be),me._trim();for(let ve=0;ve<be;ve++){const _e=6*ve;me.uint16[_e+0]=4*ve+0,me.uint16[_e+1]=4*ve+1,me.uint16[_e+2]=4*ve+2,me.uint16[_e+3]=4*ve+2,me.uint16[_e+4]=4*ve+3,me.uint16[_e+5]=4*ve+0}return me}(U));const ee=C.createIndexBuffer(bl,!0),le=C.createVertexBuffer($,n.cW.members,!0);for(const fe of V){const be={u_matrix:fe.transform,u_inv_matrix:fe.invTransform,u_camera_to_center_distance:(pe=P).getCameraToCenterDistance(fe.projection),u_viewport_size:[pe.width,pe.height]};J.draw(c,O.TRIANGLES,ci.disabled,vi.disabled,c.colorModeForRenderPass(),yi.disabled,be,r.id,le,ee,n.b7.simpleSegment(0,2*fe.circleOffset,fe.circleArray.length,fe.circleArray.length/2),null,P.zoom)}var pe;le.destroy(),ee.destroy()}const na=n.ab.mat4.create();function Pr(c){const t=c._camera.getWorldToCamera(c.worldSize,1),r=n.ab.mat4.multiply([],t,c.globeMatrix);n.ab.mat4.invert(r,r);const u=[0,0,0],p=[0,1,0,0];return n.ab.vec4.transformMat4(p,p,r),u[0]=p[0],u[1]=p[1],u[2]=p[2],n.ab.vec3.normalize(u,u),u}function wr({width:c,height:t,anchor:r,textOffset:u,textScale:p},_){const{horizontalAlign:b,verticalAlign:C}=n.bD(r),O=-(b-.5)*c,P=-(C-.5)*t,F=n.bC(r,u);return new n.P((O/p+F[0])*_,(P/p+F[1])*_)}function wl(c,t,r,u,p,_,b,C,O,P,F){const V=c.text.placedSymbolArray,U=c.text.dynamicLayoutVertexArray,H=c.icon.dynamicLayoutVertexArray,J={},$=c.getProjection(),te=rl(C,$,_),ee=_.elevation,le=$.upVectorScale(C.canonical,_.center.lat,_.worldSize).metersToTile;U.clear();for(let pe=0;pe<V.length;pe++){const fe=V.get(pe),{tileAnchorX:be,tileAnchorY:me,numGlyphs:ve}=fe,_e=fe.hidden||!fe.crossTileID||c.allowVerticalPlacement&&!fe.placedOrientation?null:u[fe.crossTileID];if(_e){let Ee=0,ze=0,Ye=0;if(ee){const Je=ee?ee.getAtTileOffset(C,be,me):0,[St,dt,ct]=$.upVector(C.canonical,be,me);Ee=Je*St*le,ze=Je*dt*le,Ye=Je*ct*le}let[qe,lt,it,Be]=jn(fe.projectedAnchorX+Ee,fe.projectedAnchorY+ze,fe.projectedAnchorZ+Ye,r?te:b);const Ke=qh(_.getCameraToCenterDistance($),Be);let gt=p.evaluateSizeForFeature(c.textSizeData,P,fe)*Ke/n.bw;r&&(gt*=c.tilePixelRatio/O);const Fe=wr(_e,gt);r?({x:qe,y:lt,z:it}=$.projectTilePoint(be+Fe.x,me+Fe.y,C.canonical),[qe,lt,it]=jn(qe+Ee,lt+ze,it+Ye,b)):(t&&Fe._rotate(-_.angle),qe+=Fe.x,lt+=Fe.y,it=0);const st=c.allowVerticalPlacement&&fe.placedOrientation===n.bq.vertical?Math.PI/2:0;for(let Je=0;Je<ve;Je++)n.bt(U,qe,lt,it,st);F&&fe.associatedIconIndex>=0&&(J[fe.associatedIconIndex]={x:qe,y:lt,z:it,angle:st})}else Hr(ve,U)}if(F){H.clear();const pe=c.icon.placedSymbolArray;for(let fe=0;fe<pe.length;fe++){const be=pe.get(fe),{numGlyphs:me}=be,ve=J[fe];if(be.hidden||!ve)Hr(me,H);else{const{x:_e,y:Ee,z:ze,angle:Ye}=ve;for(let qe=0;qe<me;qe++)n.bt(H,_e,Ee,ze,Ye)}}c.icon.dynamicLayoutVertexBuffer.updateData(H)}c.text.dynamicLayoutVertexBuffer.updateData(U)}function Tl(c,t,r,u,p,_,b={}){const C=r.paint.get("icon-translate"),O=r.paint.get("text-translate"),P=r.paint.get("icon-translate-anchor"),F=r.paint.get("text-translate-anchor"),V=r.layout.get("icon-rotation-alignment"),U=r.layout.get("text-rotation-alignment"),H=r.layout.get("icon-pitch-alignment"),J=r.layout.get("text-pitch-alignment"),$=r.layout.get("icon-keep-upright"),te=r.layout.get("text-keep-upright"),ee=r.paint.get("icon-color-saturation"),le=r.paint.get("icon-color-contrast"),pe=r.paint.get("icon-color-brightness-min"),fe=r.paint.get("icon-color-brightness-max"),be=r.layout.get("symbol-elevation-reference")==="sea",me=c.context,ve=me.gl,_e=c.transform,Ee=V==="map",ze=U==="map",Ye=H==="map",qe=J==="map",lt=r.layout.get("symbol-sort-key").constantOr(1)!==void 0;let it=!1;const Be=c.depthModeForSublayer(0,ci.ReadOnly),Ke=[n.at(_e.center.lng),n.aA(_e.center.lat)],gt=r.layout.get("text-variable-anchor"),Fe=_e.projection.name==="globe",st=[],Je=[0,-1,0];for(const St of u){const dt=t.getTile(St),ct=dt.getBucket(r);if(!ct||ct.projection.name==="mercator"&&Fe||ct.fullyClipped)continue;const vt=ct.projection.name==="globe",Ct=vt?n.ae(_e.zoom):0,Vt=rl(St,ct.getProjection(),_e),Yt=_e.calculatePixelsToTileUnitsMatrix(dt),ui=gt&&ct.hasTextData(),oi=ct.hasIconTextFit()&&ui&&ct.hasIconData(),ri=ct.getProjection().createInversionMatrix(_e,St.canonical),xi=hi=>{_e.depthOcclusionForSymbolsAndCircles&&(r.hasInitialOcclusionOpacityProperties||c.terrain)&&(hi.push("DEPTH_D24"),hi.push("DEPTH_OCCLUSION"))},bi=()=>{const hi=Ee&&r.layout.get("symbol-placement")!=="point",_i=[];xi(_i);const Zi=hi||oi,Ir=r.paint.get("icon-image-cross-fade").constantOr(0);c.terrainRenderModeElevated()&&Ye&&_i.push("PITCH_WITH_MAP_TERRAIN"),vt&&(_i.push("PROJECTION_GLOBE_VIEW"),Zi&&_i.push("PROJECTED_POS_ON_VIEWPORT")),Ir>0&&_i.push("ICON_TRANSITION"),ct.icon.zOffsetVertexBuffer&&_i.push("Z_OFFSET"),ee===0&&le===0&&pe===0&&fe===1||_i.push("COLOR_ADJUSTMENT"),ct.sdfIcons&&_i.push("RENDER_SDF");const Fr=ct.icon.programConfigurations.get(r.id),Wr=c.getOrCreateProgram("symbol",{config:Fr,defines:_i}),Oa=dt.imageAtlasTexture?dt.imageAtlasTexture.size:[0,0],sn=ct.iconSizeData,Ji=n.bp(sn,_e.zoom),fr=Ye||_e.pitch!==0,hr=Or(Vt,dt.tileID.canonical,Ye,Ee,_e,ct.getProjection(),Yt),Qi=Nc(Vt,dt.tileID.canonical,Ye,Ee,_e,ct.getProjection(),Yt),Sr=c.translatePosMatrix(Qi,dt,C,P,!0),en=c.translatePosMatrix(Vt,dt,C,P),mr=Zi?na:hr,tn=Ee&&!Ye&&!hi;let Ha=Je;!Fe&&!_e.mercatorFromTransition||Ee||(Ha=Pr(_e));const xa=vt?Ha:Je,oa=r.getColorAdjustmentMatrix(ee,le,pe,fe),as=Uo(sn.kind,Ji,tn,Ye,c,en,mr,Sr,be,!1,Oa,[0,0],!0,St,Ct,Ke,ri,xa,ct.getProjection(),oa,Ir),$n=dt.imageAtlasTexture?dt.imageAtlasTexture:null,ba=r.layout.get("icon-size").constantOr(0)!==1||ct.iconsNeedLinear,ss=ct.sdfIcons||c.options.rotating||c.options.zooming||ba||fr?ve.LINEAR:ve.NEAREST,Za=ct.sdfIcons&&r.paint.get("icon-halo-width").constantOr(1)!==0,Yo=c.terrain&&Ye&&hi?n.ab.mat4.invert(n.ab.mat4.create(),hr):na;if(hi&&ct.icon){const Pl=_e.elevation,kl=Pl?Pl.getAtTileOffsetFunc(St,_e.center.lat,_e.worldSize,ct.getProjection()):null,bh=Lr(Vt,dt.tileID.canonical,Ye,Ee,_e,ct.getProjection(),Yt);Vc(ct,Vt,c,!1,bh,Qi,Ye,$,kl,St)}return{program:Wr,buffers:ct.icon,uniformValues:as,atlasTexture:$n,atlasTextureIcon:null,atlasInterpolation:ss,atlasInterpolationIcon:null,isSDF:ct.sdfIcons,hasHalo:Za,tile:dt,labelPlaneMatrixInv:Yo}},pr=()=>{const hi=ze&&r.layout.get("symbol-placement")!=="point",_i=[],Zi=hi||gt||oi;c.terrainRenderModeElevated()&&qe&&_i.push("PITCH_WITH_MAP_TERRAIN"),vt&&(_i.push("PROJECTION_GLOBE_VIEW"),Zi&&_i.push("PROJECTED_POS_ON_VIEWPORT")),ct.text.zOffsetVertexBuffer&&_i.push("Z_OFFSET"),ct.iconsInText&&_i.push("RENDER_TEXT_AND_SYMBOL"),_i.push("RENDER_SDF"),xi(_i);const Ir=ct.text.programConfigurations.get(r.id),Fr=c.getOrCreateProgram("symbol",{config:Ir,defines:_i});let Wr,Oa=[0,0],sn=null;const Ji=ct.textSizeData;ct.iconsInText&&(Oa=dt.imageAtlasTexture?dt.imageAtlasTexture.size:[0,0],sn=dt.imageAtlasTexture?dt.imageAtlasTexture:null,Wr=qe||_e.pitch!==0||c.options.rotating||c.options.zooming||Ji.kind==="composite"||Ji.kind==="camera"?ve.LINEAR:ve.NEAREST);const fr=dt.glyphAtlasTexture?dt.glyphAtlasTexture.size:[0,0],hr=r.layout.get("text-size-scale-range"),Qi=n.aw(c.scaleFactor,hr[0],hr[1]),Sr=n.bp(Ji,_e.zoom,Qi),en=Or(Vt,dt.tileID.canonical,qe,ze,_e,ct.getProjection(),Yt),mr=Nc(Vt,dt.tileID.canonical,qe,ze,_e,ct.getProjection(),Yt),tn=c.translatePosMatrix(mr,dt,O,F,!0),Ha=c.translatePosMatrix(Vt,dt,O,F),xa=Zi?na:en,oa=ze&&!qe&&!hi;let as=Je;!Fe&&!_e.mercatorFromTransition||ze||(as=Pr(_e));const $n=Uo(Ji.kind,Sr,oa,qe,c,Ha,xa,tn,be,!0,fr,Oa,!0,St,Ct,Ke,ri,vt?as:Je,ct.getProjection(),null,null,Qi),ba=dt.glyphAtlasTexture?dt.glyphAtlasTexture:null,ss=ve.LINEAR,Za=r.paint.get("text-halo-width").constantOr(1)!==0,Yo=c.terrain&&qe&&hi?n.ab.mat4.invert(n.ab.mat4.create(),en):na;if(hi&&ct.text){const Pl=_e.elevation,kl=Pl?Pl.getAtTileOffsetFunc(St,_e.center.lat,_e.worldSize,ct.getProjection()):null,bh=Lr(Vt,dt.tileID.canonical,qe,ze,_e,ct.getProjection(),Yt);Vc(ct,Vt,c,!0,bh,mr,qe,te,kl,St)}return{program:Fr,buffers:ct.text,uniformValues:$n,atlasTexture:ba,atlasTextureIcon:sn,atlasInterpolation:ss,atlasInterpolationIcon:Wr,isSDF:!0,hasHalo:Za,tile:dt,labelPlaneMatrixInv:Yo}},Yr=ct.icon.segments.get().length,Cr=ct.text.segments.get().length,Ai=Yr&&!b.onlyText?bi():null,rr=Cr&&!b.onlyIcons?pr():null,Ut=r.paint.get("icon-opacity").constantOr(1),mi=r.paint.get("text-opacity").constantOr(1);if(lt&&ct.canOverlap){it=!0;const hi=Ut&&!b.onlyText?ct.icon.segments.get():[],_i=mi&&!b.onlyIcons?ct.text.segments.get():[];for(const Zi of hi)st.push({segments:new n.b7([Zi]),sortKey:Zi.sortKey,state:Ai});for(const Zi of _i)st.push({segments:new n.b7([Zi]),sortKey:Zi.sortKey,state:rr})}else b.onlyText||st.push({segments:Ut?ct.icon.segments:new n.b7([]),sortKey:0,state:Ai}),b.onlyIcons||st.push({segments:mi?ct.text.segments:new n.b7([]),sortKey:0,state:rr})}it&&st.sort((St,dt)=>St.sortKey-dt.sortKey);for(const St of st){const dt=St.state;if(dt)if(c.terrain?c.terrain.setupElevationDraw(dt.tile,dt.program,{useDepthForOcclusion:_e.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:dt.labelPlaneMatrixInv}):c.setupDepthForOcclusion(_e.depthOcclusionForSymbolsAndCircles,dt.program),me.activeTexture.set(ve.TEXTURE0),dt.atlasTexture&&dt.atlasTexture.bind(dt.atlasInterpolation,ve.CLAMP_TO_EDGE,!0),dt.atlasTextureIcon&&(me.activeTexture.set(ve.TEXTURE1),dt.atlasTextureIcon&&dt.atlasTextureIcon.bind(dt.atlasInterpolationIcon,ve.CLAMP_TO_EDGE,!0)),c.uploadCommonLightUniforms(c.context,dt.program),dt.hasHalo){const ct=dt.uniformValues;ct.u_is_halo=1,su(dt.buffers,St.segments,r,c,dt.program,Be,p,_,ct,2),ct.u_is_halo=0}else{if(dt.isSDF){const ct=dt.uniformValues;dt.hasHalo&&(ct.u_is_halo=1,su(dt.buffers,St.segments,r,c,dt.program,Be,p,_,ct,1)),ct.u_is_halo=0}su(dt.buffers,St.segments,r,c,dt.program,Be,p,_,dt.uniformValues,1)}}}function su(c,t,r,u,p,_,b,C,O,P){const F=[c.dynamicLayoutVertexBuffer,c.opacityVertexBuffer,c.iconTransitioningVertexBuffer,c.globeExtVertexBuffer,c.zOffsetVertexBuffer];p.draw(u,u.context.gl.TRIANGLES,_,b,C,yi.disabled,O,r.id,c.layoutVertexBuffer,c.indexBuffer,t,r.paint,u.transform.zoom,c.programConfigurations.get(r.id),F,P)}function qs(c,t,r,u,p,_,b){const C=c.context.gl,O=r.paint.get("fill-pattern"),P=r.is3D(),F=P?c.stencilModeFor3D():vi.disabled,V=O&&O.constantOr(1);let U,H,J,$,te;b?(H=V&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",U=C.LINES):(H=V?"fillPattern":"fill",U=C.TRIANGLES);for(const ee of u){const le=t.getTile(ee);if(V&&!le.patternsLoaded())continue;const pe=le.getBucket(r);if(!pe)continue;c.prepareDrawTile();const fe=pe.programConfigurations.get(r.id),be=c.isTileAffectedByFog(ee),me=c.getOrCreateProgram(H,{config:fe,overrideFog:be});V&&(c.context.activeTexture.set(C.TEXTURE0),le.imageAtlasTexture&&le.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),fe.updatePaintBuffers());const ve=O.constantOr(null);if(ve&&le.imageAtlas){const ze=le.imageAtlas,Ye=n.A.from(ve).getPrimary().scaleSelf(n.q.devicePixelRatio).serialize(),qe=ze.patternPositions[Ye];qe&&fe.setConstantPatternPositions(qe)}const _e=c.translatePosMatrix(ee.projMatrix,le,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor")),Ee=r.paint.get("fill-emissive-strength");if(b){$=pe.indexBuffer2,te=pe.segments2;const ze=c.terrain&&c.terrain.renderingToTexture?c.terrain.drapeBufferSize:[C.drawingBufferWidth,C.drawingBufferHeight];J=H==="fillOutlinePattern"&&V?vp(_e,Ee,c,le,ze):vl(_e,Ee,ze)}else $=pe.indexBuffer,te=pe.segments,J=V?ho(_e,Ee,c,le):oc(_e,Ee);c.uploadCommonUniforms(c.context,me,ee.toUnwrapped()),me.draw(c,U,p,P?F:c.stencilModeForClipping(ee),_,yi.disabled,J,r.id,pe.layoutVertexBuffer,$,te,r.paint,c.transform.zoom,fe,void 0)}}function Sl(c,t,r,u,p,_,b,C){r.resetLayerRenderingStats(c);const O=c.context,P=O.gl,F=c.transform,V=r.paint.get("fill-extrusion-pattern"),U=V.constantOr(1),H=r.paint.get("fill-extrusion-opacity"),J=c.style.enable3dLights(),$=r.paint.get(J&&!U?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),te=[r.paint.get("fill-extrusion-ambient-occlusion-intensity"),$],ee=r.layout.get("fill-extrusion-edge-radius"),le=ee>0&&!r.paint.get("fill-extrusion-rounded-roof"),pe=le?0:ee,fe=F.projection.name==="globe"?n.d3():0,be=F.projection.name==="globe",me=be?n.ae(F.zoom):0,ve=[n.at(F.center.lng),n.aA(F.center.lat)],_e=r.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Ee=r.paint.get("fill-extrusion-flood-light-color").toRenderColor(_e?null:r.lut).toArray01().slice(0,3),ze=r.paint.get("fill-extrusion-flood-light-intensity"),Ye=r.paint.get("fill-extrusion-vertical-scale"),qe=r.paint.get("fill-extrusion-line-width").constantOr(1)!==0,lt=r.paint.get("fill-extrusion-height-alignment"),it=r.paint.get("fill-extrusion-base-alignment"),Be=al(c,r.paint.get("fill-extrusion-cutoff-fade-range")),Ke=[];let gt;be&&Ke.push("PROJECTION_GLOBE_VIEW"),te[0]>0&&Ke.push("FAUX_AO"),le&&Ke.push("ZERO_ROOF_RADIUS"),C&&Ke.push("HAS_CENTROID"),ze>0&&Ke.push("FLOOD_LIGHT"),Be.shouldRenderCutoff&&Ke.push("RENDER_CUTOFF"),qe&&Ke.push("RENDER_WALL_MODE");const Fe=c.renderPass==="shadow",st=c.shadowRenderer,Je=Fe&&!!st;c.shadowRenderer&&(c.shadowRenderer.useNormalOffset=!0);let St=[0,0,0];if(st){const vt=c.style.directionalLight,Ct=c.style.ambientLight;vt&&Ct&&(St=Wh(c.style,vt,Ct)),Fe||(Ke.push("RENDER_SHADOWS","DEPTH_TEXTURE"),st.useNormalOffset&&Ke.push("NORMAL_OFFSET")),gt=Ke.concat(["SHADOWS_SINGLE_CASCADE"])}const dt=Je?"fillExtrusionDepth":U?"fillExtrusionPattern":"fillExtrusion",ct=r.getLayerRenderingStats();for(const vt of u){const Ct=t.getTile(vt),Vt=Ct.getBucket(r);if(!Vt||Vt.projection.name!==F.projection.name)continue;let Yt=!1;st&&(Yt=st.getMaxCascadeForTile(vt.toUnwrapped())===0);const ui=c.isTileAffectedByFog(vt),oi=Vt.programConfigurations.get(r.id),ri=c.getOrCreateProgram(dt,{config:oi,defines:Yt?gt:Ke,overrideFog:ui});if(c.terrain&&c.terrain.setupElevationDraw(Ct,ri,{useMeterToDem:!0}),!Vt.centroidVertexBuffer){const rr=ri.attributes.a_centroid_pos;rr!==void 0&&P.vertexAttrib2f(rr,0,0)}!Fe&&st&&st.setupShadows(Ct.tileID.toUnwrapped(),ri,"vector-tile",Ct.tileID.overscaledZ),U&&(c.context.activeTexture.set(P.TEXTURE0),Ct.imageAtlasTexture&&Ct.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),oi.updatePaintBuffers());const xi=V.constantOr(null);if(xi&&Ct.imageAtlas){const rr=Ct.imageAtlas,Ut=n.A.from(xi).getPrimary().scaleSelf(n.q.devicePixelRatio),mi=rr.patternPositions[Ut.serialize()];mi&&oi.setConstantPatternPositions(mi)}const bi=r.paint.get("fill-extrusion-vertical-gradient"),pr=1/Vt.tileToMeter;let Yr;if(Fe&&st){if(uc(Ct.tileID,Vt,c))continue;const rr=st.calculateShadowPassMatrixFromTile(Ct.tileID.toUnwrapped());Yr=Bo(rr,pe,pr,Ye,lt,it)}else{const rr=c.translatePosMatrix(vt.expandedProjMatrix,Ct,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),Ut=F.projection.createInversionMatrix(F,vt.canonical);Yr=U?tu(rr,c,bi,H,te,pe,pr,vt,Ct,fe,lt,it,me,ve,Ut,Ee,Ye):eu(rr,c,bi,H,te,pe,pr,vt,fe,lt,it,me,ve,Ut,Ee,Ye,ze,St)}c.uploadCommonUniforms(O,ri,vt.toUnwrapped(),null,Be);let Cr=Vt.segments;if(F.projection.name==="mercator"&&!Fe&&(Cr=Vt.getVisibleSegments(Ct.tileID,c.terrain,c.transform.getFrustum(0)),!Cr.get().length))continue;if(ct)if(Fe)for(const rr of Cr.get())ct.numRenderedVerticesInShadowPass+=rr.primitiveLength;else for(const rr of Cr.get())ct.numRenderedVerticesInTransparentPass+=rr.primitiveLength;const Ai=[];(c.terrain||C)&&Ai.push(Vt.centroidVertexBuffer),be&&Ai.push(Vt.layoutVertexExtBuffer),qe&&Ai.push(Vt.wallVertexBuffer),ri.draw(c,O.gl.TRIANGLES,p,_,b,yi.backCCW,Yr,r.id,Vt.layoutVertexBuffer,Vt.indexBuffer,Cr,r.paint,c.transform.zoom,oi,Ai)}c.shadowRenderer&&(c.shadowRenderer.useNormalOffset=!1)}function El(c,t,r,u,p,_,b,C,O,P,F,V,U,H,J,$,te,ee,le){const pe=c.context,fe=pe.gl,be=c.transform,me=c.transform.zoom,ve=[],_e=al(c,r.paint.get("fill-extrusion-cutoff-fade-range"));P==="clear"?(ve.push("CLEAR_SUBPASS"),le&&(ve.push("CLEAR_FROM_TEXTURE"),pe.activeTexture.set(fe.TEXTURE0),le.bind(fe.LINEAR,fe.CLAMP_TO_EDGE))):P==="sdf"&&ve.push("SDF_SUBPASS"),te&&ve.push("HAS_CENTROID"),_e.shouldRenderCutoff&&ve.push("RENDER_CUTOFF");const Ee=r.layout.get("fill-extrusion-edge-radius"),ze=(Ye,qe,lt,it,Be)=>{const Ke=qe.programConfigurations.get(r.id),gt=c.isTileAffectedByFog(Ye),Fe=c.getOrCreateProgram("fillExtrusionGroundEffect",{config:Ke,defines:ve,overrideFog:gt}),st=((St,dt,ct,vt,Ct,Vt,Yt,ui,oi,ri,xi)=>({u_matrix:dt,u_opacity:ct,u_ao_pass:vt?1:0,u_meter_to_tile:Ct,u_ao:Vt,u_flood_light_intensity:Yt,u_flood_light_color:ui,u_attenuation:oi,u_edge_radius:ri,u_fb:0,u_fb_size:xi,u_dynamic_offset:1}))(0,it,F,O,Be,[V,U*Be],H,J,$,me>=17?0:Ee*Be,le?le.size[0]:0),Je=[];te&&Je.push(qe.hiddenByLandmarkVertexBuffer),c.uploadCommonUniforms(pe,Fe,Ye.toUnwrapped(),null,_e),Fe.draw(c,pe.gl.TRIANGLES,p,_,b,C,st,r.id,qe.vertexBuffer,qe.indexBuffer,lt,r.paint,me,Ke,Je)};for(const Ye of u){const qe=t.getTile(Ye),lt=qe.getBucket(r);if(!lt||lt.projection.name!==be.projection.name||!lt.groundEffect||lt.groundEffect&&!lt.groundEffect.hasData())continue;const it=lt.groundEffect,Be=1/lt.tileToMeter;{const Ke=c.translatePosMatrix(Ye.projMatrix,qe,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),gt=it.getDefaultSegment();ze(Ye,it,gt,Ke,Be)}if(ee)for(let Ke=0;Ke<4;Ke++){const gt=n.d4[Ke](Ye),Fe=t.getTile(gt);if(!Fe)continue;const st=Fe.getBucket(r);if(!st||st.projection.name!==be.projection.name||!st.groundEffect||st.groundEffect&&!st.groundEffect.hasData())continue;const Je=st.groundEffect;let St,dt;Ke===0?(St=[-n.ag,0,0],dt=1):Ke===1?(St=[n.ag,0,0],dt=0):Ke===2?(St=[0,-n.ag,0],dt=3):(St=[0,n.ag,0],dt=2);const ct=Je.regionSegments[dt];if(!ct)continue;const vt=new Float32Array(16);n.ab.mat4.translate(vt,Ye.projMatrix,St),ze(Ye,Je,ct,c.translatePosMatrix(vt,qe,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),Be)}}}function Ml(c,t,r,u,p,_,b){u.centroidVertexArray.length===0&&u.createCentroidsBuffer();const C=_?_.findDEMTileFor(r):null;if(!(C&&C.dem||b))return;_&&C&&C.dem&&u.selfDEMTileTimestamp!==C.dem._timestamp&&(u.borderDoneWithNeighborZ=[-1,-1,-1,-1],u.selfDEMTileTimestamp=C.dem._timestamp);const O=ee=>new n.P(Math.ceil((ee+n.d7)*n.d8),0),P=ee=>{const le=t.getSource().minzoom,pe=be=>{const me=t.getTileByID(be);if(me&&me.hasData())return me.getBucket(p)},fe=[0,-1,1];for(const be of fe){if(ee.overscaledZ+be<le)continue;const me=pe(ee.calculateScaledKey(ee.overscaledZ+be));if(me)return me}},F=[0,0,0],V=(ee,le)=>(F[0]=Math.min(ee.min.y,le.min.y),F[1]=Math.max(ee.max.y,le.max.y),F[2]=n.ag-le.min.x>ee.max.x?le.min.x-n.ag:ee.max.x,F),U=(ee,le)=>(F[0]=Math.min(ee.min.x,le.min.x),F[1]=Math.max(ee.max.x,le.max.x),F[2]=n.ag-le.min.y>ee.max.y?le.min.y-n.ag:ee.max.y,F),H=[(ee,le)=>V(ee,le),(ee,le)=>V(le,ee),(ee,le)=>U(ee,le),(ee,le)=>U(le,ee)],J=(ee,le,pe,fe,be,me,ve)=>{if(!_)return 0;const _e=[[me?pe:ee,me?ee:pe,0],[me?pe:le,me?le:pe,0]],Ee=ve<0?n.ag+ve:ve,ze=[me?Ee:(ee+le)/2,me?(ee+le)/2:Ee,0];return pe===0&&ve<0||pe!==0&&ve>0?_.getForTilePoints(be,[ze],!0,fe):_e.push(ze),_.getForTilePoints(r,_e,!0,C),Math.max(_e[0][2],_e[1][2],ze[2])/_.exaggeration()};for(let ee=0;ee<4;ee++){const le=u.borderFeatureIndices[ee];if(le.length===0)continue;const pe=n.d4[ee](r),fe=P(pe);if(!(fe&&fe instanceof n.d5))continue;const be=_?_.findDEMTileFor(pe):null;if(!(be&&be.dem||b)||(_&&be&&be.dem&&u.borderDEMTileTimestamp[ee]!==be.dem._timestamp&&(u.borderDoneWithNeighborZ[ee]=-1,u.borderDEMTileTimestamp[ee]=be.dem._timestamp),u.borderDoneWithNeighborZ[ee]===fe.canonical.z))continue;fe.centroidVertexArray.length===0&&fe.createCentroidsBuffer();const me=(ee<2?1:5)-ee,ve=fe.borderDoneWithNeighborZ[me]!==u.canonical.z,_e=fe.borderFeatureIndices[me];let Ee=0;if(u.canonical.z!==fe.canonical.z){for(const ze of le)u.showCentroid(u.featuresOnBorder[ze]);if(ve)for(const ze of _e)fe.showCentroid(fe.featuresOnBorder[ze]);u.borderDoneWithNeighborZ[ee]=fe.canonical.z,fe.borderDoneWithNeighborZ[me]=u.canonical.z}for(const ze of le){const Ye=u.featuresOnBorder[ze],qe=u.centroidData[Ye.centroidDataIndex],lt=Ye.borders[ee];let it;for(;Ee<_e.length;){it=fe.featuresOnBorder[_e[Ee]];const Be=it.borders[me];if(Be[1]>lt[0]+3||Be[0]>lt[0]-3)break;fe.showCentroid(it),Ee++}if(it&&Ee<_e.length){const Be=Ee;let Ke=0;for(;!(it.borders[me][0]>lt[1]-3)&&(Ke++,++Ee!==_e.length);)it=fe.featuresOnBorder[_e[Ee]];it=fe.featuresOnBorder[_e[Be]];let gt=!1;if(Ke>=1){const Je=it.borders[me];Math.abs(lt[0]-Je[0])<3&&Math.abs(lt[1]-Je[1])<3&&(Ke=1,gt=!0,Ee=Be+1)}else if(Ke===0){u.showCentroid(Ye);continue}const Fe=fe.centroidData[it.centroidDataIndex];b&&gt&&((($=qe).flags|(te=Fe).flags)&n.d6?($.flags|=n.d6,te.flags|=n.d6):($.flags&=~n.d6,te.flags&=~n.d6));const st=Ye.intersectsCount()>1||it.intersectsCount()>1;if(Ke>1)Ee=Be,qe.centroidXY=Fe.centroidXY=new n.P(0,0);else if(be&&be.dem&&!st){const Je=H[ee](qe,Fe),St=ee%2?n.ag-1:0,dt=J(Je[0],Math.min(n.ag-1,Je[1]),St,be,pe,ee<2,Je[2]);qe.centroidXY=Fe.centroidXY=O(dt)}else st?qe.centroidXY=Fe.centroidXY=new n.P(0,0):(qe.centroidXY=u.encodeBorderCentroid(Ye),Fe.centroidXY=fe.encodeBorderCentroid(it));u.writeCentroidToBuffer(qe),fe.writeCentroidToBuffer(Fe)}else u.showCentroid(Ye)}u.borderDoneWithNeighborZ[ee]=fe.canonical.z,fe.borderDoneWithNeighborZ[me]=u.canonical.z}var $,te;(u.needsCentroidUpdate||!u.centroidVertexBuffer&&u.centroidVertexArray.length!==0)&&u.uploadCentroid(c)}const cc=[1,0,0],wt=[0,1,0],Gt=[0,0,1];function uc(c,t,r){const u=r.transform,p=r.shadowRenderer;if(!p)return!0;const _=c.toUnwrapped(),b=u.tileSize*p._cascades[r.currentShadowCascade].scale;let C=t.maxHeight;if(u.elevation){const $=u.elevation.getMinMaxForTile(c);$&&(C+=$.max)}const O=[...p.shadowDirection];O[2]=-O[2];const P=p.computeSimplifiedTileShadowVolume(_,C,b,O);if(!P)return!1;const F=[cc,wt,Gt,O,[O[0],0,O[2]],[0,O[1],O[2]]],V=u.projection.name==="globe",U=u.scaleZoom(b),H=n.bR.fromInvProjectionMatrix(u.invProjMatrix,u.worldSize,U,!V),J=p.getCurrentCascadeFrustum();return H.intersectsPrecise(P.vertices,P.planes,F)===0||J.intersectsPrecise(P.vertices,P.planes,F)===0}function jr(c){return[c[0]*n.d9,c[1]*n.d9,c[2]*n.d9,0]}function Ge(c,t,r,u,p,_,b,C,O){const P=u.getSource(),F=r.globeSharedBuffers;if(!F)return;let V,U,H;if(t&&(V=u.getTile(t)),P instanceof n.aJ?(U=P.texture,H=n.cI(0,0,r.transform)):V&&t&&(U=V.texture,H=n.cI(t.canonical.z,t.canonical.x,r.transform)),!U||!H)return;c||(H=n.ab.mat4.scale(n.ab.mat4.create(),H,[1,-1,1]));const J=r.context,$=J.gl,te=p.paint.get("raster-resampling")==="nearest"?$.NEAREST:$.LINEAR,ee=r.colorModeForDrapableLayerRenderPass(_),le=b.defines;le.push("GLOBE_POLES");const pe=new ci($.LEQUAL,ci.ReadWrite,r.depthRangeFor3D),fe=Float32Array.from(r.transform.expandedFarZProjMatrix),be=Float32Array.from(n.bb(n.cH(new n.bT(0,0,0))));r.terrain&&r.terrain.prepareDrawTile(),J.activeTexture.set($.TEXTURE0),U.bind(te,$.CLAMP_TO_EDGE),J.activeTexture.set($.TEXTURE1),U.bind(te,$.CLAMP_TO_EDGE),U.useMipmap&&J.extTextureFilterAnisotropic&&r.transform.pitch>20&&$.texParameterf($.TEXTURE_2D,J.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,J.extTextureFilterAnisotropicMax);const[me,ve,_e,Ee]=t?F.getPoleBuffers(t.canonical.z,!1):F.getPoleBuffers(0,!0),ze=p.paint.get("raster-elevation");let Ye;c?(Ye=me,r.renderDefaultNorthPole=ze!==0):(Ye=ve,r.renderDefaultSouthPole=ze!==0);const qe=jr(b.mix),lt=((Be,Ke,gt,Fe,st,Je,St,dt,ct,vt,Ct,Vt,Yt)=>No(Be,Ke,gt,new Float32Array(16),new Float32Array(9),[0,0],Fe,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Je,[0,0],dt,2,vt,Ct,Vt,1,0,Yt))(fe,be,H,n.ae(r.transform.zoom),0,p,0,ze,0,qe,b.offset,b.range,_),it=r.getOrCreateProgram("raster",{defines:le});r.uploadCommonUniforms(J,it,null),it.draw(r,$.TRIANGLES,pe,O,ee,C,lt,p.id,Ye,_e,Ee)}function uf(c){const t=c._nearZ,r=c.projection.farthestPixelDistance(c),u=r-t,p=.2*c.height,_=t+p;return[t,r,(_-p-t)/u,(_-t)/u]}function sh(c,t,r,u){if(c)return t instanceof an&&c instanceof Co?t.getTextureDescriptor(c,r,!0):{texture:c.texture,mix:jr(u.mix),offset:u.offset,buffer:0,tileSize:1}}var md=n.da([{name:"a_index",type:"Int16",components:1}]);class _d{constructor(t,r,u,p){const _={width:u[0],height:u[1],data:null},b=t.gl;this.targetColorTexture=new n.T(t,_,b.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new n.T(t,_,b.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(r,p),this.lastInvalidatedAt=0}updateParticleTexture(t,r){if(this.particleTextureDimension===r.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const u=this.context.gl,p=r.width*r.height;this.particleTexture0=new n.T(this.context,r,u.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new n.T(this.context,r,u.RGBA8,{premultiply:!1,useMipmap:!1});const _=new n.db;_.reserve(p);for(let b=0;b<p;b++)_.emplaceBack(b);this.particleIndexBuffer=this.context.createVertexBuffer(_,md.members,!0),this.particleSegment=n.b7.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=r.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=n.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function gd(c,t,r){if(!c)return null;const u=t.getTextureDescriptor(c,r,!0);if(!u)return null;let{texture:p,mix:_,offset:b,tileSize:C,buffer:O,format:P}=u;if(!p||!P)return null;let F=!1;return P==="uint32"&&(F=!0,_[3]=0,_=ih(n.dc,_,[0,r.paint.get("raster-particle-max-speed")]),b=iu(n.dc,b,[0,r.paint.get("raster-particle-max-speed")])),{texture:p,textureOffset:[O/(C+2*O),C/(C+2*O)],tileSize:C,scalarData:F,scale:_,offset:b,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[P]]}}function yd(c){const t=c._nearZ,r=c.projection.farthestPixelDistance(c),u=r-t,p=.2*c.height,_=t+p;return[t,r,(_-p-t)/u,(_-t)/u]}const Al=new n.aj(1,0,0,1),bp=new n.aj(0,1,0,1),wp=new n.aj(0,0,1,1),vd=new n.aj(1,0,1,1),oh=new n.aj(0,1,1,1);function qo(c,t,r,u,p,_,b){const C=c.context,O=c.transform,P=C.gl,F=O.projection.name==="globe",V=F?["PROJECTION_GLOBE_VIEW"]:[];let U=n.ab.mat4.clone(r.projMatrix);if(F&&n.ae(O.zoom)>0){const qe=n.ba(r.canonical,O),lt=n.dd(qe);U=n.ab.mat4.multiply(new Float32Array(16),O.globeMatrix,lt),n.ab.mat4.multiply(U,O.projMatrix,U)}const H=n.ab.mat4.create();H[12]+=2*p/(n.q.devicePixelRatio*O.width),H[13]+=2*_/(n.q.devicePixelRatio*O.height),n.ab.mat4.multiply(U,H,U);const J=c.getOrCreateProgram("debug",{defines:V}),$=t.getTileByID(r.key);c.terrain&&c.terrain.setupElevationDraw($,J);const te=ci.disabled,ee=vi.disabled,le=c.colorModeForRenderPass(),pe="$debug";C.activeTexture.set(P.TEXTURE0),c.emptyTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),F?$._makeGlobeTileDebugBuffers(c.context,O):$._makeDebugTileBoundsBuffers(c.context,O.projection);const fe=$._tileDebugBuffer||c.debugBuffer,be=$._tileDebugIndexBuffer||c.debugIndexBuffer,me=$._tileDebugSegments||c.debugSegments;if(J.draw(c,P.LINE_STRIP,te,ee,le,yi.disabled,lc(U,u),pe,fe,be,me,null,null,null,[$._globeTileDebugBorderBuffer]),b){const qe=$.latestRawTileData,lt=Math.floor((qe&&qe.byteLength||0)/1024);let it=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(it+=` => ${r.overscaledZ}`),it+=` ${$.state}`,it+=` ${lt}kb`,function(Be,Ke){Be.initDebugOverlayCanvas();const gt=Be.debugOverlayCanvas,Fe=Be.context.gl,st=Be.debugOverlayCanvas.getContext("2d");st.clearRect(0,0,gt.width,gt.height),st.shadowColor="white",st.shadowBlur=2,st.lineWidth=1.5,st.strokeStyle="white",st.textBaseline="top",st.font="bold 36px Open Sans, sans-serif",st.fillText(Ke,5,5),st.strokeText(Ke,5,5),Be.debugOverlayTexture.update(gt),Be.debugOverlayTexture.bind(Fe.LINEAR,Fe.CLAMP_TO_EDGE)}(c,it)}const ve=t.getTile(r).tileSize,_e=512/Math.min(ve,512)*(r.overscaledZ/O.zoom)*.5,Ee=$._tileDebugTextBuffer||c.debugBuffer,ze=$._tileDebugTextIndexBuffer||c.quadTriangleIndexBuffer,Ye=$._tileDebugTextSegments||c.debugSegments;J.draw(c,P.TRIANGLES,te,ee,Ui.alphaBlended,yi.disabled,lc(U,n.aj.transparent,_e),pe,Ee,ze,Ye,null,null,null,[$._globeTileDebugTextBuffer])}function xd(c,t,r,u){Ss(c,0,t+r/2,c.transform.width,r,u)}function hf(c,t,r,u){Ss(c,t-r/2,0,r,c.transform.height,u)}function Ss(c,t,r,u,p,_){const b=c.context,C=b.gl;C.enable(C.SCISSOR_TEST),C.scissor(t*n.q.devicePixelRatio,r*n.q.devicePixelRatio,u*n.q.devicePixelRatio,p*n.q.devicePixelRatio),b.clear({color:_}),C.disable(C.SCISSOR_TEST)}const lh=n.da([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:es}=lh;function Es(c,t,r,u){c.emplaceBack(t,r,u)}class bd{constructor(t){this.vertexArray=new n.de,this.indices=new n.aU,Es(this.vertexArray,-1,-1,1),Es(this.vertexArray,1,-1,1),Es(this.vertexArray,-1,1,1),Es(this.vertexArray,1,1,1),Es(this.vertexArray,-1,-1,-1),Es(this.vertexArray,1,-1,-1),Es(this.vertexArray,-1,1,-1),Es(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,es),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=n.b7.simpleSegment(0,0,36,12)}}function _n(c,t,r,u,p,_){const b=c.context.gl,C=t.paint.get("sky-atmosphere-color"),O=t.paint.get("sky-atmosphere-halo-color"),P=t.paint.get("sky-atmosphere-sun-intensity"),F=((V,U,H,J,$)=>({u_matrix_3f:V,u_sun_direction:U,u_sun_intensity:H,u_color_tint_r:[J.r,J.g,J.b,J.a],u_color_tint_m:[$.r,$.g,$.b,$.a],u_luminance:5e-5}))(n.ab.mat3.fromMat4(n.ab.mat3.create(),u),p,P,C,O);b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_CUBE_MAP_POSITIVE_X+_,t.skyboxTexture,0),r.draw(c,b.TRIANGLES,ci.disabled,vi.disabled,Ui.unblended,yi.frontCW,F,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const Tp=n.da([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class ou{constructor(t){const r=new n.df;r.emplaceBack(-1,1,1,0,0),r.emplaceBack(1,1,1,1,0),r.emplaceBack(1,-1,1,1,1),r.emplaceBack(-1,-1,1,0,1);const u=new n.aU;u.emplaceBack(0,1,2),u.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(r,Tp.members),this.indexBuffer=t.createIndexBuffer(u),this.segments=n.b7.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Ar=n.da([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class cr{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class ff{constructor(t){this.colorModeAlphaBlendedWriteRGB=new Ui([1,vs,1,vs],n.aj.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Ui([1,0,1,0],n.aj.transparent,[!1,!1,!1,!0]),this.params=new cr,this.updateNeeded=!0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),t.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(t){const r=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new ou(r);const u=this.params.sizeRange,p=this.params.intensityRange,_=function(F){const V=n.di(30),U=[];for(let H=0;H<F;++H){const J=2*Math.PI*V(),$=Math.acos(1-2*V())-.5*Math.PI;U.push(n.ab.vec3.fromValues(Math.cos($)*Math.cos(J),Math.cos($)*Math.sin(J),Math.sin($)))}return U}(this.params.starsCount),b=n.di(300),C=new n.dg,O=new n.aU;let P=0;for(let F=0;F<_.length;++F){const V=n.ab.vec3.scale([],_[F],200),U=Math.max(0,1+.01*u*(1*b()-.5)),H=Math.max(0,1+.01*p*(1*b()-.5));C.emplaceBack(V[0],V[1],V[2],-1,-1,U,H),C.emplaceBack(V[0],V[1],V[2],1,-1,U,H),C.emplaceBack(V[0],V[1],V[2],1,1,U,H),C.emplaceBack(V[0],V[1],V[2],-1,1,U,H),O.emplaceBack(P+0,P+1,P+2),O.emplaceBack(P+0,P+2,P+3),P+=4}this.starsVx=r.createVertexBuffer(C,Ar.members),this.starsIdx=r.createIndexBuffer(O),this.starsSegments=n.b7.simpleSegment(0,0,C.length,O.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,r){const u=t.context,p=u.gl,_=t.transform,b=new ci(p.LEQUAL,ci.ReadOnly,[0,1]),C=n.ae(_.zoom),O=t.style.getLut(r.scope),P=r.properties.get("color-use-theme")==="none",F=r.properties.get("color").toRenderColor(P?null:O).toArray01(),V=r.properties.get("high-color-use-theme")==="none",U=r.properties.get("high-color").toRenderColor(V?null:O).toArray01(),H=r.properties.get("space-color-use-theme")==="none",J=r.properties.get("space-color").toRenderColor(H?null:O).toArray01PremultipliedAlpha(),$=5e-4,te=n.dh(r.properties.get("horizon-blend"),0,1,$,.25),ee=n.cC(t,u,_)&&te===$?_.worldSize/(2*Math.PI*1.025)-1:_.globeRadius,le=t.frameCounter/1e3%1,pe=n.ab.vec3.length(_.globeCenterInViewSpace),fe=Math.sqrt(Math.pow(pe,2)-Math.pow(ee,2)),be=Math.acos(fe/pe),me=ve=>{const _e=_.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];ve&&_e.push("ALPHA_PASS");const Ee=t.getOrCreateProgram("globeAtmosphere",{defines:_e}),ze=((qe,lt,it,Be,Ke,gt,Fe,st,Je,St,dt,ct)=>({u_frustum_tl:qe,u_frustum_tr:lt,u_frustum_br:it,u_frustum_bl:Be,u_horizon:Ke,u_transition:gt,u_fadeout_range:Fe,u_color:st,u_high_color:Je,u_space_color:St,u_temporal_offset:dt,u_horizon_angle:ct}))(_.frustumCorners.TL,_.frustumCorners.TR,_.frustumCorners.BR,_.frustumCorners.BL,_.frustumCorners.horizon,C,te,F,U,J,le,be);t.uploadCommonUniforms(u,Ee);const Ye=this.atmosphereBuffer;Ye&&Ee.draw(t,p.TRIANGLES,b,vi.disabled,ve?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,yi.backCW,ze,ve?"atmosphere_glow_alpha":"atmosphere_glow",Ye.vertexBuffer,Ye.indexBuffer,Ye.segments)};me(!1),me(!0)}drawStars(t,r){const u=n.aw(r.properties.get("star-intensity"),0,1);if(u===0)return;const p=t.context,_=p.gl,b=t.transform,C=t.getOrCreateProgram("stars"),O=n.ab.quat.identity([]);n.ab.quat.rotateX(O,O,-b._pitch),n.ab.quat.rotateZ(O,O,-b.angle),n.ab.quat.rotateX(O,O,n.ai(b._center.lat)),n.ab.quat.rotateY(O,O,-n.ai(b._center.lng));const P=n.ab.mat4.fromQuat(new Float32Array(16),O),F=n.ab.mat4.multiply([],b.starsProjMatrix,P),V=n.ab.mat3.fromMat4([],P),U=n.ab.mat3.invert([],V),H=[0,1,0];n.ab.vec3.transformMat3(H,H,U),n.ab.vec3.scale(H,H,this.params.sizeMultiplier);const J=[1,0,0];n.ab.vec3.transformMat3(J,J,U),n.ab.vec3.scale(J,J,this.params.sizeMultiplier);const $=(te=H,ee=J,le=u,{u_matrix:Float32Array.from(F),u_up:te,u_right:ee,u_intensity_multiplier:le});var te,ee,le;t.uploadCommonUniforms(p,C),this.starsVx&&this.starsIdx&&C.draw(t,_.TRIANGLES,ci.disabled,vi.disabled,this.colorModeAlphaBlendedWriteRGB,yi.disabled,$,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function fo(c,t){const r=[...c],u=t.cameraWorldSizeForFog/t.worldSize,p=n.ab.mat4.identity([]);return n.ab.mat4.scale(p,p,[u,u,1]),n.ab.mat4.multiply(r,p,r),n.ab.mat4.multiply(r,t.worldToFogMatrix,r),r}function hc(c,t,r,u,p){const _=r.material,b=u.context,{baseColorTexture:C,metallicRoughnessTexture:O}=_.pbrMetallicRoughness,{normalTexture:P,occlusionTexture:F,emissionTexture:V}=_;function U(J,$,te){if(J&&(c.push($),b.activeTexture.set(b.gl.TEXTURE0+te),J.gfxTexture)){const{minFilter:ee,magFilter:le,wrapS:pe,wrapT:fe}=J.sampler;J.gfxTexture.bindExtraParam(ee,le,pe,fe)}}U(C,"HAS_TEXTURE_u_baseColorTexture",zn.BaseColor),U(O,"HAS_TEXTURE_u_metallicRoughnessTexture",zn.MetallicRoughness),U(P,"HAS_TEXTURE_u_normalTexture",zn.Normal),U(F,"HAS_TEXTURE_u_occlusionTexture",zn.Occlusion),U(V,"HAS_TEXTURE_u_emissionTexture",zn.Emission),p&&(p.texture||(p.texture=new n.dk(u.context,p.image,[p.image.height,p.image.height,p.image.height],b.gl.RGBA8)),b.activeTexture.set(b.gl.TEXTURE0+zn.LUT),p.texture&&p.texture.bind(b.gl.LINEAR,b.gl.CLAMP_TO_EDGE),c.push("APPLY_LUT_ON_GPU")),r.texcoordBuffer&&(c.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(r.texcoordBuffer)),r.colorBuffer&&(c.push(r.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(r.colorBuffer)),r.normalBuffer&&(c.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(r.normalBuffer)),r.pbrBuffer&&(c.push("HAS_ATTRIBUTE_a_pbr"),c.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(r.pbrBuffer)),_.alphaMode!=="OPAQUE"&&_.alphaMode!=="MASK"||c.push("UNPREMULT_TEXTURE_IN_SHADER"),_.defined||c.push("DIFFUSE_SHADED");const H=u.shadowRenderer;H&&(c.push("RENDER_SHADOWS","DEPTH_TEXTURE"),H.useNormalOffset&&c.push("NORMAL_OFFSET"))}function Gs(c,t,r,u,p,_){const b=r.paint.get("model-opacity").constantOr(1),C=t.context,O=new ci(t.context.gl.LEQUAL,ci.ReadWrite,t.depthRangeFor3D),P=t.transform,F=c.mesh,V=F.material,U=V.pbrMetallicRoughness,H=t.style.fog;let J;J=t.transform.projection.zAxisUnit==="pixels"?[...c.nodeModelMatrix]:n.ab.mat4.multiply([],u.zScaleMatrix,c.nodeModelMatrix),n.ab.mat4.multiply(J,u.negCameraPosMatrix,J);const $=n.ab.mat4.invert([],J);n.ab.mat4.transpose($,$);const te=r.paint.get("model-color-use-theme").constantOr("default")==="none",ee=r.paint.get("model-emissive-strength").constantOr(0),le=rh(new Float32Array(c.worldViewProjection),new Float32Array(J),new Float32Array($),null,t,b,U.baseColorFactor.toRenderColor(null),V.emissiveFactor,U.metallicFactor,U.roughnessFactor,V,ee,r),pe={defines:[]},fe=[],be=t.shadowRenderer;be&&(be.useNormalOffset=!1),hc(pe.defines,fe,F,t,te?null:r.lut);let me=null;if(H){const Ee=fo(c.nodeModelMatrix,t.transform);if(me=new Float32Array(Ee),P.projection.name!=="globe"){const ze=F.aabb.min,Ye=F.aabb.max,[qe,lt]=H.getOpacityForBounds(Ee,ze[0],ze[1],Ye[0],Ye[1]);pe.overrideFog=qe>=we||lt>=we}}const ve=al(t,r.paint.get("model-cutoff-fade-range"));ve.shouldRenderCutoff&&pe.defines.push("RENDER_CUTOFF");const _e=t.getOrCreateProgram("model",pe);t.uploadCommonUniforms(C,_e,null,me,ve),t.renderPass!=="shadow"&&be&&be.setupShadowsFromMatrix(c.nodeModelMatrix,_e),_e.draw(t,C.gl.TRIANGLES,O,p,_,F.material.doubleSided?yi.disabled:yi.backCCW,le,r.id,F.vertexBuffer,F.indexBuffer,F.segments,r.paint,t.transform.zoom,void 0,fe)}function ch(c,t,r,u,p,_,b){let C;C=c.projection.name==="globe"?n.dl(r,c):[...r],n.ab.mat4.multiply(C,C,t.matrix);const O=n.ab.mat4.multiply([],u,C);if(t.meshes)for(const P of t.meshes){if(P.material.alphaMode!=="BLEND"){b.push({mesh:P,depth:0,modelIndex:p,worldViewProjection:O,nodeModelMatrix:C});continue}const F=n.ab.vec3.transformMat4([],P.centroid,O);!c.isOrthographic&&F[2]<=0||_.push({mesh:P,depth:F[2],modelIndex:p,worldViewProjection:O,nodeModelMatrix:C})}if(t.children)for(const P of t.children)ch(c,P,r,u,p,_,b)}function lu(c,t,r,u){const p=r.shadowRenderer;if(!p)return;const _=p.getShadowPassDepthMode(),b=p.getShadowPassColorMode(),C=p.calculateShadowPassMatrixFromMatrix(t),O=dn(C);r.getOrCreateProgram("modelDepth",{defines:r._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(r,r.context.gl.TRIANGLES,_,vi.disabled,b,yi.backCCW,O,u.id,c.vertexBuffer,c.indexBuffer,c.segments,u.paint,r.transform.zoom,void 0,void 0)}function po(c,t,r){const u=t.updateZoomBasedPaintProperties(),p=function(_,b,C){let O,P,F,V=_.terrain?_.terrain.exaggeration():0;if(_.terrain&&V>0){const U=_.terrain,H=U.findDEMTileFor(C);H&&H.dem?O=n.dn.create(U,C,H):V=0}if(V===0&&(b.terrainElevationMin=0,b.terrainElevationMax=0),V===b.validForExaggeration&&(V===0||O&&O._demTile&&O._demTile.tileID===b.validForDEMTile.id&&O._dem._timestamp===b.validForDEMTile.timestamp))return!1;for(const U in b.instancesPerModel){const H=b.instancesPerModel[U];for(let J=0;J<H.instancedDataArray.length;++J){const $=(O?V*O.getElevationAt(0|H.instancedDataArray.float32[16*J],0|H.instancedDataArray.float32[16*J+1],!0,!0):0)+H.instancesEvaluatedElevation[J];H.instancedDataArray.float32[16*J+6]=$,P=P?Math.min(b.terrainElevationMin,$):$,F=F?Math.max(b.terrainElevationMax,$):$}}return b.terrainElevationMin=P||0,b.terrainElevationMax=F||0,b.validForExaggeration=V,b.validForDEMTile=O&&O._demTile?{id:O._demTile.tileID,timestamp:O._dem._timestamp}:{id:void 0,timestamp:0},!0}(c,t,r);(u||p)&&(t.uploaded=!1,t.upload(c.context))}const Yn={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new n.cd([0,0,0],[n.ag,n.ag,0])};function uh(c,t){const r=1<<c.canonical.z,u=t.getFreeCameraOptions().position,p=t.elevation,_=c.canonical.x/r,b=(c.canonical.x+1)/r,C=c.canonical.y/r,O=(c.canonical.y+1)/r;let P=t._centerAltitude;if(p){const H=p.getMinMaxForTile(c);H&&H.max>P&&(P=H.max)}const F=n.aw(u.x,_,b)-u.x,V=n.aw(u.y,C,O)-u.y,U=n.bH(P,t.center.lat)-u.z;return t._zoomFromMercatorZ(Math.sqrt(F*F+V*V+U*U))}function cu(c,t,r,u,p,_,b){const C=c.context,O=c.renderPass==="shadow",P=c.shadowRenderer,F=O&&P?P.getShadowPassDepthMode():new ci(C.gl.LEQUAL,ci.ReadWrite,c.depthRangeFor3D),V=c.isTileAffectedByFog(_);if(r.meshes)for(const U of r.meshes){const H=["MODEL_POSITION_ON_GPU"],J=[];let $,te,ee;u.instancedDataArray.length>20&&H.push("INSTANCED_ARRAYS");const le=al(c,t.paint.get("model-cutoff-fade-range"));if(le.shouldRenderCutoff&&H.push("RENDER_CUTOFF"),O&&P)$=c.getOrCreateProgram("modelDepth",{defines:H}),te=dn(b.shadowTileMatrix,b.shadowTileMatrix,Float32Array.from(r.matrix)),ee=P.getShadowPassColorMode();else{hc(H,J,U,c,t.paint.get("model-color-use-theme").constantOr("default")==="none"?null:t.lut),$=c.getOrCreateProgram("model",{defines:H,overrideFog:V});const fe=U.material,be=fe.pbrMetallicRoughness,me=t.paint.get("model-opacity").constantOr(1),ve=t.paint.get("model-emissive-strength").constantOr(0);te=rh(_.expandedProjMatrix,Float32Array.from(r.matrix),new Float32Array(16),null,c,me,be.baseColorFactor.toRenderColor(null),fe.emissiveFactor,be.metallicFactor,be.roughnessFactor,fe,ve,t,p),P&&(b.shadowUniformsInitialized?$.setShadowUniformValues(C,P.getShadowUniformValues()):(P.setupShadows(_.toUnwrapped(),$,"model-tile",_.overscaledZ),b.shadowUniformsInitialized=!0)),ee=le.shouldRenderCutoff||me<1||fe.alphaMode!=="OPAQUE"?Ui.alphaBlended:Ui.unblended}c.uploadCommonUniforms(C,$,_.toUnwrapped(),null,le);const pe=U.material.doubleSided?yi.disabled:yi.backCCW;if(u.instancedDataArray.length>20)J.push(u.instancedDataBuffer),$.draw(c,C.gl.TRIANGLES,F,vi.disabled,ee,pe,te,t.id,U.vertexBuffer,U.indexBuffer,U.segments,t.paint,c.transform.zoom,void 0,J,u.instancedDataArray.length);else{const fe=O?"u_instance":"u_normal_matrix";for(let be=0;be<u.instancedDataArray.length;++be)te[fe]=new Float32Array(u.instancedDataArray.arrayBuffer,64*be,16),$.draw(c,C.gl.TRIANGLES,F,vi.disabled,ee,pe,te,t.id,U.vertexBuffer,U.indexBuffer,U.segments,t.paint,c.transform.zoom,void 0,J)}}if(r.children)for(const U of r.children)cu(c,t,U,u,p,_,b)}const hh=[1,-1,1];function df(c,t,r,u){if(!r.modelManager)return!0;const p=r.modelManager;if(!r.shadowRenderer)return!0;const _=r.shadowRenderer,b=t.aabb;let C=!0,O=c.maxHeight;if(O===0){let F=0;for(const V in c.instancesPerModel){const U=p.getModel(V,u);U?F=Math.max(F,Math.max(Math.max(U.aabb.max[0],U.aabb.max[1]),U.aabb.max[2])):C=!1}O=c.maxScale*F*1.41+c.maxVerticalOffset,C&&(c.maxHeight=O)}b.max[2]=O,b.min[2]+=c.terrainElevationMin,b.max[2]+=c.terrainElevationMax,n.ab.vec3.transformMat4(b.min,b.min,t.tileMatrix),n.ab.vec3.transformMat4(b.max,b.max,t.tileMatrix);const P=b.intersects(_.getCurrentCascadeFrustum());return r.currentShadowCascade===0&&(c.isInsideFirstShadowMapFrustum=P===2),P===0}function Cl(c,t){const r=c.uniformValues.u_cutoff_params[0],u=c.uniformValues.u_cutoff_params[1],p=c.uniformValues.u_cutoff_params[2],_=c.uniformValues.u_cutoff_params[3];return u===r||_===p?1:n.aw(((t-r)/(u-r)-p)/(_-p),0,1)}function wd(c,t,r,u){if(t.pitch<20)return 1;const p=t.getWorldToCameraMatrix();n.ab.mat4.multiply(p,p,c);const _=n.ab.vec4.fromValues(r.min[0],r.min[1],r.min[2],1);let b=n.ab.vec4.transformMat4(n.ab.vec4.create(),_,p),C=b,O=b;_[1]=r.max[1],b=n.ab.vec4.transformMat4(n.ab.vec4.create(),_,p),C=b[1]<C[1]?b:C,O=b[1]>O[1]?b:O,_[0]=r.max[0],b=n.ab.vec4.transformMat4(n.ab.vec4.create(),_,p),C=b[1]<C[1]?b:C,O=b[1]>O[1]?b:O,_[1]=r.min[1],b=n.ab.vec4.transformMat4(n.ab.vec4.create(),_,p),C=b[1]<C[1]?b:C,O=b[1]>O[1]?b:O;const P=n.aw(u[0],0,1),F=100*t.pixelsPerMeter*n.aw(u[1],0,1),V=n.aw(u[2],0,1),U=n.ab.vec4.lerp(n.ab.vec4.create(),C,O,P),H=Math.tan(.5*t.fovX),J=-U[2]*H;if(F===0)return U[1]<-Math.abs(J)?V:1;const $=(-Math.abs(J)-U[1])/F,te=(le,pe,fe)=>(1-fe)*le+fe*pe,ee=n.aw(te(1,V,$),V,1);return te(1,ee,n.aw((t.pitch-20)/20,0,1))}class Dl{}class pf{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,r,u){{const V=this._storage.get(r.id);if(V)return V.lastUsedFrameIdx=t,V.buf}const p=u.gl,_=p.getBufferParameter(p.ELEMENT_ARRAY_BUFFER,p.BUFFER_SIZE),b=new ArrayBuffer(_),C=new Int16Array(b);p.getBufferSubData(p.ELEMENT_ARRAY_BUFFER,0,new Int16Array(b));const O=new n.dq;for(let V=0;V<_/2;V+=3){const U=C[V],H=C[V+1],J=C[V+2];O.emplaceBack(U,H),O.emplaceBack(H,J),O.emplaceBack(J,U)}const P=u.bindVertexArrayOES.current,F=new Dl;return F.buf=new Ts(u,O),F.lastUsedFrameIdx=t,this._storage.set(r.id,F),u.bindVertexArrayOES.set(P),F.buf}update(t){for(const[r,u]of this._storage)t-u.lastUsedFrameIdx>30&&(u.buf.destroy(),this._storage.delete(r))}destroy(){for(const[t,r]of this._storage)r.buf.destroy(),this._storage.delete(t)}}class Il{constructor(t){this.occluderSize=30,this.depthOffset=-1e-4,t.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),t.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const fh=n.da([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class uu{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Ln{constructor(t,r){this.revealStart=11,this.revealRange=2,t.registerParameter(this,[...r,"Reveal"],"revealStart",{min:0,max:17,step:.05}),t.registerParameter(this,[...r,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const mf=n.da([{type:"Float32",name:"a_pos_2f",components:2}]);class Ms{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(t,r){const u=t.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const b=new n.dr,C=new n.aU;b.emplaceBack(-1,-1),b.emplaceBack(1,-1),b.emplaceBack(1,1),b.emplaceBack(-1,1),C.emplaceBack(0,1,2),C.emplaceBack(0,2,3),this.vignetteVx=t.context.createVertexBuffer(b,mf.members),this.vignetteIdx=t.context.createIndexBuffer(C)}const p=n.b7.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){t.uploadCommonUniforms(t.context,u);const b={u_vignetteShape:(_={vignetteShape:[r.start,r.range,Math.pow(10,r.fadePower)],vignetteColor:[r.color.r,r.color.g,r.color.b,r.color.a*r.strength]}).vignetteShape,u_vignetteColor:_.vignetteColor};u.draw(t,t.context.gl.TRIANGLES,ci.disabled,vi.disabled,Ui.alphaBlended,yi.disabled,b,"vignette",this.vignetteVx,this.vignetteIdx,p,{})}var _}}class Hs{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(t,r){const u=t.getFreeCameraOptions().position,p=u.toAltitude(),_=u.toLngLat(),b=n.ai(_.lng),C=n.ai(_.lat),O=t.pixelsPerMeter/r,P=b*n.ds,F=n.ds*Math.log(Math.tan(Math.PI/4+C/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const V=-this._offsetYPrev+F,U=-this._elevationPrev+p;this._accumulatedOffsetX+=(-this._offsetXPrev+P)*O,this._accumulatedOffsetY+=V*O,this._accumulatedElevation+=U*O,this._offsetXPrev=P,this._offsetYPrev=F,this._elevationPrev=p}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function Ia(c,t){return[-(c[0]-Math.floor(c[0]/t)*t),-(c[1]-Math.floor(c[1]/t)*t),-(c[2]-Math.floor(c[2]/t)*t)]}function mo(c){const t=n.di(1323123451230),r=[];for(let u=0;u<c;++u){const p=2*t()-1,_=2*t()-1,b=2*t()-1;r.push(n.ab.vec3.fromValues(p,_,b))}return r}function As(c,t,r,u,p){const _=n.aw((p-r)/(u-r),0,1);return(1-_)*c+_*t}class hu{constructor(t){this._movement=new Hs,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Ms,this._ppmScaleFactor=t}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(t,r){const u=t.transform;this._movement.update(u,this._ppmScaleFactor);const p=u.starsProjMatrix,_=n.ab.quat.identity([]);n.ab.quat.rotateX(_,_,n.ai(90)-u._pitch),n.ab.quat.rotateZ(_,_,-u.angle);const b=n.ab.mat4.fromQuat(new Float32Array(16),_),C=n.ab.mat4.fromValues(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),O=n.ab.mat4.transpose([],C),P=n.ab.mat4.multiply([],O,b),F=Date.now()/1e3;return this._accumulatedTimeFromStart+=(F-this._prevTime)*r,this._prevTime=F,{projectionMatrix:p,modelviewMatrix:P}}}class fc extends hu{constructor(t){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Ln(t.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(t){const r=t.context;if(!this.particlesVx){const u=mo(this.particlesCount),p=new n.dt,_=new n.aU;let b=0;const C=n.di(1323123451230);for(let O=0;O<u.length;++O){const P=u[O],F=[2*C()-1,C(),C(),C()];p.emplaceBack(P[0],P[1],P[2],-1,-1,...F),p.emplaceBack(P[0],P[1],P[2],1,-1,...F),p.emplaceBack(P[0],P[1],P[2],1,1,...F),p.emplaceBack(P[0],P[1],P[2],-1,1,...F),_.emplaceBack(b+0,b+1,b+2),_.emplaceBack(b+0,b+2,b+3),b+=4}this.particlesVx=r.createVertexBuffer(p,fh.members),this.particlesIdx=r.createIndexBuffer(_)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.rain)return;const r=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},u=t.transform.zoom;if(r.revealStart>u)return;const p=As(0,1,r.revealStart,r.revealStart+r.revealRange,u);if(!this.particlesVx||!this.particlesIdx)return;const _=structuredClone(this._params);let b=[-_.direction.x,_.direction.y,-100];n.ab.vec3.normalize(b,b);const C=structuredClone(this._vignetteParams);C.strength*=p,_.overrideStyleParameters||(_.intensity=t.style.rain.state.density,_.timeFactor=t.style.rain.state.intensity,_.color=structuredClone(t.style.rain.state.color),b=structuredClone(t.style.rain.state.direction),_.screenThinning.intensity=t.style.rain.state.centerThinning,_.dropletSizeX=t.style.rain.state.dropletSize[0],_.dropletSizeYScale=t.style.rain.state.dropletSize[1]/t.style.rain.state.dropletSize[0],_.distortionStrength=100*t.style.rain.state.distortionStrength,C.strength=1,C.color=structuredClone(t.style.rain.state.vignetteColor));const O=this.updateOnRender(t,_.timeFactor),P=t.context,F=P.gl,V=t.transform;this.screenTexture&&this.screenTexture.size[0]===t.width&&this.screenTexture.size[1]===t.height||(this.screenTexture=new n.T(P,{width:t.width,height:t.height,data:null},F.RGBA8)),_.distortionStrength>0&&(P.activeTexture.set(F.TEXTURE0),this.screenTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),F.copyTexSubImage2D(F.TEXTURE_2D,0,0,0,0,0,t.width,t.height));const U=t.getOrCreateProgram("rainParticle");t.uploadCommonUniforms(P,U),P.activeTexture.set(F.TEXTURE0),this.screenTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE);const H=[_.color.r,_.color.g,_.color.b,_.color.a],J=($,te)=>{const ee=Ia(this._movement.getPosition(),$),le=_.dropletSizeX,pe=_.dropletSizeX*_.dropletSizeYScale,fe=t.width/2,be=t.height/2,me=As(0,_.screenThinning.start,0,1,_.screenThinning.intensity),ve=As(.001,_.screenThinning.range,0,1,_.screenThinning.intensity),_e=As(0,_.screenThinning.particleOffset,0,1,_.screenThinning.intensity),Ee=(ze={modelview:O.modelviewMatrix,projection:O.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ee,velocityConeAperture:_.velocityConeAperture,velocity:_.velocity,boxSize:$,rainDropletSize:[le,pe],distortionStrength:_.distortionStrength,rainDirection:b,color:H,screenSize:[V.width,V.height],thinningCenterPos:[fe,be],thinningShape:[me,ve,Math.pow(10,_.screenThinning.fadePower)],thinningAffectedRatio:_.screenThinning.affectedRatio,thinningParticleOffset:_e,shapeDirectionalPower:_.shapeDirPower,shapeNormalPower:_.shapeNormalPower,mode:te?0:1},{u_modelview:Float32Array.from(ze.modelview),u_projection:Float32Array.from(ze.projection),u_time:ze.time,u_cam_pos:ze.camPos,u_texScreen:0,u_velocityConeAperture:ze.velocityConeAperture,u_velocity:ze.velocity,u_boxSize:ze.boxSize,u_rainDropletSize:ze.rainDropletSize,u_distortionStrength:ze.distortionStrength,u_rainDirection:ze.rainDirection,u_color:ze.color,u_screenSize:ze.screenSize,u_thinningCenterPos:ze.thinningCenterPos,u_thinningShape:ze.thinningShape,u_thinningAffectedRatio:ze.thinningAffectedRatio,u_thinningParticleOffset:ze.thinningParticleOffset,u_shapeDirectionalPower:ze.shapeDirectionalPower,u_shapeNormalPower:ze.shapeNormalPower,u_mode:ze.mode});var ze;const Ye=Math.round(_.intensity*this.particlesCount),qe=n.b7.simpleSegment(0,0,4*Ye,2*Ye);U.draw(t,F.TRIANGLES,ci.disabled,vi.disabled,Ui.alphaBlended,yi.disabled,Ee,"rain_particles",this.particlesVx,this.particlesIdx,qe,{})};_.distortionStrength>0&&J(_.boxSize,!0),J(_.boxSize,!1),this._vignette.draw(t,C)}}const _f=n.da([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Go extends hu{constructor(t){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Ln(t.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(t){const r=t.context;if(!this.particlesVx){const u=mo(this.particlesCount),p=new n.du,_=new n.aU;let b=0;const C=n.di(1323123451230);for(let O=0;O<u.length;++O){const P=u[O],F=C(),V=C(),U=C(),H=[O/u.length,F,V,U],J=[C(),C()];p.emplaceBack(P[0],P[1],P[2],-1,-1,...H,...J),p.emplaceBack(P[0],P[1],P[2],1,-1,...H,...J),p.emplaceBack(P[0],P[1],P[2],1,1,...H,...J),p.emplaceBack(P[0],P[1],P[2],-1,1,...H,...J),_.emplaceBack(b+0,b+1,b+2),_.emplaceBack(b+0,b+2,b+3),b+=4}this.particlesVx=r.createVertexBuffer(p,_f.members),this.particlesIdx=r.createIndexBuffer(_)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.snow)return;const r=structuredClone(this._params);let u=[-r.direction.x,r.direction.y,-100];n.ab.vec3.normalize(u,u);const p=structuredClone(this._vignetteParams),_=r.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},b=t.transform.zoom;if(_.revealStart>b)return;const C=As(0,1,_.revealStart,_.revealStart+_.revealRange,b);p.strength*=C,r.overrideStyleParameters||(r.intensity=t.style.snow.state.density,r.timeFactor=t.style.snow.state.intensity,r.color=structuredClone(t.style.snow.state.color),u=structuredClone(t.style.snow.state.direction),r.screenThinning.intensity=t.style.snow.state.centerThinning,r.billboardSize=2.79*t.style.snow.state.flakeSize,p.strength=1,p.color=structuredClone(t.style.snow.state.vignetteColor));const O=this.updateOnRender(t,r.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const P=t.context,F=P.gl,V=t.transform,U=t.getOrCreateProgram("snowParticle");t.uploadCommonUniforms(P,U),((H,J,$)=>{const te=Ia(this._movement.getPosition(),H),ee=V.width/2,le=V.height/2,pe=As(0,$.screenThinning.start,0,1,$.screenThinning.intensity),fe=As(.001,$.screenThinning.range,0,1,$.screenThinning.intensity),be=As(0,$.screenThinning.particleOffset,0,1,$.screenThinning.intensity),me=(ve={modelview:O.modelviewMatrix,projection:O.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:te,velocityConeAperture:$.velocityConeAperture,velocity:$.velocity,horizontalOscillationRadius:$.horizontalOscillationRadius,horizontalOscillationRate:$.horizontalOscillationRate,boxSize:H,billboardSize:1*$.billboardSize,simpleShapeParameters:[$.shapeFadeStart,$.shapeFadePower],screenSize:[V.width,V.height],thinningCenterPos:[ee,le],thinningShape:[pe,fe,Math.pow(10,$.screenThinning.fadePower)],thinningAffectedRatio:$.screenThinning.affectedRatio,thinningParticleOffset:be,color:[$.color.r,$.color.g,$.color.b,$.color.a],direction:u},{u_modelview:Float32Array.from(ve.modelview),u_projection:Float32Array.from(ve.projection),u_time:ve.time,u_cam_pos:ve.camPos,u_velocityConeAperture:ve.velocityConeAperture,u_velocity:ve.velocity,u_horizontalOscillationRadius:ve.horizontalOscillationRadius,u_horizontalOscillationRate:ve.horizontalOscillationRate,u_boxSize:ve.boxSize,u_billboardSize:ve.billboardSize,u_simpleShapeParameters:ve.simpleShapeParameters,u_screenSize:ve.screenSize,u_thinningCenterPos:ve.thinningCenterPos,u_thinningShape:ve.thinningShape,u_thinningAffectedRatio:ve.thinningAffectedRatio,u_thinningParticleOffset:ve.thinningParticleOffset,u_particleColor:ve.color,u_direction:ve.direction});var ve;const _e=Math.round($.intensity*this.particlesCount),Ee=n.b7.simpleSegment(0,0,4*_e,2*_e);this.particlesVx&&this.particlesIdx&&U.draw(t,F.TRIANGLES,ci.disabled,vi.disabled,Ui.alphaBlended,yi.disabled,me,"snow_particles",this.particlesVx,this.particlesIdx,Ee,{})})(r.boxSize,0,r),this._vignette.draw(t,p)}}const Rl={symbol:function(c,t,r,u,p){if(c.renderPass!=="translucent")return;const _=vi.disabled,b=c.colorModeForRenderPass(),C=r.layout.get("text-variable-anchor"),O=r.layout.get("text-size-scale-range"),P=n.aw(c.scaleFactor,O[0],O[1]);C&&function(U,H,J,$,te,ee,le,pe){const fe=H.transform,be=te==="map",me=ee==="map";for(const ve of U){const _e=$.getTile(ve),Ee=_e.getBucket(J);if(!Ee||!Ee.text||!Ee.text.segments.get().length)continue;const ze=n.bp(Ee.textSizeData,fe.zoom,pe),Ye=rl(ve,Ee.getProjection(),fe),qe=fe.calculatePixelsToTileUnitsMatrix(_e),lt=Or(Ye,_e.tileID.canonical,me,be,fe,Ee.getProjection(),qe),it=Ee.hasIconTextFit()&&Ee.hasIconData();if(ze){const Be=Math.pow(2,fe.zoom-_e.tileID.overscaledZ);wl(Ee,be,me,le,n.cX,fe,lt,ve,Be,ze,it)}}}(u,c,r,t,r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),p,P);const F=r.paint.get("icon-opacity").constantOr(1)!==0,V=r.paint.get("text-opacity").constantOr(1)!==0;r.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(F||V)?Tl(c,t,r,u,_,b):(F&&Tl(c,t,r,u,_,b,{onlyIcons:!0}),V&&Tl(c,t,r,u,_,b,{onlyText:!0})),t.map.showCollisionBoxes&&(au(c,t,r,u,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),!0),au(c,t,r,u,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),!1))},circle:function(c,t,r,u){if(c.renderPass!=="translucent")return;const p=r.paint.get("circle-opacity"),_=r.paint.get("circle-stroke-width"),b=r.paint.get("circle-stroke-opacity"),C=r.layout.get("circle-sort-key").constantOr(1)!==void 0,O=r.paint.get("circle-emissive-strength");if(p.constantOr(1)===0&&(_.constantOr(1)===0||b.constantOr(1)===0))return;const P=c.context,F=P.gl,V=c.transform,U=c.depthModeForSublayer(0,ci.ReadOnly),H=vi.disabled,J=c.colorModeForDrapableLayerRenderPass(O),$=V.projection.name==="globe",te=[n.at(V.center.lng),n.aA(V.center.lat)],ee=[];for(let pe=0;pe<u.length;pe++){const fe=u[pe],be=t.getTile(fe),me=be.getBucket(r);if(!me||me.projection.name!==V.projection.name)continue;const ve=me.programConfigurations.get(r.id),_e=n.cY(r),Ee=c.isTileAffectedByFog(fe);$&&_e.push("PROJECTION_GLOBE_VIEW"),_e.push("DEPTH_D24"),c.terrain&&V.depthOcclusionForSymbolsAndCircles&&_e.push("DEPTH_OCCLUSION");const ze=c.getOrCreateProgram("circle",{config:ve,defines:_e,overrideFog:Ee}),Ye=me.layoutVertexBuffer,qe=me.globeExtVertexBuffer,lt=me.indexBuffer,it=V.projection.createInversionMatrix(V,fe.canonical),Be={programConfiguration:ve,program:ze,layoutVertexBuffer:Ye,globeExtVertexBuffer:qe,indexBuffer:lt,uniformValues:n.cZ(c,fe,be,it,te,r),tile:be};if(C){const Ke=me.segments.get();for(const gt of Ke)ee.push({segments:new n.b7([gt]),sortKey:gt.sortKey,state:Be})}else ee.push({segments:me.segments,sortKey:0,state:Be})}C&&ee.sort((pe,fe)=>pe.sortKey-fe.sortKey);const le={useDepthForOcclusion:V.depthOcclusionForSymbolsAndCircles};for(const pe of ee){const{programConfiguration:fe,program:be,layoutVertexBuffer:me,globeExtVertexBuffer:ve,indexBuffer:_e,uniformValues:Ee,tile:ze}=pe.state,Ye=pe.segments;c.terrain&&c.terrain.setupElevationDraw(ze,be,le),c.uploadCommonUniforms(P,be,ze.tileID.toUnwrapped()),be.draw(c,F.TRIANGLES,U,H,J,yi.disabled,Ee,r.id,me,_e,Ye,r.paint,V.zoom,fe,[ve])}},heatmap:function(c,t,r,u){if(r.paint.get("heatmap-opacity")!==0)if(c.renderPass==="offscreen"){const p=c.context,_=p.gl,b=vi.disabled,C=new Ui([_.ONE,_.ONE,_.ONE,_.ONE],n.aj.transparent,[!0,!0,!0,!0]);(function(H,J,$,te){const ee=H.gl,le=J.width*te,pe=J.height*te;H.activeTexture.set(ee.TEXTURE1),H.viewport.set([0,0,le,pe]);let fe=$.heatmapFbo;if(!fe||fe&&(fe.width!==le||fe.height!==pe)){fe&&fe.destroy();const be=ee.createTexture();ee.bindTexture(ee.TEXTURE_2D,be),ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_WRAP_S,ee.CLAMP_TO_EDGE),ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_WRAP_T,ee.CLAMP_TO_EDGE),ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_MIN_FILTER,ee.LINEAR),ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_MAG_FILTER,ee.LINEAR),fe=$.heatmapFbo=H.createFramebuffer(le,pe,!0,null),function(me,ve,_e,Ee,ze,Ye){const qe=me.gl;qe.texImage2D(qe.TEXTURE_2D,0,me.extRenderToTextureHalfFloat?qe.RGBA16F:qe.RGBA,ze,Ye,0,qe.RGBA,me.extRenderToTextureHalfFloat?qe.HALF_FLOAT:qe.UNSIGNED_BYTE,null),Ee.colorAttachment.set(_e)}(H,0,be,fe,le,pe)}else ee.bindTexture(ee.TEXTURE_2D,fe.colorAttachment.get()),H.bindFramebuffer.set(fe.framebuffer)})(p,c,r,c.transform.projection.name==="globe"?.5:.25),p.clear({color:n.aj.transparent});const O=c.transform,P=O.projection.name==="globe",F=P?["PROJECTION_GLOBE_VIEW"]:[],V=P?yi.frontCCW:yi.disabled,U=[n.at(O.center.lng),n.aA(O.center.lat)];for(let H=0;H<u.length;H++){const J=u[H];if(t.hasRenderableParent(J))continue;const $=t.getTile(J),te=$.getBucket(r);if(!te||te.projection.name!==O.projection.name)continue;const ee=c.isTileAffectedByFog(J),le=te.programConfigurations.get(r.id),pe=c.getOrCreateProgram("heatmap",{config:le,defines:F,overrideFog:ee}),{zoom:fe}=c.transform;c.terrain&&c.terrain.setupElevationDraw($,pe),c.uploadCommonUniforms(p,pe,J.toUnwrapped());const be=O.projection.createInversionMatrix(O,J.canonical);pe.draw(c,_.TRIANGLES,ci.disabled,b,C,V,Zt(c,J,$,be,U,fe,r.paint.get("heatmap-intensity")),r.id,te.layoutVertexBuffer,te.indexBuffer,te.segments,r.paint,c.transform.zoom,le,P?[te.globeExtVertexBuffer]:null)}p.viewport.set([0,0,c.width,c.height])}else c.renderPass==="translucent"&&(c.context.setColorMode(c.colorModeForRenderPass()),function(p,_){const b=p.context,C=b.gl,O=_.heatmapFbo;if(!O)return;b.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,O.colorAttachment.get()),b.activeTexture.set(C.TEXTURE1);let P=_.colorRampTexture;P||(P=_.colorRampTexture=new n.T(b,_.colorRamp,C.RGBA8)),P.bind(C.LINEAR,C.CLAMP_TO_EDGE),p.getOrCreateProgram("heatmapTexture").draw(p,C.TRIANGLES,ci.disabled,vi.disabled,p.colorModeForRenderPass(),yi.disabled,((F,V,U,H)=>({u_image:0,u_color_ramp:1,u_opacity:V.paint.get("heatmap-opacity")}))(0,_),_.id,p.viewportBuffer,p.quadTriangleIndexBuffer,p.viewportSegments,_.paint,p.transform.zoom)}(c,r))},line:function(c,t,r,u){if(c.renderPass!=="translucent")return;const p=r.paint.get("line-opacity"),_=r.paint.get("line-width");if(p.constantOr(1)===0||_.constantOr(1)===0)return;const b=r.paint.get("line-emissive-strength"),C=r.paint.get("line-occlusion-opacity"),O=r.layout.get("line-elevation-reference"),P=r.layout.get("line-width-unit")==="meters",F=O==="sea",V=c.context,U=V.gl;if(r.hasElevatedBuckets&&c.transform.projection.name==="globe")return;const H=r.layout.get("line-cross-slope"),J=H!==void 0,$=H<1,te=c.colorModeForDrapableLayerRenderPass(b),ee=c.terrain&&c.terrain.renderingToTexture,le=ee?1:n.q.devicePixelRatio,pe=r.paint.get("line-dasharray"),fe=pe.constantOr(1),be=r.layout.get("line-cap"),me=pe.constantOr(null),ve=be.constantOr(null),_e=r.paint.get("line-pattern"),Ee=_e.constantOr(1),ze=_e.constantOr(null),Ye=r.paint.get("line-opacity").constantOr(1);let qe=!Ee&&Ye!==1||c.depthOcclusion&&C>0&&C<1;const lt=r.paint.get("line-gradient"),it=Ee?"linePattern":"line",Be=n.c_(r);let Ke;if(ee&&c.terrain&&c.terrain.clipOrMaskOverlapStencilType()&&(qe=!1),C!==0&&c.depthOcclusion){const Fe=r.paint._values["line-opacity"];Fe&&Fe.value&&Fe.value.kind==="constant"?Ke=Fe.value:n.w(`Occlusion opacity for layer ${r.id} is supported only when line-opacity isn't data-driven.`)}_.value.kind!=="constant"&&_.value.isLineProgressConstant===!1&&Be.push("VARIABLE_LINE_WIDTH");const gt=(Fe,st,Je,St,dt)=>{for(const ct of Fe){const vt=t.getTile(ct);if(Ee&&!vt.patternsLoaded())continue;const Ct=vt.getBucket(r);if(!Ct||Ct.hasZOffset&&!dt||!Ct.hasZOffset&&dt)continue;c.prepareDrawTile();const Vt=Ct.programConfigurations.get(r.id),Yt=c.isTileAffectedByFog(ct),ui=c.getOrCreateProgram(it,{config:Vt,defines:st,overrideFog:Yt,overrideRtt:!dt&&void 0});if(ze&&vt.imageAtlas){const Ai=n.A.from(ze).getPrimary().scaleSelf(le).serialize(),rr=vt.imageAtlas.patternPositions[Ai];rr&&Vt.setConstantPatternPositions(rr)}if(!Ee&&me&&ve&&vt.lineAtlas){const Ai=vt.lineAtlas.getDash(me,ve);Ai&&Vt.setConstantPatternPositions(Ai)}let[oi,ri]=r.paint.get("line-trim-offset");(ve==="round"||ve==="square")&&oi!==ri&&(oi===0&&(oi-=1),ri===1&&(ri+=1));const xi=ee?ct.projMatrix:null,bi=P?1/Ct.tileToMeter/n.ar(vt,1,c.transform.zoom):1,pr=P?1/Ct.tileToMeter/n.ar(vt,1,Math.floor(c.transform.zoom)):1,Yr=Ee?n.c$(c,vt,r,xi,le,bi,pr,[oi,ri]):n.d0(c,vt,r,xi,Ct.lineClipsArray.length,le,bi,pr,[oi,ri]);if(lt){const Ai=Ct.gradients[r.id];let rr=Ai.texture;if(r.gradientVersion!==Ai.version){let Ut=256;if(r.stepInterpolant){const mi=t.getSource().maxzoom,hi=ct.canonical.z===mi?Math.ceil(1<<c.transform.maxZoom-ct.canonical.z):1;Ut=n.aw(n.d1(Ct.maxLineLength/n.ag*1024*hi),256,V.maxTextureSize)}Ai.gradient=n.d2({expression:r.gradientExpression(),evaluationKey:"lineProgress",resolution:Ut,image:Ai.gradient||void 0,clips:Ct.lineClipsArray}),Ai.texture?Ai.texture.update(Ai.gradient):Ai.texture=new n.T(V,Ai.gradient,U.RGBA8),Ai.version=r.gradientVersion,rr=Ai.texture}V.activeTexture.set(U.TEXTURE1),rr.bind(r.stepInterpolant?U.NEAREST:U.LINEAR,U.CLAMP_TO_EDGE)}fe&&(V.activeTexture.set(U.TEXTURE0),vt.lineAtlasTexture&&vt.lineAtlasTexture.bind(U.LINEAR,U.REPEAT),Vt.updatePaintBuffers()),Ee&&(V.activeTexture.set(U.TEXTURE0),vt.imageAtlasTexture&&vt.imageAtlasTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),Vt.updatePaintBuffers()),dt&&!F&&c.terrain.setupElevationDraw(vt,ui),c.uploadCommonUniforms(V,ui,ct.toUnwrapped());const Cr=Ai=>{Ke!=null&&(Ke.value=Ye*C),ui.draw(c,U.TRIANGLES,Je,Ai,te,yi.disabled,Yr,r.id,Ct.layoutVertexBuffer,Ct.indexBuffer,Ct.segments,r.paint,c.transform.zoom,Vt,[Ct.layoutVertexBuffer2,Ct.patternVertexBuffer,Ct.zOffsetVertexBuffer]),Ke!=null&&(Ke.value=Ye)};if(qe&&!dt){const Ai=c.stencilModeForClipping(ct).ref;Ai===0&&ee&&V.clear({stencil:0});const rr={func:U.EQUAL,mask:255};Yr.u_alpha_discard_threshold=.8,Cr(new vi(rr,Ai,255,U.KEEP,U.KEEP,U.INVERT)),Yr.u_alpha_discard_threshold=0,Cr(new vi(rr,Ai,255,U.KEEP,U.KEEP,U.KEEP))}else qe&&dt&&(Yr.u_alpha_discard_threshold=.001),Cr(dt?St:c.stencilModeForClipping(ct))}};if(r.hasNonElevatedBuckets){const Fe=!ee&&c.terrain;C!==0&&Fe?n.w(`Occlusion opacity for layer ${r.id} is supported on terrain only if the layer has line-z-offset enabled.`):Fe?n.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${r.id}.`):gt(u,Be,c.depthModeForSublayer(0,ci.ReadOnly),vi.disabled,!1)}if(r.hasElevatedBuckets){Be.push("ELEVATED"),J&&Be.push($?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),F&&Be.push("ELEVATION_REFERENCE_SEA");const Fe=qe?c.stencilModeFor3D():vi.disabled,st=new ci(c.depthOcclusion?U.GREATER:U.LEQUAL,ci.ReadOnly,c.depthRangeFor3D);c.forceTerrainMode=!0,gt(u,Be,st,Fe,!0),c.forceTerrainMode=!1}qe&&(c.resetStencilClippingMasks(),ee&&V.clear({stencil:0})),C===0||c.depthOcclusion||ee||c.layersWithOcclusionOpacity.push(c.currentLayer)},fill:function(c,t,r,u){const p=r.paint.get("fill-color"),_=r.paint.get("fill-opacity"),b=r.is3D(),C=new ci(c.context.gl.LEQUAL,ci.ReadWrite,c.depthRangeFor3D);if(_.constantOr(1)===0)return;const O=r.paint.get("fill-emissive-strength"),P=c.colorModeForDrapableLayerRenderPass(O),F=r.paint.get("fill-pattern"),V=c.opaquePassEnabledForLayer()&&!F.constantOr(1)&&p.constantOr(n.aj.transparent).a===1&&_.constantOr(0)===1?"opaque":"translucent";if(c.renderPass===V){const U=b?C:c.depthModeForSublayer(1,c.renderPass==="opaque"?ci.ReadWrite:ci.ReadOnly);qs(c,t,r,u,U,P,!1)}if(!b&&c.renderPass==="translucent"&&r.paint.get("fill-antialias")){const U=b?C:c.depthModeForSublayer(r.getPaintProperty("fill-outline-color")?2:0,ci.ReadOnly);qs(c,t,r,u,U,P,!0)}},"fill-extrusion":function(c,t,r,u){const p=r.paint.get("fill-extrusion-opacity"),_=c.context,b=_.gl,C=c.terrain,O=C&&C.renderingToTexture;if(p===0)return;const P=c.conflationActive&&c.style.isLayerClipped(r,t.getSource()),F=c.style.order.indexOf(r.fqid);if(P&&function(V,U,H,J,$){for(const te of J){const ee=U.getTile(te).getBucket(H);ee&&(ee.updateReplacement(te,V.replacementSource,$),ee.uploadCentroid(V.context))}}(c,t,r,u,F),C||P)for(const V of u){const U=t.getTile(V).getBucket(r);U&&Ml(c.context,t,V,U,r,C,P)}if(c.renderPass==="shadow"&&c.shadowRenderer){const V=c.shadowRenderer;if(C&&p<.65&&r._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof n.a9)return;const U=V.getShadowPassDepthMode(),H=V.getShadowPassColorMode();Sl(c,t,r,u,U,vi.disabled,H,P)}else if(c.renderPass==="translucent"){const V=!r.paint.get("fill-extrusion-pattern").constantOr(1),U=r.paint.get("fill-extrusion-color").constantOr(n.aj.white);if(!O&&U.a!==0){const H=new ci(c.context.gl.LEQUAL,ci.ReadWrite,c.depthRangeFor3D);p===1&&V?Sl(c,t,r,u,H,vi.disabled,Ui.unblended,P):(Sl(c,t,r,u,H,vi.disabled,Ui.disabled,P),Sl(c,t,r,u,H,c.stencilModeFor3D(),c.colorModeForRenderPass(),P),c.resetStencilClippingMasks())}if(c.style.enable3dLights()&&V&&(!C&&c.transform.projection.name!=="globe"||O)){const H=r.paint.get("fill-extrusion-opacity"),J=r.paint.get("fill-extrusion-ambient-occlusion-intensity"),$=r.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),te=r.paint.get("fill-extrusion-flood-light-intensity"),ee=r.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",le=r.paint.get("fill-extrusion-flood-light-color").toRenderColor(ee?null:r.lut).toArray01().slice(0,3),pe=J>0&&$>0,fe=te>0,be=(ve,_e,Ee)=>(1-Ee)*ve+Ee*_e,me=ve=>{const _e=c.depthModeForSublayer(1,ci.ReadOnly,b.LEQUAL,!0),Ee=r.paint.get(ve?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ze=be(.1,3,Ee),Ye=c._showOverdrawInspector;if(!Ye){const qe=new vi({func:b.ALWAYS,mask:255},255,255,b.KEEP,b.KEEP,b.REPLACE),lt=new Ui([b.ONE,b.ONE,b.ONE,b.ONE],n.aj.transparent,[!1,!1,!1,!0],b.MIN);El(c,t,r,u,_e,qe,lt,yi.disabled,ve,"sdf",H,J,$,te,le,ze,P,!1)}{const qe=Ye?vi.disabled:new vi({func:b.EQUAL,mask:255},255,255,b.KEEP,b.DECR,b.DECR),lt=Ye?c.colorModeForRenderPass():new Ui([b.ONE_MINUS_DST_ALPHA,b.DST_ALPHA,b.ONE,b.ONE],n.aj.transparent,[!0,!0,!0,!0]);El(c,t,r,u,_e,qe,lt,yi.disabled,ve,"color",H,J,$,te,le,ze,P,!1)}};if(O){const ve=(_e,Ee,ze)=>{const Ye=c.depthModeForSublayer(1,ci.ReadOnly,b.LEQUAL,!1),qe=r.paint.get(_e?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),lt=be(.1,3,qe);{const it=new Ui([b.ONE,b.ONE,b.ONE,b.ONE],n.aj.transparent,[!1,!1,!1,!0]);El(c,t,r,u,Ye,vi.disabled,it,yi.disabled,_e,"clear",H,J,$,te,le,lt,P,Ee)}{const it=new vi({func:b.ALWAYS,mask:255},255,255,b.KEEP,b.KEEP,b.REPLACE),Be=new Ui([b.ONE,b.ONE,b.ONE,b.ONE],n.aj.transparent,[!1,!1,!1,!0],b.MIN);El(c,t,r,u,Ye,it,Be,yi.disabled,_e,"sdf",H,J,$,te,le,lt,P,Ee)}{const it=_e?b.ZERO:b.ONE_MINUS_DST_ALPHA,Be=new vi({func:b.EQUAL,mask:255},255,255,b.KEEP,b.DECR,b.DECR),Ke=new Ui([it,b.DST_ALPHA,b.ONE_MINUS_DST_ALPHA,b.ZERO],n.aj.transparent,[!0,!0,!0,!0]);El(c,t,r,u,Ye,Be,Ke,yi.disabled,_e,"color",H,J,$,te,le,lt,P,Ee)}{const it=new Ui([b.ONE,b.ONE,b.ONE,_e?b.ZERO:b.ONE],n.aj.transparent,[!1,!1,!1,!0],_e?b.FUNC_ADD:b.MAX);El(c,t,r,u,Ye,vi.disabled,it,yi.disabled,_e,"clear",H,J,$,te,le,lt,P,Ee,ze)}};if(pe||fe){let _e;if(c.prepareDrawTile(),C){const Ee=C.drapeBufferSize[0],ze=C.drapeBufferSize[1];_e=C.framebufferCopyTexture,_e&&(!_e||_e.size[0]===Ee&&_e.size[1]===ze)||(_e&&_e.destroy(),_e=C.framebufferCopyTexture=new n.T(_,new n.r({width:Ee,height:ze}),b.RGBA8)),_e.bind(b.LINEAR,b.CLAMP_TO_EDGE),b.copyTexSubImage2D(b.TEXTURE_2D,0,0,0,0,0,Ee,ze)}pe&&ve(!0,!1,_e),fe&&ve(!1,!0,_e)}}else pe&&me(!0),fe&&me(!1),(pe||fe)&&c.resetStencilClippingMasks()}}},hillshade:function(c,t,r,u){if(c.renderPass!=="offscreen"&&c.renderPass!=="translucent"||c.style.disableElevatedTerrain)return;const p=c.context,_=c.terrain&&c.terrain.renderingToTexture,[b,C]=c.renderPass!=="translucent"||_?[{},u]:c.stencilConfigForOverlap(u);for(const O of C){const P=t.getTile(O);if(P.needsHillshadePrepare&&c.renderPass==="offscreen")Zc(c,P,r);else if(c.renderPass==="translucent"){const F=c.depthModeForSublayer(0,ci.ReadOnly),V=r.paint.get("hillshade-emissive-strength"),U=c.colorModeForDrapableLayerRenderPass(V),H=_&&c.terrain?c.terrain.stencilModeForRTTOverlap(O):b[O.overscaledZ];Ka(c,O,P,r,F,H,U)}}p.viewport.set([0,0,c.width,c.height]),c.resetStencilClippingMasks()},raster:function(c,t,r,u,p,_){if(c.renderPass!=="translucent"||r.paint.get("raster-opacity")===0)return;const b=c.transform.projection.name==="globe",C=r.paint.get("raster-elevation")!==0,O=C&&b;if(c.renderElevatedRasterBackface&&!O)return;const P=c.context,F=P.gl,V=t.getSource(),U=function(me,ve,_e,Ee){const ze=ve.paint.get("raster-color"),Ye=me.type==="raster-array",qe=[],lt=ve.paint.get("raster-resampling"),it=ve.paint.get("raster-color-mix");let Be=ve.paint.get("raster-color-range");const Ke=[it[0],it[1],it[2],0],gt=it[3];let Fe=lt==="nearest"?Ee.NEAREST:Ee.LINEAR;if(Ye&&(qe.push("RASTER_ARRAY"),ze||qe.push("RASTER_COLOR"),lt==="linear"&&qe.push("RASTER_ARRAY_LINEAR"),Fe=Ee.NEAREST,!Be&&me.rasterLayers)){const st=me.rasterLayers.find(({id:Je})=>Je===ve.sourceLayer);st&&st.fields&&st.fields.range&&(Be=st.fields.range)}if(Be=Be||[0,1],ze){qe.push("RASTER_COLOR"),_e.activeTexture.set(Ee.TEXTURE2),ve.updateColorRamp(Be);let st=ve.colorRampTexture;st||(st=ve.colorRampTexture=new n.T(_e,ve.colorRamp,Ee.RGBA8)),st.bind(Ee.LINEAR,Ee.CLAMP_TO_EDGE)}return{mix:Ke,range:Be,offset:gt,defines:qe,resampling:Fe}}(V,r,P,F);if(V instanceof n.aJ&&!u.length&&!b)return;const H=r.paint.get("raster-emissive-strength"),J=c.colorModeForDrapableLayerRenderPass(H),$=c.terrain&&c.terrain.renderingToTexture,te=!c.options.moving,ee=r.paint.get("raster-resampling")==="nearest"?F.NEAREST:F.LINEAR;if(V instanceof n.aJ&&!u.length&&(V.onNorthPole||V.onSouthPole)){const me=C?c.stencilModeFor3D():vi.disabled;return void Ge(!!V.onNorthPole,null,c,t,r,H,U,yi.disabled,me)}if(!u.length)return;const[le,pe]=V instanceof n.aJ||$?[{},u]:c.stencilConfigForOverlap(u),fe=pe[pe.length-1].overscaledZ;O&&U.defines.push("PROJECTION_GLOBE_VIEW"),C&&U.defines.push("RENDER_CUTOFF");const be=(me,ve,_e)=>{for(const Ee of me){const ze=Ee.toUnwrapped(),Ye=t.getTile(Ee);if($&&(!Ye||!Ye.hasData()))continue;P.activeTexture.set(F.TEXTURE0);const qe=sh(Ye,V,r,U);if(!qe||!qe.texture)continue;const{texture:lt,mix:it,offset:Be,tileSize:Ke,buffer:gt}=qe;let Fe,st;$?(Fe=ci.disabled,st=Ee.projMatrix):C?(Fe=new ci(F.LEQUAL,ci.ReadWrite,c.depthRangeFor3D),st=b?Float32Array.from(c.transform.expandedFarZProjMatrix):c.transform.calculateProjMatrix(ze,te)):(Fe=c.depthModeForSublayer(Ee.overscaledZ-fe,r.paint.get("raster-opacity")===1?ci.ReadWrite:ci.ReadOnly,F.LESS),st=c.transform.calculateProjMatrix(ze,te));const Je=c.terrain&&$?c.terrain.stencilModeForRTTOverlap(Ee):le[Ee.overscaledZ],St=_?0:r.paint.get("raster-fade-duration");Ye.registerFadeDuration(St);const dt=t.findLoadedParent(Ee,0),ct=ga(Ye,dt,t,c.transform,St);let vt,Ct;c.terrain&&c.terrain.prepareDrawTile(),P.activeTexture.set(F.TEXTURE0),lt.bind(ee,F.CLAMP_TO_EDGE),P.activeTexture.set(F.TEXTURE1),dt?(dt.texture&&dt.texture.bind(ee,F.CLAMP_TO_EDGE),vt=Math.pow(2,dt.tileID.overscaledZ-Ye.tileID.overscaledZ),Ct=[Ye.tileID.canonical.x*vt%1,Ye.tileID.canonical.y*vt%1]):lt.bind(ee,F.CLAMP_TO_EDGE),lt.useMipmap&&P.extTextureFilterAnisotropic&&c.transform.pitch>20&&F.texParameterf(F.TEXTURE_2D,P.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,P.extTextureFilterAnisotropicMax);const Vt=c.transform;let Yt;const ui=C?uf(Vt):[0,0,0,0];let oi,ri,xi,bi,pr,Yr=0;if(O&&V instanceof n.aJ&&V.coordinates.length>3)oi=Float32Array.from(n.bb(n.cH(new n.bT(0,0,0)))),ri=Float32Array.from(Vt.globeMatrix),xi=Float32Array.from(n.cD(Vt)),bi=[n.at(Vt.center.lng),n.aA(Vt.center.lat)],Yt=V.elevatedGlobePerspectiveTransform,pr=V.elevatedGlobeGridMatrix||new Float32Array(9);else if(O){const Ut=n.cE(Ee.canonical);Yr=n.cF(Ut.getCenter().lat),oi=Float32Array.from(n.bb(n.cH(Ee.canonical))),ri=Float32Array.from(Vt.globeMatrix),xi=Float32Array.from(n.cD(Vt)),bi=[n.at(Vt.center.lng),n.aA(Vt.center.lat)],Yt=[0,0],pr=Float32Array.from(n.cG(Ee.canonical,Ut,Yr,Vt.worldSize/Vt._pixelsPerMercatorPixel))}else Yt=V instanceof n.aJ?V.perspectiveTransform:[0,0],oi=new Float32Array(16),ri=new Float32Array(9),xi=new Float32Array(16),bi=[0,0],pr=new Float32Array(9);const Cr=No(st,oi,ri,xi,pr,Ct||[0,0],n.ae(c.transform.zoom),bi,ui,vt||1,ct,r,Yt,C?r.paint.get("raster-elevation"):0,2,it,Be,U.range,Ke,gt,H),Ai=c.isTileAffectedByFog(Ee),rr=c.getOrCreateProgram("raster",{defines:U.defines,overrideFog:Ai});if(c.uploadCommonUniforms(P,rr,ze),V instanceof n.aJ){const Ut=V.elevatedGlobeVertexBuffer,mi=V.elevatedGlobeIndexBuffer;if($||!b)V.boundsBuffer&&V.boundsSegments&&rr.draw(c,F.TRIANGLES,Fe,vi.disabled,J,yi.disabled,Cr,r.id,V.boundsBuffer,c.quadTriangleIndexBuffer,V.boundsSegments);else if(Ut&&mi){const hi=Vt.zoom<=n.c6?V.elevatedGlobeSegments:V.getSegmentsForLongitude(Vt.center.lng);hi&&rr.draw(c,F.TRIANGLES,Fe,vi.disabled,J,ve,Cr,r.id,Ut,mi,hi)}}else if(O){Fe=new ci(F.LEQUAL,ci.ReadOnly,c.depthRangeFor3D);const Ut=c.globeSharedBuffers;if(Ut){const[mi,hi,_i]=Ut.getGridBuffers(Yr,!1);rr.draw(c,F.TRIANGLES,Fe,_e||Je,c.colorModeForRenderPass(),ve,Cr,r.id,mi,hi,_i)}}else{const{tileBoundsBuffer:Ut,tileBoundsIndexBuffer:mi,tileBoundsSegments:hi}=c.getTileBoundsBuffers(Ye);rr.draw(c,F.TRIANGLES,Fe,Je,J,yi.disabled,Cr,r.id,Ut,mi,hi)}}if(!(V instanceof n.aJ)&&O)for(const Ee of me){const ze=Ee.canonical.y===(1<<Ee.canonical.z)-1;Ee.canonical.y===0&&Ge(!0,Ee,c,t,r,H,U,ve,_e||vi.disabled),ze&&Ge(!1,Ee,c,t,r,H,U,ve===yi.frontCW?yi.backCW:yi.frontCW,_e||vi.disabled)}};O?be(pe,c.renderElevatedRasterBackface?yi.backCW:yi.frontCW,c.stencilModeFor3D()):be(pe,yi.disabled,void 0),c.resetStencilClippingMasks()},"raster-particle":function(c,t,r,u,p,_){c.renderPass==="offscreen"&&function(b,C,O,P){if(!P.length)return;const F=b.context,V=F.gl,U=C.getSource();if(!(U instanceof an))return;const H=Math.ceil(Math.sqrt(O.paint.get("raster-particle-count")));let J=O.particlePositionRGBAImage;if(!J||J.width!==H){const pe=function(fe){const be=fe*fe,me=new Uint8Array(4*be),ve=function(Ee){return Ee|=0,Ee=Math.imul(2747636419^Ee,2654435769),Ee=Math.imul(Ee^Ee>>>16,2654435769),((Ee=Math.imul(Ee^Ee>>>16,2654435769))>>>0)/4294967296},_e=1/1.1;for(let Ee=0;Ee<be;Ee++){const ze=_e*(ve(2*Ee+0)+It),Ye=_e*(ve(2*Ee+1)+It),qe=255*ze%1,lt=255*Ye%1,it=qe,Be=Ye-lt/255,Ke=lt;me[4*Ee+0]=255*(ze-qe/255),me[4*Ee+1]=255*it,me[4*Ee+2]=255*Be,me[4*Ee+3]=255*Ke}return me}(H);J=O.particlePositionRGBAImage=new n.r({width:H,height:H},pe)}let $=O.particleFramebuffer;$?$.width!==H&&($.destroy(),$=O.particleFramebuffer=F.createFramebuffer(H,H,!0,null)):$=O.particleFramebuffer=F.createFramebuffer(H,H,!0,null);const te=[];for(const pe of P){const fe=C.getTile(pe);if(!(fe instanceof Co))continue;const be=gd(fe,U,O);if(!be)continue;const me=[fe.tileSize,fe.tileSize];let ve=O.tileFramebuffer;ve||(ve=O.tileFramebuffer=F.createFramebuffer(me[0],me[1],!0,null));let _e=fe.rasterParticleState;_e||(_e=fe.rasterParticleState=new _d(F,pe,me,J));const Ee=_e.update(O.lastInvalidatedAt);_e.particleTextureDimension!==H&&_e.updateParticleTexture(pe,J);const ze=_e.targetColorTexture;_e.targetColorTexture=_e.backgroundColorTexture,_e.backgroundColorTexture=ze;const Ye=_e.particleTexture0;_e.particleTexture0=_e.particleTexture1,_e.particleTexture1=Ye,te.push([pe,be,_e,Ee])}if(te.length===0)return;const ee=n.q.now(),le=O.previousDrawTimestamp?.001*(ee-O.previousDrawTimestamp):.0167;if(O.previousDrawTimestamp=ee,O.hasColorMap()){F.activeTexture.set(V.TEXTURE0+2);let pe=O.colorRampTexture;pe||(pe=O.colorRampTexture=new n.T(F,O.colorRamp,V.RGBA8)),pe.bind(V.LINEAR,V.CLAMP_TO_EDGE)}F.bindFramebuffer.set(O.tileFramebuffer.framebuffer),function(pe,fe,be){const me=pe.context,ve=me.gl,_e=fe.tileFramebuffer;me.activeTexture.set(ve.TEXTURE0);const Ee={u_texture:0,u_opacity:1.05*(Ye=fe.paint.get("raster-particle-fade-opacity-factor"))/(Ye+.05)},ze=pe.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Ye;for(const qe of be){const[,,lt,it]=qe;_e.colorAttachment.set(lt.targetColorTexture.texture),me.viewport.set([0,0,_e.width,_e.height]),me.clear({color:n.aj.transparent}),it&&(lt.backgroundColorTexture.bind(ve.NEAREST,ve.CLAMP_TO_EDGE),ze.draw(pe,ve.TRIANGLES,ci.disabled,vi.disabled,Ui.alphaBlended,yi.disabled,Ee,fe.id,pe.viewportBuffer,pe.quadTriangleIndexBuffer,pe.viewportSegments))}}(b,O,te),function(pe,fe,be,me){const ve=pe.context,_e=ve.gl,Ee=be.tileFramebuffer,ze=pe.transform.projection.name==="globe",Ye=be.paint.get("raster-particle-max-speed");for(const qe of me){const[lt,it,Be]=qe;ve.activeTexture.set(_e.TEXTURE0+0),it.texture.bind(_e.LINEAR,_e.CLAMP_TO_EDGE),Ee.colorAttachment.set(Be.targetColorTexture.texture);const Ke=pe.getOrCreateProgram("rasterParticleDraw",{defines:it.defines,overrideFog:!1});ve.activeTexture.set(_e.TEXTURE0+1);const gt=it.scalarData?[]:[0,1,2,3].map(Je=>n.d4[Je](lt));gt.push(lt);const Fe=lt.canonical.x,st=lt.canonical.y;for(const Je of gt){const St=fe.getTile(ze?Je.wrapped():Je);if(!St)continue;const dt=St.rasterParticleState;if(!dt)continue;const ct=Je.canonical.x+(1<<Je.canonical.z)*(Je.wrap-lt.wrap),vt=Je.canonical.y;dt.particleTexture0.bind(_e.NEAREST,_e.CLAMP_TO_EDGE);const Ct=On(1,dt.particleTexture0.size[0],[ct-Fe,vt-st],0,it.texture.size,2,Ye,it.textureOffset,it.scale,it.offset);Ke.draw(pe,_e.POINTS,ci.disabled,vi.disabled,Ui.alphaBlended,yi.disabled,Ct,be.id,dt.particleIndexBuffer,void 0,dt.particleSegment)}}}(b,C,O,te),F.bindFramebuffer.set(O.particleFramebuffer.framebuffer),function(pe,fe,be,me){const ve=pe.context,_e=ve.gl,Ee=fe.paint.get("raster-particle-max-speed"),ze=me*fe.paint.get("raster-particle-speed-factor")*.15,Ye=function(lt){return Math.pow(lt,6)}(.01+1*fe.paint.get("raster-particle-reset-rate-factor")),qe=fe.particleFramebuffer;ve.viewport.set([0,0,qe.width,qe.height]);for(const lt of be){const[,it,Be]=lt;ve.activeTexture.set(_e.TEXTURE0+0),it.texture.bind(_e.LINEAR,_e.CLAMP_TO_EDGE),ve.activeTexture.set(_e.TEXTURE0+1);const Ke=Be.particleTexture0;Ke.bind(_e.NEAREST,_e.CLAMP_TO_EDGE);const gt=cf(1,Ke.size[0],0,it.texture.size,Ee,ze,Ye,it.textureOffset,it.scale,it.offset);qe.colorAttachment.set(Be.particleTexture1.texture),ve.clear({color:n.aj.transparent}),pe.getOrCreateProgram("rasterParticleUpdate",{defines:it.defines}).draw(pe,_e.TRIANGLES,ci.disabled,vi.disabled,Ui.unblended,yi.disabled,gt,fe.id,pe.viewportBuffer,pe.quadTriangleIndexBuffer,pe.viewportSegments)}}(b,O,te,le)}(c,t,r,u),c.renderPass==="translucent"&&(function(b,C,O,P,F){const V=b.context,U=V.gl,H=C.getSource().tileSize,J=5*(1-n.ac(n.bY,n.bY+1,b.transform.zoom))*H+O.paint.get("raster-particle-elevation"),$=!b.options.moving,te=b.transform.projection.name==="globe";if(!P.length)return;const[ee,le]=b.stencilConfigForOverlap(P),pe=[];te&&pe.push("PROJECTION_GLOBE_VIEW");const fe=b.stencilModeFor3D();for(const be of le){const me=be.toUnwrapped(),ve=C.getTile(be);if(!ve.rasterParticleState)continue;const _e=ve.rasterParticleState,Ee=100;ve.registerFadeDuration(Ee);const ze=C.findLoadedParent(be,0),Ye=ga(ve,ze,C,b.transform,Ee);let qe,lt;b.terrain&&b.terrain.prepareDrawTile(),V.activeTexture.set(U.TEXTURE0),_e.targetColorTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),V.activeTexture.set(U.TEXTURE1),ze&&ze.rasterParticleState?(ze.rasterParticleState.targetColorTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),qe=Math.pow(2,ze.tileID.overscaledZ-ve.tileID.overscaledZ),lt=[ve.tileID.canonical.x*qe%1,ve.tileID.canonical.y*qe%1]):_e.targetColorTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE);const it=te?Float32Array.from(b.transform.expandedFarZProjMatrix):b.transform.calculateProjMatrix(me,$),Be=b.transform,Ke=yd(Be),gt=n.cE(be.canonical),Fe=n.cF(gt.getCenter().lat);let st,Je,St,dt,ct;te?(st=Float32Array.from(n.bb(n.cH(be.canonical))),Je=Float32Array.from(Be.globeMatrix),St=Float32Array.from(n.cD(Be)),dt=[n.at(Be.center.lng),n.aA(Be.center.lat)],ct=Float32Array.from(n.cG(be.canonical,gt,Fe,Be.worldSize/Be._pixelsPerMercatorPixel))):(st=new Float32Array(16),Je=new Float32Array(9),St=new Float32Array(16),dt=[0,0],ct=new Float32Array(9));const vt=Ur(it,st,Je,St,ct,lt||[0,0],n.ae(b.transform.zoom),dt,Ke,qe||1,Ye,J),Ct=b.isTileAffectedByFog(be),Vt=b.getOrCreateProgram("rasterParticle",{defines:pe,overrideFog:Ct});if(b.uploadCommonUniforms(V,Vt,me),te){const Yt=new ci(U.LEQUAL,ci.ReadOnly,b.depthRangeFor3D),ui=0,oi=b.globeSharedBuffers;if(oi){const[ri,xi,bi]=oi.getGridBuffers(Fe,ui!==0);Vt.draw(b,U.TRIANGLES,Yt,fe,Ui.alphaBlended,b.renderElevatedRasterBackface?yi.frontCCW:yi.backCCW,vt,O.id,ri,xi,bi)}}else{const Yt=b.depthModeForSublayer(0,ci.ReadOnly),ui=ee[be.overscaledZ],{tileBoundsBuffer:oi,tileBoundsIndexBuffer:ri,tileBoundsSegments:xi}=b.getTileBoundsBuffers(ve);Vt.draw(b,U.TRIANGLES,Yt,ui,Ui.alphaBlended,yi.disabled,vt,O.id,oi,ri,xi)}}b.resetStencilClippingMasks()}(c,t,r,u),c.style.map.triggerRepaint())},background:function(c,t,r,u){const p=r.paint.get("background-color"),_=r.paint.get("background-color-use-theme").constantOr("default")==="none",b=r.paint.get("background-opacity"),C=r.paint.get("background-emissive-strength"),O=r.paint.get("background-pitch-alignment")==="viewport";if(b===0)return;const P=c.context,F=P.gl,V=c.transform,U=V.tileSize,H=r.paint.get("background-pattern");let J;if(H!==void 0&&(H===null||(J=c.imageManager.getPattern(H.toString(),r.scope,c.style.getLut(r.scope)),!J)))return;const $=!H&&p.a===1&&b===1&&c.opaquePassEnabledForLayer()?"opaque":"translucent";if(c.renderPass!==$)return;const te=vi.disabled,ee=c.depthModeForSublayer(0,$==="opaque"?ci.ReadWrite:ci.ReadOnly),le=c.colorModeForDrapableLayerRenderPass(C),pe=H?"backgroundPattern":"background";let fe,be=u;if(be||(fe=c.getBackgroundTiles(),be=Object.values(fe).map(me=>me.tileID)),H&&(P.activeTexture.set(F.TEXTURE0),c.imageManager.bind(c.context,r.scope)),O){const me=c.getOrCreateProgram(pe,{overrideFog:!1,overrideRtt:!0}),ve=new Float32Array(n.ab.mat4.identity([])),_e=new n.aG(0,0,0,0,0),Ee=H?nu(ve,C,b,c,0,r.scope,J,O,{tileID:_e,tileSize:U}):ru(ve,C,b,p.toRenderColor(_?null:r.lut));me.draw(c,F.TRIANGLES,ee,te,le,yi.disabled,Ee,r.id,c.viewportBuffer,c.quadTriangleIndexBuffer,c.viewportSegments)}else for(const me of be){const ve=c.isTileAffectedByFog(me),_e=c.getOrCreateProgram(pe,{overrideFog:ve}),Ee=me.toUnwrapped(),ze=u?me.projMatrix:c.transform.calculateProjMatrix(Ee);c.prepareDrawTile();const Ye=t?t.getTile(me):fe?fe[me.key]:new Ao(me,U,V.zoom,c),qe=H?nu(ze,C,b,c,0,r.scope,J,O,{tileID:me,tileSize:U}):ru(ze,C,b,p.toRenderColor(_?null:r.lut));c.uploadCommonUniforms(P,_e,Ee);const{tileBoundsBuffer:lt,tileBoundsIndexBuffer:it,tileBoundsSegments:Be}=c.getTileBoundsBuffers(Ye);_e.draw(c,F.TRIANGLES,ee,te,le,yi.disabled,qe,r.id,lt,it,Be)}},sky:function(c,t,r){const u=c._atmosphere?n.ae(c.transform.zoom):1,p=r.paint.get("sky-opacity")*u;if(p===0)return;const _=c.context,b=r.paint.get("sky-type"),C=new ci(_.gl.LEQUAL,ci.ReadOnly,[0,1]),O=c.frameCounter/1e3%1;b==="atmosphere"?c.renderPass==="offscreen"?r.needsSkyboxCapture(c)&&(function(P,F,V,U){const H=P.context,J=H.gl;let $=F.skyboxFbo;if(!$){$=F.skyboxFbo=H.createFramebuffer(32,32,!0,null),F.skyboxGeometry=new bd(H),F.skyboxTexture=H.gl.createTexture(),J.bindTexture(J.TEXTURE_CUBE_MAP,F.skyboxTexture),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_WRAP_S,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_WRAP_T,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_MIN_FILTER,J.LINEAR),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_MAG_FILTER,J.LINEAR);for(let pe=0;pe<6;++pe)J.texImage2D(J.TEXTURE_CUBE_MAP_POSITIVE_X+pe,0,J.RGBA,32,32,0,J.RGBA,J.UNSIGNED_BYTE,null)}H.bindFramebuffer.set($.framebuffer),H.viewport.set([0,0,32,32]);const te=F.getCenter(P,!0),ee=P.getOrCreateProgram("skyboxCapture"),le=new Float64Array(16);n.ab.mat4.identity(le),n.ab.mat4.rotateY(le,le,.5*-Math.PI),_n(P,F,ee,le,te,0),n.ab.mat4.identity(le),n.ab.mat4.rotateY(le,le,.5*Math.PI),_n(P,F,ee,le,te,1),n.ab.mat4.identity(le),n.ab.mat4.rotateX(le,le,.5*-Math.PI),_n(P,F,ee,le,te,2),n.ab.mat4.identity(le),n.ab.mat4.rotateX(le,le,.5*Math.PI),_n(P,F,ee,le,te,3),n.ab.mat4.identity(le),_n(P,F,ee,le,te,4),n.ab.mat4.identity(le),n.ab.mat4.rotateY(le,le,Math.PI),_n(P,F,ee,le,te,5),H.viewport.set([0,0,P.width,P.height])}(c,r),r.markSkyboxValid(c)):c.renderPass==="sky"&&function(P,F,V,U,H){const J=P.context,$=J.gl,te=P.transform,ee=P.getOrCreateProgram("skybox");J.activeTexture.set($.TEXTURE0),$.bindTexture($.TEXTURE_CUBE_MAP,F.skyboxTexture);const le=((pe,fe,be,me,ve)=>({u_matrix:pe,u_sun_direction:fe,u_cubemap:0,u_opacity:me,u_temporal_offset:ve}))(te.skyboxMatrix,F.getCenter(P,!1),0,U,H);P.uploadCommonUniforms(J,ee),ee.draw(P,$.TRIANGLES,V,vi.disabled,P.colorModeForRenderPass(),yi.backCW,le,"skybox",F.skyboxGeometry.vertexBuffer,F.skyboxGeometry.indexBuffer,F.skyboxGeometry.segment)}(c,r,C,p,O):b==="gradient"&&c.renderPass==="sky"&&function(P,F,V,U,H){const J=P.context,$=J.gl,te=P.transform,ee=P.getOrCreateProgram("skyboxGradient");F.skyboxGeometry||(F.skyboxGeometry=new bd(J)),J.activeTexture.set($.TEXTURE0);let le=F.colorRampTexture;le||(le=F.colorRampTexture=new n.T(J,F.colorRamp,$.RGBA8)),le.bind($.LINEAR,$.CLAMP_TO_EDGE);const pe=((fe,be,me,ve,_e)=>({u_matrix:fe,u_color_ramp:0,u_center_direction:be,u_radius:n.ai(me),u_opacity:ve,u_temporal_offset:_e}))(te.skyboxMatrix,F.getCenter(P,!1),F.paint.get("sky-gradient-radius"),U,H);P.uploadCommonUniforms(J,ee),ee.draw(P,$.TRIANGLES,V,vi.disabled,P.colorModeForRenderPass(),yi.backCW,pe,"skyboxGradient",F.skyboxGeometry.vertexBuffer,F.skyboxGeometry.indexBuffer,F.skyboxGeometry.segment)}(c,r,C,p,O)},debug:function(c,t,r,u,p,_){for(let b=0;b<r.length;b++)if(p){const P=new n.aj(u.r*.8,u.g*.8,u.b*.8,1);qo(c,t,r[b],u,-1,-1,_),qo(c,t,r[b],u,-1,1,_),qo(c,t,r[b],u,1,1,_),qo(c,t,r[b],u,1,-1,_),qo(c,t,r[b],P,0,0,_)}else qo(c,t,r[b],u,0,0,_)},custom:function(c,t,r,u){const p=c.context,_=r.implementation;if(!c.transform.projection.unsupportedLayers||!c.transform.projection.unsupportedLayers.includes("custom")||c.terrain&&(c.terrain.renderingToTexture||c.renderPass==="offscreen")&&r.isDraped(t)){if(c.renderPass==="offscreen"){const b=_.prerender;if(b){if(c.setCustomLayerDefaults(),p.setColorMode(c.colorModeForRenderPass()),c.transform.projection.name==="globe"){const C=c.transform.pointMerc;b.call(_,p.gl,c.transform.customLayerMatrix(),c.transform.getProjection(),c.transform.globeToMercatorMatrix(),n.ae(c.transform.zoom),[C.x,C.y],c.transform.pixelsPerMeterRatio)}else b.call(_,p.gl,c.transform.customLayerMatrix());p.setDirty(),c.setBaseState()}}else if(c.renderPass==="translucent"){if(c.terrain&&c.terrain.renderingToTexture){const C=_.renderToTile;if(C){const O=u[0].canonical,P=new n.aa(O.x+u[0].wrap*(1<<O.z),O.y,O.z);p.setDepthMode(ci.disabled),p.setStencilMode(vi.disabled),p.setColorMode(c.colorModeForRenderPass()),c.setCustomLayerDefaults(),C.call(_,p.gl,P),p.setDirty(),c.setBaseState()}return}c.setCustomLayerDefaults(),p.setColorMode(c.colorModeForRenderPass()),p.setStencilMode(vi.disabled);const b=_.renderingMode==="3d"?new ci(c.context.gl.LEQUAL,ci.ReadWrite,c.depthRangeFor3D):c.depthModeForSublayer(0,ci.ReadOnly);if(p.setDepthMode(b),c.transform.projection.name==="globe"){const C=c.transform.pointMerc;_.render(p.gl,c.transform.customLayerMatrix(),c.transform.getProjection(),c.transform.globeToMercatorMatrix(),n.ae(c.transform.zoom),[C.x,C.y],c.transform.pixelsPerMeterRatio)}else _.render(p.gl,c.transform.customLayerMatrix());p.setDirty(),c.setBaseState(),p.bindFramebuffer.set(null)}}else n.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(c,t,r,u){if(c.renderPass==="opaque")return;const p=r.paint.get("model-opacity").constantOr(1);if(p===0)return;const _=r.paint.get("model-cast-shadows");if(c.renderPass==="shadow"&&(!_||c.terrain&&p<.65&&r._transitionablePaint._values["model-opacity"].value.expression instanceof n.a9))return;const b=c.shadowRenderer,C=r.paint.get("model-receive-shadows");b&&(b.useNormalOffset=!0,C||(b.enabled=!1));const O=()=>{b&&(b.useNormalOffset=!0,C||(b.enabled=!0))},P=t.getSource();if(c.renderPass==="light-beam"&&P.type!=="batched-model")return;if(P.type==="vector"||P.type==="geojson")return function(ee,le,pe,fe,be){const me=ee.transform;if(me.projection.name!=="mercator")return void n.w(`Drawing 3D models for ${me.projection.name} projection is not yet implemented`);const ve=me.getFreeCameraOptions().position;if(!ee.modelManager)return;const _e=ee.modelManager;pe.modelManager=_e;const Ee=ee.shadowRenderer;if(!pe._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const ze=pe._unevaluatedLayout._values["model-id"],Ye=Object.assign({},pe.layout.get("model-id").parameters),qe=ee.style.order.indexOf(pe.fqid);for(const lt of fe){const it=le.getTile(lt).getBucket(pe);if(!it||it.projection.name!==me.projection.name)continue;const Be=it.getModelUris();Be&&!it.modelsRequested&&(_e.addModelsFromBucket(Be,be),it.modelsRequested=!0);const Ke=uh(lt,me);Ye.zoom=Ke;const gt=ze.possiblyEvaluate(Ye);if(po(ee,it,lt),Yn.shadowUniformsInitialized=!1,Yn.useSingleShadowCascade=!!Ee&&Ee.getMaxCascadeForTile(lt.toUnwrapped())===0,ee.renderPass==="shadow"&&Ee){if(ee.currentShadowCascade===1&&it.isInsideFirstShadowMapFrustum)continue;const Je=me.calculatePosMatrix(lt.toUnwrapped(),me.worldSize);if(Yn.tileMatrix.set(Je),Yn.shadowTileMatrix=Float32Array.from(Ee.calculateShadowPassMatrixFromMatrix(Je)),Yn.aabb.min.fill(0),Yn.aabb.max[0]=Yn.aabb.max[1]=n.ag,Yn.aabb.max[2]=0,df(it,Yn,ee,pe.scope))continue}const Fe=1<<lt.canonical.z,st=[((ve.x-lt.wrap)*Fe-lt.canonical.x)*n.ag,(ve.y*Fe-lt.canonical.y)*n.ag,ve.z*Fe*n.ag];ee.conflationActive&&Object.keys(it.instancesPerModel).length>0&&ee.style.isLayerClipped(pe,le.getSource())&&it.updateReplacement(lt,ee.replacementSource,qe,be)&&(it.uploaded=!1,it.upload(ee.context));for(let Je in it.instancesPerModel){const St=it.instancesPerModel[Je];St.features.length>0&&(Je=gt.evaluate(St.features[0].feature,{}));const dt=_e.getModel(Je,be);if(dt&&dt.uploaded)for(const ct of dt.nodes)cu(ee,pe,ct,St,st,lt,Yn)}}}(c,t,r,u,P.type==="vector"?r.scope:""),void O();if(!P.loaded())return;if(P.type==="batched-model")return function(ee,le,pe,fe){pe.resetLayerRenderingStats(ee);const be=ee.context,me=ee.transform,ve=ee.style.fog,_e=ee.shadowRenderer;if(me.projection.name!=="mercator")return void n.w(`Drawing 3D landmark models for ${me.projection.name} projection is not yet implemented`);const Ee=ee.transform.getFreeCameraOptions().position,ze=n.ab.vec3.scale([],[Ee.x,Ee.y,Ee.z],ee.transform.worldSize),Ye=n.ab.vec3.negate([],ze),qe=n.ab.mat4.identity([]),lt=n.dj(me.center.lat,me.zoom),it=n.ab.mat4.fromScaling([],[1,1,1/lt]);n.ab.mat4.translate(qe,qe,Ye);const Be=pe.paint.get("model-opacity").constantOr(1),Ke=new ci(be.gl.LEQUAL,ci.ReadWrite,ee.depthRangeFor3D),gt=new ci(be.gl.LEQUAL,ci.ReadOnly,ee.depthRangeFor3D),Fe=new n.cd([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),st=ee.renderPass==="shadow",Je=st&&_e?_e.getCurrentCascadeFrustum():me.getFrustum(me.scaleZoom(me.worldSize)),St=pe.paint.get("model-front-cutoff"),dt=St[2]<1,ct=al(ee,pe.paint.get("model-cutoff-fade-range")),vt=pe.getLayerRenderingStats();(function(Ct,Vt,Yt,ui){const oi=Ct.terrain?Ct.terrain.exaggeration():0,ri=Ct.transform.zoom;for(const xi of ui){const bi=Vt.getTile(xi).getBucket(Yt);bi&&(Ct.conflationActive&&bi.updateReplacement(xi,Ct.replacementSource),bi.evaluateScale(Ct,Yt),Ct.terrain&&oi>0&&bi.elevationUpdate(Ct.terrain,oi,xi,Yt.source),bi.needsReEvaluation(Ct,ri,Yt)&&bi.evaluate(Yt))}})(ee,le,pe,fe),function(){let Ct,Vt,Yt;dt?(Ct=fe.length-1,Vt=-1,Yt=-1):(Ct=0,Vt=fe.length,Yt=1);const ui=new Float64Array(16),oi=n.ab.vec3.create(),ri=new n.P(0,0);for(let xi=Ct;xi!==Vt;xi+=Yt){const bi=fe[xi],pr=le.getTile(bi).getBucket(pe);if(!pr||!pr.uploaded)continue;let Yr=!1;_e&&(Yr=_e.getMaxCascadeForTile(bi.toUnwrapped())===0);const Cr=me.calculatePosMatrix(bi.toUnwrapped(),me.worldSize),Ai=pr.modelTraits;!st&&dt&&(n.ab.mat4.invert(ui,Cr),n.ab.vec3.transformMat4(oi,ze,ui),ri.x=oi[0],ri.y=oi[1]);const rr=[];for(const Ut of pr.getNodesInfo()){if(Ut.hiddenByReplacement||!Ut.node.meshes)continue;const mi=Ut.node;let hi=0;ee.terrain&&mi.elevation&&(hi=mi.elevation*ee.terrain.exaggeration());const _i=(()=>{const Qi=Ut.aabb;return Fe.min=[...Qi.min],Fe.max=[...Qi.max],Fe.min[2]+=hi,Fe.max[2]+=hi,n.ab.vec3.transformMat4(Fe.min,Fe.min,Cr),n.ab.vec3.transformMat4(Fe.max,Fe.max,Cr),Fe})(),Zi=Ut.evaluatedScale;if(Zi[0]<=1&&Zi[1]<=1&&Zi[2]<=1&&_i.intersects(Je)===0)continue;if(!st&&dt){const Qi=.16666666666666666;Ut.cameraCollisionOpacity=ze[0]>_i.min[0]&&ze[0]<_i.max[0]&&ze[1]>_i.min[1]&&ze[1]<_i.max[1]&&ze[2]*lt<_i.max[2]&&mi.footprint&&n.bA(ri,mi.footprint)?Math.max(Ut.cameraCollisionOpacity-Qi,0):Math.min(1,Ut.cameraCollisionOpacity+Qi)}const Ir=[...Cr],Fr=mi.anchor?mi.anchor[0]:0,Wr=mi.anchor?mi.anchor[1]:0;n.ab.mat4.translate(Ir,Ir,[Fr*(Zi[0]-1),Wr*(Zi[1]-1),hi]),n.ab.vec3.exactEquals(Zi,n.dm)||n.ab.mat4.scale(Ir,Ir,Zi);const Oa=n.ab.mat4.multiply([],Ir,mi.matrix),sn=n.ab.mat4.multiply([],me.expandedFarZProjMatrix,Oa),Ji=n.ab.mat4.multiply([],me.expandedFarZProjMatrix,Ir),fr=n.ab.vec4.transformMat4([],[Fr,Wr,hi,1],sn)[2];mi.hidden=!1;let hr=Be;st||(dt&&(hr*=Ut.cameraCollisionOpacity,hr*=wd(Ir,me,Ut.aabb,St)),hr*=Cl(ct,fr)),hr!==0?rr.push({nodeInfo:Ut,depth:fr,opacity:hr,wvpForNode:sn,wvpForTile:Ji,nodeModelMatrix:Oa,tileModelMatrix:Ir}):mi.hidden=!0}st||rr.sort((Ut,mi)=>!dt||Ut.opacity===1&&mi.opacity===1?Ut.depth<mi.depth?-1:1:Ut.opacity===1?-1:mi.opacity===1?1:Ut.depth>mi.depth?-1:1);for(const Ut of rr){const mi=Ut.nodeInfo,hi=mi.node;let _i=n.ab.mat4.multiply([],it,Ut.tileModelMatrix);n.ab.mat4.multiply(_i,qe,_i);const Zi=n.ab.mat4.invert([],_i);n.ab.mat4.transpose(Zi,Zi),n.ab.mat4.scale(Zi,Zi,hh),_i=n.ab.mat4.multiply(_i,_i,hi.matrix);const Ir=ee.renderPass==="light-beam",Fr=pe.paint.get("model-color-use-theme").constantOr("default")==="none",Wr=Ai&n.dp.HasMapboxMeshFeatures,Oa=Wr?0:mi.evaluatedRMEA[0][2];for(let sn=0;sn<hi.meshes.length;++sn){const Ji=hi.meshes[sn],fr=sn===hi.lightMeshIndex;let hr=Ut.wvpForNode;if(fr){if(!Ir&&!ee.terrain&&ee.shadowRenderer){ee.currentLayer<ee.firstLightBeamLayer&&(ee.firstLightBeamLayer=ee.currentLayer);continue}hr=Ut.wvpForTile}else if(Ir)continue;const Qi={defines:[]},Sr=[];if(!st&&_e&&(_e.useNormalOffset=!!Ji.normalBuffer),hc(Qi.defines,Sr,Ji,ee,Fr?null:pe.lut),Wr||Qi.defines.push("DIFFUSE_SHADED"),Yr&&Qi.defines.push("SHADOWS_SINGLE_CASCADE"),vt&&(st?vt.numRenderedVerticesInShadowPass+=Ji.vertexArray.length:vt.numRenderedVerticesInTransparentPass+=Ji.vertexArray.length),st){lu(Ji,Ut.nodeModelMatrix,ee,pe);continue}let en=null;if(ve){const as=fo(Ut.nodeModelMatrix,ee.transform);if(en=new Float32Array(as),me.projection.name!=="globe"){const $n=Ji.aabb.min,ba=Ji.aabb.max,[ss,Za]=ve.getOpacityForBounds(as,$n[0],$n[1],ba[0],ba[1]);Qi.overrideFog=ss>=we||Za>=we}}const mr=Ji.material;let tn;mr.occlusionTexture&&mr.occlusionTexture.offsetScale&&(tn=mr.occlusionTexture.offsetScale,Qi.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const Ha=ee.getOrCreateProgram("model",Qi);!st&&_e&&_e.setupShadowsFromMatrix(Ut.tileModelMatrix,Ha,_e.useNormalOffset),ee.uploadCommonUniforms(be,Ha,null,en);const xa=mr.pbrMetallicRoughness;xa.metallicFactor=.9,xa.roughnessFactor=.5;const oa=rh(new Float32Array(hr),new Float32Array(_i),new Float32Array(Zi),new Float32Array(hi.matrix),ee,Ut.opacity,xa.baseColorFactor.toRenderColor(null),mr.emissiveFactor,xa.metallicFactor,xa.roughnessFactor,mr,Oa,pe,[0,0,0],tn);!fr&&(mi.hasTranslucentParts||Ut.opacity<1)&&Ha.draw(ee,be.gl.TRIANGLES,Ke,vi.disabled,Ui.disabled,yi.backCCW,oa,pe.id,Ji.vertexBuffer,Ji.indexBuffer,Ji.segments,pe.paint,ee.transform.zoom,void 0,Sr),Ha.draw(ee,be.gl.TRIANGLES,fr?gt:Ke,vi.disabled,fr||Ut.opacity<1||mi.hasTranslucentParts?Ui.alphaBlended:Ui.unblended,yi.backCCW,oa,pe.id,Ji.vertexBuffer,Ji.indexBuffer,Ji.segments,pe.paint,ee.transform.zoom,void 0,Sr)}}}}()}(c,t,r,u),void O();if(P.type!=="model")return;const F=P.getModels(),V=[],U=c.transform.getFreeCameraOptions().position,H=n.ab.vec3.scale([],[U.x,U.y,U.z],c.transform.worldSize);n.ab.vec3.negate(H,H);const J=[],$=[];let te=0;for(const ee of F){const le=r.paint.get("model-rotation").constantOr(null),pe=r.paint.get("model-scale").constantOr(null),fe=r.paint.get("model-translation").constantOr(null);ee.computeModelMatrix(c,le,pe,fe,!0,!0,!1);const be=n.ab.mat4.identity([]),me=n.dj(ee.position.lat,c.transform.zoom),ve=n.ab.mat4.fromScaling([],[1,1,1/me]);n.ab.mat4.translate(be,be,H),V.push({zScaleMatrix:ve,negCameraPosMatrix:be});for(const _e of ee.nodes)ch(c.transform,_e,ee.matrix,c.transform.expandedFarZProjMatrix,te,J,$);te++}if(J.sort((ee,le)=>le.depth-ee.depth),c.renderPass!=="shadow"){if(p===1)for(const ee of $)Gs(ee,c,r,V[ee.modelIndex],vi.disabled,c.colorModeForRenderPass());else{for(const ee of $)Gs(ee,c,r,V[ee.modelIndex],vi.disabled,Ui.disabled);for(const ee of $)Gs(ee,c,r,V[ee.modelIndex],c.stencilModeFor3D(),c.colorModeForRenderPass());c.resetStencilClippingMasks()}for(const ee of J)Gs(ee,c,r,V[ee.modelIndex],vi.disabled,c.colorModeForRenderPass());O()}else{for(const ee of $)lu(ee.mesh,ee.nodeModelMatrix,c,r);for(const ee of J)lu(ee.mesh,ee.nodeModelMatrix,c,r);O()}}},fu={line:function(c,t,r){if(c.hasElevatedBuckets=!1,c.hasNonElevatedBuckets=!1,c._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||c._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(t){const u=t.getVisibleCoordinates();for(const p of u){const _=t.getTile(p).getBucket(c);if(_&&(_.hasZOffset?c.hasElevatedBuckets=!0:c.hasNonElevatedBuckets=!0,c.hasElevatedBuckets&&c.hasNonElevatedBuckets))break}}}else c.hasNonElevatedBuckets=!0},model:function(c,t,r){const u=t.getSource();if(!u.loaded())return;if(u.type==="vector"||u.type==="geojson")return void(r.modelManager&&r.modelManager.upload(r,u.type==="vector"?c.scope:""));if(u.type==="batched-model"||u.type!=="model")return;const p=u.getModels();for(const _ of p)_.upload(r.context)},raster:function(c,t,r){const u=t.getSource();if(!(u instanceof an&&u.loaded()))return;const p=c.sourceLayer||u.rasterLayerIds&&u.rasterLayerIds[0];if(!p)return;const _=c.paint.get("raster-array-band")||u.getInitialBand(p);if(_==null)return;const b=t.getIds().map(C=>t.getTileByID(C));for(const C of b)C.updateNeeded(p,_)&&u.prepareTile(C,p,_)},"raster-particle":function(c,t,r){const u=t.getSource();if(!(u instanceof an&&u.loaded()))return;const p=c.sourceLayer||u.rasterLayerIds&&u.rasterLayerIds[0];if(!p)return;const _=c.paint.get("raster-particle-array-band")||u.getInitialBand(p);if(_==null)return;const b=t.getIds().map(C=>t.getTileByID(C));for(const C of b)C.updateNeeded(p,_)&&u.prepareTile(C,p,_)}};class gf{constructor(t,r,u,p,_){this.context=new ah(t,r),this.transform=u,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=_,this._timeStamp=n.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const b=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const O of b)this._debugParams.enabledLayers[O]=!0;_.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),_.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),_.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),_.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),_.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),_.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const O of b)_.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],O);this.occlusionParams=new Il(_),this.setup(),this.numSublayers=ms.maxUnderzooming+ms.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new n.dv,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Hn(this),this._wireframeDebugCache=new pf,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const C=new n.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new n.T(this.context,C,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=p}updateTerrain(t,r){const u=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(u||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Ja(this,t));const p=this._terrain;this.transform.elevation=u?p:null,p.update(t,this.transform,r),this.transform.elevation&&!p.enabled&&(this.transform.elevation=null)}_updateFog(t){const r=t.fog;if(!r||this.transform.projection.name==="globe"||r.getOpacity(this.transform.pitch)<1||r.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[u,p]=r.getFovAdjustedRange(this.transform._fov);if(u>p)return void(this.transform.fogCullDistSq=null);const _=u+.78*(p-u);this.transform.fogCullDistSq=_*_}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new Ja(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,r){if(this.width=t*n.q.devicePixelRatio,this.height=r*n.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const u of this.style.order)this.style._mergedLayers[u].resize()}setup(){const t=this.context,r=new n.b4;r.emplaceBack(0,0),r.emplaceBack(n.ag,0),r.emplaceBack(0,n.ag),r.emplaceBack(n.ag,n.ag),this.tileExtentBuffer=t.createVertexBuffer(r,n.b6.members),this.tileExtentSegments=n.b7.simpleSegment(0,0,4,2);const u=new n.b4;u.emplaceBack(0,0),u.emplaceBack(n.ag,0),u.emplaceBack(0,n.ag),u.emplaceBack(n.ag,n.ag),this.debugBuffer=t.createVertexBuffer(u,n.b6.members),this.debugSegments=n.b7.simpleSegment(0,0,4,5);const p=new n.b4;p.emplaceBack(-1,-1),p.emplaceBack(1,-1),p.emplaceBack(-1,1),p.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(p,n.b6.members),this.viewportSegments=n.b7.simpleSegment(0,0,4,2);const _=new n.aT;_.emplaceBack(0,0,0,0),_.emplaceBack(n.ag,0,n.ag,0),_.emplaceBack(0,n.ag,0,n.ag),_.emplaceBack(n.ag,n.ag,n.ag,n.ag),this.mercatorBoundsBuffer=t.createVertexBuffer(_,n.b9.members),this.mercatorBoundsSegments=n.b7.simpleSegment(0,0,4,2);const b=new n.aU;b.emplaceBack(0,1,2),b.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(b);const C=new n.b5;for(const P of[0,1,3,2,0])C.emplaceBack(P);this.debugIndexBuffer=t.createIndexBuffer(C),this.emptyTexture=new n.T(t,new n.r({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=n.ab.mat4.create();const O=this.context.gl;this.stencilClearMode=new vi({func:O.ALWAYS,mask:0},0,255,O.ZERO,O.ZERO,O.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,ci.disabled,this.stencilClearMode,Ui.disabled,yi.disabled,Kc(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,r,u){if(!r||this.currentStencilSource===r.id||!t.isTileClipped()||!u||u.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let C=!1;for(const O of u)if(this._tileClippingMaskIDs[O.key]===void 0){C=!0;break}if(!C)return}this.currentStencilSource=r.id;const p=this.context,_=p.gl;this.nextStencilID+u.length>256&&this.clearStencil(),p.setColorMode(Ui.disabled),p.setDepthMode(ci.disabled);const b=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const C of u){const O=r.getTile(C),P=this._tileClippingMaskIDs[C.key]=this.nextStencilID++,{tileBoundsBuffer:F,tileBoundsIndexBuffer:V,tileBoundsSegments:U}=this.getTileBoundsBuffers(O);b.draw(this,_.TRIANGLES,ci.disabled,new vi({func:_.ALWAYS,mask:0},P,255,_.KEEP,_.KEEP,_.REPLACE),Ui.disabled,yi.disabled,Kc(C.projMatrix),"$clipping",F,V,U)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,r=this.context.gl;return new vi({func:r.NOTEQUAL,mask:255},t,255,r.KEEP,r.KEEP,r.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const r=this.context.gl;return new vi({func:r.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,r.KEEP,r.KEEP,r.REPLACE)}stencilConfigForOverlap(t){const r=this.context.gl,u=t.sort((b,C)=>C.overscaledZ-b.overscaledZ),p=u[u.length-1].overscaledZ,_=u[0].overscaledZ-p+1;if(_>1){this.currentStencilSource=void 0,this.nextStencilID+_>256&&this.clearStencil();const b={};for(let C=0;C<_;C++)b[C+p]=new vi({func:r.GEQUAL,mask:255},C+this.nextStencilID,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID+=_,[b,u]}return[{[p]:vi.disabled},u]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Ui([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new n.aj(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ui.unblended:Ui.alphaBlended}colorModeForDrapableLayerRenderPass(t){const r=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Ui([r.ONE,r.ONE_MINUS_SRC_ALPHA,r.CONSTANT_ALPHA,r.ONE_MINUS_SRC_ALPHA],new n.aj(0,0,0,t===void 0?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,r,u,p=!1){if(this.depthOcclusion)return new ci(this.context.gl.GREATER,ci.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!p)return ci.disabled;const _=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new ci(u||this.context.gl.LEQUAL,r,[_,_])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,r=Math.ceil(this.width),u=Math.ceil(this.height),p=this.context.bindFramebuffer.get(),_=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===r&&this.depthFBO.height===u||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),r!==0&&u!==0&&(this.depthFBO=new pd(this.context,r,u,!1,"texture"),this.depthTexture=new n.T(this.context,{width:r,height:u,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(p),t.bindTexture(t.TEXTURE_2D,_),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,r,u,0,0,r,u,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((t,r)=>t+r/this._fpsHistory.length,0))}render(t,r){const u=n.q.now();this._dt=u-this._timeStamp,this._timeStamp=u,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=r;const p=this.style._mergedLayers,_=!(!this.terrain||!this.terrain.enabled),b=()=>this.style._getOrder(_).filter(Be=>{const Ke=p[Be];return!(Ke.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Ke.type]});let C=b(),O=!1,P=!1;for(const Be of C){const Ke=p[Be];Ke.type==="circle"&&(O=!0),Ke.type==="symbol"&&(Ke.hasInitialOcclusionOpacityProperties?P=!0:O=!0)}let F=C.map(Be=>p[Be]);const V=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(n.q.now()),this.imageManager.beginFrame();let U=0,H=!1;for(const Be in V){const Ke=V[Be];Ke.used&&(Ke.prepare(this.context),Ke.getSource().usedInConflation&&++U)}let J=!1;for(const Be of F)Be.isHidden(this.transform.zoom)||(Be.type==="clip"&&(J=!0),this.prepareLayer(Be));const $={},te={},ee={},le={},pe={};for(const Be in V){const Ke=V[Be];$[Be]=Ke.getVisibleCoordinates(),te[Be]=$[Be].slice().reverse(),ee[Be]=Ke.getVisibleCoordinates(!0).reverse(),le[Be]=Ke.getShadowCasterCoordinates(),pe[Be]=Ke.sortCoordinatesByDistance($[Be])}const fe=Be=>{const Ke=this.style.getLayerSourceCache(Be);return Ke&&Ke.used?Ke.getSource():null};if(U||J||this._clippingActiveLastFrame){const Be=[],Ke=[];let gt=0;for(const Fe of F)this.isSourceForClippingOrConflation(Fe,fe(Fe))&&(Be.push(Fe),Ke.push(gt)),gt++;if(Be&&(J||Be.length>1)||this._clippingActiveLastFrame){J=!1;const Fe=[];for(let st=0;st<Be.length;st++){const Je=Be[st],St=Ke[st],dt=this.style.getLayerSourceCache(Je);if(!dt||!dt.used||!dt.getSource().usedInConflation&&Je.type!=="clip")continue;let ct=n.dx,vt=n.by.None;const Ct=[];let Vt=!0;if(Je.type==="clip"){ct=St;for(const Yt of Je.layout.get("clip-layer-types"))vt|=Yt==="model"?n.by.Model:Yt==="symbol"?n.by.Symbol:n.by.FillExtrusion;for(const Yt of Je.layout.get("clip-layer-scope"))Ct.push(Yt);Je.isHidden(this.transform.zoom)?Vt=!1:J=!0}Vt&&Fe.push({layer:Je.fqid,cache:dt,order:ct,clipMask:vt,clipScope:Ct})}this.replacementSource.setSources(Fe),H=!0}}this._clippingActiveLastFrame=J,H||this.replacementSource.clear(),this.conflationActive=H,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Be=0;Be<F.length;Be++){const Ke=F[Be],gt=Ke.cutoffRange();if(this.longestCutoffRange=Math.max(gt,this.longestCutoffRange),gt>0){const Fe=fe(Ke);Fe&&(this.minCutoffZoom=Math.max(Fe.minzoom,this.minCutoffZoom)),Ke.minzoom&&(this.minCutoffZoom=Math.max(Ke.minzoom,this.minCutoffZoom))}Ke.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Be),this._lastOcclusionLayer=Be)}const be=this.style&&this.style.fog;be?(this._fogVisible=be.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=be.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(ee),this.opaquePassCutoff=0,C=b(),F=C.map(Be=>p[Be]));const me=this._shadowRenderer;if(me){me.updateShadowParameters(this.transform,this.style.directionalLight);for(const Be in V)for(const Ke of $[Be]){let gt={min:0,max:0};this.terrain&&(gt=this.terrain.getMinMaxForTile(Ke)||gt),me.addShadowReceiver(Ke.toUnwrapped(),gt.min,gt.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new n.dw(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new ff(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const ve=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),_e=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(ve&&!this._snow&&(this._snow=new Go(this)),!ve&&this._snow&&(this._snow.destroy(),delete this._snow),_e&&!this._rain&&(this._rain=new fc(this)),!_e&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),!Ea.has(this.context.gl))return;this.renderPass="offscreen";for(const Be of F){const Ke=t.getLayerSourceCache(Be);if(!Be.hasOffscreenPass()||Be.isHidden(this.transform.zoom))continue;const gt=Ke?te[Ke.id]:void 0;(Be.type==="custom"||Be.type==="raster"||Be.type==="raster-particle"||Be.isSky()||gt&&gt.length)&&this.renderLayer(this,Ke,Be,gt)}this.depthRangeFor3D=[0,1-(F.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,le)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Ee=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),ze=(()=>{if(r.showOverdrawInspector)return n.aj.black;const Be=this.style.fog;if(Be&&this.transform.projection.supportsFog){const Ke=this.style.getLut(Be.scope);if(!Ee){const gt=Be.properties.get("color-use-theme")==="none",Fe=Be.properties.get("color").toRenderColor(gt?null:Ke).toArray01();return new n.aj(...Fe)}if(Ee){const gt=Be.properties.get("space-color-use-theme")==="none",Fe=Be.properties.get("space-color").toRenderColor(gt?null:Ke).toArray01();return new n.aj(...Fe)}}return n.aj.transparent})();if(this.context.clear({color:ze,depth:1}),this.clearStencil(),this._showOverdrawInspector=r.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ee&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=C.length-1;this.currentLayer>=0;this.currentLayer--){const Be=F[this.currentLayer],Ke=t.getLayerSourceCache(Be);if(Be.isSky())continue;const gt=Ke?(Be.is3D()?pe:te)[Ke.id]:void 0;this._renderTileClippingMasks(Be,Ke,gt),this.renderLayer(this,Ke,Be,gt)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ee&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||n.ae(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<C.length;this.currentLayer++){const Be=F[this.currentLayer],Ke=t.getLayerSourceCache(Be);Be.isSky()&&this.renderLayer(this,Ke,Be,Ke?te[Ke.id]:void 0)}function Ye(Be,Ke){let gt;return Ke&&(gt=(Be.type==="symbol"?ee:Be.is3D()?pe:te)[Ke.id]),gt}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<C.length;){const Be=F[this.currentLayer];if(Be.type==="raster"||Be.type==="raster-particle"){const Ke=t.getLayerSourceCache(Be);this.renderLayer(this,Ke,Be,Ye(Be,Ke))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let qe=0;me&&(qe=me.getShadowCastingLayerCount());let lt=!1,it=-1;for(let Be=0;Be<C.length;++Be){const Ke=F[Be];Ke.isHidden(this.transform.zoom)||Ke.is3D()&&(it=Be)}for(P&&it===-1&&(O=!0);this.currentLayer<C.length;){const Be=F[this.currentLayer],Ke=t.getLayerSourceCache(Be);if(Be.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Be)){if(Be.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(O&&!lt&&this.terrain&&!this.transform.isOrthographic&&(lt=!0,this.blitDepth()),P&&it!==-1&&this.currentLayer===it+1&&!this.transform.isOrthographic&&this.blitDepth(),Be.is3D()||this.terrain||this._renderTileClippingMasks(Be,Ke,Ke?$[Ke.id]:void 0),this.renderLayer(this,Ke,Be,Ye(Be,Ke)),!this.terrain&&me&&qe>0&&Be.hasShadowPass()&&--qe==0&&(me.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const gt=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=gt;this.currentLayer++){const Fe=F[this.currentLayer];if(!Fe.hasLightBeamPass())continue;const st=t.getLayerSourceCache(Fe);this.renderLayer(this,st,Fe,st?te[st.id]:void 0)}this.currentLayer=gt,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const gt=this.currentLayer;this.depthOcclusion=!0;for(const Fe of this.layersWithOcclusionOpacity){this.currentLayer=Fe;const st=F[this.currentLayer],Je=t.getLayerSourceCache(st),St=Je?te[Je.id]:void 0;st.is3D()||this.terrain||this._renderTileClippingMasks(st,Je,Je?$[Je.id]:void 0),this.renderLayer(this,Je,st,St)}this.depthOcclusion=!1,this.currentLayer=gt,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Be=null;F.forEach(Ke=>{const gt=t.getLayerSourceCache(Ke);gt&&!Ke.isHidden(this.transform.zoom)&&gt.getVisibleCoordinates().length&&(!Be||Be.getSource().maxzoom<gt.getSource().maxzoom)&&(Be=gt)}),Be&&this.options.showTileBoundaries&&Rl.debug(this,Be,Be.getVisibleCoordinates(),n.aj.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Rl.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new n.aj(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Be){const Ke=Be.transform.padding;xd(Be,Be.transform.height-(Ke.top||0),3,Al),xd(Be,Ke.bottom||0,3,bp),hf(Be,Ke.left||0,3,wp),hf(Be,Be.transform.width-(Ke.right||0),3,vd);const gt=Be.transform.centerPoint;(function(Fe,st,Je,St){Ss(Fe,st-1,Je-10,2,20,St),Ss(Fe,st-10,Je-1,20,2,St)})(Be,gt.x,Be.transform.height-gt.y,oh)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),H||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);const{unsupportedLayers:r}=this.transform.projection,u=!r||!r.includes(t.type);if(fu[t.type]&&(u||this.terrain&&t.type==="custom")){const p=this.style.getLayerSourceCache(t);fu[t.type](t,p,this)}this.gpuTimingEnd()}renderLayer(t,r,u,p){u.isHidden(this.transform.zoom)||(u.type==="background"||u.type==="sky"||u.type==="custom"||u.type==="model"||u.type==="raster"||u.type==="raster-particle"||p&&p.length)&&(this.id=u.id,this.gpuTimingStart(u),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(u.type)&&(!t.terrain||u.type!=="custom")||u.type==="clip"||Rl[u.type](t,r,u,p,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const r=this.context.extTimerQuery,u=this.context.gl;let p=this.gpuTimers[t.id];p||(p=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:u.createQuery()}),p.calls++,u.beginQuery(r.TIME_ELAPSED_EXT,p.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,r=this.context.gl,u=r.createQuery();this.deferredRenderGpuTimeQueries.push(u),r.beginQuery(t.TIME_ELAPSED_EXT,u)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const r={};for(const u in t){const p=t[u],_=this.context.extTimerQuery,b=_.getQueryParameter(p.query,this.context.gl.QUERY_RESULT)/1e6;_.deleteQueryEXT(p.query),r[u]=b}return r}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const r=this.context.gl;let u=0;for(const p of t)u+=r.getQueryParameter(p,r.QUERY_RESULT)/1e6,r.deleteQuery(p);return u}translatePosMatrix(t,r,u,p,_){if(!u[0]&&!u[1])return t;const b=_?p==="map"?this.transform.angle:0:p==="viewport"?-this.transform.angle:0;if(b){const P=Math.sin(b),F=Math.cos(b);u=[u[0]*F-u[1]*P,u[0]*P+u[1]*F]}const C=[_?u[0]:n.ar(r,u[0],this.transform.zoom),_?u[1]:n.ar(r,u[1],this.transform.zoom),0],O=new Float32Array(16);return n.ab.mat4.translate(O,t,C),O}saveTileTexture(t){const r=t.size[0],u=this._tileTextures[r];u?u.push(t):this._tileTextures[r]=[t]}getTileTexture(t){const r=this._tileTextures[t];return r&&r.length>0?r.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,r,u){const p=u===void 0?this.terrain&&this.terrain.renderingToTexture:u,_=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(_.push("LIGHTING_3D_MODE"),_.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):p||_.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||_.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(_.push("TERRAIN"),this.linearFloatFilteringSupported()&&_.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&_.push("GLOBE"),!this._fogVisible||p||r!==void 0&&!r||_.push("FOG","FOG_DITHERING"),p&&_.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&_.push("OVERDRAW_INSPECTOR"),_}getOrCreateProgram(t,r){this.cache=this.cache||{};const u=r&&r.defines||[],p=r&&r.config,_=this.currentGlobalDefines(t,r&&r.overrideFog,r&&r.overrideRtt).concat(u),b=yp.cacheKey(Qa[t],t,_,p);return this.cache[b]||(this.cache[b]=new yp(this.context,t,Qa[t],p,nh[t],_)),this.cache[b]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new n.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,r){if(this.style.enable3dLights()){const u=this.style.directionalLight,p=this.style.ambientLight;if(u&&p){const _=((b,C,O)=>{const P=b.properties.get("direction"),F=b.properties.get("color-use-theme")==="none",V=b.properties.get("color").toRenderColor(F?null:O.getLut(b.scope)).toArray01(),U=b.properties.get("intensity"),H=C.properties.get("color-use-theme")==="none",J=C.properties.get("color").toRenderColor(H?null:O.getLut(C.scope)).toArray01(),$=C.properties.get("intensity"),te=[P.x,P.y,P.z],ee=n.cM(J,$),le=n.cM(V,U);return{u_lighting_ambient_color:ee,u_lighting_directional_dir:te,u_lighting_directional_color:le,u_ground_radiance:Fo(te,le,ee)}})(u,p,this.style);r.setLightsUniformValues(t,_)}}}uploadCommonUniforms(t,r,u,p,_){if(this.uploadCommonLightUniforms(t,r),this.terrain&&this.terrain.renderingToTexture)return;const b=this.style.fog;if(b){const C=b.getOpacity(this.transform.pitch),O=((P,F,V,U,H,J,$,te,ee,le,pe,fe)=>{const be=P.transform,me=F.properties.get("color-use-theme")==="none",ve=F.properties.get("color").toRenderColor(me?null:P.style.getLut(F.scope)).toArray01();ve[3]=U;const _e=P.frameCounter/1e3%1,[Ee,ze]=F.properties.get("vertical-range");return{u_fog_matrix:V?be.calculateFogTileMatrix(V):fe||P.identityMat,u_fog_range:F.getFovAdjustedRange(be._fov),u_fog_color:ve,u_fog_horizon_blend:F.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Ee,ze),ze],u_fog_temporal_offset:_e,u_frustum_tl:H,u_frustum_tr:J,u_frustum_br:$,u_frustum_bl:te,u_globe_pos:ee,u_globe_radius:le,u_viewport:pe,u_globe_transition:n.ae(be.zoom),u_is_globe:+(be.projection.name==="globe")}})(this,b,u,C,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*n.q.devicePixelRatio,this.transform.height*n.q.devicePixelRatio],p);r.setFogUniformValues(t,O)}_&&r.setCutoffUniformValues(t,_.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,r=t.createTexture();return t.bindTexture(t.TEXTURE_2D,r),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),r}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,r=this._backgroundTiles={},u=this.transform.coveringTiles({tileSize:512});for(const p of u)r[p.key]=t[p.key]||new Ao(p,512,this.transform.tileZoom,this);return r}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,r){return!(!t.is3D()||t.type!=="clip"&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||t.sourceLayer!=="building")&&(!r||r.type!=="batched-model")))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let r=this._cachedTileFogOpacities[t.key];return r||(this._cachedTileFogOpacities[t.key]=r=this.style.fog.getOpacityForTile(t)),r[0]>=we||r[1]>=we}setupDepthForOcclusion(t,r,u){const p=this.context,_=p.gl,b=!!u;var C;u||(u={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),p.activeTexture.set(_.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE),u.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],u.u_depth_range_unpack=[2/((C=this.depthRangeFor3D)[1]-C[0]),-1-2*C[0]/(C[1]-C[0])],u.u_occluder_half_size=.5*this.occlusionParams.occluderSize,u.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE),p.activeTexture.set(_.TEXTURE0),b||r.setTerrainUniformValues(p,u)}}function dh(c,t){let r=!1,u=null;const p=()=>{u=null,r&&(c(),u=setTimeout(p,t),r=!1)};return()=>(r=!0,u||p(),u)}class ph{constructor(t){this._hashName=t&&encodeURIComponent(t),n.aP(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=dh(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const r=yf(t);if(this._hashName){const u=this._hashName;let p=!1;const _=location.hash.slice(1).split("&").map(b=>{const C=b.split("=")[0];return C===u?(p=!0,`${C}=${r}`):b}).filter(b=>b);return p||_.push(`${u}=${r}`),`#${_.join("&")}`}return`#${r}`}_getCurrentHash(){const t=location.hash.replace("#","");if(this._hashName){let r;return t.split("&").map(u=>u.split("=")).forEach(u=>{u[0]===this._hashName&&(r=u)}),(r&&r[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const r=this._getCurrentHash();if(r.length>=3&&!r.some(u=>isNaN(u))){const u=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(r[3]||0):t.getBearing();return t.jumpTo({center:[+r[2],+r[1]],zoom:+r[0],bearing:u,pitch:+(r[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function yf(c,t){const r=c.getCenter(),u=Math.round(100*c.getZoom())/100,p=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,p),b=Math.round(r.lng*_)/_,C=Math.round(r.lat*_)/_,O=c.getBearing(),P=c.getPitch();let F=t?`/${b}/${C}/${u}`:`${u}/${C}/${b}`;return(O||P)&&(F+="/"+Math.round(10*O)/10),P&&(F+=`/${Math.round(P)}`),F}const dc={linearity:.3,easing:n.dy(0,0,.3,1)},Td=n.l({deceleration:2500,maxSpeed:1400},dc),Sd=n.l({deceleration:20,maxSpeed:1400},dc),Sp=n.l({deceleration:1e3,maxSpeed:360},dc),Ed=n.l({deceleration:1e3,maxSpeed:90},dc);class Wn{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:n.q.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,r=n.q.now();for(;t.length>0&&r-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const r={zoom:0,bearing:0,pitch:0,pan:new n.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:_}of this._inertiaBuffer)r.zoom+=_.zoomDelta||0,r.bearing+=_.bearingDelta||0,r.pitch+=_.pitchDelta||0,_.panDelta&&r.pan._add(_.panDelta),_.around&&(r.around=_.around),_.pinchAround&&(r.pinchAround=_.pinchAround);const u=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,p={};if(r.pan.mag()){const _=du(r.pan.mag(),u,n.l({},Td,t||{}));p.offset=r.pan.mult(_.amount/r.pan.mag()),p.center=this._map.transform.center,Sn(p,_)}if(r.zoom){const _=du(r.zoom,u,Sd);p.zoom=this._map.transform.zoom+_.amount,Sn(p,_)}if(r.bearing){const _=du(r.bearing,u,Sp);p.bearing=this._map.transform.bearing+n.aw(_.amount,-179,179),Sn(p,_)}if(r.pitch){const _=du(r.pitch,u,Ed);p.pitch=this._map.transform.pitch+_.amount,Sn(p,_)}if(p.zoom||p.bearing){const _=r.pinchAround===void 0?r.around:r.pinchAround;p.around=_?this._map.unproject(_):this._map.getCenter()}return this.clear(),p.noMoveStart=!0,p}}function Sn(c,t){(!c.duration||c.duration<t.duration)&&(c.duration=t.duration,c.easing=t.easing)}function du(c,t,r){const{maxSpeed:u,linearity:p,deceleration:_}=r,b=n.aw(c*p/(t/1e3),-u,u),C=Math.abs(b)/(_*p);return{easing:r.easing,duration:1e3*C,amount:b*(C/2)}}class Ra extends n.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,u,p={}){const _=Fi(r.getCanvasContainer(),u),b=r.unproject(_);super(t,n.l({point:_,lngLat:b,originalEvent:u},p)),this._defaultPrevented=!1,this.target=r}}class pu extends n.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,u){const p=t==="touchend"?u.changedTouches:u.touches,_=ai(r.getCanvasContainer(),p),b=_.map(O=>r.unproject(O)),C=_.reduce((O,P,F,V)=>O.add(P.div(V.length)),new n.P(0,0));super(t,{points:_,point:C,lngLats:b,lngLat:r.unproject(C),originalEvent:u}),this._defaultPrevented=!1}}class Md extends n.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r){super("wheel",{originalEvent:r}),this._defaultPrevented=!1}}class Ep{constructor(t,r){this._map=t,this._clickTolerance=r.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new Md(this._map,t))}mousedown(t,r){return this._mousedownPos=r,this._firePreventable(new Ra(t.type,this._map,t))}mouseup(t){this._map.fire(new Ra(t.type,this._map,t))}preclick(t){const r=n.l({},t);r.type="preclick",this._map.fire(new Ra(r.type,this._map,r))}click(t,r){this._mousedownPos&&this._mousedownPos.dist(r)>=this._clickTolerance||(this.preclick(t),this._map.fire(new Ra(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new Ra(t.type,this._map,t))}mouseover(t){this._map.fire(new Ra(t.type,this._map,t))}mouseout(t){this._map.fire(new Ra(t.type,this._map,t))}touchstart(t){return this._firePreventable(new pu(t.type,this._map,t))}touchmove(t){this._map.fire(new pu(t.type,this._map,t))}touchend(t){this._map.fire(new pu(t.type,this._map,t))}touchcancel(t){this._map.fire(new pu(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class mh{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new Ra(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ra("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new Ra(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Xr{constructor(t,r){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=r.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,r){this.isEnabled()&&t.shiftKey&&t.button===0&&(Mt(),this._startPos=this._lastPos=r,this._active=!0)}mousemoveWindow(t,r){if(!this._active)return;const u=r,p=this._startPos,_=this._lastPos;if(!p||!_||_.equals(u)||!this._box&&u.dist(p)<this._clickTolerance)return;this._lastPos=u,this._box||(this._box=tt("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const b=Math.min(p.x,u.x),C=Math.max(p.x,u.x),O=Math.min(p.y,u.y),P=Math.max(p.y,u.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${b}px,${O}px)`,this._box.style.width=C-b+"px",this._box.style.height=P-O+"px")})}mouseupWindow(t,r){if(!this._active)return;const u=this._startPos,p=r;if(u&&t.button===0){if(this.reset(),qt(),u.x!==p.x||u.y!==p.y)return this._map.fire(new n.z("boxzoomend",{originalEvent:t})),{cameraAnimation:_=>_.fitScreenCoordinates(u,p,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Ft(),delete this._startPos,delete this._lastPos}_fireEvent(t,r){return this._map.fire(new n.z(t,{originalEvent:r}))}}function _h(c,t){const r={};for(let u=0;u<c.length;u++)r[c[u].identifier]=t[u];return r}class Mp{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,r,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),u.length===this.numTouches&&(this.centroid=function(p){const _=new n.P(0,0);for(const b of p)_._add(b);return _.div(p.length)}(r),this.touches=_h(u,r)))}touchmove(t,r,u){if(this.aborted||!this.centroid)return;const p=_h(u,r);for(const _ in this.touches){const b=p[_];(!b||b.dist(this.touches[_])>30)&&(this.aborted=!0)}}touchend(t,r,u){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){const p=!this.aborted&&this.centroid;if(this.reset(),p)return p}}}class vf{constructor(t){this.singleTap=new Mp(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,r,u){this.singleTap.touchstart(t,r,u)}touchmove(t,r,u){this.singleTap.touchmove(t,r,u)}touchend(t,r,u){const p=this.singleTap.touchend(t,r,u);if(p){const _=t.timeStamp-this.lastTime<500,b=!this.lastTap||this.lastTap.dist(p)<30;if(_&&b||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=p,this.count===this.numTaps)return this.reset(),p}}}class pc{constructor(){this._zoomIn=new vf({numTouches:1,numTaps:2}),this._zoomOut=new vf({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,r,u){this._zoomIn.touchstart(t,r,u),this._zoomOut.touchstart(t,r,u)}touchmove(t,r,u){this._zoomIn.touchmove(t,r,u),this._zoomOut.touchmove(t,r,u)}touchend(t,r,u){const p=this._zoomIn.touchend(t,r,u),_=this._zoomOut.touchend(t,r,u);return p?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()+1,around:b.unproject(p)},{originalEvent:t})}):_?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()-1,around:b.unproject(_)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const xf={0:1,2:2};class mc{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,r){return!1}_move(t,r){return{}}mousedown(t,r){if(this._lastPoint)return;const u=kt(t);this._correctButton(t,u)&&(this._lastPoint=r,this._eventButton=u)}mousemoveWindow(t,r){const u=this._lastPoint;if(u){if(t.preventDefault(),this._eventButton!=null&&function(p,_){const b=xf[_];return p.buttons===void 0||(p.buttons&b)!==b}(t,this._eventButton))this.reset();else if(this._moved||!(r.dist(u)<this._clickTolerance))return this._moved=!0,this._lastPoint=r,this._move(u,r)}}mouseupWindow(t){this._lastPoint&&kt(t)===this._eventButton&&(this._moved&&qt(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class gh extends mc{mousedown(t,r){super.mousedown(t,r),this._lastPoint&&(this._active=!0)}_correctButton(t,r){return r===0&&!t.ctrlKey}_move(t,r){return{around:r,panDelta:r.sub(t)}}}class Cs extends mc{_correctButton(t,r){return r===0&&t.ctrlKey||r===2}_move(t,r){const u=.8*(r.x-t.x);if(u)return this._active=!0,{bearingDelta:u}}contextmenu(t){t.preventDefault()}}class _c extends mc{_correctButton(t,r){return r===0&&t.ctrlKey||r===2}_move(t,r){const u=-.5*(r.y-t.y);if(u)return this._active=!0,{pitchDelta:u}}contextmenu(t){t.preventDefault()}}class Qr{constructor(t,r){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=r.clickTolerance||1,this.reset(),n.aP(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new n.P(0,0)}touchstart(t,r,u){return this._calculateTransform(t,r,u)}touchmove(t,r,u){if(this._active&&!(u.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(u.length===1&&!n.dz())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,r,u)}}touchend(t,r,u){this._calculateTransform(t,r,u),this._active&&u.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,r,u){u.length>0&&(this._active=!0);const p=_h(u,r),_=new n.P(0,0),b=new n.P(0,0);let C=0;for(const P in p){const F=p[P],V=this._touches[P];V&&(_._add(F),b._add(F.sub(V)),C++,p[P]=F)}if(this._touches=p,C<this._minTouches||!b.mag())return;const O=b.div(C);return this._sum._add(O),this._sum.mag()<this._clickTolerance?void 0:{around:_.div(C),panDelta:O}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=tt("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class ts{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,r,u){return{}}touchstart(t,r,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([r[0],r[1]]))}touchmove(t,r,u){const p=this._firstTwoTouches;if(!p)return;t.preventDefault();const[_,b]=p,C=zl(u,r,_),O=zl(u,r,b);if(!C||!O)return;const P=this._aroundCenter?null:C.add(O).div(2);return this._move([C,O],P,t)}touchend(t,r,u){if(!this._firstTwoTouches)return;const[p,_]=this._firstTwoTouches,b=zl(u,r,p),C=zl(u,r,_);b&&C||(this._active&&qt(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function zl(c,t,r){for(let u=0;u<c.length;u++)if(c[u].identifier===r)return t[u]}function mu(c,t){return Math.log(c/t)/Math.LN2}class _o extends ts{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,r){const u=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(mu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:mu(this._distance,u),pinchAround:r}}}function bf(c,t){return 180*c.angleWith(t)/Math.PI}class yh extends ts{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,r){const u=this._vector;if(this._vector=t[0].sub(t[1]),u&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:bf(this._vector,u),pinchAround:r}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const r=25/(Math.PI*this._minDiameter)*360,u=this._startVector;if(!u)return!1;const p=bf(t,u);return Math.abs(p)<r}}function wf(c){return Math.abs(c.y)>Math.abs(c.x)}class Ad extends ts{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,wf(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,r,u){const p=this._lastPoints;if(!p)return;const _=t[0].sub(p[0]),b=t[1].sub(p[1]);return this._map._cooperativeGestures&&!n.dz()&&u.touches.length<3||(this._valid=this.gestureBeginsVertically(_,b,u.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(_.y+b.y)/2*-.5})}gestureBeginsVertically(t,r,u){if(this._valid!==void 0)return this._valid;const p=t.mag()>=2,_=r.mag()>=2;if(!p&&!_)return;if(!p||!_)return this._firstMove==null&&(this._firstMove=u),u-this._firstMove<100&&void 0;const b=t.y>0==r.y>0;return wf(t)&&wf(r)&&b}}const Ho={panStep:100,bearingStep:15,pitchStep:10};class Zs{constructor(){const t=Ho;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let r=0,u=0,p=0,_=0,b=0;switch(t.keyCode){case 61:case 107:case 171:case 187:r=1;break;case 189:case 109:case 173:r=-1;break;case 37:t.shiftKey?u=-1:(t.preventDefault(),_=-1);break;case 39:t.shiftKey?u=1:(t.preventDefault(),_=1);break;case 38:t.shiftKey?p=1:(t.preventDefault(),b=-1);break;case 40:t.shiftKey?p=-1:(t.preventDefault(),b=1);break;default:return}return this._rotationDisabled&&(u=0,p=0),{cameraAnimation:C=>{const O=C.getZoom();C.easeTo({duration:300,easeId:"keyboardHandler",easing:qa,zoom:r?Math.round(O)+r*(t.shiftKey?2:1):O,bearing:C.getBearing()+u*this._bearingStep,pitch:C.getPitch()+p*this._pitchStep,offset:[-_*this._panStep,-b*this._panStep],center:C.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function qa(c){return c*(2-c)}const za=4.000244140625,Xs=1/450;class is{constructor(t,r){this._map=t,this._el=t.getCanvasContainer(),this._handler=r,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Xs,n.aP(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||n.dz()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let r=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const u=n.q.now(),p=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,r!==0&&r%za==0?this._type="wheel":r!==0&&Math.abs(r)<4?this._type="trackpad":p>400?(this._type=null,this._lastValue=r,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(p*r)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,r+=this._lastValue)),t.shiftKey&&r&&(r/=4),this._type&&(this._lastWheelEvent=t,this._delta-=r,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const r=Fi(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:r,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const r=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const P=this._type==="wheel"&&Math.abs(this._delta)>za?this._wheelZoomRate:this._defaultZoomRate;let F=2/(1+Math.exp(-Math.abs(this._delta*P)));this._delta<0&&F!==0&&(F=1/F);const V=r(),U=Math.pow(2,V),H=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):U;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(H*F))),this._type==="wheel"&&(this._startZoom=V,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const u=typeof this._targetZoom=="number"?this._targetZoom:r(),p=this._startZoom,_=this._easing;let b,C=!1;if(this._type==="wheel"&&p&&_){const P=Math.min((n.q.now()-this._lastWheelEventTime)/200,1),F=_(P);b=n.af(p,u,F),P<1?this._frameId||(this._frameId=!0):C=!0}else b=u,C=!0;this._active=!0,C&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let O=b-r();return O*this._lastDelta<0&&(O=0),{noInertia:!0,needsRenderFrame:!C,zoomDelta:O,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let r=n.dA;if(this._prevEase){const u=this._prevEase,p=(n.q.now()-u.start)/u.duration,_=u.easing(p+.01)-u.easing(p),b=.27/Math.sqrt(_*_+1e-4)*.01,C=Math.sqrt(.0729-b*b);r=n.dy(b,C,.25,1)}return this._prevEase={start:n.q.now(),duration:t,easing:r},r}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=tt("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Ds{constructor(t,r){this._clickZoom=t,this._tapZoom=r}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class go{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,r){return t.preventDefault(),{cameraAnimation:u=>{u.easeTo({duration:300,zoom:u.getZoom()+(t.shiftKey?-1:1),around:u.unproject(r)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ga{constructor(){this._tap=new vf({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,r,u){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?u.length>0&&(this._swipePoint=r[0],this._swipeTouch=u[0].identifier):this._tap.touchstart(t,r,u))}touchmove(t,r,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;const p=r[0],_=p.y-this._swipePoint.y;return this._swipePoint=p,t.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(t,r,u)}touchend(t,r,u){this._tapTime?this._swipePoint&&u.length===0&&this.reset():this._tap.touchend(t,r,u)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ya{constructor(t,r,u){this._el=t,this._mousePan=r,this._touchPan=u}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Tf{constructor(t,r,u){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=r,this._mousePitch=u}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ap{constructor(t,r,u,p){this._el=t,this._touchZoom=r,this._touchRotate=u,this._tapDragZoom=p,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Ys=c=>c.zoom||c.drag||c.pitch||c.rotate;class Sf extends n.z{}class aa{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,r){const u=n.ab.vec3.sub([],r,t);this.radius=n.ab.vec3.length(u[2]<0?n.ab.vec3.div([],u,this.constants):[u[0],u[1],0])}projectRay(t){n.ab.vec3.div(t,t,this.constants),n.ab.vec3.normalize(t,t),n.ab.vec3.mul(t,t,this.constants);const r=n.ab.vec3.scale([],t,this.radius);if(r[2]>0){const u=n.ab.vec3.scale([],[0,0,1],n.ab.vec3.dot(r,[0,0,1])),p=n.ab.vec3.scale([],n.ab.vec3.normalize([],[r[0],r[1],0]),this.radius),_=n.ab.vec3.add([],r,n.ab.vec3.scale([],n.ab.vec3.sub([],n.ab.vec3.add([],p,u),r),2));r[0]=_[0],r[1]=_[1]}return r}}function rs(c){return c.panDelta&&c.panDelta.mag()||c.zoomDelta||c.bearingDelta||c.pitchDelta}class Zo{constructor(t,r){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Wn(t),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new aa,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(r),n.aP(["handleEvent","handleWindowEvent"],this);const u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[window,"blur",void 0]];for(const[p,_,b]of this._listeners){const C=p===document?this.handleWindowEvent:this.handleEvent;p.addEventListener(_,C,b)}}destroy(){for(const[t,r,u]of this._listeners){const p=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(r,p,u)}}_addDefaultHandlers(t){const r=this._map,u=r.getCanvasContainer();this._add("mapEvent",new Ep(r,t));const p=r.boxZoom=new Xr(r,t);this._add("boxZoom",p);const _=new pc,b=new go;r.doubleClickZoom=new Ds(b,_),this._add("tapZoom",_),this._add("clickZoom",b);const C=new Ga;this._add("tapDragZoom",C);const O=r.touchPitch=new Ad(r);this._add("touchPitch",O);const P=new Cs(t),F=new _c(t);r.dragRotate=new Tf(t,P,F),this._add("mouseRotate",P,["mousePitch"]),this._add("mousePitch",F,["mouseRotate"]);const V=new gh(t),U=new Qr(r,t);r.dragPan=new ya(u,V,U),this._add("mousePan",V),this._add("touchPan",U,["touchZoom","touchRotate"]);const H=new yh,J=new _o;r.touchZoomRotate=new Ap(u,J,H,C),this._add("touchRotate",H,["touchPan","touchZoom"]),this._add("touchZoom",J,["touchPan","touchRotate"]),this._add("blockableMapEvent",new mh(r));const $=r.scrollZoom=new is(r,this);this._add("scrollZoom",$,["mousePan"]);const te=r.keyboard=new Zs;this._add("keyboard",te);for(const ee of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[ee]&&r[ee].enable(t[ee])}_add(t,r,u){this._handlers.push({handlerName:t,handler:r,allowed:u}),this._handlersById[t]=r}stop(t){if(!this._updatingCamera){for(const{handler:r}of this._handlers)r.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ys(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,r,u){for(const p in t)if(p!==u&&(!r||r.indexOf(p)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const r=[];for(const u of t)this._el.contains(u.target)&&r.push(u);return r}handleEvent(t,r){this._updatingCamera=!0;const u=t.type==="renderFrame",p=u?void 0:t,_={needsRenderFrame:!1},b={},C={},O=t.touches?this._getMapTouches(t.touches):void 0,P=O?ai(this._el,O):u?void 0:Fi(this._el,t);for(const{handlerName:U,handler:H,allowed:J}of this._handlers){if(!H.isEnabled())continue;let $;this._blockedByActive(C,J,U)?H.reset():H[r||t.type]&&($=H[r||t.type](t,P,O),this.mergeHandlerResult(_,b,$,U,p),$&&$.needsRenderFrame&&this._triggerRenderFrame()),($||H.isActive())&&(C[U]=H)}const F={};for(const U in this._previousActiveHandlers)C[U]||(F[U]=p);this._previousActiveHandlers=C,(Object.keys(F).length||rs(_))&&(this._changes.push([_,b,F]),this._triggerRenderFrame()),(Object.keys(C).length||rs(_))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:V}=_;V&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],V(this._map))}mergeHandlerResult(t,r,u,p,_){if(!u)return;n.l(t,u);const b={handlerName:p,originalEvent:u.originalEvent||_};u.zoomDelta!==void 0&&(r.zoom=b),u.panDelta!==void 0&&(r.drag=b),u.pitchDelta!==void 0&&(r.pitch=b),u.bearingDelta!==void 0&&(r.rotate=b)}_applyChanges(){const t={},r={},u={};for(const[p,_,b]of this._changes)p.panDelta&&(t.panDelta=(t.panDelta||new n.P(0,0))._add(p.panDelta)),p.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+p.zoomDelta),p.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+p.bearingDelta),p.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+p.pitchDelta),p.around!==void 0&&(t.around=p.around),p.aroundCoord!==void 0&&(t.aroundCoord=p.aroundCoord),p.pinchAround!==void 0&&(t.pinchAround=p.pinchAround),p.noInertia&&(t.noInertia=p.noInertia),n.l(r,_),n.l(u,b);this._updateMapTransform(t,r,u),this._changes=[]}_updateMapTransform(t,r,u){const p=this._map,_=p.transform,b=le=>[le.x,le.y,le.z];if((le=>{const pe=this._eventsInProgress.drag;return pe&&!this._handlersById[pe.handlerName].isActive()})()&&!rs(t)){const le=_.zoom;_.cameraElevationReference="sea",this._originalZoom!=null&&_._orthographicProjectionAtLowPitch&&_.projection.name!=="globe"&&_.pitch===0?(_.cameraElevationReference="ground",_.zoom=this._originalZoom):(_.recenterOnTerrain(),_.cameraElevationReference="ground"),le!==_.zoom&&this._map._update(!0)}if(_._isCameraConstrained&&p._stop(!0),!rs(t))return void this._fireEvents(r,u,!0);let{panDelta:C,zoomDelta:O,bearingDelta:P,pitchDelta:F,around:V,aroundCoord:U,pinchAround:H}=t;_._isCameraConstrained&&(O>0&&(O=0),_._isCameraConstrained=!1),H!==void 0&&(V=H),(O||(le=>r[le]&&!this._eventsInProgress[le])("drag"))&&V&&(this._dragOrigin=b(_.pointCoordinate3D(V)),this._originalZoom=_.zoom,this._trackingEllipsoid.setup(_._camera.position,this._dragOrigin)),_.cameraElevationReference="sea",p._stop(!0),V=V||p.transform.centerPoint,P&&(_.bearing+=P),F&&(_.pitch+=F),_._updateCameraState();const J=[0,0,0];if(C)if(_.projection.name==="mercator"){const le=this._trackingEllipsoid.projectRay(_.screenPointToMercatorRay(V).dir),pe=this._trackingEllipsoid.projectRay(_.screenPointToMercatorRay(V.sub(C)).dir);J[0]=pe[0]-le[0],J[1]=pe[1]-le[1]}else{const le=_.pointCoordinate(V);if(_.projection.name==="globe"){C=C.rotate(-_.angle);const pe=_._pixelsPerMercatorPixel/_.worldSize;J[0]=-C.x*n.dB(n.aS(le.y))*pe,J[1]=-C.y*n.dB(_.center.lat)*pe}else{const pe=_.pointCoordinate(V.sub(C));le&&pe&&(J[0]=pe.x-le.x,J[1]=pe.y-le.y)}}const $=_.zoom,te=[0,0,0];if(O){const le=b(U||_.pointCoordinate3D(V)),pe={dir:n.ab.vec3.normalize([],n.ab.vec3.sub([],le,_._camera.position))};if(pe.dir[2]<0){const fe=_.zoomDeltaToMovement(le,O);n.ab.vec3.scale(te,pe.dir,fe)}}const ee=n.ab.vec3.add(J,J,te);_._translateCameraConstrained(ee),O&&Math.abs(_.zoom-$)>1e-4&&_.recenterOnTerrain(),_.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(r,u,!0)}_fireEvents(t,r,u){const p=Ys(this._eventsInProgress),_=Ys(t),b={};for(const F in t){const{originalEvent:V}=t[F];this._eventsInProgress[F]||(b[`${F}start`]=V),this._eventsInProgress[F]=t[F]}!p&&_&&this._fireEvent("movestart",_.originalEvent);for(const F in b)this._fireEvent(F,b[F]);_&&this._fireEvent("move",_.originalEvent);for(const F in t){const{originalEvent:V}=t[F];this._fireEvent(F,V)}const C={};let O;for(const F in this._eventsInProgress){const{handlerName:V,originalEvent:U}=this._eventsInProgress[F];this._handlersById[V].isActive()||(delete this._eventsInProgress[F],O=r[V]||U,C[`${F}end`]=O)}for(const F in C)this._fireEvent(F,C[F]);const P=Ys(this._eventsInProgress);if(u&&(p||_)&&!P){this._updatingCamera=!0;const F=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),V=U=>U!==0&&-this._bearingSnap<U&&U<this._bearingSnap;F?(V(F.bearing||this._map.getBearing())&&(F.bearing=0),this._map.easeTo(F,{originalEvent:O})):(this._map.fire(new n.z("moveend",{originalEvent:O})),V(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,r){this._map.fire(new n.z(t,r?{originalEvent:r}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new Sf("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const _u="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Ol extends n.E{constructor(t,r){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=r.bearingSnap,this._respectPrefersReducedMotion=r.respectPrefersReducedMotion!==!1,n.aP(["_renderFrameCallback"],this)}getCenter(){return new n.bO(this.transform.center.lng,this.transform.center.lat)}setCenter(t,r){return this.jumpTo({center:t},r)}panBy(t,r,u){return t=n.P.convert(t).mult(-1),this.panTo(this.transform.center,n.l({offset:t},r),u)}panTo(t,r,u){return this.easeTo(n.l({center:t},r),u)}getZoom(){return this.transform.zoom}setZoom(t,r){return this.jumpTo({zoom:t},r),this}zoomTo(t,r,u){return this.easeTo(n.l({zoom:t},r),u)}zoomIn(t,r){return this.zoomTo(this.getZoom()+1,t,r),this}zoomOut(t,r){return this.zoomTo(this.getZoom()-1,t,r),this}getBearing(){return this.transform.bearing}setBearing(t,r){return this.jumpTo({bearing:t},r),this}getPadding(){return this.transform.padding}setPadding(t,r){return this.jumpTo({padding:t},r),this}rotateTo(t,r,u){return this.easeTo(n.l({bearing:t},r),u)}resetNorth(t,r){return this.rotateTo(0,n.l({duration:1e3},t),r),this}resetNorthPitch(t,r){return this.easeTo(n.l({bearing:0,pitch:0,duration:1e3},t),r),this}snapToNorth(t,r){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,r):this}getPitch(){return this.transform.pitch}setPitch(t,r){return this.jumpTo({pitch:t},r),this}cameraForBounds(t,r){t=n.az.convert(t);const u=r&&r.bearing||0,p=r&&r.pitch||0,_=t.getNorthWest(),b=t.getSouthEast();return this._cameraForBounds(this.transform,_,b,u,p,r)}_extendPadding(t){const r={top:0,right:0,bottom:0,left:0};return t==null?n.l({},r,this.transform.padding):typeof t=="number"?{top:t,bottom:t,right:t,left:t}:n.l({},r,t)}_extendCameraOptions(t){return(t=n.l({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(t,r){const u=r.max[0]-r.min[0],p=r.max[1]-r.min[1];return u/p>t.aspect?u/(2*Math.tan(.5*t.fovX)*t.aspect):p/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,r,u,p,_,b){const C=t.clone(),O=this._extendCameraOptions(b);C.bearing=p,C.pitch=_;const P=n.bO.convert(r),F=n.bO.convert(u),V=.5*(P.lat+F.lat),U=.5*(P.lng+F.lng),H=n.dC(V,U),J=n.ab.vec3.normalize([],H),$=n.ab.vec3.normalize([],n.ab.vec3.cross([],J,[0,1,0])),te=n.ab.vec3.cross([],$,J),ee=[$[0],$[1],$[2],0,te[0],te[1],te[2],0,J[0],J[1],J[2],0,0,0,0,1],le=[H,n.dC(P.lat,P.lng),n.dC(F.lat,P.lng),n.dC(F.lat,F.lng),n.dC(P.lat,F.lng),n.dC(V,P.lng),n.dC(V,F.lng),n.dC(P.lat,U),n.dC(F.lat,U)];let pe=n.cd.fromPoints(le.map(Je=>[n.ab.vec3.dot($,Je),n.ab.vec3.dot(te,Je),n.ab.vec3.dot(J,Je)]));const fe=n.ab.vec3.transformMat4([],pe.center,ee);n.ab.vec3.squaredLength(fe)===0&&n.ab.vec3.set(fe,0,0,1),n.ab.vec3.normalize(fe,fe),n.ab.vec3.scale(fe,fe,n.ax),C.center=n.dD(fe);const be=C.getWorldToCameraMatrix(),me=n.ab.mat4.invert(new Float64Array(16),be);pe=n.cd.applyTransform(pe,n.ab.mat4.multiply([],be,ee));const ve=this._extendAABB(pe,C,O,p);if(!ve)return void n.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");pe=ve,n.ab.vec3.transformMat4(fe,fe,be);const _e=.5*(pe.max[2]-pe.min[2]),Ee=this._minimumAABBFrustumDistance(C,pe),ze=n.ab.vec3.scale([],[0,0,1],_e),Ye=n.ab.vec3.add(ze,fe,ze),qe=Ee+(C.pitch===0?0:n.ab.vec3.distance(fe,Ye)),lt=C.globeCenterInViewSpace,it=n.ab.vec3.sub([],fe,[lt[0],lt[1],lt[2]]);n.ab.vec3.normalize(it,it),n.ab.vec3.scale(it,it,qe);const Be=n.ab.vec3.add([],fe,it);n.ab.vec3.transformMat4(Be,Be,me);const Ke=n.ds/n.ax,gt=n.ab.vec3.length(Be),Fe=n.bH(Math.max(gt*Ke-n.ds,Number.EPSILON),0),st=Math.min(C.zoomFromMercatorZAdjusted(Fe),O.maxZoom);return st>.5*(n.c6+n.bY)?(C.setProjection({name:"mercator"}),C.zoom=st,this._cameraForBounds(C,r,u,p,_,b)):{center:C.center,zoom:st,bearing:p,pitch:_}}_extendAABB(t,r,u,p){const _=.5*((u.padding.left||0)+(u.padding.right||0)),b=.5*((u.padding.top||0)+(u.padding.bottom||0)),C=b,O=_,P=_,F=b,V=r.width-(O+P),U=r.height-(C+F),H=n.ab.vec3.sub([],t.max,t.min),J=Math.min(V/H[0],U/H[1]),$=Math.min(r.scaleZoom(r.scale*J),u.maxZoom);if(isNaN($))return null;const te=r.scale/r.zoomScale($),ee=new n.cd([t.min[0]-O*te,t.min[1]-F*te,t.min[2]],[t.max[0]+P*te,t.max[1]+C*te,t.max[2]]),le=(typeof u.offset.x=="number"&&typeof u.offset.y=="number"?new n.P(u.offset.x,u.offset.y):n.P.convert(u.offset)).rotate(-n.ai(p));return ee.center[0]-=le.x*te,ee.center[1]+=le.y*te,ee}queryTerrainElevation(t,r){const u=this.transform.elevation;return u?(r=n.l({},{exaggerated:!0},r),u.getAtPoint(n.aa.fromLngLat(t),null,r.exaggerated)):null}_cameraForBounds(t,r,u,p,_,b){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,r,u,p,_,b);const C=t.clone(),O=this._extendCameraOptions(b);C.bearing=p,C.pitch=_;const P=n.bO.convert(r),F=n.bO.convert(u),V=new n.bO(P.lng,F.lat),U=new n.bO(F.lng,P.lat),H=C.project(P),J=C.project(F),$=this.queryTerrainElevation(P),te=this.queryTerrainElevation(F),ee=this.queryTerrainElevation(V),le=this.queryTerrainElevation(U),pe=[[H.x,H.y,Math.min($||0,te||0,ee||0,le||0)],[J.x,J.y,Math.max($||0,te||0,ee||0,le||0)]];let fe=n.cd.fromPoints(pe);const be=C.getWorldToCameraMatrix(),me=n.ab.mat4.invert(new Float64Array(16),be);fe=n.cd.applyTransform(fe,be);const ve=this._extendAABB(fe,C,O,p);if(!ve)return void n.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");fe=ve;const _e=.5*n.ab.vec3.sub([],fe.max,fe.min)[2],Ee=this._minimumAABBFrustumDistance(C,fe),ze=[0,0,1,0];n.ab.vec4.transformMat4(ze,ze,be),n.ab.vec4.normalize(ze,ze);const Ye=n.ab.vec3.scale([],ze,Ee+_e),qe=n.ab.vec3.add([],fe.center,Ye);n.ab.vec3.transformMat4(fe.center,fe.center,me),n.ab.vec3.transformMat4(qe,qe,me);const lt=C.unproject(new n.P(fe.center[0],fe.center[1])),it=n.dE(C.projection,lt),Be=Math.pow(2,it),Ke=Math.min(C._zoomFromMercatorZ(qe[2]*C.pixelsPerMeter*Be/C.worldSize),O.maxZoom);return C.mercatorFromTransition&&Ke<.5*(n.c6+n.bY)?(C.setProjection({name:"globe"}),C.zoom=Ke,this._cameraForBounds(C,r,u,p,_,b)):{center:lt,zoom:Ke,bearing:p,pitch:_}}fitBounds(t,r,u){const p=this.cameraForBounds(t,r);return this._fitInternal(p,r,u)}fitScreenCoordinates(t,r,u,p,_){const b=n.P.convert(t),C=n.P.convert(r),O=new n.P(Math.min(b.x,C.x),Math.min(b.y,C.y)),P=new n.P(Math.max(b.x,C.x),Math.max(b.y,C.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(b,C))return this;const F=this.transform.pointLocation3D(O),V=this.transform.pointLocation3D(P),U=this.transform.pointLocation3D(new n.P(O.x,P.y)),H=this.transform.pointLocation3D(new n.P(P.x,O.y)),J=[Math.min(F.lng,V.lng,U.lng,H.lng),Math.min(F.lat,V.lat,U.lat,H.lat)],$=[Math.max(F.lng,V.lng,U.lng,H.lng),Math.max(F.lat,V.lat,U.lat,H.lat)],te=p&&p.pitch?p.pitch:this.getPitch(),ee=this._cameraForBounds(this.transform,J,$,u,te,p);return this._fitInternal(ee,p,_)}_fitInternal(t,r,u){return t?(r=n.l(t,r)).linear?this.easeTo(r,u):this.flyTo(r,u):this}jumpTo(t,r){this.stop();const u=t.preloadOnly?this.transform.clone():this.transform;let p=!1,_=!1,b=!1;"zoom"in t&&u.zoom!==+t.zoom&&(p=!0,u.zoom=+t.zoom),t.center!==void 0&&(u.center=n.bO.convert(t.center)),"bearing"in t&&u.bearing!==+t.bearing&&(_=!0,u.bearing=+t.bearing),"pitch"in t&&u.pitch!==+t.pitch&&(b=!0,u.pitch=+t.pitch);const C=typeof t.padding=="number"?this._extendPadding(t.padding):t.padding;if(t.padding!=null&&!u.isPaddingEqual(C))if(t.retainPadding===!1){const O=u.clone();O.padding=C,u.setLocationAtPoint(u.center,O.centerPoint)}else u.padding=C;return t.preloadOnly?(this._preloadTiles(u),this):(this.fire(new n.z("movestart",r)).fire(new n.z("move",r)),p&&this.fire(new n.z("zoomstart",r)).fire(new n.z("zoom",r)).fire(new n.z("zoomend",r)),_&&this.fire(new n.z("rotatestart",r)).fire(new n.z("rotate",r)).fire(new n.z("rotateend",r)),b&&this.fire(new n.z("pitchstart",r)).fire(new n.z("pitch",r)).fire(new n.z("pitchend",r)),this.fire(new n.z("moveend",r)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||n.w(_u),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,r){const u=this.transform;if(!u.projection.supportsFreeCamera)return n.w(_u),this;this.stop();const p=u.zoom,_=u.pitch,b=u.bearing;u.setFreeCameraOptions(t);const C=p!==u.zoom,O=_!==u.pitch,P=b!==u.bearing;return this.fire(new n.z("movestart",r)).fire(new n.z("move",r)),C&&this.fire(new n.z("zoomstart",r)).fire(new n.z("zoom",r)).fire(new n.z("zoomend",r)),P&&this.fire(new n.z("rotatestart",r)).fire(new n.z("rotate",r)).fire(new n.z("rotateend",r)),O&&this.fire(new n.z("pitchstart",r)).fire(new n.z("pitch",r)).fire(new n.z("pitchend",r)),this.fire(new n.z("moveend",r)),this}easeTo(t,r){this._stop(!1,t.easeId),((t=n.l({offset:[0,0],duration:500,easing:n.dA},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);const u=this.transform,p=this.getZoom(),_=this.getBearing(),b=this.getPitch(),C=this.getPadding(),O="zoom"in t?+t.zoom:p,P="bearing"in t?this._normalizeBearing(t.bearing,_):_,F="pitch"in t?+t.pitch:b,V=this._extendPadding(t.padding),U=n.P.convert(t.offset);let H,J,$;if(u.projection.name==="globe"){const ze=n.aa.fromLngLat(u.center),Ye=U.rotate(-u.angle);ze.x+=Ye.x/u.worldSize,ze.y+=Ye.y/u.worldSize;const qe=ze.toLngLat(),lt=n.bO.convert(t.center||qe);this._normalizeCenter(lt),H=u.centerPoint.add(Ye),J=new n.P(ze.x,ze.y).mult(u.worldSize),$=new n.P(n.at(lt.lng),n.aA(lt.lat)).mult(u.worldSize).sub(J)}else{H=u.centerPoint.add(U);const ze=u.pointLocation(H),Ye=n.bO.convert(t.center||ze);this._normalizeCenter(Ye),J=u.project(ze),$=u.project(Ye).sub(J)}const te=u.zoomScale(O-p);let ee,le;t.around&&(ee=n.bO.convert(t.around),le=u.locationPoint(ee));const pe=this._zooming||O!==p,fe=this._rotating||_!==P,be=this._pitching||F!==b,me=!u.isPaddingEqual(V),ve=t.retainPadding===!1?u.clone():u,_e=ze=>Ye=>{if(pe&&(ze.zoom=n.af(p,O,Ye)),fe&&(ze.bearing=n.af(_,P,Ye)),be&&(ze.pitch=n.af(b,F,Ye)),me&&(ve.interpolatePadding(C,V,Ye),H=ve.centerPoint.add(U)),ee)ze.setLocationAtPoint(ee,le);else{const qe=ze.zoomScale(ze.zoom-p),lt=O>p?Math.min(2,te):Math.max(.5,te),it=Math.pow(lt,1-Ye),Be=ze.unproject(J.add($.mult(Ye*it)).mult(qe));ze.setLocationAtPoint(ze.renderWorldCopies?Be.wrap():Be,H)}return t.preloadOnly||this._fireMoveEvents(r),ze};if(t.preloadOnly){const ze=this._emulate(_e,t.duration,u);return this._preloadTiles(ze),this}const Ee={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=pe,this._rotating=fe,this._pitching=be,this._padding=me,this._easeId=t.easeId,this._prepareEase(r,t.noMoveStart,Ee),this._ease(_e(u),ze=>{u.cameraElevationReference==="sea"&&u.recenterOnTerrain(),this._afterEase(r,ze)},t),this}_prepareEase(t,r,u={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),r||u.moving||this.fire(new n.z("movestart",t)),this._zooming&&!u.zooming&&this.fire(new n.z("zoomstart",t)),this._rotating&&!u.rotating&&this.fire(new n.z("rotatestart",t)),this._pitching&&!u.pitching&&this.fire(new n.z("pitchstart",t))}_fireMoveEvents(t){this.fire(new n.z("move",t)),this._zooming&&this.fire(new n.z("zoom",t)),this._rotating&&this.fire(new n.z("rotate",t)),this._pitching&&this.fire(new n.z("pitch",t))}_afterEase(t,r){if(this._easeId&&r&&this._easeId===r)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const u=this._zooming,p=this._rotating,_=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,u&&this.fire(new n.z("zoomend",t)),p&&this.fire(new n.z("rotateend",t)),_&&this.fire(new n.z("pitchend",t)),this.fire(new n.z("moveend",t))}flyTo(t,r){if(this._prefersReducedMotion(t)){const Je=n.ay(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Je,r)}this.stop(),t=n.l({offset:[0,0],speed:1.2,curve:1.42,easing:n.dA},t);const u=this.transform,p=this.getZoom(),_=this.getBearing(),b=this.getPitch(),C=this.getPadding(),O="zoom"in t?n.aw(+t.zoom,u.minZoom,u.maxZoom):p,P="bearing"in t?this._normalizeBearing(t.bearing,_):_,F="pitch"in t?+t.pitch:b,V=this._extendPadding(t.padding),U=u.zoomScale(O-p),H=n.P.convert(t.offset);let J=u.centerPoint.add(H);const $=u.pointLocation(J),te=n.bO.convert(t.center||$);this._normalizeCenter(te);const ee=u.project($),le=u.project(te).sub(ee);let pe=t.curve;const fe=Math.max(u.width,u.height),be=fe/U,me=le.mag();if("minZoom"in t){const Je=n.aw(Math.min(t.minZoom,p,O),u.minZoom,u.maxZoom),St=fe/u.zoomScale(Je-p);pe=Math.sqrt(St/me*2)}const ve=pe*pe;function _e(Je){const St=(be*be-fe*fe+(Je?-1:1)*ve*ve*me*me)/(2*(Je?be:fe)*ve*me);return Math.log(Math.sqrt(St*St+1)-St)}function Ee(Je){return(Math.exp(Je)-Math.exp(-Je))/2}function ze(Je){return(Math.exp(Je)+Math.exp(-Je))/2}const Ye=_e(0);let qe=function(Je){return ze(Ye)/ze(Ye+pe*Je)},lt=function(Je){return fe*((ze(Ye)*(Ee(St=Ye+pe*Je)/ze(St))-Ee(Ye))/ve)/me;var St},it=(_e(1)-Ye)/pe;if(Math.abs(me)<1e-6||!isFinite(it)){if(Math.abs(fe-be)<1e-6)return this.easeTo(t,r);const Je=be<fe?-1:1;it=Math.abs(Math.log(be/fe))/pe,lt=function(){return 0},qe=function(St){return Math.exp(Je*pe*St)}}t.duration="duration"in t?+t.duration:1e3*it/("screenSpeed"in t?+t.screenSpeed/pe:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const Be=_!==P,Ke=F!==b,gt=!u.isPaddingEqual(V),Fe=t.retainPadding===!1?u.clone():u,st=Je=>St=>{const dt=St*it,ct=1/qe(dt);Je.zoom=St===1?O:p+Je.scaleZoom(ct),Be&&(Je.bearing=n.af(_,P,St)),Ke&&(Je.pitch=n.af(b,F,St)),gt&&(Fe.interpolatePadding(C,V,St),J=Fe.centerPoint.add(H));const vt=St===1?te:Je.unproject(ee.add(le.mult(lt(dt))).mult(ct));return Je.setLocationAtPoint(Je.renderWorldCopies?vt.wrap():vt,J),Je._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(r),Je};if(t.preloadOnly){const Je=this._emulate(st,t.duration,u);return this._preloadTiles(Je),this}return this._zooming=!0,this._rotating=Be,this._pitching=Ke,this._padding=gt,this._prepareEase(r,!1),this._ease(st(u),()=>this._afterEase(r),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,r){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const u=this._onEaseEnd;this._onEaseEnd=void 0,u.call(this,r)}if(!t){const u=this.handlers;u&&u.stop(!1)}return this}_ease(t,r,u){u.animate===!1||u.duration===0?(t(1),r()):(this._easeStart=n.q.now(),this._easeOptions=u,this._onEaseFrame=t,this._onEaseEnd=r,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((n.q.now()-this._easeStart)/this._easeOptions.duration,1),r=this._onEaseFrame;r&&r(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,r){t=n.bF(t,-180,180);const u=Math.abs(t-r);return Math.abs(t-360-r)<u&&(t-=360),Math.abs(t+360-r)<u&&(t+=360),t}_normalizeCenter(t){const r=this.transform;if(r.maxBounds||r.projection.name!=="globe"&&!r.renderWorldCopies)return;const u=t.lng-r.center.lng;t.lng+=u>180?-360:u<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&n.q.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,r,u){const p=Math.ceil(15*r/1e3),_=[],b=t(u.clone());for(let C=0;C<=p;C++){const O=b(C/p);_.push(O.clone())}return _}_preloadTiles(t,r){}}class gu{constructor(t={}){this.options=t,n.aP(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const r=this.options&&this.options.compact,u=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=tt("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=tt("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",u);const p=tt("span","mapboxgl-ctrl-icon",this._compactButton);return p.setAttribute("aria-hidden","true"),p.setAttribute("title",u),this._innerContainer=tt("div","mapboxgl-ctrl-attrib-inner",this._container),r&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),r===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const r=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||n.e.ACCESS_TOKEN}];if(t){const u=r.reduce((p,_,b)=>(_.value&&(p+=`${_.key}=${_.value}${b<r.length-1?"&":""}`),p),"?");t.href=`${n.e.FEEDBACK_URL}/${u}#${yf(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const p=this._map.style.stylesheet;this.styleOwner=p.owner,this.styleId=p.id}const r=this._map.style._mergedSourceCaches;for(const p in r){const _=r[p];if(_.used){const b=_.getSource();b.attribution&&t.indexOf(b.attribution)<0&&t.push(b.attribution)}}t.sort((p,_)=>p.length-_.length),t=t.filter((p,_)=>{for(let b=_+1;b<t.length;b++)if(t[b].indexOf(p)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const u=t.join(" | ");u!==this._attribHTML&&(this._attribHTML=u,t.length?(this._innerContainer.innerHTML=u,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class da{constructor(){n.aP(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=tt("div","mapboxgl-ctrl");const r=tt("a","mapboxgl-ctrl-logo");return r.target="_blank",r.rel="noopener nofollow",r.href="https://www.mapbox.com/",r.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),r.setAttribute("rel","noopener nofollow"),this._container.appendChild(r),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const r in t){const u=t[r].getSource();if(u.hasOwnProperty("mapbox_logo")&&!u.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const r=t[0];this._map.getCanvasContainer().offsetWidth<250?r.classList.add("mapboxgl-compact"):r.classList.remove("mapboxgl-compact")}}}class pa{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const r=++this._id;return this._queue.push({callback:t,id:r,cancelled:!1}),r}remove(t){const r=this._currentlyRunning,u=r?this._queue.concat(r):this._queue;for(const p of u)if(p.id===t)return void(p.cancelled=!0)}run(t=0){const r=this._currentlyRunning=this._queue;this._queue=[];for(const u of r)if(!u.cancelled&&(u.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class gc{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const r=n.cB((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-r)+this._end*r}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,r,u){this._start=this.getValue(r),this._end=t,this._startTime=r,this._endTime=r+u}}const Ll={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Ws extends n.z{constructor(t,r,u,p){const{point:_,lngLat:b,originalEvent:C,target:O}=t;super(t.type,{point:_,lngLat:b,originalEvent:C,target:O}),this.preventDefault=()=>{t.preventDefault()},this.id=r,this.interaction=u,this.feature=p}}class yo{constructor(t){this.map=t,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(t,r){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);const u=r.filter;let p=r.type;u&&this.filters.set(t,n.aZ(u)),p==="mouseover"&&(p="mouseenter"),p==="mouseout"&&(p="mouseleave");const _=this.interactionsByType.get(p)||new Map;p==="mouseenter"||p==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(t,r)):_.size===0&&this.map.on(p,this.handleType),_.size===0&&this.interactionsByType.set(p,_),_.set(t,r),this.typeById.set(t,p)}get(t){const r=this.typeById.get(t);if(!r)return;const u=this.interactionsByType.get(r);return u?u.get(t):void 0}remove(t){const r=this.typeById.get(t);if(!r)return;this.typeById.delete(t),this.filters.delete(t);const u=this.interactionsByType.get(r);u&&(u.delete(t),r==="mouseenter"||r==="mouseleave"?(this.delegatedInteractions.delete(t),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):u.size===0&&this.map.off(r,this.handleType))}queryTargets(t,r){const u=[];for(const[p,_]of r)_.target&&u.push({targetId:p,target:_.target,filter:this.filters.get(p)});return this.map.style.queryRenderedTargets(t,u,this.map.transform)}handleMove(t){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const r=this.queryTargets(t.point,Array.from(this.delegatedInteractions).reverse());r.length&&(t.type="mouseenter",this.handleType(t,r));const u=new Map;for(const[p,{feature:_}]of this.prevHoveredFeatures)this.hoveredFeatures.has(p)||u.set(_.id,_);u.size&&(t.type="mouseleave",this.handleType(t,Array.from(u.values())))}handleOut(t){const r=Array.from(this.hoveredFeatures.values()).map(({feature:u})=>u);r.length&&(t.type="mouseleave",this.handleType(t,r)),this.hoveredFeatures.clear()}handleType(t,r){const u=Array.from(this.interactionsByType.get(t.type)).reverse(),p=!!r;r=r||this.queryTargets(t.point,u);const _=t.type==="mouseenter";let b=!1;const C=new Set;for(const O of r){for(const[P,F]of u){if(!F.target)continue;const V=O.variants?O.variants[P]:null;if(V){for(const U of V){if(Eo(U,O,C,P))continue;const H=new n.cw(O,U),J=Fc(U,O,P);p&&(H.state=this.map.getFeatureState(H));const $=_?this.prevHoveredFeatures.get(J):null,te=new Ws(t,P,F,H),ee=$?$.stop:F.handler(te);if(_&&this.hoveredFeatures.set(J,{feature:O,stop:ee}),ee!==!1){b=!0;break}}if(b)break}}if(b)break}if(!b)for(const[O,P]of u){const{handler:F,target:V}=P;if(!V&&F(new Ws(t,O,P,null))!==!1)break}}}function ir(c,t){if(Array.isArray(c)&&Array.isArray(t)){const r=new Set(c),u=new Set(t);return r.size===u.size&&c.every(p=>u.has(p))}return n.bn(c,t)}const Xo={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},yc={showCompass:!0,showZoom:!0,visualizePitch:!1};class ns{constructor(t,r,u=!1){this._clickTolerance=10,this.element=r,this.mouseRotate=new Cs({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,u&&(this.mousePitch=new _c({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),n.aP(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),r.addEventListener("mousedown",this.mousedown),r.addEventListener("touchstart",this.touchstart,{passive:!1}),r.addEventListener("touchmove",this.touchmove),r.addEventListener("touchend",this.touchend),r.addEventListener("touchcancel",this.reset)}down(t,r){this.mouseRotate.mousedown(t,r),this.mousePitch&&this.mousePitch.mousedown(t,r),Mt()}move(t,r){const u=this.map,p=this.mouseRotate.mousemoveWindow(t,r),_=p&&p.bearingDelta;if(_&&u.setBearing(u.getBearing()+_),this.mousePitch){const b=this.mousePitch.mousemoveWindow(t,r),C=b&&b.pitchDelta;C&&u.setPitch(u.getPitch()+C)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart,{passive:!1}),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Ft(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(n.l({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),Fi(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,Fi(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ai(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=ai(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function vh(c,t,r){if(c=new n.bO(c.lng,c.lat),t){const u=new n.bO(c.lng-360,c.lat),p=new n.bO(c.lng+360,c.lat),_=360*Math.ceil(Math.abs(c.lng-r.center.lng)/360),b=r.locationPoint(c).distSqr(t),C=t.x<0||t.y<0||t.x>r.width||t.y>r.height;r.locationPoint(u).distSqr(t)<b&&(C||Math.abs(u.lng-r.center.lng)<_)?c=u:r.locationPoint(p).distSqr(t)<b&&(C||Math.abs(p.lng-r.center.lng)<_)&&(c=p)}for(;Math.abs(c.lng-r.center.lng)>180;){const u=r.locationPoint(c);if(u.x>=0&&u.y>=0&&u.x<=r.width&&u.y<=r.height)break;c.lng>r.center.lng?c.lng-=360:c.lng+=360}return c}const $s={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Is extends n.E{constructor(t,r){if(super(),(t instanceof HTMLElement||r)&&(t=n.l({element:t},r)),n.aP(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=t&&t.occludedOpacity||.2,t&&t.element)this._element=t.element,this._offset=n.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=tt("div");const _=41,b=27,C=pt("svg",{display:"block",height:_*this._scale+"px",width:b*this._scale+"px",viewBox:`0 0 ${b} ${_}`},this._element),O=pt("radialGradient",{id:"shadowGradient"},pt("defs",{},C));pt("stop",{offset:"10%","stop-opacity":.4},O),pt("stop",{offset:"100%","stop-opacity":.05},O),pt("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},C),pt("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},C),pt("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},C),pt("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},C),this._offset=n.P.convert(t&&t.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",_=>{_.preventDefault()}),this._element.addEventListener("mousedown",_=>{_.preventDefault()});const u=this._element.classList;for(const _ in $s)u.remove(`mapboxgl-marker-anchor-${_}`);u.add(`mapboxgl-marker-anchor-${this._anchor}`);const p=t&&t.className?t.className.trim().split(/\s+/):[];u.add(...p),this._popup=null}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=n.bO.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const p=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[p,-1*(38.1-13.5+p)],"bottom-right":[-p,-1*(38.1-13.5+p)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const r=t.code,u=t.charCode||t.keyCode;r!=="Space"&&r!=="Enter"&&u!==32&&u!==13||this.togglePopup()}_onMapClick(t){const r=t.originalEvent.target,u=this._element;this._popup&&(r===u||u.contains(r))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,r=this._pos;if(!t||!r)return!1;const u=t.unproject(r),p=t.getFreeCameraOptions();if(!p.position)return!1;const _=p.position.toLngLat();return _.distanceTo(u)<.9*_.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const r=this._pos;if(!r||r.x<0||r.x>t.transform.width||r.y<0||r.y>t.transform.height)return void this._clearFadeTimer();const u=t.unproject(r);let p;t._showingGlobe()&&n.dH(t.transform,this._lngLat)?p=0:(p=1-t._queryFogOpacity(u),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(p*=this._occludedOpacity)),this._element.style.opacity=`${p}`,this._element.style.pointerEvents=p>0?"auto":"none",this._popup&&this._popup._setOpacity(p),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const r=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${$s[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${r.x}px,${r.y}px)
        `}_calculateXYTransform(){const t=this._pos,r=this._map,u=this.getPitchAlignment();if(!r||!t||u!=="map")return"";if(!r._showingGlobe()){const O=r.getPitch();return O?`rotateX(${O}deg)`:""}const p=n.c4(n.dI(r.transform,this._lngLat)),_=t.sub(n.dJ(r.transform)),b=Math.abs(_.x)+Math.abs(_.y);if(b===0)return"";const C=p/b;return`rotateX(${-_.y*C}deg) rotateY(${_.x*C}deg)`}_calculateZTransform(){const t=this._pos,r=this._map;if(!r||!t)return"";let u=0;const p=this.getRotationAlignment();if(p==="map")if(r._showingGlobe()){const _=r.project(new n.bO(this._lngLat.lng,this._lngLat.lat+.001)),b=r.project(new n.bO(this._lngLat.lng,this._lngLat.lat-.001)).sub(_);u=n.c4(Math.atan2(b.y,b.x))-90}else u=-r.getBearing();else if(p==="horizon"){const _=n.ac(4,6,r.getZoom()),b=n.dJ(r.transform);b.y+=_*r.transform.height;const C=t.sub(b),O=n.c4(Math.atan2(C.y,C.x));u=(O>90?O-270:O+90)*(1-_)}return u+=this._rotation,u?`rotateZ(${u}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);const r=this._map;r&&(r.transform.renderWorldCopies&&(this._lngLat=vh(this._lngLat,this._pos,r.transform)),this._pos=r.project(this._lngLat),t===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),r._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(r._showingGlobe()||r.getTerrain()||r.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=n.P.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const r=this._map;if(!r)return;const u=this._pointerdownPos,p=this._positionDelta;if(u&&p){if(!this._isDragging){const _=this._clickTolerance||r._clickTolerance;if(t.point.dist(u)<_)return;this._isDragging=!0}this._pos=t.point.sub(p),this._lngLat=r.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new n.z("dragstart"))),this.fire(new n.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new n.z("dragend")),this._state="inactive"}_addDragHandler(t){const r=this._map,u=this._pos;r&&u&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(u),this._pointerdownPos=t.point,this._state="pending",r.on("mousemove",this._onMove),r.on("touchmove",this._onMove),r.once("mouseup",this._onUp),r.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const r=this._map;return r&&(t?(r.on("mousedown",this._addDragHandler),r.on("touchstart",this._addDragHandler)):(r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const sa={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},va={maxWidth:100,unit:"metric"},gn={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},vo={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Tr=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function xh(c=new n.P(0,0),t="bottom"){if(typeof c=="number"){const r=Math.round(Math.sqrt(.5*Math.pow(c,2)));switch(t){case"top":return new n.P(0,c);case"top-left":return new n.P(r,r);case"top-right":return new n.P(-r,r);case"bottom":return new n.P(0,-c);case"bottom-left":return new n.P(r,-r);case"bottom-right":return new n.P(-r,-r);case"left":return new n.P(c,0);case"right":return new n.P(-c,0)}return new n.P(0,0)}return c instanceof n.P||Array.isArray(c)?n.P.convert(c):n.P.convert(c[t]||[0,0])}return{version:ae,supported:Qe.supported,setRTLTextPlugin:n.dK,getRTLTextPluginStatus:n.dL,Map:class extends Ol{constructor(c){ge.mark(ne.create);const t=c;if((c=n.l({},Xo,c)).minZoom!=null&&c.maxZoom!=null&&c.minZoom>c.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(c.minPitch!=null&&c.maxPitch!=null&&c.minPitch>c.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(c.minPitch!=null&&c.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(c.maxPitch!=null&&c.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(c.antialias&&n.dF(window)&&(c.antialias=!1,n.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Yu(c.minZoom,c.maxZoom,c.minPitch,c.maxPitch,c.renderWorldCopies),c),this._repaint=!!c.repaint,this._interactive=c.interactive,this._minTileCacheSize=c.minTileCacheSize,this._maxTileCacheSize=c.maxTileCacheSize,this._failIfMajorPerformanceCaveat=c.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=c.preserveDrawingBuffer,this._antialias=c.antialias,this._trackResize=c.trackResize,this._bearingSnap=c.bearingSnap,this._refreshExpiredTiles=c.refreshExpiredTiles,this._fadeDuration=c.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=c.crossSourceCollisions,this._collectResourceTiming=c.collectResourceTiming,this._language=this._parseLanguage(c.language),this._worldview=c.worldview,this._renderTaskQueue=new pa,this._domRenderTaskQueue=new pa,this._controls=[],this._markers=[],this._popups=[],this._mapId=n.aV(),this._locale=n.l({},Ll,c.locale),this._clickTolerance=c.clickTolerance,this._cooperativeGestures=c.cooperativeGestures,this._performanceMetricsCollection=c.performanceMetricsCollection,this._tessellationStep=c.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=c.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new gc(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=c.scaleFactor,this._requestManager=new wn(c.transformRequest,c.accessToken,c.testMode),this._silenceAuthErrors=!!c.testMode,this._contextCreateOptions=c.contextCreateOptions?Object.assign({},c.contextCreateOptions):{},typeof c.container=="string"){const r=document.getElementById(c.container);if(!r)throw new Error(`Container '${c.container.toString()}' not found.`);this._container=r}else{if(!(c.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=c.container}if(this._container.childNodes.length>0&&n.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),c.maxBounds&&this.setMaxBounds(c.maxBounds),this._spriteFormat=c.spriteFormat,n.aP(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new uu),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Zo(this,c),this._localFontFamily=c.localFontFamily,this._localIdeographFontFamily=c.localIdeographFontFamily,(c.style||!c.testMode)&&this.setStyle(c.style||n.e.DEFAULT_STYLE,{config:c.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),c.projection&&this.setProjection(c.projection),this.indoor=new ol(this),c.hash&&(this._hash=new ph(typeof c.hash=="string"&&c.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch});const r=c.bounds;r&&(this.resize(),this.fitBounds(r,n.l({},c.fitBoundsOptions,{duration:0})))}this.resize(),c.attributionControl&&this.addControl(new gu({customAttribution:c.customAttribution})),this._logoControl=new da,this.addControl(this._logoControl,c.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",r=>{this._update(r.dataType==="style"),this.fire(new n.z(`${r.dataType}data`,r))}),this.on("dataloading",r=>{this.fire(new n.z(`${r.dataType}dataloading`,r))}),this._interactions=new yo(this)}_getMapId(){return this._mapId}addControl(c,t){if(t===void 0&&(t=c.getDefaultPosition?c.getDefaultPosition():"top-right"),!c||!c.onAdd)return this.fire(new n.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=c.onAdd(this);this._controls.push(c);const u=this._controlPositions[t];return t.indexOf("bottom")!==-1?u.insertBefore(r,u.firstChild):u.appendChild(r),this}removeControl(c){if(!c||!c.onRemove)return this.fire(new n.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(c);return t>-1&&this._controls.splice(t,1),c.onRemove(this),this}hasControl(c){return this._controls.indexOf(c)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(c){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new n.z("movestart",c)).fire(new n.z("move",c)),this.fire(new n.z("resize",c)),t&&this.fire(new n.z("moveend",c)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(c){return this.transform.setMaxBounds(n.az.convert(c)),this._update()}setMinZoom(c){if((c=c??-2)>=-2&&c<=this.transform.maxZoom)return this.transform.minZoom=c,this._update(),this.getZoom()<c?this.setZoom(c):this.fire(new n.z("zoomstart")).fire(new n.z("zoom")).fire(new n.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(c){if((c=c??22)>=this.transform.minZoom)return this.transform.maxZoom=c,this._update(),this.getZoom()>c?this.setZoom(c):this.fire(new n.z("zoomstart")).fire(new n.z("zoom")).fire(new n.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(c){if((c=c??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(c>=0&&c<=this.transform.maxPitch)return this.transform.minPitch=c,this._update(),this.getPitch()<c?this.setPitch(c):this.fire(new n.z("pitchstart")).fire(new n.z("pitch")).fire(new n.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(c){if((c=c??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(c>=this.transform.minPitch)return this.transform.maxPitch=c,this._update(),this.getPitch()>c?this.setPitch(c):this.fire(new n.z("pitchstart")).fire(new n.z("pitch")).fire(new n.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(c){return this._scaleFactor=c,this.painter.scaleFactor=c,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(t=>t.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(c){return this.transform.renderWorldCopies=c,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(c){return c==="auto"?navigator.language:Array.isArray(c)?c.length===0?void 0:c.map(t=>t==="auto"?navigator.language:t):c}setLanguage(c){const t=this._parseLanguage(c);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const r of this._controls)r._setLanguage&&r._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(c){return this.style&&c!==this._worldview?(this._worldview=c,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(c){return this._lazyInitEmptyStyle(),c?typeof c=="string"&&(c={name:c}):c=null,this._useExplicitProjection=!!c,this._prioritizeAndUpdateProjection(c,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const c=this.transform,t=c.projection.name;let r;t==="globe"&&c.zoom>=n.bY?(c.setMercatorFromTransition(),r=!0):t==="mercator"&&c.zoom<n.bY&&(c.setProjection({name:"globe"}),r=!0),r&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(c,t){return this._updateProjection(c||t||{name:"mercator"})}_updateProjection(c){let t;return t=c.name==="globe"&&this.transform.zoom>=n.bY?this.transform.setMercatorFromTransition():this.transform.setProjection(c),this.style.applyProjectionUpdate(),t&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(c){return this.transform.locationPoint3D(n.bO.convert(c))}unproject(c){return this.transform.pointLocation3D(n.P.convert(c))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(c,t,r){const u=p=>{let _=[];if(Array.isArray(t)){const b=t.filter(C=>this.getLayer(C));_=b.length?this.queryRenderedFeatures(p,{layers:b}):[]}else _=this.queryRenderedFeatures(p,{target:t});return _};if(c==="mouseenter"||c==="mouseover"){let p=!1;return{listener:r,targets:t,delegates:{mousemove:b=>{const C=u(b.point);C.length?p||(p=!0,r.call(this,new Ra(c,this,b.originalEvent,{features:C}))):p=!1},mouseout:()=>{p=!1}}}}if(c==="mouseleave"||c==="mouseout"){let p=!1;return{listener:r,targets:t,delegates:{mousemove:C=>{u(C.point).length?p=!0:p&&(p=!1,r.call(this,new Ra(c,this,C.originalEvent)))},mouseout:C=>{p&&(p=!1,r.call(this,new Ra(c,this,C.originalEvent)))}}}}{const p=_=>{const b=u(_.point);b.length&&(_.features=b,r.call(this,_),delete _.features)};return{listener:r,targets:t,delegates:{[c]:p}}}}on(c,t,r){if(typeof t=="function"||r===void 0)return super.on(c,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const u=this._createDelegatedListener(c,t,r);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[c]=this._delegatedListeners[c]||[],this._delegatedListeners[c].push(u);for(const p in u.delegates)this.on(p,u.delegates[p]);return this}once(c,t,r){if(typeof t=="function"||r===void 0)return super.once(c,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const u=this._createDelegatedListener(c,t,r);for(const p in u.delegates)this.once(p,u.delegates[p]);return this}off(c,t,r){if(typeof t=="function"||r===void 0)return super.off(c,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const u=this._delegatedListeners?this._delegatedListeners[c]:void 0;return u&&(p=>{for(let _=0;_<p.length;_++){const b=p[_];if(b.listener===r&&ir(b.targets,t)){for(const C in b.delegates)this.off(C,b.delegates[C]);return p.splice(_,1),this}}})(u),this}queryRenderedFeatures(c,t){if(!this.style)return[];if(c===void 0||c instanceof n.P||Array.isArray(c)||t!==void 0||(t=c,c=void 0),c=c||[[0,0],[this.transform.width,this.transform.height]],!t){const _=this.style.queryRenderedFeatures(c,void 0,this.transform),b=this.style.queryRenderedFeatureset(c,void 0,this.transform);return _.concat(b)}let r=!0;if(t.target&&(r=this._isTargetValid(t.target),r&&!t.layers))return this.style.queryRenderedFeatureset(c,t,this.transform);let u=!0;if(t.layers&&Array.isArray(t.layers)){for(const _ of t.layers)if(!this._isValidId(_)){u=!1;break}if(u&&!t.target)return this.style.queryRenderedFeatures(c,t,this.transform)}let p=[];return u&&(p=p.concat(this.style.queryRenderedFeatures(c,t,this.transform))),r&&(p=p.concat(this.style.queryRenderedFeatureset(c,t,this.transform))),p}querySourceFeatures(c,t){return!c||typeof c=="string"&&!this._isValidId(c)?[]:this.style.querySourceFeatures(c,t)}isPointOnSurface(c){const{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&n.w(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(n.P.convert(c))}addInteraction(c,t){return this._interactions.add(c,t),this}removeInteraction(c){return this._interactions.remove(c),this}setStyle(c,t){return t=n.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t),this.style&&c&&t.diff!==!1&&t.localFontFamily===this._localFontFamily&&t.localIdeographFontFamily===this._localIdeographFontFamily&&!t.config?(this.style._diffStyle(c,(r,u)=>{r?(n.w(`Unable to perform style diff: ${String(r.message||r.error||r)}. Rebuilding the style from scratch.`),this._updateStyle(c,t)):u&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(c,t))}_getUIString(c){const t=this._locale[c];if(t==null)throw new Error(`Missing UI string '${c}'`);return t}_updateStyle(c,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),c){const r=n.l({},t);t&&t.config&&(r.initialConfig=t.config,delete r.config),this.style=new ta(this,r).load(c),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ta(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(n.w("There is no style added to the map."),!1)}_isValidId(c){return c==null?(this.fire(new n.y(new Error("IDs can't be empty."))),!1):!n.cr(c)||(this.fire(new n.y(new Error(`IDs can't contain special symbols: "${c}".`))),!1)}_isTargetValid(c){return"featuresetId"in c?this._isValidId("importId"in c?c.importId:c.featuresetId):"layerId"in c&&this._isValidId(c.layerId)}_areTargetsValid(c){if(Array.isArray(c)){for(const t of c)if(!this._isValidId(t))return!1;return!0}return this._isTargetValid(c)}addSource(c,t){return this._isValidId(c)?(this._lazyInitEmptyStyle(),this.style.addSource(c,t),this._update(!0)):this}isSourceLoaded(c){return!!this._isValidId(c)&&!!this.style&&this.style._isSourceCacheLoaded(c)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(c,t,r){this._lazyInitEmptyStyle(),this.style.addSourceType(c,t,r)}removeSource(c){return this._isValidId(c)?(this.style.removeSource(c),this._updateTerrain(),this._update(!0)):this}getSource(c){return this._isValidId(c)?this.style.getOwnSource(c):null}addImage(c,t,{pixelRatio:r=1,sdf:u=!1,stretchX:p,stretchY:_,content:b}={}){if(this._lazyInitEmptyStyle(),t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap){const{width:C,height:O,data:P}=n.q.getImageData(t);this.style.addImage(c,{data:new n.r({width:C,height:O},P),pixelRatio:r,stretchX:p,stretchY:_,content:b,sdf:u,version:0,usvg:!1})}else if(t.width===void 0||t.height===void 0)this.fire(new n.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:C,height:O}=t,P=t;this.style.addImage(c,{data:new n.r({width:C,height:O},new Uint8Array(P.data)),pixelRatio:r,stretchX:p,stretchY:_,content:b,sdf:u,usvg:!1,version:0,userImage:P}),P.onAdd&&P.onAdd(this,c)}}updateImage(c,t){this._lazyInitEmptyStyle();const r=this.style.getImage(c);if(!r)return void this.fire(new n.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const u=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?n.q.getImageData(t):t,{width:p,height:_,data:b}=u;if(p===void 0||_===void 0)return void this.fire(new n.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(p!==(r.usvg?r.icon.usvg_tree.width:r.data.width)||_!==(r.usvg?r.icon.usvg_tree.height:r.data.height))return void this.fire(new n.y(new Error(`The width and height of the updated image (${p}, ${_})
                must be that same as the previous version of the image
                (${r.data.width}, ${r.data.height})`)));const C=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap);let O=!1;r.usvg?(r.data=new n.r({width:p,height:_},new Uint8Array(b)),r.usvg=!1,r.icon=void 0,O=!0):r.data.replace(b,C),this.style.updateImage(c,r,O)}hasImage(c){return c?!!this.style&&!!this.style.getImage(c):(this.fire(new n.y(new Error("Missing required image id"))),!1)}removeImage(c){this.style.removeImage(c)}loadImage(c,t){n.o(this._requestManager.transformRequest(c,n.R.Image),(r,u)=>{t(r,u instanceof HTMLImageElement?n.q.getImageData(u):u)})}listImages(){return this.style.listImages()}addModel(c,t){this._lazyInitEmptyStyle(),this.style.addModel(c,t)}hasModel(c){return c?this.style.hasModel(c):(this.fire(new n.y(new Error("Missing required model id"))),!1)}removeModel(c){this.style.removeModel(c)}listModels(){return this.style.listModels()}addLayer(c,t){return this._isValidId(c.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(c,t),this._update(!0)):this}getSlot(c){const t=this.getLayer(c);return t&&t.slot||null}setSlot(c,t){return this.style.setSlot(c,t),this.style.mergeLayers(),this._update(!0)}addImport(c,t){return this.style.addImport(c,t),this}updateImport(c,t){return typeof t!="string"&&t.id!==c?(this.removeImport(c),this.addImport(t)):(this.style.updateImport(c,t),this._update(!0))}removeImport(c){return this.style.removeImport(c),this}moveImport(c,t){return this.style.moveImport(c,t),this._update(!0)}moveLayer(c,t){return this._isValidId(c)?(this.style.moveLayer(c,t),this._update(!0)):this}removeLayer(c){return this._isValidId(c)?(this.style.removeLayer(c),this._update(!0)):this}getLayer(c){if(!this._isValidId(c))return null;const t=this.style.getOwnLayer(c);return t?t.type==="custom"?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(c,t,r){return this._isValidId(c)?(this.style.setLayerZoomRange(c,t,r),this._update(!0)):this}setFilter(c,t,r={}){return this._isValidId(c)?(this.style.setFilter(c,t,r),this._update(!0)):this}getFilter(c){return this._isValidId(c)?this.style.getFilter(c):null}setPaintProperty(c,t,r,u={}){return this._isValidId(c)?(this.style.setPaintProperty(c,t,r,u),this._update(!0)):this}getPaintProperty(c,t){return this._isValidId(c)?this.style.getPaintProperty(c,t):null}setLayoutProperty(c,t,r,u={}){return this._isValidId(c)?(this.style.setLayoutProperty(c,t,r,u),this._update(!0)):this}getLayoutProperty(c,t){return this._isValidId(c)?this.style.getLayoutProperty(c,t):null}getSchema(c){return this.style.getSchema(c)}setSchema(c,t){return this.style.setSchema(c,t),this._update(!0)}getConfig(c){return this.style.getConfig(c)}setConfig(c,t){return this.style.setConfig(c,t),this._update(!0)}getConfigProperty(c,t){return this.style.getConfigProperty(c,t)}setConfigProperty(c,t,r){return this.style.setConfigProperty(c,t,r),this._update(!0)}getFeaturesetDescriptors(c){return this.style.getFeaturesetDescriptors(c)}setLights(c){if(this._lazyInitEmptyStyle(),c&&c.length===1&&c[0].type==="flat"){const t=c[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(c),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const c=this.style.getLights()||[];return c.length===0&&c.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),c}setLight(c,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:c}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(c){return this._lazyInitEmptyStyle(),!c&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(c),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(c){return this._lazyInitEmptyStyle(),this.style.setFog(c),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(c){return this._lazyInitEmptyStyle(),this.style.setSnow(c),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(c){return this._lazyInitEmptyStyle(),this.style.setRain(c),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(c){return this._lazyInitEmptyStyle(),this.style.setColorTheme(c),this._update(!0)}setImportColorTheme(c,t){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(c,t),this._update(!0)}setCamera(c){return this.style.setCamera(c),this._triggerCameraUpdate(c)}_triggerCameraUpdate(c){return this._update(this.transform.setOrthographicProjectionAtLowPitch(c["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(c){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(n.bO.convert(c),this.transform):0}setFeatureState(c,t){return c.source&&!this._isValidId(c.source)?this:(this.style.setFeatureState(c,t),this._update())}removeFeatureState(c,t){return c.source&&!this._isValidId(c.source)?this:(this.style.removeFeatureState(c,t),this._update())}getFeatureState(c){return c.source&&!this._isValidId(c.source)?null:this.style.getFeatureState(c)}_updateContainerDimensions(){if(!this._container)return;const c=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let r,u,p,_=this._container;for(;_&&(!u||!p);){const b=window.getComputedStyle(_).transform;b&&b!=="none"&&(r=b.match(/matrix.*\((.+)\)/)[1].split(", "),r[0]&&r[0]!=="0"&&r[0]!=="1"&&(u=r[0]),r[3]&&r[3]!=="0"&&r[3]!=="1"&&(p=r[3])),_=_.parentElement}this._containerWidth=u?Math.abs(c/u):c,this._containerHeight=p?Math.abs(t/p):t}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&n.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const c=this._container;c.classList.add("mapboxgl-map"),(this._missingCSSCanary=tt("div","mapboxgl-canary",c)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=tt("div","mapboxgl-canvas-container",c);this._canvas=tt("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const r=this._controlContainer=tt("div","mapboxgl-control-container",c),u=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(p=>{u[p]=tt("div",`mapboxgl-ctrl-${p}`,r)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(c,t){const r=n.q.devicePixelRatio||1;this._canvas.width=r*Math.ceil(c),this._canvas.height=r*Math.ceil(t),this._canvas.style.width=`${c}px`,this._canvas.style.height=`${t}px`}_addMarker(c){this._markers.push(c)}_removeMarker(c){const t=this._markers.indexOf(c);t!==-1&&this._markers.splice(t,1)}_addPopup(c){this._popups.push(c)}_removePopup(c){const t=this._popups.indexOf(c);t!==-1&&this._popups.splice(t,1)}_setupPainter(){const c=n.l({},Qe.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",c);t?(to(t,!0),this.painter=new gf(t,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp),this.on("data",r=>{r.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),n.m.testSupport(t)):this.fire(new n.y(new Error("Failed to initialize WebGL")))}_contextLost(c){c.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new n.z("webglcontextlost",{originalEvent:c}))}_contextRestored(c){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style.reloadModels(),this.style.clearSources(),this._update(),this.fire(new n.z("webglcontextrestored",{originalEvent:c}))}_onMapScroll(c){if(c.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(c){return this.style?(this._styleDirty=this._styleDirty||c,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(c){return this._update(),this._renderTaskQueue.add(c)}_cancelRenderFrame(c){this._renderTaskQueue.remove(c)}_requestDomTask(c){!this.loaded()||this.loaded()&&!this.isMoving()?c():this._domRenderTaskQueue.add(c)}_render(c){let t;this.fire(new n.z("renderstart")),++this._frameId;const r=this.painter.context.extTimerQuery,u=n.q.now(),p=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=p.createQuery(),p.beginQuery(r.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(c),this._domRenderTaskQueue.run(c),this._removed)return;this._updateProjectionTransition();const _=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const P=this.transform.zoom,F=this.transform.pitch,V=n.q.now(),U=new n.a8(P,{now:V,fadeDuration:_,pitch:F,transition:this.style.transition});this.style.update(U)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let b=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),b=this._updateAverageElevation(u),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):b=this._updateAverageElevation(u);const C=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,_,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),C&&(this._placementDirty=C.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:_,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new n.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,ge.mark(ne.load),this.fire(new n.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const P=n.q.now()-u;p.endQuery(r.TIME_ELAPSED_EXT),setTimeout(()=>{const F=p.getQueryParameter(t,p.QUERY_RESULT)/1e6;p.deleteQuery(t),this.fire(new n.z("gpu-timing-frame",{cpuTime:P,gpuTime:F}))},50)}if(this.listens("gpu-timing-layer")){const P=this.painter.collectGpuTimers();setTimeout(()=>{const F=this.painter.queryGpuTimers(P);this.fire(new n.z("gpu-timing-layer",{layerTimes:F}))},50)}if(this.listens("gpu-timing-deferred-render")){const P=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const F=this.painter.queryGpuTimeDeferredRender(P);this.fire(new n.z("gpu-timing-deferred-render",{gpuTime:F}))},50)}const O=this._sourcesDirty||this._styleDirty||this._placementDirty||b;if(O||this._repaint)this.triggerRepaint();else{const P=this.idle();if(P&&(b=this._updateAverageElevation(u,!0)),b)this.triggerRepaint();else if(this._triggerFrame(!1),P&&(this.fire(new n.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const F=this._calculateSpeedIndex();this.fire(new n.z("speedindexcompleted",{speedIndex:F})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||O||(this._fullyLoaded=!0,ge.mark(ne.fullLoad),this._performanceMetricsCollection&&gr(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(c){for(const t of this._markers)c&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!c||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(c,t=!1){const r=p=>(this.transform.averageElevation=p,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&r(0);const u=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(u||(t||c-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(c)){const p=this.transform.averageElevation;let _=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(_)?_=0:this._averageElevationLastSampledAt=c;const b=Math.abs(p-_);if(b>1){if(this._isInitialLoad||u)return this._averageElevation.jumpTo(_),r(_);this._averageElevation.easeTo(_,c,300)}else if(b>1e-4)return this._averageElevation.jumpTo(_),r(_)}return!!this._averageElevation.isEasing(c)&&r(this._averageElevation.getValue(c))}_authenticate(){Ae(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,c=>{if(c&&(c.message===Dr||c.status===401)){const t=this.painter.context.gl;to(t,!1),this._logoControl instanceof da&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new n.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),wi(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&lr(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const c=this._isDragging();this.painter.updateTerrain(this.style,c)}_calculateSpeedIndex(){const c=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const r=this.painter.context.gl,u=r.createFramebuffer();function p(_){r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,_,0);const b=new Uint8Array(r.drawingBufferWidth*r.drawingBufferHeight*4);return r.readPixels(0,0,r.drawingBufferWidth,r.drawingBufferHeight,r.RGBA,r.UNSIGNED_BYTE,b),b}return r.bindFramebuffer(r.FRAMEBUFFER,u),this._canvasPixelComparison(p(c),t.canvasCopies.map(p),t.timeStamps)}_canvasPixelComparison(c,t,r){let u=r[1]-r[0];const p=c.length/4;for(let _=0;_<t.length;_++){const b=t[_];let C=0;for(let O=0;O<b.length;O+=4)b[O]===c[O]&&b[O+1]===c[O+1]&&b[O+2]===c[O+2]&&b[O+3]===c[O+3]&&(C+=1);u+=(r[_+2]-r[_+1])*(1-C/p)}return u}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const c=this.painter.context.gl.getExtension("WEBGL_lose_context");c&&c.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Ea.delete(this.painter.context.gl),nn.remove(),Nt.remove(),this._removed=!0,this.fire(new n.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(c){this._renderNextFrame=this._renderNextFrame||c,this.style&&!this._frame&&(this._frame=n.q.frame(t=>{const r=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,r&&this._render(t)}))}_preloadTiles(c){const t=this.style?this.style.getSourceCaches():[];return n.bl(t,(r,u)=>r._preloadTiles(c,u),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(c){this._trackResize&&this.resize({originalEvent:c})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(c){this._showTileBoundaries!==c&&(this._showTileBoundaries=c,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(c){this._showParseStatus!==c&&(this._showParseStatus=c,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(c){this._showTerrainWireframe!==c&&(this._showTerrainWireframe=c,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(c){this._showLayers2DWireframe!==c&&(this._showLayers2DWireframe=c,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(c){this._showLayers3DWireframe!==c&&(this._showLayers3DWireframe=c,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(c){this._speedIndexTiming!==c&&(this._speedIndexTiming=c,this._update())}get showPadding(){return!!this._showPadding}set showPadding(c){this._showPadding!==c&&(this._showPadding=c,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(c){this._showCollisionBoxes!==c&&(this._showCollisionBoxes=c,this._tp.refreshUI(),c?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(c){this._showOverdrawInspector!==c&&(this._showOverdrawInspector=c,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(c){this._repaint!==c&&(this._repaint=c,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(c){this._vertices=c,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(c){this._showTileAABBs!==c&&(this._showTileAABBs=c,this._tp.refreshUI(),c&&this._update())}_setCacheLimits(c,t){n.dG(c,t)}get version(){return ae}},NavigationControl:class{constructor(c={}){this.options=n.l({},yc,c),this._container=tt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(n.aP(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),tt("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),tt("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(n.aP(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const r=this._map;r&&(this.options.visualizePitch?r.resetNorthPitch({},{originalEvent:t}):r.resetNorth({},{originalEvent:t}))}),this._compassIcon=tt("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const c=this._map;if(!c)return;const t=c.getZoom(),r=t===c.getMaxZoom(),u=t===c.getMinZoom();this._zoomInButton.disabled=r,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",r.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())}_rotateCompassArrow(){const c=this._map;if(!c)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(c.transform.pitch*(Math.PI/180)),.5)}) rotateX(${c.transform.pitch}deg) rotateZ(${c.transform.angle*(180/Math.PI)}deg)`:`rotate(${c.transform.angle*(180/Math.PI)}deg)`;c._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(c){return this._map=c,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),c.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&c.on("pitch",this._rotateCompassArrow),c.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ns(c,this._compass,this.options.visualizePitch)),this._container}onRemove(){const c=this._map;c&&(this._container.remove(),this.options.showZoom&&c.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&c.off("pitch",this._rotateCompassArrow),c.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(c,t){const r=tt("button",c,this._container);return r.type="button",r.addEventListener("click",t),r}_setButtonTitle(c,t){if(!this._map)return;const r=this._map._getUIString(`NavigationControl.${t}`);c.setAttribute("aria-label",r),c.firstElementChild&&c.firstElementChild.setAttribute("title",r)}},GeolocateControl:class extends n.E{constructor(c={}){super();const t=navigator.geolocation;this.options=n.l({geolocation:t},sa,c),n.aP(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=dh(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(c){return this._map=c,this._container=tt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(c){const t=(r=!!this.options.geolocation)=>{this._supportsGeolocation=r,c(r)};this._supportsGeolocation!==void 0?c(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(r=>t(r.state!=="denied")).catch(()=>t()):t()}_isOutOfMapMaxBounds(c){const t=this._map.getMaxBounds(),r=c.coords;return!!t&&(r.longitude<t.getWest()||r.longitude>t.getEast()||r.latitude<t.getSouth()||r.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(c){if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new n.z("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new n.z("geolocate",c)),this._finish()}}_updateCamera(c){const t=new n.bO(c.coords.longitude,c.coords.latitude),r=c.coords.accuracy,u=this._map.getBearing(),p=n.l({bearing:u},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(r),p,{geolocateSource:!0})}_updateMarker(c){if(c){const t=new n.bO(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const c=this._map.transform,t=n.bH(1,c._center.lat)*c.worldSize,r=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${r}px`,this._circleElement.style.height=`${r}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(c){if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new n.z("error",c)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(c){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=tt("button","mapboxgl-ctrl-geolocate",this._container),tt("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",c===!1){n.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=tt("div","mapboxgl-user-location"),this._dotElement.appendChild(tt("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(tt("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Is({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=tt("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Is({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new n.z("trackuserlocationend")))})}}_onDeviceOrientation(c){this._userLocationDotMarker&&(c.webkitCompassHeading?this._heading=c.webkitCompassHeading:c.absolute===!0&&(this._heading=-1*c.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return n.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new n.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new n.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new n.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let c;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(c={maximumAge:6e5,timeout:0},this._noTimeout=!0):(c=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,c),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const c=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&c()}).catch(console.error):c()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:gu,ScaleControl:class{constructor(c={}){this.options=n.l({},va,c),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),n.aP(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const c=this.options.maxWidth||100,t=this._map,r=t._containerHeight/2,u=t._containerWidth/2-c/2,p=t.unproject([u,r]),_=t.unproject([u+c,r]),b=p.distanceTo(_);if(this.options.unit==="imperial"){const C=3.2808*b;C>5280?this._setScale(c,C/5280,"mile"):this._setScale(c,C,"foot")}else this.options.unit==="nautical"?this._setScale(c,b/1852,"nautical-mile"):b>=1e3?this._setScale(c,b/1e3,"kilometer"):this._setScale(c,b,"meter")}_setScale(c,t,r){this._map._requestDomTask(()=>{const u=function(_){const b=Math.pow(10,`${Math.floor(_)}`.length-1);let C=_/b;return C=C>=10?10:C>=5?5:C>=3?3:C>=2?2:C>=1?1:function(O){const P=Math.pow(10,Math.ceil(-Math.log(O)/Math.LN10));return Math.round(O*P)/P}(C),b*C}(t),p=u/t;this._container.innerHTML=this._isNumberFormatSupported&&r!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:r}).format(u):`${u}&nbsp;${gn[r]}`,this._container.style.width=c*p+"px"})}onAdd(c){return this._map=c,this._language=c.getLanguage(),this._container=tt("div","mapboxgl-ctrl mapboxgl-ctrl-scale",c.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(c){this._language=c,this._update()}setUnit(c){this.options.unit=c,this._update()}},FullscreenControl:class{constructor(c={}){this._fullscreen=!1,c&&c.container&&(c.container instanceof HTMLElement?this._container=c.container:n.w("Full screen control 'container' must be a DOM element.")),n.aP(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(c){return this._map=c,this._container||(this._container=this._map.getContainer()),this._controlContainer=tt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",n.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const c=this._fullscreenButton=tt("button","mapboxgl-ctrl-fullscreen",this._controlContainer);tt("span","mapboxgl-ctrl-icon",c).setAttribute("aria-hidden","true"),c.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const c=this._getTitle();this._fullscreenButton.setAttribute("aria-label",c),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",c)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends n.E{constructor(c){super(),this.options=n.l(Object.create(vo),c),n.aP(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(c&&c.className?c.className.trim().split(/\s+/):[])}addTo(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&c.on("preclick",this._onClose),this.options.closeOnMove&&c.on("move",this._onClose),c.on("remove",this.remove),this._update(),c._addPopup(this),this._focusFirstElement(),this._trackPointer?(c.on("mousemove",this._onMouseEvent),c.on("mouseup",this._onMouseEvent),c._canvasContainer.classList.add("mapboxgl-track-pointer")):c.on("move",this._update),this.fire(new n.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const c=this._map;return c&&(c.off("move",this._update),c.off("move",this._onClose),c.off("preclick",this._onClose),c.off("click",this._onClose),c.off("remove",this.remove),c.off("mousemove",this._onMouseEvent),c.off("mouseup",this._onMouseEvent),c.off("drag",this._onMouseEvent),c._canvasContainer&&c._canvasContainer.classList.remove("mapboxgl-track-pointer"),c._removePopup(this),this._map=void 0),this.fire(new n.z("close")),this}getLngLat(){return this._lngLat}setLngLat(c){this._lngLat=n.bO.convert(c),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const c=this._map;return c&&(c.off("move",this._update),c.on("mousemove",this._onMouseEvent),c.on("drag",this._onMouseEvent),c._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(c){return this.setDOMContent(document.createTextNode(c))}setHTML(c){const t=document.createDocumentFragment(),r=document.createElement("body");let u;for(r.innerHTML=c;u=r.firstChild,u;)t.appendChild(u);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(c){return this.options.maxWidth=c,this._update(),this}setDOMContent(c){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=tt("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(c),this.options.closeButton){const r=this._closeButton=tt("button","mapboxgl-popup-close-button",t);r.type="button",r.setAttribute("aria-label","Close popup"),r.innerHTML='<span aria-hidden="true">&#215;</span>',r.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(c){return this._classList.add(c),this._updateClassList(),this}removeClassName(c){return this._classList.delete(c),this._updateClassList(),this}setOffset(c){return this.options.offset=c,this._update(),this}toggleClassName(c){let t;return this._classList.delete(c)?t=!1:(this._classList.add(c),t=!0),this._updateClassList(),t}_onMouseEvent(c){this._update(c.point)}_getAnchor(c){if(this.options.anchor)return this.options.anchor;const t=this._map,r=this._container,u=this._pos;if(!t||!r||!u)return"bottom";const p=r.offsetWidth,_=r.offsetHeight,b=u.x<p/2,C=u.x>t.transform.width-p/2;if(u.y+c<_)return b?"top-left":C?"top-right":"top";if(u.y>t.transform.height-_){if(b)return"bottom-left";if(C)return"bottom-right"}return b?"left":C?"right":"bottom"}_updateClassList(){const c=this._container;if(!c)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),c.className=t.join(" ")}_update(c){const t=this._map,r=this._content;if(!t||!this._lngLat&&!this._trackPointer||!r)return;let u=this._container;if(u||(u=this._container=tt("div","mapboxgl-popup",t.getContainer()),this._tip=tt("div","mapboxgl-popup-tip",u),u.appendChild(r)),this.options.maxWidth&&u.style.maxWidth!==this.options.maxWidth&&(u.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=vh(this._lngLat,this._pos,t.transform)),!this._trackPointer||c){const p=this._pos=this._trackPointer&&c instanceof n.P?c:t.project(this._lngLat),_=xh(this.options.offset),b=this._anchor=this._getAnchor(_.y),C=xh(this.options.offset,b),O=p.add(C).round();t._requestDomTask(()=>{this._container&&b&&(this._container.style.transform=`${$s[b]} translate(${O.x}px,${O.y}px)`)})}if(!this._marker&&t._showingGlobe()){const p=n.dH(t.transform,this._lngLat)?0:1;this._setOpacity(p)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const c=this._container.querySelector(Tr);c&&c.focus()}_onClose(){this.remove()}_setOpacity(c){this._container&&(this._container.style.opacity=`${c}`),this._content&&(this._content.style.pointerEvents=c?"auto":"none")}},Marker:Is,Style:ta,LngLat:n.bO,LngLatBounds:n.az,Point:n.P,MercatorCoordinate:n.aa,FreeCameraOptions:Zu,Evented:n.E,config:n.e,prewarm:n.dM,clearPrewarmedResources:n.dN,get accessToken(){return n.e.ACCESS_TOKEN},set accessToken(c){n.e.ACCESS_TOKEN=c},get baseApiUrl(){return n.e.API_URL},set baseApiUrl(c){n.e.API_URL=c},get workerCount(){return n.dO.workerCount},set workerCount(c){n.dO.workerCount=c},get maxParallelImageRequests(){return n.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(c){n.e.MAX_PARALLEL_IMAGE_REQUESTS=c},clearStorage(c){n.dP(c)},get workerUrl(){return n.dQ.workerUrl},set workerUrl(c){n.dQ.workerUrl=c},get workerClass(){return n.dQ.workerClass},set workerClass(c){n.dQ.workerClass=c},get workerParams(){return n.dQ.workerParams},set workerParams(c){n.dQ.workerParams=c},get dracoUrl(){return n.dR()},set dracoUrl(c){n.dS(c)},get meshoptUrl(){return n.dT()},set meshoptUrl(c){n.dU(c)},setNow:n.q.setNow,restoreNow:n.q.restoreNow}});var W=L;return W})}(by)),by.exports}var QC=$C();const wy=Ay(QC),KC=x=>["interpolate",["linear"],["zoom"],5,0,8,x],JC=x=>{wy.accessToken="pk.eyJ1IjoiZ2F0c2J5a2VuamkiLCJhIjoiY202azF4Y2trMDcxcDJqcXFlZXh0a212NSJ9.vxT12MITCjAxQloXvl8L_g";const m=new wy.Map({container:x,style:"mapbox://styles/mapbox/satellite-v9",center:[13,57],zoom:2.5,pitch:60,bearing:0,antialias:!0});return m.addControl(new wy.NavigationControl({visualizePitch:!0,showZoom:!0,showCompass:!0})),m},eD=x=>{x.addSource("terrain-source",{type:"raster-dem",url:"mapbox://mapbox.terrain-rgb",tileSize:512}),x.setTerrain({source:"terrain-source",exaggeration:3})},tD=x=>{x.setSnow({density:KC(.85),intensity:1,"center-thinning":.1,direction:[0,50],opacity:1,color:"#ffffff","flake-size":.71,vignette:1,"vignette-color":"#000000"})},iD=(x,m,w)=>{if(x.getSource("route")||x.addSource("route",{type:"geojson",data:m}),m.features.length>0&&m.features[0].geometry.type==="LineString"){const M=m.features[0].geometry.coordinates,L=[];for(let j=0;j<M.length-1;j++){const W=j===0?10:j===1?7:3;L.push({type:"Feature",geometry:{type:"LineString",coordinates:[M[j],M[j+1]]},properties:{width:W}})}x.getSource("route-segments")||x.addSource("route-segments",{type:"geojson",data:{type:"FeatureCollection",features:L}}),x.getLayer("route-line")||x.addLayer({id:"route-line",type:"line",source:"route-segments",paint:{"line-color":"#FF0000","line-width":["get","width"],"line-opacity":.8}})}else console.error("Invalid Hannibal route data provided.");x.getSource("point-route")||x.addSource("point-route",{type:"geojson",data:w}),x.getLayer("route-points")||x.addLayer({id:"route-points",type:"circle",source:"point-route",paint:{"circle-radius":6,"circle-color":"#FFFFFF","circle-stroke-width":2,"circle-stroke-color":"#FF0000"}}),x.getLayer("route-labels")||x.addLayer({id:"route-labels",type:"symbol",source:"point-route",layout:{"text-field":["get","description"],"text-variable-anchor":["top","bottom","left","right"],"text-radial-offset":.8,"text-size":12,"text-font":["Open Sans Regular","Arial Unicode MS Regular"]},paint:{"text-color":"#ffffff","text-halo-color":"#000000","text-halo-width":1}})},rD=(x,m)=>{x.getSource("capitals")||x.addSource("capitals",{type:"geojson",data:m});const w=M=>new Promise((L,j)=>{x.loadImage(M,(W,n)=>{W?j(W):n?L(n):j(new Error(`Failed to load image ${M} without specific error.`))})});Promise.all([w("/taka.png"),w("/zou.png")]).then(([M,L])=>{x.hasImage("roman-icon")||x.addImage("roman-icon",M),x.hasImage("carthage-icon")||x.addImage("carthage-icon",L),x.getLayer("capital-icons")||x.addLayer({id:"capital-icons",type:"symbol",source:"capitals",layout:{"icon-image":["match",["get","empire"],"Roman","roman-icon","Carthaginian","carthage-icon",""],"icon-size":.12,"icon-allow-overlap":!0,"icon-ignore-placement":!0,"text-field":["get","name"],"text-font":["Open Sans Bold","Arial Unicode MS Bold"],"text-offset":[0,1],"text-anchor":"top","text-allow-overlap":!1,"text-ignore-placement":!1},paint:{"text-color":"#000000","text-halo-color":"#FFFFFF","text-halo-width":1}})}).catch(M=>{console.error("Error loading capital city icons:",M)})},nD=x=>{x.on("click","route-points",m=>{var L;if(!m.features||m.features.length===0)return;const w=m.features[0];if(!w.geometry||!("coordinates"in w.geometry))return;const M=w.geometry.coordinates;Array.isArray(M)&&M.length===2?new wy.Popup().setLngLat(M).setHTML(((L=w.properties)==null?void 0:L.description)||"").addTo(x):console.error("Invalid coordinates:",M)})},aD=x=>{x.on("mouseenter","route-points",()=>{x.getCanvas().style.cursor="pointer"}),x.on("mouseleave","route-points",()=>{x.getCanvas().style.cursor=""})},sD=Dm`
  query GetMapData {
    capitalCities {
      type
      features {
        type
        geometry {
          type
          coordinates
        }
        properties {
          name
          description
          empire
        }
      }
    }
    hannibalRoute {
      type
      features {
        type
        geometry {
          type
          coordinates
        }
        properties {
          description
        }
      }
    }
    pointRoute {
      type
      features {
        type
        geometry {
          type
          coordinates
        }
        properties {
          description
        }
      }
    }
  }
`,oD=()=>{const x=ip.useRef(null),m=ip.useRef(null),[w,M]=ip.useState(0),{loading:L,error:j,data:W}=kC(sD);ip.useEffect(()=>{W&&(console.log("Capital Cities Data:",W.capitalCities),console.log("Hannibal Route Data:",W.hannibalRoute),console.log("Point Route Data:",W.pointRoute))},[W]);const n=(ae,ne)=>{};return ip.useEffect(()=>{if(!(!W||!x.current))try{return m.current=JC(x.current),m.current.on("style.load",()=>{if(m.current){eD(m.current),tD(m.current);try{iD(m.current,W.hannibalRoute,W.pointRoute),rD(m.current,W.capitalCities),nD(m.current),aD(m.current),console.log("Map layers added successfully.")}catch(ae){console.error("Error adding layers:",ae),n(`Map layer error: ${ae}`)}}}),()=>{var ae;(ae=m.current)==null||ae.remove()}}catch(ae){console.error("Map Initialization Failed:",ae)}},[W]),Ko.jsxs(Ko.Fragment,{children:[Ko.jsx("div",{ref:x,style:{width:"100vw",height:"100vh"}}),L&&Ko.jsx("div",{style:{position:"fixed",top:0,left:0,color:"blue",background:"white",zIndex:1e4,padding:"4px 8px"},children:"Loading..."}),j&&Ko.jsxs("div",{style:{position:"fixed",top:30,left:0,color:"red",background:"white",zIndex:1e4,padding:"4px 8px"},children:["Error: ",j.message]}),Ko.jsx("div",{id:"error-log",style:{position:"fixed",bottom:0,left:0,right:0,backgroundColor:"rgba(255,255,255,0.95)",color:"red",zIndex:9999,maxHeight:"30vh",overflowY:"auto",padding:"15px",borderTop:"1px solid #ddd",boxShadow:"0 -2px 10px rgba(0,0,0,0.05)",fontSize:"0.85em"},children:Ko.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},children:Ko.jsx("h4",{style:{margin:0},children:""})})})]})};function lD(){return ip.useEffect(()=>{console.log("App component mounted")},[]),Ko.jsx("div",{className:"App",children:Ko.jsx(oD,{})})}JS.createRoot(document.getElementById("root")).render(Ko.jsx(HS.StrictMode,{children:Ko.jsx(CC,{client:YC,children:Ko.jsx(lD,{})})}))});export default cD();
